<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúFortran - Alive and Alive‚Äù or ‚ÄúWhat‚Äôs new ifort‚Äôs grandfather‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you already know, a new Intel Parallel Studio XE 2016 has recently been released, and with it, as it should be, new versions of all tools, includin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúFortran - Alive and Alive‚Äù or ‚ÄúWhat‚Äôs new ifort‚Äôs grandfather‚Äù</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/228/efc/891/228efc891f204a0380809cccfc400a69.png"></div><br>  As you already know, a new Intel Parallel Studio XE 2016 has recently been released, and with it, as it should be, new versions of all tools, including the Fortran compiler.  It is still a ‚Äúliving room‚Äù, is actively developing, with this being highly demanded and used by many developers, especially in HPC and academic environments.  The new version, as always, makes the life of these developers a little easier, maintaining new standards and giving more features.  Let's see what appeared in version 16.0. <br><a name="habracut"></a><br>  <b>Submodules from F2008 (submodules)</b> <br><br>  Support for submodules from the Fortran 2008 standard has been waiting for a long time, and they are the biggest feature of the language, not supported until the last release.  Now it is implemented, and only in the second compiler in the world.  Who is the first?  There is a compiler that fully supports Fortran 2008 - this is Cray. <br><br>  So why were the submodules waiting?  Now I will show a clear example.  So, we have the following code: <br><pre><code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bigmod</span></span></span><span class="hljs-class"> ‚Ä¶ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">contains</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subroutine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub1</span></span></span><span class="hljs-class"> ‚Ä¶&lt;implementation </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub1</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func2</span></span></span><span class="hljs-class"> ‚Ä¶&lt;implementation </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func2</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subroutine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub47</span></span></span><span class="hljs-class"> ‚Ä¶&lt;implementation </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub47</span></span></span><span class="hljs-class">&gt; ‚Ä¶ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bigmod</span></span></span></span></code> </pre> <br>  As we see, we have a large module, in which there are many different functions.  This module is actively used in other files using the <i>USE</i> operator: <br><pre> <code class="hljs sql">! Source source1.f90 <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> bigmod ‚Ä¶ all sub1 ! <span class="hljs-keyword"><span class="hljs-keyword">Source</span></span> source2.f90 <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> bigmod ‚Ä¶ x = func2(‚Ä¶) ! <span class="hljs-keyword"><span class="hljs-keyword">Source</span></span> source47.f90 <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> bigmod ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> sub47</code> </pre><br>  If we wanted (this sometimes happens) to change the code of a function from a <i>bigmod</i> module, for example <i>sub47</i> , then we will have to rebuild the module itself, and even all the files in which it is used.  And this will happen even if the interface of the function has not changed and, moreover, even if the function itself, to which we made changes, is not called at all in the code, but there is only <i>USE</i> .  As a result, for large applications, we get a whole series of not always necessary recompilations.  How great it was to avoid it and reassemble only what you need.  The sub-modules are the solution to this problem. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The basic idea is to remove the implementation of functions from the module.  This is done using interfaces (interface): <br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span> bigmod ‚Ä¶ interface <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> subroutine sub1 ‚Ä¶ <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> function func2 ‚Ä¶ <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> subroutine sub47 ‚Ä¶ end interface end <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> bigmod</code> </pre><br>  After that, in a separate file, a <i>bigmod_submodule</i> submodule and implementation of functions are created: <br><pre> <code class="hljs ruby">submodule (bigmod) bigmod_submod contains <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subroutine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub1</span></span></span><span class="hljs-class"> ‚Ä¶ &lt;implementation </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub1</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func2</span></span></span><span class="hljs-class"> ‚Ä¶ &lt;implementation </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func2</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subroutine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub3</span></span></span><span class="hljs-class"> ‚Ä¶ &lt;implementation </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub3</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">submodule</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bigmod_submod</span></span></span></span></code> </pre><br>  In this case, when implementing functions, you must use the <i>module</i> keyword, and everything that we declare inside the submodule will only be visible there.  Now changes in the submodule will not lead to recompilation of anything and everything, until we change the interface of the function.  We must compile the parent module first and then move on to the submodules. <br><br>  <b>Interoperability C and Fortran</b> <br><br>  As the Fortran Standardization Committee continues to take care of its friendship with the C language, the latest version <a href="">contains</a> possibilities from the technical specification <a href="">TS29113</a> ( <i>Further Interoperability of Fortran with C</i> ), which will be part of the F2015 standard.  In general, the term Technical Specification (Technical Specification) appears toga when there is some sort of language feature that is not yet fully completed in order to be accepted in the standard, but it is quite needed for various compiler manufacturers to begin to implement it.  By the way, they used to be called TR (Technhical Report).  Usually, when such a specification is approved by the committee, it is adopted in the following standard without changes, so that those compilers that have already implemented support do not have awkward situations. <br><br>  The appearance of this specification is mainly motivated by the needs of <i>MPI3</i> .  In particular, it allows you to expand the interaction between C and Fortran in two main areas: <br><br><ul><li>  allows to transfer to C functions pointers (pointer), adopting the configuration (assumed-shape) and allocated (allocatable) variables.  At the moment, the method of transmitting information about the boundaries of arrays is not standardized and depends on the compiler implementation.  With this specification, it is standardized.  In addition, C developers can read, write and allocate memory for these arguments, as well as define them and transfer them to Fortran code. </li><li>  supports interoperability with C type void *, not having an explicit type and dimension. </li></ul><br>  Implement these tasks with new keywords.  So, the adopting type (assumed type) <i>TYPE (*)</i> , and the dimension of the array (assumed rank) <i>DIMENSION (..)</i> appear.  In addition, there is now a C descriptor.  In general, if you face the challenge of trouble-free coexistence of C and Fortran, then you will definitely understand the <i>ISO_C_BINDING</i> functions of the module from the Fortran2003 standard (I already wrote about them <a href="http://habrahabr.ru/company/intel/blog/255305/">here</a> ), you will understand that there are open problems in it that are solved by this specification. <br><br>  <b>Clean or not?</b> <br><br>  In the same standard F2008 there is a new opportunity to declare functions as <i>impure elemental</i> . <br><br>  In order to understand the essence of this feature, you need to start to figure out what <i>elemental</i> and pure functions, which appeared in the F2003 standard, are. <br><br>  Pointing before the <i>pure</i> function, we tell the compiler that the function cannot change anything outside of itself, and always returns the same result with the same input parameters. <br><br><pre> <code class="hljs matlab">pure <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span></span></code> </pre><br>  This allows the use of pure functions in parallel <i>forall</i> designs. <br><br>  For all its arguments, you need to explicitly specify the <i>intent (in)</i> attribute, which says that these are only input parameters and we do not change them, and it is forbidden to perform input / output operations, perform the <i>STOP</i> operator, use static variables (with the <i>save</i> attribute) in the function itself .  Examples of pure functions: <i>sin (x)</i> , <i>length (s)</i> and others. <br><br>  An impure function will be any function that does not work with local variables, or gives a different result, regardless of the arguments.  Let's say the use of <i>random ()</i> inside a pure function is prohibited, but in impure just right. <br><br>  We now turn to element functions. <br><br><pre> <code class="hljs lisp">elemental subroutine swap(<span class="hljs-name"><span class="hljs-name">a</span></span>, b)</code> </pre><br>  They are declared with scalar arguments, but can be called with arrays as actual arguments.  In this case, the compiler creates a loop to call a function in it, filling the array.  By default, any elemental function is pure.  Thus, impure elemental functions are still elemental, but with some indulgence, functions.  In particular, they are allowed to do I / O operations, use <i>random ()</i> , static variables. <br><br>  It is worth noting that the use of <i>impure</i> can affect vectorization, since the optimizer no longer knows whether this function can change something ‚Äúoutside‚Äù or not. <br><br>  <b>OpenMP 4.1</b> <br>  In a <a href="http://habrahabr.ru/company/intel/blog/265565/">post</a> about the "plus" compiler, I wrote about the extension of support for OpenMP 4.1.  Of course, in Fortran, new TARGET ENTER DATA and TARGET EXIT DATA directives are also supported, as well as TARGET NOWAIT and TARGET DEPEND, as in the C / C ++ compiler. <br><br>  <b>Omp ordered simd directive</b> <br>  With the help of the <i>omp ordered</i> directive, which was previously used only in task cycles, you can force the threads that were executed in parallel, reaching the <i>ordered</i> block, be executed sequentially and in the same order as in the production version: <br><pre> <code class="hljs ruby">!$omp ordered [simd] structured code block !$omp <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ordered</code> </pre><br>  This creates a kind of dependency between threads.  A simple example showing how this works.  In this case, the index will be printed sequentially, in ascending order: <br><pre> <code class="hljs sql">!$omp <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ordered schedule(dynamic) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> i=lb,ub,st <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">work</span></span>(i) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ... subroutine <span class="hljs-keyword"><span class="hljs-keyword">work</span></span>(k) !$omp ordered write(*,*) k !$omp <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ordered</code> </pre><br>  By the way, it worked before only with a dynamic layout.  This construction works the same way now, but the ability to specify the <i>simd</i> option has been <i>added</i> (the threads option is on by default), which allows working with SIMD cycles as well. <br><br>  <b>Locking loops</b> <br>  <a href="http://habrahabr.ru/company/intel/blog/265095/">The new directive</a> , which works when the O3 optimization level is enabled, allows you to control loop-optimized optimization for better work with the cache memory: <br><pre> <code class="hljs erlang-repl">!DIR$ BLOCK_LOOP [clause[[,] clause]...] !DIR$ NOBLOCK_LOOP</code> </pre><br><br>  <b>Catch uninitialized variables</b> <br>  In the 15th version of the compiler, the <i>-init</i> option <i>appeared</i> , which allows defining access to uninitialized variables in runtime, but it was implemented only for working with static variables.  Now they can be used with automatic, as well as allocated ( <i>allocatable</i> ) arrays and pointers. <br>  A simple example: <br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span>, allocatable, dimension(:) :: A <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ALLOCATE(A(N)) <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>, N <span class="hljs-number"><span class="hljs-number">9</span></span> Total = Total + A(I) <span class="hljs-number"><span class="hljs-number">10</span></span> enddo</code> </pre><br>  Putting this case with the <i>-init = arrays, snan key</i> , in which all variables will be initialized with signal NaN, and we get a run-time error: <br><pre> <code class="hljs vhdl">$ ifort -init=arrays,snan -g -traceback sample.F90 -o sample.exe $ sample.exe forrtl: <span class="hljs-literal"><span class="hljs-literal">error</span></span> (<span class="hljs-number"><span class="hljs-number">182</span></span>): floating invalid - possible uninitialized real/complex <span class="hljs-keyword"><span class="hljs-keyword">variable</span></span>. Image PC Routine <span class="hljs-literal"><span class="hljs-literal">Line</span></span> Source ... sample.exe <span class="hljs-number"><span class="hljs-number">0000000000402E12</span></span> MAIN__ <span class="hljs-number"><span class="hljs-number">9</span></span> sample.F90 ... Aborted (core dumped)</code> </pre><br>  I hope our research team will turn their attention to this option in order to avoid bizarre results based on uninitialized variables and incidents resulting from this. <br><br>  <b>"To surrender"</b> <br>  In addition, there are a number of minor improvements that will also help developers to live easier.  So, for example, a new option <i>-fpp-name appeared</i> , which allows you to specify any preprocessor.  Or a new attribute <i>asynchronous</i> , for asnechronous communication.  There are many more improvements that, as usual, try to make the compiler better. <br><br>  By the way, with the compiler from Intel for Fortran a special version of VS 2010 Shell has long been delivered.  It has some limitations (for example, there is no support for C / C ++ at all), but it is very, very useful for developers on Windows - you don‚Äôt have to spread your money for IDE (they don‚Äôt take any extra cash for VS Shell).  So, now the VS version has been updated to 2013, and it is still supplied only with the Fortran compiler package. </div><p>Source: <a href="https://habr.com/ru/post/266079/">https://habr.com/ru/post/266079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266067/index.html">The action "Good deed" - eliminating digital inequality</a></li>
<li><a href="../266069/index.html">Why CIOs must ‚Äúwork in the field‚Äù</a></li>
<li><a href="../266073/index.html">Emacs: we train the cursor (continuation)</a></li>
<li><a href="../266075/index.html">A simple rotary encoder driver for Qt4 Embedded under Linux</a></li>
<li><a href="../266077/index.html">Analysis of one of the VaultCrypt encryption modifications</a></li>
<li><a href="../266081/index.html">In the footsteps of Meteor, or cycling reactivity</a></li>
<li><a href="../266083/index.html">Restriction of memory available to the program</a></li>
<li><a href="../266085/index.html">We build real-time web applications with RethinkDB</a></li>
<li><a href="../266087/index.html">Broadband Method (Class Library)</a></li>
<li><a href="../266089/index.html">Linux container developers meeting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>