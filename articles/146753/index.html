<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java Interceptors (in EJB 3.0)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine that you have already written a considerable part of the application code, and it turns out that you need to add logging to the call of a larg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java Interceptors (in EJB 3.0)</h1><div class="post__text post__text-html js-mediator-article">  Imagine that you have already written a considerable part of the application code, and it turns out that you need to add logging to the call of a large number of methods, or you need to add additional validation of input data to some similar methods. <br>  You can simply rewrite the necessary parts of the code, or you can use the interceptors mechanism that has appeared in EJB 3.0. <br><br>  If details and a small example of implementation are interesting I ask under kat. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Interceptors intercept calls to bins to perform certain actions in front of a method.  A similar concept is similar to the servlet filter chain. <br><br>  We will begin consideration with a simple example. <br>  To use the interceptor, we first define the class itself, with a method that will intercept calls. Let it be a simple logger. <br><br><pre><code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleLogger</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@AroundInvoke</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InvocationContext context)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//-   return context.proceed(); }</span></span></code> </pre> <br>  The capture method must be annotated with @AroundInvoke, and later we will take a closer look at its properties. <br><br>  Now, to intercept the call of the method we need, it is enough just to add an annotation to it with an indication of the required interceptor.  For example: <br><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Summ</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Interceptors</span></span> (SimpleLogger.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">// } }</span></span></code> </pre><br>  In this example, when someone calls the getResult method of the Summ class, before executing it, the addLog method of the SimpleLogger class first runs, and then it returns the getResult method. <br><br>  To begin, consider the intercepting method. <br>  It must have the @AroundInvoke annotation, and there can be only one method with this annotation in the intercept class. <br>  This method may have a public, private protected or packet access modifier, but cannot be declared final or static. <br>  The semantics of the annotated method should satisfy the following pattern: <br>  Object &lt;method name&gt; (InvocationContext &lt;variable name&gt;) throws Exception. <br><br>  After performing actions inside the intercepting method, it returns execution of the business method or another interceptor in the chain by calling context.proceed ().  But, if you do not execute this call, no execution will be transferred to anyone, this can be useful, for example, when organizing an intersector with data validation, if validation failed, then you do not need to continue execution. <br><br>  The InvocationContext interface allows us to access information about the method being called. <br>  Consider his code. <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">InvocationContext</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTarget</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Method </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object[ ] getParametrs(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setParametrs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Object[ ] </span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> java.util.<span class="hljs-function"><span class="hljs-function">Map&lt;String,Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContextData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br><ul><li>  getTarget returns the object in which the intercepted method was called </li><li>  getMethod returns the method of the bean from which the interceptor was called, but if the bean's life cycle was intercepted (for example, the @PreDestroy method), then it will return null </li><li>  getParametrs will return the input parameters of the method as an array of objects </li><li>  setParametrs allows you to change the method parameters during the execution </li><li>  getContextData returns a map that can be used by interceptors to interact with each other, that is, if one method intercepts with several interceptors, then the first can write some value to this map, and subsequent interceptors can read these values ‚Äã‚Äãfor their own purposes. </li></ul><br><br>  You can also intercept callback methods of the life cycle of the intercepted bean, for this you need to add the appropriate methods to the interceptor class.  For example: <br><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleLogger</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@PostConstruct</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InvocationContext context)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ,   context.getTarget() context.proceed(): } @PreDestroy public void remove(InvocationContext context){ //-  context.proceed(): } }</span></span></code> </pre><br>  Another special use of interceptors is that you can declare a so-called ‚Äúdefault interceptor‚Äù whose action will be distributed to all classes within a single application.  Such an interceptor can only be declared via the deployment descriptor, it looks like this <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interceptor-binding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ejb-name</span></span></span><span class="hljs-tag">&gt;</span></span>*<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ejb-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interceptor-class</span></span></span><span class="hljs-tag">&gt;</span></span> ru.interceptortest.Validate<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interceptor-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interceptor-binding</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  At the same time, if it is necessary, so that the action of this interceptor does not spread to any class, it must be marked with its annotations @ExcludeDefaultInterceptors. <br><br>  Let's try to write a simple example using interseptor.  First, create interceptor classes. <br>  Let's make the simplest class that displays messages in the server console when the intercepted method is called. <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SimpleLogger { @AroundInvoke <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> logAction(InvocationContext context) throws <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println("object - " + context.getTarget().getClass()); <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println( "method - " + context.getMethod()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.proceed(); } }</code> </pre><br>  And create a simple class that performs arithmetic operations by marking one of the methods with the @Interceptors annotation (SimpleLogger.class). <br><br><pre> <code class="hljs pgsql">@Stateless <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Count implements <span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>{ <span class="hljs-type"><span class="hljs-type">double</span></span> firstArgument=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">double</span></span> secondArgument=<span class="hljs-number"><span class="hljs-number">0</span></span>; //     @Interceptors(SimpleLogger.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> getSummResult() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getFirstArgument()+ getSecondArgument(); } }</code> </pre><br>  If you call the getSummResult () method of this class, then in the server console, impleLogger.logAction will output: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ru.interceptorexample.Count <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> ru.interceptorexample.Count.getSummResult()</code> </pre><br>  Add another interceptor class. <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> LifeLogger { @AroundInvoke <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> logAll(InvocationContext context) throws <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println("LogAll object - " + context.getTarget()); <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println("LogAll method - " + context.getMethod()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.proceed(); } @PostConstruct <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> logCreate(InvocationContext context) throws <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println("create - " + context.getTarget().getClass().getClass); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.proceed(); } }</code> </pre><br>  And add another method to the class Count. <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMultiplyResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getFirstArgument() * getSecondArgument(); }</code> </pre><br>  And additionally mark the entire class annotation @Interceptors (LifeLogger.class). <br>  Now, when the getMultiplyResult method is called, first, when creating an instance of the Count class, the LifeLogger interceptor will output to the server console: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ru.interceptorexample.Count</code> </pre><br>  and then: <br><br><pre> <code class="hljs pgsql">LogAll <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ru.interceptorexample.Count LogAll <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> ru.interceptorexample.Count.getMultiplyResult()</code> </pre><br>  And if you call the getSummResult method, you first work out the LifeLogger interceptor, and then SimpleLogger and in the server console you get: <br><br><pre> <code class="hljs pgsql">LogAll <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ru.interceptorexample.Count LogAll <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> ru.interceptorexample.Count.getSummResult() <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ru.interceptorexample.Count <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> ru.interceptorexample.Count.getSummResult()</code> </pre><br>  Obviously, for practical tasks, it would be advisable to replace the output from the console with normal logging, for example, to use log4j, but I hope these examples were enough to understand how the interceptor mechanism works. <br><br>  Sources of information for those who want to learn more about the work of this mechanism: <br>  1. manuals from oracle.com <br>  2. EJB 3 in Action - Debu Panda, Reza Rahman, Derek Lane ISBN: 1-933988-34-7 <br><br>  Anyone can get the source codes in the form of a small simple web application from the github (the project was done under netbeans and glassfish, but I think it will not be difficult if you need to transfer it to another environment).  <a href="">github.com/tsegorah/JavaInterceptorsExample.git</a> </div><p>Source: <a href="https://habr.com/ru/post/146753/">https://habr.com/ru/post/146753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146746/index.html">Vertical Video Syndrome</a></li>
<li><a href="../146749/index.html">New version of HostCMS, 6 - what is it?</a></li>
<li><a href="../146750/index.html">File allocation system</a></li>
<li><a href="../146751/index.html">Where do you keep backups from remote servers?</a></li>
<li><a href="../146752/index.html">Broadcast Nokia Developer Days</a></li>
<li><a href="../146754/index.html">Cream IT R & D (issue 14) - About those who have an arrow on the fly and vice versa</a></li>
<li><a href="../146755/index.html">Sunset Mobile Flash: Android 4.1 does not receive Adobe certification</a></li>
<li><a href="../146756/index.html">GWT 2.5.0.RC1 is released</a></li>
<li><a href="../146758/index.html">JQuery 2.0 will not support IE 6/7/8</a></li>
<li><a href="../146760/index.html">Asus ZenBook Prime UX32VD Ultrabook Video Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>