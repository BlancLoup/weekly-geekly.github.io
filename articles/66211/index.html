<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ratings Service / Online service + REST API for searching movie ratings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ratings Service is an online service that allows you to find out the rating of a movie by its name. 



 Distinctive features: 


1. Search in several...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ratings Service / Online service + REST API for searching movie ratings</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://ratings-service.appspot.com/">Ratings Service</a> is an online service that allows you to find out the rating of a movie by its name. <br><br><img src="http://ratings-service.appspot.com/images/ratings-service.png" alt="image"><br><br>  Distinctive features: <br><ol><li>  Search in several Internet bases at the same time (at the moment it is KinoPoisk.ru and KinoKopilka.ru) </li><li>  easy interface;  can be used from a mobile phone, for example, through Opera Mini </li><li>  ability to receive sample results in XML format in REST style </li><li>  Google App Engine / Java Hosting </li><li>  Open source </li></ol><br>  I would like to talk about some of the features of the implementation and share my impressions of working with Google App Engine / Java.  Below you will also find the address of the project on Google Code, with the source codes laid out. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It took me three days to write the service and it was really fun.  It is fun, mainly because a lot doesn't work in GAE / Java, and some things had to be implemented from scratch, for example, to write a simple engine for XPath queries :) <br><br>  But first things first. <br><br><h3>  Development tools </h3><br>  According to the <a href="http://code.google.com/appengine/docs/java/gettingstarted/">Getting Started Guide</a> from the IDE, only Eclipse is currently officially supported, for this there is the Google Eclipse Plugin.  And three days ago only the version for Ganymede / 3.4 (I used it) was available, today the version for Galileo / 3.5 is already available. <br><br>  Creating a GAE Web Application project is as simple as creating a regular Java project in Eclipse.  Running and debugging the application works fine on the local machine.  In addition to this, deploying one button makes development just enjoyable. <br><br>  I also liked the nice little thing that the log4j.properties file was already in the project and configured as it should :) All I had to do was add the jar log4j to the classpath and enable debugging for my code: <br><br><pre> log4j.category.dmitrygusev.ratings = DEBUG, A1
</pre><br><br>  Of the negative points (I don‚Äôt know where to put it - more likely to Eclipse), deploy stopped working ( <a href="http://code.google.com/p/googleappengine/issues/detail%3Fid%3D1235">GAE Issue # 1235</a> ) on the third day, but this was quickly fixed. <br><br>  Another negative point is that the project directory structure in the GAE Web Application is different from the Maven2 directory structure.  It is clear that you can customize the Maven2 project under Google App Engine, but I would like to see Maven2 support right in the Google Eclipse Plugin. <br><br><h3>  Frameworks &amp; Libraries </h3><br>  As for frameworks and third-party libraries, most of them that really would be useful do not work in GAE / Java, mainly due to the fact that Google partially closed access to the Reflection API, as well as other APIs that could entail security risks. <br><br>  Most of all, this project lacked support for XML frameworks (at least JAXB) and XPath.  The standard Java XML API (DOM, SAX, StAX?) That is supported and which I used to use easily, now seems not very user friendly. <br><br>  As a result, I decided to stop at the NanoXML Lite library, which showed itself well in <a href="http://code.google.com/p/4konverta-mobile">the mobile client project</a> for the online service <a href="http://www.4konverta.com/">www.4konverta.com</a> . <br><br>  The entire NanoXML Lite API consists of a single <code>XMLElement</code> class.  Working with him is very simple, for example: <br><br><pre> XMLElement xml = new XMLElement ();
 xml.parseString ("&lt;xml attr = 'value'&gt; hello world &lt;/ xml&gt;");

 xml.getChildren ();  // Returns Children
 xml.getAttribute ("attr");  // Returns attribute value, etc.
</pre><br><br>  But there are two drawbacks that had to be fixed: <br><ol><li>  Initially, NanoXML Lite does not support Mixed Content, which is often found in xhtml; </li><li>  NanoXML Lite, like any other, does not support the essence <code>&amp;</code> <code>nbsp;</code>  which made it difficult to build a system of xhtml templates (see below). </li></ol><br><br>  I had to write XPath support myself (112 lines of formatted code), in my opinion it turned out quite well: <br><br><pre> @Test
 public void testXPathSlashInAttributeValue2 () {
	 XMLElement xml = XMLUtils.createElementFromString ("&lt;xml a = '.. / .. / .. / file.txt'&gt; &lt;value b = '0' /&gt; &lt;/ xml&gt;");
	
	 List &lt;XMLElement&gt; results = xml.find ("// [@ a = '.. / .. / .. / file.txt'] / value");
	
	 assertEquals (1, results.size ());
	 assertEquals ("0", results.get (0) .getAttribute ("b"));
 }
</pre><br>  As for the Web frameworks, at first I wanted to use Tapestry5, because I know it well, but since the latest version (5.1) is not supported, just because of the limitations of the XML parser, I decided to refuse it.  Those who are interested, the previous version - 5.0.18 - judging by the reviews, it works. <br><br>  As a result, I decided to abandon the Web framework altogether and do everything on the Servlet API.  To do this, I had to implement a couple of auxiliary classes that work with xml page templates, which were based on xhtml and modified NanoXML Lite. <br><br>  So, for example, the code for processing an index page (see figure) looks like this: <br><br><pre> private void responseWithQueryForm (HttpServletResponse resp) throws Error,
		 IOException {
	 XMLElement indexXml = TemplateLoader.loadTemplate ("index-template.htm", "UTF-8");
	 XMLElement queryFormXml = TemplateLoader.loadTemplate ("query-form-template.htm", "UTF-8");

	 ResultsXhtmlRender.fixCssLinks (indexXml);
		
	 XMLElement queryDiv = indexXml.findById ("query-form");
	 queryDiv.setContent (null);
	 queryDiv.addChild (queryFormXml);

	 resp.setContentType ("text / html");
	 resp.setCharacterEncoding ("UTF-8");
	
	 resp.getWriter (). println ("&lt;! DOCTYPE html PUBLIC \" - // W3C // DTD XHTML 1.0 Transitional // EN \ "\" http://www.w3.org/TR/xhtml1/DTD/xhtml1 -transitional.dtd \ "&gt;");
	 resp.getWriter (). println (indexXml.toString ());
 }
</pre><br><h3>  How things work </h3><br>  The scheme of the service is very simple. <br><br>  The query string entered by the user, the service, in turn, sends the KinoKopilka and KinoPoisk search engines (this is another GAE / Java restriction - multithreading cannot be used).  That is what explains that the request execution time takes 5-10 seconds.  In addition, data on ratings and some other details that are displayed in the search results are on other pages and are not displayed on the search pages of movie services, which also slows down the running time. <br><br>  For parsing HTML pages, GAE / Java provides <a href="http://code.google.com/appengine/docs/java/urlfetch/">URLFetchService</a> ‚Äî a fairly convenient API (I advise you to look at the Low-Level API section), built on top of the <a href="httpcomponents-client/">Apache HTTP Client</a> .  Apache HTTP Client itself refused to work on GAE / Java. <br><br>  Initially, I wanted to parse the results with my XML parser, but due to the fact that KinoKopilka and especially KinoPoisk produce non well formed xml, most parsing happens using regular expressions.  Why is the majority - because the xml KinoKopilka is almost correct, there is one extra closing tag (I hope to correct it :), now I put the missing opening tag in handles and use NanoXML Lite + SimpleXPathService.  (I didn‚Äôt just give a reference to xhtml / css validators at the end, I hope popular resources will use them sooner or later. It‚Äôs time for beginners to think about it now.) <br><br>  The result is the Movie and Rating object model (there are only two entity classes in the subject area) containing the results of the parsing. <br><br>  Further, depending on the required output format, this model is rendered either in xhtml format using a template system or using an xml render based on NanoXML Lite. <br><br>  Examples of the execution of search queries are presented in the figures below: <br><br><img src="http://ratings-service.appspot.com/images/ratings-service-search.png" alt="image"><br><br><img src="http://ratings-service.appspot.com/images/ratings-service-search-xml.png" alt="image"><br><br><h3>  Using </h3><br>  The service is available for public use, including the REST API, which you can freely use in your projects, as we do on <a href="http://planet33.ru/">planet33</a> , to receive additional information about the films. <br><br>  I also had plans to write a mobile client for this API, but I found another solution that suits me perfectly, namely the use of xhtml + <a href="http://dev.opera.com/articles/view/mobile-style-css-mobile-profile-2-0/">handheld CSS media type</a> minimal block layout, which allows using the service in Opera Mini on my Sony Ericsson. <br><br>  I also posted the <a href="http://code.google.com/p/ratings-service/source/checkout">source code of the project</a> for review on Google Code under the GPL license, I hope they will be useful for you and you will learn something new for yourself. <br><br>  The project structure is shown in the figure: <br><br><img src="http://ratings-service.appspot.com/images/ratings-service-eclipse.png" alt="image"><br><br>  There are several warnings in the project (Warnings) - this is the work of the Google Eclipse Plugin, it says that I deleted unused jars from the <code>WEB-INF/lib</code> daddy ... <br><br>  In order for you to have a search for ‚ÄúKinopoisk‚Äù, you need to add the <code>Config.properties</code> file to <code>src/dmitrygusev/ratings/utils/</code> with the following content: <br><br><pre> kinopoisk-username = your-kinopoisk-username
 kinopoisk-password = your-kinopoisk-password
</pre><br><br><h3>  Resources used </h3><br><ol><li>  Ratings Service on Google Code - <a href="http://code.google.com/p/ratings-service/">code.google.com/p/ratings-service</a> </li><li>  Google App Engine / Gettings Started: Java - <a href="http://code.google.com/appengine/docs/java/gettingstarted/">code.google.com/appengine/docs/java/gettingstarted</a> </li><li>  NanoXML Lite Sources - <a href="">prdownloads.sourceforge.net/nanoxml/NanoXML-2.2.1.tar.gz</a> </li><li>  Online CSS / XHTML validation from w3c, respectively, <a href="http://jigsaw.w3.org/css-validator/">jigsaw.w3.org/css-validator</a> and <a href="http://validator.w3.org/">validator.w3.org</a> </li><li>  CSS block layout - <a href="http://webmolot.com/css/">webmolot.com/css</a> </li><li>  Mobile style - CSS Mobile Profile 2.0 - <a href="http://dev.opera.com/articles/view/mobile-style-css-mobile-profile-2-0/">dev.opera.com/articles/view/mobile-style-css-mobile-profile-2-0</a> </li><li>  Feedback service Reformal.ru - reformal.ru </li><li>  FAMFAMFAM Silk Icons (set of icons in PNG format, see asterisk <img src="http://ratings-service.appspot.com/favicon.png" alt="image">  in favicon service) - <a href="http://www.famfamfam.com/lab/icons/silk/">www.famfamfam.com/lab/icons/silk</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/66211/">https://habr.com/ru/post/66211/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../66199/index.html">PayPal collapsed at noon</a></li>
<li><a href="../66204/index.html">Ruby - storing a piece of code in a database</a></li>
<li><a href="../66206/index.html">Performance Comparison of Windows 7, Windows Vista SP2 and Windows XP SP3</a></li>
<li><a href="../66209/index.html">QIP: dots over "i"</a></li>
<li><a href="../66210/index.html">And how did you choose your nickname,%% username?</a></li>
<li><a href="../66216/index.html">Nikon Coolpix S1000PJ: the first camera with a projector</a></li>
<li><a href="../66219/index.html">Braid will be released on the PlayStation 3</a></li>
<li><a href="../66220/index.html">KDE 4.3.0 released today!</a></li>
<li><a href="../66221/index.html">Clearing web pages of information noise</a></li>
<li><a href="../66225/index.html">MOESK: Star Wars rest or Chubais is gone - the ice has moved !!!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>