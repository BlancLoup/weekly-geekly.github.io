<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Once plywood, atmega, yes raspberry</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I am engaged in the design and development of layouts for the development of mathematical software. Layouts are mobile platforms (carts...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Once plywood, atmega, yes raspberry</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  I am engaged in the design and development of layouts for the development of mathematical software.  Layouts are mobile platforms (carts) of various configurations.  As a rule, carts perform one single function ‚Äî they carry the target equipment (scanning distance meter, video camera, laptop with a control system, etc.).  All carts have a complete solution and are made of metal or plastic and have on board a lower level control system responsible for controlling engines and collecting various information from sensors. <br><table><tbody><tr><td><img src="https://habrastorage.org/storage2/6f1/176/449/6f11764490ac18b0c649f7e01f16266e.jpg"></td><td><img src="https://habrastorage.org/storage2/144/857/cd6/144857cd6aeead79931bad320dccf3ac.jpg"></td></tr></tbody></table><br><a name="habracut"></a><br>  There are a number of significant problems with ready carts: <br><br><ol><li>  It is difficult to install the necessary equipment to perform the target task.  Often, in the process of work, the range of equipment used and its location may change.  Drilling, sawing and modifying the metal body is a very laborious process.  Scotch ordinary and double sided - ‚Äúour everything‚Äù, with all the ensuing consequences. </li><li>  Each trolley has its own control system that binds the developer to the hardware and control system and occupies a significant part of the programmer's precious time. </li><li>  The high cost of trucks and their components.  The inability to quickly purchase ready-made solutions and spare parts. </li></ol><br>  All this prompted a completely natural idea that we need a universal and not very expensive platform from components, as they say, from a nearby store, with the possibility of painless installation of arbitrary equipment with a simple and unified management interface.  The cart should be easy to manufacture and easy to assemble.  As a rule, there are no strict requirements for the layout, which is why it is a layout. <br><br><h4>  Concept. </h4><br>  As a result of brainstorming, the concept of a future platform was born: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Wheel formula 6 wheels, all leading.  To simplify the design active suspension is not required.  In this case, all the engines of the board are connected in parallel, which will allow in the future to make trucks with fewer wheels using a single control system. </li><li>  The trolley case is made of light material in processing, allowing relatively quickly to install the necessary equipment and carry out communications. </li><li>  Trolley control via UART or USB (virtual comport) - you can connect a laptop, single board computer, radio module. </li><li>  Gearboxes, wheels, electronics, batteries from the nearest suitable store. </li></ol><br><br>  Separately, I would like to mention a ready platform from POLOLU <a href="http://www.pololu.com/catalog/category/88">Dagu Wild Thumper All-Terrain Chassis</a> . <br><img src="https://habrastorage.org/storage2/04d/d3b/02d/04dd3b02d58ceb87075417fb2b1ec610.jpg"><br>  Under our concept, this platform could not be better, even the presence of a metal case was compensated by a large number of mounting holes, the installation of the equipment did not cause any problems.  But upon closer acquaintance, there were significant design flaws.  The main and key point is the articulation of the wheel and the motor-reducer, which does not hold water. <br><br><img src="https://habrastorage.org/storage2/66a/70d/766/66a70d766348cd9d3e32ea21d6d8d610.jpg"><br><br>  The main load falls on the sliding bearing in which the output shaft of the motor-reducer rotates and with prolonged use and intense loads this node is guaranteed to fail. <br><br><img src="https://habrastorage.org/storage2/663/4bd/fda/6634bdfda0d635cebfce2f3f99cbc782.jpg"><br><br>  The second point is the shaft-wheel adapter, this element is made of brass and sits on the shaft with a large backlash, not rarely during tests, one of the wheels flew off the shaft during movement. <br><br>  As a summary, I want to say that as a platform for solving our problems, Dagu Wild Thumper is not suitable. <br><br>  But as they say, every cloud has a silver lining.  <a href="http://www.pololu.com/catalog/product/2275">The gearmotors</a> and the <a href="http://www.pololu.com/catalog/product/1557">wheels</a> of this carriage are quite suitable as components, it is only necessary to design and manufacture a reliable bearing block with an axle, which will take over the entire load. <br><br><h4>  Platform. </h4><br><h5>  Motor wheel. </h5><br>  The bearing block was manufactured on the production base of the institute. <br><br><img src="https://habrastorage.org/storage2/bbe/e90/186/bbee901867194b8896bf3db634f2b826.jpg"><br><br>  Two bearings are pressed into the block housing, an axis with an annular retainer, an adapter motor-reducer. <br><br><img src="https://habrastorage.org/storage2/533/2a7/383/5332a7383ce922e47419d2f4038c7564.jpg"><br><br><img src="https://habrastorage.org/storage2/959/e70/004/959e700042b756919fc4ad8b55c6c345.jpg"><br><br><img src="https://habrastorage.org/storage2/107/b60/373/107b6037372625cafc125e3597213d22.jpg"><br><br><img src="https://habrastorage.org/storage2/1d0/d6b/d45/1d0d6bd451db24354cbd85a46b3f4df4.jpg"><br><br>  The wheel and gear motor from the parent carriage Dagu Wild Thumper. <br><br>  The block turned out to be a very reliable unit capable of withstanding serious loads.  The only thing and probably very significant but: the production of this site requires a CNC milling machine and a qualified specialist.  In the photos, the motor has an incremental encoder on the shaft. <br><br><h5>  Housing </h5><br>  The optimal material for the body, after some hesitation, was (surprise, surprise) plywood.  The drawing, abundantly equipped with stiffening ribs, after some time acquired a material appearance. <br><br><img src="https://habrastorage.org/storage2/f66/1bd/1a8/f661bd1a83f1bd6ae94353ce1026f1cd.jpg"><br><br><img src="https://habrastorage.org/storage2/0e2/746/978/0e274697873b477d057a5fb01677e2b5.jpg"><br><br>  With the availability of laser cutting of sheet materials, the manufacture of a whole batch of such cases was not difficult and costly.  Drilling, sawing, screwing a variety of equipment and other modifications of this case (long live PVA glue and screws screws) do not pose any difficulties. <br><br><h5>  Platform assembly. </h5><br><img src="https://habrastorage.org/storage2/b46/211/86a/b4621186ad4aae37364cc2635224a0aa.jpg"><br><br>  The body is painted with spray paint.  Medium-sized engines include incremental encoders to count the number of revolutions.  Motor connectors are standard for radio-controlled models. <br><br><h4>  Lower level control system. </h4><br>  The control system has the same requirements as a trolley: the availability of components and ease of manufacture.  Ready solutions for managing collector motors weight.  The same POLOLU has many suitable options, but there is an important point - you need one ‚ÄúUSB cord‚Äù for the whole system. <br><br>  I have been friends with ATMEL controllers and assembler for a long time, making a small PCB is not a problem either.  To simplify the design and manufacture of the board, I use ready-made microprocessor modules.  As the module was used ARDUINO Nano Atmega328.  The module is small and on its board, in addition to the processor, there is an FT232RL chip, which provides USB communication, the so-called virtual com port.  All that connected him with his former life was erased from the insides (may arduinschiki forgive me) and a printed circuit board was made with the necessary strapping and a new firmware was flooded. <br><br><img src="https://habrastorage.org/storage2/a32/23d/dab/a3223ddab3ba9969925a84491a35c2ec.jpg"><br><br>  The scheme includes: <br><br><ol><li>  ARDUINO Mini Atmega328 microprocessor module with USB interface. </li><li>  Two N-bridges on power transistors with PWM control. </li><li>  Current sensor and voltage sensor for monitoring the discharge of Li-Po batteries. </li><li>  LEDs for indicating the operating modes of the system. </li><li>  Connectors for external power supply and motors. </li><li>  Connectors for incremental encoder engines. </li><li>  Connectors for connecting analog sensors connected to the inputs of the ADC controller. </li><li>  UART interface connector. </li></ol><br>  The firmware is written in assembler and is a command processor, i.e., a text command comes along with UART (USB) with parameters, the controller processes and executes it (for example: to give the starboard engines 25% of the nominal voltage), in the opposite direction sends encoder values, battery voltage, ADC readings, etc. <br><br>  As a result, we have a UART (USB) trolley control channel through which text control commands are sent and we get response lines, including telemetry and service data.  A wide range of devices fits in with this interface, ranging from radio modems (X-Bee) to tablet computers.  I will not dwell on the control system in more detail, since this is the topic of a separate article.  But about one of the devices connected via UART as a top-level control system, I will discuss further. <br><br><h4>  Raspberry, it is the top level control system. </h4><br>  Of course we are talking about the Raspberry Pi.  Affordable, inexpensive, compact, Linux is the same.  On board there is everything, and what is not connected via USB. <br><br>  Trolley control algorithms can be programmed directly on the trolley itself using a modern graphical interface.  Just plug in the monitor and keyboard.  <s>Fiddler</s> computer is not needed!  In this case, it is possible to program a lower level controller from a raspberry; it is enough to connect a programmer, appropriate compilers and the development environment available. <br><br><h5>  We join raspberry and arduin. </h5><br>  On the GPIO connector of the raspberry there is a UART, I2C, SPI, + 5V power supply and just feet. <br><br><img src="https://habrastorage.org/storage2/172/5e3/682/1725e3682f122313d5f8ccd38b05c4ad.jpg"><br><br>  We connect our <s>Arduino</s> low-level control system to the rapberry pin UART.  The only thing is: raspberry 3.3 volts, and the microcontroller provides 5 volts logic, without an adapter with the <a href="http://we.easyelectronics.ru/Shematech/soglasovanie-logicheskih-urovney-5v-i-33v-ustroystv.html">coordination of logical levels is</a> not enough.  And if it is necessary to fence a certain adapter fee, that is, it makes sense to use other GPIO pins. <br>  To leave the i2c bus free at the height of waste, when in nature there is a huge number of sensors with a connection on this bus.  As a result, a wonderful <a href="https://www.sparkfun.com/products/10252">device</a> with a gyroscope and an accelerometer, a full-fledged navigation module, is installed on the adapter board.  The power supply of the raspberry is carried out through the Micro USB connector, which is not very convenient, since the connector itself is hlipkovat and is not always at hand, as a result, an external power supply connector + 5V is connected to the adapter. <br><br><img src="https://habrastorage.org/storage2/0e6/1d8/ebe/0e61d8ebe3e5b2a29a62f7de9b73357f.jpg"><br><br><img src="https://habrastorage.org/storage2/0cc/acd/6f5/0ccacd6f5eb81fe694a3ff7aff0c3f12.jpg"><br><br>  The adapter card is designed so that everything fits into the plastic case, and the pins UART and power supply + 5V are brought out <br><br><img src="https://habrastorage.org/storage2/553/2f6/2b6/5532f62b6dd46e2565e2e574a7ed9066.jpg"><br><br>  Separately, I want to mention the power of raspberries, it is strictly limited to 5 volts coming from the USB connector, the decision is controversial, but nothing can be done.  For this purpose, I use the <a href="http://www.hobbyking.com/hobbyking/store/__15212__HobbyKing_Micro_UBEC_3A_5v.html">BEC</a> stabilizer used in amateur radio models, it has a small size, power (3A) is enough with a large margin and fully meets our requirements. <br><br><img src="https://habrastorage.org/storage2/703/ee5/ed3/703ee5ed3a89cd9ad6c15e88e1b01360.jpg"><br><br><h4>  Full body kit. </h4><br><img src="https://habrastorage.org/storage2/bbe/483/e47/bbe483e471e86f6a302c6b6a4ec38fb6.jpg"><br><br><ol><li>  Lower level control system based on Atmega328 controller. </li><li>  Geared motors with incremental encoders (left and right side) </li><li>  IR distance sensors SHARP GP2Y0A02YK0F with analog output </li><li>  Li-Po battery 7.4V </li><li>  Power supply 5V. </li><li>  Top-level management system based on Raspberry Pi </li><li>  UART adapter and i2c navigation module in the Raspberry Pi. </li><li>  USB Wi-Fi module. </li><li>  USB WEB camera. </li></ol><br><br>  The story of what comes freedom for creativity with a Wi-Fi cart with Linux on board and a bunch of all sorts of buns is clearly beyond the scope of this article.  With this part, I think everything is clear. <br><br><h4>  Result. </h4><br><img src="https://habrastorage.org/storage2/8aa/17f/51a/8aa17f51a65740c9d9177f8fc596802f.jpg"><br><br>  In conclusion, I want to say that the task was solved.  We have a cart with a body that is ‚Äúnot sorry‚Äù from inexpensive components.  The only exception is the bearing unit, but this is the price for reliability and capacity, the cart can carry very heavy equipment.  The control system of the lower level is easily scaled by the number of engines and the range of connected sensors, as well as integrates easily with the high-level system: Raspberry Pi (UART) or laptop (USB).  Raspberry Pi <s>can do everything</s> as a top-level control system allows you to connect a whole bunch of useful equipment and <s>really can</s> work with this equipment, a C compiler and a graphical gourmet shell included. </div><p>Source: <a href="https://habr.com/ru/post/175889/">https://habr.com/ru/post/175889/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175877/index.html">Hakyll for beginners</a></li>
<li><a href="../175881/index.html">"Human" entropy for a random number generator</a></li>
<li><a href="../175883/index.html">Facebook Game On in Moscow on April 15</a></li>
<li><a href="../175885/index.html">As I once taught programming not everything</a></li>
<li><a href="../175887/index.html">Get rid of code repetition with DRY CRUD</a></li>
<li><a href="../175895/index.html">Centralized configuration of the lock screen and operating system power plan</a></li>
<li><a href="../175897/index.html">FullHD Butterfly Review: HTC Butterfly</a></li>
<li><a href="../175899/index.html">Script for receiving information from remote unix-like servers</a></li>
<li><a href="../175911/index.html">Win32 / Gapz: the last episode</a></li>
<li><a href="../175913/index.html">How accurate is the demographic targeting of Google?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>