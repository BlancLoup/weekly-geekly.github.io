<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IPSec between Cisco ISR and RUH2 3G router using dynamically allocated IP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task. It is necessary to organize data exchange with remote networks, without resorting to the service of a cellular operator (hereinafter referred to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IPSec between Cisco ISR and RUH2 3G router using dynamically allocated IP</h1><div class="post__text post__text-html js-mediator-article"> Task.  It is necessary to organize data exchange with remote networks, without resorting to the service of a cellular operator (hereinafter referred to as OpSoS) ‚ÄúStatic white IP‚Äù, due to its high cost. <br><br>  The diagram is shown in the following figure: <br><img src="https://hsto.org/webt/59/e3/8b/59e38bb4ca7d1774450922.jpeg" alt="image"><br><br>  It is worth noting that the <a href="http://www.radiofid.ru/catalog/besprovodnaya-svyaz/routery/3g-routery/router-irz-ruh2-hsupa-hsdpa-umts-edge-gprs-3g/">RUH2</a> router (manufactured by the Radiofid system company) is currently out of production, but since  several of these routers are already involved in the organization of data exchange, I decided to optimize their work. <br><a name="habracut"></a><br>  The router is based on Linux OS and for IPSec tunnels it has a Racoon module, which is configured via the web interface. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The enterprise LAN has a Cisco router (in my case CISCO1921 / K9) with a static external address (abcd). <br><br>  For RUH2 devices, OpSoC issues dynamic addresses, each time a connection is established, it is not possible to know in advance from which address the connection will be established.  Moreover, when restarting the router, this address is likely to be different. <br><br>  In an IPSec session, device authentication can be performed using predefined keys, but since it is not known in advance what address the device will contact, it is necessary to write a line in the router like this: <br><br> <code>crypto isakmp key cisco123 address 0.0.0.0 0.0.0.0 no-xauth</code> <br> <br>  Those.  the key is valid for all addresses, and this is not safe, since if a key is compromised, an attacker can set up an encrypted channel and gain access to the enterprise network. <br><br>  In this case, it is recommended to use X.509 certificates.  It is necessary to configure a certificate authority on the router that will issue certificates for RUH2 routers.  Strictly speaking, a certification authority may not necessarily be on a CISCO router, the main thing is for this center to issue certificates to devices for establishing a connection.  Details on setting up a certification authority on CISCO routers can be found <a href="http://xgu.ru/wiki/%25D0%25A6%25D0%25B5%25D0%25BD%25D1%2582%25D1%2580_%25D1%2581%25D0%25B5%25D1%2580%25D1%2582%25D0%25B8%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2582%25D0%25BE%25D0%25B2_%25D0%25BD%25D0%25B0_%25D0%25BC%25D0%25B0%25D1%2580%25D1%2588%25D1%2580%25D1%2583%25D1%2582%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580%25D0%25B5_Cisco">here</a> . <br><br>  To establish a connection on the router, you must configure the trustpoint, which will be issued a certificate by a certification authority.  In enable mode, type the following command: <br><br> <code>ESKO-main-gw(config)#crypto key generate rsa general-keys label VPN-key modulus 2048</code> <br> <br>  Where VPN-key is the name of the key pair to be used at the trustpoint, modulus 2048 is the key dimension. <br><br>  Next, configure the trustpoint, give the command: <br><br> <code>R1(config)#crypto pki trustpoint VPN-esko</code> <br> <br>  Next, the router enters the trustpoint configuration mode, in this mode we give the following commands: <br><br> <code>enrollment url http://abcd:80</code> <br> <br>  The path to the certification authority to request a certificate and to check the list of revoked certificates. <br><br> <code>serial-number none</code> <br> <br>  Do not include the serial number of the router in the certificate. <br><br> <code>fqdn none</code> <br> <br>  Do not include a custom domain name in the certificate. <br><br> <code>ip-address none</code> <br> <br>  Do not include the router's IP address in the certificate. <br><br> <code>subject-name cn=ESKO-main-gw.esko.local,o=esko,l=spb,c=ru</code> <br> <br>  The subject name of the certificate is specified according to the X.500 format.  Description of some fields: <br><br>  CN: Common Name - arbitrary name <br>  O: Organization - the name of the organization <br>  L: Location - location, city <br>  C: Country - Country <br><br> <code>revocation-check crl</code> <br> <br>  Method for checking the list of revoked certificates. <br><br> <code>crl cache delete-after 5</code> <br> <br>  How quickly you need to clear the cache after checking the list of revoked certificates. <br><br> <code>rsakeypair VPN-key</code> <br> <br>  The name of the key pair to use. <br><br>  After these settings have been entered, it is necessary to exit the configuration mode of the trustpoint into the global configuration mode (exit) and give the command: <br><br> <code>R1(config)#crypto pki authenticate VPN-esko</code> <br> <br>  The CISCO router will request the root certificate of the certification server and will offer to confirm: <br><blockquote>  Certificate has the following attributes: <br>  Fingerprint MD5: 4CDFCBCA 7807C4C9 5B054FA5 329301DB <br>  Fingerprint SHA1: E0E35CC8 75C3639C 445D12D8 4BA298AB 2E4E7004 <br>  % Do you accept this certificate?  [yes / no]: </blockquote><br>  We answer yes, cisco will confirm that the root certificate is accepted: <br><blockquote>  Trustpoint CA certificate accepted. </blockquote><br>  Next, we will request the server to issue us a certificate: <br><br> <code>R1(config)#crypto pki enroll VPN-esko</code> <br> <br><blockquote>  % Start certificate enrollment ... <br>  % Create a challenge password.  You will need to verbally provide this <br>  password for your certificate. <br>  For security reasons your password will not be saved in the configuration. <br>  Please make a note of it. <br><br>  Password: <br>  Re-enter password: <br><br>  % Cc = ESKO-main-gw.esko.local, o = esko, l = spb, c = ru <br>  % The fully qualified domain name is not included in the certificate <br>  Request certificate from CA?  [yes / no]: yes <br>  % Certificate request sent to Certificate Authority <br>  % The 'show crypto pki certificate verbose VPN-esko' commandwill show the fingerprint. </blockquote><br>  During the request process, the router will request a password for the certificate and request confirmation.  Enter the password (optional) and confirm the creation of the request. <br>  After that, a request will appear on the certification server: <br><blockquote>  * Oct 15 13: 53: 45.367: CRYPTO_PKI: Certificate Request Fingerprint MD5: F70432EB 59E791A6 48F301C4 B59C67EB <br>  * Oct 15 13: 53: 45.371: CRYPTO_PKI: Certificate Request Fingerprint SHA1: 18AA1D1A 1DD7BED2 FEA666FF 1D32F8BA B559FA07 </blockquote><br>  You can view the request on the certification server (if it is on CISCO) with the following command: <br><br> <code>R1#sh crypto pki server CA-esko</code> <br> <br><blockquote>  Enrollment Request Database: <br>  Subordinate CA certificate requests: <br>  ReqID State Fingerprint SubjectName <br>  - RA certificate requests: <br>  ReqID State Fingerprint SubjectName <br>  - Router certificates requests: <br>  ReqID State Fingerprint SubjectName <br>  - 1 pending F70432EB59E791A648F301C4B59C67EB cn = ESKO-main-gw.esko.local, o = esko, l = spb, c = ru <br></blockquote><br>  To confirm the issuance of a certificate, you must issue the following command: <br><br> <code>R1#crypto pki server CA-esko grant 1</code> <br> <br>  After a while, trustpoint will automatically receive the issued certificate: <br><blockquote>  * Oct 15 14: 03: 01.303:% PKI-6-CERTRET: Certificate received from Certificate Authority </blockquote><br>  The next step is to issue a certificate to the RUH2 router, signed by the same certification authority. <br><br>  Unlike CISCO, RUH2 is not able to automatically automatically request a certificate, so we‚Äôll do it manually. <br><br>  For all manipulations when creating a certificate for a router, I use the library utility OpenSSL. <br><br>  First, create a private key: <br><br> <code>C:\OpenSSL\bin&gt;Openssl genrsa -out c:\keys\private.key 2048</code> <br> <br><blockquote>  Generating RSA private key, 2048 bit long modulus <br>  .................................................. .......... +++ <br>  .................................................. .................................................. .................................................. ........... +++ <br>  e is 65537 (0x10001) </blockquote><br>  The file private.key appeared in the c: \ keys folder with the following contents: <br><blockquote>  ----- BEGIN RSA PRIVATE KEY ----- <br>  MIIEogIBAAKCAQEAz1vjlthggHHmSBWVgcNf7aDDGPgik9xKZuJjEBgREr8x5RUa <br>  ... <br>  GzmSg7cOhrzzTBWOUqTggMD5uKV4Cgei3cA + TKRXv2dRjfVCL3s = <br>  ----- END RSA PRIVATE KEY ----- </blockquote><br>  Further, on the basis of this key, we will create a request to a certification authority: <br><br> <code>C:\OpenSSL\bin&gt;openssl.exe req -new -key c:\keys\private.key -out c:\keys\request.csr <br></code> <br><br>  The OpenSSL utility will ask a series of questions regarding this certificate: <br><blockquote>  You are included <br>  into your certificate request. <br>  What is a Distinguished Name or a DN? <br>  You can leave some blank <br>  For some fields there will be a default value, <br>  If you enter '.', The field will be left blank. <br>  - Country Name (2 letter code) [RU]: <br>  State or Province Name (full name) []: <br>  City [SPB]: <br>  Organization Name (eg, company) [ESKO]: <br>  Organizational Unit Name (eg, section) []: <br>  Common Name []: RUH2.esko.local <br>  email []: <br><br>  Please enter the following extra attributes <br>  to be sent with your certificate request <br>  A challenge password []: <br>  An optional company name []: <br></blockquote><br>  These fields are analogous to the fact that in cisco we set the subject in the trustpoint with the subject-name command. <br>  After entering the values ‚Äã‚Äãin the c: \ keys folder, a certificate request file appears as follows: <br><blockquote>  ----- BEGIN CERTIFICATE REQUEST ----- <br>  MIICiTCCAXECAQAwRDELMAkGA1UEBhMCUlUxDDAKBgNVBAcMA1NQQjENMAsGA1UE <br>  ... <br>  Q3H / EtMGltY1QS / 9DsEnta + k7oCKPTeei3S2v9Y = <br>  ----- END CERTIFICATE REQUEST ----- </blockquote><br>  You need to copy it to the clipboard, and on the CISCO, where the certification authority is running, enter the command: <br><br> <code>R1#crypto pki server CA-esko request pkcs10 terminal <br></code> <br>  CISCO will issue a request <br><blockquote>  PKCS10 request in base64 or pem <br><br>  % Enter Base64 encoded or PEM formatted PKCS10 enrollment request. <br>  % End with a blank line or "quit" on a line by itself. </blockquote><br>  Next, you need to copy the request from the clipboard, at the end type quit <br>  Now you can see the created query: <br><br> <code>R1#sh crypto pki server CA-esko requests</code> <br> <br><blockquote>  Enrollment Request Database: <br><br>  Subordinate CA certificate requests: <br>  ReqID State Fingerprint SubjectName <br>  - RA certificate requests: <br>  ReqID State Fingerprint SubjectName <br>  - Router certificates requests: <br>  ReqID State Fingerprint SubjectName <br>  - 2 pending 4468493FA262890CC75EEF18AC5AF6DF cn = RUH2.esko.local, o = ESKO, l = SPB, c = RU <br></blockquote><br>  We will see a query with fields defined by the OpenSSL utility. <br>  Confirm the issuance of a certificate for this request, the router will immediately issue it to us in the terminal window: <br><br> <code>R1#crypto pki server CA-esko grant 2</code> <br> <br><blockquote>  % Granted certificate: <br>  ----- BEGIN CERTIFICATE ----- <br>  MIIEQjCCAiqgAwIBAgIBAzANBgkqhkiG9w0BAQQFADBBMQswCQYDVQQGEwJydTEM <br>  ... <br>  jhHvAo / 0oVfLPZ9dPdj9Y1efawXI4a / zGf0GTmEi + v7d8Psl9Wk = <br>  ----- END CERTIFICATE ----- </blockquote><br>  You need to copy the certificate to the clipboard and save it to a file.  Attention: you need to copy everything, including the first and last lines, in which BEGIN CERTIFICATE and END CERTIFICATE are written. <br>  You also need to request your own trustpoint certificate (in global configuration mode): <br><br> <code>R1(config)#crypto pki export VPN-esko pem terminal</code> <br> <br><blockquote>  % CA certificate: <br>  ----- BEGIN CERTIFICATE ----- <br>  MIIFYDCCA0igAwIBAgIBATANBgkqhkiG9w0BAQQFADBBMQswCQYDVQQGEwJydTEM <br>  ... <br>  uQVU8GLro73NQ9Jo2JXt2qfZY9SFsomiqJugxReyM4umZ9oX <br>  ----- END CERTIFICATE ----- <br><br>  % General Purpose Certificate: <br>  ----- BEGIN CERTIFICATE ----- <br>  MIIEVzCCAj + gAwIBAgIBAjANBgkqhkiG9w0BAQUFADBBMQswCQYDVQQGEwJydTEM <br>  ... <br>  a0G + T + rXEYq2ywc = <br>  ----- END CERTIFICATE ----- <br></blockquote><br>  The router will issue the root certificate of the certification server and the trustpoint certificate.  Each must be saved in a separate file. <br><br>  Next, on the router with which you need to establish a connection (and where the trustpoint is configured), configure ipsec. <br><br>  Everything is done in global configuration mode. <br><br>  Set up the 1st phase: <br><br> <code>crypto isakmp policy 30 <br> encr aes <br> hash sha256 <br> group 14 <br> lifetime 3600 <br> authentication rsa-sig</code> <br> <br>  The last command sets the type of certificate authentication, it acts by default and may not be displayed when viewing the configuration on the CISCO. <br><br>  Create a certificate card.  It is necessary to accept connections from devices with certain attributes of certificates: <br><br> <code>crypto pki certificate map RUH2-cert-map 10 <br> subject-name co ruh2.esko.local</code> <br> <br>  The last line says that only certificates containing the string ruh2.esko.local correspond to this certificate card. <br><br>  Create an isakmp profile. <br><br> <code>crypto isakmp profile RUH2-isapr <br> self-identity address <br> ca trust-point VPN-esko <br> match certificate RUH2-cert-map <br> local-address GigabitEthernet0/0</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Description of the commands used</b> <div class="spoiler_text"> <code>self-identity address</code> <br> <br>  The router ID will be the IP address. <br><br> <code>ca trust-point VPN-esko</code> <br> <br>  Trustpoint used for authentication <br><br> <code>match certificate RUH2-cert-map</code> <br> <br>  Indicates a certificate map to determine the devices with which to establish a connection. <br><br> <code>local-address GigabitEthernet0/0 <br></code> <br><br>  Clarifying command to determine the IP address of the CISCO router <br></div></div><br>  Next, configure the 2nd phase: <br><br> <code>R1(config)#crypto ipsec transform-set RUH2-ts esp-aes esp-sha-hmac <br> R1 (cfg-crypto-trans)#mode tunnel</code> <br> <br>  The last command sets the tunnel mode and is the default command. It may not be displayed when viewing the router configuration. <br><br>  Now create a dynamic crypto map: <br><br> <code>crypto dynamic-map RUH2-dyncm 1000 <br> set security-association lifetime seconds 28800 <br> set transform-set RUH2-ts <br> set pfs group2 <br> set isakmp-profile RUH2-isapr <br> reverse-route</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Description of the commands used</b> <div class="spoiler_text">  set security-association lifetime seconds 28800 <br>  Establishing the lifetime of the session of the 2nd phase, i.e.  how often the encryption key will change. <br><br> <code>set transform-set RUH2-ts</code> <br> <br>  Indicates transform-set, i.e.  how to encrypt traffic <br><br> <code>set pfs group2</code> <br> <br>  For more security.  Not mandatory.  Indicates an additional encryption key generation mode. <br><br> <code>set isakmp-profile RUH2-isapr</code> <br> <br>  Indicates which isakmp profile to use. <br><br> <code>reverse-route</code> <br> <br>  An important team.  The router will add a route to the routing table to send packets to the remote network. <br></div></div><br>  Now let's link the dynamic crypto map to the static one: <br><br> <code>R1(config)#crypto map ISP-statcm 500 ipsec-isakmp dynamic RUH2-dyncm <br></code> <br><br>  And apply a static crypto card on the interface that looks towards the Internet: <br><br> <code>R1(config)#interface GigabitEthernet0/0 <br> R1(config-if)#crypto map ISP-statcm</code> <br> <br>  The configuration of the cisco router is over.  Getting started configuring RUH2.  To do this, go to the web interface of the router, in the Configuration section, then in the IPSec section. <br><br>  The settings are as follows: <br><br><img src="https://habrastorage.org/webt/59/e3/98/59e39809b465e733500088.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Description of the fields specified in the router</b> <div class="spoiler_text">  Description <br>  The name of the tunnel.  Maybe any. <br><br>  Remote IP Address <br>  Address of the CISCO remote router. <br><br>  Remote Subnet and Remote Subnet Mask <br>  Indicates the traffic for which network will be sent to the tunnel. <br><br>  Local Subnet and Local Subnet Mask <br>  This information RUH2 transmits to a remote CISCO router, so that he understands what traffic should be sent to the tunnel. <br><br>  Key Lifetime (sec) <br>  The key's ‚Äúlifetime‚Äù is what the CISCO is set by the parameter set security-association lifetime seconds. <br><br>  IKE Lifetime (sec) <br>  The lifetime of the 1st phase (isakmp), what on CISCO is set by the lifetime parameter in the isakmp policy. <br><br>  NAT Traversal <br>  Enables the NAT-T mode, which is required if RUH2 works for the OPCoC NAT. <br><br>  Authenticate Mode <br>  Authentication method.  Select the mode of X.509 certificates. <br><br>  Verify Certificate <br>  Certificate verification mode.  Need to disable.  Otherwise, RUH2 gives errors about the absence of the AltSubjectName field, and it can be specified in CISCO only in the self-signed trustpoint.  In turn, you cannot use self-signed trustpoint, because  it is necessary that all certificates were issued by one certificate authority. <br><br>  Encryption Algorythm <br>  Hash algorythm <br>  DH Group <br>  The settings of the 1st phase on RUH2, should coincide with the settings of the isakmp policy in CISCO. <br><br>  Encryption Algorythm <br>  Authentication Algorythm <br>  PFS Group <br>  The settings for Phase 2 on RUH2 should match the settings of the transform-set and pfs group in the CISCO. <br><br>  My Identifier Type <br>  Indicates how to identify RUH2 on the remote side, does not matter, because  There is a certificate verification. <br><br>  Peers Identifier Type <br>  Indicates how to identify the remote side.  Use the IP address of the CISCO router. <br><br>  Verify Identifier <br>  Indicates whether to validate the remote side.  Can be enabled for more security. <br><br>  Ping Test IP and Ping Test Interval (min) <br>  It is important to include, because  A tunnel is created if there is traffic, and CISCO cannot initiate a connection if there is traffic on the network, because  RUH2 has a dynamic IP address. <br><br>  CA Certificate <br>  The certificate of the certificate authority must be copied from the saved file. <br><br>  Remote Certificate <br>  The trustpoint certificate of the remote router must be copied from the saved file. <br><br>  Local Certificate <br>  Certificate RUH2 issued by a certificate authority must be copied from a saved file. <br><br>  Local private key <br>  The private key must be copied from the saved file. <br></div></div><br>  After setting the settings, click Apply and check the established connection. <br><br>  Check the 1st phase. <br><br>  On CISCO we give the command <br><br> <code>R1#sh crypto isakmp sa</code> <br> <br>  Among other things you can see: <br><blockquote>  abcd 188.170.72.35 QM_IDLE 1014 ACTIVE </blockquote><br>  In my case, RUH2 is visible from the Internet under the address 188.170.72.35. <br><br>  Checking the 2nd phase <br><br> <code>R1#sh crypto ipsec sa interface g0/0</code> <br> <br><div class="spoiler">  <b class="spoiler_title">results</b> <div class="spoiler_text"><blockquote>  interface: GigabitEthernet0 / 0 <br>  Crypto map tag: ISP-statcm, local addr abcd <br><br>  protected vrf: (none) <br>  local ident (addr / mask / prot / port): (192.168.1.0/255.255.255.0/0/0) <br>  remote ident (addr / mask / prot / port): (172.16.0.0/255.255.255.128/0/0) <br>  current_peer 188.170.72.35 port 48015 <br>  PERMIT, flags = {} <br>  #pkts encaps: 133, #pkts encrypt: 133, #pkts digest: 133 <br>  #pkts decaps: 135, #pkts decrypt: 135, #pkts verify: 135 <br>  #pkts compressed: 0, #pkts decompressed: 0 <br>  #pkts not compressed: 0, #pkts compr.  failed: 0 <br>  #pkts not decompressed: 0, #pkts decompress failed: 0 <br>  #send errors 0, #recv errors 8 <br><br>  local crypto endpt .: abcd, remote crypto endpt .: 188.170.72.35 <br>  path mtu 1500, ip mtu 1500, ip mtu idb GigabitEthernet0 / 0 <br>  current outbound spi: 0xEC8D5EF (248042991) <br>  PFS (Y / N): Y, DH group: group2 <br><br>  inbound esp sas: <br>  spi: 0x1231809D (305234077) <br>  transform: esp-aes esp-sha-hmac, <br>  in use settings = {Tunnel UDP-Encaps,} <br>  conn id: 2019, flow_id: Onboard VPN: 19, sibling_flags 80000046, crypto map: ISP-statcm <br>  sa timing: remaining key lifetime (k / sec): (4506190/27680) <br>  IV size: 16 bytes <br>  replay detection support: Y <br>  Status: ACTIVE <br><br>  inbound ah sas: <br><br>  inbound pcp sas: <br><br>  outbound esp sas: <br>  spi: 0xEC8D5EF (248042991) <br>  transform: esp-aes esp-sha-hmac, <br>  in use settings = {Tunnel UDP-Encaps,} <br>  conn id: 2020, flow_id: Onboard VPN: 20, sibling_flags 80000046, crypto map: ISP-statcm <br>  sa timing: remaining key lifetime (k / sec): (4506229/27680) <br>  IV size: 16 bytes <br>  replay detection support: Y <br>  Status: ACTIVE <br><br>  outbound ah sas: <br><br>  outbound pcp sas: <br><br>  Checking the routing table: <br>  R1 # sh ip route <br>  Among other things, there are such lines: <br>  172.16.0.0/25 is subnetted, 1 subnets <br>  S 172.16.0.0 [1/0] via 188.170.72.35 <br></blockquote></div></div><br>  Check ping: <br><br> <code>R1#ping 172.16.0.1 source g0/1</code> <br> <br><blockquote>  Type escape sequence to abort. <br>  Sending 5, 100-byte ICMP Echos to 172.16.0.1, timeout is 2 seconds: <br>  Packet sent with a source address of 192.168.1.1 <br>  !!! <br>  Success rate is 100 percent (5/5), round-trip min / avg / max = 324/357/388 ms <br></blockquote><br>  For ping use the internal interface, looking in the building.  network. <br><br>  This completes the configuration of the routers. <br><br>  PS: Naturally, to pass IPSec traffic on the external interface, the appropriate protocols must be allowed and the ports open.  In my case, this is done using the following access-list: <br><br> <code>ip access-list extended IPSEC-acl <br> permit esp any any <br> permit ahp any any <br> permit udp host abcd eq isakmp any <br> permit udp host abcd eq non500-isakmp any <br> permit udp any host abcd eq isakmp <br> permit udp any host abcd eq non500-isakmp <br></code> </div><p>Source: <a href="https://habr.com/ru/post/340340/">https://habr.com/ru/post/340340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340326/index.html">So iron and so nameless</a></li>
<li><a href="../340330/index.html">Development for Sailfish OS: Work with Bluetooth</a></li>
<li><a href="../340332/index.html">Theoretical informational approach to the analysis of sales funnel in contextual advertising</a></li>
<li><a href="../340336/index.html">HR-hack - a joint hackathon from Alfa-Bank, Unilever, Leroy Merlin, CRIC and Beeline</a></li>
<li><a href="../340338/index.html">Magento Dare to Share. Autumn - season Magento mitapov</a></li>
<li><a href="../340342/index.html">How to create an electronic voting system on the blockchain?</a></li>
<li><a href="../340344/index.html">Create live streaming CDN for low latency WebRTC video streams</a></li>
<li><a href="../340348/index.html">Odoo 11 is released - an open system for business automation</a></li>
<li><a href="../340350/index.html">Uptime Institute has prepared a certification program for modular data centers</a></li>
<li><a href="../340352/index.html">Structure and randomness of prime numbers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>