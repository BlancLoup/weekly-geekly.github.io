<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a search plugin for Elasticsearch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Elaticsearch is a popular search engine and NoSQL database. One of its interesting features is the support of plug-ins, which can extend the built-in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a search plugin for Elasticsearch</h1><div class="post__text post__text-html js-mediator-article">  Elaticsearch is a popular search engine and NoSQL database.  One of its interesting features is the support of plug-ins, which can extend the built-in functionality and add a bit of business logic to the search level.  In this article I want to talk about how to write such a plugin and tests to it. <img src="https://habrastorage.org/files/26d/bb1/c9a/26dbb1c9aadb454bb6f365e0cce707e9.png"><a name="habracut"></a>  Just want to make a reservation that the task in this article is greatly simplified so as not to clutter up the code.  For example, in one of the real applications a full schedule with exceptions is stored in the document, and on the basis of them the script calculates the necessary values.  But I would like to focus on the plugin itself, so the example is very simple. <br><br>  It is also necessary to mention that I am not an Elasticsearch committer, the information presented is mainly obtained by trial and error, and may be incorrect in some way. <br><br>  So, suppose that we have an Event document with start and stop properties that store time as a string in the format ‚ÄúHH: MM: SS‚Äù.  The task is for the specified time to sort the events so that the active events (start &lt;= time &lt;= stop) are at the beginning of the output.  An example of such a document: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"09:00:00"</span></span>, <span class="hljs-string"><span class="hljs-string">"stop"</span></span>: <span class="hljs-string"><span class="hljs-string">"18:30:00"</span></span> }</code> </pre> <br><br><h4>  Plugin </h4><br>  For a basis I took <a href="https://github.com/imotov/elasticsearch-native-script-example">an example from one of the Elasticsearch developers</a> .  A plugin consists of one or more scripts that need to be registered: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExamplePlugin</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractPlugin</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ScriptModule </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.registerScript(EventInProgressScript.SCRIPT_NAME, EventInProgressScript.Factory.class); } }</code> </pre>  <a href="">Source code completely</a> <br><br>  The script consists of two parts: the NativeScriptFactory factory, and the script itself, inheriting AbstractSearchScript.  The factory is creating a script (and at the same time validating the parameters).  It is worth noting that the script is created only 1 time for the search (on each shard), so initialization / processing of parameters should be done at this stage. <br><br>  The client application must pass the following parameters to the script: <br><ul><li>  time - a string in the format "HH: MM: SS", the point in time that interests us </li><li>  use_doc - determines which method to use to access the document data (more on that later) </li></ul><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NativeScriptFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ExecutableScript </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newScript</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable Map&lt;String, Object&gt; params)</span></span></span><span class="hljs-function"> </span></span>{ LocalTime time = params.containsKey(PARAM_TIME) ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocalTime(params.get(PARAM_TIME)) : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Boolean useDoc = params.containsKey(PARAM_USE_DOC) ? (Boolean) params.get(PARAM_USE_DOC) : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (time == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || useDoc == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScriptException(<span class="hljs-string"><span class="hljs-string">"Parameters \"time\" and \"use_doc\" are required"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventInProgressScript(time, useDoc); } }</code> </pre>  <a href="">Source code completely</a> <br><br>  So, the script is created and ready to go.  In the script, the most important is the run () method: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Event event = useDoc ? parser.getEvent(doc()) : parser.getEvent(source()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> event.isInProgress(time) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre>  <a href="">Source code completely</a> <br><br>  This method is called for each document, so it is worth paying special attention to what is happening inside it, and how quickly.  This has a direct impact on the performance of the plugin. <br><br>  In general, the algorithm here is: <br><ol><li>  We read the document data we need </li><li>  Calculate the result </li><li>  We return it to Elasticsearch </li></ol><br>  To access the document data, use one of the methods source (), fields (), or doc ().  Looking ahead, I will say that doc () is much faster source () and if possible it is worth using it. <br><br>  In this example, based on the document data, I create a model for further work. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String START = <span class="hljs-string"><span class="hljs-string">"start"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String STOP = <span class="hljs-string"><span class="hljs-string">"stop"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LocalTime start; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LocalTime stop; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Event</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LocalTime start, LocalTime stop)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.start = start; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stop = stop; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isInProgress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LocalTime time)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (time.isEqual(start) || time.isAfter(start)) &amp;&amp; (time.isBefore(stop) || time.isEqual(stop)); } }</code> </pre><br>  (in trivial cases, of course, you can simply use the data from the document, and immediately return the result, and it would be faster) <br><br>  The result in our case is ‚Äú1‚Äù for the events that are happening now (start &lt;= time &lt;= stop), and ‚Äú0‚Äù for all the others.  Result type - Integer, since  sort by Boolean Elasticsearch can not. <br><br>  After processing the script for each document, the value will be determined by which Elasticsearch will sort them.  Mission accomplished! <br><br><h4>  Integration tests </h4><br>  Besides the fact that tests are good in themselves, it is also a great entry point for debugging.  It is very convenient to set breakpoint, and run the debug of the desired test.  Without this, debugging the plugin would be very difficult. <br><br>  The scheme of integration testing of the plugin is approximately as follows: <br><ol><li>  Run test cluster </li><li>  Create index and mapping </li><li>  Add a document </li><li>  Ask the server to calculate the value of the script for the specified parameters and document </li><li>  Make sure the value is correct. </li></ol><br>  To run the test server, let's use the ElasticsearchIntegrationTest base class.  You can customize the number of nodes, shards and replicas.  Read more <a href="">at GitHub</a> . <br><br>  Perhaps there are two ways to create test documents.  The first is to build a document directly in the test - an example can be found <a href="">here</a> .  This option is quite good, and at first I used it.  However, the scheme of documents is changing, and over time it may turn out that the structure built in the test no longer corresponds to reality.  Therefore, the second method is to store the <a href="">mapping</a> and <a href="">data</a> separately as resources.  In addition, this method makes it possible in case of unexpected results on live servers just to copy the problem document as a resource and see how the test falls.  In general, any method is good, the choice is yours. <br><br>  To query the result of the script calculation, we use the standard Java client: <br><pre> <code class="java hljs">SearchResponse searchResponse = client() .prepareSearch(TEST_INDEX).setTypes(TEST_TYPE) .addScriptField(scriptName, <span class="hljs-string"><span class="hljs-string">"native"</span></span>, scriptName, scriptParams) .execute() .actionGet();</code> </pre>  <a href="">Source code completely</a> <br><br><h5>  Integration with Travis-CI </h5><br>  An optional part of the program is the integration with the <a href="https://travis-ci.org/">Continuous Integration system of Travis</a> .  Add a <a href="">.travis</a> file: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">language</span></span>: java jdk: - openjdk7 - oraclejdk7 script: - mvn test</code> </pre>  and the CI server will test your code after each change, <a href="https://travis-ci.org/s12v/elaticsearch-plugin-demo">it looks like this</a> .  Trifle, but nice. <br><br><h4>  Application </h4><br>  So, the plugin is ready and tested.  It's time to try it out. <br><br><h5>  Installation </h5><br>  About the installation of plug-ins can be found <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-plugins.html">in the official documentation</a> .  The assembled plugin is in ./target.  To facilitate local installation, I wrote a small script that builds the plugin and installs it: <br><pre> <code class="bash hljs">mvn clean package <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $? -eq 0 ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> plugin -r plugin-example plugin --install plugin-example --url file://`<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>`/`ls target/*.jar | head -n 1` <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">"\033[1;33mPlease restart Elasticsearch!\033[0m"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre>  <a href="">Source</a> <br><br>  The script is written for Mac / brew.  For other systems, you may have to correct the path to the plugin file.  In Ubuntu, it is located in / usr / share / elasticsearch / bin / plugin.  After installing the plugin, do not forget to restart Elasticsearch. <br><br><h5>  Test data </h5><br>  <a href="">A simple test document generator is</a> written in Ruby. <br><pre> <code class="bash hljs">bundle install ./generate.rb</code> </pre><br><br><h5>  Test request </h5><br>  We ask Elasticsearch to sort all events by the result of the ‚Äúin_progress‚Äù script: <br><pre> <code class="bash hljs">curl -XGET <span class="hljs-string"><span class="hljs-string">"http://localhost:9200/demo/event/_search?pretty"</span></span> -d<span class="hljs-string"><span class="hljs-string">' { "sort": [ { "_script": { "script": "in_progress", "params": { "time": "15:20:00", "use_doc": true }, "lang": "native", "type": "number", "order": "desc" } } ], "size": 1 }'</span></span></code> </pre><br>  Result: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"took"</span></span> : <span class="hljs-number"><span class="hljs-number">139</span></span>, <span class="hljs-string"><span class="hljs-string">"timed_out"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"_shards"</span></span> : { <span class="hljs-string"><span class="hljs-string">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"successful"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"failed"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"hits"</span></span> : { <span class="hljs-string"><span class="hljs-string">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">86400</span></span>, <span class="hljs-string"><span class="hljs-string">"max_score"</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"hits"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"demo"</span></span>, <span class="hljs-string"><span class="hljs-string">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"event"</span></span>, <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"AUvf6fPPoRWAbGdNya4y"</span></span>, <span class="hljs-string"><span class="hljs-string">"_score"</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"_source"</span></span>:{<span class="hljs-string"><span class="hljs-string">"start"</span></span>:<span class="hljs-string"><span class="hljs-string">"07:40:01"</span></span>,<span class="hljs-string"><span class="hljs-string">"stop"</span></span>:<span class="hljs-string"><span class="hljs-string">"15:20:02"</span></span>}, <span class="hljs-string"><span class="hljs-string">"sort"</span></span> : [ <span class="hljs-number"><span class="hljs-number">1.0</span></span> ] } ] } }</code> </pre>  It can be seen that the server counted the values ‚Äã‚Äãfor 86400 documents in 139 milliseconds.  Of course it <br>  can not be compared in speed with a simple sort (2 ms), but still not bad for a laptop.  In addition, the scripts are run in parallel in different shards and thus scaled. <br><br><h4>  Source () and doc () methods </h4><br>  As I wrote at the beginning, the script has several methods for accessing the contents of the document.  These are source (), fields (), and doc ().  Source () is a convenient and slow way.  When requested, the <b>entire</b> document is loaded into HashMap.  But then everything is available.  Doc () is access to the indexed data, it is much faster, but working with it is a bit more difficult.  First, the Nested type is not supported, which imposes restrictions on the structure of the document.  Secondly, the indexed data may differ from what is in the document itself, first of all it concerns lines.  As an experiment, you can try removing ‚Äúindex‚Äù: ‚Äúnot_analyzed‚Äù in mapping.json, and see how it all breaks down.  As for the fields () method, to be honest, I never tried it, judging by the documentation, it is little better than source (). <br><br>  Now let's try to use source () by changing the use_doc parameter to false. <br><div class="spoiler">  <b class="spoiler_title">Request</b> <div class="spoiler_text"><pre> <code class="bash hljs">curl -XGET <span class="hljs-string"><span class="hljs-string">"http://localhost:9200/demo/event/_search?pretty"</span></span> -d<span class="hljs-string"><span class="hljs-string">' { "sort": [ { "_script": { "script": "in_progress", "params": { "time": "15:20:00", "use_doc": false }, "lang": "native", "type": "number", "order": "desc" } } ], "size": 1 }'</span></span></code> </pre></div></div>  And now ‚Äútook‚Äù: 587 milliseconds, i.e.  4 times slower.  In a real application with large documents, the difference can be hundreds of times. <br><br><h4>  Other uses of the script </h4><br>  The script from the plugin can be used not only for sorting, but in general in any places where scripts are supported.  For example, you can calculate the value for the found documents.  In this case, by the way, productivity is no longer so important, since calculations are made for a filtered and limited set of documents. <br><pre> <code class="bash hljs">curl -XGET <span class="hljs-string"><span class="hljs-string">"http://localhost:9200/demo/event/_search"</span></span> -d<span class="hljs-string"><span class="hljs-string">' { "script_fields": { "in_progress": { "script": "in_progress", "params": { "time": "00:00:01", "use_doc": true }, "lang": "native" } }, "partial_fields": { "properties": { "include": ["*"] } }, "size": 1 }'</span></span></code> </pre><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"took"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"timed_out"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"_shards"</span></span>: { <span class="hljs-string"><span class="hljs-string">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"successful"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"failed"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"hits"</span></span>: { <span class="hljs-string"><span class="hljs-string">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">86400</span></span>, <span class="hljs-string"><span class="hljs-string">"max_score"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"hits"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"_index"</span></span>: <span class="hljs-string"><span class="hljs-string">"demo"</span></span>, <span class="hljs-string"><span class="hljs-string">"_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span>, <span class="hljs-string"><span class="hljs-string">"_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"AUvf6fO9oRWAbGdNyUJi"</span></span>, <span class="hljs-string"><span class="hljs-string">"_score"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"fields"</span></span>: { <span class="hljs-string"><span class="hljs-string">"in_progress"</span></span>: [ <span class="hljs-number"><span class="hljs-number">1</span></span> ], <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"stop"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:02"</span></span>, <span class="hljs-string"><span class="hljs-string">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01"</span></span> } ] } } ] } }</code> </pre></div></div><br><br>  That's all, thank you for reading! <br>  GitHub source code: <a href="https://github.com/s12v/elaticsearch-plugin-demo">github.com/s12v/elaticsearch-plugin-demo</a> <br><br>  PS By the way, we really need experienced programmers and system administrators to work on a large project based on AWS / Elasticsearch / Symfony2 in Berlin.  If suddenly you are interested - write! </div><p>Source: <a href="https://habr.com/ru/post/252067/">https://habr.com/ru/post/252067/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252057/index.html">The right platform for Java EE applications: how z / OS + DB2 were 3 times faster than Linux + Oracle</a></li>
<li><a href="../252059/index.html">High Frequency Trading Neighborhood - Part V (Final)</a></li>
<li><a href="../252061/index.html">Chinese HID USBISP Programmer (USBASP) in Linux. Preprogramming</a></li>
<li><a href="../252063/index.html">How many interface designs do you really need to draw for iPhone 4, 5, 6, and 6+?</a></li>
<li><a href="../252065/index.html">Tarantool 1.6 POV</a></li>
<li><a href="../252069/index.html">Testing flash storage. EMC XtremIO</a></li>
<li><a href="../252073/index.html">11 cool sites for iOS developers</a></li>
<li><a href="../252075/index.html">An interesting and at the same time simple slider on pure CSS3</a></li>
<li><a href="../252077/index.html">Discrete structures: matan for IT professionals</a></li>
<li><a href="../252079/index.html">DuoCode: we translate C # in JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>