<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using BSP-trees to create game cards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When you fill an area with objects (for example, rooms in a dungeon) in a random order, you risk that everything will be too random. The result may be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using BSP-trees to create game cards</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/663/1d9/446/6631d9446ce8a0ea6fc83a8fbd34c3b3.jpg" alt="image"><br><br>  When you fill an area with objects (for example, rooms in a dungeon) in a random order, you risk that everything will be <em>too</em> random.  The result may be absolutely useless chaos.  In this tutorial, I‚Äôll show you how to use <em>Binary Space Partitioning (BSP)</em> to solve this problem. <br><br>  I will describe in detail and in stages the use of BSP to create a simple two-dimensional map, for example, a dungeon scheme.  I will show you how to create a simple <code>Leaf</code> object that we use to divide an area into small segments.  Then we will generate a random room in each <code>Leaf</code> .  And finally, learn how to connect all the rooms corridors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Note: although the code of the examples is written in AS3, the concept can be used in almost any other language. <br><a name="habracut"></a><br><hr><br><h2>  Demo project </h2><br>  I created a demo showing part of the capabilities of the BSP.  The demo is written using the free open source AS3 <a href="http://flixel.org/">Flixel</a> library. <br><br>  When you click on the <strong>Generate</strong> button, the demo executes the code to generate several <code>Leaf</code> , and then draws them in the <code>BitmapData</code> object, after which it is displayed on the screen (zooming in to fill the screen). <br><br> <a href="http://tutsplus.github.io/Using-BSP-Trees-to-Generate-Game-Maps/demo/SWFDemo.html%3FswfName%3DBSPTut.swf%26amp%3Bheight%3D480%26amp%3Bwidth%3D640"><img width="600" src="https://habrastorage.org/getpro/habr/post_images/9d0/7ff/03b/9d07ff03b9e83cf4d805c29f4972aab9.jpg" height="450"></a> <br>  <i>Generate a random map.</i>  <i>( <a href="http://tutsplus.github.io/Using-BSP-Trees-to-Generate-Game-Maps/demo/SWFDemo.html%3FswfName%3DBSPTut.swf%26amp%3Bheight%3D480%26amp%3Bwidth%3D640">Click to download the demo.</a> )</i> <br><br>  When you click on the <strong>Play</strong> button, the program sends the generated <code>Bitmap</code> map to the <code>FlxTilemap</code> object, which generates a playable tile map and displays it on the screen.  You can wander through it using the arrows: <br><br> <a href="http://tutsplus.github.io/Using-BSP-Trees-to-Generate-Game-Maps/demo/SWFDemo.html%3FswfName%3DBSPTut.swf%26amp%3Bheight%3D480%26amp%3Bwidth%3D640"><img width="600" src="https://habrastorage.org/getpro/habr/post_images/663/1d9/446/6631d9446ce8a0ea6fc83a8fbd34c3b3.jpg" height="450"></a> <br>  <i>We play on the map.</i>  <i>( <a href="http://tutsplus.github.io/Using-BSP-Trees-to-Generate-Game-Maps/demo/SWFDemo.html%3FswfName%3DBSPTut.swf%26amp%3Bheight%3D480%26amp%3Bwidth%3D640">Click to download the demo.</a> )</i> <br><br><hr><br><h2>  What is bsp? </h2><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B2%25D0%25BE%25D0%25B8%25D1%2587%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B1%25D0%25B8%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D1%2581%25D1%2582%25D0%25B2%25D0%25B0">Binary partitioning of space</a> is a way of dividing a region into smaller parts. <br><br>  We take the area called leaf ( <code>Leaf</code> ), and divide it vertically or horizontally into two smaller sheets, and then repeat the process with smaller areas, again and again, until each area is less than or equal to the specified maximum value. <br><br>  After the completion of the process, we will have a hierarchy of broken <code>Leaf</code> , with which you can do anything.  In 3D graphics, BSP can be used to sort objects visible to the player or to recognize collisions in even smaller parts. <br><br><hr><br><h2>  Why use BSP to generate maps? </h2><br>  There are many different ways to generate a random map.  You can write simple logic to create random-sized rectangles in random places, but the result is maps filled with intersecting, crowded or oddly located rooms.  In addition, it is a little more difficult to connect all the rooms with each other and to make sure that there are no isolated rooms left. <br><br>  Thanks to BSP, you can guarantee the creation of more evenly distributed rooms and ensure their connection. <br><br><hr><br><h2>  Making leaves </h2><br>  The first thing we need to create in the code is the <code>Leaf</code> class.  In essence, our <code>Leaf</code> will be a <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/geom/Rectangle.html">rectangle</a> with some additional features.  Each <code>Leaf</code> will contain either a pair of <code>Leaf</code> subsidiaries, or a pair of <code>Room</code> rooms, as well as one or two corridors. <br><br>  Here‚Äôs what the <code>Leaf</code> code looks like: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Leaf</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MIN_LEAF_SIZE:uint = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y:int, x:int, width:int, height:int; <span class="hljs-comment"><span class="hljs-comment">//      public var leftChild:Leaf; //   Leaf   public var rightChild:Leaf; //   Leaf   public var room:Rectangle; // ,    public var halls:Vector.; // ,       public function Leaf(X:int, Y:int, Width:int, Height:int) { //   x = X; y = Y; width = Width; height = Height; } public function split():Boolean { //        if (leftChild != null || rightChild != null) return false; //    ! ! //    //      25%  ,    //      25%  ,    //       var splitH:Boolean = FlxG.random() &gt; 0.5; if (width &gt; height &amp;&amp; width / height &gt;= 1.25) splitH = false; else if (height &gt; width &amp;&amp; height / width &gt;= 1.25) splitH = true; var max:int = (splitH ? height : width) - MIN_LEAF_SIZE; //      if (max &lt;= MIN_LEAF_SIZE) return false; //   ,    ... var split:int = Registry.randomNumber(MIN_LEAF_SIZE, max); // ,    //           if (splitH) { leftChild = new Leaf(x, y, width, split); rightChild = new Leaf(x, y + split, width, height - split); } else { leftChild = new Leaf(x, y, split, height); rightChild = new Leaf(x + split, y, width - split, height); } return true; //  ! } }</span></span></code> </pre> <br>  Now we need to create a <code>Leaf</code> : <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAX_LEAF_SIZE:uint = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _leafs:Vector&lt;Leaf&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;Leaf&gt;; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l:Leaf; <span class="hljs-comment"><span class="hljs-comment">//   //   ,   ""    . var root:Leaf = new Leaf(0, 0, _sprMap.width, _sprMap.height); _leafs.push(root); var did_split:Boolean = true; //           Vector,     ,   . while (did_split) { did_split = false; for each (l in _leafs) { if (l.leftChild == null &amp;&amp; l.rightChild == null) //     ... { //     ,    75%... if (l.width &gt; MAX_LEAF_SIZE || l.height &gt; MAX_LEAF_SIZE || FlxG.random() &gt; 0.25) { if (l.split()) //  ! { //    ,     Vector,           _leafs.push(l.leftChild); _leafs.push(l.rightChild); did_split = true; } } } } }</span></span></code> </pre> <br>  After completing this cycle, we will have a <code>Vector</code> (typed array) filled with leaves. <br><br>  Here is an example with leaves separated by lines: <br><br><img width="600" src="https://habrastorage.org/getpro/habr/post_images/1c1/caa/4a7/1c1caa4a72e8628c88ea7a2da3d02d24.jpg" height="450"><br>  <i>An example of an area divided into leaves</i> <br><br><hr><br><h2>  Creating rooms </h2><br>  We decided on the leaves, now we need to create rooms.  We want to implement a peculiar effect of ‚Äúflowing‚Äù: let's start with the largest, ‚Äúroot‚Äù <code>Leaf</code> and go down to the smallest <code>Leaf</code> that do not have child leaves, and then create a room in each of them. <br><br>  Therefore, we will add this function to the <code>Leaf</code> class: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRooms</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//               . if (leftChild != null || rightChild != null) { //    ,       if (leftChild != null) { leftChild.createRooms(); } if (rightChild != null) { rightChild.createRooms(); } } else { //       var roomSize:Point; var roomPos:Point; //        3 x 3     - 2. roomSize = new Point(Registry.randomNumber(3, width - 2), Registry.randomNumber(3, height - 2)); //    ,      //     (  ) roomPos = new Point(Registry.randomNumber(1, width - roomSize.x - 1), Registry.randomNumber(1, height - roomSize.y - 1)); room = new Rectangle(x + roomPos.x, y + roomPos.y, roomSize.x, roomSize.y); } }</span></span></code> </pre> <br>  Now that we have created a <code>Vector</code> from leaves, let's call our new function from the root leaf: <br><br><pre> <code class="actionscript hljs">_leafs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;Leaf&gt;; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l:Leaf; <span class="hljs-comment"><span class="hljs-comment">//   //   ,   ""  . var root:Leaf = new Leaf(0, 0, _sprMap.width, _sprMap.height); _leafs.push(root); var did_split:Boolean = true; //       Vector,   ,     . while (did_split) { did_split = false; for each (l in _leafs) { if (l.leftChild == null &amp;&amp; l.rightChild == null) //      ... { //     ,    75%... if (l.width &gt; MAX_LEAF_SIZE || l.height &gt; MAX_LEAF_SIZE || FlxG.random() &gt; 0.25) { if (l.split()) //  ! { //    ,     Vector,           _leafs.push(l.leftChild); _leafs.push(l.rightChild); did_split = true; } } } } } //           . root.createRooms();</span></span></code> </pre> <br>  Here is an example of several generated leaves with rooms inside: <br><br><img width="600" src="https://habrastorage.org/getpro/habr/post_images/dc4/3cb/aca/dc43cbacaa64c3eabaeb451c0ceb5286.jpg" height="450"><br>  <i>An example of leaves with random rooms inside each.</i> <br><br>  As you can see, each sheet contains one room of random size and with a random arrangement.  You can experiment with the values ‚Äã‚Äãof the minimum and maximum sheet size, change the size and position of each room to learn how to get different effects. <br><br>  If you remove the lines separating the leaves, you can see that the rooms fill the entire volume of the card well - not much space is needed - and they look a bit more natural. <br><br><img width="600" src="https://habrastorage.org/getpro/habr/post_images/3b1/d89/4e8/3b1d894e829bb6063c9f55939b2c8bbf.jpg" height="450"><br>  <i>An example of leaves with rooms inside without dividing lines.</i> <br><br><hr><br><h2>  Compound leaves </h2><br>  Now we need to connect each room.  Fortunately, since we have built-in links between the leaves, we can only make sure that every leaf that has daughter leaves is connected to them. <br><br>  We take a sheet, consider each of its daughter leaves, go through each of the daughter leaves, until we reach the sheet with the room, and then connect the rooms.  We can do this while generating rooms. <br><br>  To begin with, we need a new function, iteratively passing from any sheet to one of the rooms inside its daughter leaves: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRoom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Rectangle </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       ,   ,   . if (room != null) return room; else { var lRoom:Rectangle; var rRoom:Rectangle; if (leftChild != null) { lRoom = leftChild.getRoom(); } if (rightChild != null) { rRoom = rightChild.getRoom(); } if (lRoom == null &amp;&amp; rRoom == null) return null; else if (rRoom == null) return lRoom; else if (lRoom == null) return rRoom; else if (FlxG.random() &gt; .5) return lRoom; else return rRoom; } }</span></span></code> </pre> <br>  Then we need a function that takes a couple of rooms and selects a random point inside both rooms, and then creates rectangles one or two tiles wide, connecting two points together. <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createHall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l:Rectangle, r:Rectangle)</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       . //   ,     ,    ,        ,       . //     ,    ,     . halls = new Vector&lt;Rectangle&gt;; var point1:Point = new Point(Registry.randomNumber(l.left + 1, l.right - 2), Registry.randomNumber(l.top + 1, l.bottom - 2)); var point2:Point = new Point(Registry.randomNumber(r.left + 1, r.right - 2), Registry.randomNumber(r.top + 1, r.bottom - 2)); var w:Number = point2.x - point1.x; var h:Number = point2.y - point1.y; if (w &lt; 0) { if (h &lt; 0) { if (FlxG.random() &lt; 0.5) { halls.push(new Rectangle(point2.x, point1.y, Math.abs(w), 1)); halls.push(new Rectangle(point2.x, point2.y, 1, Math.abs(h))); } else { halls.push(new Rectangle(point2.x, point2.y, Math.abs(w), 1)); halls.push(new Rectangle(point1.x, point2.y, 1, Math.abs(h))); } } else if (h &gt; 0) { if (FlxG.random() &lt; 0.5) { halls.push(new Rectangle(point2.x, point1.y, Math.abs(w), 1)); halls.push(new Rectangle(point2.x, point1.y, 1, Math.abs(h))); } else { halls.push(new Rectangle(point2.x, point2.y, Math.abs(w), 1)); halls.push(new Rectangle(point1.x, point1.y, 1, Math.abs(h))); } } else //  (h == 0) { halls.push(new Rectangle(point2.x, point2.y, Math.abs(w), 1)); } } else if (w &gt; 0) { if (h &lt; 0) { if (FlxG.random() &lt; 0.5) { halls.push(new Rectangle(point1.x, point2.y, Math.abs(w), 1)); halls.push(new Rectangle(point1.x, point2.y, 1, Math.abs(h))); } else { halls.push(new Rectangle(point1.x, point1.y, Math.abs(w), 1)); halls.push(new Rectangle(point2.x, point2.y, 1, Math.abs(h))); } } else if (h &gt; 0) { if (FlxG.random() &lt; 0.5) { halls.push(new Rectangle(point1.x, point1.y, Math.abs(w), 1)); halls.push(new Rectangle(point2.x, point1.y, 1, Math.abs(h))); } else { halls.push(new Rectangle(point1.x, point2.y, Math.abs(w), 1)); halls.push(new Rectangle(point1.x, point1.y, 1, Math.abs(h))); } } else //  (h == 0) { halls.push(new Rectangle(point1.x, point1.y, Math.abs(w), 1)); } } else //  (w == 0) { if (h &lt; 0) { halls.push(new Rectangle(point2.x, point2.y, 1, Math.abs(h))); } else if (h &gt; 0) { halls.push(new Rectangle(point1.x, point1.y, 1, Math.abs(h))); } } }</span></span></code> </pre> <br>  Finally, we <code>createRooms()</code> function to <code>createRooms()</code> function for each sheet that has a pair of child leaves: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRooms</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//               . if (leftChild != null || rightChild != null) { //    ,       if (leftChild != null) { leftChild.createRooms(); } if (rightChild != null) { rightChild.createRooms(); } //       ,    ,      if (leftChild != null &amp;&amp; rightChild != null) { createHall(leftChild.getRoom(), rightChild.getRoom()); } } else { //       var roomSize:Point; var roomPos:Point; //        3 x 3     - 2. roomSize = new Point(Registry.randomNumber(3, width - 2), Registry.randomNumber(3, height - 2)); //    ,          (  ) roomPos = new Point(Registry.randomNumber(1, width - roomSize.x - 1), Registry.randomNumber(1, height - roomSize.y - 1)); room = new Rectangle(x + roomPos.x, y + roomPos.y, roomSize.x, roomSize.y); } }</span></span></code> </pre> <br>  The resulting rooms and corridors should look something like this: <br><br><img width="600" src="https://habrastorage.org/getpro/habr/post_images/181/6c2/6af/1816c26aff7e51279e2fd32147e1fa22.jpg" height="450"><br>  <i>An example of leaves filled with random rooms and connected corridors.</i> <br><br>  As you can see, since we connected all the leaves, we have no isolated rooms.  Obviously, the logic of creating corridors should be a little more complicated so that the corridors are not located too close to each other, but even now the program works quite well. <br><br><hr><br><h2>  Summarize </h2><br>  That's all!  We learned how to create a (relatively) simple <code>Leaf</code> object that can be used to generate a tree of separated leaves, created random rooms in each of the leaves, and connected rooms with corridors. <br><br>  At this stage, all objects created by us are rectangles, but if necessary, they can be given any shape. <br><br>  Now you can use BSP to create any type of random cards, apply it to even distribution in the field of bonuses or enemies ... or come up with any other use. </div><p>Source: <a href="https://habr.com/ru/post/332832/">https://habr.com/ru/post/332832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332820/index.html">How to grow better support in 15 years</a></li>
<li><a href="../332822/index.html">How to confuse analytics - 5. Conceptual apparatus</a></li>
<li><a href="../332824/index.html">What is your career after ITMO University? Graduates tell</a></li>
<li><a href="../332828/index.html">Record from 1 million neurons: new plans DARPA</a></li>
<li><a href="../332830/index.html">How to increase sales in Moscow by 60% during a crisis? The success story of one company</a></li>
<li><a href="../332834/index.html">Superjob php meetup</a></li>
<li><a href="../332836/index.html">Continuous Integration: CircleCI vs Travis CI vs Jenkins</a></li>
<li><a href="../332840/index.html">Automatic text recognition in video</a></li>
<li><a href="../332842/index.html">GitLab CI for continuous integration and delivery in production. Part 2: Overcoming Difficulties</a></li>
<li><a href="../332844/index.html">Study of the sustainability of national segments of the network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>