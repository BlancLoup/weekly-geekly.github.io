<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are inventing a name for the new hypervisor for MIPS architecture with hardware-supported virtualization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day at the office of Imagination Technologies in Santa Clara, California, a multi-core Linux specialist Leonid Yegoshin comes to me and says...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are inventing a name for the new hypervisor for MIPS architecture with hardware-supported virtualization</h1><div class="post__text post__text-html js-mediator-article">  The other day at the office of Imagination Technologies in Santa Clara, California, a multi-core Linux specialist Leonid Yegoshin comes to me and says: <br><br>  Yegoshin: Here, I wrote the world's smallest hypervisor. <br><br>  I: Yes?  What is the name? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Yegoshin: I have not yet invented.  And the marketing did not let the name down.  Think of a name!  It all the same will be opensource-project. <br><br>  Me: It is difficult for me to think of something like that.  As the saying goes, "as you call a yacht, so it will float."  We must ask the public. <br><br>  Yegoshin: And I will be still in April in Dolgoprudny, at MIPT.  Not been there since the 20th century.  Are there anyone who is interested in MIPS-Linux / IoT / hypervisors on MIPS? <br><br>  Me: Well, the public can also be asked about this. <br><br>  So I wrote this post to ask the public.  But first I will tell you who Leonid Egoshin is and what a hypervisor is. <br><br>  *** <br><br>  Not all young people know, but the USSR had its own Unix.  Not under Brezhnev, but under Andropov. <br><br>  And one of the first Soviet Unixologists was Egoshin (he is the only one in the photo on the Red Square of the 1980s who smiles).  Then Egoshin moved to Silicon Valley and began working at MIPS Technologies, which became Imagination Technologies.  In the picture on the right, Egoshin is already in 2015, with the first motherboard brought to America from Russia with a Russian microprocessor Baikal-T - Egoshin helped to debug Linux on it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc0/37d/975/cc037d9751c77ea54351f0db5a38a85a.png"><br><br>  And now what is a hypervisor. <br><a name="habracut"></a><br>  A hypervisor is a program that manages the work of two or more operating systems that run on a processor simultaneously within virtual machines.  It seems to a software inside a virtual machine that it owns the entire real machine, all of its I / O ports, memory and interrupts. <br><br>  Virtualization is the next step after kernel / user mode (kernel mode / user mode).  In the kernel / user paradigm, the operating system protects itself from user programs and user programs from each other.  Kernel privilege mode is enabled when an interrupt occurs during the execution of a user program.  Then the OS looks what happened, and can switch to the execution of another user program.  In the case of virtualization on top of kernel / user, root / guest modes are also included to protect several guest operating systems from each other and share resources between them.  This is the hypervisor in root mode: <br><br>  <a href="https://www.imgtec.com/mips/architectures/virtualization/">https://www.imgtec.com/mips/architectures/virtualization/</a> <br><br> <a href="https://www.imgtec.com/mips/architectures/virtualization/"><img src="https://habrastorage.org/getpro/habr/post_images/56d/0b5/1c2/56d0b51c20250d3a5e5f7411b82f7c17.png"><br></a> <br><br>  Virtualization should not be confused with virtual memory.  Virtual memory can exist without virtualization.  In the virtual memory paradigm, the OS / kernel manages the hardware-supported translation table of virtual addresses used by user programs into physical addresses in memory.  Thus, the OS creates the illusion of owning an address space with the same virtual addresses of several user programs, although they may have different physical addresses.  In the case of virtualization, the virtual address translation table has the next level, to create illusions not only for user programs, but also for guest operating systems. <br><br>  Virtualization can be of several types, including para-virtualization, when modification of the operating systems managed by the hyraiser and full virtualization are necessary, with hardware support, when the hypervisor-controlled OSs may not even feel the presence of the hypervisor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/69b/a14/116/69ba141167c5cee4cacb6c625619e864.png"><br><br>  In general, virtualization as a technology appeared more than 40 years ago, it was already at IBM / 370 IBM-ovsky mainframes (but not IBM / 360).  In the USSR, virtualization was used on EU computers, which were similar to the corresponding IBM / 370.  Virtualization was even reflected in American pop culture ‚Äî a start-up in the art book of the first Internet boom of the 1990s, The First $ 20 Millions Most Difficult, was concerned in particular with Apple Mac virtualization on super cheap $ 300 USD PCs (then it was considered fantasy).  By the way, the film, based on the novel, turned out to be one of the biggest failures in the history of Hollywood, earning only $ 5,491 (five thousand dollars with something) with $ 17 million spent ( <a href="https://en.wikipedia.org/wiki/The_First_%2420_Million_Is_Always_the_Hardest">see</a> ) <br><br>  But back to Egoshin.  The hypervisor Egshina runs on the MIPS M5150 processor core.  This is an economical core that is used for Microchip PIC32MZ microcontrollers and for chips for the Internet of things. <br><br>  ‚ÄúWhat about virtualization on the microcontroller ?!‚Äù the reader may exclaim.  For security.  Even on a small chip for IoT, let's say the built-in Linux can work at the same time and say a very secure code for working with financial transactions.  Now, if a user installs a hacked operating system, it will not be able to access another OS that performs critical operations, because there is a hypervisor between the two OSs.  This becomes especially important in the case of the Internet of things, when an iron or a toaster thrown into the home network can theoretically exchange information with the host‚Äôs host computer. <br><br>  The Egoshinsky hypervisor can work on such a <a href="http://store.digilentinc.com/chipkit-wi-fire-wifi-enabled-mz-microcontroller-board/">Digilent chiKIT WI-FIRE</a> board: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f88/c27/8ee/f88c278eeff96207bd19b4e23d4519e2.jpg"><br><br>  And now give the floor to Leonid: <br><br><blockquote>  Yura, hypervisor basics: <br><br>  Memory - 35Kilobyte code, 24KB data <br><br>  Real-time values ‚Äã‚Äã- <br><br>  1. Basic hypervisor call (HYPCALL): 74 clock cycles <br>  2. Force context switch to root and back: 336 clock cycles <br>  3. Emulation of guest register: 207 clock cycles <br>  4. SW IRQ injection timing, no context switch: 173 clock cycles <br><br>  Shared shared devices emulated as proprietary to each Guest: <br><br><ul><li>  PIC32MZ Interrupt controller in EIC mod. </li><li>  Console UART. </li><li>  Read-only registers such as clock etc.  The minimum size of the register block is 16 bytes. </li></ul><br><br>  At the moment, support only PIC32MZ (EF) model, its Interrupt controller and the device - the board, which can be bought cheaply. <br><br>  The configuration is static, with the help of the desktop Python scripts that do recalculation of the location addresses of guests and their IRQ into tables for TLB (PTE) and interrupt management.  At the end of the configuration, everything turns into one .srec file that can be inserted into the PIC32MZ using the pic32prog program from <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B0%25D0%25BA%25D1%2583%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25BA%25D0%25BE,_%25D0%25A1%25D0%25B5%25D1%2580%25D0%25B3%25D0%25B5%25D0%25B9_%25D0%2592%25D0%25B8%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587">Vakulenko</a> . <br><br>  UPD: In addition, a fresh link to the urgency of the problem (virus in ATMs) - <a href="https://www.gazeta.ru/tech/2017/03/20/10584965/atm_virus.shtml">https://www.gazeta.ru/tech/2017/03/20/10584965/atm_virus.shtml#page2</a> <br></blockquote><br><br>  In general, if you have a good name for the hypervisor or a desire to cross at MIPT during Leonid Yoshishin‚Äôs visit to the alma mater in April, you can either write to him at <a href="http://Leonid.Yegoshin%40imgtec.com/">Leonid.Yegoshin@imgtec.com</a> , or leave comments here. <br><br>  *** <br><br>  Help from Wikipedia about the photo on the left: <br><br><blockquote><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%2595%25D0%259C%25D0%259E%25D0%25A1">http://ru.wikipedia.org/wiki/%D0%94%D0%95%D0%9C%D0%9E%D0%A1</a> <br><br>  <i>Around 1982-1983, copies of the UNIX operating system (v6 and v7) were brought to Moscow.</i>  <i>Based on them at the Institute of Atomic Energy.</i>  <i>I. Kurchatov, with the participation of a number of specialists from other organizations, carried out the adaptation of the system to local conditions - localization into Russian and adaptation to domestic technology, above all - to the SM-4 and SM-1420 machines.</i>  <i>At the same time, localization was carried out at the Institute for Advanced Studies of Minavtoprom, where the new system was called ‚ÄúMNOS‚Äù (Machine Independent Operating System).</i>  <i>Later, the two teams merged, and the system was renamed ‚ÄúDEMOS‚Äù (Dialogue Unified Mobile Operating System).</i>  <i>In 1985, OS Demos version 2.0 was released (using BSD4.2 source code).</i>  <i>The project closed in the early 1990s.</i> <i><br><br></i>  <i>The developers of DEMOS were awarded in 1988 with the Prize of the USSR Council of Ministers on science and technology.</i> <i><br><br></i>  <i>Authors Valery Bardin, Sergey Anshukov, Vadim Antonov, Alexey Rudnev, Sergey Ryzhkov, Nikolay Saukh, Dmitry Volodin, Sergey Vakulenko, Mikhail Korotayev, Pavel Khodakov, Andrey ‚Äúache‚Äù Chernov, Mikhail Paremsky, Sergey Usikov, Leonid Egoshin, Mikhail Davidov, Mikhail Flerov et al.</i> <br></div></div><br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/324444/">https://habr.com/ru/post/324444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324432/index.html">Analysis of demand for virtual servers</a></li>
<li><a href="../324436/index.html">Hardware solution hang GSM-modems</a></li>
<li><a href="../324438/index.html">How is the search for package tours in a country where people do not really trust credit cards?</a></li>
<li><a href="../324440/index.html">Tales of the project manager</a></li>
<li><a href="../324442/index.html">How clouds change the colocation market in data centers</a></li>
<li><a href="../324446/index.html">Vkontakte made another breakthrough. For a short time, all users of the social network received moderator rights.</a></li>
<li><a href="../324448/index.html">Release Rust 1.16</a></li>
<li><a href="../324450/index.html">The policy of backward compatibility in the development framework for the example of Magento 2. Part 1</a></li>
<li><a href="../324454/index.html">Factors Affecting Failures and Conversions According to Artificial Intelligence</a></li>
<li><a href="../324456/index.html">Cryptocurrency Ethereum: write an exploit under a vulnerable smart contract and get tokens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>