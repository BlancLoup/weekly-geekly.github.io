<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HTML5 - a look through the security lens</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HTML5 is the future standard for Internet markup language. While it is in the draft stage, but more and more of its capabilities are realized in popul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HTML5 - a look through the security lens</h1><div class="post__text post__text-html js-mediator-article">  HTML5 is the future standard for Internet markup language.  While it is in the draft stage, but more and more of its capabilities are realized in popular web browsers.  But as is usually the case, new technologies carry with them new dangers that can be successfully exploited. <br><a name="habracut"></a><br><br><h3>  HTML5: short summary </h3><br>  Many probably already heard about the confrontation of codecs for the technology of embedding videos on the pages.  With the help of the &lt;video&gt; tag it is supposed if not to replace, then at least to make a serious competition to Adobe Flash.  Starting a conversation about HTML5, it is often remembered exactly this innovation.  Still: such video hosting giants as Youtube and Vimeo have already implemented support for the new technology.  And Apple's mobile products, in which there was no official support for Flash, and most likely will not, are already actively using it.  So the streaming video inserted into the page using the &lt;video&gt; tag is something that you can feel right now. <br>  Among the other "goodies" that HTML5 offers are the following: <br><ul><li>  ‚ÄúOffline‚Äù data storage in the browser - web storage, local databases; </li><li>  Canvas 2D API; </li><li>  Cross Domain Interaction (Cross Domain Messaging); </li><li>  "Drag-and-drop" -functional; </li><li>  Work with the network using web sockets; </li><li>  Geolocation </li></ul><br><br><h3>  Web storage is a powerful alternative to cookies </h3><br>  It is not surprising that with the advent of the era of web applications (such as Gmail), there is a need to store data arrays on the side of a web browser.  A striking example of this is the attempt to make working with such web applications offline.  In this, Google has achieved great success with its technology Google Gears.  Cookies with their limits (especially in 4KB size) and methods of working with them are clearly inappropriate and outdated solutions for such tasks.  For this reason, it was decided to develop a new mechanism, similar to the cookies, but devoid of their shortcomings.  They became the technology and WebStorage.  In 2 words, thanks to HTML5, we now have a repository (or rather two repositories) of the ‚Äúkey-value‚Äù form on the side of a web browser with access from JavaScript: <br><ul><li>  <b>localStorage</b> - for long-term data storage; </li><li>  <b>sessionStorage</b> - for session use. </li></ul>  The mechanism is supported by almost all web browsers: Firefox 3.5, Safari 4.0, IE8, Google Chrome, Opera 10.50.  Below is a typical example of using local web storage to track visitors to a web page. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"count"</span></span></span><span class="hljs-tag">&gt;</span></span>- <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (!localStorage.pageLoadCount)     localStorage.pageLoadCount = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">; localStorage.pageLoadCount += </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">; </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'count'</span></span></span><span class="javascript">).textContent = localStorage.pageLoadCount; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Let's look at the security side of this technology.  Like much in the JS API in HTML5, it is subject to the HTML5 Origin mechanism, that is, data is available for all pages on the same domain, taking into account the protocol and port number (for example, <a href="http://example.com/">example.com</a> : 80).  As noted above, the web storage is free of the 4KB limit and the specification recommends using 5 MB per domain.  In fact, for Firefox, Safari, Opera, Google Chrome, the limit is 5MB, for IE - 10MB.  But the most interesting thing is not the quota itself, but how the browser uses them. <br>  For example, Firefox has a limit on .example.com.  Thus, (and here attention!) One subdomain can completely take the place reserved for the domain: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Firefox 3.6.8 for (var i = 0; i &lt; 100; i++) { try { localStorage.setItem(rand(1, 10000).toString() + 'foo'+i.toString(), 'AA...AA'+i.toString());    }    catch (e) {    alert(i.toString()+'|'+e);break;    } }</span></span></code> </pre><br>  Not without the omnipresent null-byte.  In this web browser, inserting a null byte into the localStorage key causes Firefox to be ‚Äúforgetful‚Äù.  In other words, the place, although only 1B is occupied, but the web browser does not take it into account.  "A trifle, but nice" (c). <br>  Go ahead.  Google Chrome is trying to be more stringent on domain restrictions and the entire domain is taken into account in calculating the limit.  But at the same time in Google Chrome, you can take in general * all * your disk space by creating a bunch of i-frames on the wildcard-domain, in which you can take 5 MB each! <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iframe = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'iframe'</span></span>); iframe.src = <span class="hljs-string"><span class="hljs-string">'http://'</span></span>+randomString()+<span class="hljs-string"><span class="hljs-string">'.example.com/ddos.html'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(iframe); }</code> </pre><br>  This bug is still not fixed.  Among other things, old problems migrated from the cooks to a new kind of storage, including: <br><ul><li>  user tracking; </li><li>  DNS spoofing attack. </li></ul>  Due to the peculiarities of access restrictions (protocol + domain + port), we also have problems on hosting systems using the example.com/~user/ system, which, by the way, wasn‚Äôt.  Yes, for a long time we have not met such hosting in life, but suddenly! <br>  It is also worth noting another important feature of the web storage - in contrast to cookies to the server, nothing is transmitted within the framework of the usual HTTP requests.  Data is available only from the web browser through the JS API.  As well as other technologies that transfer most of the work of a web application to the side of a web browser, this increases the risks from traditional XSS vulnerabilities.  And if cookies were stolen before, now there is a great chance to steal more ‚Äútasty‚Äù data, and in 5 MB you can fit them a lot!  For session cookies, however, it was possible to severely reduce their accessibility with JavaScript using the HTTPOnly attribute, which is good.  But for WebStorage such mechanisms are not provided, and access will be complete. <br><br><h3>  SQL injection in web browser </h3><br>  If we are talking about data storage, we recall and even more advanced tool - web SQL database right in the browser!  Let it and SQLite, but this is not bad!  We will not consider in detail the rather specific syntax of query execution to the database, but rather consider the following code immediately, which should simply output information about the book by its ID: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showById</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pos = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.URL.indexOf(<span class="hljs-string"><span class="hljs-string">"book="</span></span>)+<span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bookId = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.URL.substring(pos,<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.URL.length); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> author = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> title = <span class="hljs-string"><span class="hljs-string">''</span></span>; db.transaction(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tx</span></span></span><span class="hljs-function">) </span></span>{ tx.executeSql(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM books WHERE id = "</span></span> + bookId, [], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tx, result</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( result.rows.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'bookAuthor'</span></span>).textContent =result.rows.item(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-string"><span class="hljs-string">'author'</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'bookTitle'</span></span>).textContent = result.rows.item(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-string"><span class="hljs-string">'title'</span></span>]; } }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tx, error</span></span></span><span class="hljs-function">)</span></span>{}); }); }</code> </pre><br>  What happens if you go to an address like the following? <code>target.com/html5/websql.html?book=1/**/AND/**/1=2</code> <br>  We get DOMXSS + SQL injection!  It is a pity that the possibilities for using this vulnerability are quite small (by the way, Oxod wrote a good article about injections in SQLite, look for the link below).  Especially considering that both Opera and Chrome are stored in separate sqlite-database files for sites.  Of course, the authors have foreseen the possibility and recommend performing ‚Äúsecure‚Äù parameterized SQL queries.  But let's see how the developers will follow their advice.  Among other things, web SQL databases are characterized by the same problems as localStorage and sessionStorage. <br><br><h3>  New tags and attributes - update IDS and WAF signature databases </h3><br>  In HTML5, new tags and attributes were added - this means that it‚Äôs time to update your WAF rules / signatures (we wrote in detail about firewalls for web applications in the article <a href="http://www.xakep.ru/magazine/xa/130/056/1.asp">‚ÄúLast minute walls of protection‚Äù</a> in # 10/2009 issue] [).  One of the new markup elements is the autofocus attribute.  This is a long-awaited attribute, because as before, almost all the time I had to do JavaScript-processing of autofocus.  And in HTML5, finally, they added an attribute for autofocusing on a certain text field.  But let's imagine using this attribute as a way to automatically execute code: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onfocus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">alert(1)</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofocus</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onblur</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">write(1)</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofocus</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofocus</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  This technique can be useful, for example, when angle brackets are filtered.  The &lt;video&gt; tag that we recalled today carries, besides the multimedia functions itself, the ability to execute JavaScript code (who would have thought :) through the poster attribute: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">poster</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">javascript:alert(1)//</span></span></span><span class="hljs-tag"> &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">video</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onerror</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The "merit" of &lt;video&gt; can also be attributed to the ability to accurately identify the web browser.  It will be another reception in the piggy bank <a href="http://www.decloak.net/">Metasploit Decloak</a> .  Examples with newer elements can be continued.  How do you, for example, use JavaScript to execute an onscroll tag handler and the same autofocus attribute? <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onscroll</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">alert(1)</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofocus</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Or another trick, though it works so far only in the latest versions of Opera: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">form</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formaction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  New types of form fields </h3><br>  In addition to new tags and attributes, HTML5 pays great attention to the interaction of web applications with the user and added a large number of input text field types: datetime, datetime-local, date, month, time, week, number, range, email, url, search, tel color.  They are designed to add more meaning to ordinary text fields.  So for the date field it will be possible to conveniently select a date without resorting to using ready-made calendars in JavaScript.  No more bother with the text-stub.  In general, finally, there will be more convenient and context-appropriate input tools. <br><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-attr"><span class="css"><span class="hljs-selector-attr">[required]</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">: green; } </span><span class="hljs-selector-pseudo"><span class="css"><span class="hljs-selector-pseudo">:invalid</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">: red; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Ä¶ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  What is important from a security point of view is that the fields will validate themselves! <br><br><img src="http://habrastorage.org/storage/habraeffect/03/fa/03fa6db44422ee481ed4281ddb1bd16b.jpg" alt="Validation of data in forms"><br><h6>  Validation of data in forms </h6><br>  On the one hand, hurray - you no longer need to write regulars for RFC (although no one takes this right away from you, since the special attribute pattern has been added) and bother with JavaScript checks before sending the form data to the server.  On the other hand, we should not forget about the validation on the server side of the web application!  Strangely enough, but practice shows that even now there are cases when server checks are forgotten or implemented insufficiently strictly.  Checking on the side of a web browser, as you understand, is certainly not worth trusting.  Especially "zamylitsya eye" may be in the development of AJAX-part of modern web applications.  And that's what I fear: if this validation is simplified even more, then how would the developers forget about it at all! <br><br><h3>  Cross-document messaging </h3><br>  Web browsers for security reasons limit the interaction (access and data exchange) of client parts of web applications hosted on different domains.  Despite the fact that the restriction seems to be really necessary from the point of view of security, interdocument interaction in some cases is often necessary.  For example, this may be relevant for widget technologies.  The system of inter-document messages allows (ideally) a secure way to share data with documents hosted on different domains, and at least Firefox, Google Chrome is supported. <br>  Consider how this mechanism works.  Let the site (or rather, its client part) example.com/index.html want to interact with foo.com/iframe.html, which is loaded in an iframe.  In this case, the "recipient" of messages is initialized on foo.com.  The code of the recipient of messages on foo.com: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg"</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'message'</span></span></span><span class="javascript">, receiver, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">); </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">receiver</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">e</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (e.origin != </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'http://example.com'</span></span></span><span class="javascript">) { </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript">; } </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'msg'</span></span></span><span class="javascript">).innerHTML = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Origin: '</span></span></span><span class="javascript"> + e.origin + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">' From: '</span></span></span><span class="javascript"> + e.source + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">' Data: '</span></span></span><span class="javascript"> + e.data; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Pay attention to an explicit sender check (e.origin).  But even with such a check, we must not forget to validate the incoming data in case that a sender suddenly finds, say, XSS.  And in the document (client side) a.example.com we send a message to the recipient: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postMsg</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'ifra'</span></span>); o.contentWindow.postMessage(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'msg'</span></span>).value, <span class="hljs-string"><span class="hljs-string">'http://foo.com/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  Here it is important to explicitly specify the recipient of the targetOrigin message.  Even despite the fact that the standard provides the ability to specify "*" and thereby allow sending messages to any addressee.  IMHO, the main risk in this mechanism is in the initial complexity of the secure messaging implementation.  A developer needs to clearly understand what he is doing.  TV set risk elementary forget about the sender check.  It may be dangerous to "blindly" use incoming data, which will lead to the rebirth of DOM-based XSS. <br><br><h3>  Positioning </h3><br>  Current location is a rather important aspect of privacy (‚Äúprivacy‚Äù), therefore, it is necessary to implement the mechanisms for determining it with great care.  This aspect is described in the ‚ÄúSecurity and privacy considerations‚Äù section of the W3C specification.  In a nutshell, the specification states that the location must be explicitly allowed by the site visitor.  Technically, this is implemented by calling the special method of the navigator.geolocation object. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (navigator.geolocation) { navigator.geolocation.getCurrentPosition(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">position</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lat = position.coords.latitude; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lng = position.coords.longitude; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = {<span class="hljs-attr"><span class="hljs-attr">position</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> google.maps.LatLng(lat, lng) } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> marker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> google.maps.Marker(options); marker.setMap(map); }); }</code> </pre><br>  In all popular browsers (with the exception of MS Internet Explorer, in which the Geolocation API is simply not implemented), when logging into a page that uses gelocation, a warning about collecting information is displayed and permission is asked from the user.  At the same time, it is possible to remember your choice and / or place the site on a white or black list.  It is important that this takes into account the site domain, not including the full path to the script ... <br>  During positioning, a web browser collects data about your IP address, the closest wireless access points and possibly other similar information (for example, a random client ID assigned by Google that expires in 2 weeks) and sends it all to <a href="http://www.mozilla.com/ru/firefox/geolocation">the location service</a> .  And now, paranoid brothers, guess who will be this very service in a large number of cases (Google Chrome, Firefox, Opera) ?!  Right, Google Location Services!  Of course, we are promised that: <br>  ‚ÄúNeither Mozilla nor Google will ever use the information collected by Google Location Services to identify you and will never spy on you.‚Äù <br>  But we know that no one can be trusted!  :) You should also pay attention to the sad consequences that XSS will bring on the site allowed for collecting coordinates. <br><br><h3>  Finally </h3><br>  I would like to hope that the developers of web applications, who have been taught by bitter experience, will not only rush to implement all the really interesting and necessary HTML5 chips, but also study the Security sections of the corresponding specifications.  He is glad that various tools for pentesters, including the W3AF, which is a powerful and free framework for conducting web application security audits, are not far behind the progress.  Your humble servant is one of the participants in this project and we have already added modules to search for places to use WebStorage and other risky sections of code.  So at the next site security audit you can determine if HTML5 chips are used there :). <br><br><h6>  Useful links: </h6><ul><li>  <a href="http://www.html5rocks.com/">Website from Google about HTML5</a> </li><li>  <a href="http://dev.w3.org/html5/spec/">HTML Specifications</a> </li><li>  <a href="http://heideri.ch/jso/">"HTML5 Security Cheatsheet"</a> </li><li>  <a href="http://www.slideshare.net/mayflowergmbh/html-5-security">HTML 5 Security by Frank Ruske</a> </li><li>  <a href="http://diveintohtml5.org/">"Dive into html5" by Mark Pilgrim</a> </li><li>  <a href="http://www.xakep.ru/post/53551/default.asp">The article "Injection, lungs on the rise exploit injections in SQLITE" by Oxod</a> </li></ul>  <i>Journal Hacker, <a href="http://www.xakep.ru/articles/magazine/default.asp">December (12) 143</a></i> <i><br></i>  <i><a href="http://oxdef.info/">Taras "oxdef" Ivaschenko</a></i> <i><br></i>  <i>Dmitry "Invent" Sidorov</i> <br><br>  Subscribe to "Hacker" <br><ul><li>  <a href="http://bit.ly/habr_subscribe_paper">1 999 .</a>  <a href="http://bit.ly/habr_subscribe_paper">for 12 numbers of paper version</a> </li><li>  <a href="http://bit.ly/digital_xakep">1249r.</a>  <a href="http://bit.ly/digital_xakep">for an annual subscription to iOS / iPad (Android'a release soon!)</a> </li><li>  <a href="http://bit.ly/habr_android">"Hacker" on Android</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/108901/">https://habr.com/ru/post/108901/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../108894/index.html">Found premium version of the Zeus worm</a></li>
<li><a href="../108895/index.html">Visualization of the Apache web server - logstalgia</a></li>
<li><a href="../108896/index.html">Japan plans to develop efficient smart grid technology</a></li>
<li><a href="../108897/index.html">Samsung Wave II</a></li>
<li><a href="../108900/index.html">0day vulnerability in modern OS from Microsoft</a></li>
<li><a href="../108903/index.html">New vulnerability allows elevating privileges in Win7 / Vista bypassing UAC</a></li>
<li><a href="../108904/index.html">Hg Init: Part 3. We get used to working in a team</a></li>
<li><a href="../108906/index.html">Netbook with italian roots</a></li>
<li><a href="../108908/index.html">Runet 2010 Prize or Tina Kandelaki Twitter PR</a></li>
<li><a href="../108910/index.html">Do you have a website?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>