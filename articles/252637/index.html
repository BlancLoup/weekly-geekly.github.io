<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Animations against lags, or the best battle that was not</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you noticed, when you just open a website, the first seconds everything slows down? Scrolling somehow does not work smoothly, parallaxes jump, an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Animations against lags, or the best battle that was not</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f09/a2e/527/f09a2e52761dceb4772206b36e4436e4.jpg" alt="image"><br><br>  Have you noticed, when you just open a website, the first seconds everything slows down?  Scrolling somehow does not work smoothly, parallaxes jump, and it seems that the lion's share of frames was cut out from the animation.  But very soon everything will be normal.  Did not notice this?  Take a look <a href="http://serdmi.com/demo/afterlag/">at the demo page of the plugin</a> , and immediately understand what I mean. <br><br>  The problem is that the dynamics can not work normally while the page lags.  As a solution, I suggest the plugin ‚ÄúAfterlag.js‚Äù.  The plugin allows you to track the event of the end of the lag.  Lags have passed, turn on the animation, it will not slow down.  In the meantime, the page lags, there is nothing to run the dynamics, only the view spoil. <br><a name="habracut"></a><br><h4>  How to use </h4><br>  Connect the JS file with the plugin, write: <br><pre><code class="javascript hljs">$.afterlag(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">',  !'</span></span>); });</code> </pre> <br>  As soon as the page runs out of lags, your console will begin to express joy about this.  If jQuery do not want to use, connect the native plugin and write: <br><pre> <code class="javascript hljs">afterlag = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Afterlag(); afterlag.do(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">',  !'</span></span>); });</code> </pre><br>  The result will be the same. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is the simplest thing a plugin can do.  In fact, the plugin has an API and a bunch of other ways to call, all this is fully described in the readme repository <a href="https://github.com/iserdmi/afterlag-js">on the githaba</a> .  There are also ways to connect, links to CDN, the name of the plugin in bower and the npm module. <br><br><h4>  Why everything slows down </h4><br>  Let's see why the animation lags at the start.  Consider the animation of the roundels on the demo page, its task is to smoothly go up, then go down. <br><br>  Motion animation is implemented using the animate jakery library method.  We animate the only CSS attribute top, its value is determined by a given function of time.  By running the animation, the jakery tries to update the value of top every moment.  If jakery really did update this value so often, the animation would be smartly smooth.  But jQuery fails. <br><br>  It does not work, because JS executes all the events in one thread.  JS runs through the list of things to do and does it.  Not all cases are at the end of the list.  If you clicked somewhere, thereby triggering an event, the task of its execution is stuck at the top of the list in order to execute it as soon as possible.  Rather, but not at the same moment.  If you don‚Äôt grasp the point, you can read <a href="http://habrahabr.ru/post/138062/">this short article</a> , it tells in more detail how intervals and timeouts work in the light of JS single-threaded.  And do not forget that in fact all tasks are performed by the browser, and the to-do list transferred from JS is also diluted with other tasks of the browser. <br><br>  So, jakery wanted to update the top value for our rounder more often.  But at the time of loading the page there were a lot of more priority cases: to render a page, to pull up videos from YouTube and so on.  The poor browser was so busy that it managed to update the top value only once every 200‚Äì300 milliseconds.  During this time, the round shape, on the basis of a given function, has already shifted pixels by 60. As a result, the circle does not smoothly fit its new position, but teleports there, creating a sense of lost frames, jerking and inhibition.  Then, when the browser completed all its important affairs, it began to update the top value for the circle in a timely manner, and the animation became even. <br><br><h4>  How does ‚ÄúAfterlag.js‚Äù work </h4><br>  Afterlag will find out when the browser will no longer be so busy and will be able to quite often execute the code necessary for smooth animation playback.  Let's say we are satisfied if the animation task is executed at least once every 50 milliseconds ( <code>frequency</code> ).  During the initialization, the after-tag will remember the current time and start the interval of 50 ms.  After 50 ms, we again find out the current time.  We compare the current time with the previously recorded, if indeed 50 ms has passed, then the lags are over.  And if in fact not 50 ms passed, but, say, 100 ms, then the page is still lagged and the procedure must be repeated until the interval starts working as we expect. <br><br>  Only I wrote the plugin according to the above scheme and decided that it is quite efficient.  But no.  It happens that the interval just got lucky.  It happened so that the first two iterations, the expected value of the past time differed from the actual past, the third iteration coincided, and the fourth again differed.  We solve the problem in the forehead: let the expected time coincide with the actually passed 10 times in a row ( <code>iterations</code> ). <br><br>  ‚ÄúWell, now everything is surely working as it should,‚Äù I thought, and I was mistaken.  If you set not large enough values ‚Äã‚Äãfor ( <code>frequency</code> ) and ( <code>iterations</code> ), for example, 30 and 3, in the first moments it may happen that the browser was not busy for the first 90 ms, i.e. 3 iterations of 30 ms each, the afterlag decided that the lag ran out, and they were just beginning.  We decide again to the forehead: set the value of the time during which it is impossible to trust the after-tag ( <code>delay</code> ) with a margin of 200 ms. <br><br>  <b>Update article (March 12, 2015):</b> <br>  On the advice of <a href="https://habrahabr.ru/users/webmasterx/" class="user_link">webmasterx</a> , a setting has been added ( <code>need_lags</code> ).  I quote the documentation: ‚ÄúIf <code>false</code> afterlag will work either if the lags run out or if they don't even start.  A value of <code>true</code> allows the afterlag to work only after the end of the lags, that is, if there were no lags, the aftelag will not work.  Setting the value to <code>true</code> do not forget to also set the value for the <code>timeout</code> , in the opposite case, if there is no lag, the afterlag will not work. ‚Äù <br>  <b>The end of the update.</b> <br><br>  Now everything works as it should.  There is one more parameter that I took into account immediately, but decided to say just now.  This is the permissible error when reconciling the expected and actual past time ( <code>scatter</code> ) - 5 ms.  We will not be very strict with the browser. <br><br>  All numbers specified in this section are used by the default after-tag, but can be changed by the developer during initialization. <br><br><h4>  Conclusion </h4><br>  Animation implemented using CSS is much less subject to this kind of lag.  Afterlag is only useful when site dynamics are associated with JS, including smooth parallaxes, animation of scrolling and so on.  I would be interested to know your opinion on the usefulness of the plugin. <br><br>  Afterlag most often works correctly, but does not give a 100% guarantee.  When changing the settings, you have to catch the balance: greater reliability and a longer wait, or lower reliability and a shorter wait.  The plugin will appeal to those developers who love when the speaker works beautifully and in the way it was intended. </div><p>Source: <a href="https://habr.com/ru/post/252637/">https://habr.com/ru/post/252637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252607/index.html">Sendmail stub for php and php</a></li>
<li><a href="../252611/index.html">Webmaster‚Äôs blocking of a banned site without settings and client-side software</a></li>
<li><a href="../252613/index.html">Apple released iOS 8.2</a></li>
<li><a href="../252621/index.html">Instantiate not instantiated</a></li>
<li><a href="../252629/index.html">Comparing libraries for asynchronous requests</a></li>
<li><a href="../252639/index.html">130 thousand surveillance cameras - how to make them work?</a></li>
<li><a href="../252641/index.html">Trends and statistics: How Internet companies create an effective newsletter</a></li>
<li><a href="../252643/index.html">What are you guided in the first place, choosing a cloud provider - IaaS service provider?</a></li>
<li><a href="../252645/index.html">We stamp windows: automated deployment of Windows virtual machines to Hyper-V using Vagrant (part 3)</a></li>
<li><a href="../252647/index.html">Assembler with C ++ in Visual Studio 2013</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>