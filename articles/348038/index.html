<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WSTester - JS library for testing web services with WebSocket</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habrasoobschestvo! Like most IT people, I like to create something new, cool, something that can somehow influence the world or at least bri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WSTester - JS library for testing web services with WebSocket</h1><div class="post__text post__text-html js-mediator-article"><p>  Good day, Habrasoobschestvo!  Like most IT people, I like to create something new, cool, something that can somehow influence the world or at least bring a small benefit to other people.  I hope that the tool described below for testing online systems with WebSocket is just such a thing. </p><br><p><img src="https://www.aivanf.com/static/pics/testing_engine.jpg" alt="logo"></p><a name="habracut"></a><br><h1 id="predystoriya">  Prehistory </h1><br><p> Most of the ideas are born as a result of active and diverse work, and this idea is no exception.  To test <a href="http://www.aivanf.com/rus/note/tactictoy">my cross-platform game,</a> I had to write a lot of tests.  For iOS in the Xcode environment, the most convenient built-in functionality is provided, (I simply rewrote algorithms in Java for Android with Obj-C, decided to do without unit tests).  On the server, many algorithms can be tested from the inside when it is started locally, and to check the proper handling of HTTP requests, you can easily write a Python script with the <em><code>requests</code></em> library. </p><br><p>  However, when for the interaction of the client server I had to add a communication channel on the WebSocket, I did not pay the necessary attention to testing it.  As a result, the game did not have the opportunity to create a new user through Web Sockets, and the application used them ... Looking at the statistics, I quickly suspected something was wrong, but took decisive action only after a month or two. </p><br><p>  The main reason for the appearance of this error in production was that there were no easy ways to test Web Sockets - because unlike HTTP, where every request has an answer, you can send as many messages as you want to the server and not get a response at all;  or do not send anything, but get any number of different messages. </p><br><p>  Searching on the Internet, I did not find any recommendations on this topic.  Maybe I was looking badly, or maybe this technology is still too young, and for large projects we write our own systems for testing, and for small projects everything is done manually.  However, I saw a small void in the global software continuum and hurried to close it. </p><br><p>  The result was the JavaScript library <strong>WebSocket Testing Engine</strong> (in short, <strong>WSTester</strong> ) and a web page for working with it through a ready-made GUI that accepts a JS file with test code.  All sources are available on GitHub. </p><br><h1 id="princip-raboty">  Principle of operation </h1><br><p>  WSTester works as a finite state machine - <strong>execution threads</strong> are sent to the input, they are executed independently and sequentially, they can be considered as <em>unit tests</em> .  Each execution thread is an array or dictionary of JavaScript, it consists of <strong>units</strong> , and only one current unit exists at a time. </p><br><p>  The first unit in the stream is called with index 1, the subsequent ones can be any.  If the stream is an array, then the following is considered a unit with an index equal to the current + 1, but you can also change the index of the next unit.  If the stream is a dictionary, then it is always necessary to specify the index of the next unit on its own. </p><br><p>  The structure of the unit object is as follows: </p><br><pre> <code class="hljs lua">{ name: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, enter: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {}, task: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ws, ref)</span></span></span></span> {}, condition: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span></span> {}, key: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, val: any <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>, finalise: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ws)</span></span></span></span> {}, }</code> </pre> <br><p>  The <strong><code>name</code></strong> field is used to display information on the unit, <strong><code>enter</code></strong> and <strong><code>task</code></strong> are used when moving to a new current unit, and <strong><code>condition</code></strong> , <strong><code>key</code></strong> , <strong><code>val</code></strong> and <strong><code>finalise</code></strong> when a new message is received. </p><br><p>  A successfully completed unit is considered when the received message satisfies one of the conditions: </p><br><ul><li>  If the <strong><code>condition</code></strong> function is specified, the unit is completed successfully, if the function with the argument received message returns <strong><code>true</code></strong> or the index of the next unit. </li><li>  If <strong><code>key</code></strong> and <strong><code>val</code></strong> are specified, then the unit is completed successfully, if the received message has a field with the name equal to <strong><code>key</code></strong> and the value of this field equal to the value <strong><code>val</code></strong> .  By the way, if <strong><code>val</code></strong> is an array, then all its values ‚Äã‚Äãwill be checked separately. </li><li>  If <strong><code>key</code></strong> is specified, but not <strong><code>val</code></strong> , then the unit is completed successfully if the received message has a field with the name equal to <strong><code>key</code></strong> . </li></ul><br><p>  If, since the launch of the unit, no suitable messages have been received within the specified time, the current unit and stream are considered failed. </p><br><p>  The information described above is sufficient for writing tests that can be run through a <a href="http://www.aivanf.com/static/wstest/wstester.html">ready-made WSTester interface</a> .  Much more and more about the principles of work can be <a href="http://www.aivanf.com/static/wstest/wstester_info.html">found here</a> and <a href="http://www.aivanf.com/static/wstest/wstester_info_extra.html">here</a> . </p><br><p>  In the interface, you can change different settings: the WebSockets server address, the waiting time for a suitable message until the unit collapses, whether you need to create new connections for each stream, the time between units.  The same parameters can be set in the JS test file for maximum automation.  Also, the GUI can accept test files at a specified URL or directly from a computer. </p><br><p>  When using the JS library itself, in addition to the listed options, you can set a log output function, a function that is called after the connection is reconnected, and a function that is called after all the tests have been executed with the numbers of successful and failed threads. </p><br><h1 id="primery-ispolzovaniya">  Examples of using </h1><br><p>  The main functionality was developed within the project of the aforementioned game, as an analogue of tests for HTTP requests, however, it was subsequently tested and expanded in work with several other services.  Below are a few tests, descriptions and links to files and services. </p><br><ul><li>  <a href=""><strong>data_toy.js</strong></a> - modification of real tests of the <a href="http://www.aivanf.com/eng/note/tactictoy">logic game TacticToy</a> .  Contains 4 streams, 16 units.  <a href="http%253A%252F%252Fwww.aivanf.com%252Fstatic%252Fwstest%252Fdata_toy.js"><strong>Run the file</strong></a> . <br>  Features: <strong><code>condition</code></strong> ;  stream as a dictionary;  skipping units using <strong><code>condition</code></strong> and <strong><code>ref.next</code></strong> . </li><li>  <a href=""><strong>data_gdax.js</strong></a> - sample test for the <a href="https://docs.gdax.com/">GDAX WebSocket API</a> .  Contains 3 streams, 3 units.  <a href="http%253A%252F%252Fwww.aivanf.com%252Fstatic%252Fwstest%252Fdata_gdax.js"><strong>Run the file</strong></a> . <br>  Features: <strong><code>val</code></strong> as an array;  <strong><code>args.split</code></strong> . </li><li>  <a href=""><strong>data_block.js</strong></a> - sample test for <a href="https://blockchain.info/api/api_websocket">Blockchain transaction WebSocket API</a> .  Contains 1 stream and 3 units.  <a href="http%253A%252F%252Fwww.aivanf.com%252Fstatic%252Fwstest%252Fdata_block.js"><strong>Run the file</strong></a> . <br>  Features: <strong><code>finalise</code></strong> . </li><li>  <a href=""><strong>data_ether.js</strong></a> - sample test for <a href="https://etherscan.io/apis">The Etherscan Block Explorer WebSocket API</a> .  Contains 2 streams and 6 units.  <a href="http%253A%252F%252Fwww.aivanf.com%252Fstatic%252Fwstest%252Fdata_ether.js"><strong>Run the file</strong></a> . <br>  Features: flow like a dictionary;  <strong><code>ref.next</code></strong> ;  <strong><code>args.split</code></strong> . </li></ul><br><p>  It is worth noting that although these tests contain all the functionality of the WS Testing Engine, they still do not reach any limits, leaving a huge scope for imagination: you can define and use external variables, functions, objects, and work with them in units, you can do cyclic transitions between units according to sophisticated rules, etc.  JavaScript language to such things is very convenient. </p><br><hr><br><h3 id="ps">  PS </h3><br><ul><li>  Of course, the mentioned error could have been revealed in other ways, but this is not the essence of the story. </li><li>  Why javascript?  Because it is powerful enough and at the same time a lightweight cross-platform language, in which WebSocket is supported out of the box, and you can easily add an interface to it (HTML + CSS). </li><li>  I try to be precise in my statements and the terms used, but if someone notices mistakes, please do not scold, but comment kindly. </li><li>  Unfortunately, I managed to find a few open APIs on WebSokethe, where preliminary registration is not needed.  If you have any suggestions for expanding the list, feel free to offer your options. </li></ul><br><p>  <a href="https://github.com/AivanF/WSTester">Library code and other files on GitHub</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/348038/">https://habr.com/ru/post/348038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348026/index.html">Installing Linux without .ISO and virtualization</a></li>
<li><a href="../348028/index.html">Convolutional neural network, part 2: training in the error back-propagation algorithm</a></li>
<li><a href="../348032/index.html">Mobility Express - when they decided to migrate and scale the wireless network, but as always, there is no money</a></li>
<li><a href="../348034/index.html">Meeting Room Little Helper</a></li>
<li><a href="../348036/index.html">Software sound synthesis on early personal computers. Part 1</a></li>
<li><a href="../348040/index.html">How Atlassian has built a $ 10 billion business. Part 2</a></li>
<li><a href="../348042/index.html">Developing a PCI device driver for Linux</a></li>
<li><a href="../348044/index.html">Rook - "self-service" data store for Kubernetes</a></li>
<li><a href="../348046/index.html">What exactly is personal data?</a></li>
<li><a href="../348052/index.html">Top 5 Information Security Forecasts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>