<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating the transition to React Hooks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="React 16.18 is the first stable release with support for react hooks . Now you can use hooks without fear that the API will change drastically. And al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating the transition to React Hooks</h1><div class="post__text post__text-html js-mediator-article"><p> <a href="https://reactjs.org/blog/2019/02/06/react-v16.8.0.html">React 16.18</a> is the first stable release with support for <a href="https://reactjs.org/docs/hooks-intro.html">react hooks</a> .  Now you can use hooks without fear that the API will change drastically.  And although the <code>react</code> development <code>react</code> advises to use new technology only for new components, many people, including me, would like to use them for old components using classes.  But since manual refactoring is a laborious process, we will try to automate it.  The techniques described in this article are suitable for automating the refactoring of not only <code>react</code> components, but also any other <code>JavaScript</code> code. </p><a name="habracut"></a><br><h2 id="osobennosti-react-hooks">  React Hooks Features </h2><br><p>  An <a href="https://habr.com/en/post/429712/">introduction to React Hooks explains</a> in detail what the hooks are and what they eat.  In a nutshell, this is a new crazy technology for creating components with <code>state</code> without using classes. </p><br><p>  Consider the <code>button.js</code> file: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Button; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Button</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { <span class="hljs-attr"><span class="hljs-attr">enabled</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.toogle = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._toggle.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } _toggle() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ <span class="hljs-attr"><span class="hljs-attr">enabled</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }); } render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {enabled} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{enabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.toggle}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); } }</span></span></code> </pre> <br><p>  With hooks, it will look like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {useState} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Button; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [enabled, setEnabled] = useState(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setEnabled(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{enabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{toggle}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); }</span></span></code> </pre> <br><p>  One can argue for a long time how such a type of record is more obvious to people unfamiliar with technology, but one thing is clear right away: the code is more concise and easier to reuse.  Interesting sets of custom hooks can be found at <a href="https://usehooks.com/">usehooks.com</a> and <a href="https://streamich.github.io/">streamich.github.io</a> . </p><br><p>  Next, we will examine the syntactical differences in the smallest details, and deal with the process of software code conversion, but before that I would like to talk about examples of using this form of writing. </p><br><h2 id="liricheskoe-otstuplenie-nestandartnoe-ispolzovanie-sintaksisa-destrukturizacii">  Lyrical digression: non-standard use of the restructuring syntax </h2><br><p>  <code>ES2015</code> presented the world with such a wonderful thing as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">array</a> <code>ES2015</code> .  And now instead of extracting each element separately: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> letters = [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> first = letters[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> second = letters[<span class="hljs-number"><span class="hljs-number">1</span></span>];</code> </pre> <br><p>  We can immediately get all the necessary elements: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> letters = [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [first, second] = letters;</code> </pre> <br><p>  Such a record is not only more concise, but also less error prone, since it removes the need to remember about the indexes of elements, and allows you to focus on what is really important: the initialization of variables. </p><br><p>  Thus, we come to the <code>es2015</code> that if not for <code>es2015</code> team had not come up with such an unusual way of working with the state. </p><br><p>  Next, I would like to look at several libraries that use a similar approach. </p><br><h4 id="try-catch">  Try Catch </h4><br><p>  Six months before the announcement of hooks in the reactor, I got the idea that destructuring can be used not only to get homogeneous data from the array, but also to get information about the error or the result of the function, by analogy <a href="https://nodejs.org/api/errors.html">with callbacks in node.js.</a>  For example, instead of using the <code>try-catch</code> syntax: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(<span class="hljs-string"><span class="hljs-string">'xxxx'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { error = e; }</code> </pre> <br><p>  What looks very cumbersome, while carrying enough little information, and forcing us to use <code>let</code> , although we did not plan to change the values ‚Äã‚Äãof variables.  Instead, you can call the function <a href="https://github.com/coderaiser/try-catch">try-catch</a> , which will do everything you need, saving us from the problems listed above: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, data] = tryCatch(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse, <span class="hljs-string"><span class="hljs-string">'xxxx'</span></span>);</code> </pre> <br><p>  In such an interesting way, we got rid of all unnecessary syntactic structures, leaving only the necessary.  This method has the following advantages: </p><br><ul><li>  the ability to set any convenient variable names (when using object restructuring, we would not have such a privilege, or rather, it would have its own cumbersome price); </li><li>  the ability to use constants for data that does not change; </li><li>  more concise syntax, all that could be removed is missing; </li></ul><br><p>  And, again, all this is due to the syntax of array restructuring.  Without this syntax, using the library would look ridiculous: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = tryCatch(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse, <span class="hljs-string"><span class="hljs-string">'xxxx'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = result[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = result[<span class="hljs-number"><span class="hljs-number">1</span></span>];</code> </pre> <br><p>  This is still a valid code, but it loses significantly compared to destructuring.  I also want to add an example of the work of the <a href="https://github.com/coderaiser/try-to-catch">try-to-catch</a> library, with the arrival of <code>async-await</code> the <code>try-catch</code> construction is still relevant, and can be written like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, data] = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> tryToCatch(readFile, path, <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>);</code> </pre> <br><p>  If the idea of ‚Äã‚Äãsuch a use of de-structuring came to me, then why shouldn't the creators of the reactor come to it, after all, in fact, we have something like a function that has 2 return values: a <a href="https://ru.wikibooks.org/wiki/Haskell/ListsAndTuples">tuple</a> from a Haskel. </p><br><p>  At this lyrical digression, you can finish and go to the question of conversion. </p><br><h2 id="preobrazovanie-klassa-v-react-hooks">  Class conversion to React Hooks </h2><br><p>  For the conversion, we will use the AST transformer <a href="https://habr.com/en/post/439564/">putout</a> , which allows changing only what is needed and the <a href="https://github.com/coderaiser/putout/tree/master/packages/plugin-react-hooks">@ putout / plugin-react-hooks plugin</a> . </p><br><p>  In order to convert a class inherited from <code>Component</code> into a function that uses <code>react-hooks</code> , the following steps must be done: </p><br><ul><li>  remove <code>bind</code> </li><li>  rename private methods to public (remove "_"); </li><li>  change <code>this.state</code> to use hooks </li><li>  change <code>this.setState</code> to use hooks </li><li>  remove <code>this</code> from everywhere </li><li>  convert <code>class</code> to function </li><li>  in imports, use <code>useState</code> instead of <code>Component</code> </li></ul><br><h3 id="podklyuchenie">  Connection </h3><br><p>  Install <code>putout</code> along with the <code>@putout/plugin-react-hooks</code> : </p><br><pre> <code class="plaintext hljs">npm i putout @putout/plugin-react-hooks -D</code> </pre> <br><p>  Next, create the <code>.putout.json</code> file: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"react-hooks"</span></span> ] }</code> </pre> <br><p>  Then try <code>putout</code> in action. </p><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout button.js /home/coderaiser/putout/packages/plugin-react-hooks/button.js 11:8 error bind should not be used react-hooks/remove-bind 14:4 error name of method "_toggle" should not start from under score react-hooks/rename-method-under-score 7:8 error hooks should be used instead of this.state react-hooks/convert-state-to-hooks 15:8 error hooks should be used instead of this.setState react-hooks/convert-state-to-hooks 21:14 error hooks should be used instead of this.state react-hooks/convert-state-to-hooks 7:8 error should be used "state" instead of "this.state" react-hooks/remove-this 11:8 error should be used "toogle" instead of "this.toogle" react-hooks/remove-this 11:22 error should be used "_toggle" instead of "this._toggle" react-hooks/remove-this 15:8 error should be used "setState" instead of "this.setState" react-hooks/remove-this 21:26 error should be used "state" instead of "this.state" react-hooks/remove-this 26:25 error should be used "setEnabled" instead of "this.setEnabled" react-hooks/remove-this 3:0 error class Button should be a function react-hooks/convert-class-to-function 12 errors in 1 files fixable with the `--fix` option</code> </pre> </div></div><br><p>  <code>putout</code> found 12 places that can be fixed, try: </p><br><pre> <code class="plaintext hljs">putout --fix button.js</code> </pre> <br><p>  Now <code>button.js</code> looks like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {useState} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Button; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [enabled, setEnabled] = useState(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setEnabled(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{enabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{setEnabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); }</span></span></code> </pre> <br><h3 id="programmnaya-realizaciya">  Software implementation </h3><br><p>  Let us consider in more detail several of the rules described above. </p><br><h4 id="ubrat-this-otovsyudu">  Remove <code>this</code> from everywhere </h4><br><p>  Since we do not use classes, all expressions of the form <code>this.setEnabled</code> must be converted to <code>setEnabled</code> . </p><br><p>  To do this, we will go through the <a href="">ThisExpression</a> nodes, which, in turn, are children of the relation to <a href="">MemberExpression</a> , and are located in the <code>object</code> field, thus: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"MemberExpression"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"object"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ThisExpression"</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">"property"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"setEnabled"</span></span> } }</code> </pre> <br><p>  Consider the implementation of the <a href="https://github.com/coderaiser/putout/tree/v4.3.2/packages/plugin-react-hooks/lib/remove-this">remove-this</a> rule: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      module.exports.report = ({name}) =&gt; `should be used "${name}" instead of "this.${name}"`; //    module.exports.fix = ({path}) =&gt; { // : MemberExpression -&gt; Identifier path.replaceWith(path.get('property')); }; module.exports.find = (ast, {push}) =&gt; { traverseClass(ast, { ThisExpression(path) { const {parentPath} = path; const propertyPath = parentPath.get('property'); //      const {name} = propertyPath.node; push({ name, path: parentPath, }); }, }); };</span></span></code> </pre> <br><p>  In the code described above, the <code>traverseClass</code> utility function is used to find the class, it is not so important for a common understanding, but it still makes sense to bring it in, for greater accuracy: </p><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      function traverseClass(ast, visitor) { traverse(ast, { ClassDeclaration(path) { const {node} = path; const {superClass} = node; if (!isExtendComponent(superClass)) return; path.traverse(visitor); }, }); }; //       Component function isExtendComponent(superClass) { const name = 'Component'; if (isIdentifier(superClass, {name})) return true; if (isMemberExpression(superClass) &amp;&amp; isIdentifier(superClass.property, {name})) return true; return false; }</span></span></code> </pre> </div></div><br><p>  The test, in turn, may look like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> test = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@putout/test'</span></span>)(__dirname, { <span class="hljs-string"><span class="hljs-string">'remove-this'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'.'</span></span>), }); test(<span class="hljs-string"><span class="hljs-string">'plugin-react-hooks: remove-this: report'</span></span>, (t) =&gt; { t.report(<span class="hljs-string"><span class="hljs-string">'this'</span></span>, <span class="hljs-string"><span class="hljs-string">`should be used "submit" instead of "this.submit"`</span></span>); t.end(); }); test(<span class="hljs-string"><span class="hljs-string">'plugin-react-hooks: remove-this: transform'</span></span>, (t) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> = <span class="hljs-string"><span class="hljs-string">` class Hello extends Component { render() { return ( &lt;button onClick={this.setEnabled}/&gt; ); } } `</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> to = <span class="hljs-string"><span class="hljs-string">` class Hello extends Component { render() { return &lt;button onClick={setEnabled}/&gt;; } } `</span></span>; t.transformCode(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, to); t.end(); });</code> </pre> <br><h3 id="v-importah-ispolzovat-usestate-vmesto-component">  In imports, use <code>useState</code> instead of <code>Component</code> </h3><br><p>  Consider the implementation of the <a href="https://github.com/coderaiser/putout/tree/v4.3.2/packages/plugin-react-hooks/lib/convert-import-component-to-use-state">convert-import-component-to-use-state</a> rule. </p><br><p>  To replace expressions: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span></code> </pre> <br><p>  on </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {useState} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span></code> </pre> <br><p>  It is necessary to process the <a href="">ImportDeclaration</a> node: </p><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportDeclaration"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"specifiers"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportDefaultSpecifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"local"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"React"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportSpecifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"imported"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Component"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"local"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Component"</span></span> } }], <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"StringLiteral"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"react"</span></span> } }</code> </pre> <br><p>  We need to find <code>ImportDeclaration</code> with <code>source.value = react</code> , and then bypass the <code>specifiers</code> array in the search for an <code>ImportSpecifier</code> with the <code>name = Component</code> field: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     module.exports.report = () =&gt; 'useState should be used instead of Component'; //    module.exports.fix = (path) =&gt; { const {node} = path; node.imported.name = 'useState'; node.local.name = 'useState'; }; //    module.exports.find = (ast, {push, traverse}) =&gt; { traverse(ast, { ImportDeclaration(path) { const {source} = path.node; //   react,    if (source.value !== 'react') return; const name = 'Component'; const specifiersPaths = path.get('specifiers'); for (const specPath of specifiersPaths) { //    ImportSpecifier -    if (!specPath.isImportSpecifier()) continue; //    Compnent -    if (!specPath.get('imported').isIdentifier({name})) continue; push(specPath); } }, }); };</span></span></code> </pre> <br><p>  Consider the simplest test: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> test = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@putout/test'</span></span>)(__dirname, { <span class="hljs-string"><span class="hljs-string">'convert-import-component-to-use-state'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'.'</span></span>), }); test(<span class="hljs-string"><span class="hljs-string">'plugin-react-hooks: convert-import-component-to-use-state: report'</span></span>, (t) =&gt; { t.report(<span class="hljs-string"><span class="hljs-string">'component'</span></span>, <span class="hljs-string"><span class="hljs-string">'useState should be used instead of Component'</span></span>); t.end(); }); test(<span class="hljs-string"><span class="hljs-string">'plugin-react-hooks: convert-import-component-to-use-state: transform'</span></span>, (t) =&gt; { t.transformCode(<span class="hljs-string"><span class="hljs-string">`import {Component} from 'react'`</span></span>, <span class="hljs-string"><span class="hljs-string">`import {useState} from 'react'`</span></span>); t.end(); });</code> </pre> <br><p>  And so, we have reviewed in general terms the software implementation of several rules, the rest are based on a similar scheme.  You can get acquainted with all the nodes of the tree of the <code>button.js</code> file being parsed in <a href="https://astexplorer.net/">astexplorer</a> .  The source code for the plugins described can be found <a href="https://github.com/coderaiser/putout/tree/master/packages/plugin-react-hooks">in the repository</a> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Today we looked at one of the methods of automated refactoring of classes of reactors to reactants.  Currently, the <code>@putout/plugin-react-hooks</code> only supports basic mechanisms, but it can be significantly improved if the community is interested and involved.  I would be happy to discuss comments, ideas, examples of use, as well as the missing functionality in the comments. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/441722/">https://habr.com/ru/post/441722/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441712/index.html">Mathematical solution of the problems of relativity</a></li>
<li><a href="../441714/index.html">How the locomotives were arranged</a></li>
<li><a href="../441716/index.html">Programming for non-programmers. Biography of June</a></li>
<li><a href="../441718/index.html">Security Week 09: 19-year vulnerability in WinRAR</a></li>
<li><a href="../441720/index.html">Chat bot for Vkontakte on ASP.NET Core C #</a></li>
<li><a href="../441728/index.html">Summing up the online contest on the game Blotto</a></li>
<li><a href="../441730/index.html">Entanglion - Haskell among the desktops</a></li>
<li><a href="../441732/index.html">Notes Biorobot</a></li>
<li><a href="../441736/index.html">Automate the conversion of word files to other formats</a></li>
<li><a href="../441738/index.html">Thermal Acoustics Basics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>