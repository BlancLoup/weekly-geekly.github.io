<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>STM32 + DHT11</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I got a DHT11 temperature and humidity sensor in my hands. Measures humidity in the range of 20-90% and temperature from 0 to 50 ¬∞ C. Error of measure...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>STM32 + DHT11</h1><div class="post__text post__text-html js-mediator-article">  I got a DHT11 temperature and humidity sensor in my hands.  Measures humidity in the range of 20-90% and temperature from 0 to 50 ¬∞ C.  Error of measurement of humidity of 5%, temperatures of 2 ¬∞ C.  Capture time 1 sec.  Single wire ( <a href="http://www.micro4you.com/files/sensor/DHT11.pdf">datashit</a> ) communication interface.  Such modest parameters limit the scope of the sensor only for household conditions. <br><img src="https://habrastorage.org/storage2/fad/f8a/da7/fadf8ada7a6b69718ec720717fbfcaa2.jpg" alt="image"><br>  I wanted to compare the <a href="http://habrahabr.ru/post/153395/">device</a> readings <a href="http://habrahabr.ru/post/153395/">on the HCH1000 + DS18B20</a> with the DHT11. <br><a name="habracut"></a><br>  I mistakenly concluded that the DHT11 and DS18B20 get along on the same bus.  It turned out they have completely different protocols.  After an unsuccessful experience, hastily assembled a device to establish the truth. <br><img src="https://habrastorage.org/storage2/2d3/76d/3a0/2d376d3a0257dcaa4c1363790b07e14b.jpg" alt="image"><br>  I did not find the finished DHT11 library for STM32.  For Arduino <a href="http://embedded-lab.com/blog/%3Fp%3D4333">here</a> .  The single wire communication protocol has nothing to do with 1-wire.  The difference between 0 and 1 is obtained from the difference in pulse duration. <br><img src="https://habrastorage.org/storage2/da8/f70/67c/da8f7067c6bf954c7edd8278ef7f71c0.jpg" alt="image"><br>  First, we keep about 20 ms low bus level, then let it go, after 20 ms the sensor clamps it to 0 itself and holds 80 ¬µs and then releases it for 80 ¬µs (generates a presence signal), followed by 40 data bits, with the same start - by pinching the tire on 50 Œºs and a bit.  bit 0 is about 28 Œºs, bit 1 is 70 Œºs.  Well, at parting, the sensor clamps and releases the tire.  40 data bits is 5 bytes, of which the first two are humidity, the next 2 is temperature and parity is byte.  The parity byte is equal to the sum of the previous bytes.  The 1st byte and 3rd byte transfer the values, 2 and 4 I understand are reserved for the tenths. <br>  The easiest way to read the duration of the pulses and write them into an array.  Then transform this array into an array of bytes. This is how the dht11.c library was born. <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> read_cycle(<span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> cur_tics, <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> neg_tic){ <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> cnt_tics; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur_tics &lt; MAX_TICS) cnt_tics = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neg_tic) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!GPIO_ReadInputDataBit(GPIOA,GPIO_Pin_3)&amp;&amp;(cnt_tics&lt;MAX_TICS)){ cnt_tics++; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (GPIO_ReadInputDataBit(GPIOA,GPIO_Pin_3)&amp;&amp;(cnt_tics&lt;MAX_TICS)){ cnt_tics++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cnt_tics; } <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> read_DHT11(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *buf){ <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> dt[<span class="hljs-number"><span class="hljs-number">42</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> cnt; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> i, check_sum; <span class="hljs-comment"><span class="hljs-comment">//reset DHT11 Delay(500); GPIO_LOW(GPIOA,GPIO_Pin_2); Delay(20); GPIO_HIGH(GPIOA,GPIO_Pin_2); //start reading cnt = 0; for(i=0;i&lt;83 &amp;&amp; cnt&lt;MAX_TICS;i++){ if (i &amp; 1){ cnt = read_cycle(cnt, 1); } else { cnt = read_cycle(cnt, 0); dt[i/2]= cnt; } } //release line GPIO_HIGH(GPIOA,GPIO_Pin_2); if (cnt&gt;=MAX_TICS) return DHT11_NO_CONN; //convert data for(i=2;i&lt;42;i++){ (*buf) &lt;&lt;= 1; if (dt[i]&gt;20) (*buf)++; if (!((i-1)%8) &amp;&amp; (i&gt;2)) buf++; } //calculate checksum buf -= 5; check_sum = 0; for(i=0;i&lt;4;i++){ check_sum += *buf; buf++; } if (*buf != check_sum) return DHT11_CS_ERROR; return DHT11_OK; }</span></span></code> </pre> <br>  The project containing the dht11.c library is <a href="">here</a> . </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/160017/">https://habr.com/ru/post/160017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160003/index.html">Ways to create navicon</a></li>
<li><a href="../160007/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ32 (November 17 - 23, 2012)</a></li>
<li><a href="../160009/index.html">O Boost Multi-index Containers</a></li>
<li><a href="../160011/index.html">Chip for recognizing 3D gestures through an electric field</a></li>
<li><a href="../160013/index.html">UK cryptographers did not decipher the code transmitted with the pigeon</a></li>
<li><a href="../160019/index.html">Seven Stone Age Ghosts or What Should Be the Perfect Online Store</a></li>
<li><a href="../160029/index.html">Bitcoin: Mining reward halving on Thursday morning</a></li>
<li><a href="../160031/index.html">The official port of SailFish OS for Nokia N9 will not be</a></li>
<li><a href="../160033/index.html">New search in Gmail</a></li>
<li><a href="../160035/index.html">Behind the Scenes of Android: Something You May Not Know</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>