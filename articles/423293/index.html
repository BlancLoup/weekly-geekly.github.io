<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How not to shoot yourself in the foot of the state machine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The state machine is rarely used by mobile developers. Although the majority knows the principles of work and easily implements it independently. In t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How not to shoot yourself in the foot of the state machine</h1><div class="post__text post__text-html js-mediator-article">  The state machine is rarely used by mobile developers.  Although the majority knows the principles of work and easily implements it independently.  In the article we will examine what tasks are solved by the state machine using the example of iOS applications.  The story is applied in nature and is devoted to the practical aspects of the work. <br><br>  Under the cut, you will find an augmented transcript of Alexander Sychev's speech ( <a href="https://habr.com/users/brain89/" class="user_link">Brain89</a> ) at <a href="http://appsconf.ru/2018">AppsConf</a> , in which he shared the options for using a finite state machine when developing non-game applications. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GKMrJe3mfwU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>About the speaker:</b> Alexander Sychev has been developing iOS for eight years, during which time he participated in the creation of both simple applications and complex clients for social networks and the financial sector.  At the moment, is a technical company in the company Sberbank. <br><a name="habracut"></a><br>  They come to programming from a multitude of spheres, having different education and experience, therefore, we first recall the basic theory. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Formulation of the problem <br></h2><br><img src="https://habrastorage.org/webt/ow/wa/vd/owwavd51w_12g14nwehehu4yfu4.jpeg"><br><br>  A finite state machine is a mathematical abstraction, which consists of three main elements: <br><br><ul><li>  multiple internal states </li><li>  sets of input signals that determine the transition from the current state to the next, </li><li>  sets of final states, upon transition to which the automaton terminates the operation (‚Äúallows the input word x‚Äù). </li></ul><br><h3>  condition <br></h3><br>  By state, we mean a variable or group of variables that determine the behavior of an object.  For example, in the standard iOS application ‚ÄúSettings <strong>‚Äù</strong> there is the item ‚ÄúBoldface‚Äù (‚ÄúBasic ‚Üí Universal Access‚Äù).  The value of this item allows you to switch between two text display options on the device display. <br><br><img src="https://habrastorage.org/webt/mx/if/68/mxif68m4rgadt4kgjqovnzswvny.jpeg"><br><br>  Sending the same ‚ÄúChange toggle switch <strong>‚Äù</strong> signal, we get a different system response: either the usual typeface or bold ‚Äî it's simple.  Being in different states and receiving the same signal, the object reacts differently to a change of state. <br><br><h2>  Traditional tasks <br></h2><br>  In practice, programmers often encounter a finite state machine. <br><br><h3>  Gaming Applications <br></h3><br>  This is the first thing that comes to mind - as part of the game process, almost everything is determined by the current game state.  So, Apple assumes the use of finite automata primarily in gaming applications (we will analyze it in detail later). <br><br>  The behavior of the system when processing the same signal, but the different internal state can be illustrated by the following examples.  For example: <br><br>  ‚óè The game character can be of different strengths: one - in mechanical armor and with a laser gun, and the other - weakly pumped.  Depending on this state, the behavior of the enemies is determined: they either attack or flee. <br><br><img src="https://habrastorage.org/webt/-9/ur/ci/-9urcijninqy6zo8as2i8adn46o.jpeg"><br><br>  ‚óè the game is paused - no need to draw the current frame;  the player in the menu or in the gameplay - drawing is completely different. <br><br><h3>  Text analysis <br></h3><br>  One of the popular text analysis tasks associated with the use of a finite state machine is spam filters.  Let there be a set of stop words and an input sequence.  It is necessary either to filter this sequence, or not to output it at all. <br><br><img src="https://habrastorage.org/webt/vo/ka/c2/vokac2-lpmhmsapxqmtked5buo4.jpeg"><br><br>  Formally, this is the task of finding a substring in a string.  To solve it, the Knut-Morris-Pratt algorithm is used, the software implementation of which is a state machine.  The state is the offset of the input sequence and the number of characters found in the pattern - a stop word. <br><br>  Also, <strong>when analyzing regular expressions</strong> , state machines are often used. <br><br><h3>  Parallel request processing <br></h3><br>  A finite state machine is one of the options for implementing query processing and executing a strict set of instructions. <br><br><img src="https://habrastorage.org/webt/i_/ll/n9/i_lln9kr6-tfmnr0ejx7mjn3ytk.jpeg"><br><br>  For example, in the nginx web server, input requests for various protocols are processed using state machines.  Depending on the specific protocol, a specific implementation of the state machine is selected, and accordingly, a known set of instructions is executed. <br><br>  In general, there are two classes of tasks: <br><br><ul><li>  managing the logic of a complex object with a complex internal state, </li><li>  formation of control and data flows (algorithm description). </li></ul><br>  Obviously, such common tasks are encountered in the practice of any programmer.  Therefore, the use of a finite state machine is possible, including in non-game, content applications that most mobile developers are involved in. <br><br>  Next, we analyze where and when the state machine can be used to create typical iOS applications. <br><br>  Most mobile applications have a layered architecture.  There are three base layers. <br><br><ul><li>  Presentation layer. </li><li>  Business logic (Business logic layer). </li><li>  A set of helpers, network clients, and so on (Core layer). </li></ul><br>  As stated above, the state machine controls objects with complex behavior, i.e.  with a complex condition.  Such objects are precisely in the presentation layer, because it makes decisions processing user input or messages from the operating system.  Let's look at different approaches to its execution. <br><br><img src="https://habrastorage.org/webt/ic/iq/pw/iciqpwtfuuokmoik0j5abflppg4.jpeg"><br><br>  In the classical architectural metaphor Model-View-Controller, the state will be in the controller: it decides what is displayed in the View and how it reacts to the input signals: pressing a button, changing the slider, and so on.  It is logical that one of the implementation options for the controller is a finite state machine. <br><br><img src="https://habrastorage.org/webt/xt/sv/cr/xtsvcrd3ehffxfreo8ivtwx7jy8.jpeg"><br><br>  In the VIPER state is in the presenter: it is he who determines the specific navigation transition from the current screen and the display of data in the View. <br><br><img src="https://habrastorage.org/webt/_p/ob/xb/_pobxbwjjwduuken8qiucqg5o30.jpeg"><br><br>  In the Model-View-ViewModel, the state is in the ViewModel.  Regardless of whether we have reactive binders or not, the behavior of the module defined in the MVVM metaphor will be recorded in the ViewModel.  Obviously, its implementation through a finite state machine is a valid option. <br><br><img src="https://habrastorage.org/webt/x0/8e/kf/x08ekfoc9zyg1s9_9jiirethpgm.jpeg"><br><br>  On the business logic layer of the application, there are also complex objects with a non-trivial set of states.  For example, a network client that, depending on whether or not a connection to the server is established, sends or blocks requests.  Or an object to work with a database that needs to translate language functions into an SQL query, execute it, get an answer, translate into objects, etc. <br><br><img src="https://habrastorage.org/webt/pb/bq/yt/pbbqytlwgtmbcutdlliqv5xkwjs.jpeg"><br><br>  In more specific tasks, such as a payment module, in which a set of states is wider, complex logic, the use of a finite state machine is also correct. <br><br>  As a result, we find that in mobile applications there is a multitude of objects, the state and logic of which behavior are described more difficult than with one sentence.  They need to be able to manage. <br><br>  Consider a <strong>real example</strong> and understand at what point the finite state machine is really necessary, and where its use is not justified. <br><br><img src="https://habrastorage.org/webt/96/hk/lw/96hklw8ditorh2imz2zcx36wmga.jpeg"><br><br>  Consider ViewController from the Championship Championship iOS application, a popular sports resource.  This controller displays a set of comments in a table form.  Users enter the match description, view photos, read the news and leave their comments.  The screen is quite simple: the underlying layer sends the data, they are processed and displayed on the screen. <br><img src="https://habrastorage.org/webt/m7/m1/yz/m7m1yz9--h4qttlcuxjrozagl48.jpeg"><br><br>  Either real data or an error can be transferred to the display.  This is how the first conditional operator appears, the first branch, which determines the further behavior of the application. <br><br>  The next question is what to do if there is no data.  Is this condition an error?  Most likely not: not every news has user comments.  For example, hockey in Egypt is of little interest to anyone, in such an article there are usually no comments.  This is the normal behavior and the normal state of the screen that you need to be able to display.  This is how the second conditional operator appears. <br><br>  It is logical to assume that there is also a starting state in which the user is awaiting data (for example, when the comment screen is only displayed on the screen).  In this case, correctly display the download indicator.  This is the third conditional statement. <br><br>  So it turns out already four states on one simple screen, the logic of display of which is described through the if-else-if-else construct. <br><br><img src="https://habrastorage.org/webt/ys/yg/mq/ysygmq4fbj3mog3p6mjb0t5av9o.jpeg"><br><br>  And what if there are more such states?  Iterative development of the screen leads to a tangled coil of conditional constructions, heaps of flags, or a cumbersome multiple switch-case.  This code is scary.  Imagine that the developer who will support him knows where you live and he has a chainsaw, which he always carries with him.  And you so want to live to your small, but well-deserved retirement. <br><br>  I think in this case it is worth considering whether to leave such an implementation in the application. <br><br><h3>  disadvantages <br></h3><br>  Let's understand what we don't like in this code. <br><br><img src="https://habrastorage.org/webt/2u/a-/67/2ua-67iwmlvw9zki5oxmjf4mfqe.jpeg"><br><br>  First of all, it's <strong>hard to read</strong> . <br><br>  Once the code is poorly read, it means that the new developer will find it difficult to figure out what exactly is implemented in a particular project location.  Accordingly, he will spend a lot of time analyzing the logic of the behavior of the application - the <strong>cost of support and development increases</strong> . <br><br>  This code is <strong>inflexible</strong> .  If you need to add a new state that does not follow from the current ladder, it may not be possible at all!  If you need a through transition - abruptly quit passing checks on this ladder - how to do it?  Practically nothing. <br><br>  Also, with this approach, <strong>there is no protection against dummy states</strong> .  When transitions are described via switch case, the default behavior is most likely implemented.  This state is logical from the point of view of program behavior, but it is hardly logical from the point of view of human or business logic of the application. <br><br>  What could be the solution to the indicated shortcomings?  Of course, this is the construction of the logic of each module / controller / complex object, not based on intuition, but using a good formalized approach.  For example, the state machine. <br><br><h2>  Gameplaykit <br></h2><br>  As an <strong>example, for the implementation of</strong> take what Apple offers.  Within the framework of the GameplayKit framework, there are two classes that help us work with the state machine. <br><br><ul><li>  GKState. </li><li>  GKStateMachine. </li></ul><br>  By the name of the framework, it is clear that Apple wanted to be used in games.  But <strong>in non-game applications,</strong> it will be useful. <br><br><img src="https://habrastorage.org/webt/pz/ez/de/pzezdem8jc81mab3alsm3e8pqwo.png"><br><br>  The <strong>GKState</strong> class defines a state.  To describe it you need to perform simple steps.  Inherit from this class, set the name of the state and define three methods. <br><br><ul><li>  isValidNextState - whether the current state is valid, based on the previous one. </li><li>  didEnterFrom - actions on transition to this state. </li><li>  willExitTo - actions when exiting this state. </li></ul><br><br><img src="https://habrastorage.org/webt/z2/q2/gj/z2q2gj0bg2-vsoejvz0crdbhmb4.png"><br><br>  <strong>GKStateMachine is</strong> a finite state machine class.  It's even easier.  It is enough to perform two actions. <br><br><ul><li>  We transfer a set of input states to a typed array through an initializer. </li><li>  Perform transitions depending on the input signals using the enter method.  The initial state is also set through it. </li></ul><br>  It can be confusing that any class is passed as an argument to the <strong>enter</strong> method.  But it should be noted that an object of any class cannot be specified in an array of states <strong>‚Äî</strong> strict typing prohibits it.  Accordingly, if you set an arbitrary class as the class of the next state, nothing will happen, and the enter method will return false. <br><br><h3>  States and transitions between them <br></h3><br>  Acquainted with the framework from Apple, back to the example.  It is necessary to describe the states and transitions between them.  This should be done in the most understandable form.  There are two common options: a table or in the form of a transition graph.  Graph transitions, in my opinion, a more understandable option.  It is in the UML in the standardized version.  Therefore, we choose it. <br><br>  In the transition graph there are states, which are described by names, and arrows, by which these states are connected to describe transitions.  In the example, there is an initial state <strong>‚Äî</strong> we expect data <strong>‚Äî</strong> and there are three states that can be reached from the initial state: data is received, there is no data, and an error. <br><br><img src="https://habrastorage.org/webt/cg/dn/gs/cgdngsj7omvfgbfvkpdgtazpeva.jpeg"><br><br>  In the implementation we get four small classes. <br><br><img src="https://habrastorage.org/webt/qo/tc/rq/qotcrq6wbihios-sonhj8ajfhey.png"><br><br>  Let us examine the "Waiting data" state.  At the entrance it is worth displaying the loading indicator.  And when you exit this state <strong>,</strong> hide it.  To do this, you need to have a weak reference to the ViewController, which is controlled by the state machine you are creating. <br><br><img src="https://habrastorage.org/webt/p8/41/aa/p841aapjpxsvcqirsklkcy9o4us.png"><br><br><h3>  Machine parameters <br></h3><br>  The second step that needs to be done <strong>is</strong> to set the state machine parameters.  To do this, create states and transfer them to the object of the automaton. <br><br><img src="https://habrastorage.org/webt/zd/ww/pm/zdwwpm8i_i6lxoxjkzh_a2deqzi.jpeg"><br><br>  Also be sure to set the initial state <br><br><img src="https://habrastorage.org/webt/mx/sg/ka/mxsgkacbkni4fjczcvsagtec8lm.png"><br><br>  In principle, everything is automatic.  Now it is necessary to handle reactions to external events, changing the state of the machine. <br><br><img src="https://habrastorage.org/webt/_c/jt/hf/_cjthf0r7-5d5u0fdxucgksdz2w.png"><br><br>  Recall the problem statement.  We got a ladder from the if-else, on the basis of which the decision was made, what action should be performed.  As a simple machine control, such an implementation may be (in fact, a simple switch <strong>is</strong> a primitive implementation of a finite state machine), but we practically do not get rid of the previously mentioned drawbacks. <br><br>  There is another approach that will allow you to get away from these ladders.  He proposed the classics of programming <strong>- the</strong> so-called "gang of four." <br><br><img src="https://habrastorage.org/webt/qv/if/sf/qvifsfqe0iqs3rsroauy4bptayg.jpeg"><br><br>  There is a special design pattern, which is called ‚ÄúState‚Äù. <br><br><img src="https://habrastorage.org/webt/nd/eh/wp/ndehwptccwh7lh90dmsixkzybo0.jpeg"><br><br>  This is a behavioral pattern, similar to a strategy, that describes the abstraction of a finite state machine.  It allows the object to change its behavior depending on the state.  The main purpose of the application <strong>is to</strong> encapsulate the behavior and data associated with a particular state in a separate class.  Thus, the state machine, which initially made the decision on which state to call, will now transmit the signal, transmit it to the state, and the state will make the decision.  So partially unload the ladder, and the code will become more pleasant to use. <br><br>  Standard framework does not know how.  He assumes that <strong>GKStateMachine</strong> will make a decision.  Therefore, we will expand the final automaton method, where, as a configuration, we will transfer the description of all conditional variables that uniquely determine the next state.  Inside this method, you can delegate the selection of the next state to the current state. <br><br><img src="https://habrastorage.org/webt/gu/sw/nr/guswnro2dw8m3fsctqqjx8_7js8.png"><br><br>  Good practice is to describe the state as a single object and always pass it on, rather than writing many, many input parameters.  Next we delegate the selection of the next state to the current one.  That's the whole upgrade. <br><br><img src="https://habrastorage.org/webt/te/9t/5a/te9t5acirqz1o5awpxzy1tsbyia.png"><br><br>  <strong>Advantages of GameplayKit.</strong> <br><br><ul><li>  Standard Library.  Do not download anything, use cocoapods or carthage. </li><li>  The library is quite simple to learn. </li><li>  There are two implementations at once: on Objective-C and on Swift. </li></ul><br>  <strong>Disadvantages:</strong> <br><br><ul><li>  State and transition implementations are closely related. <br>  The principle of sole responsibility is violated: the state knows where it goes and how. </li><li>  Duplicate states are not controlled at all. <br>  An array is passed to the state machine, not a multitude of states.  If you pass several identical states - the last one from the list will be used. </li></ul><br>  What else are the options for the implementation of the state machine?  Let's take a look at github. <br><br><h2>  Implementations on Objective-C <br></h2><br><img src="https://habrastorage.org/webt/vo/zt/zy/voztzyatty-amllrmtl8ny4ke3c.png"><br><br><h3>  TransitionKit <br></h3><br>  This is the most popular, long-existing library on Objective-C, devoid of the shortcomings identified by GamePlayKit.  It allows us to implement a state machine and all actions associated with it on the blocks. <br><br>  <strong>The state is separated from the transitions</strong> . <br><br>  There are 2 classes within TransitionKit. <br><br><ol><li>  TKState - to set the state and input, output actions. </li><li>  TKEvent - class to describe the transition. <br>  TKEvent binds one condition to another.  The event itself is simply a string. </li></ol><br>  In addition, there are additional benefits. <br><br>  <strong>You can transfer useful data during the transition</strong> .  This works the same as using NSNotificationCenter.  All useful payload comes in the form of userInfo dictionary, and the user himself parses the information. <br><br>  <strong>Wrong transition has a description</strong> .  When trying to perform a non-existent - impossible transition - we get not only the NO value when returning from the transition method, but also a detailed description of the error, which is useful when debugging a finite state machine. <br><br><img src="https://habrastorage.org/webt/hi/x9/bx/hix9bx5ctgjldoay4btqajopgb0.jpeg"><br><br>  TransitionKit is used in the popular network combine RestKit.  This is a pretty graphic example of how a finite state machine can be used in the core of an application when implementing network operations. <br><br><img src="https://habrastorage.org/webt/ls/os/d3/lsosd3z1zbg5knnmbrggmpq2zro.jpeg"><br><br>  RestKit has a special class - RKOperationStateMachine - for managing concurrent operations.  At the input, it accepts the process being processed and a queue for its execution. <br><br><img src="https://habrastorage.org/webt/r2/pn/mc/r2pnmcfsl_6uzdzhsin_mrq_vkg.jpeg"><br><br>  Internally, the state machine is very simple: three states (ready, executed, completed) and two transitions: start and end execution.  After the start of processing (and for any transitions), the state machine launches the control of a user-defined block of code in the queue specified when creating it. <br><br>  The operation associated with its automaton transmits external events to the automaton, and it performs state transitions and all related actions.  State machine takes care of <br><br><ul><li>  Asynchronous code execution </li><li>  atomicity of code execution at transitions, </li><li>  control the correctness of transitions </li><li>  cancel operations </li><li>  correctness of change of operation state variables: isReady, isExecuting, isFinished. </li></ul><br><h3>  Shift <br></h3><br>  In addition to TransitionKit, it is worth mentioning separately <strong>Shift</strong> , a tiny library implemented as a category above NSObject.  This approach allows you to turn any object into a state machine, describing its state in the form of string constants and actions in blocks at transitions.  Of course, this is more an educational project, but quite interesting and allows you to try what a state machine is with minimal cost. <br><br><h2>  Implementations on Swift <br></h2><br><img src="https://habrastorage.org/webt/_t/dx/kd/_tdxkdwt0sqzgy78o-q-_z0c_nq.png"><br><br>  There are many finite state machine implementations on Swift.  I will single out one ( <strong>remark</strong> : unfortunately, the last two years after the report, the project has not developed, but the ideas embodied in it are worth telling in the article). <br><br><h3>  SwiftyStateMachine <br></h3><br>  In SwiftyStateMachine, a finite state machine is represented by a non-mutable structure; through the didSet methods, the property can easily catch state changes. <br><br>  In this library, a finite state machine is defined through a table of correspondences of states and transitions between them.  This scheme is described separately from the object that the machine will control.  This is implemented through the nested switch-case. <br><br><img src="https://habrastorage.org/webt/y5/cz/dl/y5czdlkikmxb4kyylgwgxfsdxuy.png"><br><br>  Key features, advantages of this library are. <br><br><ul><li>  The need to fully describe the state transition scheme. <br>  This makes it possible to get an error at the compilation stage if the transition for a particular state is not processed. </li><li>  Strict control of input signals. <br>  You cannot pass to a state machine a signal that is not defined or that is defined for another state machine. </li><li>  Separating the circuit and the object it controls saves time on initializing the machine. </li><li>  Visualization using graph description language DOT. <br>  There is a graphical markup language for working with state diagrams - DOT.  This library uses it to indicate how the state machine will be rendered. </li></ul><br><img src="https://habrastorage.org/webt/wb/zg/du/wbzgduy9duy-shpt0pcjjjt0ru8.jpeg"><br><br><h2>  Conclusion <br></h2><br>  Let's note the main advantages of using a finite state machine in mobile applications. <br><br><ul><li>  <strong>Formalization.</strong> <br>  When describing a task through a finite state machine, it is necessary to think about all the states in which the object may be.  So we get the documentation, and we can identify moments not considered in the problem statement.  Accordingly, code testing is simplified. <br></li><li>  <strong>Control data streams.</strong> <br>  Explicit call sequence control (flow of control). <br></li><li>  <strong>Error control.</strong> <br>  If the finite state machine falls into an erroneous state, then this simply means that during the design we forgot to define another state. </li><li>  <strong>Single entry point for logging and statistics collection.</strong>  For example, SwiftyStateMachine allows you to explicitly specify a specific block in which you can pledge what happens to our data.  This greatly simplifies debugging applications. </li><li>  <strong>Operations history.</strong> <br>  Using a finite state machine, you can implement undo operations.  Or, on the contrary, to restore the entire picture of transitions between states.  The stack of operations is usually stored in the state itself. <br></li></ul><br>  Now let's look at some real examples of the use of a finite state machine. <br><br><img src="https://habrastorage.org/webt/wb/ek/ww/wbekwwlr0a_w8wzt6z0bo12jdmm.jpeg"><br><br>  A state machine is often used to control the algorithm.  An excellent example is a taxi order that contains a large number of states.  If you do them roughly, intuitively, you get a big switch case: wait for the car, the car arrived, payment - everything will not fit into the slide. <br><br><img src="https://habrastorage.org/webt/hq/ay/db/hqaydbygw58xgcalwyvph1haeho.jpeg"><br><br>  Let's formalize.  There is an order placement status.  The user is waiting for his confirmation, may cancel.  The driver arrives, the user goes on a journey, makes a payment, then the order is moved to history.  After the order is evaluated. <br><br><img src="https://habrastorage.org/webt/b9/mb/ze/b9mbze-xdkufz2mbs7p61obsjqo.jpeg"><br><br>  We now describe the states in compact classes that can be distributed among the development team, and each of them will be tested.  This parallels and simplifies the work. <br><br><img src="https://habrastorage.org/webt/bc/qp/hr/bcqphramltmjhaakirn_uo00e4i.png"><br><br>  Another similar task is to place an <strong>order</strong> .  In the application for the store, you can formalize the order: his journey from the basket to the consumer - using the state machine. <br><br><img src="https://habrastorage.org/webt/iw/qz/we/iwqzwefnjh4xnqexwoovxccugqo.jpeg"><br><br><img src="https://habrastorage.org/webt/i4/80/vk/i480vkfuwmhwpdd31totlvl5298.jpeg"><br><br>  In the application "Poster-Restaurants" the state machine is used to <strong>pay for the order</strong> . <br><br><img src="https://habrastorage.org/webt/s-/kf/ox/s-kfoxsckujhbrzsslebpzuqwei.jpeg"><br><br>  By the way, it is not necessary to describe the transition diagram.  To formalize the tasks, it is enough to get all the screens from the designer. <br><br><img src="https://habrastorage.org/webt/le/oo/ju/leoojuz3yycfncczpfbgftsa1tq.jpeg"><br><br>  Another option for using the state machine is the <strong>app coordinators</strong> - this is a set of instructions, a set of sequences of hard-coded actions that completely describe the user history: authorization, order execution, and so on.  The management of this story can be delegated to a specific superobject, which will determine the rules within this story. <br><br>  If you look closely, the app coordinator looks like a state machine.  It has a set of signals and transitions between them according to given states.  It is logical that if you implement app coordinators as a state machine, you can reduce all application transitions to a hierarchy of finite automata, and thereby <strong>completely formalize the task</strong> .  The introduction of additional abstraction increases the amount of code, respectively, increases the development time, but this code will be fully tested and formalized.  These advantages are very appealing. <br><br><img src="https://habrastorage.org/webt/mx/yu/1q/mxyu1qczcjazzunuhe7jfoolv2e.png"><br><br>  So, the state machine should be used when formalization is really needed, the code is highly testable, and you need to distribute tasks among developers. <br><br>  Do not try to use the state machine for objects that have one if-else.  This is a bad practice, and it does not help with the development of your application. <br><br><blockquote>  This year, at Apps Conf 2018, which will be held on October 8 and 9, Alexander <a href="http://appsconf.ru/2018/abstracts/3740">plans to discuss the</a> five basic principles of object-oriented programming and the limits of their applicability. <br><br>  For more reports on mobile development, see our <a href="https://www.youtube.com/c/MobileChannelRussia">YouTube channel</a> .  And if you want to receive information about new transcripts and interesting reports, subscribe to the thematic <a href="http://eepurl.com/bOajmn">newsletter</a> . <br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/423293/">https://habr.com/ru/post/423293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423281/index.html">Feedback in the team, 360 and February 14</a></li>
<li><a href="../423283/index.html">Simulation of the Sagnac effect using geometric optics</a></li>
<li><a href="../423285/index.html">Social engineering: the elusive enemy in the cybersecurity world</a></li>
<li><a href="../423287/index.html">Google completes successful inbox experiment</a></li>
<li><a href="../423291/index.html">The Russians set a record: 110 pirated films per person</a></li>
<li><a href="../423295/index.html">The most useful mobile development conference</a></li>
<li><a href="../423297/index.html">From Android developer to DevOps</a></li>
<li><a href="../423299/index.html">Application Coordinator in iOS applications</a></li>
<li><a href="../423301/index.html">Selective IP ban on cloudy Windows Server 2012 via RDP</a></li>
<li><a href="../423303/index.html">AI, practical course. Emotion Based Musical Transformation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>