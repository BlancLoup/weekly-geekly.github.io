<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We do call tracking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the modern world, companies use a large number of channels to attract customers: contextual advertising, banner advertising, advertising on radio o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We do call tracking</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6ec/fae/1d7/6ecfae1d76a0454cbd20634b2668f821.jpg" align="left">  In the modern world, companies use a large number of channels to attract customers: contextual advertising, banner advertising, advertising on radio or TV, outdoor advertising, and so on.  Each of these channels may still contain placement parameters, for example, keywords or sites.  Advertising is costly and a business has a clear desire to study the effectiveness of various channels and sites.  In the case of online sales, everything is more or less simple and worked out, there are special tags and cookies that cling to the client‚Äôs browser and, when he makes a purchase, Google / Yandex / any other system gives you information that the client came from a certain channel via some particular keywords.  But not all companies sell goods or services online, many still do it by phone, every business has its own specifics and the phone as a sales channel has not lost its relevance.  In order to analyze the effectiveness of marketing channels in the case of telephone sales, call tracking is used, then we will consider the types of call tracking and describe how it can be implemented. <a name="habracut"></a><br><br><img src="https://habrastorage.org/files/8cc/0bd/dd9/8cc0bddd9b854535aa61daf6c23c0539.jpg" align="left" width="200">  There are several types of call tracking - static and dynamic.  In the case of static call tracking, each advertising channel is allocated its own number and assigned to it, then all calls through numbers are recorded and the analysis of statistical information shows which of the channels is most effective.  This method works well if you need to track a limited number of channels.  In the modern world, advertisers want to track not only the channels, but also the effectiveness of certain keywords and catch individual customers, which ultimately leads to the need for a large number of numbers. <br><br><img src="https://habrastorage.org/files/c11/372/856/c113728563384c31be6a36d8f4ca717e.png" width="300" align="right">  In this case, they begin to use dynamic call tracking: with dynamic call tracking, there is a certain pool of phone numbers that is used for all channels, but a bunch of numbers with the site visitor occurs on the fly and a limited amount of time is valid if during this time If the customer calls the number, the system will track it.  There is a ratio between the number of visits to the site and the number of numbers that are necessary for tracking visitors to the site from different channels, so call tracking services usually tie the price of their services to the attendance of the resource. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/f03/61b/802/f0361b8027644e14a6b5f772be3f03f8.jpg"><br><br>  Well, everything, with the theory finished, you can proceed to practice.  We will consider the option of a pool of tracking numbers connected to the <a href="http://voximplant.com/">VoxImplant</a> platform, which will be responsible for handling incoming calls and redirecting them to the client number.  In the call processing scenario, we will provide data for forwarding from the backend via HTTP (S) and recording call information.  If the call is successful, then we will save its date, duration, call recording URL, the number to which the call came and the number to which we forwarded the call, in case the call did not take place, add the error information - why it wasn‚Äôt phoned.  Let's proceed to the implementation: <br><ol><li>  Register and activate your account VoxImplant </li><li>  Go to <a href="https://manage.voximplant.com/">the control panel</a> and create an application in the <a href="https://manage.voximplant.com/">Applications</a> section, you can call it tracking </li><li>  In the <a href="https://manage.voximplant.com/">Scenarios</a> section, create a new script with the following content: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outbound_call, dialed_number, agent_number, record_url, call_date, call_length = <span class="hljs-number"><span class="hljs-number">0</span></span>, failure_code, failure_reason, wsURL = <span class="hljs-string"><span class="hljs-string">"http://yourwebservice.com/api"</span></span>, <span class="hljs-comment"><span class="hljs-comment">// ,   -      connected = false; //    VoxEngine.addEventListener(AppEvents.CallAlerting, function (e) { //    UTC- call_date = new Date().toUTCString(); // ,    dialed_number = e.destination; // URL         wsURL += "?dialed_number=" + encodeURIComponent(dialed_number); //  HTTP-  -,        Net.httpRequest(wsURL, function (res) { if (res.code == 200) { //     agent_number = res.text; //    outbound_call = VoxEngine.callPSTN(agent_number, dialed_number); //          VoxEngine.easyProcess(e.call, outbound_call, handleCallsConnected); outbound_call.removeEventListener(CallEvents.Disconnected); outbound_call.addEventListener(CallEvents.Disconnected, handleCallDisconnected); outbound_call.removeEventListener(CallEvents.Failed); outbound_call.addEventListener(CallEvents.Failed, handleCallFailed); } else { //  -  -  ,   -     e.call.reject(); } }); }); //    VoxEngine.addEventListener(AppEvents.Terminating, function (e) { //      if (connected) { Logger.write("Dialed number: " + dialed_number + " Agent number: " + agent_number + " Date: " + call_date + " Length: " + call_length + " Record URL: " + record_url); //      HTTP     Net.httpRequest } else { //    Logger.write("Call failed. Code: " + failure_code + " Reason: " + failure_reason); //     HTTP     Net.httpRequest } }); //     function handleCallFailed(e) { failure_code = e.code; failure_reason = e.reason; VoxEngine.terminate(); } //     function handleCallDisconnected(e) { call_length = e.duration; VoxEngine.terminate(); } //    function handleCallsConnected(call1, call2) { connected = true; outbound_call.addEventListener(CallEvents.RecordStarted, function (e) { record_url = e.url; }); outbound_call.record(); // start call recording }</span></span></code> </pre> <br>  Save it under some name.  <b>Do not forget to make your web service a return number for forwarding and change wsURL in the code</b> <b><br></b> </li><li>  Now there are 2 options with numbers - you can take them <a href="https://manage.voximplant.com/">directly to VoxImplant</a> , or in <a href="https://manage.voximplant.com/">the SIP settings you can</a> register the address of your trunk, from where the calls will go to the platform. </li><li>  We go into editing the tracking application that we created earlier, and there in the Rules tab we create a new rule that needs to be named somehow, for example, InboundCalls, Pattern can be left. * If we want to send all incoming calls to be processed by our script, drag the script to Assigned and save. </li><li>  You can call </li></ol><br><br>  This is the simplest scenario that shows the concept of using VoxImplant for call tracking, you can complicate it and try to call a call to several numbers at once, or try to call several numbers one at a time.  If you need more rooms than you have in stock, you can always use the additional ones that the customer will enter when calling the number.  In this case, the code will need to add processing keystrokes, like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inbound_call, ext = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    VoxEngine.addEventListener(AppEvents.CallAlerting, function (e) { inbound_call = e.call; inbound_call.addEventListener(CallEvents.ToneReceived, function (callevent) { callevent.call.stopPlayback(); ext += callevent.tone; if (ext.length == 4) { wsURL += "?dialed_number=" + encodeURIComponent(dialed_number) + "&amp;ext=" + ext; //     Net.httpRequest(wsURL, function (res) { if (res.code == 200) { //     agent_number = res.text; //    outbound_call = VoxEngine.callPSTN(agent_number, dialed_number); //          VoxEngine.easyProcess(e.call, outbound_call, handleCallsConnected); outbound_call.removeEventListener(CallEvents.Disconnected); outbound_call.addEventListener(CallEvents.Disconnected, handleCallDisconnected); outbound_call.removeEventListener(CallEvents.Failed); outbound_call.addEventListener(CallEvents.Failed, handleCallFailed); } else { //  -  -  ,   -     inbound_call.reject(); } }); } }); inbound_call.addEventListener(CallEvents.Connected, function (callevent) { inbound_call.say(",  .", Language.RU_RUSSIAN_FEMALE); }); inbound_call.answer(); });</span></span></code> </pre><br>  Probably, you can come up with many more interesting things, but this is not included in the scope of this article.  It is important to remember that a full-fledged call-tracking service requires a lot of work and ready-made services that do this do not just take money for it.  I will be glad to answer any questions in the comments. </div><p>Source: <a href="https://habr.com/ru/post/250899/">https://habr.com/ru/post/250899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250887/index.html">Do not be evil</a></li>
<li><a href="../250891/index.html">Communication scripts from different browser tabs</a></li>
<li><a href="../250893/index.html">What is 1C. On a complex system in simple words</a></li>
<li><a href="../250895/index.html">DotNext Conference returns to Moscow - with new forces and updated name</a></li>
<li><a href="../250897/index.html">Konva.js - HTML5 2d canvas framework</a></li>
<li><a href="../250901/index.html">HTTP / 2 ready</a></li>
<li><a href="../250903/index.html">IBM Watson for Oncology: helping the cognitive system to fight cancer</a></li>
<li><a href="../250907/index.html">Custom login button on the Twitter SDK (Fabric kit)</a></li>
<li><a href="../250911/index.html">New Journal "Mathematical Modeling and Numerical Methods"</a></li>
<li><a href="../250913/index.html">Data Management with the OData Protocol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>