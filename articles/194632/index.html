<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Render a landscape in WebGL - 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part two 
 Welcome to the series of articles about WebGL landscape rendering used in Trigger Rally ! 

 If you haven't had time yet, then read the fir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Render a landscape in WebGL - 2</h1><div class="post__text post__text-html js-mediator-article"><h4>  Part two </h4><br>  Welcome to the series of articles about WebGL landscape rendering used in <a href="https://triggerrally.com/">Trigger Rally</a> ! <br><br>  If you haven't had time yet, then read the <a href="http://habrahabr.ru/post/194592/">first part</a> , in which I talk about the importance of minimizing data transfer between the processor and the video card, and also suggest storing static data about the height of each point of the landscape in the texture. <br><br>  In this article I will talk about the data structure of the vertices, as well as about morphing. <br><img src="https://habrastorage.org/getpro/habr/post_images/a4a/957/9be/a4a9579be84447b90ba8ea0e90f7d571.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>From the translator: the article has many inarticulate and technical inaccuracies.</i>  <i>Help fix them!</i> <br><a name="habracut"></a><br><h5>  Rings </h5><br>  Geoclipmap rendring operates with square ‚Äúrings‚Äù around the viewpoint, with each ring twice the size of the previous one, but half the resolution.  Due to this, we see a gradual decrease in the number of vertices per unit plane, according to the principle: further - less.  The inner ring is completely filled and has the highest resolution, becoming a simple square grid of triangles: <br><img src="https://habrastorage.org/getpro/habr/post_images/add/c3c/d2f/addc3cd2f11f8604422a7ddb9bf8eb71.png" alt="image"><br><br>  Repetitive geometry can be translated without particularly noticeable changes, but it will seem that the edges have moved slightly: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44b/fc8/4d4/44bfc84d442c962ffbc0a05f2d990f01.png"><br><br>  We can use this property to move the geometry relative to the camera. <br><br>  Since each ring of triangles has its own size, and the distance for transfer depends on the size, we must move the rings independently of each other.  Therefore, the vertex shader must know exactly which layer of vertices it moves to change it correctly. <br><br>  In general, we need to know the following vertex parameters: <br><ul><li>  X position </li><li>  Y position </li><li>  Layer number </li></ul><br>  In Trigger Rally, we use the [X, Y, Z] vector, and we also get the number of the layer where the vertex is located, according to its position along the Z axis. <br><br><h5>  Stitching holes </h5><br>  Each ring has its own scale, in addition, each ring is shifted by an amount depending on the scale.  Thus, a problem may arise - one ring is translated, but the next one is not, and a gap is formed between them: <br><img src="https://habrastorage.org/getpro/habr/post_images/cac/dae/0af/cacdae0af3e93e73f48fdd5a106ee92c.png" alt="image"><br><br>  One of the ways to solve this problem is to build up an additional ‚Äúskirt‚Äù on the edge of the ring.  According to <a href="http://research.microsoft.com/en-us/um/people/hoppe/gpugcm.pdf">this article</a> , the skirt is assembled from a variety of small pieces; several vertex buffers and complex processor logic are used for this.  But we don't want that at all! <br><br>  When implementing the landscape in the Trigger Rally, I spent hours trying to find a productive and high-quality way to collect the skirt, but alas, to no avail. <br><br>  But at the last WebGL Camp Europe, I met <a href="http://codeflow.org/">Florian B√∂sch</a> , and he offered to make the rings a little more, thus allowing them to intersect. <br><br>  Now any more or less experienced graphics programmer will start yelling: ‚ÄúNo!  You can not allow the intersection of geometry!  This is wasteful and <a href="http://en.wikipedia.org/wiki/Z-fighting">terrible</a> artifacts can appear! ‚Äù  But in fact, everything is not so bad - we really have to draw a little more, but if the geometry is well fitted, then this is really a great solution! <br><br><h5>  Morph </h5><br>  On the border of the rings, we have the geometry of one resolution, which is in contact with the geometry that is two times smaller.  We need to make transition regions on the edge of each ring, in which the geometry will smoothly ‚Äúflow‚Äù from high resolution to low, so that the edge of one ring strictly coincides with the edge of another. <br><img src="https://habrastorage.org/getpro/habr/post_images/59d/66c/ec2/59d66cec28f0d00042bfe4b1784dd3a2.png" alt="image"><br><br>  So, each vertex should be moved to match the following ring: <br><img src="https://habrastorage.org/getpro/habr/post_images/c82/316/9af/c823169af1ed735d10c45b83c90145d3.png" alt="image"><br><br>  We need to do this in the vertex shader.  The easiest way is to include the morph vector in the vertex data structure, but again, Florian suggested something better - to use <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BF%25D0%25BE_%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258E">modular arithmetic</a> ! <br><br>  To show how this works, let's present the data as a table: <br><br><img src="https://habrastorage.org/storage3/d34/042/70a/d3404270a227c29980b3b70a9e95baaa.png"><br><br>  Thus, we can calculate the morph vector, having only the coordinates of the vertices, using the following GLSL code: <br><br> <code>vec2 morphVector = mod(position.xy, 2.0) * (mod(position.xy, 4.0) - 2.0);</code> <br> <br>  And this is all without additional properties in the vertex structure!  ( <i>comment of the lane.: I take off my hat before this Florian</i> ) <br><br><h5>  Next will be ... </h5><br>  In the next post, I will talk about how the height map is stored in Trigger Rally and how it is processed in the vertex shader.  Then we will look at surface shading in the fragment shader, and finally, how to render the environment more effectively. <br><br>  <b>Thank you for reading!</b> </div><p>Source: <a href="https://habr.com/ru/post/194632/">https://habr.com/ru/post/194632/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194616/index.html">Objective Europa project: a trip to Europe ... one way</a></li>
<li><a href="../194618/index.html">Ion.Sound - plugin for playing sounds. Creation and features</a></li>
<li><a href="../194620/index.html">Procedural generation of three-dimensional models</a></li>
<li><a href="../194626/index.html">Interesting moments that you might not know about C # (Array)</a></li>
<li><a href="../194628/index.html">0 AD - free real-time strategy collects money on Indiegogo</a></li>
<li><a href="../194636/index.html">New mobile A / B testing framework from Facebook. Navigation panel redesign for iOS 5.6 & 7</a></li>
<li><a href="../194638/index.html">Bioprinter do it yourself</a></li>
<li><a href="../194640/index.html">Centrifuge is gaining momentum</a></li>
<li><a href="../194642/index.html">The age of our galaxy</a></li>
<li><a href="../194644/index.html">Winter, a smartphone and gloves, or prepare your finger in the summer ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>