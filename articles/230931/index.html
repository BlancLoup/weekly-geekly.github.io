<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quick Start ST Nucleo-F401 + Quick Start Guide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my previous post I tried to brief you on the ST Nucleo platform. 
 In this post, I want to tell you, on a live example, some of the strengths of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quick Start ST Nucleo-F401 + Quick Start Guide</h1><div class="post__text post__text-html js-mediator-article">  In my previous <a href="http://habrahabr.ru/post/230651/">post</a> I tried to brief you on the ST Nucleo platform. <br>  In this post, I want to tell you, on a live example, some of the strengths of this platform, which has every chance to press the bored to all Arduino, and show that all the Arduino code samples and shields are great for the Nucleo platform. <br><img src="https://habrastorage.org/getpro/habr/post_images/b95/114/b77/b95114b7769ebdf40839432f28c1142c.jpg"><br><a name="habracut"></a><br><br><h4>  Why Nuleo-F401? </h4><br><br>  Nuleo Platform It is a hybrid of DISCOVERY and Arduino platforms, allowing users to easily use almost all extensions and all code examples for 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Arduino.  This platform supports <a href="http://mbed.org/">MBED.ORG</a> , which <a href="http://mbed.org/">eliminates the</a> headache of many newbies in installing, configuring, and using compilers for ARM.  Almost all existing extensions for Arduino are imported to mbed.org.  Unlike the widely used <a href="http://habrahabr.ru/post/123791/">DISCOVERY</a> platform, which is widely used by many, the platform has no peripherals on its board, such as an accelerometer, a compass, etc.  But the Nucleo platform is designed to make work on it as simple as on the platforms from the Arduino.  The platform also has a flexible power scheme (3.3V-5V-7V-12V), a built-in updated ST-LINK / V2.1 programmer for programming any STM32, an integrated virtual COM port (connected to USART by default), a simplified microcontroller programming procedure thanks to emulation removable media giving access to the flash memory of the microcontroller. <br><br>  You can study the features of the STM32F401RE microcontroller on your <a href="http://www.compel.ru/lib/ne/2013/10/3-dlya-intensivnyih-vyichisleniy-stm32f401-s-ultranizkim-dinamicheskim-potrebleniem/">own</a> , I chose the ST Nucleo-F401, due to the fact that at the time of purchase it was the oldest available model, different from the rest, with its higher performance and large memory capacity. <br><br><h5>  Beginning of work! </h5><br><br>  To get started, we need to register on Mbed.org and add the platform we need to our list of devices. <br><br><div class="spoiler">  <b class="spoiler_title">Instructions for dummies, click to see</b> <div class="spoiler_text"><h5>  Register at Mbed.org </h5><br><br>  To do this, follow the link <a href="https://mbed.org/account/signup/">mbed.org/account/signup</a> and follow the instructions, fill out the registration form. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c94/e72/8d5/c94e728d53e208c8b53015492ef62b02.png"><br><br>  Select "No, I have not created an account before" (No, I have not previously created an account) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc2/783/273/dc2783273f979e2967ac8ba1c3780869.png"><br><br>  Fill in the registration form and click "SignUp" (Register) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffa/e39/c0d/ffae39c0dde6e4999fc275b66a376b5d.png"><br><br>  The message ‚ÄúWelcome to mbed!‚Äù Should appear.  Click here for MBED.HTM <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27f/ed8/e58/27fed8e58e9884c5408d39a67529846f.png"><br><br>  After this at the top left, click "Platform" and open the list of all platforms supported by the project, and in the list go to our platform (in our case it is Nucleo-F401RE). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7b/eba/8bb/c7beba8bbee5422e37254ad4dd092267.png"><br><br>  Having opened the platform description, we find the button ‚ÄúAdd to your mbed Compiler‚Äù on the left. Clicking it we add the selected platform to the list of our platforms. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e5/41d/28b/6e541d28b6587c84e582c28ad70a7301.png"><br><br>  Now let's click on your nickname (at the top right) and go to the main page of your profile, here at the bottom right we can see the newly added platform. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffb/4d8/2bf/ffb4d82bffe9727dd0fe84268577f119.png"><br><br>  Actually, we all registered and added our own platform. <br></div></div><br><br><h5>  Installing drivers. </h5><br>  On the site Mbed.org in the section of our platform, at the bottom we can see the <a href="http://www.st.com/stm32nucleo">link by</a> clicking on which we need to download, install and run: <br><ol><li>  you must first install the ST-LINK / V2-1 USB driver for the programmer, for Windows Vista, 7 and 8 <a href="http://www.st.com/web/en/catalog/tools/PF260218">STSW-LINK008</a> or <a href="http://www.st.com/web/en/catalog/tools/PF260219">STSW-LINK009</a> for Windows XP </li><li>  Update firmware of ST-LINK / V2-1 <a href="http://www.st.com/web/en/catalog/tools/PF260217">STSW-LINK007 USB-connected programmer</a> </li></ol><br><div class="spoiler">  <b class="spoiler_title">Instructions for dummies, click to see</b> <div class="spoiler_text">  Let's start in order, download the current Driver and firmware update on this page <a href="http://www.st.com/web/catalog/tools/FM116/SC959/SS1532/LN1847/PF260000">KLAC</a> <br>  we supposedly need two files one " <a href="http://www.st.com/web/en/catalog/tools/PF260217">ST-LINK / V2-1 firmware upgrade</a> " the second is allowed " <a href="http://www.st.com/web/en/catalog/tools/PF260218">ST-LINK / V2-1 USB driver on Windows Vista, 7 and 8</a> " <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9bc/574/753/9bc5747532fed564cf93efbcc21720ee.png"><br><br>  We unpack the archives downloaded by us, and we start. <br>  Start the installation of the drivers: in the unpacked STSW-LINK008 or STSW-LINK009 archive, launch the file under the name <b><i><u>stlink_winusb_install</u></i></b> for our board (the board is not yet connected via USB). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e59/779/e3f/e59779e3fee5ce6e5be3bd1fb0a0f889.png"><br><br>  Run this file, which will determine the system width and type of installation.  We agree with everything, and click yes, further, etc. <br>  Now we can connect our board via USB and see that the LEDs light up and you have decided on a new removable media. <br><br>  We launch the firmware update of our platform programmer: <br>  To do this, we connect our debugging platform to the computer, go to the folder with the unpacked update archive of the STSW-LINK007 programmer and launch the ST-LinkUpgrade file <br><br><img src="https://habrastorage.org/getpro/habr/post_images/856/0e5/b98/8560e5b988417f7ce0f25426b2a4cec9.png"><br><br>  In the window that appears, click "Device Connect" (Device Connect), after updating the device and connecting to it, click "Yes &gt;&gt;&gt;" the program itself will do everything and disconnect from the device at the end, then you can close it. <br><br>  All this installation of fresh drivers and firmware updates is over. <br></div></div><br><br><h5>  Platform Connection: </h5><br>  For the curious, I will try to explain some modes of operation in more detail: <br><div class="spoiler">  <b class="spoiler_title">Information for the curious, click to see.</b>  <b class="spoiler_title">CAUTION!</b> <div class="spoiler_text"><h5>  Brief technical information from the manual </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/030/5d5/47d/0305d547d52b3c925508f9ef4d1fbcc3.png" alt="image"><br><h6>  Modes of operation of the LEDs. </h6><br>  3 LEDs are implemented on the board <br>  Three-color LED (green, orange, red) <b>LD1 (COM)</b> provides information on the status of ST-LINK connection.  <b>LD1</b> color is <b>red</b> by default.  <b>LD1</b> turns green, indicating that in the process of making the connection between the PC and ST-LINK / V2-1, in the following: <br><ul><li>  ‚ÄúSlow flashing red‚Äù / ‚ÄúOff‚Äù - when power on prior to establishing a USB connection </li><li>  ‚ÄúFlashing red quickly‚Äù / ‚ÄúOff‚Äù - after the first correct data exchange between the PC and STLINK / V2-1 (connection process) </li><li>  ‚ÄúRed LED on‚Äù - if the connection between the PC and ST-LINK / V2-1 is established </li><li>  ‚ÄúGreen is on: connection succeeded or operation completed correctly </li><li>  "Flashing red" / "green" - during data transfer. (The firmware process itself) </li><li>  ‚ÄúOrange on‚Äù: Communication failure. </li></ul><br><br>  <b>USER LD2</b> : green user LED, the LED is connected to the Arduino contact D13, corresponding to the input / output contact of the <b>PA5</b> microcontroller (pin 21) or <b>PB13</b> (pin 34) <br><ul><li>  When the input / output (I / O) value is high, the LED is on. </li><li>  When the input / output (I / O) value is low, the LED is off. </li></ul><br><br>  <b>LD3 PWR</b> : a red LED indicates that the microcontroller part is powered and +5 V power is being supplied. <br><br><h6>  Buttons </h6><br>  <b>B1 USER</b> : user button is connected to PC13 input / output (pin 2) of the STM32 microcontroller. <br>  <b>B2 RESET</b> : this button connects to the <b>NRST</b> , and is used to reset the STM32 microcontroller. <br><br>  <b>Note:</b> <i>Blue and black plastic caps on the buttons can be removed if necessary, for example, when the shield or expansion card is connected on top of the Nucleo.</i>  <i>This will avoid pressure on the buttons and consequently possible constant accidental pressing.</i> <i><br></i> <br><br><h6>  Jumper JP6 (IDD) </h6><br>  Jumper <b>JP6</b> , labeled <b>IDD</b> , is used to measure the current consumption by the microcontroller, to do this, remove the jumper and connect an ammeter. <br><ul><li>  Jumper Enabled: STM32 microcontroller is powered (default). </li><li>  Jumper OFF: the ammeter must be connected to measure the current of the STM32 microcontroller.  If there is no ammeter, the STM32 microcontroller is not powered. </li></ul><br><br><h6>  Built-in ST-LINK / V2-1 </h6><br>  The in-circuit debugger / programmer ST-LINK / V2-1 only supports SWD for STM32 devices. <br>  Changes from ST-LINK / V2 version: <br>  New features supported in ST-LINK / V2-1: <br><ul><li>  USB drivers renumbered </li><li>  Virtual COM Port USB Interface </li><li>  Interface USB storage devices </li><li>  USB power manager </li></ul><br>  Features not supported ST-LINK / V2-1: <br><ul><li>  SWIM interface. (Needed for STM8 programming) </li><li>  Minimum supported application voltage limited to 3 V </li></ul><br>  Modes of operation of the built-in ST-LINK / V2-1: <br><table><tbody><tr><th>  Jumper Status </th><th>  Value </th></tr><tr><td>  both CN2 jumpers are dressed </td><td>  ST-LINK / V2-1 works by programming the microcontroller on the board (default) </td></tr><tr><td>  both CN2 jumpers removed </td><td>  ST-LINK / V2-1 works by programming the microcontroller via external connector CN4 (SWD is supported) </td></tr></tbody></table><br>  SWD pinout: <br><table><tbody><tr><th>  Pin </th><th>  CN4 </th><th>  Value </th></tr><tr><td>  one </td><td>  VDD_TARGET </td><td>  Vdd for device </td></tr><tr><td>  2 </td><td>  SWCLK </td><td>  SWD tact </td></tr><tr><td>  3 </td><td>  GND </td><td>  Land </td></tr><tr><td>  four </td><td>  SWDIO </td><td>  SWD data input / output </td></tr><tr><td>  five </td><td>  NRST </td><td>  reset programmable MK </td></tr><tr><td>  6 </td><td>  Swo </td><td>  Not used </td></tr></tbody></table><br><br><h6>  PCB Splitting </h6><br>  The STM32 Nucleo platform PCB is divided into two parts: the ST-LINK part and the target MCU part, which can be divided to reduce the size of the board.  In this case, the remaining target MCU part can be powered only by VIN, E5V and 3.3V on the ST Morpho CN7 or VIN connector and 3.3 on the Arduino CN6.  You can still use the ST-LINK part to program the main microcontroller using wires between the CN4 SWD and the connectors on the ST Morpho ( <b>SWCLK</b> CN7 <i>pin-15</i> and <b>SWDIO</b> CN7 <i>pin-13</i> ). <br><br><h6>  Board power modes. </h6><br>  The power supply is provided either from a computer via a USB cable or from an external source: VIN (7V-12V), E5V (5V) or + 3V3 power leads to CN6 or CN7. <br>  ST-LINK / V2-1 supports platform power via USB, while the programmer itself consumes current up to 100 mA. <br><br>  The entire STM32 Nucleo card including the expansion cards can be powered by ST-LINK USB provided that the total current consumption does not exceed 300mA (Including ST-LINK consumption 100 mA) when these conditions are met the red LD3 LED is on and the micro controller is working.  If the current consumption is higher, then it is necessary to use an external power supply for the entire project or only for expansion cards (not forgetting the common ground). <br><br>  When the board will be powered by USB (U5V), the jumper must be connected between pins 1 and 2 of JP5 to the U5V position.  <b>JP1</b> jumper can be installed only in the case when the board is powered by USB and the maximum current consumption on U5V should not exceed 100 mA (including various expansion cards or Arduino Shield). <br><br>  VIN (7V-12V) or E5V (5V-5.5V) can be used as an external power source in the case when the current consumption of Nucleo and expansion cards exceeds the permissible current for USB.  In this state, you can still use a USB connection, for programming or debugging, but first, be sure to connect the board to a power source using VIN or E5V, and then connect the USB cable to the PC. <br><br>  When powered by VIN or E5V, the power-on algorithm should be followed: <br><ul><li>  Connect a jumper between pins 2 and 3 of JP5. </li><li>  Make sure JP1 is removed. </li><li>  Connect external power supply to VIN or E5V. </li><li>  The voltage on the external power supply is 7 V &lt;VIN &lt;12 V to VIN or 5 V for E5V. </li><li>  Make sure LD3 is on. </li><li>  Connect your PC to the CN1 USB connector. </li></ul><br>  If this order is not observed, then the board can be powered first via VBUS and then via VIN or E5V, while the USB port on the computer may fail or glitches of the microcontroller may occur (! The same applies to the reset button!) <br>  When the board is powered by VIN or E5V, the jumper configuration should be as follows: <br><ul><li>  Jumper on JP5 between pin 2 and pin 3. </li><li>  Jumper removed on JP1. </li></ul><br>  External power supply: <br><table><tbody><tr><th>  Power input </th><th>  Connector Contacts </th><th>  Voltage </th><th>  Current </th><th>  Restriction </th></tr><tr><td>  VIN </td><td>  CN6 pin 8, CN7 pin 24 </td><td>  from 7V to 12V </td><td>  800 mA </td><td>  800 mA if Vin = 7 V, 450 mA if 7 V &lt;Vin (&lt;or =) 9 V, 250 mA if 9 V &lt;Vin (&lt;or =) 12 V </td></tr><tr><td>  E5V </td><td>  CN7 pin 6 </td><td>  from 4.75V to 5.25V </td><td>  500 mA </td></tr></tbody></table><br><img src="https://habrastorage.org/getpro/habr/post_images/677/dab/486/677dab4863019876cf3ce8cdad2ee797.jpg"><br>  (Actually micro manul is over. You can exhale and continue) <br></div></div><br>  For the rest, it is enough to remember that the board has a jumper JP5 and it has two positions, the microcontroller is powered from USB (U5V position is not more than 300mA) or from an external source (E5V) power supply, for example, from 5 volts connected to CN7 (the most Left connector, pin -6 E5V and pin-8 GND).  <a href="">Connector layout</a> <br><br>  And so we connected and saw that a removable media was detected in our computer, this is a sign that everything was done correctly and everything works.  You can check whether the microcontroller itself works correctly by pressing the user button; when clicking on it, the flickering frequency of the user LED should change.  Having played enough with the LED go further. <br><br>  Now is the time to create our first program in Embed and flash our controller with it. <br>  I will clean up similar subsections under spoler to save space. <br><div class="spoiler">  <b class="spoiler_title">First program and first programming</b> <div class="spoiler_text"><h5>  First program and first programming </h5><br><h6>  Creating a draft program in Mbed </h6><br>  On the page of your profile in Mbed, we open a page with our platform, then using pictures as help, we do the following: <br>  (1) Open online compiler <br><img src="https://habrastorage.org/getpro/habr/post_images/b6a/cea/6bf/b6acea6bfc646e13eaa80f039a48d6b4.png"><br>  (2-3) Create a project called "Blinky LED test for the ST Nucleo boards" and click "OK" <br><img src="https://habrastorage.org/getpro/habr/post_images/b86/454/bbd/b86454bbde7075b4c0077ba84b2aef0a.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/184/cd2/446/184cd24463ea2c6a4cc781a8d951b794.png"><br>  (4 - 5) Open and compile the binary file (5). <br><img src="https://habrastorage.org/getpro/habr/post_images/8f7/d00/f14/8f7d00f14009657f2a52d511ce6c5098.png"><br>  After that, we will be asked to save this binary (the procedure depends on your browser).  We simply copy the resulting binary or move it to Nucleo removable media, and if you update the content of the removable media immediately after copying, you will not be able to see it, which indicates that the micro controller is re-flashed!  (during the firmware you will see the LED_COM LED blinking cheerfully) <br></div></div><br><br>  The post was written all night and will soon be supplemented with examples, I want to note that any extensions from the Arduino easily fit under the Nucleo, there are no problems with the sketches either. </div><p>Source: <a href="https://habr.com/ru/post/230931/">https://habr.com/ru/post/230931/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230915/index.html">Quad-core Xperia T3 smartphone is now available!</a></li>
<li><a href="../230921/index.html">Another reason to switch to SSL, or 133 KB is not superfluous.</a></li>
<li><a href="../230923/index.html">The Ministry of Internal Affairs of the Russian Federation announced a competition, the purpose of which is to ‚Äúhack‚Äù TOR</a></li>
<li><a href="../230925/index.html">Job Interview for Automation QA Engineer</a></li>
<li><a href="../230927/index.html">Javascript for ... desktop ip phone?</a></li>
<li><a href="../230933/index.html">Key trends in the market of digital agencies / studios and golden hundred Ruward</a></li>
<li><a href="../230937/index.html">ViMove helps you understand what‚Äôs wrong with your back.</a></li>
<li><a href="../230939/index.html">How I improved the performance of SSRS reports</a></li>
<li><a href="../230941/index.html">Modular comics - an easy way to captivate an audience</a></li>
<li><a href="../230943/index.html">Level generation in the arcade on the example of indie game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>