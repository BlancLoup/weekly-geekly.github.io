<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What are the controllers in PR2?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! We continue to follow the development of the symfony 2 framework. In this topic, we will try to follow the discussion: what will be the mechani...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What are the controllers in PR2?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9a0/44a/5f2/9a044a5f25557ee24dd114cbe0049cd4.jpg" align="left">  Hello!  We continue to follow the development of the <a href="http://symfony-reloaded.org/">symfony 2</a> framework.  In this topic, we will try to follow the discussion: what will be the mechanism of controllers in the new release of Symfony 2 (PR2).  Under the cut there are 6 options for building the interface of the controller model MVC. <br><a name="habracut"></a><br>  Symfony 2 is currently in the Preview Release (PR1) stage.  Judging by the number of messages on <a href="http://twitter.com/fabpot">Twitter Fabien</a> and developer Doctrine 2 <a href="http://twitter.com/jwage">Jonathan Wage</a> from Sensio Labs, the work on the framework is in full swing.  For example, in recent days, as many as 4 new components have appeared that can be found <a href="http://www.phparch.com/2010/04/22/four-new-php-5-3-components-and-goutte-a-simple-web-scraper/">here</a> .  More details about the individual components can be found in my translations about the <a href="http://habrahabr.ru/blogs/symfony/91689/">Finder</a> and <a href="http://habrahabr.ru/blogs/symfony/90664/">CssSelector</a> .  Also worth noting is the large number of <a href="http://groups.google.com/group/symfony-devs/">discussions related to symfony 2 on google groups</a> .  In parallel with the development of the framework, the second branch of the popular <a href="http://www.doctrine-project.org/documentation/2_0/en">Doctrine</a> ORM and the <a href="http://www.twig-project.org/">TWIG</a> template engine is <a href="http://www.twig-project.org/">intensively developing</a> .  All this, together with the development of PHP 5.3 itself, creates an image of such a growing technological organism, the development of which is very interesting to follow.  A little later, buy a bottle of champagne, put in a bar and look forward to the final release.  Sorry, a little distracted, let's follow the thoughts of the Symfony Community about improving the mechanism of controllers during the transition to the stage of the Symfony 2 PR2 framework (see links to the discussion at the end of the topic) and maybe even take an active part in it: RFC discussion status propose an interesting idea and thereby improve the framework. <br><br>  In fact, this is not quite a translation, but still the main part of the material is taken from one source, so I decided to issue it as a translation.  There is a lot of text, but it is structured and easy to read, so everything is in one topic. <br><br><h4>  <b><font color="#000">Controllers</font></b> </h4><br>  In Symfony 2, the controller can be any valid callable construct: a function, a class / object method, or a lambda / closure.  In this topic we will discuss the controller as an object method, as the most common case. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order to do its work (call the Model to pass parameters to the View), the controller must have access to some parameters (strings) and services (objects): <ul><li>  <b>Parameters</b> : requests coming from the object (path variables (/ hello /: name), GET / POST parameters, HTTP headers) and global variables (which are processed by <a href="http://components.symfony-project.org/dependency-injection/">Dependency Injector</a> ). </li><li>  <b>Services</b> (‚Äúglobal‚Äù objects) received from a <a href="http://components.symfony-project.org/dependency-injection/">Dependency Injector</a> (such as a request object, User object, email object ( <a href="http://swiftmailer.org/docs/introduction">Swift Mailer</a> ), database connection, etc.) </li></ul>  The controller is the central part of the MVC view, so special care is needed when choosing the best version of its interface, and the path for passing parameters and access to services to it.  The decision to choose the best interface option should be made considering these issues (in order of decreasing importance): <br><ol><li>  How easy / intuitive to create a new controller? </li><li>  how fast is its implementation? </li><li>  How easy is it to test it automatically (unit tests)?  [in the topic I do not consider these questions, in the additional links it is] </li><li>  How verbose / compact to access parameters and services? </li><li>  How does the implementation meet the concept of separation and the MVC design pattern? </li></ol>  As a matter of fact, this is the basis from the point of view of which we will evaluate various options for the controller interfaces for Symfony 2. <br><br><h4>  <b><font color="#000">Option 1. This is the mechanism of controllers in Symfony 2 now (PR1):</font></b> </h4><br>  To provide access to services and parameters, Symfony inserts a container into the controller's constructor (which is then stored in the protected property): <br><blockquote><code><font color="black">$controller = <font color="#0000ff">new</font> Controller($container); <br></font></code> </blockquote><br><h5>  <b>Access to parameters and services</b> </h5><br>  When an action is executed, the method's arguments are inserted by matching their names with the path variables: <br><blockquote> <code><font color="black">function showAction($slug){ ... } <br></font></code> </blockquote>  The slug argument will be passed if the corresponding path has the variable slug: <b>/ articles /: slug</b> . <br><br>  Passing path variables is this: <ol><li>  if the name of the argument matches the name of the path variable, we use this value ($ slug in the example, even if it is not passed to the URL and the default value is defined); </li><li>  if not, and if the default value for the argument is defined, and if the argument is optional, we use the default value; </li><li>  if not, we throw an exception. </li></ol>  Access to the parameters is as follows: <br><blockquote> <code><font color="black">function showAction($slug) <br> { <br> <font color="#008000">//       </font> <br> <font color="#008000">// :</font> <br> $global = $ <font color="#0000ff">this</font> -&gt;container-&gt;getParameter( <font color="#A31515">'max_per_page'</font> ); <br> <font color="#008000">//  :</font> <br> $global = $ <font color="#0000ff">this</font> -&gt;container[ <font color="#A31515">'max_per_page'</font> ]; <br> <br> <font color="#008000">//    ,   request</font> <br> $limit = $ <font color="#0000ff">this</font> -&gt;container-&gt;request-&gt;getParameter( <font color="#A31515">'max'</font> ); <br> <font color="#008000">//     ,       :</font> <br> $limit = $ <font color="#0000ff">this</font> -&gt;request-&gt;getParameter( <font color="#A31515">'max'</font> ); <br> } <br></font></code> </blockquote><br>  Access to services is as follows: <br><blockquote> <code><font color="black">function indexAction() { <br> <font color="#008000">//   </font> <br> $ <font color="#0000ff">this</font> -&gt;container-&gt;getUserService()-&gt;setAttribute(...); <br> <br> <font color="#008000">//      </font> <br> $ <font color="#0000ff">this</font> -&gt;container-&gt;user-&gt;setAttribute(...); <br> } <br></font></code> </blockquote><br><h5>  <b>Advantages and disadvantages:</b> </h5><br>  As obvious advantages one can single out clarity, simplicity, good speed and convenient testing of containers of specific types. <br><br>  Disadvantages: <ol><li>  The controller is loaded with a container (separation of entities); </li><li>  Enough open access to the container, which requires accuracy from the developer; </li><li>  Access to parameters and services is somewhat verbose; </li><li>  Developers can start thinking in the so-called sfContext context.  That is, if they have access to the container from the controller, it is easy to transfer it to the model class, but this is not the best idea; </li><li>  When testing, the developer will be forced to familiarize himself with the implementation and to know which services the controller has access to. </li></ol><h4>  <b><font color="#000">Option 2</font></b> </h4><br>  This option is different from the previous work with the parameters / services.  Instead of transferring to the container constructor, we pass only the necessary parameters and services: <br><blockquote> <code><font color="black"><font color="#0000ff">protected</font> $user, $request, $maxPerPage; <br> <br> function __construct(User $user, Request $request, $maxPerPage) <br> { <br> $ <font color="#0000ff">this</font> -&gt;user = $user; <br> $ <font color="#0000ff">this</font> -&gt;request = $request; <br> $ <font color="#0000ff">this</font> -&gt;maxPerPage = $maxPerPage; <br> } <br></font></code> </blockquote><br>  In fact, it is not difficult to notice that the first option is to some extent a special case of this option, that is, the options are quite compatible. <br><br><h5>  <b>Access to parameters and services</b> </h5><br>  Access to parameters and methods is similar to the previous version, a little more brief: <br><blockquote> <code><font color="black">function showAction($slug) <br> { <br> <font color="#008000">//     ,   </font> <br> $limit = $ <font color="#0000ff">this</font> -&gt;request-&gt;getParameter( <font color="#A31515">'max'</font> ); <br> <font color="#008000">//      </font> <br> $global = $ <font color="#0000ff">this</font> -&gt;maxPerPage; <br> $ <font color="#0000ff">this</font> -&gt;user-&gt;setAttribute(...); <br> } <br></font></code> </blockquote><br><h5>  <b>Advantages and disadvantages:</b> </h5><br>  Advantages: <ol><li>  Gives great flexibility and is fully compatible with the first option; </li><li>  Gives you the ability to control types when passing parameters / services; </li><li>  Clearer dependencies; </li><li>  Not a big invoice code; </li></ol>  Disadvantages: <ol><li>  The constructor requires all services and parameters (but in most cases only a few will be used) - but it is reassuring that you can use the container method in these cases; </li><li>  More sample code: now the developer needs to store all transferred services in protected variables. </li></ol><h4>  <b><font color="#000">Option 3</font></b> </h4><br>  Instead of inserting services into the constructor, in this version they are directly inserted into each controller method: <br><blockquote> <code><font color="black">function showAction($slug, $userService, $doctrineManagerService, $maxPerPageParameter){ ... } <br></font></code> </blockquote>  The argument can be a path variable, a service, or a global parameter, and the rules for passing parameters should be specified: <ol><li>  If the argument name ends with ‚ÄúService‚Äù, we use the corresponding service ($ userService in the example); </li><li>  If the argument name ends with ‚ÄúParameter‚Äù, we use the corresponding parameter with the Dependency Injector ($ maxPerPageParameter in the example); </li><li>  If not, and if the name of the argument matches the path variable, we use it ($ slug in the example); </li><li>  In other cases, if the argument is not defined, we throw an exception. </li></ol>  If you do not want to describe all the services / parameters in the method signature, you can use the container (as done in the previous version): <br><blockquote> <code><font color="black"><font color="#008000">//    `slug`  </font> <br> function showAction($slug, Container $containerService){ ... } <br> <br> <font color="#008000">//  Request  </font> <br> function showAction(Request $requestService, Container $containerService){ ... }</font></code> </blockquote> <h5>  <b>Access to parameters and services</b> </h5><br>  In this case, access to parameters and services is carried out almost directly: <br><blockquote> <code><font color="black">function showAction($id, $userService, $doctrineManagerService) { <br> $user-&gt;setAttribute(...); <br> } <br></font></code> </blockquote><h5>  <b>Advantages and disadvantages:</b> </h5><br>  Advantages: <ul><li>  Every action is independent and autonomous; </li><li>  Inside the method is a short and clear code; </li><li>  Good performance (as we ourselves do the analysis and analysis of the arguments of the method); </li><li>  Very flexible option (you can use a full container if you want). </li></ul>  Disadvantages: <ul><li>  If we have a large list of path variables and a list of services, the signature can be very verbose ‚Äî but the fact that you can create a Request and a container in such a case is reassuring: <br><blockquote> <code><font color="black">function showAction($year, $month, $day, $slug, $userService, $doctrineManagerService) { ... } <br></font></code> </blockquote></li><li>  Methods become similar to functions (as nothing unites them); </li><li>  Even if we pass services as method arguments, some of them may be optional for the method.  In this case, we get even more extra code than accessing services from the container on demand. </li></ul><h4>  <b><font color="#000">Option 4</font></b> </h4><br>  This option is a mixture of options 2 and 3. Services and parameters can be passed both to the constructor and to the actions methods: <br><blockquote> <code><font color="black"><font color="#0000ff">protected</font> $user; <br> <br> function __construct(User $user) { <br> $ <font color="#0000ff">this</font> -&gt;user = $user; <br> } <br> <br> function showAction($slug, $mailerService, $maxPerPageParameter){ ... } <br></font></code> </blockquote>  In this variant there is no problem anymore, that the methods become similar to functions from PHP4.  You can create global services for the class, and local for each action method. <br><br>  This approximation is 100% compatible with the first option, when everything is optional everywhere.  You can use parameters in both the constructor and actions, or use the default container (or make it context sensitive). <br><br>  It also allows you to emulate actions from a symfony 1.x branch: <br><blockquote> <code><font color="black">function showAction(Request $requestService){ ... } <br></font></code> </blockquote><br>  Since this is the most flexible option, the documentation should contain best practices. <br><br><h4>  <b><font color="#000">Option 5</font></b> </h4><br>  An option is a nearly complete copy of option 4, except that path variables cannot be included in the actions methods.  This allows you to remove unnecessary suffixes (Parameter and Service).  And access to path variables occurs through a call to the request object: <br><blockquote> <code><font color="black"><font color="#0000ff">protected</font> $user; <br> <br> function __construct(User $user) { <br> $ <font color="#0000ff">this</font> -&gt;user = $user; <br> } <br> <br> function showAction(Request $request, $mailer, $maxPerPage) { <br> $id = $request-&gt;getPathParameter( <font color="#A31515">'id'</font> ); <br> <font color="#008000">// ...</font> <br> } <br></font></code> </blockquote>  Another good agreement may be to include the Request object as the first argument (for the approach sequence). <br><br><h4>  <b><font color="#000">Option 6</font></b> </h4><br>  Another alternative would be to use annotations to include parameters.  This is not specifically discussed yet, because Symfony 2 does not use annotations yet. <br><br><h5>  <b>Advantages and disadvantages:</b> </h5><br>  Advantages: <br><ul><li>  Some third-party libraries have begun to use annotations (Doctrine 2, but for now, optional). </li></ul>  Disadvantages: <ul><li>  Additional code; </li><li>  PHP developers rarely use annotations; </li><li>  Annotations are not the native construction of the PHP language. </li></ul>  Additional information can be obtained from the additional links below.  In the comments, it is interesting to read which version you like best, or maybe someone will offer something new.  I personally like options 1 and 5. <br><br>  <b>Useful links</b> : <a href="http://symfony-reloaded.org/rfc/controllers">RFC: Controllers in Symfony 2</a> and discussion on google groups: <a href="http://groups.google.com/group/symfony-devs/browse_thread/thread/376950495c8025ce">part 1</a> , <a href="http://groups.google.com/group/symfony-devs/browse_thread/thread/210d2ad7ad0ae45f">part 2</a> , <a href="http://groups.google.com/group/symfony-devs/browse_thread/thread/e7ad8f72647749fe">part 3</a> . </div><p>Source: <a href="https://habr.com/ru/post/92066/">https://habr.com/ru/post/92066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../92061/index.html">DOCOMO, Fujitsu, NEC, Panasonic and Sharp are going to develop a new platform for mobile applications</a></li>
<li><a href="../92062/index.html">Google will help in the experiment "Mars-500"</a></li>
<li><a href="../92063/index.html">The first YouTube video turned 5 years old</a></li>
<li><a href="../92064/index.html">Fractals and GUI</a></li>
<li><a href="../92065/index.html">DEVCONF 2010 - May 17th the program is published - authors PHP, MySQL, Perl, Ruby, Sphinx come</a></li>
<li><a href="../92068/index.html">uHHHuu.ru - an attempt to make life easier for a motorist in a big city</a></li>
<li><a href="../92070/index.html">[C # /. NET] Generate machine code using LLVM</a></li>
<li><a href="../92072/index.html">Annoying "Apple" - or how I got the job</a></li>
<li><a href="../92074/index.html">RapidShare begins to take domains from satellite sites</a></li>
<li><a href="../92076/index.html">CloudMade Navigation supports maneuver restrictions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>