<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Application integration on Windows Phone with SkyDrive</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi% username%! 

 To be honest, I did not expect so many people to add to my favorites my previous post . In fact, this is good news: the platform is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Application integration on Windows Phone with SkyDrive</h1><div class="post__text post__text-html js-mediator-article">  Hi% username%! <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/987/b69/70e/987b6970e5749a04ea1c81574991b0b9.png"></div><br>  To be honest, I did not expect so many people to add to my favorites my previous <a href="http://habrahabr.ru/blogs/windows_mobile/135706/">post</a> .  In fact, this is good news: the platform is actively developing and promoting, which attracts the attention of developers.  Today I want to consecrate the theme of working with SkyDrive from the app.  The article, like last time, will be based on a real case: I needed to enable the user to share the file in social networks. <br><br><a name="habracut"></a><br><h4>  Skydrive </h4><br>  For those who do not know - SkyDrive is an analogue of Microsoft's Dropbox: cloud storage with a capacity of 25 GB.  SkyDrive is rather closely integrated with Windows Phone: in many marketing companies it is put in place of the lack of the possibility of using memory cards, a sort of "cloud flash drive."  For example, if you want to share a photo on Twitter, the photo will be uploaded to skydrive and a link to it will be posted to Twitter.  Let's implement the same functionality in our application. <br><br><h4>  Live SDK </h4><br>  To work with us, first of all, you need the Live SDK, which can be downloaded from the <a href="http://www.microsoft.com/download/en/details.aspx%3Fdisplaylang%3Den%26id%3D28195">link</a> .  With this SDK, we can do the following: <br><ul><li>  Create / Open / Update / Delete folders </li><li>  Do the same with albums (a special kind of folder containing media files) </li><li>  Add / Delete Files </li><li>  Read / Change file / folder / album properties </li><li>  Move / Copy files / folders / albums </li><li>  Share files / folders / albums </li></ul><br>  Next, we need to get Client ID and Client Secret for our application.  This can be done at the following <a href="https://manage.dev.live.com/Applications/Index">link</a> .  <b>Do not forget to specify in the API Settings tab that our application is a mobile client</b> .  Everything, now it is possible to begin to develop the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Authorization </h4><br>  First of all, we need to authorize our application to use SkyDrive.  After installing the Live SDK, you will be able to use the new interface element: SignInButton. <br><br><img src="https://habrastorage.org/storage2/658/fd2/365/658fd23658de19abee5bf42a81d9c300.png"><br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my:SignInButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"signInButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"72"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"143,511,153,0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Top"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Branding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Skydrive"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ClientId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RedirectUri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://oauth.live.com/desktop"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scopes</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wl.basic wl.photos wl.skydrive wl.offline_access wl.signin wl.skydrive_update"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SessionChanged</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"signInButton1_SessionChanged"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TextType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SignIn"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><br>  Let's look at the basic parameters: <br><br>  <b>Branding</b> - the icon displayed on the button (it can also take the values ‚Äã‚Äã"Windows", "Hotmail", "Messenger"); <br>  <b>ClientId</b> - ID of your application, obtained above; <br>  <b>RedirectUri</b> - redirect address; <br>  <b>Scopes</b> - permissions required by the application.  Here we have indicated that we will log in, use SkyDrive, use the API for working with galleries and something else.  Read more about the different types of Scopes, you can read the <a href="http://msdn.microsoft.com/en-us/library/hh243646.aspx">link</a> ; <br>  <b>SessionChanged</b> - our authorization handler; <br>  <b>TextType</b> - the text on the button.  It can also be of several types: SignIn, Login, Connect and custom. <br><br>  Now let's look at the handler: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signInButton1_SessionChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, Microsoft.Live.Controls.LiveConnectSessionChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Session != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; e.Status == LiveConnectSessionStatus.Connected) { App.Session = e.Session; } }</code> </pre><br><br>  I prefer to store the session in App.xaml.cs: this will allow you to work with the API from any part of the application. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LiveConnectSession session = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LiveConnectSession Session { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> session; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { session = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br><br>  Do not forget to specify the namespace: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Live;</code> </pre><br><br>  Now, when you click on the <b>Sign In</b> button, you will be prompted to log in with your Live ID and allow the application to use the functions that we have specified in <b>Scopes</b> . <br><br> <a href=""><img src="https://habrastorage.org/storage2/f4b/26f/580/f4b26f5807f6907e9b4baca5ec704533.png"></a> <br><br><h4>  Create / check for a folder </h4><br>  In order to post a photo in a folder or album, you need to know its ID.  Accordingly, when you create a folder, you are returned, including its ID.  You can create an album, get its ID, record it in <b>IsolatedStorageSettings,</b> and then upload photos using it.  But if the user deletes the folder, or the folder with the specified name will already exist, then upload the photo in a similar way will not work.  Therefore, I prefer to always first get a list of folders, check for the presence of the desired folder.  And, if it is present, we upload files; if it is absent, we first create a folder, and then we load the file. <br><br>  Getting the list of files and checking: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SkyDriveContent</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } List&lt;SkyDriveContent&gt; ContentList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;SkyDriveContent&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAlbum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (App.Session == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"You must sign in first."</span></span>); Waiting.Visibility = Visibility.Collapsed; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { txtStatus.Text = <span class="hljs-string"><span class="hljs-string">"Checking album"</span></span>; LiveConnectClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LiveConnectClient(App.Session); client.GetCompleted += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventHandler&lt;LiveOperationCompletedEventArgs&gt;(clientDataFetch_GetCompleted); client.GetAsync(<span class="hljs-string"><span class="hljs-string">"/me/skydrive/files"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientDataFetch_GetCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, LiveOperationCompletedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Error == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; data = (List&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;)e.Result[<span class="hljs-string"><span class="hljs-string">"data"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; content <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data) { SkyDriveContent skyContent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SkyDriveContent(); skyContent.Name = (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)content[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (skyContent.Name == <span class="hljs-string"><span class="hljs-string">"SkyDriveTest"</span></span>) { albumID = (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)content[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]; } ContentList.Add(skyContent); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (albumID == <span class="hljs-string"><span class="hljs-string">""</span></span>) CreateAlbum(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> UploadPhoto(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"Error calling API: "</span></span> + e.Error.ToString()); Waiting.Visibility = Visibility.Collapsed; } }</code> </pre><br><br>  For parsing, I use the intermediate class SkyDriveContent, which stores folder names and their IDs.  We check the names of all folders that are in the root of our SkyDrive.  If the folder name ‚ÄúSkyDriveTest is found, then we take its ID, if we don‚Äôt find such a folder, we create it using a POST request: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateAlbum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { txtStatus.Text = <span class="hljs-string"><span class="hljs-string">"Creating album"</span></span>; Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; fileData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(); fileData.Add(<span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"SkyDriveTest"</span></span>); LiveConnectClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LiveConnectClient(App.Session); client.PostCompleted += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventHandler&lt;LiveOperationCompletedEventArgs&gt;(CreateAlbum_Completed); client.PostAsync(<span class="hljs-string"><span class="hljs-string">"me/albums"</span></span>, fileData); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateAlbum_Completed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, LiveOperationCompletedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Error == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { JObject jObject = JObject.Parse(e.RawResult); albumID = (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)jObject[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]; UploadPhoto(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"Error calling API: "</span></span> + e.Error.ToString()); Waiting.Visibility = Visibility.Collapsed; } }</code> </pre> <br><br>  When we create a folder, the server in response sends us its properties in JSON format, including the ID.  For deserialization, I use Json.NET, which is available in NuGet. <br><br><h4>  Upload and Share Photos </h4><br>  Now that we have a folder ID, we can upload a photo.  The photo in the example we get from the camera: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cameraCapture_Completed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, PhotoResult e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.TaskResult == TaskResult.OK) { bitImage.SetSource(e.ChosenPhoto); image1.Source = bitImage; stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IsolatedStorageFileStream(<span class="hljs-string"><span class="hljs-string">"/image.jpg"</span></span>, System.IO.FileMode.OpenOrCreate, iso); WriteableBitmap wb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteableBitmap(bitImage); System.Windows.Media.Imaging.Extensions.SaveJpeg(wb, stream, wb.PixelWidth, wb.PixelHeight, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>); stream.Close(); } }</code> </pre> <br><br>  Directly loading: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UploadPhoto</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { txtStatus.Text = <span class="hljs-string"><span class="hljs-string">"Uploading photo"</span></span>; LiveConnectClient uploadClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LiveConnectClient(App.Session); uploadClient.UploadCompleted += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventHandler&lt;LiveOperationCompletedEventArgs&gt;(uploadClient_UploadCompleted); stream = iso.OpenFile(<span class="hljs-string"><span class="hljs-string">"/image.jpg"</span></span>, System.IO.FileMode.Open, System.IO.FileAccess.Read); uploadClient.UploadAsync(albumID, <span class="hljs-string"><span class="hljs-string">"Image "</span></span> + DateTime.Now.Millisecond + <span class="hljs-string"><span class="hljs-string">".jpg"</span></span>, stream); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uploadClient_UploadCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, LiveOperationCompletedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { stream.Close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Error == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { txtStatus.Text = <span class="hljs-string"><span class="hljs-string">"Sharing photo"</span></span>; JObject jObject = JObject.Parse(e.RawResult); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name = (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)jObject[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]; Share(name); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"Error calling API: "</span></span> + e.Error.ToString()); Waiting.Visibility = Visibility.Collapsed; } }</code> </pre> <br><br>  As you can see, uploading a photo is almost the same.  We, like in the past case, receive in response the ID of the downloaded image, which we will need to share it.  By default, all files uploaded to the non-shared folder have the Private access modifier.  Now let's share our image.  This is done by adding the parameter "/ shared_read_link" to the ID of our image. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Share</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename</span></span></span><span class="hljs-function">)</span></span> { LiveConnectClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LiveConnectClient(App.Session); client.GetCompleted += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventHandler&lt;LiveOperationCompletedEventArgs&gt;(GetSharedLink_Completed); client.GetAsync(filename + <span class="hljs-string"><span class="hljs-string">"/shared_read_link"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSharedLink_Completed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, LiveOperationCompletedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Error == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { ShareLinkTask shareLinkTask = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ShareLinkTask(); shareLinkTask.Title = <span class="hljs-string"><span class="hljs-string">"Holiday Photo"</span></span>; shareLinkTask.LinkUri = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(e.Result[<span class="hljs-string"><span class="hljs-string">"link"</span></span>].ToString(), UriKind.Absolute); shareLinkTask.Message = <span class="hljs-string"><span class="hljs-string">"My super holiday photo via #HolidayPhoto!"</span></span>; shareLinkTask.Show(); txtStatus.Text = <span class="hljs-string"><span class="hljs-string">"Done!"</span></span>; Waiting.Visibility = Visibility.Collapsed; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"Error calling API: "</span></span> + e.Error.ToString()); Waiting.Visibility = Visibility.Collapsed; } }</code> </pre> <br><br><img src="https://habrastorage.org/storage2/214/d2f/863/214d2f86399911308b4d4a6ace102b54.png"><br><br>  Here we get a link from our server to our file and transfer it to <b>ShareLinkTask</b> .  Everything, on this work is finished! <br><br><h4>  Conclusion </h4><br>  Of course, the capabilities of both the REST API for SkyDrive and the Live SDK as a whole are not limited to what I told you about.  You can get additional information from the following sources: <br><ul><li>  <b>Live Connect Developer Center</b> : <a href="http://msdn.microsoft.com/en-us/windowslive/default">msdn.microsoft.com/en-us/windowslive/default</a> </li><li>  <b>SkyDrive (photos, videos, and documents)</b> : <a href="http://msdn.microsoft.com/en-us/windowslive/hh528485">msdn.microsoft.com/en-us/windowslive/hh528485</a> </li><li>  <b>The complete developer's guide to the SkyDrive API</b> : <a href="http://channel9.msdn.com/Events/BUILD/BUILD2011/PLAT-134C">channel9.msdn.com/Events/BUILD/BUILD2011/PLAT-134C</a> </li><li>  <b>REST API</b> : <a href="http://msdn.microsoft.com/ru-ru/library/hh243648.aspx">msdn.microsoft.com/ru-ru/library/hh243648.aspx</a> </li><li>  <b>Interactive SDK</b> : <a href="http://isdk.dev.live.com/ISDK.aspx%3Fcategory%3DSkyDrive%2B(files%2Band%2Bphotos)%26index%3D0">http://isdk.dev.live.com/ISDK.aspx?category=SkyDrive+(files+and+photos)&amp;index=0</a> </li><li>  <b>Working with the code examples</b> : <a href="http://msdn.microsoft.com/ru-ru/windowslive/hh561316">msdn.microsoft.com/ru-ru/windowslive/hh561316#csharp</a> </li></ul><br><br>  <a href="https://skydrive.live.com/redir.aspx%3Fcid%3Da2567e038f37be43%26resid%3DA2567E038F37BE43!493%26parid%3DA2567E038F37BE43!463"><b>Download an example from the article</b></a> . <br>  In this example, the image from the camera is taken and uploaded to SkyDrive.  During the download, the status of the application is displayed.  <b>Do not forget to specify your ClientID in the MainPage.xaml file!</b>  <b>Without this, the application will not work!</b> <br><br>  All creative exploits and successful certification!  For those who do not know - the other day a new <a href="http://msdeveloper.ru/blogs/stangor/1340/">contest</a> for Windows Phone applications began. <br><br>  <b>UPD:</b> With Habrastorage a little trouble, the pictures will soon return to their places. </div><p>Source: <a href="https://habr.com/ru/post/136459/">https://habr.com/ru/post/136459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136453/index.html">Cut the Rope to HTML5</a></li>
<li><a href="../136454/index.html">Sketch - 100 seconds about SONY</a></li>
<li><a href="../136455/index.html">How users see programmers, and programmers see users</a></li>
<li><a href="../136456/index.html">High-performance NIO server on Netty</a></li>
<li><a href="../136458/index.html">Lean in brief on the example of pizza delivery</a></li>
<li><a href="../136460/index.html">A simple Dropbox based blog service.</a></li>
<li><a href="../136461/index.html">Controller Hierarchy</a></li>
<li><a href="../136463/index.html">Application for drawing under the Android</a></li>
<li><a href="../136464/index.html">Details about the ReFS (Protogon) file system</a></li>
<li><a href="../136465/index.html">Microsoft and Skype</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>