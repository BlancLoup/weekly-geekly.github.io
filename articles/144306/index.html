<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with Cach√© DBMS Objects on the Example of Delphi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite Delphi's permanent burial, this platform for building Desktop applications is alive and well, and with the change of ownership it even takes a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with Cach√© DBMS Objects on the Example of Delphi</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.intersystems.com/infoqcache21_120x600/trac-car-400h.jpg" align="right"><br>  Despite Delphi's permanent burial, this platform for building Desktop applications is alive and well, and with the change of ownership it even <a href="http://habrahabr.ru/post/142979/">takes a second wind</a> and continues to be the main tool for thousands of developers around the world. <br>  As with any other DBMS, Delphi perfectly interacts with the Cach√© DBMS. <br><br>  From Delphi, you can connect to Cach√© using the following interfaces: <br><br><ul><li>  <a href="">Cach√© Objects</a> (object, using CacheObject.dll / CacheActiveX.dll libraries); </li><li>  <a href="">Cach√© SQL</a> (relational using ODBC driver); </li><li>  <a href="">Cach√© Direct</a> (direct, using the Vism.ocx library); </li><li>  <a href="">Web services</a> ; </li><li>  <a href="">Sockets</a> </li></ul><br>  This article will discuss examples of using the object interface when working with Cach√© DBMS. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But first, I‚Äôll give you a few short VBScript examples that you can run directly from Windows Explorer. <br><br>  An example of direct access: <pre><code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> f = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"VISM.VisMCtrl.1"</span></span>) f.<span class="hljs-built_in"><span class="hljs-built_in">Server</span></span>=<span class="hljs-string"><span class="hljs-string">"CN_IPTCP:localhost[1972]:_system:@ SYS"</span></span> f.NameSpace=<span class="hljs-string"><span class="hljs-string">"SAMPLES"</span></span> f.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(<span class="hljs-string"><span class="hljs-string">"=$zv"</span></span>) <span class="hljs-comment"><span class="hljs-comment">'   WScript.Echo f.VALUE</span></span></code> </pre> <br>  An example of relational access: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> cn=<span class="hljs-built_in"><span class="hljs-built_in">Createobject</span></span>(<span class="hljs-string"><span class="hljs-string">"ADODB.Connection"</span></span>) cn.ConnectionString=<span class="hljs-string"><span class="hljs-string">"DRIVER={InterSystems ODBC35}; SERVER=127.0.0.1; PORT=1972; DATABASE=SAMPLES; UID=_system; PWD=SYS"</span></span> cn.open WScript.Echo <span class="hljs-string"><span class="hljs-string">"Succesfully!"</span></span></code> </pre><br>  Example object access: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> f = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"CacheActiveX.Factory"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> rs = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"CacheActiveX.ResultSet"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> f.IsConnected() <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> f.Connect(<span class="hljs-string"><span class="hljs-string">"cn_iptcp:127.0.0.1[1972]:SAMPLES:_SYSTEM:SYS"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> rs=f.DynamicSQL(<span class="hljs-string"><span class="hljs-string">"select TOP 3 * from Sample.Person"</span></span>) rs.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> rs.<span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> WScript.Echo rs.<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>(<span class="hljs-string"><span class="hljs-string">"SSN"</span></span>) <span class="hljs-comment"><span class="hljs-comment">'  SSN      Sample.Person wend rs.Close() Set person = f.Static("Sample.Person") age=person.CurrentAge(45678) '   Sample.Person WScript.Echo age End If</span></span></code> </pre><br>  Similarly, you can work with Cach√© DBMS using JScript, Visual Basic, C ++ Builder, etc. <br><blockquote>  Note: For Java and .NET there are several native <a href="">interfaces</a> that provide much more features. </blockquote><br><h4>  Late and early binding </h4><br>  There are two approaches for working with Cach√© objects from Delphi: <br><ul><li>  late binding; </li><li>  <a href="">early binding</a> . </li></ul><br>  Each of these approaches has its advantages and disadvantages, which, however, compensate each other. <br><br>  When late binding, the developer is unavailable to the code prompter, respectively, there is a high probability of making a mistake in the code, which will be detected only during program execution.  The speed of operation is somewhat lower than with early binding, since the code is executed dynamically. <br><br>  Early binding is devoid of these shortcomings, but you have to pay for this by changing the interface of user classes in the database or when <a href="">switching to a new version of the Cach√© DBMS,</a> it is necessary to regenerate the proxy classes for the client application. <br><br>  By combining both of these approaches, you can achieve optimal performance and ease of operation. <br><br>  This article will mainly use early binding, since this approach is less described compared to late binding. <br><br>  Cach√© Objects uses two libraries that are installed by default in <i>C: \ Program Files \ Common Files \ InterSystems \ Cache \</i> : <br><ul><li>  <b>CacheObject.dll</b> (outdated); </li><li>  <b>CacheActiveX.dll</b> (recommended). </li></ul><br>  Starting with Cach√© 5.1, InterSystems developers strongly recommend using the new <b>CacheActiveX.dll</b> library.  The <b>CacheObject.dll</b> library <b>is</b> left only for compatibility with old applications.  Therefore, in this article I will be based on <b>CacheActiveX.dll</b> . <br><br>  You can read about <a href="">Upgrading from CacheObject.dll</a> about the differences between these libraries and the nuances that need to be considered when upgrading to a new version. <br><br>  In the above directory, you can find other files that may be useful to you: <br><ul><li>  <b>DelphiCallback.dll</b> ; </li><li>  <b>CacheList.ocx</b> ; </li><li>  <b>CacheQuery.ocx</b> ; </li><li>  <b>VISM.ocx</b> . </li></ul><br><h4>  Import and install Cach√© Objects ActiveX components in Delphi </h4><br>  This section describes the installation of the main classes and interfaces in the Delphi environment for working with objects in the Cach√© DBMS using early binding.  You can skip this section to work with late binding. <br><br>  So, in order: <br><ol><li>  select the menu item <font color="green"><b>Component&gt; Import Component ...</b></font> ; <br><br><img src="https://habrastorage.org/getpro/habr/post_images/733/d3f/bdc/733d3fbdc43be6e8bc4a5269eb91170a.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/903/902/a0d/903902a0d1fa5399307c76e681d2d8e0.png" alt="image"><br><br></li><li>  choose to start the type library <i>CacheActiveX 2.0 Type Library</i> ; <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77c/892/064/77c8920644ce932a4f6aa6c964747c49.png" alt="image"><br><br></li><li>  we set the name of our bookmark, where we want to install our components, as well as other parameters; <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6a/787/26a/e6a78726a4760bdb0be7f1954a6fc03d.png" alt="image"><br><br></li><li>  we create our module, while without installation; <br><br><img src="https://habrastorage.org/getpro/habr/post_images/216/f45/8cb/216f458cbe1af955bb08283a84dd83bf.png" alt="image"><br><br></li><li>  repeat steps 2-4 for the following libraries: <br><ul><li>  <i>CacheActiveX 2.0 Type Library</i> ; </li><li>  <i>CacheList ActiveX Control module</i> ; </li><li>  <i>CacheQuery ActiveX Control module</i> ; </li><li>  <i>DelphiCallback 1.0 Type Library</i> ; </li><li>  <i>VisM 7.2 ActiveX Control</i> ; </li><li>  <i>TL 1.0 Type Library</i> . </li></ul><blockquote>  Note: You can create modules using the <b>tlibimp.exe</b> utility included in the Delphi package. </blockquote><br></li><li>  create a new project of type Package and add all the previously created modules to it.  We compile the project and install our package.  This is what we should end up with: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bac/2be/a11/bac2bea11dd9fa76aa80a5140c2988cc.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b94/e21/fad/b94e21fadcf55f35e4533330c3cc4adc.png" alt="image"><br><blockquote>  Note: For earlier versions of Delphi, the process of creating modules differs slightly: <br><ul><li>  select the menu item <font color="green"><b>Project&gt; Import Type Library ...</b></font> ; <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb6/640/ec0/bb6640ec0672d2ff22ad930900d9d3d0.png" alt="image"><br><br></li><li>  see further paragraphs above. </li></ul></blockquote></li></ol><br><h4>  Generating custom proxy classes </h4><br>  This section describes the generation of custom proxy classes for working with objects in the Cach√© DBMS using early binding.  You can skip this section to work with late binding. <br><br>  First you need to generate an ODL file containing all the custom classes we need.  To do this, use the <b>odl_generator.exe</b> utility supplied with the Cach√© DBMS. <br><br>  EXAMPLE: <pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">odl_generator</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exe</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-conn</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cn_iptcp</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:localhost</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1972]</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:USER</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:_system</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SYS</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-class-list</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-lib-name</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-dir</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MIDL</span></span></code> </pre> <br>  In this example, the utility connects to the <b>USER area</b> , generates proxy classes for the classes listed in the <b>test.txt</b> file, and saves the result to the file <b>MIDL \ test.odl</b> <br><blockquote>  <font color="red">Attention</font> : The resulting file is intended for use with the <b>CacheActiveX.dll</b> library.  To generate an ODL file designed to work with the old library, you should use the <a href="">ExportODL</a> method of the <font color="darkblue">% SYSTEM.OBJ</font> class <br><br>  EXAMPLE: <br> <code><font color="#0000ff">set</font> <font color="#000000">list=</font> <font color="#008000">"%Library.Status,Sample.Person" <br></font> <font color="#0000ff">do $system</font> <font color="#008080">.OBJ</font> <font color="#000000">.</font> <font color="#0000ff">ExportODL</font> <font color="#000000">(list,</font> <font color="#008000">"c:\MIDL\test.odl"</font> <font color="#000000">,</font> <font color="#008000">"-d"</font> <font color="#000000">,.err)</font> <br></code> </blockquote><br>  So, the ODL file is received, now you need to compile it to get a TLB file, and then a PAS file.  To do this, you can use the utilities <b>midl.exe</b> or <b>mktypelib.exe</b> , included in the developer kit Visual C ++. <br><br>  EXAMPLE: <pre> <code class="hljs cmake">midl /I . <span class="hljs-keyword"><span class="hljs-keyword">test</span></span>.odl /tlb <span class="hljs-keyword"><span class="hljs-keyword">test</span></span>.tlb tlibimp.exe -C- -P+ -Hr- -Ha- -Hs- -XM- <span class="hljs-keyword"><span class="hljs-keyword">test</span></span>.tlb</code> </pre> <br><blockquote>  Note: You can automate all the above steps using the Cach√© DBMS MAC program. </blockquote><br><h4>  Preparatory work on the server </h4><br>  Let's create the following data classes in our test database: <br><br><blockquote> <code><font color="#000080">///   <br> Class pas.s Extends %SerialObject <br></font> <font color="#000000">{ <br> <br></font> <font color="#000080">///   (64-). <br> Property</font> <font color="#000000">aInteger</font> <font color="#000080">As %Integer</font> <font color="#000000">; <br> <br></font> <font color="#000080">/// .     - 50 . <br> Property</font> <font color="#000000">aString</font> <font color="#000080">As %String</font> <font color="#000000">; <br> <br> }</font></code> </blockquote> <br><blockquote> <code><font color="#000080">///   . <br> Class pas.a Extends %Persistent <br></font> <font color="#000000">{ <br> <br></font> <font color="#000080">///    aA; <br> Index</font> <font color="#000000">aAIndex On aA; <br> <br></font> <font color="#000080">///  --,  "".  SQL   foreign key. <br> Relationship</font> <font color="#000000">aA</font> <font color="#000080">As pas.test</font> <font color="#000000">[</font> <font color="#000080">Cardinality</font> <font color="#000000">= one,</font> <font color="#000080">Inverse</font> <font color="#000000">= aChilds ]; <br> <br></font> <font color="#000080">Property</font> <font color="#000000">aInteger</font> <font color="#000080">As %Integer</font> <font color="#000000">; <br> <br></font> <font color="#000080">Property</font> <font color="#000000">aString</font> <font color="#000080">As %String</font> <font color="#000000">; <br> <br> }</font></code> </blockquote> <br><blockquote> <code><font color="#000080">///    %occIO.inc  . <br> Include</font> <font color="#ff0000">%occIO <br> <br></font> <font color="#000080">///   . <br> Class pas.test Extends %Persistent <br></font> <font color="#000000">{ <br> <br></font> <font color="#000080">///  ,       ; <br> Parameter</font> <font color="#000000">EXTENTQUERYSPEC</font> <font color="#000080">As</font> <font color="#000000">ROWSPEC [</font> <font color="#000080">Flags</font> <font color="#000000">= LIST ] =</font> <font color="#800080">aBoolean,aInteger,aString,aDate,aTimeStamp"</font> <font color="#000000">; <br> <br></font> <font color="#000080">///   (true/false/null); <br> Property</font> <font color="#000000">aBoolean</font> <font color="#000080">As %Boolean</font> <font color="#000000">; <br> <br></font> <font color="#000080">Property</font> <font color="#000000">aInteger</font> <font color="#000080">As %Integer</font> <font color="#000000">; <br> <br></font> <font color="#000080">Property</font> <font color="#000000">aString</font> <font color="#000080">As %String</font> <font color="#000000">; <br> <br></font> <font color="#000080">/// ; <br> Property</font> <font color="#000000">aDate</font> <font color="#000080">As %Date</font> <font color="#000000">; <br> <br></font> <font color="#000080">/// +; <br> Property</font> <font color="#000000">aTimeStamp</font> <font color="#000080">As %TimeStamp</font> <font color="#000000">; <br> <br></font> <font color="#000080">///   (CLOB); <br> Property</font> <font color="#000000">aMemo</font> <font color="#000080">As %GlobalCharacterStream</font> <font color="#000000">; <br> <br></font> <font color="#000080">///   (BLOB); <br> Property</font> <font color="#000000">aPhoto</font> <font color="#000080">As %GlobalBinaryStream</font> <font color="#000000">; <br> <br></font> <font color="#000080">///  --,  "".  SQL  . <br> Relationship</font> <font color="#000000">aChilds</font> <font color="#000080">As pas.a</font> <font color="#000000">[</font> <font color="#000080">Cardinality</font> <font color="#000000">= many,</font> <font color="#000080">Inverse</font> <font color="#000000">= aA ]; <br> <br></font> <font color="#000080">/// -  ; <br> ///&lt;br&gt; SQL       <br> ///&lt;br&gt; -. <br> Property</font> <font color="#000000">aS</font> <font color="#000080">As pas.s</font> <font color="#000000">; <br> <br></font> <font color="#000080">/// - ; <br> ///&lt;br&gt; SQL    ,   ,  . <br> Property</font> <font color="#000000">aListOfString</font> <font color="#000080">As list Of %String</font> <font color="#000000">; <br> <br></font> <font color="#000080">/// -   ; <br> ///&lt;br&gt; SQL       ,   ,  . <br> Property</font> <font color="#000000">aListOfA</font> <font color="#000080">As list Of pas.a</font> <font color="#000000">; <br> <br></font> <font color="#000080">/// - ; <br> ///&lt;br&gt; SQL   . <br> Property</font> <font color="#000000">aArrOfString</font> <font color="#000080">As array Of %String</font> <font color="#000000">; <br> <br></font> <font color="#000080">/// -   ; <br> ///&lt;br&gt; SQL   . <br> Property</font> <font color="#000000">aArrOfA</font> <font color="#000080">As array Of pas.a</font> <font color="#000000">; <br> <br></font> <font color="#000080">///   . <br> /// &lt;br&gt;  ,    . <br> Method</font> <font color="#000000">%OnBeforeSave(</font> <font color="#ff00ff">insert</font> <font color="#000080">As %Boolean</font> <font color="#000000">)</font> <font color="#000080">As %Status</font> <font color="#000000">[</font> <font color="#000080">Private</font> <font color="#000000">,</font> <font color="#000080">ServerOnly</font> <font color="#000000">= 1 ] <br> { <br></font> <font color="#008000">;        <br></font> <font color="#0000ff">write</font> <font color="#008000">"Hello from Cache! ("</font> <font color="#000000">,</font> <font color="#0000ff">$$$CurrentClass</font> <font color="#000000">,</font> <font color="#008000">":"</font> <font color="#000000">,</font> <font color="#0000ff">$$$CurrentMethod</font> <font color="#000000">,</font> <font color="#008000">")"</font> <font color="#000000">,! <br> <br></font> <font color="#0000ff">quit $$$OK <br></font> <font color="#000000">} <br> <br></font> <font color="#000080">///  -  :     . <br> Query</font> <font color="#000000">test1(</font> <font color="#ff00ff">ABoolean</font> <font color="#000080">As %Boolean</font> <font color="#000000">,</font> <font color="#ff00ff">AInteger</font> <font color="#000080">As %Integer</font> <font color="#000000">,</font> <font color="#ff00ff">AString</font> <font color="#000080">As %String</font> <font color="#000000">,</font> <font color="#ff00ff">ADate</font> <font color="#000080">As %Date</font> <font color="#000000">,</font> <font color="#ff00ff">ATimeStamp</font> <font color="#000080">As %TimeStamp</font> <font color="#000000">)</font> <font color="#000080">As %SQLQuery</font> <font color="#000000">(</font> <font color="#000080">CONTAINID</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">,</font> <font color="#000080">ROWSPEC</font> <font color="#000000">=</font> <font color="#800080">"ID:%String,aBoolean:%Boolean,aInteger:%Integer,aString:%String,aDate:%Date,aTimeStamp:%TimeStamp"</font> <font color="#000000">) [</font> <font color="#000080">SqlProc</font> <font color="#000000">] <br> { <br></font> <font color="#0000ff">SELECT</font> <font color="#008000">%ID</font> <font color="#000000">,</font> <font color="#008000">aBoolean</font> <font color="#000000">,</font> <font color="#008000">aInteger</font> <font color="#000000">,</font> <font color="#008000">aString</font> <font color="#000000">,</font> <font color="#008000">aDate</font> <font color="#000000">,</font> <font color="#008000">aTimeStamp</font> <font color="#000080">FROM</font> <font color="#008000">pas</font> <font color="#000000">.</font> <font color="#008000">test</font> <font color="#000080">WHERE <br></font> <font color="#000000">(</font> <font color="#008000">aBoolean</font> <font color="#000000">=</font> <font color="#800000">:ABoolean</font> <font color="#000000">or</font> <font color="#800000">:ABoolean</font> <font color="#000000">is</font> <font color="#000080">null</font> <font color="#000000">) <br> AND (</font> <font color="#008000">aInteger</font> <font color="#000000">=</font> <font color="#800000">:AInteger</font> <font color="#000000">or</font> <font color="#800000">:AInteger</font> <font color="#000000">is</font> <font color="#000080">null</font> <font color="#000000">) <br> AND (</font> <font color="#008000">aString</font> <font color="#000000">=</font> <font color="#800000">:AString</font> <font color="#000000">or</font> <font color="#800000">:AString</font> <font color="#000000">is</font> <font color="#000080">null</font> <font color="#000000">) <br> AND (</font> <font color="#008000">aDate</font> <font color="#000000">&lt;</font> <font color="#800000">:ADate</font> <font color="#000000">or</font> <font color="#800000">:ADate</font> <font color="#000000">is</font> <font color="#000080">null</font> <font color="#000000">) <br> AND (</font> <font color="#008000">aTimeStamp</font> <font color="#000000">&lt;=</font> <font color="#800000">:ATimeStamp</font> <font color="#000000">or</font> <font color="#800000">:ATimeStamp</font> <font color="#000000">is</font> <font color="#000080">null</font> <font color="#000000">) <br> } <br> <br></font> <font color="#000080">///  -  :       "" <br> ///&lt;br&gt;        %INLIST. <br> Query</font> <font color="#000000">test2(</font> <font color="#ff00ff">AList</font> <font color="#000080">As %List</font> <font color="#000000">)</font> <font color="#000080">As %SQLQuery</font> <font color="#000000">(</font> <font color="#000080">CONTAINID</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">,</font> <font color="#000080">ROWSPEC</font> <font color="#000000">=</font> <font color="#800080">"ID:%String,aBoolean:%Boolean,aInteger:%Integer,aString:%String,aDate:%Date,aTimeStamp:%TimeStamp"</font> <font color="#000000">) [</font> <font color="#000080">SqlProc</font> <font color="#000000">] <br> { <br></font> <font color="#0000ff">SELECT</font> <font color="#008000">%ID</font> <font color="#000000">,</font> <font color="#008000">aBoolean</font> <font color="#000000">,</font> <font color="#008000">aInteger</font> <font color="#000000">,</font> <font color="#008000">aString</font> <font color="#000000">,</font> <font color="#008000">aDate</font> <font color="#000000">,</font> <font color="#008000">aTimeStamp</font> <font color="#000080">FROM</font> <font color="#008000">pas</font> <font color="#000000">.</font> <font color="#008000">test</font> <font color="#000080">WHERE</font> <font color="#008000">ID</font> <font color="#000000">%INLIST</font> <font color="#800000">:AList <br></font> <font color="#000000">} <br> <br></font> <font color="#000080">///  . <br> ClassMethod</font> <font color="#000000">test3(</font> <font color="#ff00ff">AList</font> <font color="#000080">As %List</font> <font color="#000000">)</font> <font color="#000080">As %Status <br></font> <font color="#000000">{ <br></font> <font color="#008000">;       AList <br></font> <font color="#0000ff">write</font> <font color="#000000">AList <br> <br></font> <font color="#008000">;     <br></font> <font color="#0000ff">set</font> <font color="#000000">^pastest=AList <br> <br></font> <font color="#0000ff">quit $$$OK <br></font> <font color="#000000">} <br> <br></font> <font color="#000080">///   . <br> ClassMethod</font> <font color="#000000">test4()</font> <font color="#000080">As %Status <br></font> <font color="#000000">{ <br></font> <font color="#0000ff">quit $$$ERROR</font> <font color="#000000">(</font> <font color="#0000ff">$$$GeneralError</font> <font color="#000000">,</font> <font color="#008000">"My error!"</font> <font color="#000000">) <br> } <br> <br></font> <font color="#000080">///      . <br> ClassMethod</font> <font color="#000000">test5(</font> <font color="#ff00ff">Arg1...</font> <font color="#000080">As %List</font> <font color="#000000">)</font> <font color="#000080">As %Status <br></font> <font color="#000000">{ <br></font> <font color="#008000">;         <br></font> <font color="#0000ff">write</font> <font color="#008000">"Invocation has "</font> <font color="#000000">,</font> <font color="#0000ff">$get</font> <font color="#000000">(Arg1, 0),</font> <font color="#008000">" element"</font> <font color="#000000">,</font> <font color="#0000ff">$select</font> <font color="#000000">((</font> <font color="#0000ff">$get</font> <font color="#000000">(Arg1, 0)=1):</font> <font color="#008000">""</font> <font color="#000000">, 1:</font> <font color="#008000">"s"</font> <font color="#000000">),! <br></font> <font color="#0000ff">for</font> <font color="#000000">i = 1 : 1 :</font> <font color="#0000ff">$get</font> <font color="#000000">(Arg1, 0) <br></font> <font color="#800080">{ <br></font> <font color="#0000ff">write</font> <font color="#000000">:(</font> <font color="#0000ff">$data</font> <font color="#000000">(Arg1(i))&gt;0)</font> <font color="#008000">"Argument["</font> <font color="#000000">,i,</font> <font color="#008000">"]:"</font> <font color="#000000">,?15,</font> <font color="#0000ff">$get</font> <font color="#000000">(Arg1(i),</font> <font color="#008000">"&lt;NULL&gt;"</font> <font color="#000000">),! <br></font> <font color="#800080">} <br></font> <font color="#0000ff">quit $$$OK <br></font> <font color="#000000">} <br> <br></font> <font color="#000080">///      :     . <br> /// &lt;br&gt;        . <br> /// &lt;br&gt;: <br> /// &lt;br&gt;&lt;var&gt;ID&lt;/var&gt; - ; <br> /// &lt;br&gt;&lt;var&gt;A&lt;/var&gt; -   ; <br> /// &lt;br&gt;&lt;var&gt;BLOB&lt;/var&gt; -  ; <br> /// &lt;br&gt;&lt;var&gt;RS1&lt;/var&gt; -  ,      Borland ¬Æ MyBase (DataSnap (TM)) XML DataSet; <br> /// &lt;br&gt;&lt;var&gt;RS2&lt;/var&gt; -  ,      Borland ¬Æ MyBase (DataSnap (TM)) XML DataSet; <br> ClassMethod</font> <font color="#000000">test6( <br></font> <font color="#ff00ff">ID</font> <font color="#000080">As %String</font> <font color="#000000">, <br></font> <font color="#000080">ByRef</font> <font color="#ff00ff">A</font> <font color="#000080">As pas.a</font> <font color="#000000">, <br></font> <font color="#000080">Output</font> <font color="#ff00ff">BLOB</font> <font color="#000080">As %BinaryStream</font> <font color="#000000">, <br></font> <font color="#000080">Output</font> <font color="#ff00ff">RS1</font> <font color="#000080">As %CharacterStream</font> <font color="#000000">, <br></font> <font color="#000080">Output</font> <font color="#ff00ff">RS2</font> <font color="#000080">As %CharacterStream</font> <font color="#000000">)</font> <font color="#000080">As %Status <br></font> <font color="#000000">{ <br></font> <font color="#008000">//     ,    <br></font> <font color="#0000ff">set</font> <font color="#000000">A.</font> <font color="#0000ff">aString</font> <font color="#000000">=999 <br> <br></font> <font color="#008000">//     <br></font> <font color="#0000ff">set</font> <font color="#000000">BLOB=</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%GlobalBinaryStream</font> <font color="#000000">).</font> <font color="#0000ff">%New</font> <font color="#000000">() <br> <br></font> <font color="#008000">//     <br></font> <font color="#0000ff">do</font> <font color="#000000">BLOB.</font> <font color="#0000ff">Write</font> <font color="#000000">(</font> <font color="#008000">"123"</font> <font color="#000000">) <br> <br></font> <font color="#008000">//     <br></font> <font color="#0000ff">set</font> <font color="#000000">RS1=</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%GlobalCharacterStream</font> <font color="#000000">).</font> <font color="#0000ff">%New</font> <font color="#000000">() <br></font> <font color="#0000ff">set</font> <font color="#000000">RS2=</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%GlobalCharacterStream</font> <font color="#000000">).</font> <font color="#0000ff">%New</font> <font color="#000000">() <br> <br></font> <font color="#008000">//    ,      XML  TClientDataSet <br></font> <font color="#0000ff">set</font> <font color="#000000">cds=</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%XML.ZMyBaseDataSet</font> <font color="#000000">).</font> <font color="#0000ff">%New</font> <font color="#000000">() <br> <br></font> <font color="#008000">//   <br></font> <font color="#0000ff">do</font> <font color="#000000">cds.</font> <font color="#0000ff">Prepare</font> <font color="#000000">(</font> <font color="#008000">"select * from pas.a where id %inlist ?"</font> <font color="#000000">) <br> <br></font> <font color="#008000">//     <br></font> <font color="#0000ff">do</font> <font color="#000000">cds.</font> <font color="#0000ff">SetArgs</font> <font color="#000000">(</font> <font color="#0000ff">$listbuild</font> <font color="#000000">(1,2,3,9)) <br> <br></font> <font color="#008000">//        XML <br></font> <font color="#0000ff">do</font> <font color="#000000">cds.</font> <font color="#0000ff">XMLExportToStream</font> <font color="#000000">(.RS1) <br> <br></font> <font color="#008000">//  ( )      <br></font> <font color="#0000ff">do</font> <font color="#000000">cds.</font> <font color="#0000ff">Close</font> <font color="#000000">() <br></font> <font color="#0000ff">do</font> <font color="#000000">cds.</font> <font color="#0000ff">Prepare</font> <font color="#000000">(</font> <font color="#008000">"select ID,aBoolean,aInteger,aString,aDate,aTimeStamp from pas.test"</font> <font color="#000000">) <br></font> <font color="#0000ff">do</font> <font color="#000000">cds.</font> <font color="#0000ff">XMLExportToStream</font> <font color="#000000">(.RS2) <br></font> <font color="#0000ff">do</font> <font color="#000000">cds.</font> <font color="#0000ff">Close</font> <font color="#000000">() <br> <br></font> <font color="#008000">//   "" <br></font> <font color="#0000ff">quit $$$OK <br></font> <font color="#000000">} <br> <br> }</font></code> </blockquote> <br>  We will generate proxy classes for them, as well as for the following classes: <br><ul><li>  % Library.ArrayOfDataTypes </li><li>  % Library.ArrayOfObjects </li><li>  % Library.ListOfObjects </li><li>  % Library.ListOfDataTypes </li><li>  % Library.RelationshipObject </li></ul><br>  Now, if you connect the generated PAS file to the project, the most important methods and properties of our classes become available: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/720/99e/fc8/72099efc8731113604031a54f5814742.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> <br><br><blockquote>  <font color="red">Attention</font> : Threads classes and some others should not be imported from Cach√© DBMS, since they are already protected into <b>CacheActiveX.dll</b> and are incompatible with the generated proxy classes. </blockquote><br><h4>  Connect to Cach√© DBMS </h4><br>  Late binding (old library): <br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _f:variant; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> _f:=CreateOleObject(<span class="hljs-string"><span class="hljs-string">'CacheObject.Factory'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _f.Connect(_f.ConnectDlg(<span class="hljs-string"><span class="hljs-string">'+%up'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>);</code> </pre> <br>  Late binding (new library): <br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _f:variant; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> _f:=CreateOleObject(<span class="hljs-string"><span class="hljs-string">'CacheActiveX.Factory'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _f.Connect(_f.ConnectDlg(<span class="hljs-string"><span class="hljs-string">'+%up'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>);</code> </pre> <br>  Early binding (new library): <br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-title"><span class="hljs-title">Tfm</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) f: TFactory; ... <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> f.Connect1(f.ConnectDlg(<span class="hljs-string"><span class="hljs-string">'+%up'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>); ...</code> </pre> <br><blockquote>  <font color="red">Warning</font> : The old library uses the <b>% Service_CacheDirect</b> service and only unauthenticated access, the new one <b>uses% Service_Bindings</b> and other access methods. </blockquote><br>  A detailed description of the <font color="darkblue">TFactobry</font> class <font color="darkblue">methods</font> , as well as other classes, can be found in the <a href="">ActiveX API Reference</a> <br><br><h4>  Examples of calling queries and methods using <u>early</u> binding </h4><br><h5>  Using CallBack functionality </h5><br>  To use <a href="">CallBack</a> functionality from Delphi, you should use the ready-made <font color="darkblue">TCallback</font> class from the <b>DelphiCallback.dll</b> file. <br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f:TFactory; Callback1: TCallback; mm: TMemo; ... f.SetOutput(Callback1.OleObject); ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tfm</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Callback1TextChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> p_bstrText: WideString)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> mm.Lines.Append(p_bstrText); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><h5>  Delete all data </h5><br><pre> <code class="delphi hljs"> mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'KillExtent'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   test_(f.Static('pas.test')).SYS_KillExtent(1); a(f.Static('pas.a')).SYS_KillExtent(1);</span></span></code> </pre> <br><h5>  An example of creating, filling, saving and releasing objects of various types </h5><br>  You can read about the features of closing objects when working through ActiveX in the article by Sergey Kudinov: <a href="http://writeimagejournal.com/%3Fp%3D256">Features of closing objects when working through ActiveX, CPP-binding</a> . <br><br>  Code example: <br><pre> <code class="delphi hljs">... <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> test_TLB, AxCtrls, ComObj, ActiveX, Types; ... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> N = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; _t: test_; _a: A; _s: s; rel: RelationshipObject; listStr: ListOfDataTypes; listA: ListOfObjects; arrStr: ArrayOfDataTypes; arrA: ArrayOfObjects; stream: IDispatch; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Screen.Cursor := crSQLWait; mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'Save'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-comment"><span class="hljs-comment">//     pas.test _t := test_(f.New('pas.test')); //     _t.aBoolean := true; _t.aInteger := 50; _t.aString := ' '; //     null    // (%Integer,%Boolean,%Date  ..) Variant(_t).aDate := nil; _t.aDate := _t.aDateDisplayToLogical('02.03.2001'); //  t.aDate:=StrToDate('02.03.2001'); _t.aTimeStamp := _t.aTimeStampDisplayToLogical('1900-01-02 12:34:55'); //  t.aTimeStamp:=StrToDateTime('02.01.1900 12:34:55'); //     stream := _t.aMemo; ICharStream(stream).Write(' '); stream := nil; //     stream := _t.aPhoto; IBinaryStream(stream).FileRead('C:\test.jpg'); stream := nil; //  N ""   pas.a rel := RelationshipObject(_t.aChilds); for i := 1 to N do begin _a := A(f.New('pas.a')); _a.aInteger := i; _a.aString := 'rel' + IntToStr(i); rel.Insert(_a); _a.SYS_Close; end; _t.aChilds := rel; rel.SYS_Close; //     _s := s(_t.aS_); _s.aInteger := 1; _s.aString := 's1'; _s.SYS_Close; //     .     listStr := ListOfDataTypes(f.New('%ListOfDataTypes')); for i := 1 to N do listStr.Insert('str' + IntToStr(i)); _t.aListOfString := listStr; listStr.SYS_Close; //    pas.a     listA := ListOfObjects(f.New('%ListOfObjects')); for i := 1 to N do begin _a := A(f.New('pas.a')); _a.aInteger := i; _a.aString := 'listA' + IntToStr(i); listA.Insert(_a); _a.SYS_Close; end; _t.aListOfA := listA; listA.SYS_Close; //     .     arrStr := ArrayOfDataTypes(f.New('%ArrayOfDataTypes')); for i := 1 to N do arrStr.SetAt('astr' + IntToStr(i), 'arraykey' + IntToStr(i)); _t.aArrOfString := arrStr; arrStr.SYS_Close; //    pas.a     arrA := ArrayOfObjects(f.New('%ArrayOfObjects')); for i := 1 to N do begin _a := A(f.New('pas.a')); _a.aInteger := i; _a.aString := 'arrayA' + IntToStr(i); arrA.SetAt(_a, 'arraykey' + IntToStr(i)); _a.SYS_Close; end; _t.aArrOfA := arrA; arrA.SYS_Close; //         .   //          // . _t.SYS_Save(0); //          stream := _t.aPhoto; SetOlePicture(img.Picture, IBinaryStream(stream).GetPicture); stream := nil; //    .      //   ,  "" (%sysOrefs). //         //       . _t.SYS_Close; //     _t := nil; mm.Lines.Append('OK'); except on E: Exception do begin mm.Lines.Append(E.Message); end; end; finally Screen.Cursor := crDefault; //      , //      f.ForceSync; end;</span></span></code> </pre> <br><h5>  Extent request (selection of all instances of the stored class) </h5><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mm: TMemo; rs: TResultSet; ... mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'Extent'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; rs.ConnectTo(IResultSet(f.ResultSet(<span class="hljs-string"><span class="hljs-string">'pas.test'</span></span>, <span class="hljs-string"><span class="hljs-string">'Extent'</span></span>))); rs.Execute; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> rs.Next <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> mm.Lines.Append(Format(<span class="hljs-string"><span class="hljs-string">'ID = %s'</span></span>,[rs.GetDataAsString(<span class="hljs-number"><span class="hljs-number">1</span></span>)])); mm.Lines.Append(Format(<span class="hljs-string"><span class="hljs-string">'aBoolean = %s'</span></span>,[rs.Get(<span class="hljs-string"><span class="hljs-string">'aBoolean'</span></span>)])); mm.Lines.Append(Format(<span class="hljs-string"><span class="hljs-string">'aInteger = %s'</span></span>,[rs.Get(<span class="hljs-string"><span class="hljs-string">'aInteger'</span></span>)])); mm.Lines.Append(Format(<span class="hljs-string"><span class="hljs-string">'aString = %s'</span></span>,[rs.Get(<span class="hljs-string"><span class="hljs-string">'aString'</span></span>)])); mm.Lines.Append(Format(<span class="hljs-string"><span class="hljs-string">'aDate = %s'</span></span>,[rs.Get(<span class="hljs-string"><span class="hljs-string">'aDate'</span></span>)])); mm.Lines.Append(Format(<span class="hljs-string"><span class="hljs-string">'aTimeStamp = %s'</span></span>,[rs.Get(<span class="hljs-string"><span class="hljs-string">'aTimeStamp'</span></span>)])); mm.Lines.Append(<span class="hljs-string"><span class="hljs-string">'-----'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; rs.Close; rs.Disconnect;</code> </pre> <br><h5>  Request test1 </h5><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; ... mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'test1'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; rs.ConnectTo(IResultSet(f.ResultSet(<span class="hljs-string"><span class="hljs-string">'pas.test'</span></span>, <span class="hljs-string"><span class="hljs-string">'test1'</span></span>))); rs.SetParam(<span class="hljs-number"><span class="hljs-number">1</span></span>, null); rs.SetParam(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>); rs.SetParam(<span class="hljs-number"><span class="hljs-number">3</span></span>, null); rs.SetParam(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'03.03.2001'</span></span>); rs.SetParam(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'1900-01-02 12:34:55.0'</span></span>); rs.Execute; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> rs.Next <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> rs.GetColumnCount <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> mm.Lines.Append(rs.GetColumnName(i)+<span class="hljs-string"><span class="hljs-string">' = '</span></span>+rs.GetDataAsString(i)); mm.Lines.Append(<span class="hljs-string"><span class="hljs-string">'-----'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; rs.Close; rs.Disconnect;</code> </pre> <br><h5>  Request test2 </h5><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; syslist: TSyslist; ... mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'test2'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    %List syslist.Clear; syslist.Add(1); syslist.Add(2); syslist.Add(3); rs.ConnectTo(IResultSet(f.ResultSet('pas.test', 'test2'))); rs.Execute(syslist.DefaultInterface); while rs.Next do begin for i := 1 to rs.GetColumnCount do mm.Lines.Append(rs.GetColumnName(i)+' = '+rs.GetDataAsString(i)); mm.Lines.Append('-----'); end; rs.Close; rs.Disconnect;</span></span></code> </pre> <br><h5>  Test3 method  Working with an object of class TSysList (type% List in Cach√©) </h5><br><pre> <code class="delphi hljs"> mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'test3'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    %List syslist.Clear; syslist.Add('16'); syslist.Add('42'); syslist.Add('35'); test_(f.Static('pas.test')).test3(syslist.DefaultInterface);</span></span></code> </pre> <br><h5>  Test4 method  Error processing </h5><br><pre> <code class="delphi hljs"> mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'test4'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> test_(f.<span class="hljs-keyword"><span class="hljs-keyword">Static</span></span>(<span class="hljs-string"><span class="hljs-string">'pas.test'</span></span>)).test4(); <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> E: Exception <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> mm.Lines.Append(E.<span class="hljs-keyword"><span class="hljs-keyword">Message</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><h5>  Test5 method </h5><br><pre> <code class="delphi hljs"> mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'test5'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    %List syslist.Clear; syslist.Add('16'); syslist.Add('42'); syslist.Add('35'); test_(f.Static('pas.test')).test5(syslist.DefaultInterface);</span></span></code> </pre> <br><h5>  Test6 method </h5><br>  This example uses the class <font color="darkblue">% XML.ZMyBaseDataSet</font> , which can be found <a href="http://sourceforge.net/projects/m-pas/files/Delphi%2520_%2520Cache%2520MIDAS/1.0/">here</a> .  With it, you can form data on the server in the format of <i>Borland ¬Æ MyBase (DataSnap (TM)) XML DataSet</i> .  Including for web services. <br><br><pre> <code class="delphi hljs">cds1,cds2:TClientDataSet; ... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _a:a; __a,blob,rs1,rs2:IDispatch; cs1,cs2:ICharStream; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> mm.Lines.Text:=<span class="hljs-string"><span class="hljs-string">'test6'</span></span><span class="hljs-string"><span class="hljs-string">#10#13</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> _a:=a(f.OpenId(<span class="hljs-string"><span class="hljs-string">'pas.a'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>)); __a:=_a; test_(f.<span class="hljs-keyword"><span class="hljs-keyword">Static</span></span>(<span class="hljs-string"><span class="hljs-string">'pas.test'</span></span>)).test6(<span class="hljs-string"><span class="hljs-string">'1'</span></span>,__a,blob,rs1,rs2); cs1:=ICharStream(rs1); cs2:=ICharStream(rs2); mm.Lines.Append(<span class="hljs-string"><span class="hljs-string">'A.aString = '</span></span>+_a.aString); mm.Lines.Append(<span class="hljs-string"><span class="hljs-string">'BLOB.Size = '</span></span>+IntToStr(IBinaryStream(blob).size)); mm.Lines.Append(<span class="hljs-string"><span class="hljs-string">'RS1.Size = '</span></span>+IntToStr(cs1.size)); mm.Lines.Append(<span class="hljs-string"><span class="hljs-string">'RS2.Size = '</span></span>+IntToStr(cs2.size)); cds1.XMLData:=cs1.Data; cds2.XMLData:=cs2.Data; <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> _a.SYS_Close; _a:=<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; __a:=<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; blob:=<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; rs1:=<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; rs2:=<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; cs1:=<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; cs2:=<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; f.ForceSync; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  To support the <font color="darkblue">% XML.ZMyBaseDataSet</font> class of data in Unicode, as well as other unimplemented data types, you will need to customize it yourself. <br><br><h5>  Application distribution </h5><br>  To install with the application all the necessary drivers to the new computer, copy everything (for simplicity. You can limit the set of necessary files) files from the <i>C: \ Program Files \ Common Files \ InterSystems \ Cache \</i> directory and register some of them in the system using the utility <b>regsvr32 .exe</b> . <br><br>  EXAMPLE: <br><pre> <code class="hljs tex">regsvr32.exe /s "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Intersystems</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cache</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CacheQuery</span></span></span></span>.ocx" regsvr32.exe /s "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Intersystems</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cache</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CacheFormWizard</span></span></span></span>.dll" regsvr32.exe /s "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Intersystems</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cache</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CacheList</span></span></span></span>.ocx" regsvr32.exe /s "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Intersystems</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cache</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CacheActiveX</span></span></span></span>.dll" regsvr32.exe /s "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Intersystems</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cache</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vism</span></span></span></span>.ocx" regsvr32.exe /s "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Intersystems</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cache</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TL</span></span></span></span>.dll"</code> </pre> <br><h5>  <a href="http://db.tt/nOwWu3NI">Sources</a> </h5><br><ul><li>  server part <pre>  pas.xml </pre></li><li>  client part <pre>  Unit1.dfm
 test_TLB.pas
 Unit1.pas </pre></li><li>  generated proxy classes <pre>  test.odl </pre></li></ul></div><p>Source: <a href="https://habr.com/ru/post/144306/">https://habr.com/ru/post/144306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144300/index.html">Entropy - Inaccurate programming language</a></li>
<li><a href="../144301/index.html">Loading and storing data in an application with a complex database structure</a></li>
<li><a href="../144302/index.html">How to do several things at the same time and at the same time in turn?</a></li>
<li><a href="../144304/index.html">Expansion of the built-in documentation in the Cach√© DBMS</a></li>
<li><a href="../144305/index.html">Optimize OSX for SSD</a></li>
<li><a href="../144307/index.html">So.cl: Microsoft's social search based social network.</a></li>
<li><a href="../144308/index.html">From idea to release. Manifest</a></li>
<li><a href="../144309/index.html">SASS vs. LESS</a></li>
<li><a href="../144310/index.html">Work with SSL / TLS in Cach√© DBMS</a></li>
<li><a href="../144311/index.html">Work with sockets in Cach√© DBMS. An example of the implementation of the server side of the protocol WebSocket</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>