<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to find everyone in the network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[The note was published in the Sandbox, decided to move it to the blog] 

 So, we have: a subsidiary, even two, with a dozen technical engineers, an o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to find everyone in the network</h1><div class="post__text post__text-html js-mediator-article"> [The note was published in the Sandbox, decided to move it to the blog] <br><br>  So, we have: a subsidiary, even two, with a dozen technical engineers, an office <a title="IPv4 Subnetting Reference" href="http://en.wikipedia.org/wiki/IPv4_subnetting_reference">subnet of class C</a> , a lot of equipment and the absence of a system administrator (to be exact, he comes and decides only critical issues).  In the appendage questions like: <br><br>  - Listen, and how to determine the network address of this piece of iron (a piece of hardware is presented in an industrial design), without resetting the settings?  Who set up I do not know, but once she worked for us, in which subnet - I do not know either. <br>  - Do you know by any chance what address we have on the DVSR?  Yes, we have this, yes, we set, but no one remembers. <br>  - And what are our addresses are not busy from 64 to 80? <br>  - (incoming admin call) Your mail server was down in the morning because someone occupied its IP.  Judging by the logs, that computer had MAC xx: xx: xx: xx: xx: xx, can you tell me what it was? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And for this, they bother me to sleep during the day!  It is urgent to find a solution, you can even inelegant, but fast and effective. <br><a name="habracut"></a><br>  So let's get started.  Let's start with the fact that I have no admin access to any server or router.  But then there is one powerful vytsigannaya machine, which settled Ubuntu Linux.  So everything will live on it, and the result of the work will be available on a local web server. <br><br>  To close the problem from the technical side, you just need to know what devices appeared on the network (MAC addresses), what IP they occupied, to be aware of if a new device with IP from office subnets (10.0.0.0/24 and 62.85) appears on the network. xx.0 / 28 (DMZ + demo)). <br><br>  You can either passively listen to the network and collect all MAC addresses, or for the same purpose, use active scanning and write all new information to the log.  The second option seemed to me more simple and interesting. <br><br>  1) Install <a title="arp-scan home" href="http://www.nta-monitor.com/tools/arp-scan/index.html">arp-scan</a> : <br><br> <code>$ sudo apt-get install arp-scan</code> <br> <br>  2) Let's write a small script that will create 2 files: a list of computers that are active on the network now, and a list of all detected MAC / IP combinations during the script operation (cumulative) and upload them to the internal web.  In addition, he will notify the system administrator of all new devices on the network; for sending mail, we use the sSMTP utility. <br><br> <code>#!/bin/bash <br> # <br> # quick and dirty scan for new devices <br> # create empty /var/www/list.txt before first run <br> # <br> arp-scan --interface eth0 62.85.xx.0/28 | grep ^62 &gt; /tmp/x2 <br> arp-scan --interface eth0 10.0.0.0/24 | grep ^10 &gt; /tmp/x1 <br> echo `date` &gt; /var/www/current.txt <br> cat /tmp/x1 /tmp/x2 | sort | uniq &gt;&gt; /var/www/current.txt <br> # <br> # send email if completely new IP/MAC pair found <br> test `diff /var/www/current.txt /var/www/list.txt | grep '&lt;' | wc -l` -gt 1 &amp;&amp; \ (echo "Subject: New equipment found" &gt; /tmp/report; diff /var/www/current.txt /var/www/list.txt | grep '&lt;' &gt;&gt; /tmp/report;\ <br> ssmtp rat@admin.lv &lt; /tmp/report) || echo false &gt; /dev/null <br> # mplayer /usr/share/sounds/war2/orcs/basic-orc-voices/annoyed7.wav <br> # <br> cat /var/www/list.txt /tmp/x1 /tmp/x2 | sort |uniq &gt; /tmp/list.txt <br> mv /tmp/list.txt /var/www/list.txt</code> <br> <br>  We get a fairly informative list of all IPs and all MACs that have ever used these IPs, with an indication of the network interface vendors. <br><br>  Since arp-scan uses very low-level access, both he and the entire script work only with administrator rights. <br><br>  3) Add the script to the crontab (I chose the hourly drawdown): <br><br> <code>$ sudo mv arpscan /etc/cron.hourly/ <br> $ sudo chown root.root /etc/cron.hourly/arpscan <br> $ sudo chmod +x /etc/cron.hourly/arpscan</code> <br> <br>  Everything, now we have up-to-date and automatically (!) Updated information about active devices in the network (the scan source will not be shown): <br><br> <code>Sat Dec 13 00:17:35 EET 2008 <br> 10.0.0.10 00:17:a4:0c:8f:xx Global Data Services <br> 10.0.0.1 00:50:da:de:a7:xx 3COM CORPORATION <br> 10.0.0.102 00:00:85:77:e9:xx CANON INC. <br> 10.0.0.104 00:1b:78:24:19:xx Hewlett Packard <br> 10.0.0.11 00:18:fe:33:59:xx Hewlett Packard</code> <br> <br>  In addition, in the mailbox there is a log when for the first time some interface was lit up in the network. <br><br>  By the way, such statistics are quite useful for novice admins who try to filter access to the Internet and keep track of traffic only by the IP addresses of the machines, and the curious users quietly change their IP and create what they want.  Now, these "mind games" will be documented. <br><br>  We drink coffee more ... </div><p>Source: <a href="https://habr.com/ru/post/86005/">https://habr.com/ru/post/86005/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../85991/index.html">Favorite white elephant padishah</a></li>
<li><a href="../85992/index.html">Which engine or framework do you use for graphics in your Flash / flex projects?</a></li>
<li><a href="../86000/index.html">Pants differentiation</a></li>
<li><a href="../86002/index.html">Opera Developers in Ecstasy - 4 builds per day</a></li>
<li><a href="../86004/index.html">Logo Design for Dummies</a></li>
<li><a href="../86006/index.html">"Effective work in Mozilla Firefox"</a></li>
<li><a href="../86007/index.html">Problems in the cultivation of good IT-specialists, as well as Uncle Vasya was the manager of the programmers department</a></li>
<li><a href="../86008/index.html">Electronics in Formula 1 cars</a></li>
<li><a href="../86009/index.html">Programming Language Popularity Index</a></li>
<li><a href="../86011/index.html">First slice of rails</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>