<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The whole truth about RTOS. Article # 27. System time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The concept of time in the context of RTOS was introduced in one of the previous articles , along with the idea of ‚Äã‚Äãthe time-related functions availa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The whole truth about RTOS. Article # 27. System time</h1><div class="post__text post__text-html js-mediator-article">  The concept of time in the context of RTOS was introduced in one of the <a href="https://habr.com/ru/post/418677/">previous articles</a> , along with the idea of ‚Äã‚Äãthe time-related functions available in the RTOS. <br><br><img src="https://habrastorage.org/webt/u0/4z/bl/u04zbllomewnuxhei-ydrxmaeew.jpeg"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Previous articles in the series:</b> <div class="spoiler_text">  <a href="https://habr.com/ru/post/433374/">Article # 26.</a>  <a href="https://habr.com/ru/post/433374/">Channels: Auxiliary Services and Data Structures</a> <br>  <a href="https://habr.com/ru/post/433046/">Article # 25.</a>  <a href="https://habr.com/ru/post/433046/">Data Channels: Introduction and Basic Services</a> <br>  <a href="https://habr.com/ru/post/432804/">Article # 24.</a>  <a href="https://habr.com/ru/post/432804/">Queues: helper services and data structures</a> <br>  <a href="https://habr.com/post/431378/">Article # 23.</a>  <a href="https://habr.com/post/431378/">Queues: introduction and basic services</a> <br>  <a href="https://habr.com/post/431118/">Article # 22.</a>  <a href="https://habr.com/post/431118/">Mailboxes: ancillary services and data structures</a> <br>  <a href="https://habr.com/post/430856/">Article # 21.</a>  <a href="https://habr.com/post/430856/">Mailboxes: Introduction and Basic Services</a> <br>  <a href="https://habr.com/post/429588/">Article # 20.</a>  <a href="https://habr.com/post/429588/">Semaphores: helper services and data structures</a> <br>  <a href="https://habr.com/post/429156/">Article # 19.</a>  <a href="https://habr.com/post/429156/">Semaphores: introduction and basic services</a> <br>  <a href="https://habr.com/post/428890/">Article # 18.</a>  <a href="https://habr.com/post/428890/">Event flag groups: helper services and data structures</a> <br>  <a href="https://habr.com/post/428131/">Article # 17.</a>  <a href="https://habr.com/post/428131/">Event flag groups: introduction and basic services</a> <br>  <a href="https://habr.com/post/427439/">Article # 16.</a>  <a href="https://habr.com/post/427439/">Signals</a> <br>  <a href="https://habr.com/post/426477/">Article # 15.</a>  <a href="https://habr.com/post/426477/">Memory sections: services and data structures</a> <br>  <a href="https://habr.com/post/426425/">Article # 14.</a>  <a href="https://habr.com/post/426425/">Memory sections: introduction and basic services</a> <br>  <a href="https://habr.com/post/425353/">Article # 13.</a>  <a href="https://habr.com/post/425353/">Task data structures and unsupported API calls</a> <br>  <a href="https://habr.com/post/424713/">Article # 12.</a>  <a href="https://habr.com/post/424713/">Task Services</a> <br>  <a href="https://habr.com/post/424481/">Article # 11.</a>  <a href="https://habr.com/post/424481/">Tasks: configuration and introduction to the API</a> <br>  <a href="https://habr.com/post/423967/">Article # 10.</a>  <a href="https://habr.com/post/423967/">Scheduler: additional features and context preservation</a> <br>  <a href="https://habr.com/post/422615/">Article # 9.</a>  <a href="https://habr.com/post/422615/">Scheduler: implementation</a> <br>  <a href="https://habr.com/post/422617/">Article # 8.</a>  <a href="https://habr.com/post/422617/">Nucleus SE: Inside and Deployment</a> <br>  <a href="https://habr.com/post/418601/">Article # 7.</a>  <a href="https://habr.com/post/418601/">Nucleus SE: introduction</a> <br>  <a href="https://habr.com/post/418677/">Article # 6.</a>  <a href="https://habr.com/post/418677/">Other RTOS services</a> <br>  <a href="https://habr.com/post/415429/">Article # 5.</a>  <a href="https://habr.com/post/415429/">Interaction between tasks and synchronization</a> <br>  <a href="https://habr.com/post/415427/">Article # 4.</a>  <a href="https://habr.com/post/415427/">Tasks, context switching and interrupts</a> <br>  <a href="https://habr.com/post/415329/">Article # 3.</a>  <a href="https://habr.com/post/415329/">Tasks and planning</a> <br>  <a href="https://habr.com/post/414093/">Article # 2.</a>  <a href="https://habr.com/post/414093/">RTOS: Structure and Real Time</a> <a href="https://habr.com/post/414093/"><br></a>  <a href="https://habr.com/post/414093/">Article # 1.</a>  <a href="https://habr.com/post/414093/">RTOS: introduction.</a> <br></div></div><br><h3>  Timer Tick </h3><br>  All functions related to time are controlled by the hardware clock.  This is a simple oscillator that generates interrupt requests at regular intervals.  For clock numbers to make sense for application programs, the generator frequency must be known. <br><br><h3>  Timer Interrupt Handling </h3><br>  Interrupts generated by the hardware timer must be serviced in a certain way in the interrupt handler (English Interrupt Service Routine, ISR), which implements all the RTOS functions related to time.  The details of the timer interrupt handler in Nucleus SE will be covered in one of the following articles. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Time related functions </h3><br>  Nucleus RTOS and Nucleus SE contain several time-related mechanisms: <br><br><ul><li>  <b>System Tick Clock (Tick clock)</b> : a simple counter that is incremented with a timer interrupt handler.  Both in the Nucleus RTOS and in the Nucleus SE, the bit width is 32 bits, and tasks have mechanisms for reading and writing its value.  In the Nucleus SE, the clock timer is optional. </li><li>  <b>Software timers (Application timers)</b> : Both Nucleus RTOS and Nucleus SE support timer objects.  Their use and implementation in the Nucleus SE will be discussed in more detail in the next article. </li><li>  <b>Planning time slicing (Time slice scheduling)</b> : in the Nucleus RTOS, tasks with the same priority are served using the Round-robin algorithm, but other than that, you can use time slicing.  In Nucleus SE, the time slicing scheduler is optional;  this has been discussed in detail in previous articles ( <a href="https://habr.com/ru/post/415329/">general idea of ‚Äã‚Äãthe TS (Time slice) scheduler</a> and <a href="https://habr.com/ru/post/423967/">TS in the Nucleus SE</a> ). </li><li>  <b>Pause task (Task sleep)</b> : A task can pause itself (‚Äúfall asleep‚Äù) for a fixed period of time.  This mechanism has already been described in detail <a href="https://habr.com/ru/post/418677/">earlier</a> . </li><li>  <b>API call timeouts (timeout)</b> : in both Nucleus RTOS and Nucleus SE, some API calls allow you to pause a task while the resource is available.  The suspension may be undefined, or, in the case of a Nucleus RTOS, an optional timeout period may be specified (waiting period).  In Nucleus SE, API call timeouts are not supported. </li></ul><br><h3>  Accuracy </h3><br>  And now it is worth briefly talking about the accuracy of the system timer. <br><br>  The accuracy of the time functions is directly dependent on the frequency of the clock generator.  For example, if the pulses arrive every 10 milliseconds, and the application task needs a delay of 100 milliseconds, it obviously needs 10 pulses.  However, it is not known when the previous impulse was received: it could have just happened, or almost 10 milliseconds ago.  Therefore, a 100 millisecond delay can take up to 110 milliseconds. <br><br>  An obvious way to solve this problem is to increase the frequency of the generator.  If pulses follow at intervals of 1 millisecond, a 100-ms delay will never take more than one-hundred-millisecond.  The disadvantage of this solution is that the timer interrupt handler will take 10 times more CPU time, which will be excessive.  The system developer must find a balance between the required accuracy of the timer and the available processor power. <br><br><h2>  Setting the system time </h2><br>  As with most Nucleus SE objects, the system time setting is mostly controlled by the <b>#define</b> directives in the <b>nuse_config.h</b> file.  The main parameter is <b>NUSE_SYSTEM_TIME_SUPPORT</b> , which activates the system time support mechanism.  The number of objects does not need to be specified: the system time is either activated or not. <br><br>  The choice of a non-zero value is the main activator of the system time.  This parameter is used when defining data structures, which will be discussed in detail later in this article.  In addition, a non-zero value activates the API settings. <br><br><h3>  API activation </h3><br>  Each API function (service call) in Nucleus SE has an activating #define directive in the nuse_config.h file.  For system time, these characters are: <br>  <b>NUSE_CLOCK_SET</b> <br>  <b>NUSE_CLOCK_RETRIEVE</b> <br><br>  By default, they are assigned the value <b>FALSE</b> , thus all service calls are disabled, blocking the inclusion of the code implementing them.  To set the system time in the application, select the necessary API service calls and set them to <b>TRUE</b> . <br><br>  Below is the default code snippet from the nuse_config.h file. <br><br><pre><code class="plaintext hljs">#define NUSE_SYSTEM_TIME_SUPPORT FALSE /*    */ #define NUSE_CLOCK_SET FALSE /*   */ #define NUSE_CLOCK_RETRIEVE FALSE /*    */</code> </pre> <br>  If you try to use the system time API service call when the system time activator is off, a compilation error will occur.  If your code uses an API call that has not been activated, a build error will occur because the implementation code was not included in the application. <br><br><h2>  System Time Utility Calls </h2><br>  Nucleus RTOS supports two service calls that relate to system time and provide the following functionality: <br><br><ul><li>  Set the system time value.  The Nucleus SE is implemented as a <b>NUSE_Clock_Set ()</b> function. </li><li>  Getting the system time value.  In Nucleus SE, it is implemented in the <b>NUSE_Clock_Retrieve ()</b> function. </li></ul><br>  Consider the implementation of each of these calls in more detail. <br><br><h2>  Service calls to set and get system time </h2><br>  With system time, you can perform only the installation operation at the specified value and get the current value.  Nucleus RTOS and Nucleus SE each provide two basic API calls to implement these operations. <br><br>  Interpretation of the system time value depends on the application, since it is in its essence a counter for the number of clock ticks that have occurred since the last reset of the counter.  To use this information, the oscillator frequency must be known. <br><br><h3>  Time setting </h3><br>  Any task can set the system time by calling this API function. <br><br>  <b><i>Call to set the system time in Nucleus RTOS</i></b> <br><br>  Service Call Prototype: <br>  <b>VOID NU_Set_Clock (UNSIGNED new_value);</b> <br><br>  Options: <br>  <b>new_value</b> - the value that will be assigned to the system time <br><br>  Return value: none. <br><br>  <b><i>Call to set the system time in Nucleus SE</i></b> <br>  This API call supports the core functionality of the Nucleus RTOS API. <br><br>  Service Call Prototype: <br>  <b>void NUSE_Clock_Set (U32 new_value);</b> <br><br>  Options: <br>  <b>new_value</b> - the value that will be assigned to the system time <br><br>  Return Value: None <br><br>  <b><i>Implementing a time setting in the Nucleus SE</i></b> <br>  The code is very simple.  The provided value is written to <b>NUSE_Tick_Clock</b> inside the critical section. <br><br><h3>  Getting system time </h3><br>  A task can get the system time value using this API function. <br><br>  <b><i>Call for getting system time in Nucleus RTOS</i></b> <br><br>  Service Call Prototype: <br>  <b>UNSIGNED NU_Retrieve_Clock (VOID);</b> <br><br>  Parameters: None <br><br>  Return Value: current system time <br><br>  <b><i>Call to get system time in Nucleus SE</i></b> <br>  Service Call Prototype: <br>  <b>U32 NUSE_Clock_Retrieve (void);</b> <br><br>  Parameters: None <br><br>  Return Value: current system time <br><br>  <b><i>Implement getting time in Nucleus SE</i></b> <br>  The code is very simple.  The function returns the <b>NUSE_Tick_Clock</b> value obtained in the critical section. <br><br><h2>  Data structures </h2><br>  System time uses a single data structure (located in RAM), which is a 32-bit word. <br><br>  I strongly recommend that the application code does not use direct access to this data structure, but access it through the provided API functions.  This will avoid incompatibility with future versions of the Nucleus SE and unwanted side effects, as well as simplify porting applications to the Nucleus RTOS.  Detailed information about the data structures is provided below to simplify the understanding of how the service call code works and for debugging. <br><br><h3>  RAM data </h3><br>  Data structure: <br>  <b>NUSE_Tick_Clock</b> is a <b>U32</b> variable in which the system clock clock counter is stored. <br><br>  This data structure is initialized to zero by the <b>NUSE_Init_Task ()</b> function when the Nucleus SE is started.  One of the following articles will contain a full description of how Nucleus SE runs. <br><br><h3>  ROM data </h3><br>  There are no system time data structures in ROM. <br><br><h3>  Memory for system time </h3><br>  As with all other Nucleus SE objects, the amount of memory required for system time is predictable. <br><br>  The amount of memory in the ROM is 0. <br><br>  The amount of memory in RAM (in bytes) is always 4. <br><br><h2>  Unrealized API calls </h2><br>  All Nucleus RTOS API service calls related to system time have an equivalent in Nucleus SE. <br><br><h3>  Nucleus PLUS Compatibility </h3><br>  As with all other Nucleus SE objects, my goal was to ensure the highest possible compatibility of application code with Nucleus RTOS.  System time is no exception and, from the user's point of view, it is implemented in much the same way as in the Nucleus RTOS.  Nucleus RTOS API calls can be directly transferred to the Nucleus SE. <br><br>  In the next article we will look at software timers. </div><p>Source: <a href="https://habr.com/ru/post/454272/">https://habr.com/ru/post/454272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454256/index.html">What is wrong with our IT</a></li>
<li><a href="../454260/index.html">Children's Day from a bad code</a></li>
<li><a href="../454262/index.html">Why Every Data Scientist Should Know Dask</a></li>
<li><a href="../454264/index.html">4 intelligent channels on Youtube about technical interviews</a></li>
<li><a href="../454266/index.html">Dell and Alienware on Computex 2019: talk about the key updates</a></li>
<li><a href="../454274/index.html">Light, camera ... cloud: How clouds change the movie industry</a></li>
<li><a href="../454278/index.html">Cyber ‚Äã‚Äãinsurance on the Russian market</a></li>
<li><a href="../45428/index.html">Eloquera - object database with SQL</a></li>
<li><a href="../454280/index.html">Remote development in VS Code: your life will never be the same</a></li>
<li><a href="../454282/index.html">The history of assembling a ‚Äúvillage supercomputer‚Äù from spare parts from eBay, Aliexpress and a computer store. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>