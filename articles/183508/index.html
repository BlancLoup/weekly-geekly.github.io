<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing Your Web Application on Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I thought about writing a Web application using Go, I was only pursuing a desire to try something new for myself. Later, I realized that the Web ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing Your Web Application on Go</h1><div class="post__text post__text-html js-mediator-article">  When I thought about writing a Web application using Go, I was only pursuing a desire to try something new for myself.  Later, I realized that the Web shell can be used as a cross-platform GUI library, which I used in my project [ <a href="http://mapitemeditor.sourceforge.net/">1</a> ]. <br><a name="habracut"></a><br><br><h5>  Introduction </h5><br>  The difference from this lesson from the others is that I will consider only standard Go packages.  For my task, this was more than enough, and I had no desire to understand any frameworks (for example, Revel [ <a href="http://habrahabr.ru/post/162115/">2</a> ]).  So I will touch on the topic of requests.  For example, there is no clear example on uploading a file to a server on the Internet at the moment.  Therefore, I decided to write an article that will allow you to create a skeleton for further development. <br><br>  In the program, I will not handle errors due to a decrease in the amount of code.  Also, I will not describe trivial things, such as the obvious arguments of functions (for more details, see the official documentation [ <a href="http://golang.org/doc/">3</a> ] [ <a href="http://golang.org/pkg/">4</a> ]).  Some points, for clarity, can be described not strictly formal language, or not quite right. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Start </h5><br>  Let's start with a simple ‚ÄúHello World‚Äù program.  To do this, we need to describe the handler function: <br><pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>) w.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello World!!!"</span></span>)) }</code> </pre> <br>  The function arguments are <b>ResponseWriter</b> and <b>Request</b> .  <b>ResponseWriter</b> is an interface that is used to form an HTTP response, <b>Request</b> is an HTTP request received by the server or intended to be sent to the client.  In this function, in the header, set the content type to ‚Äúplain text‚Äù, and then send our string to the client. <br><br>  Next, we need to ‚Äúbind‚Äù this handler to the pattern: <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, index) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":80"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) }</code> </pre><br><br>  With <b>HandleFunc,</b> we bind the handler function to the pattern, and with the help of <b>ListenAndServe</b> we start the server directly.  The pattern can be any: "/", "/ page0", "/ page0 / page01".  But everything after the pattern will apply to it.  For example, we registered two patterns: "/" and "/ page0".  If in the address bar to write "/ page", then the appeal will be to "/", and if "/ page0 / page", then to "/ page0".  The complete code looks like this: <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>) w.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello World!!!"</span></span>)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, index) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":80"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) }</code> </pre><br><br>  We compile, run (or immediately launch), in the browser, go to the address where the server is running (on the local machine it is localhost - 127.0.0.1) and see our line. <br><br><h5>  We use templates </h5><br>  The "embedded" html-code in the program looks extremely ugly and extremely inconvenient for editing (especially in large projects): <br><pre> <code class="go hljs">fmt.Fprint(w, <span class="hljs-string"><span class="hljs-string">"&lt;form target=\"_blank\" action=\"/exec/\" enctype=\"multipart/form-data\" method=\"post\"&gt;"</span></span>+ <span class="hljs-string"><span class="hljs-string">"&lt;input type=\"file\" name=\"imgfile\" /&gt;"</span></span>+ <span class="hljs-string"><span class="hljs-string">"&lt;input type=\"submit\" name=\"button\" value=\"Execute\" /&gt;"</span></span>+ <span class="hljs-string"><span class="hljs-string">"&lt;/form&gt;"</span></span>)</code> </pre><br><br>  Therefore, we will use the <b>template</b> package to improve readability and ease of editing.  To begin, let's write the ‚Äúbackbone‚Äù of our page (I will be guided by the HTML5 standard): <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>{{.Title}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{.Msg}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>Title</b> and <b>Msg</b> later turn into text, but more on that later.  First we need to describe the data structure, which we later pass to the function: <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> page <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Title <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-comment"><span class="hljs-comment">//     ,    ! Msg string //     ! }</span></span></code> </pre><br><br>  Now we will write the handler function: <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>) t, _ := template.ParseFiles(‚Äúindex.html‚Äù) t.Execute(w, &amp;page{Title: <span class="hljs-string"><span class="hljs-string">"Just page"</span></span>, Msg: <span class="hljs-string"><span class="hljs-string">"Hello World"</span></span>}) }</code> </pre><br><br>  <b>ParseFiles</b> - loads the specified file (or files), <b>Execute</b> processes the template, substituting the data, and writes them to <b>w</b> . <br><br><h5>  Event handling </h5><br>  The last thing left is to make a page with some button, file download, etc.  In the example, the server will accept the image file, convert it to JPEG with a quality of 0 (this will clearly show that everything works), and returns it. <br><br>  Let's change our html-template by adding a form with the POST method to it: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/exec/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enctype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"multipart/form-data"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"imgfile"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Execute"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Let's write the handler function: <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>) title := r.URL.Path[<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(<span class="hljs-string"><span class="hljs-string">"/"</span></span>):] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> title != <span class="hljs-string"><span class="hljs-string">"exec/"</span></span> { t, _ := template.ParseFiles(<span class="hljs-string"><span class="hljs-string">"index.html"</span></span>) t.Execute(w, &amp;page{Title: <span class="hljs-string"><span class="hljs-string">"Convert Image"</span></span>}) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { imgfile, fhead, _ := r.FormFile(<span class="hljs-string"><span class="hljs-string">"imgfile"</span></span>) img, ext, _ := image.Decode(imgfile) w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"image/jpeg"</span></span>) w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-Disposition"</span></span>, <span class="hljs-string"><span class="hljs-string">"filename=\""</span></span> + fhead.Filename + <span class="hljs-string"><span class="hljs-string">"."</span></span> + ext + <span class="hljs-string"><span class="hljs-string">"\""</span></span>) jpeg.Encode(w, img, &amp;jpeg.Options{<span class="hljs-number"><span class="hljs-number">0</span></span>}) } }</code> </pre><br><br>  The variable <b>title</b> will be what is after the pattern.  For example, if the address is ‚Äúhttp: // localhost / qwe /‚Äù, then the <b>title</b> will be ‚Äúqwe /‚Äù.  Next we look, if we are not on ‚Äúexec /‚Äù, then we load, process and output a regular page, but if we are on ‚Äúexec /‚Äù, then we process the input file.  <b>FormFile</b> - returns a file with the specified key (if there are several such forms, then the first one) and some information about the file.  We set the content type (as ‚Äúimage / jpeg‚Äù), the file name (the server will send the answer to the browser with this name) and write the image. <br><br><div class="spoiler">  <b class="spoiler_title">The full text of the example</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">index.html</b> <div class="spoiler_text"><pre> <code class="hljs django"><span class="xml"><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{.Title}}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/exec/"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">enctype</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"multipart/form-data"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"imgfile"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Execute"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">lesson.go</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"html/template"</span></span> <span class="hljs-string"><span class="hljs-string">"image"</span></span> <span class="hljs-string"><span class="hljs-string">"image/jpeg"</span></span> _<span class="hljs-string"><span class="hljs-string">"image/png"</span></span> _<span class="hljs-string"><span class="hljs-string">"image/gif"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> page <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Title <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Msg <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>) title := r.URL.Path[<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(<span class="hljs-string"><span class="hljs-string">"/"</span></span>):] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> title != <span class="hljs-string"><span class="hljs-string">"exec/"</span></span> { t, _ := template.ParseFiles(<span class="hljs-string"><span class="hljs-string">"index.html"</span></span>) t.Execute(w, &amp;page{Title: <span class="hljs-string"><span class="hljs-string">"Convert Image"</span></span>}) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { imgfile, fhead, _ := r.FormFile(<span class="hljs-string"><span class="hljs-string">"imgfile"</span></span>) img, ext, _ := image.Decode(imgfile) w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"image/jpeg"</span></span>) w.Header().Set(<span class="hljs-string"><span class="hljs-string">"Content-Disposition"</span></span>, <span class="hljs-string"><span class="hljs-string">"filename=\""</span></span> + fhead.Filename + <span class="hljs-string"><span class="hljs-string">"."</span></span> + ext + <span class="hljs-string"><span class="hljs-string">"\""</span></span>) jpeg.Encode(w, img, &amp;jpeg.Options{<span class="hljs-number"><span class="hljs-number">0</span></span>}) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, index) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":80"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) }</code> </pre><br></div></div><br></div></div><br><br>  And one more thing, if you use some local file in your template (for example, an image file), then you will have to write a handler or use <b>FileServer</b> from the <b>http</b> package.  In the first case, you will have something like this: <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { file, _ := ioutil.ReadFile(<span class="hljs-string"><span class="hljs-string">"img/logo.png"</span></span>) w.Write(file) } &lt;...&gt; http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/img/logo.png"</span></span>, logo) &lt;...&gt;</code> </pre><br><br>  And in the second everything is easier, because  no need to describe every single file: <br><pre> <code class="go hljs">&lt;...&gt; http.Handle(<span class="hljs-string"><span class="hljs-string">"/img/"</span></span>, http.StripPrefix(<span class="hljs-string"><span class="hljs-string">"/img/"</span></span>, http.FileServer(http.Dir(<span class="hljs-string"><span class="hljs-string">"./img/"</span></span>)))) &lt;...&gt;</code> </pre><br><br><h5>  Conclusion </h5><br>  Thus, I showed how simple and clear Go can be to write my own Web application.  The advantages of Go are the simplicity of the language itself, the simplicity of the packages for working with the HTTP protocol, the possibility of using templates, as well as the independence of the code written on pure Go from the architecture and the operating system.  Go currently supports: FreeBSD (x86, amd64, arm), NetBSD (x86, amd64), GNU / Linux (x86, amd64, arm), MacOS X (x86, amd64), Windows (x86, amd64). <br><br><hr><br>  [1] <a href="http://mapitemeditor.sourceforge.net/">mapitemeditor.sourceforge.net</a> <br>  [2] <a href="http://habrahabr.ru/post/162115/">habrahabr.ru/post/162115</a> <br>  [3] <a href="http://golang.org/doc/">golang.org/doc</a> <br>  [4] <a href="http://golang.org/pkg/">golang.org/pkg</a> </div><p>Source: <a href="https://habr.com/ru/post/183508/">https://habr.com/ru/post/183508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183496/index.html">The open source community is leaning toward more liberal licenses.</a></li>
<li><a href="../183498/index.html">Re-port of old EXE applications using Wineskin on Mac OS X 10.7.5 and 10.8.2</a></li>
<li><a href="../183502/index.html">Several useful templates for Android development under eclipse</a></li>
<li><a href="../183504/index.html">How to make the world applaud while standing. Making startups popular</a></li>
<li><a href="../183506/index.html">2084. Death to Copyright</a></li>
<li><a href="../183512/index.html">The entire observable universe in one video from scientists at the University of Lyon</a></li>
<li><a href="../183514/index.html">SiDiM text markers: new DRM scheme for e-book protection</a></li>
<li><a href="../183518/index.html">Siklum announces Amazonization of .NET developers in Kharkov!</a></li>
<li><a href="../183520/index.html">Why Hong Kong is an Excellent Option for Snowden</a></li>
<li><a href="../183526/index.html">NSA drama continues: GCHQ overheard politicians talks at the G20 summit and built fake Internet cafes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>