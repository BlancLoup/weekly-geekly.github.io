<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy way to add license file support to your .Net application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago, a friend asked me to automate part of the routine work of his business. At that moment I was anticipating the onset of the coming reduc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy way to add license file support to your .Net application</h1><div class="post__text post__text-html js-mediator-article">  Some time ago, a friend asked me to automate part of the routine work of his business.  At that moment I was anticipating the onset of the coming reduction, and I agreed with pleasure. <br>  The development took three full cycles and now the fourth and final cycle of work on the program is coming to an end and I had an idea to move my product further to the masses.  It‚Äôs been said, work has begun on drawing up contracts, redesigning, otbutforsingu and other other craps, and an interesting question arose - how to protect the program from non-licensed use and not allow it to be copied? <br><a name="habracut"></a><br>  Poryskav on the Internet, more precisely on the portal <a href="http://codeproject.com/">CodeProject</a> , found several implementations using license files. <br>  In theory, the problem is solved simply: <br><ol><li>  Create an xml file with the content we need </li><li>  Sign the file with the SignedXml class </li><li>  In the application we check the signature.  If the check is successful - we look at the contents of the file, if not - we immediately drop out with an error </li></ol><br>  In practice, the SignedXml object requires an instance of AssimetricAlgorithm encryption.  In the examples found, asymmetric encryption was used with any certificate installed on the computer and then decrypted by the exported public key.  Taking into account the fact that after some time I am going to reinstall the system, it was necessary to be bothered about exporting the certificate, and it‚Äôs not an option that it can then get back up, and a very long implementation code. <br>  I thought, because there may be a way easier.  And found. <br>  All the work of the Subscriber is to add to the xml some line that should be checked.  So why not write there my string formed by a certain algorithm.  My method uses a symmetric encryption method, so to speak. <br>  I needed to check whether the license had reached its expiration date, how many updates were possible and who actually owns this license. <br>  I created two classes: one to create a license file, the other to check it. <br>  The method is very simple.  We take the input parameters to create a license, write everything in xml.  Then we concatenate these same parameters, add a certain constant to them, we get a hash, which will be our signature and append it to the end of xml in the appropriate section. <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> LicenseGenerator <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Generate( <font color="#0000ff">string</font> Path, <font color="#2B91AF">String</font> Name, <font color="#2B91AF">DateTime</font> StartDate, <font color="#2B91AF">DateTime</font> UpdateTo) <br> { <br> <br> <font color="#2B91AF">XmlDocument</font> doc = <font color="#0000ff">new</font> <font color="#2B91AF">XmlDocument</font> (); <br> doc.LoadXml( <font color="#A31515">@"&lt;license&gt; <br> &lt;Name&gt;&lt;/Name&gt; <br> &lt;Date&gt;&lt;/Date&gt; <br> &lt;UpdateTo&gt;&lt;/UpdateTo&gt; <br> &lt;Signature&gt;&lt;/Signature&gt; <br> &lt;/license&gt;"</font> ); <br> doc.ChildNodes[0].SelectSingleNode( <font color="#A31515">@"/license/Name"</font> , <font color="#0000ff">null</font> ).InnerText = Name; <br> doc.ChildNodes[0].SelectSingleNode( <font color="#A31515">@"/license/Date"</font> , <font color="#0000ff">null</font> ).InnerText = StartDate.ToShortDateString(); <br> doc.ChildNodes[0].SelectSingleNode( <font color="#A31515">@"/license/UpdateTo"</font> , <font color="#0000ff">null</font> ).InnerText = UpdateTo.ToShortDateString(); <br> <br> MD5 md5 = <font color="#0000ff">new</font> MD5CryptoServiceProvider(); <br> <font color="#0000ff">byte</font> [] data = System.Text. <font color="#2B91AF">Encoding</font> .UTF8.GetBytes(Name + StartDate.ToShortDateString() + UpdateTo.ToShortDateString() + <font color="#A31515">"SomePasswordKey"</font> ); <br> <font color="#0000ff">byte</font> [] hash = md5.ComputeHash(data); <br> doc.ChildNodes[0].SelectSingleNode( <font color="#A31515">@"/license/Signature"</font> , <font color="#0000ff">null</font> ).InnerText = <font color="#2B91AF">Convert</font> .ToBase64String(hash); <br> doc.Save(System.IO.Path.Combine(Path, <font color="#A31515">"license.xml"</font> )); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  At the output we get something like this license.xml <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">license</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Name</font> <font color="#0000ff">&gt;</font>  <font color="#0000ff">&lt;/</font> <font color="#800000">Name</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Date</font> <font color="#0000ff">&gt;</font> 15.06.2009 <font color="#0000ff">&lt;/</font> <font color="#800000">Date</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">UpdateTo</font> <font color="#0000ff">&gt;</font> 15.12.2009 <font color="#0000ff">&lt;/</font> <font color="#800000">UpdateTo</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Signature</font> <font color="#0000ff">&gt;</font> w673nrcuvxjnn7R4heEnvw== <font color="#0000ff">&lt;/</font> <font color="#800000">Signature</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">license</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, in the protected application, we need to pass a check, this is done by calling the Verify method every time the application is started: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> LicenseVerify <br> { <br> <font color="#0000ff">public</font> LicenseVerify() { } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> Name { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#2B91AF">DateTime</font> StartDate { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ;} <br> <font color="#0000ff">public</font> <font color="#2B91AF">DateTime</font> UpdateTo { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ;} <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Verify() <br> { <br> <font color="#0000ff">string</font> <font color="#2B91AF">File</font> = <font color="#A31515">"license.xml"</font> ; <br> <font color="#0000ff">if</font> (!System.IO. <font color="#2B91AF">File</font> .Exists( <font color="#2B91AF">File</font> )) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ApplicationException ( <font color="#A31515">"    !     License.xml.\n   ."</font> ); <br> } <br> <br> <font color="#2B91AF">XmlDocument</font> doc = <font color="#0000ff">new</font> <font color="#2B91AF">XmlDocument</font> (); <br> doc.Load( <font color="#2B91AF">File</font> ); <br> <font color="#0000ff">string</font> sig1; <br> <font color="#0000ff">string</font> Signature; <br> <font color="#0000ff">try</font> <br> { <br> <font color="#0000ff">string</font> Name = doc.ChildNodes[0].SelectSingleNode( <font color="#A31515">@"/license/Name"</font> , <font color="#0000ff">null</font> ).InnerText; <br> <font color="#0000ff">string</font> StartDate = doc.ChildNodes[0].SelectSingleNode( <font color="#A31515">@"/license/Date"</font> , <font color="#0000ff">null</font> ).InnerText; <br> <font color="#0000ff">string</font> UpdateTo = doc.ChildNodes[0].SelectSingleNode( <font color="#A31515">@"/license/UpdateTo"</font> , <font color="#0000ff">null</font> ).InnerText; <br> Signature = doc.ChildNodes[0].SelectSingleNode( <font color="#A31515">@"/license/Signature"</font> , <font color="#0000ff">null</font> ).InnerText; <br> MD5 md5 = <font color="#0000ff">new</font> MD5CryptoServiceProvider(); <br> <font color="#0000ff">byte</font> [] data = System.Text. <font color="#2B91AF">Encoding</font> .UTF8.GetBytes(Name + StartDate + UpdateTo + <font color="#A31515">"SomePasswordKey"</font> ); <br> <font color="#0000ff">byte</font> [] hash = md5.ComputeHash(data); <br> sig1 = <font color="#2B91AF">Convert</font> .ToBase64String(hash); <br> <font color="#0000ff">this</font> .Name = Name; <br> <font color="#0000ff">this</font> .StartDate = <font color="#2B91AF">Convert</font> .ToDateTime(StartDate); <br> <font color="#0000ff">this</font> .UpdateTo = <font color="#2B91AF">Convert</font> .ToDateTime(UpdateTo); <br> } <br> <font color="#0000ff">catch</font> (Exception) <br> { <br> <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ApplicationException( <font color="#A31515">"    !\n   !\n  ."</font> ); <br> } <br> <br> <font color="#0000ff">if</font> (sig1 != Signature) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ApplicationException( <font color="#A31515">"    !\n   !\n  ."</font> ); <br> <br> } <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">DateTime</font> .Now &lt; <font color="#0000ff">this</font> .StartDate) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ApplicationException( <font color="#0000ff">string</font> .Format( <font color="#A31515">"    !\n     !  {0}\n  ."</font> ,StartDate.ToShortDateString())); <br> <br> } <br> <br> <font color="#0000ff">if</font> (App.Created &gt; <font color="#0000ff">this</font> .UpdateTo) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ApplicationException( <font color="#0000ff">string</font> .Format( <font color="#A31515">"    !\n      .\n     {0}\n  ."</font> , UpdateTo.ToShortDateString())); <br> <br> } <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The negative may be that having solved SomePasswordKey, having received a disassembly code, an attacker can create his license file. <br>  The positive point is the simplicity of implementation, when cryptographic protection does not come in the first place. <br><br>  ToDo List: <br><ul><li>  Add the ability to create temporary trial versions of the program </li><li>  Add the ability to bind a license to a specific computer </li><li>  It is possible to create a web service where requests for creating license keys and automatic receipt of ready-made keys or a basis for refusal will be sent. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/62315/">https://habr.com/ru/post/62315/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../62308/index.html">Children's Wikipedia. Need?</a></li>
<li><a href="../62309/index.html">Until the roof has moved out - paint it white</a></li>
<li><a href="../62311/index.html">Open air do it yourself</a></li>
<li><a href="../62312/index.html">Weather Monitoring or Cacti HowTo</a></li>
<li><a href="../62314/index.html">Safe JSONP? An interesting feature of the Bing API</a></li>
<li><a href="../62316/index.html">Elections in Iran: Internet media as a means of fighting for freedom of choice</a></li>
<li><a href="../62317/index.html">Miranda 0.8 released</a></li>
<li><a href="../62318/index.html">1048 characters / minute 0_o</a></li>
<li><a href="../62320/index.html">New Evernote - specifically for iPhone 3.0</a></li>
<li><a href="../62321/index.html">SanDisk Cruzer - flash drive from the future</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>