<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with databases in the 3CX Call Flow Designer development environment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In this article we will explain how to query SQL Server database from 3CX Call Flow Designer using Database Access. Note that the Datab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with databases in the 3CX Call Flow Designer development environment</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br>  In this article we will explain how to query SQL Server database from 3CX Call Flow Designer using Database Access.  Note that the Database Access component can also work with the PostgreSQL database, which is used by 3CX Phone System. <br><br>  The demo project of this voice application comes with the 3CX CFD distribution and is located in the <strong>Documents \ 3CX Call Flow Designer Demos</strong> folder.  If you want to use it - just specify the location of your database and access credentials. <br><br>  Our voice application will request the user PIN (it can be a client number, insurance policy, etc.), checks it in the database and transfers it to the specified extension number (it can be a service employee, a voice menu prepared in advance or another voice application ) if pin is found. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Project creation </h3><br>  To create a CFD project, go to <b>File ‚Üí New ‚Üí Project</b> , specify the folder where the project is located and its name, for example, <b>DatabaseAccessDemo</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/715/311/6a8/7153116a8b455ab1d77f9e84f66c72e4.png"><br><br><h3>  Request PIN from user </h3><br>  User PIN is requested using the User Input component.  Add the component to the voice application: <br><br><ul><li>  Drag the User Input component from the component set on the left to the main application screen.  Select the component and in the Properties window rename it to <strong>requestPIN</strong> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e84/e6e/095/e84e6e0956263e0665d27de25f40ab29.png"><br><br></li><li>  Double-click on the component to open the configuration window, and set the following properties: <br><br><ul><li>  <strong>Initial Prompts</strong> - specify a WAV file in which the user will be asked for a PIN, for example, ‚ÄúEnter your personal identification number‚Äù.  <strong>WAV file format: PCM, 8 kHz, 16 bit, Mono.</strong> </li><li>  <strong>Subsequent Prompts</strong> - specify a WAV file with more detailed explanations of the entry.  It is played only if the user has made an incorrect input or has not entered anything at all.  For example, ‚ÄúEnter your personal identification number.  Numbers from 0 to 9 and length from 3 to 6 digits are allowed. ‚Äù </li><li>  <strong>Timeout Prompts</strong> - enter a WAV file with a warning that nothing has been entered, for example, ‚ÄúSorry, we did not receive input from you‚Äù. </li><li>  <strong>Invalid Digit Prompts</strong> - enter a WAV file with a warning about an incorrect one (too few digits or they are invalid), for example, ‚ÄúUnfortunately, you entered a PIN incorrectly‚Äù. </li></ul><br></li><li>  Configure the remaining options as shown below and click OK to save. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/1e2/cf0/41e/1e2cf041efb66a26c9516cdb3237f9af.png"><br><br><h3>  Validation of the entered PIN in the database </h3><br>  After receiving the PIN from the user, it should be checked in the database.  To do this, add the <strong>Database Access</strong> component to the branch of the <strong>Valid Input</strong> component, assuming the correct input.  Rename the component to <strong>validatePIN</strong> and double click on it to set the properties: <br><br><ul><li>  <strong>Database Type</strong> - select <b>SqlServer</b> . </li><li>  <strong>Configure each property separately</strong> - select this option to specify connection parameters separately.  However, you can also specify a <a href="https://www.connectionstrings.com/sql-server/">database connection string</a> . </li><li>  <strong>Server</strong> - the name or IP address of the database server.  This field can also be an expression, so if you specify a constant, <strong>put it in quotes</strong> . </li><li>  <strong>Port</strong> - the port of the SQL server.  When using the standard port number, this field can be left blank. </li><li>  <b>User Name</b> and <b>Password</b> - database connection credentials.  Values ‚Äã‚Äãare also variable. </li><li>  <strong>Statement Type</strong> - specify <strong>Scalar</strong> , since  you only need to get one value from the database - the number of user records with this PIN. </li><li>  <strong>Timeout</strong> - leave the default 30 seconds.  or change, if necessary. </li><li>  <strong>SQL Statement</strong> - this field indicates the database query string.  But first, we add a parameter to the Parameters section, which is used in the query string.  The parameter is a PIN entered by the user. </li><li>  <strong>id</strong> is the variable name, <strong>requestPIN.Buffer</strong> is the value, i.e.  input buffer in the User Input component (which we previously called <strong>requestPIN</strong> ) </li></ul><br>  Now enter the query string to the database.  Use the small button to the right of the input box to insert the value of the <strong>id</strong> variable <strong>.</strong>  Our line has the form: <br><br><pre>  SELECT count (*) FROM customers WHERE id = {0} </pre><br>  The properties of the <strong>Database Access</strong> component should look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/437/700/9f3/4377009f3e727d7b85a96f68fd33bc25.png"><br><br><h3>  Checking the result of an SQL query and choosing further actions </h3><br>  After configuring the <strong>Database Access</strong> component, we proceed to the PIN verification.  To do this, add the <strong>Create a Condition</strong> component with two conditions (branches) - successful and unsuccessful validation. <br><br>  Drag the component from the left side and rename it to <strong>validateDatabaseResult</strong> .  Rename the branch to <b>success</b> and <strong>error</strong> .  The development environment window should look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/659/c0e/75c/659c0e75c91415672d81fc8392669ca1.png"><br><br>  In order for the <strong>success</strong> branch to be executed, the database request must return 1, which means that a client with such a PIN code was found (one record was found).  To do this manually or using the expression constructor, we introduce a conditional operator: <br><br><pre>  EQUAL (validatePIN.ScalarResult, 1) </pre><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/a57/0b4/15d/a570b415d36b3496a7a3e49be7a69ec3.png" alt="image" width="595" height="139"></a> <br><br>  After you have specified the conditions for the <strong>success</strong> branch, add the <strong>Prompt Playback</strong> components for all possible voice application branches: PIN found, PIN not found, and the PIN is not entered correctly the allowed number of times (we have User Retract <strong>Max Retry Count = 3</strong> ).  In the parameters of the components, specify the appropriate WAV notification file. <br><br>  After that, add the <strong>Transfer</strong> component to the <strong>success</strong> branch, which will transfer the call to the employee.  The voice application will look something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd4/6ea/819/cd46ea8194eaa9f0edd2ba2db480b4ce.png"><br><br><h3>  Compiling and installing the application on the 3CX server </h3><br>  Voice application is ready!  Now it should be compiled and uploaded to the 3CX server.  For this: <br><br><ul><li>  Go to <b>Build&gt; Build All</b> , and the CFD will create a <strong>DatabaseAccessDemo.tcxvoiceapp</strong> file. </li><li>  Go to the 3CX management interface, in the <b>Call Queues</b> section.  Create a new Call Queue, specify the name and extension number of the Queue, and then set the <b>Voice Applications</b> option and download the compiled file <b>.</b> </li><li>  Save your changes to the Call Queue.  Voice application is ready to use. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/a85/374/b4d/a85374b4d6bb9906ed10c63ae6403a21.png"><br><br>  You can check the operation of the application by calling the Queue extension number and entering the PIN for verification.  If it is found in the database, the call will be transferred to the operator. <br><br><h3>  Downloads and Documentation </h3><br><ul><li>  <a href="">3CX Call Flow Designer</a> </li><li>  <a href="https://www.3cx.com/docs/manual/cfd-installation/">3CX CFD Documentation</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/334472/">https://habr.com/ru/post/334472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334458/index.html">Team web studio: growth system, certification and motivation</a></li>
<li><a href="../334460/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ273 (July 24 - 30, 2017)</a></li>
<li><a href="../334462/index.html">PHP Digest number 113 - the latest news, materials and tools (July 16 - 30, 2017)</a></li>
<li><a href="../334466/index.html">How to start the implementation of ERP</a></li>
<li><a href="../334470/index.html">Play with Docker - an online service for practical acquaintance with Docker</a></li>
<li><a href="../334474/index.html">Pygest # 14. Releases, articles, interesting projects from the world of Python [July 18, 2017 - July 31, 2017]</a></li>
<li><a href="../334476/index.html">Association of .NET communities</a></li>
<li><a href="../334478/index.html">Bluetooth mesh - the basic components of the network</a></li>
<li><a href="../334482/index.html">I invite you to summer open lectures on the gaming industry at VSBI</a></li>
<li><a href="../334484/index.html">High-Availability Postgres Clustering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>