<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Running line on Arduino + control from the smartphone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Every year on the street, in transitions, more and more advertising LED panels appear in the stores, on which the text runs up and down, an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Running line on Arduino + control from the smartphone</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  Every year on the street, in transitions, more and more advertising LED panels appear in the stores, on which the text runs up and down, and left and right, and all sorts of colorful pictures are displayed.  All this by itself attracts the attention of passers-by and me as well.  And often I wondered how this was done and whether something like this could be repeated at home.  And just this semester, we had scheduled course work on circuit design, and one of the suggested topics was ‚ÄúElectronic running line‚Äù.  I thought: ‚ÄúWhat the hell is not joking?  I'll try. <br><a name="habracut"></a><br><h4>  Search for necessary materials and first steps </h4><br>  Previously, I somehow tried to mess with the LEDs, more precisely with the LED tape, but it was a simple light-music system using a single transistor.  And here you need to somehow make the LED matrix, and store the text somewhere, and somehow display it.  At the "crumbling" just do not do that, at least with my experience. <br><br>  My light music: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/a3KGCB4q4fc%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhi7-btigFfOLrMOceG9vMtTuRZ4Eg" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Heard what you can do on the Arduino platform.  I used to hear that there is such a cool programmable board that this project was a start-up that collected a considerable amount of money, but did not go into details.  And then I had to.  I watched several videos with examples of projects implemented on Arduino, I liked it, I bought it. <br><br>  In my work, Arduino Uno R3 was used, but not the original, but a copy.  As I read, there is not much difference between the copy and the original.  Arduino board has 14 digital I / O, 6 analog, external power inputs, outputs +5 V, +3.3 V, GND.  Connects to the computer via USB.  For programming the microcontroller uses its own IDE, which is distributed free of charge on the official website of the Arduino. <br><br>  With Arduino it is clear, now we need to decide how to make the LED matrix itself.  Initially, an article was chosen as the basis for developing the project, in which it was proposed to use ready-made modules with LED arrays and shift registers.  The scheme is shown in Figure 1. The use of ready-made modules, namely the MAX7219, would greatly simplify development, since it would be necessary to only properly connect everything and write a program for correct operation and output of information. <br><br><img src="https://brainy-bits.com/wp-content/uploads/2015/02/Max719Scrolling-Edited.png" alt="image"><br><br>  However, there were difficulties in finding this module in our country, so it was decided to look for another way of implementation.  And somehow it would just be completely.  Therefore, I decided that the matrix itself should be made on LEDs, since there is enough information on the Internet how to do this. <br><br><h4>  Development </h4><br>  The size of the matrix was chosen 8x10.  It was originally planned to use the shift register 74HC595, which comes in a set with Arduino, to select the LED matrix column, and it has eight outputs.  Here everyone would be responsible for a particular column.  However, in the process of soldering, the leg of the register, which is responsible for the output of Q0, was accidentally damaged, so it had to be abandoned.  In this scheme, a register in essence could only reduce the number of Arduino outputs used to control the matrix.  When using it, only three outputs would be involved, and so the 8th had to be sacrificed (from 2 to 9).  Fortunately, there are enough of them. <br><br>  Register scheme: <br><br><img src="http://bildr.org/blog/wp-content/uploads/2011/02/574px-SN74HC595-pinout.png" alt="image"><br><br>  To select the row of the matrix, a decimal counter with a decoder K176IE8 was used.  The choice fell on this chip because of its popularity, and also because it has 10 outputs, just to control the 10th row of the matrix.  The counter is controlled using an Arduino microcontroller via the reset, count, and 5 V output inputs. <br><br>  The outputs of the counter are connected to the transistor unit to control the LED matrix.  Connection will be considered in the block of transistors. <br><br>  Counter scheme: <br><br><img src="https://blogspot.tenettech.com/wp-content/uploads/2014/07/FGHGATNFWMO2YYQ.LARGE_.jpg" alt="image"><br><br>  As a result, the functional diagram is as follows: <br><br><img src="http://storage3.static.itmages.ru/i/15/1228/h_1451323985_9587490_db62692b2a.png" alt="image"><br><br><h4>  Block transistors </h4><br>  To control the LEDs, in addition to the signal supplied to the anodes from 2 to 9 ports of the Arduino, you must also apply voltage to the cathodes of the LEDs.  This is done using a block of transistors. <br><br>  All cathodes of the LEDs of each row are interconnected and connected to the collectors of 10 transistors.  The emitters of the transistors are connected to the "ground", and the signals from the meter outputs come to the base. <br><br>  This project uses bipolar npn transistors of type 2N3904.  Since each transistor is connected to its own row of the matrix, in total, 10 of them are used in the circuit.  The choice fell on this type of transistors because of their popularity, as well as compliance with the conditions of the developed scheme.  This transistor is used in low voltage circuits.  General view and UGO of this transistor: <br><br><img src="http://www.ecs.umass.edu/ece/m5/images/2N3904_pin_layout_S.jpg" alt="image"><br><br>  Now you can describe how the LED lights up.  From a specific port Arduino signal is sent to the anode of the LED.  At the same time, a signal from the specific output is sent to the base of the emitter.  And from the collector of the transistor goes voltage to the cathodes of the LEDs.  Since in the matrix the anodes of the LEDs of the adjacent rows are connected in series, and the cathodes of the LEDs of the adjacent columns are connected in series, at the same time several LEDs of the matrix light up. <br><br>  <b>An important point!</b>  Arduino produces about 5 V at the output, therefore, to connect the anodes of the LEDs to the Arduino, you need to use resistors with a nominal value of 220 ohms, and to connect the transistor base to the meter outputs - with a nominal value of 1 kŒ©.  It is easy to find these resistors, especially since they are in the Arduino starter kit. <br><br><h4>  From thought to action, or from scheme to implementation </h4><br>  As a result, the following device was soldered. <br><br><img src="http://cs630130.vk.me/v630130861/9fc5/TyM9kmyFZRs.jpg" alt="image"><img src="http://cs630130.vk.me/v630130861/9fcf/WXyPcvgJnCE.jpg" alt="image"><br><br><h4>  Software part </h4><br>  Now the whole thing had to be connected to Arduino.  The code itself was written in C. First of all, you need to initialize the ports used on the Arduino board.  This is done in the setup () function as follows: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) pinMode(i,OUTPUT); pinMode(clock,OUTPUT); pinMode(reset,OUTPUT); digitalWrite(reset,HIGH); delayMicroseconds(<span class="hljs-number"><span class="hljs-number">5</span></span>); digitalWrite(reset,LOW); }</code> </pre> <br>  clock and reset are ports 11 and 10 of the Arduino, respectively. <br><br>  The first thing is an indication that ports 2 through 9 are used as holiday.  This is done in a loop using the pinMode method (i, OUTPUT), where i is the port number, OUTPUT is a flag indicating that this port is output. <br><br>  Further, the clock and reset ports are initialized in the same way.  Using the digitalWrite (reset, HIGH) function, a high voltage level is applied to the reset port, thereby resetting the counter.  After 5 ms delay (delayMicroseconds (5)), a low voltage level is applied to the reset port. <br><br>  After the ports are initialized, it is necessary to develop an algorithm to turn on the LEDs to output test information and simulate their movement, i.e.  make the algorithm a running line. <br><br>  For this, a separate function display_symbol (int loops) was created, which takes as its argument a delay value to simulate text movement.  It was established experimentally that all information is better perceived if the delay value is in the range from 15 to 25. <br><br>  Consider the internal implementation of the display_symbol (int loops) function. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display_symbol</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> loops)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(x=<span class="hljs-number"><span class="hljs-number">0</span></span>;x&lt;numsymbols<span class="hljs-number"><span class="hljs-number">-1</span></span>;x++){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z=<span class="hljs-number"><span class="hljs-number">0</span></span>;z&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>;z++){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t=<span class="hljs-number"><span class="hljs-number">0</span></span>;t&lt;loops;t++){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">9</span></span>;y&gt;<span class="hljs-number"><span class="hljs-number">-1</span></span>;y--){ byte temp = symbols[x][y]; byte temp_2=symbols[x+<span class="hljs-number"><span class="hljs-number">1</span></span>][y]; byte val = (temp&lt;&lt;z)+(temp_2&gt;&gt;<span class="hljs-number"><span class="hljs-number">7</span></span>-z); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i =<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>; i++) digitalWrite(i+<span class="hljs-number"><span class="hljs-number">2</span></span>, (val&gt;&gt;i)&amp;B00000001); delayMicroseconds(<span class="hljs-number"><span class="hljs-number">800</span></span>); digitalWrite(clock,HIGH); delayMicroseconds(<span class="hljs-number"><span class="hljs-number">5</span></span>); digitalWrite(clock,LOW); } } } } }</code> </pre><br>  First you see four nested loops.  The outermost loop passes through all elements of the byte array, i.e.  by output characters.  Byte array and its dimension is set by the developer manually looks like the following: <br><br><pre> <code class="cpp hljs">byte symbols[numsymbols][<span class="hljs-number"><span class="hljs-number">10</span></span>]={C, X, E, M, O, T, E, X, H, I_RUS, K, A }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numsymbols = <span class="hljs-number"><span class="hljs-number">13</span></span>;</code> </pre><br>  Each character is decomposed into 10 bytes, which corresponds to the number of lines, and each byte is known to consist of 8 bits.  Each bit is responsible for a specific LED on the circuit.  An example of a broken-down character: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> I_RUS {B00000000,B01000010,B01000010,B01000110,B01001010,B01010010,B01010010,B01100010,B01000010,B00000000}</span></span></code> </pre><br>  For example, 0 and 9 bytes look like B00000000, which means that LEDs 1 and 10 will not light up.  This is done for easy reading by the user.  And here, for example, the 1st byte with the value B01000010 indicates that the second line for this symbol should light up 2 and 7 LEDs.  Thus from all these bytes the character of the letter "I" is built. <br><br>  Here is what happened as a result: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/DHzmkDo30hc%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjMfhzJy3y5TbLRTCBW9003y3wuBA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  And where is the promised control from a smartphone? </h4><br>  In principle, I was satisfied with the result, after all, for the first time, I soldered so much and everything worked right away.  But I wanted more, and I thought to add control from an Android smartphone via Bluetooth.  For Arduino there is a ready module HC-06.  The scheme of its connection to the Arduino is as follows: <br><br><img src="http://zelectro.com.ua/Media/Default/Periphery/24_Bluetooth_HC-06/bluetooth_hc-06_800.jpg" alt="image"><br><br>  Details of the connection to the Arduino and connections to the smartphone are described in this article: <a href="http://zelectro.cc/HC-06_bluetooth_module">Bluetooth module HC-06 connection to the Arduino.</a>  <a href="http://zelectro.cc/HC-06_bluetooth_module">Connection with telephone and computer</a> <br>  In accordance with this code has been changed.  And I decided to add accelerated scrolling of the text, inverse ignition of the LEDs and scrolling of the text with flickering.  Links to code for Android and Arduino will be lower.  The result was such a thing: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Wx-xhDnBp3c%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjLfm5aUv-rvA_eTFAxHLSyTsgLcg" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Conclusion </h4><br>  First, with regard to developed coursework.  The main advantage of the developed device is its versatility.  Thanks to the use of the Arduino programmable board, the project can be expanded using various sensors and writing the appropriate firmware.  As a result, in addition to the running line functionality, you can add the functionality for displaying weather conditions using, respectively, temperature, humidity and atmospheric pressure sensors.  If you add any sound sensor, you can modify the scheme to the musical equalizer. <br><br>  But the general conclusions are that the Arduino is a really cool thing, with which you can make a lot of useful and cool stuff at home that people who have dedicated to electronics for more than one year could have done before.  Moreover, there are many examples of various devices on the Arduino on the Internet in the public domain.  There are even many books on Arduino, one of which I would definitely recommend to consider as a guide for beginners and advanced developers: <a href="https://store.arduino.cc/product/MK00629">Arduino CookBook</a> . <br><br>  <b>References to the code:</b> <br>  <a href="https://drive.google.com/file/d/0ByovJX81ppcZdWQwNVFtYUMzTWM/view%3Fusp%3Dsharing">Scrolling text</a> <br>  <a href="https://drive.google.com/file/d/0ByovJX81ppcZTDZYOGdRdHBySEU/view%3Fusp%3Dsharing">ScrollingText (Bluetooth)</a> <br>  <a href="https://drive.google.com/file/d/0ByovJX81ppcZaXpQTkdtdWhvMEE/view%3Fusp%3Dsharing">Android part</a> </div><p>Source: <a href="https://habr.com/ru/post/357932/">https://habr.com/ru/post/357932/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357920/index.html">Arduino <-> STM32 HAL, or there and back</a></li>
<li><a href="../357922/index.html">As I wrote code for Arduino using Python</a></li>
<li><a href="../357924/index.html">Keyboard layout indicator in the form of a color cube on the table using Arduino</a></li>
<li><a href="../357928/index.html">On power up</a></li>
<li><a href="../357930/index.html">Making the PC turn on cotton per evening</a></li>
<li><a href="../357934/index.html">LED cube 8x8x8, interesting and beautiful</a></li>
<li><a href="../357936/index.html">Smart Redmond SkyPlug RSP-100S Socket Analysis of the design and the electrical circuit diagram. Identifying deficiencies</a></li>
<li><a href="../357942/index.html">Heavy industry removal</a></li>
<li><a href="../357944/index.html">Attack of BitErrant with SHA-1 collisions: create different .exe with the same .torrent file</a></li>
<li><a href="../357950/index.html">Compact server for Django applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>