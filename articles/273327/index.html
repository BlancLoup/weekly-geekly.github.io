<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"War and Peace" - the test of time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="4 December days in a row, about 1,300 people for 60 hours from 30 cities read "War and Peace." An unprecedented multimedia project from VGTRK , during...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"War and Peace" - the test of time</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b50/38f/cb1/b5038fcb1c7d4c8b81e69b5c3f50450c.png"><br><br>  4 December days in a row, about 1,300 people for 60 hours from 30 cities read "War and Peace."  An unprecedented <a href="http://voinaimir.com/">multimedia project from VGTRK</a> , during which the work of Leo Tolstoy was read from the first to the last line.  The project captures its grandeur and draws on the Guinness Book of Records. <br><br>  In addition to the literary marathon, a <a href="http://voinaimir.com/info/">series of interactive infographic works</a> was released under the auspices of the Tolstoy Digital analytical community.  Each infographic, and a total of 4, analyzes the product from different angles: human relations, places, time, history, objects, culture in general. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under the cut, excerpts from the novel, some code and my thoughts on the process of infographic data on the example of an event timeline. <br><a name="habracut"></a><br><blockquote>  ‚ÄúHe didn‚Äôt really care at that moment, whoever stood over him, no matter what he said about him;  he was only glad that people had stopped over him, and only wished that these people would help him and bring him back to a life that seemed so beautiful to him, because he understood her so differently now. ‚Äù <br><br>  <a href="http://voinaimir.com/book/">Volume I, Part 3, Chapter 19</a> </blockquote><br>  The essence of the infographic is <b>getting answers to questions</b> .  Infographics can answer as one of the questions: What?  Where?  When?  How?  So combine different aspects of understanding several issues.  And sometimes infographics is just beautiful, without any measures for calculating the entropy. <br><br>  What you can be sure of is that <b>infographics cannot exist without data</b> .  If there is no data, then the infographics loses its meaning.  We will try to characterize the data in the context of an infographic - usually these are <b>numbers</b> , <b>texts,</b> and <b>links</b> between these numbers and texts, both multiple and single. <br><br>  The numbers themselves are already beautiful, and if they have a certain meaning, then they become more beautiful two, or even three or ten times for those who have guessed this meaning. <br><br>  Texts, in contrast to numbers, are meaningless, but sometimes, as it became with the work ‚ÄúWar and Peace‚Äù, the texts become masterpieces.  They are able to revive the events of two hundred years ago right before your eyes!  Especially if they are read by over a thousand people. <br><br>  The relationship between the data is the most difficult and intricate part when building infographics.  It is hard to hit the bull's eye the first time, ensuring the readability of infographics, selected links.  The first attempts cover the screen with the intricate intricacies of multicolored lines that come from nowhere and fall into unknown places. <br><blockquote>  ‚ÄúThe emperor said bluntly that the Council and the Senate are the essence of the state class;  He said that the board should have no basis for arbitrariness, but solid beginnings.  The Sovereign said that finances should be transformed and reports should be public. ‚Äù <br><br>  <a href="http://voinaimir.com/book/">Volume II, Part 3, Chapter 18</a> <br></blockquote><br>  If you have data on your hands, this is half the battle.  And what is the secret of the second half of the case? :) How quickly we can sort them out! <br><br>  What do you need to do?  Of course, to try to understand the data, look for patterns until blue in the face, try to bring them to an idealized scheme.  But the work can be simplified, both for yourself and for your colleagues, if you adhere to the following principles. <br><br><h4>  <b>Connect programmers at the design and data analysis stage</b> </h4><br>  Even if you are developing a static infographic, the programmer will be able to quickly prove or disprove the existing data view. <br><br><h4>  <b>Never edit raw data manually.</b> </h4><br>  This has a detrimental effect on job performance.  I want to immediately assure those who think that the data does not change.  They change more often than you think :) Therefore, we agree that our infographics accept the data that comes from the editors.  So you extend to the editors the boundaries of thinking, without driving them into narrow columns of a programmatic data set.  If there is too much data and the preparation process for live takes a long period of time, then it is necessary to bring them to a normalized form in advance.  But for starters, this process can be described in the infographics itself, and then cut into a separate data preparation module.  As we followed this advice as part of developing infographics: <br><br>  The essence of the timeline is to show how events in the novel correspond to the real course of historical events.  Each chapter, if it allows you to understand the text of the novel, is assigned a time range or a specific date.  All this information is contained in one of the columns in the source table.  It was he who caused the first difficulties, since the format was chaotic, but as it turned out, amenable to certain rules.  After a brief analysis, it turned out that there are about 12 patterns.  We write handlers and normalize the column to a single format: <br><br><pre><code class="javascript hljs">convertDate: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">date, year</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      date = util.clearValue(date); //   ,        if (['', ''].indexOf(date) !== -1) { return null; } //        28.01.1812 if (this.tests.testDate(date)) { return this.getDate(date); } //   ,         var dateParts = _.without(date .split(/[\s-]/g), '', '', '', '', ''); var patternId = ''; //         id  //  id    "42423",     9- for (var key in dateParts) { patternId += this.getPatternId(dateParts[key]); } //   ,      if (this.patterns[patternId]) { return this.patterns[patternId](dateParts, year); } }</span></span></code> </pre> <br>  The chapters that correspond to the historical period are described in another column.  They also have a chaotic representation, but are amenable to a certain logic: <br><br><pre> <code class="javascript hljs">getChapters: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">chapters</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,        if (['', ''].indexOf(this.clearValue(chapters)) !== -1) { return []; } return _.chain(this.clearValue(chapters, true) //           .replace(/[\.\,]$/g, '') //  ,      .split(/[\.\,]/g)) .map(chapter =&gt; { //    - var chapters = chapter.split('-'); if (chapters.length == 1) { return chapters[0]; } return _.invoke(_.range(Number(chapters[0]), Number(chapters[1]) + 1), 'toString'); }) //       .flatten() .uniq() .value() ; }</span></span></code> </pre><br><h4>  <b>Cache everything you can when starting your infographic</b> </h4><br>  Avoid runtime calculations, thereby you spare the users' cars from overloading.  Clean the data in advance.  Generate the missing pieces of data needed for visual collections.  If visual collections require repeated access after building HTML, cache all necessary elements into a data structure. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//           svg -  yearTimelineView.selectAll('.year') .data(yearsData) .enter() .append('g') .each(function(d) { d.yearNext = d.year + 1; d.startYearY = timeScale(new Date(d.year, 0)); d.endYearY = timeScale(new Date(d.yearNext, 0)); d.localYearY = (d.endYearY - d.startYearY)/2 d.yearView = d3.select(this); }) ;</span></span></code> </pre><br><h4>  <b>Prepare multilayer data</b> </h4><br>  Get separate convenient data structures for each visual collection.  Do not be afraid to duplicate the data, sometimes it is vital to preserve the transparency of the project. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//         var timelineData, filteredTimelineData, historyFilteredTimelineData, yearsData, dataByType, dataLinks, dataUrls, dataChapters;</span></span></code> </pre><br><h4>  <b>Turn the data inside out</b> </h4><br>  Manipulate data with the help of libraries: underscore, lodash and built-in d3 functions.  Always achieve the format that ensures you a comfortable work.  The most colorful examples of inversion of data in infographics: <br><br>  Baseline data are presented in 4 tables.  Not the best format for building two dependent timelines (history and novel).  Since the infographics is still about the book, we chose the novel as the main timeline, while the historical one was awarded a secondary role.  The underlying table describes three kinds of events: only in the novel, only in history and related events.  One adjacent event is described by two lines of data, and the connection is put through the field related_book_id in an adjacent historical event.  Since the book was chosen as the main timeline, the table had to be turned into two dependent lists linked by the related_book_id field. <br><br>  All infographic works are covered with references to the novel, this is done in order to go to the cash register and continue reading the novel, starting with the selected quotation.  The book, in turn, contains backlinks to infographics.  There were some difficulties in comparing links from infographics to the desired fragment in the book.  Since the quotation was the only key to get the link, I had to use an inaccurate string comparison algorithm.  An exact comparison gave only 30% compliance. <br><br><h4>  <b>Cover the data with tests</b> </h4><br>  Limits, checking for links in lists, correct sequences within the framework of infographic logic, formats - try to cover all possible cases.  Again, returning to the issue of teamwork, it is better to do it once in parallel with the main development and sleep well.  Any change of data will not pass by you, be sure. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// vpc -   , ,  //         console.log(v.id, '   vlc_id:', v.vpc_id); //       console.log(historyEvent.id, '  id  :', historyEvent.related_book_id);</span></span></code> </pre><br><h4>  <b>Complete the prototype in the first 10 hours</b> </h4><br>  This will give an idea where there are most serious inconsistencies in your understanding of how data works.  What it gave us: <br><br>  We were able to determine at an early stage that the history correspondence grid is too cumbersome in the order of 350 temporary serifs.  Moreover, a good half of them fall on a modest period in 1812.  A good idea with the analogy of the notebook in the ticker was only a good idea.  From this implementation had to be abandoned.  Instead, we left a grid of related events, it partly implements this functionality.  So it looked when there was a grid: <br><br><img src="https://habrastorage.org/files/6f2/ad7/245/6f2ad7245fa949c0a464465ece05bff3.png"><br><br>  I had to give up the range distribution in chapters, the picture became completely unreadable.  In some cases, it was not clear what color to color ties, the color of war or peace.  And the columns of information once contained too many quotes.  One of the early screenshots: <br><br><img src="https://habrastorage.org/files/e2e/392/de0/e2e392de0be14d148c56d57990174966.png"><br><br>  The events of the novel develop from 1805 to 1820, but the coverage is uneven.  It was decided to scale the years from the number of events.  The algorithm of the next 35% of the height of the timeline falls on all years in equal shares, the remaining 65% are divided between years with events, in proportion to the number of events. <br><br>  Many historical events, took place consistently with a small gap in time to avoid porridge, the points of events move a little downward relative to their initial positions, if the points are dropping. <br><br>  Historical events that occurred at the beginning of the year crawled on the dividing lines, as in the previous paragraph, we move them down a bit relative to the initial position. <br><br>  <b>This is the final infographic:</b> <br><br><img src="https://habrastorage.org/files/a71/f2c/08f/a71f2c08fd4b4998a00bfcb132cf217e.png"><br><br><blockquote>  ‚ÄúMoscow was so empty when Napoleon, tired, restless and frowned, walked up and down at the Kamercolledskiy rampart, waiting for the external, but necessary, in his opinion, respect for decency - deputation.  In different corners of Moscow, people were just senselessly still moving, observing old habits and not understanding what they were doing. ‚Äù <br><br>  <a href="http://voinaimir.com/book/">Volume III, Part 3, Chapter 19</a> </blockquote><br><br>  In addition to practices and methodologies, there is an important point - <b>tools</b> .  To understand how everything is arranged in d3, you do not need to have a 7-span in the forehead.  To begin with, we will bring to automatism the skills of working with three basic library features: <br><br><ul><li>  <b>Construction: enter - update - exit</b> .  We memorize as a mantra.  The more often you use it in work, the better - it characterizes the successful preparation of your data. </li><li>  <b>Scaling data.</b>  The second most popular feature of the framework. </li><li>  <b>Drawing helper path.</b>  Without it, it is difficult to imagine at least one project on d3. </li></ul><br><blockquote>  ‚ÄúIt was frosty and clear.  Above the dirty, dim streets, above the black roofs stood a dark starry sky.  Pierre, only looking at the sky, did not feel the insulting baseness of all earthly in comparison with the height at which his soul was located. ‚Äù <br><br>  <a href="http://voinaimir.com/book/">Volume II, Part 5, Chapter 22</a> </blockquote><br>  There was a final touch, preparation of the project for production.  As a build system, I used a webpack.  The transparency and flat structure of the rules allows you to completely forget about the routine of the task.  <a href="https://github.com/3ginger/webpack_template">Here</a> lies a clean template for launching a project with a webpack (also used in infographics). <br><br><h4>  <b>Epilogue</b> </h4><br><blockquote>  "There are only two virtues: activity and mind" <br><br>  <a href="http://voinaimir.com/book/">Volume I, Part 1, Chapter 22</a> </blockquote><br>  All battles begin in our head.  Strive for peace in your head and peace will reign around you. <br><br>  I would like to thank my ex-colleagues from the RIA Infographic Studio and all the participants of the literary marathon for this event. <br><br>  Hmm, what's an interesting idea: to make an infographic about how to read "War and Peace" ..?! <br><br>  <a href="https://github.com/3ginger/war_and_peace__timeline">Timeline Sources</a> <br>  <a href="https://github.com/3ginger/webpack_template">Webpack template</a> <br>  <a href="http://voinaimir.com/info/">Infographic project "War and Peace"</a> <br>  <a href="http://voinaimir.com/info/timeline/">Separately timeline here</a> </div><p>Source: <a href="https://habr.com/ru/post/273327/">https://habr.com/ru/post/273327/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273311/index.html">NW + Edge.js + Fiddler or a tale about the dockability of the untangible</a></li>
<li><a href="../273313/index.html">Predreliznoe testing has unexpectedly epic proportions</a></li>
<li><a href="../273319/index.html">Star Wars Universe Social Network</a></li>
<li><a href="../273323/index.html">Vivaldi Beta 2 browser release</a></li>
<li><a href="../273325/index.html">Santa Claus asks a question. Contest for Intel Blog Readers</a></li>
<li><a href="../273329/index.html">5 brightest scams with WhatsApp in 2015</a></li>
<li><a href="../273331/index.html">Comparative analysis of C # and C ++ languages</a></li>
<li><a href="../273333/index.html">As I have been rewriting my cryptocurrency with PHP for Go for 8 months. Part 2</a></li>
<li><a href="../273335/index.html">Lectures Technopark. Master class "20 mistakes in creating an IT-company"</a></li>
<li><a href="../273337/index.html">Detection of insider trading: Algorithms for identifying and patterns of illegal transactions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>