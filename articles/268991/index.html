<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pagination of lists in Android with RxJava. Part I</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often when developing a client, we are faced with the task of displaying any information from a server, database or something else in the form of a li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pagination of lists in Android with RxJava. Part I</h1><div class="post__text post__text-html js-mediator-article">  Often when developing a client, we are faced with the task of displaying any information from a server, database or something else in the form of a list.  And when scrolling through the list, the data should automatically be loaded and inserted into the list unnoticed by the user.  The user should generally get the impression that he will scroll an endless list. <br><br>  In this article I would like to tell you how to make an auto-loadable list the simplest to implement for a developer and as efficient and fast as possible for a user.  And also how RxJava will help us in this with its main dogma - ‚ÄúEverything is Stream!‚Äù <br><a name="habracut"></a><br><h3>  How do we implement this in Android? </h3><br>  <b>To begin with, we will define the source data:</b> <br><ol><li>  The component <code>RecyclerView</code> is responsible for displaying the list (I hope, we have already forgotten everything about <code>ListView</code> :)) and all the necessary classes for setting up the <code>RecyclerView</code> . </li><li>  The data will be loaded using queries (to the network, to the database, etc.) with the parameters classical for this task <code>offset</code> and <code>limit</code> </li></ol><br>  <b>Next, we describe the approximate algorithm of the auto-powered list:</b> <br><ol><li>  We load the first portion of data for the list.  We display this data. </li><li>  When scrolling the list, we need to keep track of which elements are displayed on the screen by number.  Specifically, the sequence number of the first or last member visible to the user. </li><li>  When an event occurs, for example, the last element visible on the screen is the last one in the list in general, we need to load a new piece of data.  It is also necessary to prevent the sending of identical requests.  That is, you need to somehow unsubscribe from "listening" to scrolling the list. </li><li>  New data send to the list.  The list must be updated.  Subscribe to the scroll hitch again. </li><li>  Items 2, 3, 4 must be repeated until all the data have been downloaded, or when another event is necessary. </li></ol><br>  <b>And what does RxJava have to do with it?</b> <br><br>  Remember, I spoke at the beginning about the main dogma Rx - ‚ÄúEverything is Stream!‚Äù.  If in OOP we think in categories of objects, in Reactive - in categories of flows. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, take a look at the second paragraph of the algorithm.  The first thing we‚Äôll stop at here is the scrolling and, accordingly, the changing sequence number of the first or last item visible on the screen (in the example we are considering, the last one).  That is, the list when scrolling constantly "radiates" the numbers of the last element throughout its life.  Nothing like?  Of course, this is the classic ‚Äúhot observable‚Äù.  And to be more specific, this is <code>PublishSubject</code> .  Secondly, <code>Subscriber</code> will perfectly suit the role of a ‚Äúlistener‚Äù. <br><br>  RxJava is like a huge set of "designers" from which the developer can create a variety of designs.  The beginning of the construction has already been made - the list "releases" the elements that are the numbers of the last visible line in the list.  Next, you can insert a constructor (they are essentially the same as streams), which are responsible for processing the received values, sending requests for uploading new data and embedding them in the list.  Well, first things first. <br><br>  <b>Give a reactive code!</b> <br><br>  And now to the practical part. <br><br>  Since we are creating a new auto-loadable list, we‚Äôll inherit from <code>RecyclerView</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AutoLoadingRecyclerView</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span></span></code> </pre><br>  Next, we must set the list parameter <code>limit</code> , responsible for the size of the portion of the loaded data at a time. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> limit; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (limit &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoLoadingRecyclerViewExceptions(<span class="hljs-string"><span class="hljs-string">"limit must be initialised! And limit must be more than zero!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> limit; } <span class="hljs-comment"><span class="hljs-comment">/** * required method */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.limit = limit; }</code> </pre><br>  Now <code>AutoLoadingRecyclerView</code> should "radiate" the sequence number of the last element visible on the screen. <br><br>  However, the ‚Äúemission‚Äù of just the sequence number is not very convenient in the future.  After all, this value needs to be processed.  Yes, and our channel (also known as the ‚Äúemitter‚Äù) will flood considerably, which also imposes a problem on the backpressure.  Then we will improve a little "radiator".  Let the output we will receive immediately ready-made values ‚Äã‚Äãof <code>offset</code> and <code>limit</code> , combined into the following model: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OffsetAndLimit</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> offset; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> limit; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OffsetAndLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.offset = offset; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.limit = limit; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOffset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> limit; } }</code> </pre><br>  Already better.  And now reduce the "flood" channel.  Let the channel ‚Äúradiate‚Äù elements only when necessary, that is, when you need to load a new portion of data. <br><br>  Take a look at the code. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PublishSubject&lt;OffsetAndLimit&gt; scrollLoadingChannel = PublishSubject.create(); <span class="hljs-comment"><span class="hljs-comment">//    private void startScrollingChannel() { addOnScrollListener(new RecyclerView.OnScrollListener() { @Override public void onScrolled(RecyclerView recyclerView, int dx, int dy) { int position = getLastVisibleItemPosition(); int limit = getLimit(); int updatePosition = getAdapter().getItemCount() - 1 - (limit / 2); if (position &gt;= updatePosition) { int offset = getAdapter().getItemCount() - 1; OffsetAndLimit offsetAndLimit = new OffsetAndLimit(offset, limit); scrollLoadingChannel.onNext(offsetAndLimit); } } }); } //          //     LayoutManager private int getLastVisibleItemPosition() { Class recyclerViewLMClass = getLayoutManager().getClass(); if (recyclerViewLMClass == LinearLayoutManager.class || LinearLayoutManager.class.isAssignableFrom(recyclerViewLMClass)) { LinearLayoutManager linearLayoutManager = (LinearLayoutManager)getLayoutManager(); return linearLayoutManager.findLastVisibleItemPosition(); } else if (recyclerViewLMClass == StaggeredGridLayoutManager.class || StaggeredGridLayoutManager.class.isAssignableFrom(recyclerViewLMClass)) { StaggeredGridLayoutManager staggeredGridLayoutManager = (StaggeredGridLayoutManager)getLayoutManager(); int[] into = staggeredGridLayoutManager.findLastVisibleItemPositions(null); List&lt;Integer&gt; intoList = new ArrayList&lt;&gt;(); for (int i : into) { intoList.add(i); } return Collections.max(intoList); } throw new AutoLoadingRecyclerViewExceptions("Unknown LayoutManager class: " + recyclerViewLMClass.toString()); }</span></span></code> </pre><br>  You probably want to ask where I got this condition from: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> updatePosition = getAdapter().getItemCount() - <span class="hljs-number"><span class="hljs-number">1</span></span> - (limit / <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre><br>  It was revealed in a purely empirical way, assuming that the average request time is 200-300ms.  Under this condition, ‚Äúsmooth scrolling‚Äù does not suffer from parallel loading of data.  If your request time is longer, you can either try to increase the <code>limit</code> or slightly change this condition so that the data loading takes place a little earlier. <br><br>  But still, we didn‚Äôt get rid of the channel completely.  When the condition of the start of loading is fulfilled and scrolling continues, the channel continues to ‚Äúflood‚Äù us with messages.  And we have all the possibilities to send the same requests for data uploading several times, and nobody backdated them - the network client may break.  Therefore, as soon as we receive the first message from the channel, we immediately unsubscribe from it, start loading the data, update the adapter and the list, and then subscribe again to the channel that will no longer ‚Äúflood‚Äù as the condition changes (the number of elements in list will increase): <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> updatePosition = getAdapter().getItemCount() - <span class="hljs-number"><span class="hljs-number">1</span></span> - (limit / <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre><br>  And so on the cycle.  And now attention to the code: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//     private void subscribeToLoadingChannel() { Subscriber&lt;OffsetAndLimit&gt; toLoadingChannelSubscriber = new Subscriber&lt;OffsetAndLimit&gt;() { @Override public void onCompleted() { } @Override public void onError(Throwable e) { Log.e(TAG, "subscribeToLoadingChannel error", e); } @Override public void onNext(OffsetAndLimit offsetAndLimit) { //    unsubscribe(); //    loadNewItems(offsetAndLimit); } }; // scrollLoadingChannel -   .    subscribeToLoadingChannelSubscription = scrollLoadingChannel .subscribe(toLoadingChannelSubscriber); } //    private void loadNewItems(OffsetAndLimit offsetAndLimit) { Subscriber&lt;List&lt;T&gt;&gt; loadNewItemsSubscriber = new Subscriber&lt;List&lt;T&gt;&gt;() { @Override public void onCompleted() { } @Override public void onError(Throwable e) { Log.e(TAG, "loadNewItems error", e); subscribeToLoadingChannel(); } @Override public void onNext(List&lt;T&gt; ts) { //      //  ,      addNewItems.    ,    getAdapter().addNewItems(ts); //   getAdapter().notifyItemInserted(getAdapter().getItemCount() - ts.size()); //        ,      (),      . //        if (ts.size() &gt; 0) { //     subscribeToLoadingChannel(); } } }; // getLoadingObservable().getLoadingObservable(offsetAndLimit) -     AutoLoadingRecyclerView Observable.     loadNewItemsSubscription = getLoadingObservable().getLoadingObservable(offsetAndLimit) //     UI  .subscribeOn(Schedulers.from(BackgroundExecutor.getSafeBackgroundExecutor())) //     UI (       ) //      (         ), //   View   UI  .observeOn(AndroidSchedulers.mainThread()) .subscribe(loadNewItemsSubscriber); }</span></span></code> </pre><br>  The hardest thing behind.  We managed to organize a safe list update cycle.  And all this inside our <code>AutoLoadingRecyclerView</code> . <br><br>  And in order for us to have a holistic impression, focus on the full code below: <br><br><div class="spoiler">  <b class="spoiler_title">OffsetAndLimit</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Offset and limit for {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> AutoLoadingRecyclerView AutoLoadedRecyclerView channel} * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> e.matsyuk */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OffsetAndLimit</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> offset; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> limit; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OffsetAndLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.offset = offset; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.limit = limit; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOffset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> limit; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"OffsetAndLimit{"</span></span> + <span class="hljs-string"><span class="hljs-string">"offset="</span></span> + offset + <span class="hljs-string"><span class="hljs-string">", limit="</span></span> + limit + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">AutoLoadingRecyclerViewExceptions</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> e.matsyuk */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AutoLoadingRecyclerViewExceptions</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RuntimeException</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AutoLoadingRecyclerViewExceptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">"Exception in AutoLoadingRecyclerView"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AutoLoadingRecyclerViewExceptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String detailMessage)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(detailMessage); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ioading</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> e.matsyuk */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoading</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ Observable&lt;List&lt;T&gt;&gt; getLoadingObservable(OffsetAndLimit offsetAndLimit); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">AutoLoadingRecyclerViewAdapter</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Adapter for {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> AutoLoadingRecyclerView AutoLoadingRecyclerView} * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> e.matsyuk */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AutoLoadingRecyclerViewAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;T&gt; listElements = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addNewItems</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;T&gt; items)</span></span></span><span class="hljs-function"> </span></span>{ listElements.addAll(items); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItems</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listElements; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listElements.get(position); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listElements.size(); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">LoadingRecyclerViewAdapter</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> e.matsyuk */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoadingRecyclerViewAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AutoLoadingRecyclerViewAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Item</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MAIN_VIEW = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewHolder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span></span>{ TextView textView; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View itemView)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(itemView); textView = (TextView) itemView.findViewById(R.id.text); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getItem(position).getId(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == MAIN_VIEW) { View v = LayoutInflater.from(parent.getContext()).inflate(R.layout.recycler_item, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MainViewHolder(v); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MAIN_VIEW; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (getItemViewType(position)) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MAIN_VIEW: onBindTextHolder(holder, position); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindTextHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ MainViewHolder mainHolder = (MainViewHolder) holder; mainHolder.textView.setText(getItem(position).getItemStr()); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">AutoLoadingRecyclerView</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> e.matsyuk */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AutoLoadingRecyclerView</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"AutoLoadingRecyclerView"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> START_OFFSET = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PublishSubject&lt;OffsetAndLimit&gt; scrollLoadingChannel = PublishSubject.create(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Subscription loadNewItemsSubscription; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Subscription subscribeToLoadingChannelSubscription; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> limit; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ILoading&lt;T&gt; iLoading; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AutoLoadingRecyclerViewAdapter&lt;T&gt; autoLoadingRecyclerViewAdapter; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AutoLoadingRecyclerView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); init(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AutoLoadingRecyclerView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs); init(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AutoLoadingRecyclerView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defStyle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs, defStyle); init(); } <span class="hljs-comment"><span class="hljs-comment">/** * required method * call after init all parameters in AutoLoadedRecyclerView */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ OffsetAndLimit offsetAndLimit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OffsetAndLimit(START_OFFSET, getLimit()); loadNewItems(offsetAndLimit); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ startScrollingChannel(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startScrollingChannel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ addOnScrollListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecyclerView.OnScrollListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onScrolled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView recyclerView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dy)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> position = getLastVisibleItemPosition(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> limit = getLimit(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> updatePosition = getAdapter().getItemCount() - <span class="hljs-number"><span class="hljs-number">1</span></span> - (limit / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position &gt;= updatePosition) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> offset = getAdapter().getItemCount() - <span class="hljs-number"><span class="hljs-number">1</span></span>; OffsetAndLimit offsetAndLimit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OffsetAndLimit(offset, limit); scrollLoadingChannel.onNext(offsetAndLimit); } } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastVisibleItemPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Class recyclerViewLMClass = getLayoutManager().getClass(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (recyclerViewLMClass == LinearLayoutManager.class || LinearLayoutManager.class.isAssignableFrom(recyclerViewLMClass)) { LinearLayoutManager linearLayoutManager = (LinearLayoutManager)getLayoutManager(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> linearLayoutManager.findLastVisibleItemPosition(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (recyclerViewLMClass == StaggeredGridLayoutManager.class || StaggeredGridLayoutManager.class.isAssignableFrom(recyclerViewLMClass)) { StaggeredGridLayoutManager staggeredGridLayoutManager = (StaggeredGridLayoutManager)getLayoutManager(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] into = staggeredGridLayoutManager.findLastVisibleItemPositions(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); List&lt;Integer&gt; intoList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i : into) { intoList.add(i); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.max(intoList); } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoLoadingRecyclerViewExceptions(<span class="hljs-string"><span class="hljs-string">"Unknown LayoutManager class: "</span></span> + recyclerViewLMClass.toString()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (limit &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoLoadingRecyclerViewExceptions(<span class="hljs-string"><span class="hljs-string">"limit must be initialised! And limit must be more than zero!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> limit; } <span class="hljs-comment"><span class="hljs-comment">/** * required method */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.limit = limit; } <span class="hljs-meta"><span class="hljs-meta">@Deprecated</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Adapter adapter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (adapter <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AutoLoadingRecyclerViewAdapter) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.setAdapter(adapter); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoLoadingRecyclerViewExceptions(<span class="hljs-string"><span class="hljs-string">"Adapter must be implement IAutoLoadedAdapter"</span></span>); } } <span class="hljs-comment"><span class="hljs-comment">/** * required method */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AutoLoadingRecyclerViewAdapter&lt;T&gt; autoLoadingRecyclerViewAdapter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (autoLoadingRecyclerViewAdapter == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoLoadingRecyclerViewExceptions(<span class="hljs-string"><span class="hljs-string">"Null adapter. Please initialise adapter!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.autoLoadingRecyclerViewAdapter = autoLoadingRecyclerViewAdapter; <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.setAdapter(autoLoadingRecyclerViewAdapter); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AutoLoadingRecyclerViewAdapter&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (autoLoadingRecyclerViewAdapter == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoLoadingRecyclerViewExceptions(<span class="hljs-string"><span class="hljs-string">"Null adapter. Please initialise adapter!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> autoLoadingRecyclerViewAdapter; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLoadingObservable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ILoading&lt;T&gt; iLoading)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iLoading = iLoading; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ILoading&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLoadingObservable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iLoading == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoLoadingRecyclerViewExceptions(<span class="hljs-string"><span class="hljs-string">"Null LoadingObservable. Please initialise LoadingObservable!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> iLoading; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subscribeToLoadingChannel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Subscriber&lt;OffsetAndLimit&gt; toLoadingChannelSubscriber = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Subscriber&lt;OffsetAndLimit&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ Log.e(TAG, <span class="hljs-string"><span class="hljs-string">"subscribeToLoadingChannel error"</span></span>, e); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OffsetAndLimit offsetAndLimit)</span></span></span><span class="hljs-function"> </span></span>{ unsubscribe(); loadNewItems(offsetAndLimit); } }; subscribeToLoadingChannelSubscription = scrollLoadingChannel .subscribeOn(Schedulers.from(BackgroundExecutor.getSafeBackgroundExecutor())) .observeOn(AndroidSchedulers.mainThread()) .subscribe(toLoadingChannelSubscriber); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadNewItems</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OffsetAndLimit offsetAndLimit)</span></span></span><span class="hljs-function"> </span></span>{ Subscriber&lt;List&lt;T&gt;&gt; loadNewItemsSubscriber = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Subscriber&lt;List&lt;T&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ Log.e(TAG, <span class="hljs-string"><span class="hljs-string">"loadNewItems error"</span></span>, e); subscribeToLoadingChannel(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;T&gt; ts)</span></span></span><span class="hljs-function"> </span></span>{ getAdapter().addNewItems(ts); getAdapter().notifyItemInserted(getAdapter().getItemCount() - ts.size()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ts.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { subscribeToLoadingChannel(); } } }; loadNewItemsSubscription = getLoadingObservable().getLoadingObservable(offsetAndLimit) .subscribeOn(Schedulers.from(BackgroundExecutor.getSafeBackgroundExecutor())) .observeOn(AndroidSchedulers.mainThread()) .subscribe(loadNewItemsSubscriber); } <span class="hljs-comment"><span class="hljs-comment">/** * required method * call in OnDestroy(or in OnDestroyView) method of Activity or Fragment */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ scrollLoadingChannel.onCompleted(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (subscribeToLoadingChannelSubscription != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !subscribeToLoadingChannelSubscription.isUnsubscribed()) { subscribeToLoadingChannelSubscription.unsubscribe(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadNewItemsSubscription != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !loadNewItemsSubscription.isUnsubscribed()) { loadNewItemsSubscription.unsubscribe(); } } }</code> </pre><br></div></div><br>  According to <code>AutoLoadingRecyclerView</code> it should also be noted that we should not forget about the life cycle and possible memory leaks from RxJava.  Therefore, when we ‚Äúkill‚Äù our list, we must remember to unsubscribe from all <code>Subscribers</code> . <br>  And now let's take a look at the specific practical application of our list: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * A placeholder fragment containing a simple view. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivityFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fragment</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AutoLoadingRecyclerView&lt;Item&gt; recyclerView; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ View rootView = inflater.inflate(R.layout.fragment_main, container, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); init(rootView); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rootView; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume(); <span class="hljs-comment"><span class="hljs-comment">//          //         recyclerView.startLoading(); } private void init(View view) { recyclerView = (AutoLoadingRecyclerView) view.findViewById(R.id.RecyclerView); GridLayoutManager recyclerViewLayoutManager = new GridLayoutManager(getActivity(), 1); recyclerViewLayoutManager.supportsPredictiveItemAnimations(); LoadingRecyclerViewAdapter recyclerViewAdapter = new LoadingRecyclerViewAdapter(); recyclerViewAdapter.setHasStableIds(true); recyclerView.setLayoutManager(recyclerViewLayoutManager); recyclerView.setLimit(LIMIT); recyclerView.setAdapter(recyclerViewAdapter); recyclerView.setLoadingObservable(offsetAndLimit -&gt; EmulateResponseManager.getInstance().getEmulateResponse(offsetAndLimit.getOffset(), offsetAndLimit.getLimit())); } @Override public void onDestroyView() { recyclerView.onDestroy(); super.onDestroyView(); } }</span></span></code> </pre><br>  The difference between the <code>AutoLoadingRecyclerView</code> and the standard <code>RecyclerView</code> only in the addition of the <code>setLimit, setLoadingObservable, onDestroy  startLoading</code> .  And in the box we have a self-loading list.  In my opinion, it is very convenient, capacious and beautiful. <br><br>  You can look at the source code with a practical example on <a href="https://github.com/matzuk/AutoLoadingRecyclerViewSample">GitHub</a> .  So far, the <code>AutoLoadingRecyclerView</code> is a more practical implementation of the idea, rather than a class, which is easily customized to any developer needs.  Therefore, I will be very happy for your comments, suggestions, my <code>AutoLoadingRecyclerView</code> vision and comments. <br><br>  I would like to express special thanks to <a href="http://habrahabr.ru/users/lNevermore/">lNevermore</a> for preparing this material. </div><p>Source: <a href="https://habr.com/ru/post/268991/">https://habr.com/ru/post/268991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268979/index.html">Visualization of static and dynamic networks on R, part 7, the last</a></li>
<li><a href="../268981/index.html">Adobe has released an emergency update for Flash Player.</a></li>
<li><a href="../268983/index.html">How to calculate everything in the world by a single SQL query. PostgreSQL window functions</a></li>
<li><a href="../268987/index.html">Accelerate Android code</a></li>
<li><a href="../268989/index.html">Objects of zero size</a></li>
<li><a href="../268993/index.html">Remote execution of system commands on request via sockets in Python 3 or how I downloaded the sites</a></li>
<li><a href="../268995/index.html">FlexPod DataCenter: Direct-Attached Storage</a></li>
<li><a href="../268997/index.html">Frida-node or a little bit strange code</a></li>
<li><a href="../268999/index.html">How did Cisco Security Ninja teach 20,000 employees to secure programming?</a></li>
<li><a href="../269001/index.html">The digest of interesting materials for the mobile # 125 developer (October 12-18)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>