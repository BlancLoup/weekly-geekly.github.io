<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SDK: creating an application in 3 steps</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 Last week we announced the opening of the SDK and it was the turn to describe the process of creating an application. 

 Applications for...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SDK: creating an application in 3 steps</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="http://www.finobox.ru/skins/extimages/sdk/finoboxSDK.png"></div><br><br>  Good day. <br><br>  Last week we announced the <a href="http://habrahabr.ru/company/finobox/blog/95135/">opening of the SDK</a> and it was the turn to describe the process of creating an application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Applications for Finobox can be very diverse, such as the preparation of contracts and documents, estimates and reports, financial data analysis and graphing, and so on. <br><br>  Any php developer using the SDK can create his own application and place it in Finobox, making a profit from the sales of this application to users. <br><br>  In this post we describe the creation of an application for importing financial data from a CSV file. <br><br><a name="habracut"></a><br><h4>  1. Preparations </h4><br>  From <a href="http://dev.finobox.ru/">the developer center we</a> download the latest version of the SDK and unpack it on our web server.  Everything should work out of the box, no ways and configurations should be configured. <br><br>  All applications are located in the Store folder.  So far here we will find applications for an example and preparation - <b>MyNewApplication</b> .  Based on the workpiece and we will create the application in this article. <br><br>  The folder name must match the file name and class name of the application.  Let's call the application <b>CSVImport</b> .  Rename the file, folder and class described in the file. <br><br>  The file structure will be as follows: <br><div style="text-align:center;"><img src="http://www.finobox.ru/skins/extimages/sdk/sdk_renaming.png"></div><br><br>  Edit the description.xml file: <br><blockquote><code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">application</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font>   CSV <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">descr</font> <font color="#0000ff">&gt;</font>    CSV  <font color="#0000ff">&lt;/</font> <font color="#800000">descr</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">application</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br><br>  Let's see what happened: <br><div style="text-align:center;"><img src="http://www.finobox.ru/skins/extimages/sdk/sdk_start.png"></div><br><br>  <a href="http://wiki.finobox.ru/index.php/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D1%258B_%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9">SDK Help: Application Principles</a> <br><br><h4>  2. Create an interface </h4><br>  So, our application should receive a file from the user and overtake all the detected records in payments of the current panel.  For this task, a single window is enough in the interface, where there will be file input and a launch button. <br><br>  But we will go the other way and make the application ‚Äútwo-way‚Äù - in the second step we will show the user how the application understands the downloaded data before starting to grind them into payments. <br><br>  So, in the application class CSVImport there will be three methods: main and step2 for building two windows and import for performing actions on importing data. <br><br><blockquote> <code><font color="black">&lt;?php <br> <font color="#0000ff">class</font> CSVImport extends Application{ <br> function main(){ <br> <font color="#008000">//  HTML   </font> <br> $ <font color="#0000ff">this</font> -&gt;setResultType(self::$RESULT_HTML); <br> } <br> function step2(){ <br> <font color="#008000">//  HTML   </font> <br> $ <font color="#0000ff">this</font> -&gt;setResultType(self::$RESULT_HTML); <br> } <br> function import(){ <br> <font color="#008000">//       </font> <br> $ <font color="#0000ff">this</font> -&gt;setResultType(self::$RESULT_CLOSE_N_RELOAD); <br> } <br> } <br> ?&gt;</font></code> </blockquote> <br><br><h5>  2.1 File Download Window </h5><br>  To build the form interface, use the form designer. <br>  <a href="http://wiki.finobox.ru/index.php/%25D0%259A%25D0%25BE%25D0%25BD%25D1%2581%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580_%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC">SDK Help: Form Designer</a> <br><blockquote> <code><font color="black">function main(){ <br> $form = $ <font color="#0000ff">this</font> -&gt;startUIForm(); <br> <font color="#008000">//       </font> <br> $form-&gt;add( <br> FormElement::factory( <font color="#A31515">'FileInput'</font> , <font color="#A31515">'csvfile'</font> ) <br> -&gt;setLabel( <font color="#A31515">' CSV '</font> ) <br> ); <br> $form-&gt;add( <br> FormElement::factory( <font color="#A31515">'StaticInput'</font> ) <br> -&gt;addAttribute( <font color="#A31515">'class="notice"'</font> ) <br> -&gt;setValue( <font color="#A31515">'   " "       '</font> ) <br> ); <br> <font color="#008000">//  step2   ,       </font> <br> $ <font color="#0000ff">this</font> -&gt;setResultType(self::$RESULT_HTML); <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> -&gt;finalizeUIForm($form, <font color="#A31515">'step2'</font> , <font color="#A31515">' '</font> )-&gt;getHtml(); <br> }</font></code> </blockquote> <br>  View of the application in the first step: <br><div style="text-align:center;"><img src="http://www.finobox.ru/skins/extimages/sdk/sdk_step_1.png"></div><br><h5>  2.2 Format confirmation window </h5><br>  File uploaded (or not loaded :)).  Check it and display the first 10 entries in the table.  To build the code of this window we will use the template mechanism.  The template is put in the application folder under the name csvtable.php.  Also, give ‚Äútransit‚Äù the path to the downloaded file. <br><br>  <a href="http://wiki.finobox.ru/index.php/%25D0%25A8%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD%25D1%258B">SDK Help: Templates</a> <br><blockquote> <code><font color="black">function step2(){ <br> $file = $_FILES[ <font color="#A31515">'csvfile'</font> ]; <br> <font color="#008000">/**</font> <br> <font color="#008000">*  </font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">if</font> ($file[ <font color="#A31515">'error'</font> ] != 0) <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">'   '</font> ); <br> <font color="#0000ff">if</font> ( ($file[ <font color="#A31515">'type'</font> ] != <font color="#A31515">'text/plain'</font> ) &amp;&amp; ($file[ <font color="#A31515">'type'</font> ] != <font color="#A31515">'text/csv'</font> )) <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">'  '</font> ); <br> <font color="#008000">/**</font> <br> <font color="#008000">*   10 </font> <br> <font color="#008000">*/</font> <br> $limit = 10;$strings = array(); <br> $fhandle = @fopen($file[ <font color="#A31515">'tmp_name'</font> ], <font color="#A31515">'r'</font> ); <br> <font color="#0000ff">if</font> ($fhandle === <font color="#0000ff">false</font> ) <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">'   '</font> ); <br> <font color="#0000ff">while</font> (!feof($fhandle)){ <br> $strings[] = fgets($fhandle); <br> <font color="#0000ff">if</font> (--$limit &lt; 0) <font color="#0000ff">break</font> ; <br> } <br> fclose($fhandle); <br> $ <font color="#0000ff">this</font> -&gt;setResultType(self::$RESULT_HTML); <br> <font color="#008000">//      </font> <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> -&gt;renderTemplate( <font color="#A31515">'csvtable.php'</font> , array( <font color="#A31515">'csv'</font> =&gt; $strings, <font color="#A31515">'filename'</font> =&gt; $file[ <font color="#A31515">'tmp_name'</font> ])); <br> }</font></code> </blockquote> <br>  View of the application in the second step: <br><div style="text-align:center;"><img src="http://www.finobox.ru/skins/extimages/sdk/sdk_step_2.png"></div><br><h5>  2.3 Data Import </h5><br>  After confirming the format, it remains only to go through the file and create new payments.  For the experiments, take the export CSV-file of the Chatter service.  The format is: <br><br>  1 field (zero index) - category of payment.  In the concept of a finbox, this is a label. <br>  3 - date of payment <br>  4 - payment name, comment <br>  7 - amount <br><br>  SDK Help: <a href="http://wiki.finobox.ru/index.php/SDK:_%25D0%2597%25D0%25B0%25D0%25B3%25D1%2580%25D1%2583%25D0%25B7%25D0%25BA%25D0%25B0_%25D1%2584%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2">Downloading Files</a> and <a href="http://wiki.finobox.ru/index.php/SDK:_%25D0%2594%25D0%25BE%25D0%25B1%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BF%25D0%25BB%25D0%25B0%25D1%2582%25D0%25B5%25D0%25B6%25D0%25B5%25D0%25B9">Making Payments</a> <br><blockquote> <code><font color="black">function import(){ <br> $fhandle = @fopen($_POST[ <font color="#A31515">'csvfile'</font> ], <font color="#A31515">'r'</font> ); <br> <font color="#0000ff">if</font> ($fhandle === <font color="#0000ff">false</font> ) <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">'   '</font> ); <br> <font color="#0000ff">while</font> (!feof($fhandle)){ <br> $row = iconv( <font color="#A31515">'CP1251'</font> , <font color="#A31515">'UTF-8'</font> , fgets($fhandle)); <br> $row = str_replace( <font color="#A31515">'"'</font> , <font color="#A31515">''</font> , $row); <br> $entry = explode( <font color="#A31515">';'</font> , $row); <br> <font color="#0000ff">if</font> (count($entry) &gt; 1){ <br> $payment = <font color="#0000ff">new</font> Entry(); <br> $payment-&gt;name  = $entry[3]; <br> <font color="#008000">//   ,   ,     </font> <br> $payment-&gt;currency_id = $ <font color="#0000ff">this</font> -&gt;userPreferences-&gt;defaultCurrency; <br> $payment-&gt; <font color="#0000ff">value</font> = $entry[6]; <br> $payment-&gt;paiddate = $entry[2]; <br> $payment-&gt;tags = $entry[0]; <br> <font color="#008000">//  </font> <br> $ <font color="#0000ff">this</font> -&gt;entriesData-&gt;insert($payment); <br> } <br> } <br> fclose($fhandle); <br> <font color="#008000">//   </font> <br> unlink($_POST[ <font color="#A31515">'csvfile'</font> ]); <br> <font color="#008000">//       </font> <br> $ <font color="#0000ff">this</font> -&gt;setResultType(self::$RESULT_CLOSE_N_RELOAD); <br> <font color="#0000ff">return</font> ; <br> }</font></code> </blockquote> <br><br>  Note: in the SDK mode, the functions of updating and adding payments do not change the data file, that is, after the data has been imported in the test database, they will no longer be.  In the work service, everything works in a working way. <br><br><h4>  3. Sending the app to the store </h4><br><br>  The application is ready, it remains only to tie a ribbon, provide an icon, set a price and send it to <a href="http://dev.finobox.ru/">the developer‚Äôs center</a> for review. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c8/d7f/773/3c8d7f77356a37005b4033bd89e779e5.png" align="left"><br>  Finished application for importing such files into <a href="http://www.finobox.ru/">Finobox.ru</a> can be connected <a href="http://www.finobox.ru/applications.html">here.</a> <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="gray">*       <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> </div><p>Source: <a href="https://habr.com/ru/post/95924/">https://habr.com/ru/post/95924/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../95912/index.html">From the camp of Internet addicts made a massive escape</a></li>
<li><a href="../95916/index.html">Peculiarities of national information security</a></li>
<li><a href="../95920/index.html">Declarative security with annotations and AspectJ in Java SE</a></li>
<li><a href="../95921/index.html">Learning to make money without copyright - how to make money on a simple idea?</a></li>
<li><a href="../95923/index.html">Preview Google Maps in Gmail</a></li>
<li><a href="../95925/index.html">Create a simple usb device to communicate with your program</a></li>
<li><a href="../95926/index.html">Mini fraud to the maximum</a></li>
<li><a href="../95928/index.html">Mortal Kombat: Rebirth</a></li>
<li><a href="../95929/index.html">Who do you work for?</a></li>
<li><a href="../95930/index.html">About implicit ads, backwards compatibility and ABI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>