<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automate penetration testing with apt2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On September 20, another release of the popular distribution kit for testing penetration Kali Linux 2017.2 was held. Among the innovations we got the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automate penetration testing with apt2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/85b/9ff/61d/85b9ff61df254acaabd16ca7378702a0.png"><br><br>  On September 20, another <a href="https://www.kali.org/news/kali-linux-2017-2-release/">release of the</a> popular distribution kit for testing penetration Kali Linux 2017.2 was held.  Among the innovations we got the opportunity to install several new tools from the repository.  In this text, we will look at the apt2 or Automated Penetration Testing Toolkit framework. <br><a name="habracut"></a><br><h2>  Installation and Setup </h2><br>  After updating the distribution to version 2017.2, you can install the framework. <br>  Let me remind you that you can upgrade to the latest version of Kali Linux using the following commands <br><br><pre><code class="bash hljs">apt-get update apt-get upgrade apt-get dist-upgrade</code> </pre> <br>  Installation takes place as standard 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">apt-get install apt2</code> </pre> <br>  Next, I recommend a basic setting. <br><br>  Having studied the <a href="https://github.com/MooseDojo/apt2">official github of the project,</a> it becomes clear that it integrates with the Metasploit Framework. <br><br>  To integrate with Metasploit, you need to run its RPC service. <br>  This is done as follows. <br><br><pre> <code class="bash hljs">msfconsole load msgrpc</code> </pre> <br>  You should get a randomly generated password.  Remember it. <br><br><img src="https://habrastorage.org/web/7d7/0e2/339/7d70e23396da4e26a669ea31cc05e3b4.PNG"><br><br>  You can look at the structure of the configuration file in the / usr / share / apt2 directory <br><br><img src="https://habrastorage.org/web/830/a5a/f89/830a5af89f6447e2a7b354b7464d32e9.PNG"><br><br>  We are interested in the file default.cfg <br><br>  In the block [metasploit] we specify our password <br><br><pre> <code class="bash hljs">[metasploit] msfhost=127.0.0.1 msfport=55552 msfuser=msf msfpass=kqVbTlmr msfexploitdelay=20</code> </pre> <br>  Then you can add additional keys for nmap or change the subnet.  The default is a SYN scan (-sS) and a flag (-A), which tells Nmap to determine the versions of the services, the type and version of the OS, to run secure NSE scripts and traceroute.  In some cases it will be useful to add the -Pn key if you do not import the nmap scan result into apt2. <br><br><pre> <code class="bash hljs">[nmap] scan_target=192.168.1.0/24 scan_type=S scan_port_range=1-1024 scan_flags=-A</code> </pre> <br>  The default is 20 threads.  This value can not be changed unnecessarily. <br><br><pre> <code class="bash hljs">[threading] max_modulethreads=20</code> </pre> <br>  There is a setting for Reponder.  If you use a non-standard configuration, you need to edit the [responder] and [default_tool_paths] blocks.  I‚Äôll set responder_timeout = 30, because I don‚Äôt want to waste time on this module. <br><br>  Next is the block [searching] <br><br><pre> <code class="bash hljs">[searching] file_search_patterns=*.bat,*.sh,*passwd*,*password*,*Pass*,*.conf,*.cnf,*.cfg,*.config</code> </pre> <br>  Here you can set masks of files that interest us if we get access, for example, to an NFS resource.  You can add something your own or not to change. <br><br>  The framework also allows you to use the Shodan API.  Keys are set in a separate block and commented out by default.  I will not use them, since my target machine is on the local network.  Let me remind you that the process of obtaining API keys for each service is individual and not always free.  The API key for Shodan can be obtained free of charge after registering on the <a href="https://www.shodan.io/">site</a> . <br><br><pre> <code class="bash hljs">[apikeys] <span class="hljs-comment"><span class="hljs-comment">#apt2_shodan_apikey=CHANGEME #apt2_linkedin_apikey=CHANGEME</span></span></code> </pre> <br><h2>  Launch </h2><br>  When running with the -h key, we get a list of available keys. <br><br><img src="https://habrastorage.org/web/87c/cc5/cb6/87ccc5cb6e16478092223006e2caa295.PNG"><br><br>  Let's look at some of them. <br><br>  <b>SAFE_LEVEL</b> can take values ‚Äã‚Äãfrom 1 to 5 and tells apt2 how safe modules are allowed to run.  The safest mode is 5. The default is 4. <br><br>  <b>EXCLUDE_TYPES</b> allows <b>you</b> to exclude certain types of modules from the list. <br><br>  <b>--target</b> sets targets, or you can use the <b>-f switch</b> to load the nmap scan file into apt2 XML file.  Let me remind you that you can save the result of nmap in XML using the -oX switch. <br><br>  and the key <b>--listmodules</b> will show the available modules.  Let's look at this list. <br><br><pre> <code class="bash hljs">apt2 --listmodules</code> </pre> <br>  We get a list with the indication of the module name, its type (used for EXCLUDE_TYPES), Safety Level and description.  Modules with a Safety Level lower than indicated by the -s switch will not be executed, which will be further discussed in the apt2 output at startup. <br><br><img src="https://habrastorage.org/web/8be/114/d82/8be114d823a94d34a4fe89fad91cf2a2.PNG"><br><br>  Let's run apt2 with the highest level of risk against the machine 192.168.1.4 on which Ubuntu runs. <br><br><pre> <code class="bash hljs">apt2 -v -v -s 1 -b --target 192.168.1.4</code> </pre> <br>  We are warned that modules requiring API keys will not be executed and scanning will begin. <br><br><img src="https://habrastorage.org/web/771/2d4/34f/7712d434fcfd455fb4a712090adf792a.PNG"><br><br>  Next, the modules will start running. <br><br><img src="https://habrastorage.org/web/6a7/652/096/6a765209693c44c6bdb849f32a716fc7.PNG"><br><br>  You can see what apt2 was able to assemble in the /root/.apt2/proofs directory <br><br><img src="https://habrastorage.org/web/b66/1ce/d2c/b661ced2c7d44f2ebf98cc552d8ec213.PNG"><br><br>  Here you can view the result of each module.  In my case, the framework did not find anything worthwhile. <br><br>  We will launch another scan for Windows 192.168.1.7 and will not perform nmap scanning via apt2, but load the XML file. <br><br><pre> <code class="bash hljs">nmap -n -Pn -A -oX scan1 192.168.1.7 apt2 -s 1 -b -v -v -f scan1</code> </pre> <br>  Here other modules are already being launched, for example, a module for testing for vulnerability to <a href="https://technet.microsoft.com/ru-ru/library/security/ms08-067.aspx%3Ff%3D255%26MSPPError%3D-2147217396">ms08-067</a> . <br><br><img src="https://habrastorage.org/web/bc6/135/cc0/bc6135cc0964443bbf270222bf525d64.PNG"><br><br>  If the server is vulnerable, it will be reported in the log <br><br><pre> <code class="bash hljs">[!] VULN [ms08-067] Found on [192.168.1.7]</code> </pre> <br>  and the vulnerability will be exploited through the Metasploit RPC service automatically and we will get a session <br><br><img src="https://habrastorage.org/web/d98/bb1/9db/d98bb19db0af4fd5b5337fc949a90d9e.PNG"><br><br>  Further, through the session, other modules will already be implemented. <br><br><img src="https://habrastorage.org/web/2bf/757/79b/2bf75779bff64476a58caa0463f97e14.PNG"><br><br>  And at the end of the program, a progress report will be created. <br><br><img src="https://habrastorage.org/web/a32/622/4d9/a326224d90624deab702a5a4f1ec7501.PNG"><br><br><pre> <code class="bash hljs">firefox /root/.apt2/reports/reportGenHTML_flcgfsqhji.html</code> </pre> <br><img src="https://habrastorage.org/web/798/ff3/d48/798ff3d48905447eb6b535e153391d2b.PNG"><br><br>  If you want to write your own modules for apt2, you can examine the existing in the / usr / share / apt2 / modules directory and make your own by analogy.  The framework itself is written in python and its modules, respectively, too. </div><p>Source: <a href="https://habr.com/ru/post/338460/">https://habr.com/ru/post/338460/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338442/index.html">Stages of development of the Java Online Projects learning project: how it was, an inside look</a></li>
<li><a href="../338444/index.html">VEDO. External electronic document management what it is and how to choose</a></li>
<li><a href="../338450/index.html">How to run your project on Product Hunt: Administration Guide</a></li>
<li><a href="../338452/index.html">Broadcast from the gamedev conference 4C in St. Petersburg. The first day</a></li>
<li><a href="../338454/index.html">The book "ASP.NET Core. Application Development"</a></li>
<li><a href="../338462/index.html">JavaScript scope and closures</a></li>
<li><a href="../338468/index.html">Do you need financial data?</a></li>
<li><a href="../338470/index.html">Recommendations on Avito</a></li>
<li><a href="../338472/index.html">How we transferred 400 stores to electronic cash registers</a></li>
<li><a href="../338478/index.html">"Invisible design": we design together with cars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>