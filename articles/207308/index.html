<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Instruction as a sequence of methods</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 
 I am writing for the first time, I am a little nervous, so for the fourth time I am typing the first sentence. 
 I am developing games. Mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Instruction as a sequence of methods</h1><div class="post__text post__text-html js-mediator-article"><h4>  Hi, Habr! </h4><br>  I am writing for the first time, I am a little nervous, so for the fourth time I am typing the first sentence. <br>  I am developing games.  Mostly on flush.  More than a year worked with HaXe NME - cool.  But a lot of their own "frills", which, when compared with AS3 when targeting a flash, can be placed in a separate article. <br>  For more than two years of experience, I identified one urgent problem for me when creating flash games. <br>  This is the initial initialization.  The problem is that while the user looks at the progress bar of the preloader, a lot of operations are performed in the background - from loading data and assets to preparing them.  And, often, the number of these operations rolls over even at the very beginning of development, not to mention updates. <br><a name="habracut"></a><br>  I watched a lot of other sources of games and saw terrible conglomerations of constructions of the form: <br><pre><code class="actionscript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * calling server (pseudo-code) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ ServerConnection.instance.call(<span class="hljs-string"><span class="hljs-string">'method'</span></span>, params, onCallMethodComplete); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCallMethodComplete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ ServerConnection.instance.call(<span class="hljs-string"><span class="hljs-string">'methodTwo'</span></span>, params, onCallMethodTwoComplete); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCallMethodTwoComplete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ AssetsLoader.loadAssetZipByName(<span class="hljs-string"><span class="hljs-string">'assetName'</span></span>, onAssetLoaded); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAssetLoaded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// etc }</span></span></code> </pre> <br>  At the same time, they do not always use some auxiliary singleton-classes in the methods, and often a lot of loader-s appear in the methods of the loading class for each operation with all the attendant listeners.  Hash is not read absolutely.  He also did it once. <br>  The taste and color, as they say, but when the number of methods for initialization grows to at least ten, it becomes difficult to read such code.  And if you later suddenly need to insert an additional intermediate function, say, for additional processing of the data, it turns into a headache and a lot of time spent trying to figure out what is going on. <br>  This problem is relevant not only for downloading data.  And also, for example, sequential animation of interface elements.  Someone will argue that you can animate even in the Flash IDE - no doubt.  However, often when animating the appearance of a window, it is necessary not only to show the elements in order, but also to activate / deactivate them, so that no accidental closure of the window occurs by a user click until the animations are completed. <br>  The task seems to be clear and quite trivial.  I see the goal.  Going to the goal. <br>  The utility I wrote is quite small and quite simple for myself.  However, she really helped me to move from the structures above to a very concise: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ Instruction.create() .add(configureViewTree) .add(initializeManagers) .add(SocialData.instance.init, flashVars) .add(GameData.instance.init, <span class="hljs-string"><span class="hljs-string">'http://server.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://static.server.ru/assets/'</span></span>) .add(Assets.getZip, <span class="hljs-string"><span class="hljs-string">'music/music.zip'</span></span>) .add(MetaData.instance.init) .add(World.instance.create, worldContainer) .execute(startGame); }</code> </pre><br>  All methods will be called in the same sequence in which they are added. <br>  The sequence of actions, plus a relatively easy readability queue.  It would seem that more needed? <br><br><div class="spoiler">  <b class="spoiler_title">Full code of class Instruction</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * ... * @author Frost */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Instruction</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Instruction </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Instruction(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> functionsQueue:Vector.&lt;Function&gt;; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> argumentsQueue:Vector.&lt;Array&gt;; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Instruction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ functionsQueue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Function&gt;(); argumentsQueue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Array&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(calledFunction:Function, </span></span><span class="hljs-rest_arg"><span class="hljs-function"><span class="hljs-params"><span class="hljs-rest_arg">...params</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:Instruction </span></span>{ functionsQueue.push(calledFunction); argumentsQueue.push(params); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completeHandler:Function = null, </span></span><span class="hljs-rest_arg"><span class="hljs-function"><span class="hljs-params"><span class="hljs-rest_arg">...params</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:void </span></span>{ add(completeHandler, params).checkQueue(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calledFunctionArguments:Array = argumentsQueue.shift(); calledFunctionArguments.unshift(checkQueue); functionsQueue.shift().apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, calledFunctionArguments); calledFunctionArguments = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkQueue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (functionsQueue.length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { doTask(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } completeInstruction(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">completeInstruction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (functionsQueue[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { functionsQueue.shift().apply(argumentsQueue.shift()); } functionsQueue = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; argumentsQueue = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre><br></div></div><br>  There are several drawbacks to this structure.  First, the functions that we want to push into the queue must correspond to a certain structure, namely, the first parameter is the callback for completing the method, the remaining parameters are the arguments.  A positive point is that you can stuff a callback as it loads data into the Event.COMPLETE handler, or just call it last, after performing various operations: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="actionscript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">weWantToAddToInstruction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completeHandler:Function, paramOne:Object, paramTwo:String, paramThree:Function, </span></span><span class="hljs-rest_arg"><span class="hljs-function"><span class="hljs-params"><span class="hljs-rest_arg">...params</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// do some crazy stuff completeHandler(); }</span></span></code> </pre><br>  Also, the negative point is that the error handling in the instruction being executed lies on the shoulders of the methods being executed.  I have not yet come up with a solution that will make it possible to catch errors at the responsibility of the instruction itself.  In the variants that I tried, I had to change the structure of functions =&gt; not conveniently.  And in many situations, everything came to a standstill.  That would be great. <br><br>  Another side effect was that, having started using the instruction, I often started to produce anonymous functions inside the called methods, so that before calling the completeHandler some other function or setting a flag worked, which is not correct.  But this is rather the result of my laziness.  Since  in such cases, inside the method that is called inside the instruction, you can create another instruction and arrange the code, bypassing the anonymous letter. <br><br>  The positive aspect was that methods can be stuffed into the instruction, the arguments for which are absolutely arbitrary, both in content and in quantity.  This is quite convenient.  But only if it is firmly convinced that the arguments are precisely those that are conceived.  Although, this rule applies to everything, I guess. <br><br>  In general, that's all.  Thank you for your attention, habrazhiteli. <br>  Very cool, if what I wrote, will be useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/207308/">https://habr.com/ru/post/207308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207294/index.html">C ++ idioms. Type erasure</a></li>
<li><a href="../207296/index.html">Our sales leader 2013 - controller KUB-Micro / 60</a></li>
<li><a href="../207298/index.html">STARTTOSPEAK.COM - we start talking about the project!</a></li>
<li><a href="../207304/index.html">Registration on the site: from the beginning to the afternoon</a></li>
<li><a href="../207306/index.html">Overview of data encryption in the clouds for Windows</a></li>
<li><a href="../207310/index.html">A passion for programming. Chapter 19. Right Now</a></li>
<li><a href="../207312/index.html">How we made new year cards with lifehacks</a></li>
<li><a href="../207314/index.html">Raspberry Pi: Encode H.264 live video</a></li>
<li><a href="../207316/index.html">Agile Board. How do we plan in Yandex. Pictures and how did we come to this?</a></li>
<li><a href="../207318/index.html">Significant events for IT business</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>