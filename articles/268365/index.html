<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building Unity3D builds on Jenkins on Mac OS X. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first part can be found here . 

 Update 
 You need to update both the collector itself and its plugins. The settings page is located at 127.0.0.1...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building Unity3D builds on Jenkins on Mac OS X. Part 2</h1><div class="post__text post__text-html js-mediator-article">  The first part can be found <a href="http://habrahabr.ru/post/268233/">here</a> . <br><br><h1>  Update </h1><br>  You need to update both the collector itself and its plugins.  The settings page is located at <a href="http://127.0.0.1:4242/manage">127.0.0.1:4242/manage</a> (adjusted for its settings).  In the case of a new version of the page will hang a button with a proposal to update.  I recommend to still download the latest version by yourself, then gently turn off the collector, replace the <b>jenkins.war</b> file and restart it. <br>  When updating <b>jenkins.war</b> , an error may occur, so the old file is backed up just in case.  Why?  First, the files appear on the Japanese server (the author of the assembler is an ordinary Japanese engineer, read more <a href="https://en.wikipedia.org/wiki/Jenkins_(software)">here</a> ), then they are distributed through the mirrors.  References: <br><br><ul><li>  Link to the latest version: <a href="">http://mirrors.jenkins-ci.org/war/latest/jenkins.war</a> </li><li>  Full archive: <a href="http://mirrors.jenkins-ci.org/war/">http://mirrors.jenkins-ci.org/war/</a> </li><li>  Mirror <b>Yandex</b> : <a href="http://mirror.yandex.ru/mirrors/jenkins/">http://mirror.yandex.ru/mirrors/jenkins/</a> </li><li>  Japanese storage, here is the freshest (although you can suffer): <a href="http://ftp.tsukuba.wide.ad.jp/software/jenkins/">http://ftp.tsukuba.wide.ad.jp/software/jenkins/</a> </li></ul><br>  You can configure plug-ins on <a href="http://127.0.0.1:4242/pluginManager/">127.0.0.1:4242/pluginManager/</a> .  More information about plugins will be in the appropriate section, but I recommend updating the existing ones. <br><a name="habracut"></a><br><h1>  Primary setup of the collector </h1><br>  Projects under <b>Unity are</b> not going in parallel. <div class="spoiler">  <b class="spoiler_title">BUT</b> <div class="spoiler_text">  <a href="https://habrahabr.ru/users/youngskipper/" class="user_link">YoungSkipper</a> wrote what you can.  After reading the documentation there was a desire to try - I will describe the changes in the next article, then edit the paragraph. <br></div></div>  That is, only one build on one computer can be run at a time.  By default, <b>Jenkins</b> creates one collector with several implementers, which is not good.  Go to the graphical interface or directly to <a href="http://127.0.0.1:4242/computer/(master)/configure">127.0.0.1:4242/computer/(master)/configure</a> in the settings and change the " <b>Number of executing processes</b> " to 1. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If desired, it is possible to raise assemblies on other machines (for example, leave the apple assemblies here, and transfer them to the <b>Windows</b> computer for other platforms).  We will not consider this opportunity here. <br><br>  Here - <a href="http://127.0.0.1:4242/configure">127.0.0.1:4242/configure</a> - general settings section.  Change the following parameters: <br><br><ol><li>  Check that the home directory is correct.  For example, <b>/ Users / jenkins / WORK / JENKINS_HOME</b> </li><li>  Expand advanced settings.  <b>Workspace Root Directory</b> is the place where <b>Unity</b> projects should be placed.  The " <b>root directory of the build entry</b> " is the repository of the builds.  I recommend changing the default values ‚Äã‚Äãby <b>removing</b> both folders from <b>JENKINS_HOME</b> .  For example, in <b>/ Users / jenkins / WORK / JENKINS_WORKSPACE / $ {ITEM_FULL_NAME}</b> and in <b>/ Users / jenkins / WORK / JENKINS_BUILDS / $ {ITEM_FULL_NAME}</b> . <br></li><li>  "The <b>number of collectors</b> " set, as before, in 1. </li><li>  " <b>Delay before assembly</b> " set, for example, in 60 seconds.  Useful to undo an incorrect or accidentally running build. </li><li>  To build for <b>Android, you</b> may need different <b>JDKs</b> .  In the corresponding section, write the names and paths (unchecking the automatic installation).  For example, <b>jdk_1.8.0_60</b> has <b>JAVA_HOME</b> in <b>/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home</b> .  This item is optional, only with a strong desire to use different <b>JDK</b> during assembly. </li><li>  In the <b>Jenkins Location</b> section, you can specify the address of the collector (in the local network, for example <a href="http://192.168.3.69:4242/">http://192.168.3.69:4242/</a> ) and the mail of the administrator.  Required for some plugins. <br></li><li>  In the <b>Subversion</b> section, if you have the latest plugin updates, you can select the latest version of <b>SVN</b> .  For example, <b>1.8</b> .  The version must match the one installed in the system (up to the first two characters), otherwise it will not be possible to manually edit the project that was automatically created by the builder.  See the link to install the required version in the <a href="http://habrahabr.ru/post/268233/">last article</a> . </li></ol><br><br><h1>  Jenkins CLI </h1><br>  We should also mention the list of remote commands of the collector.  All the necessary information here - <a href="http://127.0.0.1:4242/cli/">http://127.0.0.1:4242/cli/</a> .  Download <b>jenkins-cli.jar</b> and using, for example, the following command: <br><br><pre><code class="bash hljs">java -jar jenkins-cli.jar -s http://192.168.3.69:4242/ safe-shutdown</code> </pre> <br>  it is possible to chop off the assembler from the console from any computer in the local network (all running assemblies will automatically finish first).  If you wish, you can prepare the appropriate scripts, but with a hung collector, they may not work. <br><br><h1>  Plugins </h1><br>  Additional functionality of the collector is supplied by plug-ins.  You can configure (install, update, roll back, delete) them in the appropriate section - <a href="http://127.0.0.1:4242/pluginManager/installed">127.0.0.1:4242/pluginManager/installed</a> .  The complete list is near, the official wiki is <a href="https://wiki.jenkins-ci.org/display/JENKINS/Plugins">here</a> .  Vital below (the rest is better to just update, but it‚Äôs unlikely to work directly with them): <br><br><ul><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Credentials%2BPlugin">Credentials Plugin</a> - allows you to store passwords.  For example, for the <b>SVN</b> repository.  In the collector's settings - <a href="http://127.0.0.1:4242/credential-store/">127.0.0.1:4242/credential-store/,</a> select <b>Global credentials</b> and create a bunch of username and password for each repository.  Parameters - <b>Username and password</b> and <b>Global</b> . <br></li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Subversion%2BPlugin">Subversion Plugin</a> - <b>SVN</b> support.  Should already be configured. </li></ul><br><br>  Plugins that need to be downloaded to configure build options (some may install related plugins): <br><br><ul><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Conditional%2BBuildStep%2BPlugin">conditional-buildstep</a> - setting the actions of the builder if an error occurred during the build.  For example, you can send an email with a log to the administrator or execute a script. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Description%2BSetter%2BPlugin">description setter plugin</a> - create a description of the assembled build based on the build parameters. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Environment%2BScript%2BPlugin">Environment Script Plugin</a> - declaration of internal variables (parameters) of the assembly. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Extensible%2BChoice%2BParameter%2Bplugin">Extensible Choice Parameter plugin</a> - storing the build parameters in a separate file, for example in the same <b>SVN</b> , after the update from the repository the latest version of settings will be applied. </li><li>  <a href="http://wiki.jenkins-ci.org/display/JENKINS/Groovy%2BPostbuild%2BPlugin">Groovy Postbuild</a> - creating a simple script that handles the success of the assembly. <br></li></ul><br><br>  Plugins that change the appearance of the collector and simplify access: <br><br><ul><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Extra%2BColumns%2BPlugin">Extra Columns Plugin</a> - additional columns in the task list.  They contain buttons to stop, start a task, and so on. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/SafeRestart%2BPlugin">Safe Restart Plugin</a> - button to restart the collector directly in the graphical interface. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Custom%2BJob%2BIcon%2BPlugin">Custom Job Icon plugin</a> - assigns each task its own specific icon.  For example, you can put the icon of the desired application or platform under which the assembly is.  The <b>Custom icons</b> item will appear in the settings, where you can upload your icons.  They will be stored in <b>/ Users / jenkins / WORK / JENKINS_HOME / userContent /</b> .  When loading, the icon shrinks to 64x64, so we are looking for a prettier one. </li></ul><br><br>  <b>Unity</b> plugins: <br><br><ul><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Unity3dBuilder%2BPlugin">Unity3d plugin</a> - a plugin that integrates the call of the <b>Unity</b> editor into the assembly.  With a strong desire, you can do without it (write all the commands on the command line).  After installation, the <b>Unity3d</b> item will appear in the collector settings, in which you can enter a list of installed editors.  For example, create a <b>Unity_4_6_8_f1</b> field with the value <b>/Applications/Unity_4_6_8_f1/Unity.app</b> .  It will be used, for example, for test builds.  As the main version we use <b>Unity_4_6_6_f2</b> and a similarly configured path.  In order not to update the path to the current version in each task of the collector after the transition to the new one, we create <b>Unity_Default</b> with the necessary parameters. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Log%2BParser%2BPlugin">Log Parser Plugin</a> - analyzes the output to the log and displays notes and errors.  In the collector settings, look for the <b>Console Output Parsing</b> item at the end and create <b>unity_rules</b> with the path to the rule file.  Source can be found <a href="https://wiki.jenkins-ci.org/display/JENKINS/Unity3dBuilder%2BPlugin">here</a> or below. <br><div class="spoiler">  <b class="spoiler_title">logpareser.rules</b> <div class="spoiler_text">  start / ^ Initialize mono / <br>  start / ^ Mono dependencies included in the build / <br>  start / ^ Textures / <br>  info / ^ Complete size / <br>  start / ^ ----- CompilerOutput: -stdout / <br>  info / ^ Compilation succeeded / <br>  start / ^ Used Assets, sorted by uncompressed size / <br>  info / ^ \ * \ * / <br>  info / ^ Exiting batchmode successfully now / <br>  start / ^ === BUILD NATIVE TARGET / <br>  start / ^ Packaging IPA / <br>  start / ^ Archiving artifacts / <br>  start / Uploading to testflight / <br>  warning / error CS02446 / <br>  error / ^ Error building Player / <br>  error / ^ Failed to compile / <br>  error / ^ Error: / <br>  error / ^ error: / <br>  error /: error CS / <br>  warning / ^ Warning: / <br>  warning / ^ WARNING: / <br>  error / ^ xcodebuild: error: / <br>  warning / Debug: LogWarning / <br>  error / There was an error / <br>  error / \ * \ * \ * Canceled / <br>  error / ^ FATAL: / <br>  error / ^ Fatal error / <br>  error / ^ ERROR: / <br>  error / syntax error / <br>  error /^UnityEngine.Debug:LogError/ <br>  error /^System.Exception:/ <br></div></div><br></li></ul><br><br><h1>  Project structure </h1><br><ol><li>  Set up a repository. </li><li>  Customize file with parameters. </li><li>  Customize the build platform. </li><li>  Configure whether to launch <b>Unity</b> or not. </li><li>  Download data from the repository. </li><li>  If <b>Unity</b> is configured to run, build a fresh build. </li><li>  Save build results to archive. </li><li>  Run the script depending on the results of the assembly (for example, voice alarm). </li></ol><br><br><h1>  Creating a Task (Job Item) </h1><br><ol><li>  On the main page of the collector we find the <b>Create Item</b> button.  In the parameters, select the <b>task with a free configuration</b> .  For the name, select something like <b>projectName_platform</b> .  By changing the second part for different tasks, you can set up a simple filter by project later.  Go directly to the settings. <br><br></li><li>  Since it is planned to use the same resources for several tasks, the first thing we do is change the place of the project.  We are looking for " <b>Advanced project settings</b> ", select " <b>Use another directory</b> " and enter something like <b>../JENKINS_WORKSPACE/projectName_standalone</b> .  Then we return to the beginning of the settings. <br><br></li><li>  " <b>Delete obsolete assemblies</b> " - select the desired option.  For example, keep only the last few. <br><br></li><li>  If the plugin has been installed on the user icon and the icons are loaded, select the one you need. <br><br></li><li>  " <b>This is a parameterized build</b> " - configure this parameter.  This requires the <b>Extensible Choice</b> plugin installed earlier.  The template is as follows - a parameter of this type is added, its name is entered, it is selected where it will be read from.  The data can be stored in an external file (then select the <b>System Groovy Choice Parameter</b> and create a data reading script) or enter it in the <b>Extensible Choice: Available Choice Providers</b> section beforehand in the settings.  Here we use the first option.  Important!  In all parameters, you need to pre-select the default option.  But it will be available only after saving the script and re-opening the settings page. <br><br></li><li>  Setup repositories.  Create parameter <b>REPOSITORY</b> .  We enter all available in an external file, for example in <b>/Users/jenkins/WORK/repositories.txt</b> .  Then we drive in the script: <br><br><pre> <code class="java hljs">String _file=<span class="hljs-string"><span class="hljs-string">"/Users/jenkins/WORK/repositories.txt"</span></span>; ArrayList _list=[]; FileReader _reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileReader(_file); String _line = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( ( _line = _reader.readLine() ) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) { _list &lt;&lt; _line; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _list.sort();</code> </pre><br></li><li>  Choosing an assembly platform.  We create <b>PLATFORM</b> , the script differs only in the name of the external file.  Below is a list of platforms for version 4.6: <br><br><div class="spoiler">  <b class="spoiler_title">unity_platforms.txt</b> <div class="spoiler_text">  Webplayer <br>  WebPlayerStreamed <br>  StandaloneOSXIntel <br>  StandaloneOSXIntel64 <br>  StandaloneOSXUniversal <br>  StandaloneWindows <br>  iphone <br>  PS3 <br>  Xbox360 <br>  Android <br>  Standalonelinux <br>  StandaloneLinux64 <br>  StandaloneLinuxUniversal <br>  FlashPlayer <br>  StandaloneWindows64 <br>  WP8Player <br>  Tizen <br>  PSP2 <br>  PS4 <br>  PSM <br>  Xboxone <br>  SamsungTV <br></div></div><br></li><li>  The choice of the settings file is <b>PRESET</b> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hudson.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hudson.model.*; ArrayList _list=[]; _list &lt;&lt; <span class="hljs-string"><span class="hljs-string">""</span></span>; FilePath _wp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilePath(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilePath(jenkins.root),project.getCustomWorkspace()); hudson.FilePath _dir = _wp.child(<span class="hljs-string"><span class="hljs-string">"Assets/BuildPresets/"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_dir.exists() == <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _list; hudson.FilePath[] _files = _dir.list(<span class="hljs-string"><span class="hljs-string">"*.asset"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (hudson.FilePath _file : _files) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_file.isDirectory() == <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//_list &lt;&lt; _file.getName(); _list &lt;&lt; _file.getBaseName(); } } return _list.sort();</span></span></code> </pre><br>  For this script, <b>enable the</b> check box <b>Use predefined variables in scripts</b> , which allows you to contact the collector.  The code resembles <b>Java</b> , documentation can be found here - <a href="http://javadoc.jenkins-ci.org/jenkins/model/Jenkins.html">http://javadoc.jenkins-ci.org/jenkins/model/Jenkins.html</a> .  The <b>getCustomWorkspace</b> function provides access to the location specified earlier.  If you use the default template, you will have to explicitly enter the path. <br><br></li><li>  Create parameter <b>BUILD_UNITY</b> .  For it, we separately select the <b>Textarea Choice Parameter</b> , where we enter <b>TRUE</b> and <b>FALSE</b> values ‚Äã‚Äãin two lines. <br><br></li><li>  Customize " <b>Source Code Management</b> ".  Choose <b>Subversion</b> , enter <b>$ {REPOSITORY}</b> as the address, infinite depth, choose a login and password for access (or create, if not already done).  When assembling, an explicit value from the file will be substituted for the entered expression  As a strategy, select " <b>revert first, then update</b> ". <br><br></li><li>  Customize the <b>Assembly Triggers</b> .  You can collect a task periodically, once a day, for example, only after new versions appear in the repository.  For example, ‚ÄúH * / 8 * * *‚Äù in the <b>Poll</b> field of the <b>SCM about changes</b> starts the build 3 times a day if there is a fresh version.  Next to the menu there is a syntax description help. <br><br>  Details on setting up other build options <a href="https://wiki.jenkins-ci.org/display/JENKINS/Building%2Ba%2Bsoftware%2Bproject">here</a> .  It must be remembered that if the build is oriented to the latest version in the repository and the repository was selected in the settings that is different from the default one, if the default is changed, the build will not be done!  The solution is to manually switch the next assembly or configure the assembly by trigger or by schedule. <br><br></li><li>  Go to the <b>Post-Assembly</b> section at the end and add the <b>Groovy Postbuild</b> step.  The simplest script that analyzes build success is below: <br><br><pre> <code class="java hljs">String proc = <span class="hljs-string"><span class="hljs-string">"/bin/sh /Users/jenkins/WORK/build-failure.sh"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (manager.build.getResult() == hudson.model.Result.SUCCESS) proc = <span class="hljs-string"><span class="hljs-string">"/bin/sh /Users/jenkins/WORK/build-success.sh"</span></span>; proc.execute();</code> </pre><br><br>  As an error script, for example, you can use: <br><br><pre> <code class="bash hljs">say <span class="hljs-string"><span class="hljs-string">"Kill all humans"</span></span></code> </pre><br></li><li>  At this stage, save the settings and run the assembly.  A directory should be created, a project from the repository is downloaded into it, at the end of the task - to work out one of the scripts.  In case of errors, we check whether all the files used in the scripts have been created and whether they have the correct access rights. <br><br></li><li>  If everything works, go back to the middle of the settings sheet.  Select " <b>Generate environment variables from script</b> " and enter something like: <br><br><pre> <code class="bash hljs">BUILD_SUBDIR=`awk -F: <span class="hljs-string"><span class="hljs-string">'/location:/ {sub(/.*location: */,""); gsub(/\\\\/,"/"); print}'</span></span> Assets/BuildPresets/<span class="hljs-variable"><span class="hljs-variable">${PRESET}</span></span>.asset` BUILD_DIR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${WORKSPACE}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BUILD_SUBDIR}</span></span></span><span class="hljs-string">"</span></span> BUILD_VERSION=`../svnversion -c . | cut -f2 -d:` APPLICATION_NAME=`awk -F: <span class="hljs-string"><span class="hljs-string">'/buildName:/ {sub(/.*buildName: */,""); gsub(/\\\\/,"/"); print}'</span></span> Assets/BuildPresets/<span class="hljs-variable"><span class="hljs-variable">${PRESET}</span></span>.asset` BUILD_ARTIFACT=<span class="hljs-variable"><span class="hljs-variable">${APPLICATION_NAME}</span></span>-<span class="hljs-variable"><span class="hljs-variable">${PRESET}</span></span>-<span class="hljs-variable"><span class="hljs-variable">${BUILD_VERSION}</span></span>.zip <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> BUILD_SUBDIR=<span class="hljs-variable"><span class="hljs-variable">${BUILD_SUBDIR}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> BUILD_DIR=<span class="hljs-variable"><span class="hljs-variable">${BUILD_DIR}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> BUILD_VERSION=<span class="hljs-variable"><span class="hljs-variable">${BUILD_VERSION}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> APPLICATION_NAME=<span class="hljs-variable"><span class="hljs-variable">${APPLICATION_NAME}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> BUILD_ARTIFACT=<span class="hljs-variable"><span class="hljs-variable">${BUILD_ARTIFACT}</span></span></code> </pre><br><br>  The first part of the script uses the build parameters to generate additional variables.  For example, search for the exact assembly directory and application name from the settings selected in the <b>PRESET</b> file.  The <b>svnversion</b> file is put in the <b>WORK</b> folder, and by calling it you can get detailed information about the build.  All paths are relative from the current directory. <br><br>  The second part is specifically for the assembly process.  As written in the help, to integrate the variables directly into the assembly, you must send them to <b>/ stdout</b> in this format. <br><br></li><li>  Go to the <b>Build</b> section and create the <b>Conditional steps (multiple)</b> build step.  In the launch condition, select the condition of equality of the rows and make a check for the equality <b>$ {BUILD_UNITY}</b> in one field and <b>TRUE</b> in the other.  All further steps are performed in this section.  This procedure allows you to run the task only to update the data. <br><br></li><li>  Add a step with the <b>shell</b> commands.  Before assembly, you need to clean the assembly directory - use certain variables: <br><br><pre> <code class="bash hljs">rm -rf <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUILD_DIR</span></span></span><span class="hljs-string">"</span></span> || <span class="hljs-literal"><span class="hljs-literal">true</span></span> mkdir -p <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUILD_DIR</span></span></span><span class="hljs-string">"</span></span> || <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br></li><li>  The next step is <b>Invoke Unity3D Editor</b> .  In the parameters we specify <b>Unity_Default</b> or a specific version.  The build parameters are: <br><br><pre> <code class="bash hljs">-quit -batchmode -executeMethod Build.CmdBuild -buildPreset=<span class="hljs-variable"><span class="hljs-variable">$PRESET</span></span> -switchBuildTarget=<span class="hljs-variable"><span class="hljs-variable">$PLATFORM</span></span></code> </pre><br>  Most teams can be found in the official help <a href="http://docs.unity3d.com/Manual/CommandLineArguments.html">here</a> .  The last 2 parameters are specifically for the build script, but standard <b>-buildOSXPlayer</b> can be used if there are no specific options.  Examples of scripts and arguments can be found in the information about the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Unity3dBuilder%2BPlugin">Unity3dBuilder Plugin plugin</a> and on the <b>Unity</b> community <a href="http://wiki.unity3d.com/index.php/AutoBuilder">wiki</a> . <br><br></li><li>  The final build step is to archive the results.  Standard command: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> `dirname <span class="hljs-variable"><span class="hljs-variable">${BUILD_SUBDIR}</span></span>` zip -qr <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BUILD_DIR}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BUILD_ARTIFACT}</span></span></span><span class="hljs-string">"</span></span> `basename <span class="hljs-variable"><span class="hljs-variable">${BUILD_SUBDIR}</span></span>`</code> </pre><br></li><li>  In the post- <b>assembly</b> section, you can add an <b>Assembly Description</b> .  For example, <b>$ {BUILD_VERSION} $ {PRESET}</b> .  It will be displayed next to the build in the build history. <br><br></li><li>  We archive the results of the assembly.  You can list all the files, in this example you need to save the collected archive <b>$ {BUILD_SUBDIR} / $ {BUILD_ARTIFACT}</b> .  If you skip this step, you will not be able to download the build results.  If auto-cleaning results are specified in the settings, then only a few of them will be available. <br><br></li><li>  The very last step is parsing logs with the rules for <b>Unity</b> .  After that, the task for one platform is completely ready. <br><br></li></ol><br><h1>  Creating a new task </h1><br>  In the example above, the task was configured to build under <b>Mac</b> .  Since the build under <b>Windows</b> and <b>Linux</b> can run on the same project without re-importing resources, you can use the same build directory.  To do this, we create a new task, as the type we select a copy of an existing one, in the settings we change only the icon, the name of the task, the default platform (the directory remains old!). <br><br>  In the <b>View</b> settings, you can create a filter for tasks and display the necessary information about assemblies on the main page.  As a result, you might get something like: <br><br><img src="https://habrastorage.org/files/e2b/f8b/e72/e2bf8be72f69487192a4978c3fbc4ccd.jpeg" alt="image"><br><br><h1>  Build Android builds </h1><br>  In the first part, references were made to the <b>JDK</b> and <b>JRE</b> - <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">here</a> .  Actually, <b>Java is</b> needed for the normal functioning of the collector.  To fully build <b>Android</b> builds, you need to <a href="http://developer.android.com/sdk/index.html">download</a> and configure the <b>Android SDK</b> . <br>  To work correctly, you need to open the <b>Unity</b> editor under the <b>jenkins</b> user, go to <b>Unity / Preferences / External Tools</b> and set up the path to the <b>Android SDK</b> .  In new versions, you also need to specify the path to the <b>JDK</b> , in the old ones this field is absent.  An example of a working configuration: <br><br><ul><li>  OS X 10.10.5 </li><li>  jdk-8u60-macosx-x64 </li><li>  Android SDK: Tools 24.3.4 </li><li>  Android SDK: Platform-tools 23.0.1 </li><li>  Android SDK: Build-tools 23.0.1 </li><li>  Android SDK: SDK Platform API 23 </li><li>  Unity 4.6.6f2 </li><li>  Android SDK Location: "/ Users / jenkins / WORK / AndroidSDK" </li><li>  JDK Location: "/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/" </li></ul><br>  Important!  Each version of the editor should be configured (3.xx 4.xx and 5.xx have different configuration files) and under each user under which the build will take place (just under <b>jenkins</b> ). <br><br>  To create a new task in the collector, you can copy any <b>Standalone</b> task.  At the same time, <b>Custom Workspace Directory</b> should be changed - the time for re-importing resources for another platform can be very large, so for <b>Android</b> builds we create a separate directory for the project.  We change the configuration file, the build platform, the task icon.  Differences can also be in saved assembly files, for example, you can not archive the result, but save <b>$ {BUILD_SUBDIR} / *. Apk, $ {BUILD_SUBDIR} / *. Obb</b> files. <br><br>  No way to change build tools.  For example, you need to build under different versions of <b>Unity of the</b> same, 4th generation, but with different <b>JDK</b> and <b>AndroidSDK settings</b> .  You can add assembly steps that edit the <b>~ jenkins / Library / Preferences / com.unity3d.UnityEditor4.x.plist file</b> (use the <b>defaults</b> <b>shell</b> command), as well as install the <a href="https://wiki.jenkins-ci.org/display/JENKINS/JDK%2BParameter%2BPlugin">JDK Parameter Plugin</a> and parameterize the assembly with a <b>JDK</b> selection.  <i>If someone does this - please unsubscribe about the results - I will include it in the article.</i> <br><br>  Important!  When updating the <b>Android SDK,</b> you must rebuild all <b>Java Plugines</b> written for the project.  As they say on the <a href="http://docs.unity3d.com/Manual/PluginsForAndroid.html">site</a> : when building, you should include <b>-source 1.6 -target 1.6</b> in the assembly line. <br><br><h5>  Update 10/13/15 </h5><br><ol><li>  Note <a href="https://habrahabr.ru/users/youngskipper/" class="user_link">YoungSkipper</a> builds several builds at the same time.  I will try to implement and edit in case of success, however macmini may not pull. </li></ol><br><h5>  Update 10/20/15 </h5><br><ol><li>  Moved Android - instructions in this article, since the article on the assembly for iOS is too big. </li><li>  Slightly edited design. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/268365/">https://habr.com/ru/post/268365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268355/index.html">DEV Labs 2015. Online conference for .NET developers. 17 October</a></li>
<li><a href="../268357/index.html">Um, but our fault is what? Do we issue these sim cards or what? (c) Vkontakte</a></li>
<li><a href="../268359/index.html">RailsStuff - development kit on rails</a></li>
<li><a href="../268361/index.html">Jii: A complete application with Yii2 architecture in the browser</a></li>
<li><a href="../268363/index.html">Experience in the development of a simulator program for the practical work of students</a></li>
<li><a href="../268369/index.html">The secret arrow in the address bar and other surprises in the assembly Vivaldi 1.0.291.18</a></li>
<li><a href="../268371/index.html">DTO vs POCO vs Value Object</a></li>
<li><a href="../268375/index.html">Solving the problem of setting the screen resolution in Thinstation</a></li>
<li><a href="../268377/index.html">How to create a game on Unity3D without a mat</a></li>
<li><a href="../268379/index.html">Three holes in Scratch Mania</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>