<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How trading on a stock exchange actually works: A simple algorithm (part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="/ photo yuan2003 CC 

 High-frequency traders are a special caste of exchange players. Few, among them, condescend to describe the meaning of their pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How trading on a stock exchange actually works: A simple algorithm (part 1)</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/itinvest/blog/306392/"><img src="https://habrastorage.org/files/f39/73d/839/f3973d839ae148468e947775aa7f32db.jpg"></a> <br><br>  <i>/ photo <a href="https://www.flickr.com/photos/yuan2003/4690243944/in/album-72157624249839994/">yuan2003 CC</a></i> <br><br>  High-frequency traders are a special caste of exchange players.  Few, among them, condescend to describe the meaning of their profession in simple human language.  We found the blog of Chris Stucchio, a former quantum who decided to write a brief <a href="https://www.chrisstucchio.com/blog/2012/hft_apology.html">apology for HFT</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is not about justifying the profession in a social context, says Chris.  It is about some intellectual foundations of the sphere of human activity, which is often misunderstood.  In his post, the author tries to talk about the basis on which exchange trading and high-frequency trading is built, and with examples he explains why traders are so concerned about reducing transaction delays. <a name="habracut"></a><br><br><h4>  HFT mechanics </h4><br>  Any serious discussion about high-frequency trading has to start from scratch.  Explain the mechanisms and practices underlying the HFT.  The main object in it, as in the case of any operations with securities, is the order book (order book).  Suppose a certain trader Mel enters the stock exchange with a desire to buy a certain amount of Blue Sun shares.  He roughly represents how much he is willing to buy and at what maximum price.  Next, he masters the process of converting orders and processing transactions (matching engine).  This could be the BATS, ARCA or any other sites where it places an order: <br><pre><code class="bash hljs">BUY(owner=Mal, max_price=20.00, quantity=100)</code> </pre> <br>  At this stage, Mel still did not sell anything and did not buy.  He simply notified the whole world about his intention.  The system takes this request and displays the information (anonymously) to all other traders.  Now imagine that there is a girl trader Inara, who wants to sell 200 shares of the company at, say, $ 20.10.  She also places her application, which is displayed in the register of orders.  Now it looks like this: <br><br><pre> <code class="bash hljs">SELL(owner=Inara, min_price=20.10, quantity=200) ------ BUY(owner=Mal, max_price=20.00, quantity=100)</code> </pre><br>  At this point, no deal has happened yet.  Mel wants to buy 20 dollars or less, Inara wants to sell for 20.10 or more.  The market has shaped the difference between ask and bid at $ 0.10. <br><br>  Let's complicate the task.  While the first two are scratching their heads, Kylie and River enter the market.  Suppose there is a new position for the sale of 200 shares at $ 20.21 and one more per 100 shares at 20.10. <br><br>  Finally, Simon appears on the stock exchange, who places an order to purchase 250 shares at a price of $ 20.21.  He will happily make a deal with Inara, Kylie and River.  They all requested less of its price.  The system uses two basic rules that determine who will sell how much to whom: <br><br><ol><li>  Price: the best price quote always wins. </li><li>  Time: if prices are equal, the one who placed the order earlier wins. </li></ol><br>  So, at the time of the appearance of the last buyer, the order register looked like this: <br><br><pre> <code class="bash hljs">SELL(owner=Kaylee, min_price=20.21, quantity=200) &lt;- Trades third SELL(owner=River, min_price=20.10, quantity=100) &lt;- Trades second SELL(owner=Inara, min_price=20.10, quantity=200) &lt;- Trades first ------ BUY(owner=Mal, max_price=20.00, quantity=100)</code> </pre><br>  After Simon placed his order for the purchase of 250 shares, the mechanism will distribute it as follows: <br><br><ul><li>  200 shares to him will sell Inara at the price of $ 20.10.  Just because she was the first with such a price. </li><li>  50 shares he will throw River, because his price offer was better than that of Kylie. </li></ul><br>  Everything, the buyer received that volume of actions which wanted.  The register will now look like this: <br><br><pre> <code class="bash hljs">SELL(owner=Kaylee, min_price=20.21, quantity=200) SELL(owner=River, min_price=20.10, quantity=50) ------ BUY(owner=Mal, max_price=20.00, quantity=100)</code> </pre><br>  Since Kylie does not want to give a good price, her order remains unfilled.  This is the basic mechanism of trading on the exchange.  In practice, of course, everything is more complicated.  Details appear, other types of orders appear, besides just limit orders.  But for the purposes of this article this will be enough.  In more detail about the mechanism of trading it is possible to read <a href="https://www.amazon.com/Trading-Exchanges-Market-Microstructure-Practitioners/dp/0195144708/151-8633515-0356912%3Fie%3DUTF8%26camp%3D1789%26creative%3D390957%26creativeASIN%3D0195144708%26linkCode%3Das2%26redirect%3Dtrue%26ref_%3Das_li_ss_tl%26tag%3Dchristuc-20">here</a> and <a href="https://www.amazon.com/Algorithmic-Trading-DMA-introduction-strategies/dp/0956399207%3Fie%3DUTF8%26camp%3D1789%26creative%3D390957%26creativeASIN%3D0956399207%26linkCode%3Das2%26redirect%3Dtrue%26ref_%3Das_li_ss_tl%26tag%3Dchristuc-20">here</a> .  But remember, no book will give you a complete picture.  Alternatively, you can delve into the documentation of the exchange platforms themselves, then you can make a more complete impression about how everything works on a specific site. <br><br><h4>  Market-making </h4><br>  In high-frequency algorithmic trading, the market-making strategy is mainly used.  In the simplest sense, this means that the trader is playing on both sides of the table at the same time.  It does not open or close positions, focusing on the trend of the market.  Instead, it exposes assets to both buy and sell at the same time.  If you want to buy stocks, he will sell them for $ 20.10.  If you want to sell, he will buy them from you for the price of $ 20 per piece.  While he buys and sells, the price difference fluctuates slightly.  His goal and profit is the same $ 0.10. <br><br>  Of course, even in this case, the trader bears certain risks.  No one guarantees that after buying shares at $ 20, the market will not fix at this level.  If he bought 20, and the assets fell to 15 before he managed to throw them off, he would lose $ 5 per share.  Therefore, such a trader must balance the risks, taking into account the profits.  If he keeps the ask / bid difference too low, he will lose money, if high - no one will trade with him. <br><br>  It should be understood that there is nothing new or revolutionary in the market-making strategy.  Remember, movies about the stock exchange, where traders opened and closed positions with shouts and gestures.  This was called " <a href="https://en.wikipedia.org/wiki/Open_outcry">trade in the pit</a> ."  This practice was spread from ancient times to the beginning of the 2000s, when the step was 1/8 and 1/16 of a dollar. <br><br><img src="https://habrastorage.org/files/077/9ad/62a/0779ad62a1884213a7c809dc0047d280.jpg"><br><br>  <i>/ photo <a href="https://www.flickr.com/photos/yuan2003/4689640281/in/photolist-89pCEV-89pBNi-89sTtC-nFtCEU-bwfDeA-nHweCn-bPDU1n-quC23n-nKiF44-nrRe3G-9Xkhro-SAvwU-bAKeW1-3fc7k6-bAPx73-bPJc2n-bPDTZ4-bPDU3V-9o63ry-ef5QgQ-8UKcbp-bweoFf-oHvKGy-8sWDUM-bAKfmA-9o3gsn-bwepEU-9o61Qy-bPDTGP-9o5tTo-9o3bZe-9o5roA-bweZuy-bK9K2t-c7dXLo-bKa2ot-7m3dUR-9o62wN-bPrk7H-9o2vut-4DdanG-bPJc8K-bK9xjr-bPDbWc-9o33o4-9o5Da9-egGFVY-9o5wHh-3fgtUd-bKafcZ">yuan2003 CC</a></i> <br><br>  Automated trading systems have replaced such market makers for a very simple reason: cost reduction.  Firstly, such a strategy works only with several assets at the same time; not a single person will be able to hold positions on hundreds of stocks in his head.  Secondly, you save time.  The system is able to generate tens and hundreds of thousands of dollars in profits annually.  That is, if you put a person in its place, he, being smart enough to correctly assess the market, will work for at least a couple of tens of thousands of dollars in annual income.  A mediocre server in the data center is able to manage hundreds of strategies with a profit of up to $ 50,000 per year.  To do this much faster and more accurately than a man. <br><br>  In other words, we are dealing with a special case of the general process of replacing people with robots. <br><br><h4>  Time and order flow </h4><br>  For the market maker, the essence of the game is in the movement of orders (order flow).  As long as your purchases and sales are coordinated, your profit will be proportional to this: <br><br><pre> <code class="bash hljs">(<span class="hljs-comment"><span class="hljs-comment"># of shares traded) x (ASK PRICE - BID PRICE)</span></span></code> </pre><br>  The constancy of this ratio depends, by and large, only on the trader‚Äôs ability to assess risks.  In theory, the more you sell, the higher the profit.  So how to sell more? <br><br>  The answer is banal: you need to stay in the top of the register of orders.  The most direct way to this is to offer the best price.  Let's return to our example with traders.  Suppose there is also Jane, who wishes to stand at the head of a queue of buyers.  He needs to offer a better price than Mel. <br><br><pre> <code class="bash hljs">SELL(owner=Kaylee, min_price=20.21, quantity=200) SELL(owner=River, min_price=20.10, quantity=50) ------ BUY(owner=Jayne, max_price=20.05, quantity=100) &lt;-     BUY(owner=Mal, max_price=20.00, quantity=100)  , ,   .</code> </pre><br>  Now it‚Äôs time to think about balance.  Since Jane has only $ 0.05 per share sold, she needs to be confident that the profit will outweigh the risks.  Suppose that the margin between expected profit and loss is set at $ 20.05.  In other words, there is not a single participant on the market who believes in making a profit by offering more than this amount.  In this scenario, Jane will always be the first, simply because it came first. <br><br>  This example shows why the reaction rate is so important.  For example, at exactly 10:31 am and 30 seconds in the morning comes a new information that allows you to raise the price to 20.07 in order to make a profit.  Perhaps there was a press release, where there is a hint that the company's shares will go up.  In this case, both Mel and Jane will want to raise the price to 20.07.  Whoever gets it done faster, he will head the list of buyers. <br><br><pre> <code class="bash hljs">SELL(owner=Kaylee, min_price=20.21, quantity=200) SELL(owner=River, min_price=20.10, quantity=50) ------ BUY(owner=Mal, max_price=20.07, quantity=100) &lt;-   10:31:30:427 BUY(owner=Jayne, max_price=20.07, quantity=100) &lt;-   10:31:30:639,  212  .</code> </pre><br>  In this example, Jane is late for 212 milliseconds.  In general terms, this is high-frequency trading.  He explains why so much effort was put into reducing the reaction time of the automated system.  The one who opens the position first is more likely to make deals. <br><br>  The second reason is that there is a market movement.  Often, traders want to cancel their orders.  At 10:31 an event occurred that indicates the price movement upwards.  Rivera needs to have time to cancel his sell order at $ 20.10 to raise the price to $ 20.20.  Suppose there is someone else who, on the contrary, will benefit after this event, attack Rivera‚Äôs order at a price of 20.10.  River will remain in the game if it can quickly remove this order.  If an attack is made on the order, the River will be forced to raise the price only to $ 20.15 in order to risk only 0.05 per share. <br><br><h4>  Why does everyone fall for one price? </h4><br>  An astute reader has probably wondered why Mel and Jane agree that the best bid price is 20.07?  Maybe Jane's calculations show that it will be 20.075, and Mel's calculations - 20.071?  Yes, most likely, both players disagree on what will be the best price.  There is no reason why the programs or trading strategies of Mel and Jane will give them the same price in thousandths. <br><br>  Regardless of what the strategy suggests, they cannot place orders for their best prices.  The <a href="https://www.sec.gov/divisions/marketreg/subpenny612faq.htm">SEC Rule 612</a> minimum price increment <a href="https://www.sec.gov/divisions/marketreg/subpenny612faq.htm">rule</a> unequivocally prohibits them to set the sale or purchase price in fractions of a cent.  That is, the purchase of 100 shares for 20.07 is good, and the purchase of 100 shares at 20.075 is already illegal.  By the way, until 2001 the limit was 1/16 of a dollar or $ 0.0625 (there is a similar price move for various financial instruments over other exchange platforms, for example, on the <a href="http://moex.com/ru/contract.aspx%3Fcode%3DRTS-9.15">Moscow Stock Exchange</a> ). <br><br>  In the real market, with more than five participants, you can expect a large number of orders below the top register positions (the highest bid price) by 20.06, 20.05, and so on.  But the majority of traders will also be close to the top in real life. <br><br>  In his next posts, the author promises to raise the topic of social benefits and harms from HFT, and also to tell what is wrong with high-frequency trading today and how to fix it. <br><br><h4>  Other materials on the topic from <a href="http://www.itinvest.ru/services/">ITinvest</a> : </h4><br><ul><li>  <a href="http://www.itinvest.ru/analytics/">Analytical materials from ITinvest experts</a> (for a gradual immersion in the topic of finance, you can start with <a href="http://www.itinvest.ru/analytics/reviews/world-markets/">weekly reviews of financial markets</a> ) </li><li>  <a href="https://habrahabr.ru/post/306200/">Novice Investor's FAQ: How money is actually protected on the exchange</a> </li><li>  <a href="https://habrahabr.ru/post/301948/">The harsh reality: As antique dealers, retirees and system administrators create trading strategies on the exchange (and what comes of it)</a> </li><li>  <a href="https://habrahabr.ru/post/281745/">Can all financial models be erroneous: 7 sources of risk of losses</a> </li><li>  <a href="https://habrahabr.ru/post/280954/">Experiment: What does the random walk hypothesis say about financial market forecasting?</a> </li><li>  <a href="https://habrahabr.ru/post/279021/">Experiment: Using Google Trends to predict stock market crashes</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/306392/">https://habr.com/ru/post/306392/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306382/index.html">Configuring ssh callback on the server in conjunction with Ansible</a></li>
<li><a href="../306384/index.html">Manage Docker project with multiple git repositories</a></li>
<li><a href="../306386/index.html">Translation of excerpts from Robert Heinlein‚Äôs book, Take Your Government Back - part 14</a></li>
<li><a href="../306388/index.html">Tale of how to make a Gauss gun in seven days</a></li>
<li><a href="../306390/index.html">Forget about foreign languages ‚Äã‚Äãand music - teach children programming</a></li>
<li><a href="../306394/index.html">LogicMonitor - a startup that collected $ 130 million</a></li>
<li><a href="../306396/index.html">Old electronics - your personal gold reserve</a></li>
<li><a href="../306398/index.html">Undo and Redo - analysis and implementation</a></li>
<li><a href="../306400/index.html">Representation of movements in 3D modeling: interpolation, approximation, and Lie algebra</a></li>
<li><a href="../306402/index.html">Online chat in small business: to be or not to be?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>