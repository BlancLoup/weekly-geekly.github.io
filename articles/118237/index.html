<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DIY mini framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, after reading about the Silex mini-framework , I thought: what is so complicated about it? I tried to write something similar and it turned ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DIY mini framework</h1><div class="post__text post__text-html js-mediator-article">  Recently, after reading about the <a title="Silex - microfreemv from the creators of symfony2" href="http://habrahabr.ru/blogs/symfony/118011/">Silex mini-framework</a> , I thought: what is so complicated about it?  I tried to write something similar and it turned out pretty easy. <br><a name="habracut"></a><br>  These mini-frameworks are usually based on the following rules for mod_rewrite: <br><blockquote><code><a href="http://s-c.me/21322/s"></a> <a href="http://s-c.me/21322/h"></a> <font color="black">Copy Source | Copy HTML <font color="#0000ff">&lt;</font> <font color="#800000">IfModule</font> <font color="#ff0000">mod_rewrite</font> . <font color="#ff0000">c</font> <font color="#0000ff">&gt;</font> RewriteEngine On RewriteBase / RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*)$ index.php [QSA,L] <font color="#0000ff">&lt;/</font> <font color="#800000">IfModule</font> <font color="#0000ff">&gt;</font></font></code> <ol> <li> <code><font color="black"><a href="http://s-c.me/21322/s"></a> <a href="http://s-c.me/21322/h"></a> Copy Source | Copy HTML <font color="#0000ff">&lt;</font> <font color="#800000">IfModule</font> <font color="#ff0000">mod_rewrite</font> . <font color="#ff0000">c</font> <font color="#0000ff">&gt;</font> RewriteEngine On RewriteBase / RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*)$ index.php [QSA,L] <font color="#0000ff">&lt;/</font> <font color="#800000">IfModule</font> <font color="#0000ff">&gt;</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/21322/s"></a> <a href="http://s-c.me/21322/h"></a> Copy Source | Copy HTML <font color="#0000ff">&lt;</font> <font color="#800000">IfModule</font> <font color="#ff0000">mod_rewrite</font> . <font color="#ff0000">c</font> <font color="#0000ff">&gt;</font> RewriteEngine On RewriteBase / RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*)$ index.php [QSA,L] <font color="#0000ff">&lt;/</font> <font color="#800000">IfModule</font> <font color="#0000ff">&gt;</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/21322/s"></a> <a href="http://s-c.me/21322/h"></a> Copy Source | Copy HTML <font color="#0000ff">&lt;</font> <font color="#800000">IfModule</font> <font color="#ff0000">mod_rewrite</font> . <font color="#ff0000">c</font> <font color="#0000ff">&gt;</font> RewriteEngine On RewriteBase / RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*)$ index.php [QSA,L] <font color="#0000ff">&lt;/</font> <font color="#800000">IfModule</font> <font color="#0000ff">&gt;</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/21322/s"></a> <a href="http://s-c.me/21322/h"></a> Copy Source | Copy HTML <font color="#0000ff">&lt;</font> <font color="#800000">IfModule</font> <font color="#ff0000">mod_rewrite</font> . <font color="#ff0000">c</font> <font color="#0000ff">&gt;</font> RewriteEngine On RewriteBase / RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*)$ index.php [QSA,L] <font color="#0000ff">&lt;/</font> <font color="#800000">IfModule</font> <font color="#0000ff">&gt;</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/21322/s"></a> <a href="http://s-c.me/21322/h"></a> Copy Source | Copy HTML <font color="#0000ff">&lt;</font> <font color="#800000">IfModule</font> <font color="#ff0000">mod_rewrite</font> . <font color="#ff0000">c</font> <font color="#0000ff">&gt;</font> RewriteEngine On RewriteBase / RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*)$ index.php [QSA,L] <font color="#0000ff">&lt;/</font> <font color="#800000">IfModule</font> <font color="#0000ff">&gt;</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/21322/s"></a> <a href="http://s-c.me/21322/h"></a> Copy Source | Copy HTML <font color="#0000ff">&lt;</font> <font color="#800000">IfModule</font> <font color="#ff0000">mod_rewrite</font> . <font color="#ff0000">c</font> <font color="#0000ff">&gt;</font> RewriteEngine On RewriteBase / RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*)$ index.php [QSA,L] <font color="#0000ff">&lt;/</font> <font color="#800000">IfModule</font> <font color="#0000ff">&gt;</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/21322/s"></a> <a href="http://s-c.me/21322/h"></a> Copy Source | Copy HTML <font color="#0000ff">&lt;</font> <font color="#800000">IfModule</font> <font color="#ff0000">mod_rewrite</font> . <font color="#ff0000">c</font> <font color="#0000ff">&gt;</font> RewriteEngine On RewriteBase / RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*)$ index.php [QSA,L] <font color="#0000ff">&lt;/</font> <font color="#800000">IfModule</font> <font color="#0000ff">&gt;</font></font></code> </li> </ol></blockquote><br>  They redirect any request to index.php, in which the framework is connected and this request is processed with a callback function call.  So first, let's write a simple function to process the address: <br><blockquote> <code><a href="http://s-c.me/21321/s"></a> <a href="http://s-c.me/21321/h"></a> <a href="http://www.php.net/manual/en/function.call-user-func.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">function</font> Request ( <font color="#cc6633">$ path</font> , <font color="#cc6633">$ callback</font> ) </li><li>  { </li><li>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ path</font> == <font color="#cc6633">$ _SERVER</font> [ <font color="#008000">'REQUEST_URI'</font> ]) <font color="#0000ff">return</font> call_user_func ( <font color="#cc6633">$ callback</font> ); </li><li>  } </li></ol></blockquote><br>  When calling, the function checks the address to which the user has addressed, and if it matches the one passed into the function, it calls the callback.  This can already be considered the basic functionality.  However, there is no one thing to do - extracting variables from an address.  In addition, the function finds the addresses <a href="http://example.com/something">example.com/something</a> and <a href="http://example.com/something/">example.com/something</a> different.  This can be solved by parsing the address and using array_filter: <br><blockquote> <code><a href="http://s-c.me/21323/s"></a> <a href="http://s-c.me/21323/h"></a> <a href="http://www.php.net/manual/en/function.explode.php"></a> <a href="http://www.php.net/manual/en/function.explode.php"></a> <a href="http://www.php.net/manual/en/function.array-values.php"></a> <a href="http://www.php.net/manual/en/function.array-values.php"></a> <a href="http://www.php.net/manual/en/function.count.php"></a> <a href="http://www.php.net/manual/en/function.count.php"></a> <a href="http://www.php.net/manual/en/function.count.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <a href="http://www.php.net/manual/en/function.call-user-func-array.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">function</font> array_filter_callback_no_empty_str ( <font color="#cc6633">$ value</font> ) </li><li>  { </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ value</font> ! = <font color="#008000">''</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">function</font> Request ( <font color="#cc6633">$ path</font> , <font color="#cc6633">$ callback</font> ) </li><li>  { </li><li>  <font color="#696969">// Request variables for passing to callback</font> </li><li>  <font color="#cc6633">$ args</font> = <font color="#0000ff">array</font> (); </li><li></li><li>  <font color="#696969">// Split the address to which the user has addressed (URI), into parts</font> </li><li>  <font color="#cc6633">$ uri</font> = explode ( <font color="#008000">'/'</font> , <font color="#cc6633">$ _SERVER</font> [ <font color="#008000">'REQUEST_URI'</font> ]); </li><li>  <font color="#696969">// Do the same with the query path.</font> </li><li>  <font color="#cc6633">$ path</font> = explode ( <font color="#008000">'/'</font> , <font color="#cc6633">$ path</font> ); </li><li></li><li>  <font color="#696969">// Remove the empty parts of both arrays</font> </li><li>  <font color="#cc6633">$ uri</font> = array_values ‚Äã‚Äã(array_filter ( <font color="#cc6633">$ uri</font> , array_filter_callback_no_empty_str)); </li><li>  <font color="#cc6633">$ path</font> = array_values ‚Äã‚Äã(array_filter ( <font color="#cc6633">$ path</font> , array_filter_callback_no_empty_str)); </li><li></li><li>  <font color="#696969">// If the number of parts in the URI and the path is different, exit</font> </li><li>  <font color="#0000ff">if</font> (count ( <font color="#cc6633">$ uri</font> )! = count ( <font color="#cc6633">$ path</font> )) </li><li>  <font color="#0000ff">return false</font> ; </li><li></li><li>  <font color="#696969">// Pass through all parts of the request path</font> </li><li>  <font color="#0000ff">for</font> ( <font color="#cc6633">$ i</font> = <font color="#008000">0</font> ; <font color="#cc6633">$ i</font> &lt;count ( <font color="#cc6633">$ path</font> ); <font color="#cc6633">$ i</font> ++) </li><li>  { </li><li>  <font color="#696969">// Check if this part of the path is variable</font> </li><li>  <font color="#696969">// Path variables are written in braces, which is what the regular expression checks.</font> </li><li>  <font color="#0000ff">if</font> (preg_match ( <font color="#008000">'| ^ \ {(. *) \} $ |'</font> , <font color="#cc6633">$ path</font> [ <font color="#cc6633">$ i</font> ], <font color="#cc6633">$ match</font> )) </li><li>  { </li><li>  <font color="#696969">// If so, add this variable to the array</font> </li><li>  <font color="#cc6633">$ args</font> [ <font color="#cc6633">$ match</font> [ <font color="#008000">1</font> ]] = <font color="#cc6633">$ uri</font> [ <font color="#cc6633">$ i</font> ]; </li><li>  } </li><li>  <font color="#0000ff">else</font> </li><li>  { </li><li>  <font color="#696969">// If the request part is not a variable, simply compare the URI with the request</font> </li><li>  <font color="#696969">// If they do not match - exit</font> </li><li>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ uri</font> [ <font color="#cc6633">$ i</font> ]! = <font color="#cc6633">$ path</font> [ <font color="#cc6633">$ i</font> ]) </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li>  } </li><li></li><li>  <font color="#696969">// After all the checks we call callback, passing it an array with the request variables</font> </li><li>  <font color="#0000ff">return</font> call_user_func_array ( <font color="#cc6633">$ callback</font> , <font color="#cc6633">$ args</font> ); </li><li>  } </li></ol></blockquote><br>  Now you can write code like this: <br><blockquote> <code><a href="http://s-c.me/21324/s"></a> <a href="http://s-c.me/21324/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">function</font> Hello ( <font color="#cc6633">$ who</font> ) </li><li>  { </li><li>  <font color="#0000ff">print</font> <font color="#008000">"Hello, $ who"</font> ; </li><li>  } </li><li></li><li>  Request ( <font color="#008000">'/ hello / {who}'</font> , Hello); </li></ol></blockquote><br>  And now let's glance in the direction of Silex and see what we lack.  First of all, these are assertions (checking the path variable against a regular expression), checking the method of the call (GET, POST, PUT, etc.) and the object-oriented model.  The first two add is quite simple, you only need to add a couple of checks: <br><blockquote> <code><a href="http://s-c.me/21325/s"></a> <a href="http://s-c.me/21325/h"></a> <a href="http://www.php.net/manual/en/function.strtolower.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">function</font> Request ( <font color="#cc6633">$ method</font> , <font color="#cc6633">$ path</font> , <font color="#cc6633">$ callback</font> , <font color="#cc6633">$ asserts</font> = <font color="#0000ff">array</font> ()) </li><li>  { </li><li>  <font color="#696969">// Check the server access method.</font> </li><li>  <font color="#696969">// If a specific method is specified in the request and it does not match the one that was used, exit</font> </li><li>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ method</font> ! = <font color="#008000">''</font> &amp;&amp; strtolower ( <font color="#cc6633">$ _SERVER</font> [ <font color="#008000">'REQUEST_METHOD'</font> ])! = <font color="#cc6633">$ method</font> ) </li><li>  <font color="#0000ff">return false</font> ; </li><li>  &lt;...&gt; </li><li>  <font color="#696969">// Now check if the variable is part of the path.</font> </li><li>  <font color="#0000ff">if</font> (preg_match ( <font color="#008000">'| ^ \ {(. *) \} $ |'</font> , <font color="#cc6633">$ path</font> [$ i], <font color="#cc6633">$ match</font> )) </li><li>  { </li><li>  <font color="#696969">// If it is, then see if there is a regular expression to check it,</font> </li><li>  <font color="#696969">// and if there is, then we check the corresponding part of the URI for compliance</font> </li><li>  <font color="#0000ff">if</font> (! <font color="#0000ff">isset</font> ( <font color="#cc6633">$ asserts</font> [ <font color="#cc6633">$ match</font> [ <font color="#008000">1</font> ]]) || preg_match ( <font color="#cc6633">$ asserts</font> [ <font color="#cc6633">$ match</font> [ <font color="#008000">1</font> ]], <font color="#cc6633">$ uri</font> [$ i])) </li><li>  { </li><li>  <font color="#696969">// If everything is correct, add this variable along with its value to the array</font> </li><li>  <font color="#cc6633">$ args</font> [ <font color="#cc6633">$ match</font> [ <font color="#008000">1</font> ]] = <font color="#cc6633">$ uri</font> [$ i]; </li><li>  } </li><li>  <font color="#0000ff">else</font> </li><li>  { </li><li>  <font color="#696969">// If the value does not match the regular expression, exit</font> </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li>  } </li><li>  &lt;...&gt; </li><li>  } </li></ol></blockquote><br>  However, the second is also quite easy to do.  We will do the transfer of $ method, $ path, $ callback in the constructor, write a separate wrapper function for asserts, and push the entire work into the run () function, not forgetting to substitute $ this-&gt; for the above variables: <br><blockquote> <code><a href="http://s-c.me/21326/s"></a> <a href="http://s-c.me/21326/h"></a> <a href="http://www.php.net/manual/en/function.strtolower.php"></a> <a href="http://www.php.net/manual/en/function.assert.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">class</font> Request </li><li>  { </li><li>  <font color="#0000ff">public</font> <font color="#cc6633">$ method</font> ;  <font color="#696969">// Request Method (GET, POST, PUT, etc.)</font> </li><li>  <font color="#0000ff">public</font> <font color="#cc6633">$ path</font> ;  <font color="#696969">// Request Path</font> </li><li>  <font color="#0000ff">public</font> <font color="#cc6633">$ callback</font> ;  <font color="#696969">// Callback</font> </li><li>  <font color="#0000ff">public</font> <font color="#cc6633">$ asserts</font> = <font color="#0000ff">array</font> ();  <font color="#696969">// Regular expressions for checking path variables</font> </li><li></li><li>  <font color="#696969">// class constructor</font> </li><li>  <font color="#0000ff">public function</font> __construct ( <font color="#cc6633">$ method</font> , <font color="#cc6633">$ path</font> , <font color="#cc6633">$ callback</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ this</font> -&gt; method = strtolower ( <font color="#cc6633">$ method</font> ); </li><li>  <font color="#cc6633">$ this</font> -&gt; path = <font color="#cc6633">$ path</font> ; </li><li>  <font color="#cc6633">$ this</font> -&gt; callback = <font color="#cc6633">$ callback</font> ; </li><li>  } </li><li></li><li>  <font color="#696969">// Add re regular expression to check the path variable named</font> </li><li>  <font color="#0000ff">public function</font> assert ( <font color="#cc6633">$ name</font> , <font color="#cc6633">$ re</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ this</font> -&gt; asserts [ <font color="#cc6633">$ name</font> ] = <font color="#cc6633">$ re</font> ; </li><li></li><li>  <font color="#696969">// Return the current instance class</font> </li><li>  <font color="#696969">// This allows you to write similar code: $ reg-&gt; assert ('id', '| ^ \ d + $ |') -&gt; run ();</font> </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> ; </li><li>  } </li><li></li><li>  <font color="#696969">// Request processing function</font> </li><li>  <font color="#0000ff">public function</font> run () </li><li>  { </li><li>  &lt;...&gt; </li><li>  } </li><li>  } </li></ol></blockquote><br>  It seems to be all beautiful, except for two moments.  The first moment is purely aesthetic - now, to process one request, you need to write two lines of code: <br><blockquote> <code><a href="http://s-c.me/21327/s"></a> <a href="http://s-c.me/21327/h"></a> <a href="http://www.php.net/manual/en/function.assert.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#cc6633">$ req</font> = <font color="#0000ff">new</font> Request ( <font color="#008000">'/ user / {id}'</font> , UserProfile); </li><li>  <font color="#cc6633">$ req</font> -&gt; assert ( <font color="#008000">'| ^ \ d + $ |'</font> ) -&gt; run (); </li></ol></blockquote><br>  But fortunately, PHP allows you to use the same names for classes and functions, so let's write a wrapper function that will create and return an instance of the class: <br><blockquote> <code><a href="http://s-c.me/21328/s"></a> <a href="http://s-c.me/21328/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">function</font> Request ( <font color="#cc6633">$ method</font> , <font color="#cc6633">$ path</font> , <font color="#cc6633">$ callback</font> ) </li><li>  { </li><li>  <font color="#0000ff">return new</font> Request ( <font color="#cc6633">$ method</font> , <font color="#cc6633">$ path</font> , <font color="#cc6633">$ callback</font> ); </li><li>  } </li></ol></blockquote><br>  Now you can write everything again compactly and conveniently: <br><blockquote> <code><a href="http://s-c.me/21329/s"></a> <a href="http://s-c.me/21329/h"></a> <a href="http://www.php.net/manual/en/function.assert.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  Request ( <font color="#008000">'/ user / {id}'</font> , UserProfile) -&gt; assert ( <font color="#008000">'| ^ \ d + $ |'</font> ) -&gt; run (); </li></ol></blockquote><br>  The second unpleasant moment is the absence of any single center where requests will be stored and processed.  Why do we call the run () function all the time?  But even if you make such a single center, it will be much easier if new requests are added to its queue.  Plus, there shouldn't be two centers, so you need to implement a singleton.  So, write it already! <br><blockquote> <code><a href="http://s-c.me/21338/s"></a> <a href="http://s-c.me/21338/h"></a> <a href="http://www.php.net/manual/en/function.is-object.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">class</font> Application </li><li>  { </li><li>  <font color="#0000ff">public</font> <font color="#cc6633">$ requests</font> = <font color="#0000ff">array</font> (); </li><li></li><li>  <font color="#696969">/// ---</font> </li><li>  <font color="#696969">// Implement singleton</font> </li><li>  <font color="#0000ff">protected static</font> <font color="#cc6633">$ instance</font> ; </li><li></li><li>  <font color="#0000ff">private function</font> __construct () </li><li>  { </li><li>  } </li><li></li><li>  <font color="#0000ff">private function</font> __clone () </li><li>  { </li><li>  } </li><li></li><li>  <font color="#0000ff">public static function</font> getInstance () </li><li>  { </li><li>  <font color="#0000ff">if</font> (! is_object (self :: <font color="#cc6633">$ instance</font> )) </li><li>  { </li><li>  self :: <font color="#cc6633">$ instance</font> = <font color="#0000ff">new</font> self; </li><li>  } </li><li></li><li>  <font color="#0000ff">return</font> self :: <font color="#cc6633">$ instance</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">public static function</font> init () </li><li>  { </li><li>  self :: getInstance (); </li><li>  } </li><li>  <font color="#696969">/// ---</font> </li><li></li><li>  <font color="#696969">// Internal function to handle all requests</font> </li><li>  <font color="#0000ff">private function</font> i_run () </li><li>  { </li><li>  <font color="#0000ff">foreach</font> ( <font color="#cc6633">$ this</font> -&gt; requests <font color="#0000ff">as</font> &amp; <font color="#cc6633">$ request</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ done</font> = <font color="#cc6633">$ request</font> -&gt; run ( <font color="#cc6633">$ params</font> ); </li><li>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ done</font> ) <font color="#0000ff">return true</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#696969">// External static wrapper function over i_run</font> </li><li>  <font color="#696969">// Needed only for aesthetics: Application :: run () looks prettier than Application :: getInstance () -&gt; run ()</font> </li><li>  <font color="#0000ff">public static function</font> run () </li><li>  { </li><li>  <font color="#0000ff">return</font> Application :: getInstance () -&gt; i_run (); </li><li>  } </li><li>  } </li></ol></blockquote><br>  Also slightly change the class Request: <br><blockquote> <code><a href="http://s-c.me/21341/s"></a> <a href="http://s-c.me/21341/h"></a> <a href="http://www.php.net/manual/en/function.strtolower.php"></a> <a href="http://www.php.net/manual/en/function.call-user-func-array.php"></a> <a href="http://www.php.net/manual/en/function.is-bool.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">class</font> Request </li><li>  { </li><li>  &lt;...&gt; </li><li>  <font color="#696969">// class constructor</font> </li><li>  <font color="#0000ff">public function</font> __construct ( <font color="#cc6633">$ method</font> , <font color="#cc6633">$ path</font> , <font color="#cc6633">$ callback</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ this</font> -&gt; method = strtolower ( <font color="#cc6633">$ method</font> ); </li><li>  <font color="#cc6633">$ this</font> -&gt; path = <font color="#cc6633">$ path</font> ; </li><li>  <font color="#cc6633">$ this</font> -&gt; callback = <font color="#cc6633">$ callback</font> ; </li><li></li><li>  <font color="#696969">// Add this request to the queue to the Application</font> </li><li>  Application :: getInstance () -&gt; requests [] = <font color="#cc6633">$ this</font> ; </li><li>  } </li><li>  &lt;...&gt; </li><li>  <font color="#0000ff">public function</font> run () </li><li>  { </li><li>  &lt;...&gt; </li><li>  <font color="#696969">// After all the checks we call callback, passing it an array with the request variables</font> </li><li>  <font color="#cc6633">$ result</font> = call_user_func_array ( <font color="#cc6633">$ this</font> -&gt; callback, <font color="#cc6633">$ this</font> -&gt; args); </li><li></li><li>  <font color="#696969">// If the callback returned a boolean value, return it.</font> </li><li>  <font color="#0000ff">if</font> (is_bool ( <font color="#cc6633">$ result</font> )) </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ result</font> ; </li><li>  <font color="#696969">// Otherwise, return true</font> </li><li>  <font color="#0000ff">else</font> </li><li>  <font color="#0000ff">return true</font> ; </li><li>  } </li><li>  } </li></ol></blockquote><br>  The latter is necessary in order to be able to use multiple requests to process a single path.  If the callback returns false, then the following requests will be processed, otherwise everything will end. <br>  In general, using our mini-framework looks quite nice and simple: <br><blockquote> <code><a href="http://s-c.me/21331/s"></a> <a href="http://s-c.me/21331/h"></a> <a href="http://www.php.net/manual/en/function.assert.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">new</font> Application (); </li><li></li><li>  Request ( <font color="#008000">'/ user / {id}'</font> , UserProfile) -&gt; assert ( <font color="#008000">'| ^ \ d + $ |'</font> ) -&gt; run (); </li><li></li><li>  Application :: run (); </li></ol></blockquote><br>  However, everything can be simplified even more.  Among the PHP settings, there are two great options: auto_prepend_file and auto_append_file, which allow you to enable payload PHP scripts before and after the execution of the main script.  We can bring the framework into a separate file and connect it using these functions.  At the first connection, we will declare the classes and create an Application object, and at the second - call Application :: run ().  You can determine if a script is being run for the first time or not by checking whether the Application class exists or the Request class exists: <br><blockquote> <code><a href="http://s-c.me/21339/s"></a> <a href="http://s-c.me/21339/h"></a> <a href="http://www.php.net/manual/en/function.class-exists.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">if</font> (! class_exists ( <font color="#008000">'Application'</font> )) </li><li>  { </li><li>  <font color="#696969">// If the Application class is not yet declared, the script launches for the first time.</font> </li><li></li><li>  <font color="#0000ff">class</font> Request </li><li>  { </li><li>  &lt;...&gt; </li><li>  } </li><li></li><li>  <font color="#0000ff">function</font> Request ( <font color="#cc6633">$ method</font> , <font color="#cc6633">$ path</font> , <font color="#cc6633">$ callback</font> ) </li><li>  { </li><li>  &lt;...&gt; </li><li>  } </li><li></li><li>  <font color="#0000ff">class</font> Application </li><li>  { </li><li>  &lt;...&gt; </li><li>  } </li><li></li><li>  <font color="#696969">// Initialize the Application,</font> </li><li>  Application :: init (); </li><li>  } </li><li>  <font color="#0000ff">else</font> </li><li>  { </li><li>  <font color="#696969">// The script does not run for the first time.</font> </li><li>  Application :: run (); </li><li>  } </li></ol></blockquote><br>  Thus, we got rid of two ‚Äúextra‚Äù lines. <br><br>  This is how you can write a more or less functional mini-framework.  It does not reach Silex, but it is quite possible to use it.  The full source code (slightly modified) and an example of usage are on <a href="http://fw.nizarium.com/">http://fw.nizarium.com/</a> , which works on the same mini-framework. <br>  <u>Please do not consider this as something serious.</u>  This is just an example, originally written purely for himself.  If there are any errors in it, I am ready to correct them. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/118237/">https://habr.com/ru/post/118237/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../118230/index.html">"Thanks, Eva! will help you earn on YouTube</a></li>
<li><a href="../118232/index.html">Spring Update "Tutumba"</a></li>
<li><a href="../118234/index.html">Presentation of Liferay on ADD-2011</a></li>
<li><a href="../118235/index.html">Test cloud hosting from Selectel</a></li>
<li><a href="../118236/index.html">Just about the Incredible. Video review HTC Incredible S</a></li>
<li><a href="../118239/index.html">Opposition HP and Oracle. Continuation</a></li>
<li><a href="../118241/index.html">How Apple Influenced Web Design</a></li>
<li><a href="../118242/index.html">Create an application for Windows Phone 7 from start to finish. Part 7, the anniversary. Adding images and icons</a></li>
<li><a href="../118243/index.html">On the verge of augmented reality: what to prepare for developers (part 3 of 3)</a></li>
<li><a href="../118248/index.html">Apple has published the official position on the Consolidated.db file</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>