<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Entering passwords when building projects using gradle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When building projects for Android, Gradle allows you to specify some parameters that allow you to build and sign a package ready for download to Goog...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Entering passwords when building projects using gradle</h1><div class="post__text post__text-html js-mediator-article">  When building projects for Android, Gradle allows you to specify some parameters that allow you to build and sign a package ready for download to Google Play.  However, it is hardly worth downloading some data, such as the password of the private key to the public repository.  In the article, which is translated below, the author considers ways to enter private information, such as passwords, during project assembly. <br><br>  Gradle allows access to the console using the System.console () method.  The console provides a method for reading passwords, so you can use the following to enter a password: <br><pre><code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">password</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">System</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">console</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>.readPassword(<span class="hljs-string"><span class="hljs-string">"\nPlease enter key passphrase: "</span></span>)</code> </pre> <br>  Now you can use the password anywhere in the build script, and everything is ready ... oh, then it will be too short a post, so now let's talk about the problems. <br><a name="habracut"></a><br><br><h4>  Problem number 1 - no need to pester me all the time. </h4><br>  If you simply place this line in your build.gradle, you will notice that it runs every time you build something.  It does not matter whether you need to sign something in this build or not, the password will be requested in any case. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To solve this problem, you can use <a href="http://www.gradle.org/docs/current/javadoc/org/gradle/api/execution/TaskExecutionGraph.html">TaskGraph</a> to check if a task that needs this key is being executed.  Since the taskGraph will be filled at the beginning of the build process, you need to wait until it is filled: <br><pre> <code class="hljs rust">gradle.taskGraph.whenReady { taskGraph -&gt; <span class="hljs-comment"><span class="hljs-comment">// ,  TaskGraph . }</span></span></code> </pre><br>  Simply place this piece of code in the build script and the code inside it will be executed when the graph is ready. <br><br>  Now you need to check that we are performing a task that needs entering a password.  TaskGraph has a hasTask () method, designed to ensure that a particular task will be executed at build time.  You must specify the task name as a parameter.  Also, you must specify a colon before the root directory name.  If the task is defined in a submodule (as is usually the case in Android projects), you must also specify the name of this module.  Let there be an app module in your project and we need a key password when we perform assembleRelease.  So we can do the necessary verification: <br><pre> <code class="hljs ruby">gradle.taskGraph.whenReady { taskGraph -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(taskGraph.hasTask(<span class="hljs-string"><span class="hljs-string">':app:assembleRelease'</span></span>)) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,      <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">System</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">console</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>.readPassword(<span class="hljs-string"><span class="hljs-string">"\nPlease enter key passphrase: "</span></span>) /<span class="hljs-regexp"><span class="hljs-regexp">/ readPassword  char[],       String pass = new String(pass) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      pass } }</span></span></code> </pre><br>  Now gradle won't bother you until he needs a password. <br><br><h4>  Problem number 2 - We do not have a console. </h4><br>  If you try to execute the code given above in the IDE (for example, in Android Studio) or using <a href="https://www.timroes.de/2013/09/12/speed-up-gradle/">gradle.daemon</a> , you will not have access to the console (System.console () will return null) and the assembly will fail due to an exception.  But do not panic, this problem is solved.  If we don't have access to the console, we still have the UI.  We can use Groovy's SwngBuilder to show a simple password dialog. <br><br>  First, you need to import it, so place the following line at the beginning of your build.gradle: <br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.swing.SwingBuilder</code> </pre><br>  Now you can use SwingBuilder to show a simple input dialog: <br><pre> <code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function"> = '' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SwingBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>.edt { dialog(<span class="hljs-symbol"><span class="hljs-symbol">modal:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ,    . <span class="hljs-symbol"><span class="hljs-symbol">title:</span></span> <span class="hljs-string"><span class="hljs-string">'Enter password'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">alwaysOnTop:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">resizable:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">locationRelativeTo:</span></span> null, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     . <span class="hljs-symbol"><span class="hljs-symbol">pack:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">show:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> ) { vbox { label(<span class="hljs-symbol"><span class="hljs-symbol">text:</span></span> <span class="hljs-string"><span class="hljs-string">"Please enter key passphrase:"</span></span>) input = passwordField() button(<span class="hljs-symbol"><span class="hljs-symbol">defaultButton:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">text:</span></span> <span class="hljs-string"><span class="hljs-string">'OK'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">actionPerformed:</span></span> { pass = input.password; dispose(); }) } } }</code> </pre><br>  Add this code where you need to request a password and you will receive the password entered by the user in the pass variable. <br><br><h4>  We connect everything together. </h4><br>  Let's put it all together now.  The UI is good (ok, the one we used earlier is not very good, but you are free to modify it as you want: <a href="http://groovy.codehaus.org/Swing%2BBuilder">SwingBuilder docs</a> ), but you may sometimes need to build on a system where there is only a console and no graphical interface (like a build server) and sometimes from your IDE.  You may also want to cancel the build if the user has not entered a password.  Now your build script should look like this: <br><pre> <code class="hljs cs">gradle.taskGraph.whenReady { taskGraph -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(taskGraph.hasTask(<span class="hljs-string"><span class="hljs-string">':app:assembleRelease'</span></span>)) { def pass = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(System.console() == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SwingBuilder().edt { dialog(modal: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, title: <span class="hljs-string"><span class="hljs-string">'Enter password'</span></span>, alwaysOnTop: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, resizable: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, locationRelativeTo: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, pack: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, show: <span class="hljs-literal"><span class="hljs-literal">true</span></span> ) { vbox { label(text: <span class="hljs-string"><span class="hljs-string">"Please enter key passphrase:"</span></span>) input = passwordField() button(defaultButton: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, text: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>, actionPerformed: { pass = input.<span class="hljs-function"><span class="hljs-function">password </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }) } } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { pass = System.console().readPassword(<span class="hljs-string"><span class="hljs-string">"\nPlease enter key passphrase: "</span></span>) pass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(pass) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pass.size() &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidUserDataException(<span class="hljs-string"><span class="hljs-string">"You must enter a password to proceed."</span></span>) } <span class="hljs-comment"><span class="hljs-comment">// ----- //      pass ,  ! // ----- } }</span></span></code> </pre><br>  Feel free to dive into the groovy documentation and see how you could improve this UI. </div><p>Source: <a href="https://habr.com/ru/post/221741/">https://habr.com/ru/post/221741/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../221727/index.html">Last day of registration for the all-Ukrainian UA Web Challenge VI championship for front-end developers</a></li>
<li><a href="../221733/index.html">What is the difference between factory and provider in AngularJS (on fingers)</a></li>
<li><a href="../221735/index.html">Imagine Cup 2014, as it was or a three-year path to the final</a></li>
<li><a href="../221737/index.html">Mediabox</a></li>
<li><a href="../221739/index.html">We try native Inferno OS on Raspberry Pi</a></li>
<li><a href="../221743/index.html">Python-digest # 25. News, interesting projects, articles and interviews [April 28, 2014 - May 4, 2014]</a></li>
<li><a href="../221745/index.html">IPv6 in Cisco or the future is near (Part 1)</a></li>
<li><a href="../221751/index.html">Highscreen Zera S - a compact smartphone with a 4.5 "screen</a></li>
<li><a href="../221753/index.html">Manual molecular scanner SCiO analyzes the composition of food and drugs</a></li>
<li><a href="../221755/index.html">Unity3d Lessons from Unity 3D Student (B25-B28)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>