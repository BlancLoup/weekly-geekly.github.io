<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Counting the number of calendar events in each month of the year</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Formulation of the problem: 
 display the number of events for each month of the year. 

 Each event has two fields. 
 - start_date - start date of ev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Counting the number of calendar events in each month of the year</h1><div class="post__text post__text-html js-mediator-article">  Formulation of the problem: <br>  display the number of events for each month of the year. <br><br>  Each event has two fields. <br>  - start_date - start date of event <br>  - end_date - the end date of the event <br><br>  The structure of the table with calendar events: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">TABLE</font> `events` ( <br> `id` <font color="#0000ff">int</font> (11) unsigned <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> auto_increment, <br> `start_date` <font color="#0000ff">date</font> <font color="#0000ff">default</font> <font color="#0000ff">NULL</font> , <br> `end_date` <font color="#0000ff">date</font> <font color="#0000ff">default</font> <font color="#0000ff">NULL</font> , <br> `created` datetime <font color="#0000ff">default</font> <font color="#0000ff">NULL</font> , <br> `modified` datetime <font color="#0000ff">default</font> <font color="#0000ff">NULL</font> , <br> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> (`id`) <br> ) ENGINE=MyISAM <font color="#0000ff">DEFAULT</font> CHARSET=utf8</font> <br> <br> <a name="habracut"></a> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Expected Result: <br><table><tbody><tr><td>  <a href="https://habr.com/ru/post/106793/">January</a> </td><td>  21 </td><td>  <a href="https://habr.com/ru/post/106793/">February</a> </td><td>  34 </td><td>  <a href="https://habr.com/ru/post/106793/">March</a> </td><td>  47 </td></tr><tr><td>  <a href="https://habr.com/ru/post/106793/">May</a> </td><td>  eight </td><td>  <a href="https://habr.com/ru/post/106793/">June</a> </td><td>  12 </td><td>  <a href="https://habr.com/ru/post/106793/">July</a> </td><td>  23 </td></tr><tr><td>  <a href="https://habr.com/ru/post/106793/">August</a> </td><td>  56 </td><td>  <a href="https://habr.com/ru/post/106793/">September</a> </td><td>  eleven </td><td>  <a href="https://habr.com/ru/post/106793/">October</a> </td><td>  35 </td></tr><tr><td>  <a href="https://habr.com/ru/post/106793/">November</a> </td><td>  34 </td><td>  <a href="https://habr.com/ru/post/106793/">Desember</a> </td><td>  24 </td><td></td><td></td></tr></tbody></table><br><br>  Possible options: <br><br>  - MONTH (start_date) = MONTH (end_date), YEAR (start_date) = YEAR (end_date); <br>  The event begins and ends in the same month of one year. <br><br>  - MONTH (start_date) &lt;MONTH (end_date), YEAR (start_date) = YEAR (end_date); <br>  The event begins in one month, and ends in another month of one year. <br><br>  - MONTH (start_date) = MONTH (end_date), YEAR (start_date) &lt;YEAR (end_date); <br>  The event begins and ends in the same month but in different years (it just lasts a year). <br><br>  - MONTH (start_date) &lt;MONTH (end_date), YEAR (start_date) &lt;YEAR (end_date); <br>  The event begins and ends in different months of different years (started in December, ended in January). <br><br>  Decision: <br>  This problem can be solved in two ways: display values ‚Äã‚Äãin a row (each column is a month), or in a column (each line is a month with a number of events). <br>  Having worn out with JOINs, it was decided to output the results into a string (the unlimited duration of the event became problematic in using the JOIN).  That is, they decided to solve the problem in the "forehead", limit the events by year and check in which months the event takes place.  To check the occurrence was written MYSQL function. <br><br>  Implementation: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">DELIMITER $$ <br> <br> <font color="#0000ff">DROP</font> <font color="#0000ff">FUNCTION</font> <font color="#0000ff">IF</font> <font color="#0000ff">EXISTS</font> `isEventInMonth`$$ <br> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">FUNCTION</font> `isEventInMonth`( <br> startdate <font color="#0000ff">DATE</font> , <br> enddate <font color="#0000ff">DATE</font> , <br> _month <font color="#0000ff">INT</font> (1), <br> _year <font color="#0000ff">INT</font> (1) <br> ) <font color="#0000ff">RETURNS</font> <font color="#0000ff">INT</font> (1) <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">DECLARE</font> results <font color="#0000ff">INT</font> (1); <br> <br> <font color="#0000ff">IF</font> <font color="#0000ff">YEAR</font> (startdate) = <font color="#0000ff">YEAR</font> (enddate) <font color="#0000ff">THEN</font> <br> <font color="#0000ff">SET</font> results = <font color="#0000ff">IF</font> ( <font color="#0000ff">MONTH</font> (startdate) = _month <br> <font color="#0000ff">AND</font> <font color="#0000ff">MONTH</font> (enddate)  = _month <br> <font color="#0000ff">OR</font> <br> ( <font color="#0000ff">MONTH</font> (startdate) &lt;&gt; <font color="#0000ff">MONTH</font> (enddate) <br> <font color="#0000ff">AND</font> ( <font color="#0000ff">MONTH</font> (startdate) &lt;= _month <br> <font color="#0000ff">AND</font> <font color="#0000ff">MONTH</font> (enddate)  &gt;= _month) <br> ) <br> ,1,0); <br> ELSEIF <font color="#0000ff">YEAR</font> (startdate) = _year <font color="#0000ff">THEN</font> <br> <font color="#0000ff">SET</font> results = <font color="#0000ff">IF</font> ( <font color="#0000ff">MONTH</font> (startdate) &lt;= _month ,1,0); <br> <font color="#0000ff">ELSE</font> <br> <font color="#0000ff">SET</font> results = <font color="#0000ff">IF</font> ( <font color="#0000ff">MONTH</font> (enddate) &gt;= _month ,1,0); <br> <font color="#0000ff">END</font> <font color="#0000ff">IF</font> ; <br> <br> <font color="#0000ff">RETURN</font> results; <br> <font color="#0000ff">END</font> $$ <br> <br> DELIMITER ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  This input function receives the start date of the event, the end date of the event, month and year for which it is necessary to perform a check, and returns 0 or 1. As a result, the function checks the occurrence of the current month in the start and end intervals of the event. <br><br>  Using: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">SELECT</font> <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,1,2011)) <font color="#0000ff">AS</font> jan, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,2,2011)) <font color="#0000ff">AS</font> feb, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,3,2011)) <font color="#0000ff">AS</font> mar, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,4,2011)) <font color="#0000ff">AS</font> apr, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,5,2011)) <font color="#0000ff">AS</font> may, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,6,2011)) <font color="#0000ff">AS</font> jun, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,7,2011)) <font color="#0000ff">AS</font> jul, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,8,2011)) <font color="#0000ff">AS</font> aug, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,9,2011)) <font color="#0000ff">AS</font> sep, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,10,2011)) <font color="#0000ff">AS</font> <font color="#A31515">'oct'</font> , <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,11,2011)) <font color="#0000ff">AS</font> nov, <br> <font color="#0000ff">SUM</font> (isEventInMonth(start_date,end_date,12,2011)) <font color="#0000ff">AS</font> <font color="#A31515">'dec'</font> <br> <font color="#0000ff">FROM</font> EVENTS <font color="#0000ff">WHERE</font> <font color="#0000ff">YEAR</font> (start_date) = 2011 <font color="#0000ff">OR</font> <font color="#0000ff">YEAR</font> (end_date) = 2011</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The result will be in a row, in each column the number of events per month of a particular year. <br><br>  Summarizing: <br>  The implementation does not pretend to elegance, I think that someone will be useful in the implementation of such standard functionality as a calendar of events. <br>  Questions and improvements are welcome. <br>  Ps.  Do not look for the title and description fields in the nameplate - these are translatable fields and are not in this table. <br><br>  UPD: <br><br>  User <a href="http://xtender.habrahabr.ru/">xtender</a> offered a more correct solution to the problem. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">SELECT</font> &lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-02-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-01-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> jan,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-03-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-02-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> feb,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-04-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-03-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> mar,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-05-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-04-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> apr,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-06-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-05-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> may,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-07-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-06-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> jun,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-08-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-07-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> jul,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-09-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-08-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> aug,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-10-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-09-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> sep,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-11-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-10-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> oct,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2010-12-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-11-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> nov,&lt;br&gt; <br> <font color="#0000ff">sum</font> ( <font color="#0000ff">CASE</font> <font color="#0000ff">when</font> t.`start_date`&lt; <font color="#a31515">'2011-01-01'</font> <font color="#0000ff">and</font> t.end_date&gt;= <font color="#a31515">'2010-12-01'</font> <font color="#0000ff">then</font> 1 <font color="#0000ff">else</font> 0 <font color="#0000ff">end</font> ) <font color="#0000ff">AS</font> <font color="#0000ff">dec</font> &lt;br&gt; <br> <font color="#0000ff">FROM</font> events t</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> </div><p>Source: <a href="https://habr.com/ru/post/106793/">https://habr.com/ru/post/106793/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../106783/index.html">Report from the southern quarter finals</a></li>
<li><a href="../106784/index.html">Antec Soundscience Rockus 3D 2.1, or as a manufacturer of enclosures and power supplies, decided to deal with acoustics</a></li>
<li><a href="../106785/index.html">Google has updated the company's internal privacy policy</a></li>
<li><a href="../106786/index.html">Who do you think makes the best mobile operating system?</a></li>
<li><a href="../106791/index.html">We collect Actionscript / Flex application in Linux</a></li>
<li><a href="../106794/index.html">Drupal 7.0 Beta 2 has been released. There are only eight bugs left until RC</a></li>
<li><a href="../106795/index.html">DeaDBeeF 0.4.2 released</a></li>
<li><a href="../106799/index.html">Who am I? I am for you!</a></li>
<li><a href="../106801/index.html">Investigate CHP-7</a></li>
<li><a href="../106803/index.html">As for 20 000 r. attract the attention of visitors to the online exhibition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>