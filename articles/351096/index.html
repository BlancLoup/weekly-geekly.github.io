<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>dev || bet - the battle of programmers and technology</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dogs vs cats, drivers vs pedestrians, Coca-Cola vs Pepsi, BMW vs Mercedes, sausage vs cheese, uzvar vs juice, good vs evil, after all! But no, we, as ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>dev || bet - the battle of programmers and technology</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/post/351096/"><img src="https://habrastorage.org/getpro/habr/post_images/50b/1ae/adf/50b1aeadf4eb83ddf104d0dbbbc0734d.jpg"></a> <br><br>  Dogs vs cats, drivers vs pedestrians, Coca-Cola vs Pepsi, BMW vs Mercedes, sausage vs cheese, uzvar vs juice, good vs evil, after all!  But no, we, as always, argued about which programming language is better.  Classical arguments about performance were used along with references to benchmarks that no one checked, syntax buns that you use once a year, popularity charts, lists of authoritative programmers using a particular language ... Then the conversation went smoothly into the discussion of the Battle of Oksimiron with someone there.  Well, any conversation longer than 20 minutes comes down to discussing the price of Bitcoin. <br><br>  In a strange way, the three themes merged into one, and the idea of ‚Äã‚Äãdev || bet was born. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/bjg5UWcl_oo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  The essence of the project </h2><br>  Two developers representing different technologies solve the same problem.  The winner is the one who decides it in the shortest possible time, or gets a better result for a limited time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Three commentators are watching the process on the participants' screens.  They discuss their approach to solving, notice interesting moments, non-standard moves and just interesting pieces that any programmer has.  On the other hand, they pay attention to unsuccessful decisions and failures. <br><br>  We, the viewers, want to see how ordinary developers think, google, are wrong, and in the end, come to a decision.  Moreover, it is more interesting for us to observe the plugging of leads over the library function than the click of the algorithms by the trained Olympiad. <br><br>  For the pilot issue, we invited friends as participants, who identified the technologies used: Python vs JavaScript. <br><br><h2>  The task of the first release </h2><br>  In order for the project to be successful in 2018, its name must include a reference to cryptocurrency or blockchain.  Therefore, a little dreaming, we came up with a simple task.  The formal description that participants received was as follows: <br><br><blockquote>  Today, everyone is talking about cryptocurrency.  There have been many cases when people sold bitcoins at an incredibly low price.  Well, I once thought to buy 150 BTC for $ 15 ... <br>  But what if we had a time machine that could send crypto commands to the broker in the past?  Of course, we would have brought down the global financial system.  Nevertheless, let's imagine that we have a car, or, at least, we are close to its creation.  We want you, a dirty, hungry freelancer working for food, to create for us an algorithm that generates a sequence of commands for our broker client.  (Which we ourselves created a year ago specifically for future use, of course.) <br><br>  You can use Python or JavaScript.  Please check your solution with the included test runner.  The one whose decision will earn more money will be chosen to write a bot for a real client. <br><br><h4>  API specification v0.0.18 </h4><br>  The task runner should be a pure function that takes two arguments: <br>  <code>prices =&gt; [{"btc": 1000}, ...]</code> - Array of Bitcoin prices by day <br>  <code>initialSum =&gt; 100000</code> - Starting balance in USD <br>  The function must return an array of commands.  Commands are called in turn, one per day.  That is, for 14 days you must have exactly 14 teams. <br>  <b>Example:</b> <br> <code>[{"op":"buy","amount":1},{"op":"sell","amount":1}]</code> <br>  <b>Commands:</b> <br>  <code>"buy"</code> additional attributes: amount [float] - Buy BTC using current USD account <br>  <code>"sell"</code> additional attributes: amount [float] - Sell BTC using current USD account <br>  <code>"pass"</code> - skip day <br></blockquote><br>  The task description was intentionally made confusing and fuzzy to make the process more interesting.  However, as a result, it played a cruel joke, and greatly increased the decision time of the participants. <br><br>  Essentially, it was necessary to write a function that, according to the already known history of price changes, will issue instructions when it is worth buying bitcoins, when to sell, and when just to wait. <br><br><h2>  Implementation </h2><br>  The platform was chosen platform <a href="https://www.codewars.com/">Codewars</a> .  Not that we chose for a long time, but it had everything we needed: support for more than 20 languages, a simple interface, the ability to add a draft of a task available by reference. <br><br>  The <a href="http://codebattle.hexlet.io/">codebattle.hexlet.io</a> project, which has already been <a href="https://habrahabr.ru/company/hexlet/blog/269613/">written</a> on Habr√©, seems quite interesting.  But the ability to see the opponent's code has seemed superfluous for us. <br><br>  Since participants used Python and JavaScript, test runners were implemented on them: <br><br><div class="spoiler">  <b class="spoiler_title">Javascript</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> https = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'https'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currencies = [ <span class="hljs-string"><span class="hljs-string">'btc'</span></span>, <span class="hljs-string"><span class="hljs-string">'eth'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BASE_CURRENCY = <span class="hljs-string"><span class="hljs-string">'usd'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEFAULT_CURRENCY = <span class="hljs-string"><span class="hljs-string">'btc'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchRates = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">days, currency</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res, rej</span></span></span><span class="hljs-function">) =&gt;</span></span> { https.get(<span class="hljs-string"><span class="hljs-string">`https://min-api.cryptocompare.com/data/histoday?aggregate=1&amp;e=CCCAGG&amp;extraParams=CryptoCompare&amp;limit=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${days}</span></span></span><span class="hljs-string">&amp;tryConversion=false&amp;tsym=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${BASE_CURRENCY.toUpperCase()}</span></span></span><span class="hljs-string">&amp;fsym=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${currency.toUpperCase()}</span></span></span><span class="hljs-string">`</span></span>, (resp) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-string"><span class="hljs-string">''</span></span>; resp.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, (chunk) =&gt; { data += chunk; }); resp.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, () =&gt; { data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(data); data = data.Data; res(data.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">datum</span></span></span><span class="hljs-function"> =&gt;</span></span> datum[<span class="hljs-string"><span class="hljs-string">'close'</span></span>]).slice(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>)); }); }).on(<span class="hljs-string"><span class="hljs-string">"error"</span></span>, err =&gt; rej(err)); }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchAllRates = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (days, currencies) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prices = {}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> currencies) { prices[currency] = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetchRates(days, currency); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> len = prices[<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(prices)[<span class="hljs-number"><span class="hljs-number">0</span></span>]].length; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ret = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; len; i++) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = {}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> currencies) { price[currency] = prices[currency][i]; } ret.push(price); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> checkStash = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stash</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> vals = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.values(stash); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> val <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> vals) { Test.expect(val &gt;= -<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">-6</span></span>), <span class="hljs-string"><span class="hljs-string">'Invalid operation'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (val &lt; -<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">-6</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`Debts are not supported. Stash: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">JSON</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.stringify(stash)}</span></span></span><span class="hljs-string">`</span></span>) } } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyTask = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stash, task, prices</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'- performing task'</span></span>, stash, task, prices); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currency = task.currency || DEFAULT_CURRENCY; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(task.op) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'buy'</span></span>: stash[currency] += task.amount; stash[BASE_CURRENCY] -= task.amount * prices[currency]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'sell'</span></span>: stash[currency] -= task.amount; stash[BASE_CURRENCY] += task.amount * prices[currency]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'pass'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stash; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> runner = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (trader, cases) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> testCase <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> cases) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> prices = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetchAllRates(testCase.days, currencies); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> stash = testCase.amount; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> currencies) { stash[currency] = stash[currency] || <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Testing amount </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${stash[BASE_CURRENCY]}</span></span></span><span class="hljs-string">, days </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${testCase.days}</span></span></span><span class="hljs-string">`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tasks = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> trader(prices, stash[BASE_CURRENCY]); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tasks) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!tasks.hasOwnProperty(i)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> job = tasks[i]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> todo = job.length ? job : [job]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> todo) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> applyTask(stash, row, prices[i]); } checkStash(stash); } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(stash[BASE_CURRENCY] * <span class="hljs-number"><span class="hljs-number">100</span></span>) / <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`finished. Resulting amount: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${result}</span></span></span><span class="hljs-string">`</span></span>); } }; runner(trader, [ { <span class="hljs-attr"><span class="hljs-attr">amount</span></span>: { [BASE_CURRENCY]: <span class="hljs-number"><span class="hljs-number">100</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">days</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, }, ]);</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Python</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urllib2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math currencies = [ <span class="hljs-string"><span class="hljs-string">'btc'</span></span>, <span class="hljs-string"><span class="hljs-string">'eth'</span></span>, ] BASE_CURRENCY = <span class="hljs-string"><span class="hljs-string">'usd'</span></span> DEFAULT_CURRENCY = <span class="hljs-string"><span class="hljs-string">'btc'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch_rates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(days, currency)</span></span></span><span class="hljs-function">:</span></span> data = urllib2.urlopen( <span class="hljs-string"><span class="hljs-string">'https://min-api.cryptocompare.com/data/histoday?aggregate=1&amp;e=CCCAGG&amp;extraParams=CryptoCompare&amp;limit={}&amp;tryConversion=false&amp;tsym={}&amp;fsym={}'</span></span>.format( days, BASE_CURRENCY.upper(), currency.upper())).read() data = json.loads(data)[<span class="hljs-string"><span class="hljs-string">'Data'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [row[<span class="hljs-string"><span class="hljs-string">'close'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data][:<span class="hljs-number"><span class="hljs-number">-1</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch_all_rates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(days, currencies)</span></span></span><span class="hljs-function">:</span></span> prices = {currency: fetch_rates(days, currency) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> currencies} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [{currency: prices[currency][i] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> currencies} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(days)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_stash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stash)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> stash: test.assert_equals(stash[currency] &gt;= <span class="hljs-number"><span class="hljs-number">-0.000001</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'Invalid operation'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> stash[currency] &lt; <span class="hljs-number"><span class="hljs-number">-0.000001</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception(<span class="hljs-string"><span class="hljs-string">'Debts are not supported. Stash: {}'</span></span>.format(stash)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stash, task, prices)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'- performing task {} {} {}'</span></span>.format(stash, task, prices) currency = task[<span class="hljs-string"><span class="hljs-string">'currency'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'currency'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> task <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> DEFAULT_CURRENCY <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> task[<span class="hljs-string"><span class="hljs-string">'op'</span></span>] == <span class="hljs-string"><span class="hljs-string">'buy'</span></span>: stash[currency] += task[<span class="hljs-string"><span class="hljs-string">'amount'</span></span>] stash[BASE_CURRENCY] -= task[<span class="hljs-string"><span class="hljs-string">'amount'</span></span>] * prices[currency] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> task[<span class="hljs-string"><span class="hljs-string">'op'</span></span>] == <span class="hljs-string"><span class="hljs-string">'sell'</span></span>: stash[currency] -= task[<span class="hljs-string"><span class="hljs-string">'amount'</span></span>] stash[BASE_CURRENCY] += task[<span class="hljs-string"><span class="hljs-string">'amount'</span></span>] * prices[currency] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> task[<span class="hljs-string"><span class="hljs-string">'op'</span></span>] == <span class="hljs-string"><span class="hljs-string">'pass'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stash <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runner</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(trader, cases)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> testCase <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cases: prices = fetch_all_rates(testCase[<span class="hljs-string"><span class="hljs-string">'days'</span></span>], currencies) stash = testCase[<span class="hljs-string"><span class="hljs-string">'amount'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> currencies: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> stash: stash[currency] = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Testing amount {}, days {}'</span></span>.format(stash[BASE_CURRENCY], testCase[<span class="hljs-string"><span class="hljs-string">'days'</span></span>]) tasks = trader(prices, stash[BASE_CURRENCY]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, job <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(tasks): todo = job <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(job, list) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> [job] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> todo: stash = apply_task(stash, row, prices[i]) check_stash(stash) result = math.floor(stash[BASE_CURRENCY] * <span class="hljs-number"><span class="hljs-number">100</span></span>) / <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'finished. Resulting amount: {}'</span></span>.format(result) runner(trader, [ { <span class="hljs-string"><span class="hljs-string">"amount"</span></span>: { BASE_CURRENCY: <span class="hljs-number"><span class="hljs-number">100</span></span>, }, <span class="hljs-string"><span class="hljs-string">"days"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, } ])</code> </pre><br></div></div><br>  The task itself is available on <a href="http://www.codewars.com/kata/5a22fdffe1ce0e4c5d000031">Codewars</a> <br>  And the decisions of the participants on <a href="https://github.com/devbet/devbet_0">Github</a> <br><br>  Thanks for attention!  We are waiting for your comments, critics and opinions. <br><br>  And what next?  PHP vs.  JS, .Net vs.  Java, iOS vs.  Android, React vs.  Vue.js? </div><p>Source: <a href="https://habr.com/ru/post/351096/">https://habr.com/ru/post/351096/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351084/index.html">Google leanback - big brother care</a></li>
<li><a href="../351086/index.html">Calculation of the timing and cost of projects: how is this done and is it possible to simplify the process?</a></li>
<li><a href="../351090/index.html">Welcome to the CocoaHeads Special Event March 24</a></li>
<li><a href="../351092/index.html">Count Joseph Flavius: whom to kill first</a></li>
<li><a href="../351094/index.html">How to build a GSM phone based on SDR</a></li>
<li><a href="../351098/index.html">Apache Ignite 2.4 Release - Distributed Database and Caching Platform</a></li>
<li><a href="../351102/index.html">People do not want something really new - they want something they‚Äôve done, but they‚Äôve done differently.</a></li>
<li><a href="../351104/index.html">Test Automation and Agile</a></li>
<li><a href="../351108/index.html">Script for centralized backup of configurations of Mikrotik routers on Powershell</a></li>
<li><a href="../351112/index.html">Efficient use of memory with parallel input-output operations in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>