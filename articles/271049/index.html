<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Website Testing Automation: Pytest, Allure, Selenium + Some Secret Ingredients</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For more than a year, Acronis has a new logo, how it was created can be read here . As part of the rebranding, the site www.acronis.com has also been ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Website Testing Automation: Pytest, Allure, Selenium + Some Secret Ingredients</h1><div class="post__text post__text-html js-mediator-article">  For more than a year, <a href="http://www.acronis.com/">Acronis has a</a> new logo, how it was created can be read <a href="http://habrahabr.ru/company/acronis/blog/257807/">here</a> .  As part of the rebranding, the site <a href="http://www.acronis.com/">www.acronis.com has also been updated</a> .  To build the site, we chose CMS Drupal.  The site turned out to be cool on the outside and uneasy on the inside: 28 locales (!), Responsive web design, carousels, wizards, pop-up windows ... in the end, I had to use many different Drupal modules, some of which customize and write my own.  With such a dynamic, complex system, mistakes are inevitable.  Their prevention and detection is carried out by the team monitoring and ensuring the quality of the website.  In this article we want to share our <b>successful recipe for</b> automating the testing of our site. <br><br> <a href="http://habrahabr.ru/company/acronis/blog/271049/"><img src="https://habrastorage.org/getpro/habr/post_images/cf7/df9/776/cf7df97767d0079e9b795809e1e1fc04.png"></a> <br><a name="habracut"></a><br><h2>  <font color="#00204D">Why and why?</font> </h2><br>  Unfortunately, at the initial stage of the life of our site, the quality guard had, basically, only the possibilities of manual testing.  Given the short release cycles, regression tests had to be run often.  A large number of locales exacerbated the situation (checks were multiplied by the number of locales).  The costs of manual testing were great, and the benefits of automating the testing of the site are obvious - it was necessary to act. <br><br><h2>  <font color="#00204D">What do we want?</font> </h2><br>  So, we start to make requirements for the system of automatic testing.  We noticed that precious time is wasted on processing fairly simple defects, we wanted to minimize the number of defects inflicted in the bug tracker, but without losing such errors from our field of view.  Therefore, it was decided to entrust the work with such defects to the system of autotest reports.  Reporting was required to be very convenient, understandable, informative and enjoyable.  So that any member of our friendly web-team can look at the report, quickly understand what's wrong, and fix the defect.  Accordingly, everyone is watching: the developers fix the site, the testers fix the tests.  As a result, we have a "green traffic signal" and GO in production. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Historically, another requirement has arisen - the <a href="https://www.python.org/">Python</a> development <a href="https://www.python.org/">language</a> .  Omitting the details of the remaining wishes, we received a list of requirements for a future automated testing system: <br><br><ul><li>  Convenient, understandable, informative reporting ;. </li><li>  Parallel test run; </li><li>  Test parameterization; </li><li>  Inheritance of test data by locale; </li><li>  Testing in the environment closest to the user; </li><li>  Minimization of false positives; </li><li>  Convenient support and delivery environment for testing; </li><li>  The minimum of its own design and customization; </li><li>  Open source; </li><li>  Python. </li></ul><br><h2>  <font color="#00204D">Flour choice</font> </h2><br>  First of all, we paid attention to the <a href="http://robotframework.org/">Robot Framework</a> .  This is a popular solution that has already been mentioned in <a href="http://habrahabr.ru/company/acronis/blog/247109/">Acronis publications</a> .  Installed, began to try.  Of course, there are many advantages, but now it‚Äôs not about them.  The main contraindication for us is the work of RF with parameterized tests and the regular reporting of the results for them.  It should be noted that the absolute majority of the tests we have conceived are parameterized tests.  In the RF report, if one of the cases in the parameterized test fails, then the entire test is marked as failed.  Also, RF reporting out of the box was inconvenient for most of our guys - it took a lot of time to analyze the results of test autotests.  The peculiar ‚Äúsimple‚Äù writing of tests with the help of keywords in the case of tests proved more difficult than a difficult task.  At the same time, thanks to Habra including, we paid attention to <a href="http://allure.qatools.ru/">Allure</a> from Yandex. <br><br>  We looked, everyone liked it, everyone had a desire to work with this system, which, it should be noted, is very important.  We studied the tool, made sure that the project is actively developing, has many ready-made adapters for various popular test frameworks, including python.  Unfortunately (and perhaps fortunately) it turned out that for python there is an adapter only for the <a href="http://pytest.org/latest/">pytest</a> framework.  We looked, read, tried - it turned out to be a cool thing.  Pytest is able to do a lot of things, easy to use, extensible functionality at the expense of ready-made and own plug-ins, a large online community, well, the parameterization of tests on it is what we need!  Launched, wrote a couple of test tests, everything is fine.  Now it's up to running the tests in parallel, here the choice of solutions is small - only <a href="http://pytest.org/latest/xdist.html">pytest-xdist</a> <b>.</b>  Installed, launched and ... <br><br><h2>  <font color="#00204D">A spoon of tar</font> </h2><br>  It turned out that pytest-xdist conflicts with <a href="https://github.com/allure-framework/allure-python">Allure Pytest Adapter</a> .  Began to understand, the problem is <a href="https://github.com/allure-framework/allure-python/issues/8">known</a> , has been discussed for a long time and is not solved.  Also, a complete solution for inheriting test data by locale could not be found, <br><br><h2>  <font color="#00204D">Secret ingredients</font> </h2><br>  To get around these problems, we decide to write a tool (wrapper) in python.  This wrapper will prepare test data with regard to inheritance, pass it to tests, transfer test data to the test environment (browser, for example), and run the tests in the specified number of threads.  After completing the tests, merge the reports received in different streams into one and publish the final data on the website. <br><br>  We decided to implement parallelization quite simply, as a parallel call for each single test through the command line.  With this approach, it was necessary to implement the transfer of test data to the test independently.  Thanks to the fixtures in pytest, this is a matter of a few lines.  <b>It is important</b> !  You also need to comment out a couple of lines in (allure-python / allure / common.py) that are responsible for deleting the "old" files in the adapter's allure report directory. <br><br>  It was decided to store test data for parameterized tests in tsv files, static test data in yaml.  It was decided to determine the belonging of the test data to the test and the locale using the names and hierarchy of the directories in which these data are located.  Inheritance is carried out from the main base locale "en-us", by deleting, adding unique data.  Also in the test data it is possible to use the keyword 'skip' and 'comment' - to cancel the launch of a specific test case with an indication of the reason.  Such inheritance, for example, if it is necessary to use the same data for all site localizations, then inheritance occurs automatically without any additional parameters.  By the way, for these test configurations (environment, waiting time, etc.) they also implemented inheritance, but not on the basis of localization, but on the basis of the inheritance of the global configuration file, with test configs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2d/5b2/094/f2d5b2094bc3fad1857ec72db442e25c.png"><br><br><h2>  <font color="#00204D">Another nuance</font> </h2><br>  Receiving the first reports, they began to think about how it is more convenient to display test results in the context of locales.  We considered that it was most convenient for us to share the results according to the principle - each locale has its own copy of the allure-report.  And for aggregation of general information on locales, we quickly wrote a simple but nice wrapper. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d0/b2b/47a/2d0b2b47a610eeb744436de8dd0e9d67.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a52/34e/348/a5234e3489f358c38e9315ba5ea00ae0.png"><br><br>  The last thing that overshadowed our joy was the cases of individual launches in a test environment.  I forgot to mention that as a medium for testing, we decided to use classic <a href="http://docs.seleniumhq.org/">Selenium</a> (as an environment that is closest to real).  With a large number of checks in selenium failures can not be avoided.  As well as all the ‚Äúfavorite‚Äù false positives, they make it very difficult for continuous integration and a ‚Äúgreen traffic signal‚Äù for production. <br><br>  We thought and found a way out.  Hangs - overcame the refinement of our wrappers.  Added the ability to specify the maximum time for an individual test and, if it does not run within the specified time, we restart it roughly.  And the false positives were removed with the <a href="http://pytest.org/latest/xdist.html">pytest rerun-xfails</a> add <a href="http://pytest.org/latest/xdist.html">-</a> on.  This plugin automatically restarts all failed tests; again, we set the number of attempts in the configuration yaml file for each test or total. <br><br><h2>  <font color="#00204D">Epilogue</font> </h2><br>  And finally, here it is - the happiness of a novice automator: a stable, convenient working system.  It is easy to maintain, allows you to test as quickly as possible and without false positives, provides very convenient reporting of test results. <br><br><h2>  <font color="#00204D">PS</font> </h2><br>  Friends, on your feedbacks here at Habr√©, we would like to understand how interesting our experience is.  There is an idea to publish the resulting ready-made solution in the form of a docker-container. </div><p>Source: <a href="https://habr.com/ru/post/271049/">https://habr.com/ru/post/271049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271039/index.html">Overview of Cisco UCS Initial Setup</a></li>
<li><a href="../271041/index.html">We invite you to a meeting on web development on December 2</a></li>
<li><a href="../271043/index.html">Isilon.Next - how Big Data storage has become larger, cloudier and softer *</a></li>
<li><a href="../271045/index.html">Zotero: optimizing the storage and use of scientific literature</a></li>
<li><a href="../271047/index.html">Backups are different. Today I will tell about Acronis Backup Cloud (BaaS)</a></li>
<li><a href="../271051/index.html">Node.js in the service of an electronics developer: we create libraries of microcircuits</a></li>
<li><a href="../271053/index.html">Library of machine learning Google TensorFlow - first impressions and comparison with its own implementation</a></li>
<li><a href="../271059/index.html">Algorithms and trading on the stock exchange: Hiding large transactions and predicting the price of shares</a></li>
<li><a href="../271061/index.html">Protection of personal data in accordance with N 242-–§–ó: how to understand and what to do?</a></li>
<li><a href="../271065/index.html">A game for math. Verbal counting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>