<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CFS vs O (1) scheduler</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think many have heard that in addition to the standard O (1) scheduler on linux, CFS (Completely Fair Scheduler; ‚Äúabsolutely fair scheduler‚Äù) appear...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CFS vs O (1) scheduler</h1><div class="post__text post__text-html js-mediator-article">  I think many have heard that in addition to the standard O (1) scheduler on linux, CFS (Completely Fair Scheduler; ‚Äúabsolutely fair scheduler‚Äù) appeared, which <a href="http://en.wikipedia.org/wiki/Ingo_Molnar">Ingo Molnar is</a> working on.  Actually, I would like to devote this note to the comparison of these two planners and a brief review of their basic algorithms.  At the end of the note you can read a bit on FreeBSD's planning ULE. <br><br>  <b>preamble:</b> <br><ul><li>  <a href="http://en.wikipedia.org/wiki/O%25281%2529_scheduler">O (1) scheduler</a> - in short, the <a href="http://en.wikipedia.org/wiki/O%25281%2529_scheduler">scheduler</a> ‚Äôs policy was quite simple: each cpu had 2 queues: in one there are tasks, which will soon be launched, in the other, sleeping tasks.  when the first stage turned out to be empty, it changed places with the second, respectively, in the second stage, all the sleeping processes 'woke up', and in the first one it served as a queue for the processes that had worked and gone to sleep.  Therefore, the time of operation of the algorithm, firstly, does not depend on the class of processes, and secondly, it is always O (1). </li><li>  <a href="http://en.wikipedia.org/wiki/Completely_Fair_Scheduler">Completely Fair Scheduler</a> - for storing processes uses a <a href="http://en.wikipedia.org/wiki/Red-black_tree">red-black tree</a> , where the <i>key</i> is the <i>wait_runtime of</i> each process.  wait_runtime is the number of nanoseconds that this process failed or reworked.  those.  if it is &lt;0, then it has processed it, if it is&gt; 0, it means it has not worked.  This measure allows you to detect out-of-ballance from the 'ideal case'.  depending on the wait_runtime value, the process takes its place in the tree.  if wait_runtime &lt;0, then, I believe, the process will sit on the lower levels, if more than 0, then closer to the top.  therefore, CFS is <u>not O (1) scheduler</u> , it is O (logN). </li></ul><br><br><a name="habracut"></a>  <b>amble:</b> <br>  someone may have seen a <a href="http://www.slashdot.org/">slashdot</a> article about what the creator of bsd's ULE-scheduler, <a href="http://jeffr-tech.livejournal.com/">Jeff Roberson</a> , <a href="http://jeffr-tech.livejournal.com/12933.html">commented to</a> CFS: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <table border="2"><tbody><tr><td>  <font color="#9b9b9b"><i>Imagine that you are working with hundreds or even thousands of running threads, cache misses in the case of log n traversal can be quite expensive.</i></font>  <font color="#9b9b9b"><i>Especially because you will have much more scheduling events with so many threads.</i></font> </td></tr></tbody></table><br><br>  Indeed, extracting the next process from the tree sometimes requires rebalancing, inserting the process into the tree requires a detour of one broken line and possible rebalancing.  but this deficiency manifests itself only with a <u>very large</u> n, which is very likely to occur on desktops, but may occur at large work stations.  From here we can conclude: it‚Äôs not worthwhile to stat this planner at the loaded server / work stations and other machines designed to work with a large number of simultaneously running processes / threads. <br><br>  and this deficiency manifests itself as: <br><br><table border="2"><tbody><tr><td>  <font color="#9b9b9b"><i>Ingo said that having 1000 tasks running (task - process or thread), the system will increase the cost of <a href="http://en.wikipedia.org/wiki/Context_switching">context switching</a> ( <a href="http://en.wikipedia.org/wiki/Context_switching">context switching</a> ) by 20%.</i></font>  <font color="#9b9b9b"><i>This is a tree of 10 levels.</i></font>  <font color="#9b9b9b"><i>In the worst case, 5 more levels can be added, which will lead to a 30% increase in value.</i></font>  <font color="#9b9b9b"><i>This is not fatal, but you cannot call it good behavior either.</i></font> </td></tr></tbody></table><br><br>  The disadvantages of the O (1) scheduler include the insufficiently good, ‚Äúfair‚Äù core rebalancing.  Here is what Ingo himself says in <a href="http://lwn.net/Articles/243180/">this</a> comment: <br><br><table border="2"><tbody><tr><td>  <font color="#9b9b9b"><i>The easiest way to describe this is with a simple example: if I run glxgears on my computer, it will use exactly 50% of the CPU.</i></font>  <font color="#9b9b9b"><i>If I use the SD scheduler (aka O (1) scheduler) and run the CPU hog with glxgears on it, both tasks will share the CPU resources.</i></font>  <font color="#9b9b9b"><i>CPU hog will get ~ 60% of CPU time, and glxgears - 40%.</i></font>  <font color="#9b9b9b"><i>If I use CFS, both tasks will receive 50% of the CPU time.</i></font> </td></tr></tbody></table><br><br>  CFS really better allocates processor time and spreads tasks around the cores (tested in personal practice). <br>  Also to the pluses of CFS can be attributed significantly less response time than with O (1).  This is confirmed by tests made by Mikhail Piatrovski.  see the results <a href="http://linuxkernel.ru/%3Fq%3Dnode/463">here</a> .  Thus, CFS can be safely put on the desktop, where there is not a huge number of simultaneously running processes. <br><br>  <b>how to put CFS:</b> <br><br>  First of all, I note that CFS is available for kernels starting from version 2.6.20. <br>  You can get a patch for the kernel version&gt; = 2.6.20 <a href="http://people.redhat.com/mingo/cfs-scheduler/">here</a> . <br>  then go to the directory with linux sources and apply a patch: <br><br><table border="2"><tbody><tr><td>  <font color="#9b9b9b"><i># patch -p1 &lt;sched-cfs-v2.6.2x.1-x.patch</i></font> </td></tr></tbody></table><br><br>  A separate <a href="http://en.wikipedia.org/wiki/Git_%2528software%2529">git</a> repository has also been allocated for the development of the CFS scheduler.  pull the clone repository can be <a href="http://git.kernel.org/%3Fp%3Dlinux/kernel/git/mingo/linux-2.6-sched.git%3Ba%3Dsummary">from here</a> . <br><br>  <b>fw about ULE:</b> <br><br>  Each cpu has 3 queues indexed by priorities.  2 queues are used to implement such sheduling-classes as interrupts, rial-time and time sharing.  The last queue is used for the idle class. <br>  The queue switching policy is similar to O (1) shceduler, i.e.  when one line is empty, it is immediately replaced by another.  therefore, the switching time does not depend on the class of processes. <br>  ULE also uses flexible and efficient policies on SMP systems, according to Jeff, scattering tasks between CPUs (quoted) ‚Äúis at least as 'fair' as the 'absolutely fair scheduler'‚Äù does. <br><br>  more about ULE: <a href="http://www.hup.hu/old/stuff/freebsd/ULE.pdf">ULE.pdf</a> and <a href="http://jeffr-tech.livejournal.com/3729.html">here</a> . <br><br>  in fact, it was a trial note, so it is the first in this blog.  from here there are a few questions for those who read: would you be interested in reading more (much) detail about the implementation of CFS and whether it is worthwhile to translate any quotes inserted into the context of notes from English? <br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/13014/">https://habr.com/ru/post/13014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130130/index.html">Asterisk for the head: how to recoup the investment?</a></li>
<li><a href="../130131/index.html">Recruitment by the method of "priority folders" in the format hrbox.ru</a></li>
<li><a href="../130135/index.html">API 2GIS news: geocoding, search enhancements and many little things</a></li>
<li><a href="../130137/index.html">Compilation of videos from various conferences</a></li>
<li><a href="../130139/index.html">Monitoring company presented data on Google+ users activity</a></li>
<li><a href="../130140/index.html">UXRussia 2011 Moscow Report - An Inside Look (Part 2)</a></li>
<li><a href="../130143/index.html">Nissan developed electric vehicle charging technology in 10 minutes</a></li>
<li><a href="../130144/index.html">CUBRID Bug Bash Contest Results</a></li>
<li><a href="../130145/index.html">Learn more about developing for Windows Phone 7 at Tech ‚àô Ed Russia 2011</a></li>
<li><a href="../130148/index.html">The basics of the Contacts API in Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>