<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parsing lincrackme3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unlike Windows, Linux cannot boast a large number of different tricks against debugging. Opensource and all that played their share in this. Among deb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parsing lincrackme3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/643/bdd/8af/643bdd8af8f068d01f37eecac115ff25.gif" align="right">  Unlike Windows, Linux cannot boast a large number of different tricks against debugging.  Opensource and all that played their share in this.  Among debuggers <br>  there is gdb, but it is very easily detected by the simplest techniques of anti-debugging. <br><br>  Accordingly, there are not many known protectors capable of greatly complicating the debugging of a binary, among which one can only recall 'shiva', but it has ‚Äúdied‚Äù long ago. <br><br>  Today, the <a href="http://crackmes.de/users/adrianbn/lincrackme3/">lincrackme3</a> program with crackmes.de will serve as a <a href="http://crackmes.de/users/adrianbn/lincrackme3/">toy</a> for us, it is not difficult and at the same time, it has several anti-debugging tricks.  We will only use the disassembler - no debuggers, ltracer-s, and especially patch-binaries.  The disassembler will be IDAPro 5.5. <br><a name="habracut"></a><br>  So, load ... There are no problems with loading: the ELF specification fields are correct.  Next, it is most logical to start with searching something interesting in string or import or, in the case of small binaries, look at the assembler listing of the ‚Äúsheet‚Äù in search of information about the compiler, possible obfuscation, encryption, etc.  We will go the first way and look for imports.  So, the ptrace challenge will be interesting for us - it will lead to a defense mechanism. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br clear="all"><img width="642" height="381" src="https://habrastorage.org/getpro/habr/post_images/7e4/9f3/c5b/7e49f3c5bee7c9bfaf3164f2400f41b1.jpg"><br clear="all">  Here, the code tries to "debug itself" and if it fails (someone already does this without it, for example, a debugger), then ptace returns -1, the sign flag is raised, and ... the program ends its execution.  But that is not all.  A cross reference to the debugger string also leads here: <br><br><br clear="all"><img width="642" height="304" src="https://habrastorage.org/getpro/habr/post_images/357/350/a3f/357350a3f2b8c06d662d4dcfc8892ebf.jpg"><br clear="all">  Another trick against debugging: at runtime, the program opens the standard streams STDIN = 0, STDOUT1, STDERR = 2, and if you try to close the file descriptor, then if no one has opened it before (for example, debugger), an error will occur and the result of close (3) = - 1, in the case of the presence of a previously open file descriptor: close (3) = 0. <br><br>  So, with tricks against debugging - everything.  Further, only check serial.  Cross references to interesting "lines will lead us here: <br><br><br clear="all"><img width="632" height="277" src="https://habrastorage.org/getpro/habr/post_images/15c/718/2dd/15c7182ddcca17b756979dd111149186.jpg"><br clear="all">  IDA recognized the runtime functions and everything really becomes very simple: the sub_804862C function simply translates the ‚ÄúXXXX-XXXX-XXXX-XXXX‚Äù format password to ‚ÄúXXXXXXXXXXXXXXXX‚Äù and compares the length of the received password with 0x10 = 16. <br><br>  If the password length is 16 characters then jump here: <br><br><br clear="all"><img width="642" height="373" src="https://habrastorage.org/getpro/habr/post_images/7b7/3e2/906/7b73e2906ca21b58e036bebecd2ed6ec.jpg"><br clear="all">  In this thread, we are waiting for a password comparison with the string ‚ÄúIt's not that easy, ...‚Äù, but the result is not ‚Äúinteresting‚Äù for the program and the next step is to play against the disassembler, using the debugger (after tracing) everything would be much easier, but try trace in mind.  Pay attention to the command <b>from</b> <b>all</b> <b>loc</b> <b>_8048847</b> , which is located at <b>08048841.</b> When it is executed, the address of the command following it will be placed on <br>  "Top of the stack."  Next, we return the return address to the <b><i>eax</i></b> register, add the offset, put it back on the top of the stack, and return.  But where? <br><br>  This is where: <b>08048846</b> <b>h</b> <b>+09</b> <b>Dh</b> <b>= 080488</b> <b>E</b> <b>3</b> <b>h</b> <br><br><br clear="all"><img width="639" height="118" src="https://habrastorage.org/getpro/habr/post_images/bbc/279/271/bbc279271b5d07129a71627ecd37a6e6.jpg"><br clear="all">  Another trick: a hidden procedure call whose address is located somewhere in the depths of the stack.  The situation is complicated by the fact that the addressing is done by means of the <b><i>esp</i></b> register, the value of which changes as the program runs.  If we worked in the debugger, then finding the address of the desired procedure is a simple matter, but in this case (working only with the disassembler) it is necessary to trace all references to the stack section.  All right, we will proceed from the fact that for the program to work properly, you need to have a balanced stack.  Therefore, an interesting team immediately comes under suspicion at the beginning of the ‚Äúgreeting procedure‚Äù: <br><br><br clear="all"><img width="544" height="128" src="https://habrastorage.org/getpro/habr/post_images/08b/4f7/8ec/08b4f78ec590cfe1053ace62797c3df9.jpg"><br clear="all">  Another verification call with ptrace (). <br><br>  If everything went well with the test, then jump here: <br><br><br clear="all"><img width="642" height="535" src="https://habrastorage.org/getpro/habr/post_images/4f1/ed8/9bb/4f1ed89bb279bfeda2640e8984797761.jpg"><br clear="all">  In this cycle, a password is being converted from ASCII format to HEX, but the implementation requires only numeric values ‚Äã‚Äãamong the characters of the password.  The resulting values ‚Äã‚Äãare sequentially recorded in the "stack depth": the first four characters of the serial number are written here <b>[</b> <b>esp</b> <b>+36]</b> , <br>  the second is here <b>[</b> <b>esp</b> <b>+34]</b> , the third is <b>[</b> <b>esp</b> <b>+32]</b> , the fourth is <b>[</b> <b>esp</b> <b>+30]</b> .  Next - the most interesting verification of the password and the "desired transition. <br><br><br clear="all"><img width="642" height="519" src="https://habrastorage.org/getpro/habr/post_images/acc/53a/ec9/acc53aec949255ec68fdbe2ce02bda18.jpg"><br clear="all">  As you can see there are 5 conditional jumps per block, which can probably lead us to a message about the wrong password.  Then it is necessary, in turn, "correctly" - without jumping, to go through all the checks.  So, let's begin‚Ä¶ <br><br><br clear="all"><img width="283" height="138" src="https://habrastorage.org/getpro/habr/post_images/d0e/132/aaf/d0e132aaf99be39d230b6ff7fd0faf27.jpg"><br clear="all">  The sum of the first and second four values ‚Äã‚Äãof the password should be equal to twice the sum of the third and fourth. <br><br><br clear="all"><img width="274" height="50" src="https://habrastorage.org/getpro/habr/post_images/f3a/72d/c2c/f3a72dc2c324416538f377df29b533f3.jpg"><br clear="all">  The value of the second four is greater than the third. <br><br><br clear="all"><img width="274" height="93" src="https://habrastorage.org/getpro/habr/post_images/499/e3f/4cf/499e3f4cfe96ff09e86ee2f5eb1b4f72.jpg"><br clear="all">  The sum of the first and fourth quarters is a pair. <br><br><br clear="all"><img width="267" height="67" src="https://habrastorage.org/getpro/habr/post_images/ef0/f90/6f1/ef0f906f1ed19e9141b14a662f45d966.jpg"><br clear="all">  The value of the first four is more than 5 and less than 24. <br><br><br clear="all"><img width="278" height="64" src="https://habrastorage.org/getpro/habr/post_images/196/1d9/cda/1961d9cda446782b16e63789321c0298.jpg"><br clear="all">  And here is the last transition.  This time it is not necessary to jump.  And this is possible only under the condition that the value of the last (fourth) four is unpaired.  What, provided that the sum of the first and fourth fours is a pair, <br>  tells us that the value of the first four is also unpaired.  If all conditions are fulfilled correctly, then we will have to ‚Äúdecrypt‚Äù (dexoring) the lines informing you about the correct password and see the following picture: <br><br><br clear="all"><img width="629" height="209" src="https://habrastorage.org/getpro/habr/post_images/798/cce/035/798cce0354c0c9554a11e02f1978a695.jpg"><br clear="all">  I think writing keygen is easy. <br><br>  Thank you all for your attention. <br><br>  PS: Greets fly to Alexa Nachtigal. <br>  PPS Article published at the request of the author, Paul H. <br>  PPPS Sorry for the code in Zhipeg, I'm not guilty :-) </div><p>Source: <a href="https://habr.com/ru/post/116774/">https://habr.com/ru/post/116774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116767/index.html">Repent of your sins and be happy. Or how small usability flaws spoil the whole result.</a></li>
<li><a href="../116768/index.html">Making your Gmail Motion</a></li>
<li><a href="../116769/index.html">We protect the VPS-server based on Windows 2008 R2</a></li>
<li><a href="../116771/index.html">Mono and Windows Forms on the Nokia N900? Sure, not a problem!</a></li>
<li><a href="../116773/index.html">The Mozilla Foundation begins to educate users about how extensions slow down browser loading</a></li>
<li><a href="../116775/index.html">Mastering F #: building a colorful Mandelbrot set with navigation and integration with C #</a></li>
<li><a href="../116776/index.html">Google has become the most expensive brand of the planet.</a></li>
<li><a href="../116777/index.html">Happy webmasters!</a></li>
<li><a href="../116778/index.html">St. Petersburg Startup Weekend - business in exchange for technology</a></li>
<li><a href="../116779/index.html">Methods to attract customers for the hoster. Inside view</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>