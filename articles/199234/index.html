<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installer Testing: Automate Windows Login</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose we chose a tool that satisfies us (and here I mean not only the thing from the previous article , but also the sane tools like TFS etc), even ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installer Testing: Automate Windows Login</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/62d/f0b/bbb/62df0bbbb9586d1f8c2b4328bcfd9f72.png">  Suppose we chose a tool that satisfies us (and here I mean not only the thing from the <a href="http://habrahabr.ru/post/197586/">previous article</a> , but also the sane tools like TFS etc), even made him do some part of the work for us.  We were able to automate the installation of the product and now it seemed that happiness, it is like this, reach out and ... find that in the last stage of the installation we need to go through a system reboot.  Or maybe even later boot under a limited account \ domain \ other record.  And if you are not so lucky that your product changes msgina.dll, then ... yes, yes, I mean that we need to get under the winlogon and automate account input. <a name="habracut"></a><br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/89d/347/aa0/89d347aa09b6a86c8bee8fcb96bc7abd.jpg">  It would seem - what can stop us?  Let's create a service that starts after a reboot, which will revive the process with the necessary autotest, and he will already read from the file - under what user to boot and do all the work. <br><br><h5>  Anamnesis </h5><br>  As planned, I created a service, looked, that it can run the command <br> <code>ping localhost &gt; c:\outping.txt</code> <br>  immediately after reboot, before logging in.  I replaced the ping with my autotest, and <a href="http://coub.com/view/bx0t9no">nothing worked</a> .  Services that may start before the first login are launched on behalf of the system localsystem account and cannot be <i>interactive</i> .  This means that, while running my autotest, I did not receive a system object that describes the windows displayed on the screen, the so-called desktop.  The bottom line is that in windows there are three areas in which windows can be displayed - default (loaded after entering login / password), winlogon (displays a familiar authentication request to everyone) and invisible area for non-interactive services. <div class="spoiler">  <b class="spoiler_title">The phrase is so streamlined</b> <div class="spoiler_text">  I deliberately avoid terminology here so that the article does not grow into <a href="http://technet.microsoft.com/ru-ru/library/cc780332%2528v%3Dws.10%2529.aspx">it</a> or quoting the chapter ‚ÄúSessions, window stations, desktops and window messages‚Äù of the book by Mark Russinovich ‚ÄúSysinternals Utilities.  Admin Reference ¬ª </div></div>  Switching between these areas can be done by calling the function winapi <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms686250%2528v%3Dvs.85%2529.aspx">SetThreadDesktop</a> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0c/bcd/212/f0cbcd212ea99a8d62a60e6ca0383931.jpg"></div><br>  - Ok, - the coder thought, - All you need to do is call one winapi function, start your autotest, and compile it with a static link so that the tester does not suffer from dependencies. <br>  -Ok, the tester thought, Just now it will be necessary to check on all systems a prog to start the prog. <br>  It is impossible not to test the testing tool.  However, I didn‚Äôt follow this path - more recently, when meeting with incomprehensible things in the behavior of Windows that threaten the invention of bicycles, I began to resort to building a query for Google, starting with the last name: Russinovich.  It worked now.  <a href="http://technet.microsoft.com/ru-ru/sysinternals/bb897553.aspx">PSexec</a> will help us out. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Recipe </h5><br><ol><li>  Download <a href="http://support.microsoft.com/kb/137890/ru">srvAny</a> and install it into the test environment. </li><li>  In the Application parameter of the srvAny program, we indicate the line <code>"\\\\_psexec\\PSexec.exe /x /s /d /accepteula cmd.exe"</code> . <br>  Actually the parameter / x and ensures the launch in the winlogon working environment </li><li>  Reboot, wait for the authentication prompt, if everything is done correctly - the cmd console will loom up in the background (on windows 7 it may not loom, but you can switch to it by pressing alt + tab).  Replace cmd with your autotest (for tfs, as I understand it, you need to run a test agent with some parameters) entering login password \ testing the performance of the new msgina.  <a href="http://coub.com/view/gt48z6o">Is done.</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/199234/">https://habr.com/ru/post/199234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../199222/index.html">Where does hard drive space disappear in Mac OS X</a></li>
<li><a href="../199224/index.html">Discovered the most distant galaxy: 30 billion light years from Earth</a></li>
<li><a href="../199226/index.html">Recipe i18n. Basis - Babel, json with coffee and a grant with hbs to your taste</a></li>
<li><a href="../199228/index.html">How to import non-imported</a></li>
<li><a href="../199230/index.html">LeapMotion. What's inside?</a></li>
<li><a href="../199238/index.html">CryptoPati! - party hard!</a></li>
<li><a href="../199240/index.html">12-year-old student hacked government sites for Anonymous</a></li>
<li><a href="../199242/index.html">Optimus Popularis Keyboard Review (+ video)</a></li>
<li><a href="../199248/index.html">Andragogue Practitioner Tips: How We Learn</a></li>
<li><a href="../199252/index.html">Attention! Competition! We develop instant messenger Vkontakte for Tizen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>