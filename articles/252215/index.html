<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Full C ++ website and some couch analytics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="But why? 

 It is impolite to answer the question with a question, but: why not? Just because you can. 
 Okay, I was joking. To clarify the reason, I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Full C ++ website and some couch analytics</h1><div class="post__text post__text-html js-mediator-article"><div class="spoiler">  <b class="spoiler_title">But why?</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ef8/079/7d4/ef80797d40dfabbc83097fc9091ee5df.jpg" alt="There should be a picture of the trolley bus"><br><br>  It is impolite to answer the question with a question, but: why not?  Just because you can. <br>  Okay, I was joking.  To clarify the reason, I would like to briefly describe the story of my acquaintance with web development.  But, in order not to disturb the sequence of the narrative, I decided to put it at the end.  In general, we will deal with the reasons. <br></div></div><br>  I think many are familiar with this kind of web forums, like <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BC%25D0%25B8%25D0%25B4%25D0%25B6%25D0%25B1%25D0%25BE%25D1%2580%25D0%25B4">imageboards</a> .  Yes, yes, you understood correctly - it is with the example of imageboards that I will talk about the experience of creating a site in C ++.  What made me do such a dubious project?  Left heel.  In this case there really were no particular reasons.  I just woke up one morning and realized - I want to.  But this is all the lyrics. <br><br>  On Habr√© there are enough articles about websites on C ++: for example, using <a href="http://habrahabr.ru/post/154187/">FastCGI</a> or <a href="http://habrahabr.ru/post/219899/">CppCMS</a> .  But all of this is HelloWorlds and tutorials.  I will tell you about a complete (albeit not ideal in terms of architecture and code purity) project, I will try to highlight various subtleties. <br><a name="habracut"></a><br>  <i>Disclaimer: body methods are placed in class declarations to reduce text.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Training </h3><br>  Let's start with the tools we need.  It is worth noting immediately that I use <a href="http://doc.qt.io/">Qt</a> for my projects and even wrote a small library that extends the capabilities of this wonderful framework.  Qt and this library (called, by the way, BeQt - Beyond Qt) have been used by me this time too, but I will not dwell on them, since the article is about something else. <br><br><h4>  Web framework </h4><br>  So, first of all, of course, you need to decide which web framework to use.  The choice is small, but it is still there: <br><ul><li>  <a href="http://pocoproject.org/">Poco</a> </li><li>  <a href="http://www.tntnet.org/">Tntnet</a> </li><li>  <a href="http://www.webtoolkit.eu/wt">Wt</a> </li><li>  <a href="http://cppcms.com/wikipp/en/page/main">CppCMS</a> </li></ul><br>  About the first two I can only say that they somehow did not like me.  This does not mean that these frameworks are bad - I didn‚Äôt work with them and I don‚Äôt know. <br>  Wt I tried a couple of years ago.  I was then tempted by the architecture similar to Qt and its interesting feature: it was possible, without knowing anything about web applications and HTML, to create a hierarchy of widgets, which was then rendered to this very HTML without any templates.  At that time I was familiar with the web at the level of ‚Äúwriting an HTML page with a title'om and two paragraphs in a notebook,‚Äù that is, one might say, was not familiar at all.  However, it quickly became clear that for writing something more complicated than the notorious HelloWorld, templates are needed, and also some third-party scripts (.js) that need to be downloaded from the "left" sites.  Therefore, acquaintance with Wt very soon ended. <br>  But after a while, when I already got acquainted with the web, JavaScript, CSS, AJAX requests, then I decided to once again address the topic ‚Äúwebsite in C ++‚Äù.  Googling again, I stumbled upon CppCMS.  I liked this framework right away: documentation (albeit scant in some places) is, tutorials are (and very good, very practical examples, and not far-fetched), cross-platform is, templates are there (now I already understood that without them nowhere).  What else do you need for happiness?  I downloaded, compiled, connected to the project, checked it, I was glad. <br><br><h4>  ORM framework </h4><br>  Next comes the issue of data storage.  Qt has a <a href="http://doc.qt.io/qt-5/qtsql-module.html">QtSql</a> module, but it assumes a rather low level of abstraction - we manually write queries, manually process the results.  I also wanted an <a href="https://ru.wikipedia.org/wiki/ORM">ORM</a> solution.  I googled, apart from various shortcomings and abandoned projects, the following (I apologize if I missed some standing framework - no one is omniscient): <br><ul><li>  <a href="https://sourceforge.net/projects/litesql/">LiteSQL</a> </li><li>  <a href="http://www.qxorm.com/qxorm_en/home.html">QxOrm</a> </li><li>  <a href="http://www.codesynthesis.com/products/odb/">Odb</a> </li></ul><br>  I didn‚Äôt like LiteSQL because I didn‚Äôt find the documentation on the site, but just googled something with an XML configuration (forgive me, but I couldn‚Äôt see my XML eyes).  I rejected QxOrm by accident and stupidity: I went to the site, saw a screenshot of the graphic designer of communications and closed the page.  Already some time later, after reading the article on Habr√©, I once again decided to look at this framework, and I liked it, but you can‚Äôt undo the work.  Hurry up, as they say ... <br>  I more or less liked the ODB, although there was no documentation for the classes, but there were quite detailed examples.  In addition, ODB supports Qt types such as QString, QDateTime, and others.  It is very convenient - no need to convert back and forth.  At this framework, and chose. <br><div class="spoiler">  <b class="spoiler_title">Moment of humor</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/c48/c4d/967/c48c4d96761cebc4dc9bbc9c1a975c4e.png" alt="There should be a picture of ODB"><br></div></div><br><h4>  Syntax highlighting </h4><br>  What I don't like in most large imageboards is that there is no way to really insert the code.  Either not at all (due to the peculiarities of the markup, some characters are eaten, making the text between the text enclosed in italics or underlined), or you can, but without syntax highlighting.  Therefore, before the start of the project, I decided that I had to have such an opportunity.  I believe that this feature is useful on many IT sites. <br>  The first thing I did was google - <a href="http://hilite.me/">hilite.me</a> - an online service that allows you to turn the text transmitted in the request into HTML, containing the same text, but formatted with syntax highlighting.  To work with this site, I first wanted to use <a href="http://doc.qt.io/qt-5/qtnetwork-index.html">QtNetwork</a> , and specifically - <a href="http://doc.qt.io/qt-5/qnetworkaccessmanager.html">QNetworkAccessManager</a> .  However, since CppCMS processes requests in separate streams outside <a href="http://doc.qt.io/qt-5/qthread.html">QThread</a> , this mechanism did not work (signals and slots outside <a href="http://doc.qt.io/qt-5/qeventloop.html">QEventLoop</a> do not work, and <a href="http://doc.qt.io/qt-5/qnetworkreply.html">QNetworkReply</a> does not have a blocking API).  I had to cling to new libraries: <a href="http://curl.haxx.se/libcurl/">libcurl</a> (here, as far as I know, with no options) and <a href="http://www.curlpp.org/">cURLpp</a> - a wrapper over libcurl for C ++ (there was another option <a href="https://code.google.com/p/curlplusplus/">curlplusplus</a> , but I chose cURLpp). <br>  Here I am forced to run ahead.  At first I was glad that the backlight was working as it should, but then I began to notice that the whole thing had been working for a very long time: until it connected to the service, until it processed the request, until it sent the answer ... Well, it.  And again, I strained Google.  This is what happened this time: <a href="http://www.gnu.org/software/src-highlite/">Source-highlight</a> .  In addition to the console utility, this project also provides a library with the same functionality (the name speaks for itself).  Exactly what is needed!  (I note, however, that although the library does its work without complaints, the set of definition files for different languages ‚Äã‚Äãhad to be downloaded separately, and these files could not be loaded into memory - the library can work with them only if they are somewhere in a real file system, rather than being packed, say, into an executable file along with other resources.) <br><br><h4>  Tell me what are your magic bytes and i will tell you who you are </h4><br>  Speech on determining the type of file.  Imageboards - they are from the word image in the sense of ‚Äúpicture‚Äù, and not image, which means that they are based on the attachment of images to messages.  And not only images - the <a href="https://ru.wikipedia.org/wiki/WebM">WebM</a> format is gaining more and more popularity lately.  But who among us has not tried to do something at least once by the rules?  Sooner or later, someone would think of attaching an archive or something else instead of a picture.  Information transmitted by the client about the MIME type of the file cannot be trusted either, so you need to check its type with some independent tool.  Such as <a href="https://sourceforge.net/projects/libmagic/">libmagic</a> , for example.  But pay attention to the last update date.  Therefore, it is better to use <a href="http://www.darwinsys.com/file/">this</a> implementation - it supports more new formats, including the WebM mentioned. <br>  Of course, Magic bytes do not give any guarantees that the rest of the file contents correspond to the format, but there's nothing you can do.  Is that to hire a department of the Chinese (no offense to these trudahyag be told), which will be checked manually. <br><br><h4>  Another would connect all this ... </h4><br>  Here we are with the choice of tools and figured out.  And how to cling to the project and use?  In Qt, fortunately, there is not the worst (although very strange in itself) build system - qmake. <br>  Here is what a fragment of the project file (.pro / .pri) looks like, which is responsible for connecting libraries: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre><code class="hljs pgsql">isEmpty(BEQT_PREFIX) { mac|unix { BEQT_PREFIX=/usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/beqt } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32 { BEQT_PREFIX=$$<span class="pgsql"><span class="pgsql">(systemdrive)/PROGRA~</span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1</span></span></span><span class="pgsql">/BeQt } } </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">include</span></span></span><span class="pgsql">($$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span>{BEQT_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/beqt/depend.pri) isEmpty(CPPCMS_PREFIX) { mac|unix { CPPCMS_PREFIX=/usr } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32 { error(CppCMS <span class="hljs-type"><span class="hljs-type">path</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> specified) } } INCLUDEPATH *= $$<span class="ruby"><span class="ruby">{CPPCMS_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> DEPENDPATH *= $$</span></span>{CPPCMS_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> LIBS *= -L$$<span class="pgsql"><span class="pgsql">{CPPCMS_PREFIX}/lib/ -lcppcms -lbooster isEmpty(ODB_PREFIX) { mac|unix { ODB_PREFIX=/usr } </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">else</span></span></span><span class="pgsql">:win32 { error(ODB </span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">path</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">is</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">not</span></span></span><span class="pgsql"> specified) } } INCLUDEPATH *= $$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span>{ODB_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> DEPENDPATH *= $$<span class="ruby"><span class="ruby">{ODB_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> LIBS *= -L$$</span></span>{ODB_PREFIX}/lib/ -lodb -lodb-sqlite !isEmpty(ODB_QT_PREFIX) { INCLUDEPATH *= $$<span class="ruby"><span class="ruby">{ODB_QT_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> DEPENDPATH *= $$</span></span>{ODB_QT_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> LIBS *= -L$$<span class="ruby"><span class="ruby">{ODB_QT_PREFIX}/lib/ -lodb-qt } </span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">else</span></span></span><span class="ruby"> { LIBS *= -L$$</span></span>{ODB_PREFIX}/lib/ -lodb-qt } isEmpty(LIBCURL_PREFIX) { mac|unix { LIBCURL_PREFIX=/usr } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32 { error(libcurl <span class="hljs-type"><span class="hljs-type">path</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> specified) } } INCLUDEPATH *= $$<span class="ruby"><span class="ruby">{LIBCURL_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> DEPENDPATH *= $$</span></span>{LIBCURL_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> LIBS *= -L$$<span class="pgsql"><span class="pgsql">{LIBCURL_PREFIX}/lib/ -lcurl isEmpty(CURLPP_PREFIX) { mac|unix { CURLPP_PREFIX=/usr } </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">else</span></span></span><span class="pgsql">:win32 { error(cURLpp </span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">path</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">is</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">not</span></span></span><span class="pgsql"> specified) } } INCLUDEPATH *= $$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span>{CURLPP_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> DEPENDPATH *= $$<span class="ruby"><span class="ruby">{CURLPP_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> LIBS *= -L$$</span></span>{CURLPP_PREFIX}/lib/ -lcurlpp isEmpty(BOOST_PREFIX) { mac|unix { BOOST_PREFIX=/usr } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32 { BOOST_PREFIX=$$<span class="ruby"><span class="ruby">(systemdrive)/Boost } } INCLUDEPATH *= $$</span></span>{BOOST_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> DEPENDPATH *= $$<span class="ruby"><span class="ruby">{BOOST_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> LIBS *= -L$$</span></span>{BOOST_PREFIX}/lib/ -lboost_regex isEmpty(SRCHILITE_PREFIX) { mac|unix { SRCHILITE_PREFIX=/usr } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32 { error(GNU Source-highlight <span class="hljs-type"><span class="hljs-type">path</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> specified) } } INCLUDEPATH *= $$<span class="ruby"><span class="ruby">{SRCHILITE_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> DEPENDPATH *= $$</span></span>{SRCHILITE_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> LIBS *= -L$$<span class="pgsql"><span class="pgsql">{SRCHILITE_PREFIX}/lib/ -lsource-highlight isEmpty(LIBMAGIC_PREFIX) { mac|unix { LIBMAGIC_PREFIX=/usr } </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">else</span></span></span><span class="pgsql">:win32 { error(libmagic </span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">path</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">is</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">not</span></span></span><span class="pgsql"> specified) } } INCLUDEPATH *= $$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span>{LIBMAGIC_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> DEPENDPATH *= $$<span class="ruby"><span class="ruby">{LIBMAGIC_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> LIBS *= -L$$</span></span>{LIBMAGIC_PREFIX}/lib/ -lmagic isEmpty(SQLITE_PREFIX) { mac|unix { SQLITE_PREFIX=/usr } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32 { error(SQLite <span class="hljs-type"><span class="hljs-type">path</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> specified) } } INCLUDEPATH *= $$<span class="ruby"><span class="ruby">{SQLITE_PREFIX}/</span><span class="hljs-keyword"><span class="ruby"><span class="hljs-keyword">include</span></span></span><span class="ruby"> DEPENDPATH *= $$</span></span>{SQLITE_PREFIX}/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> LIBS *= -L$$<span class="pgsql"><span class="pgsql">{SQLITE_PREFIX}/lib/ -lsqlite3 mac|unix { isEmpty(LORD_PREFIX):LORD_PREFIX=/usr } </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">else</span></span></span><span class="pgsql">:win32 { isEmpty(LORD_PREFIX):PREFIX=$$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span>(systemdrive)/PROGRA~<span class="hljs-number"><span class="hljs-number">1</span></span>/ololord }</code> </pre> <br></div></div><br>  In addition to the libraries mentioned, you can also notice <a href="http://www.boost.org/">Boost</a> and <a href="https://sqlite.org/">SQLite</a> , which are among their dependencies.  I will not dwell on these libraries - I did not use them directly.  I‚Äôll say briefly about SQLite: I‚Äôm not the first time working with this database, and since I don‚Äôt need to host a database on a separate server, I chose it because of its simplicity. <br>  Of course, everyone chooses the tools for themselves, and the set described here is not a recommendation.  Choose what you like more (if I had the opportunity to return to the past, I would choose QxOrm instead of ODB). <br><br><h3>  For work </h3><br><h4>  Paths </h4><br>  (Russian ‚Äúpaths‚Äù and ‚Äúroutes‚Äù somehow do not sound compared to the English ‚Äúroutes‚Äù, but what to do.) In CppCMS, each request is processed by a separate ‚Äúapplication‚Äù - the heir class <a href="http://cppcms.com/cppcms_ref/latest/classcppcms_1_1application.html">cppcms :: application</a> .  Each path is defined by a regular expression that matches the handler function, for example: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> cppcms::application { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cppcms::service &amp;service)</span></span></span><span class="hljs-function"> : cppcms::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(service)</span></span></span><span class="hljs-function"> </span></span>{ dispatcher().assign(<span class="hljs-string"><span class="hljs-string">"/file/\\d+"</span></span>, &amp;MyApplication::handleFile, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); mapper().assign(<span class="hljs-string"><span class="hljs-string">"/file"</span></span>, <span class="hljs-string"><span class="hljs-string">"/file/{1}"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileNo)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   } };</span></span></code> </pre><br>  <a href="http://cppcms.com/cppcms_ref/latest/classcppcms_1_1service.html">cppcms :: service</a> is the thing that is responsible for creating new instances of cppcms :: application, we will come back to it.  In the meantime, consider two subtleties: the priority of the paths and the situation when the URL ends with a slash or not. <br>  Imageboard contains a list of boards at the address "/ [az] +" (simplified for clarity).  That is, for example, "site.com/b".  And if you type "site.com/b/"?  Will all be well?  No, don't expect anything good.  CppCMS does not automatically create alias with a slash on the end.  And rightly so.  But, nevertheless, sometimes such alias are needed, and you should not forget about them (and add them manually). <br>  Do not forget that the paths take precedence according to the order in which they are added: the earlier the path is added, the higher its priority.  Therefore, if you write this: <br><pre> <code class="cpp hljs">dispatcher().assign(<span class="hljs-string"><span class="hljs-string">"/.+"</span></span>, &amp;MyApplication::handleAnything, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); dispatcher().assign(<span class="hljs-string"><span class="hljs-string">"/page"</span></span>, &amp;MyApplication::handlePage, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  then the ‚Äúsite.com/page‚Äù page will be unavailable, since its URL matches the regular expression ‚Äú/.+‚Äù, and the handler for it is set with a higher priority.  It would be correct to assign the workers in the reverse order.  It is important to remember this moment. <br>  Now to the real example.  How is work with the paths organized by me?  First of all, let's imagine that it was necessary to add some of your own page with your URL.  Edit the source?  Dismiss.  We introduce support for plug-in factories that create a list of structures, each of which contains a regular expression, the corresponding handler function, the number of arguments (to call the desired method), and priority.  If the paths coincide with those already available by default, then the paths from the plugins overwrite them.  The full code can be viewed here (carefully, noodles): <a href="">the heir class cppcms :: application</a> , <a href="https://github.com/ololoepepe/ololord/tree/master/src/lib/route">paths</a> , <a href="">plug-in interface</a> . <br>  This is where my add-on over Qt is used, which allows automatically loading plugins of a certain type (the check is implemented using a separate interface) from several folders: system-wide and user-specific (for example, "/ usr / lib / app / plugins" and "/ home / user / .app / lib / app / plugins ").  We will not dwell on this. <br><br><h4>  cppcms :: service and configuration </h4><br>  As mentioned above, cppcms :: service is responsible for creating new instances of cppcms :: application, which already in turn process requests coming to the server.  In order for cppcms :: service to create instances of your descendant of cppcms :: application, it must be registered: <br><pre> <code class="cpp hljs">service.applications_pool().mount(cppcms::applications_factory&lt;MyApplication&gt;());</code> </pre><br>  cppcms :: service blocks the current thread and starts new threads as needed, in which instances of cppcms :: application are running.  In order not to interfere with the work of <a href="http://doc.qt.io/qt-5/qcoreapplication.html">QCoreApplication</a> (the main Qt class in console applications), I run cppcms :: service in a separate thread: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OlolordWebAppThread</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QThread { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cppcms::json::value Conf; cppcms::service *mservice; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> mshutdown; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OlolordWebAppThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cppcms::json::value &amp;conf, QObject *parent = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Conf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(conf)</span></span></span><span class="hljs-function"> </span></span>{ mshutdown = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; mservice = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shutdown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mservice) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; mshutdown = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; mservice-&gt;shutdown(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!mshutdown) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { cppcms::<span class="hljs-function"><span class="hljs-function">service </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">service</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Conf)</span></span></span></span>; mservice = &amp;service; service.applications_pool().mount(cppcms::applications_factory&lt;OlolordWebApp&gt;()); service.run(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp;e) { qDebug() &lt;&lt; e.what(); } mservice = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } };</code> </pre><br>  Notice three things: exception handling, the <i>const constant cppcms :: json :: value Conf,</i> and the <i>run</i> method.  Unlike Qt, CppCMS universally uses exceptions.  I do not like exceptions and adhere to the Qt philosophy, when instead of <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = doSomething(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Exception &amp;e) { <span class="hljs-comment"><span class="hljs-comment">//  }</span></span></code> </pre><br>  is used <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ok = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = doSomething(&amp;ok); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ok) { <span class="hljs-comment"><span class="hljs-comment">//  }</span></span></code> </pre><br>  However, do not forget about the exceptions - they are periodically thrown out in CppCMS, and they need to be intercepted and processed in time. <br>  Why is the overridden <i>run</i> method used instead of the <a href="http://qt-project.org/doc/note_revisions/5/8/view">recommended approach</a> with the worker class?  Because, if you wrap <i>cppcms :: service</i> in a <a href="http://doc.qt.io/qt-5/qobject.html">QObject</a> descendant, put this worker class in a thread and call a slot, which, in turn, will call <i>cppcms :: service :: run</i> , we get only extra wrappers: the <i>cppcms</i> method <i>: : service :: run</i> will still block <i>QEventLoop</i> , because it does not know anything about it and uses a banal <i>for (;;)</i> loop inside.  In other words, the code below will not differ in any way from the above ‚Äî you cannot use signals and slots or interrupt the thread with <i>QThread :: quit</i> , since QEventLoop will be blocked. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worker</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QObject { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: cppcms::service service; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> slots: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     service.run(); } } int main() { QThread t; Worker *w = new Worker; w-&gt;moveToThread(); t.start(); QMetaObject::invokeMethod(w, "start", Qt::QueuedConnection); }</span></span></code> </pre><br>  For a better understanding, you can read about the <a href="http://doc.qt.io/qt-5/signalsandslots.html">system of signals and slots</a> , as well as about the <a href="http://doc.qt.io/qt-5/threads-qobject.html">event loop</a> in Qt. <br>  As for <i>const cppcms :: json :: value Conf</i> , this is a representation of a JSON object, in this case containing the server configuration.  Configuration example: <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"service"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"api"</span></span>: <span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ip"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span> } }</code> </pre><br>  ‚ÄúApi‚Äù - takes the values ‚Äã‚Äã‚Äúfastcgi‚Äù, ‚Äúscgi‚Äù, or ‚Äúhttp‚Äù, indicates whether the application is independent (with its own HTTP server), or is running * CGI. <br>  "Port" and "ip" - the port and address that the application listens to.  ‚Äú0.0.0.0‚Äù means any address (in other words, the server will respond to requests from all addresses). <br>  Details - <a href="http://cppcms.com/wikipp/en/page/cppcms_1x_config">here</a> .  Although it is recommended to use * CGI, for my case this would be just an unnecessary complication. <br>  A few words about how to get <a href="http://cppcms.com/cppcms_ref/latest/classcppcms_1_1json_1_1value.html">cppcms :: json :: value</a> , say, from a file.  You need to use the <i>load</i> method, but it takes <a href="http://www.cplusplus.com/reference/istream/istream/">std :: istream</a> as a parameter, so I wrote a helper function: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="cpp hljs">cppcms::json::<span class="hljs-function"><span class="hljs-function">value </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readJsonValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp;fileName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ok)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> b = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; QString s = BDirTools::readTextFile(fileName, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, &amp;b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!b) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cppcms::json::value(); cppcms::json::value json; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">stringstream</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(toStd(s))</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (json.load(in, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bRet(ok, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, json); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bRet(ok, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, cppcms::json::value()); }</code> </pre><br>  All this is necessary in order to be able to read the settings not only from the file on disk, but also from the resources embedded in the application ( <a href="http://doc.qt.io/qt-5/resources.html">Qt Resource System</a> ). <br></div></div><br>  Now, finally, run our application: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">QCoreApplication </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">app</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(argc, argv)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  Qt cppcms::json::value conf = Tools::readJsonValue("/path/to/conf/file", &amp;ok); OlolordWebAppThread t(conf); t.start(); int ret = app.exec(); // QEventLoop t.shutdown(); //    (thread-safe),   t.wait(10 * BeQt::Second); //,       ,      return ret; }</span></span></code> </pre><br><br><h4>  Controllers and Templates </h4><br>  Here we come to the most interesting - rendering answers to requests.  I will not dwell on the less useful examples of the type <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MyApplication::main(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-comment"><span class="hljs-comment">/*url*/</span></span>) { response().out() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"&lt;html&gt;\n&lt;body&gt;\n&lt;h1&gt;Hello World&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n"</span></span>; }</code> </pre><br>  We want the site better, right?  In CppCMS, in order to render a page, two things are required - a template and a controller associated with it (I began to use the word ‚Äúcontroller‚Äù arbitrarily, but, as it seems to me, it fits here).  A template is a file with content in the form of a mixture of HTML and a special language CppCMS.  A controller is a C ++ class (or structure) containing variables and functions that the template refers to.  But fewer words, more examples: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//page.h namespace Content { struct Page : public cppcms::base_content { std::string message; std::string pageTitle; }; }</span></span></code> </pre><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- page.tmlp --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">c</span></span></span><span class="hljs-tag">++ #</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">page.h</span></span></span><span class="hljs-tag">" %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">skin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">my_skin</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">page</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uses</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content::Page</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">render</span></span></span><span class="hljs-tag">() %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pageTitle</span></span></span><span class="hljs-tag"> %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span><span class="hljs-tag"> %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">view</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">skin</span></span></span><span class="hljs-tag"> %&gt;</span></span></code> </pre><br>  Here we see the <i>Content :: Page</i> controller with the <i>message</i> and <i>pageTitle</i> variables, as well as a template called <i>page</i> using the <i>Content :: Page</i> controller.  You can also set different skins (skin), but since I haven‚Äôt dealt with them, I can‚Äôt say anything (and in general I think that it's better to control appearance through CSS, even though I don't like this technology). <br>  Note that the header file corresponding to the controller must be included with the directive <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">c</span></span></span><span class="hljs-tag">++ #</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">page.h</span></span></span><span class="hljs-tag">" %&gt;</span></span></code> </pre><br>  This directive allows you to insert arbitrary C ++ code in the place where it appears.  To insert the same value of the controller variable, use a special design <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">variableName</span></span></span><span class="hljs-tag"> %&gt;</span></span></code> </pre><br>  Line <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">render</span></span></span><span class="hljs-tag">() %&gt;</span></span></code> </pre><br>  Declares a function that can then be used in various places: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hr</span></span></span><span class="hljs-tag">() %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">render</span></span></span><span class="hljs-tag">() %&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hr</span></span></span><span class="hljs-tag">() %&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hr</span></span></span><span class="hljs-tag">() %&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag"> %&gt;</span></span></code> </pre><br>  As a result, the contents of the <i>hr</i> function will appear in all places where it was included.  Functions can contain an impressive amount of code that would otherwise have to copy-paste, which is not good.  Functions can also take parameters. <br>  Also, templates support conditional statements, a foreach loop, and some other features.  A description of all this would be enough for a separate article, so I will limit myself to a <a href="http://cppcms.com/wikipp/en/page/cppcms_1x_templates">link</a> to the documentation and a couple of comments. <br>  First, templates can be inherited from each other by redefining functions (they are always declared as virtual).  Actually, in the first example, we redefined the <i>render</i> function of the base template <a href="http://cppcms.com/cppcms_ref/latest/classcppcms_1_1base__content.html">cppcms :: base_content</a> . <br>  Secondly, not so that the remark, rather a small hint: if you need to display the value of a numeric variable in the template, increased by some number, this strange code will help (there are no other ways, as I understood it): <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">c</span></span></span><span class="hljs-tag">++ </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">() &lt;&lt; (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content.variable</span></span></span><span class="hljs-tag"> + </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span><span class="hljs-tag">); %&gt;</span></span></code> </pre><br>  I will also show how the template is rendered from the application: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MyApplication::handlePage() { Content::Page c; <span class="hljs-comment"><span class="hljs-comment">//c -   controller c.pageTitle = "My page"; c.message = "Yarrr!"; render("page", c); }</span></span></code> </pre><br>  Inside, the <i>render</i> function renders (who would be able to think) the template, gets the HTML as text and writes it in <i>response (). Out ()</i> . <br>  And finally - how to start generating templates (from the .pro / .pri file): <br><pre> <code class="hljs bash">CPPCMS_PROCESSING_COMMAND=$<span class="hljs-variable"><span class="hljs-variable">${CPPCMS_PREFIX}</span></span>/bin/cppcms_tmpl_cc mac|unix { CPPCMS_TEMPLATES=$<span class="hljs-variable"><span class="hljs-variable">$files</span></span>($<span class="hljs-variable"><span class="hljs-variable">${PWD}</span></span>/template/*) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32 { CPPCMS_TEMPLATES=$<span class="hljs-variable"><span class="hljs-variable">$files</span></span>($<span class="hljs-variable"><span class="hljs-variable">${PWD}</span></span>\\template\\*) } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(CPPCMS_TEMPLATE, CPPCMS_TEMPLATES) { CPPCMS_TEMPLATES_STRING=$<span class="hljs-variable"><span class="hljs-variable">${CPPCMS_TEMPLATES_STRING}</span></span> \<span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CPPCMS_TEMPLATE}</span></span></span><span class="hljs-string">\" } CPPCMS_PROCESSING_COMMAND=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CPPCMS_PROCESSING_COMMAND}</span></span></span><span class="hljs-string"> $</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CPPCMS_TEMPLATES_STRING}</span></span></span><span class="hljs-string"> -o \"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PWD}</span></span></span><span class="hljs-string">/compiled_templates.cpp\" win32:CPPCMS_PROCESSING_COMMAND=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$replace</span></span></span><span class="hljs-string">(CPPCMS_PROCESSING_COMMAND, "</span></span>/<span class="hljs-string"><span class="hljs-string">", "</span></span>\\<span class="hljs-string"><span class="hljs-string">") system(python $</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CPPCMS_PROCESSING_COMMAND}</span></span></span><span class="hljs-string">) SOURCES += compiled_templates.cpp</span></span></code> </pre><br>  A special utility is used, as well as a Python interpreter (version 2.x), the resulting file is included in the project.  It is assumed that the template files are in a subfolder of the <i>template</i> and have the extension .tmpl. <br><br><h4>  Storage </h4><br>  Almost any web site works with data that must somehow be placed in long-term memory (read - on disk).  Usually, relational DBMS, such as, say, MySQL or SQLite, are used for this.  It is very convenient to use a mechanism that would allow the developer to transparently turn programming language objects into database data and vice versa.  Such a mechanism is called Object-relational Mapping (ORM), and in my case its implementation is used in the form of the ODB framework. <br>  What does this look like?  For example, like this: <br><pre> <code class="cpp hljs">PRAGMA_DB(object table(<span class="hljs-string"><span class="hljs-string">"posts"</span></span>)) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: PRAGMA_DB(id <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>) quint64 id_; PRAGMA_DB(not_null) QString board_; PRAGMA_DB(not_null) quint64 number_; PRAGMA_DB(not_null) QDateTime dateTime_; QString text_; PRAGMA_DB(not_null) QLazySharedPointer&lt;Thread&gt; thread_; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// } private: friend class odb::access; };</span></span></code> </pre><br>  Here we declare a class <i>Post</i> , representing the message (or post) on the forum (or blackboard).  The fact that this object should be saved to the database and loaded from it is indicated by the string <i>PRAGMA_DB (object table ("posts"))</i> (there is also an optional parameter <i>table ("posts")</i> that explicitly specifies the name of the table, otherwise the default name would be used "Post").  The <i>PRAGMA_DB</i> macro <i>expands</i> to <i>#pragma db</i> , then its arguments are added.  The macro is used to prevent the compiler from issuing warnings when encountering the unfamiliar <i>#pragma</i> syntax. <br>  If you add the same macro over a class variable, you can tell ODB additional information about this variable - how it should be stored in the database (for example, that the variable is an identifier and the corresponding field should be declared as <i>PRIMARY KEY</i> ).  Alas, arbitrary constraints do not indicate the possibility, but I would very much like, say, to declare something like <i>UNIQUE (fieldOne, fieldTwo, fieldThree)</i> for a table, that is, to specify uniqueness for several fields, and not for one. <br>  You can use another class labeled <i>PRAGMA_DB</i> as the variable type.  Also, as you noticed, you can specify Qt classes as a variable type.  This requires the odb-qt library.  Finally, the variable whose type is wrapped in <i>QLazySharedPointer</i> is not initialized immediately upon a query to the database, but is loaded by a separate query later, if necessary (Lazy fetch). <br>  You must also declare <i>odb :: access to be a</i> friendly class. <br>  And this is how saving and loading of objects looks like (in the case of SQLite): <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { odb::database *db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> odb::sqlite::database(<span class="hljs-string"><span class="hljs-string">"/path/to/db"</span></span>, SQLITE_OPEN_READWRITE | SQLITE_OPEN_CREATE); <span class="hljs-comment"><span class="hljs-comment">//    odb::transaction t = odb::transaction(db.begin()); //  //  t-&gt;execute("PRAGMA foreign_keys=OFF"); odb::schema_catalog::create_schema(*db); t-&gt;execute("PRAGMA foreign_keys=ON"); Post p; //   db-&gt;perist(p); //    odb::result&lt;Post&gt; r(db-&gt;query&lt;Post&gt;()); //    for (odb::result_iterator&lt;Post&gt; i = r.begin(); i != r.end(); ++i) { // -    , : i-&gt;dateTime_ = QDateTime::currentDateTimeUtc(); //  db-&gt;update(*i); //   } t.commit(); //  } catch (const odb::exception &amp;e) { //  }</span></span></code> </pre><br>  In an amicable way, we still have to take care of deleting the pointer to <i>odb :: database</i> , but I did not overload the code (use a scoped pointer for this). <br>  It should be noted that the function <i>odb :: schema_catalog :: create_schema</i> does not check if there are already tables in the database, that is, it performs <i>CREATE TABLE ...</i> instead of <i>CREATE TABLE IF NOT EXISTS ...</i> , so you need to check it manually.  Naturally, about any automatic creation of the scheme and the speech does not go - all manually.  And this is another stone in the ODB garden.  However, apart from some crutches, the library copes with its task. <br>  ODB, like CppCMS, requires its own meta-compiler, which processes <i>PRAGMA_DB</i> and generates C ++ code.  It starts like this: <br><pre> <code class="hljs bash">mac|unix { ODB_PROCESSING_COMMAND=$<span class="hljs-variable"><span class="hljs-variable">${ODB_PREFIX}</span></span>/bin/odb ODB_TEMPLATES=$<span class="hljs-variable"><span class="hljs-variable">$files</span></span>($<span class="hljs-variable"><span class="hljs-variable">${PWD}</span></span>/*.h) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32 { ODB_PROCESSING_COMMAND=$<span class="hljs-variable"><span class="hljs-variable">${ODB_PREFIX}</span></span>/bin/odb.exe ODB_TEMPLATES=$<span class="hljs-variable"><span class="hljs-variable">$files</span></span>($<span class="hljs-variable"><span class="hljs-variable">${PWD}</span></span>\\*.h) } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(ODB_TEMPLATE, ODB_TEMPLATES) { ODB_TEMPLATES_STRING=$<span class="hljs-variable"><span class="hljs-variable">${ODB_TEMPLATES_STRING}</span></span> \<span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ODB_TEMPLATE}</span></span></span><span class="hljs-string">\" } ODB_PROCESSING_COMMAND=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ODB_PROCESSING_COMMAND}</span></span></span><span class="hljs-string"> -d sqlite --generate-query --generate-schema --profile qt ODB_PROCESSING_COMMAND=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ODB_PROCESSING_COMMAND}</span></span></span><span class="hljs-string"> -I \"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${QMAKE_INCDIR_QT}</span></span></span><span class="hljs-string">\" ODB_PROCESSING_COMMAND=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ODB_PROCESSING_COMMAND}</span></span></span><span class="hljs-string"> -I \"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${QMAKE_INCDIR_QT}</span></span></span><span class="hljs-string">/QtCore\" $</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ODB_TEMPLATES_STRING}</span></span></span><span class="hljs-string"> win32:ODB_PROCESSING_COMMAND=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$replace</span></span></span><span class="hljs-string">(ODB_PROCESSING_COMMAND, "</span></span>/<span class="hljs-string"><span class="hljs-string">", "</span></span>\\<span class="hljs-string"><span class="hljs-string">") system($</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ODB_PROCESSING_COMMAND}</span></span></span><span class="hljs-string">) HEADERS += $</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$files</span></span></span><span class="hljs-string">($</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PWD}</span></span></span><span class="hljs-string">/*.hxx) SOURCES += $</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$files</span></span></span><span class="hljs-string">($</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PWD}</span></span></span><span class="hljs-string">/*.cxx)</span></span></code> </pre><br>  The compiler is supplied separately from the library in the form of a binary.  At startup, you need to specify the file list, database type (in my case, SQLite), as well as the fact that the Qt profile is used and that the schema needs to be generated.  Plus, the paths to the Qt header files are indicated.  The compiler generates .hxx and .cxx files by adding the suffix "-odb" to the original names. <br>  Now a few words about my project.  Since ODB requires an active transaction for any operation, I decided to wrap the <i>odb :: database</i> and <i>odb :: transaction bundle</i> into a single <i>Transaction</i> class, which stores a pointer to the currently active transaction and its corresponding database connection.  At the same time in each thread there can be no more than one active transaction.  When creating an instance of a wrapper class ( <i>Transaction</i> ), if there is no transaction yet, a new connection is created and the transaction begins, if the active transaction already exists, the internal counter is incremented.  When a <i>Transaction is</i> destroyed, the real <i>odb :: transaction</i> will not be completed until the counter is reset.  That is, until we reach the bottom of the stack, where the first <i>Transaction</i> instance is located, we will be inside the same transaction referring to the same connection to the database.  Very comfortably.  Sources here: <a href="">1</a> , <a href="">2</a> .  Examples of use: <a href="">1</a> , <a href="">2</a> . <br><div class="spoiler">  <b class="spoiler_title">For lazy trimmed example under spoiler</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createPost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CreateThreadParameters &amp;p, QSharedPointer&lt;Thread&gt; thread)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Transaction t; <span class="hljs-comment"><span class="hljs-comment">//     Post post(p, thread); t-&gt;persist(post); t.commit(); return true; } catch (const odb::exception &amp;e) { qDebug() &lt;&lt; e.what(); return false; } } bool createThread(CreateThreadParameters &amp;p) { try { Transaction t; //     QSharedPointer&lt;Thread&gt; thread(new Thread(p)); t-&gt;persist(thread); if (!createPost(p, thread)) return bfalse; t.commit(); return true; } catch (const odb::exception &amp;e) { qDebug() &lt;&lt; e.what(); return false; } }</span></span></code> </pre><br>  Both <i>Thread</i> objects refer to the same transaction and the same connection to the database. <br></div></div><br><br><h4>  Syntax highlighting and file type checking </h4><br>  There are no special comments here, I‚Äôll just give the code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mimeType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QByteArray &amp;data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ok)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bRet(ok, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, QString()); <span class="hljs-keyword"><span class="hljs-keyword">magic_t</span></span> magicMimePredictor; magicMimePredictor = magic_open(MAGIC_MIME_TYPE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!magicMimePredictor) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bRet(ok, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, QString()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (magic_load(magicMimePredictor, <span class="hljs-number"><span class="hljs-number">0</span></span>)) { magic_close(magicMimePredictor); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bRet(ok, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, QString()); } QString result = QString::fromLatin1(magic_buffer(magicMimePredictor, (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *) data.data(), data.size())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bRet(ok, !result.isEmpty(), result); } <span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">highlight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp;code, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp;lang)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">istringstream</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tools::toStd(code))</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">ostringstream</span></span> out; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { srchilite::<span class="hljs-function"><span class="hljs-function">SourceHighlight </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sourceHighlight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"html.outlang"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; sourceHighlight.setDataDir(<span class="hljs-string"><span class="hljs-string">"/path/to/definition/files"</span></span>); sourceHighlight.highlight(in, out, lang.toLatin1().data() + <span class="hljs-string"><span class="hljs-string">".lang"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> srchilite::ParserException &amp;e) { qDebug() &lt;&lt; e.what(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> srchilite::IOException &amp;e) { qDebug() &lt;&lt; e.what(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception &amp;e) { qDebug() &lt;&lt; e.what(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> + QString::fromLocal8Bit(out.str()); }</code> </pre><br>  When defining a file type, just a little is played with the type of pointers; when syntax highlighting, we indicate the path to the folder with the syntax definition files and the source language. <br><br>  I would like to tell you a lot more, for example, how I implemented support for different types of captcha and attaching more than one file, processing static content, saving files, caching ... the list goes on.  But, I am afraid, in the framework of one article I will not be able to do this, alas for me.  If it is interesting to someone, then I will definitely tell about all of the above and a lot about what else in the following sections. <br><br>  And now - the promised sofa analyst.  First, I confess, I succumbed to the general opinion that C ++ is not suitable for the web.  At the same time, I did not particularly wonder why.  If everyone says so, then probably it is.  It was a few years ago when I had no idea what JavaScrpt was for, what AJAX is and why I should use CSS. <br>  But as time went on, I poked <a href="https://www.djangoproject.com/">Django</a> , <a href="http://rubyonrails.org/">Ruby on Rails</a> , worked for some time with Java, creating one major website, gained experience, learned new technologies.  And I realized that, in fact, whatever language was used in the backend, the front end would still be the same HTML, CSS and JavaScript.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anyway, you need to write page templates, create styles, program more complex behavior on JS. And all this has nothing to do with the backend. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is there a difference between, say, </font></font><a href="http://www.thymeleaf.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thymeleaf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Java) and CppCMS when working with templates? Not too much. All the same template language, only the syntax is slightly different. Everything is rendered the same way, by calling the render function from the code. And there are controllers there and there, no matter what they are called. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And data storage? How is ODB </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fundamentally</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> different from </font></font><a href="http://hibernate.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Yes, opportunities are more modest in places, but does this mean that ODB is not suitable for ORM at all?</font></font> I do not think so. <br>  Well, and so on. <a href="http://en.wikipedia.org/wiki/Front_and_back_ends"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The frontend</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> remains a front-end; in backend, we do the same in any language. So does it make a difference? It turns out that no. In Java or Python, working with a database will not be something fundamentally different from working with a database in C ++, the same goes for what is called ‚Äúbusiness logic‚Äù, that is, the main logic of the application. All the same checks, conditional operators, class / function hierarchy, only the syntax of each language is different. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It will not work, using Python, to get rid of the need to write JS AJAX requests, or to stop accessing the database. There are no such miracles. Someone might say that working with a database on% name_name% is easier than in C ++, and will be partly right, but only partially: miracles, I repeat, do not happen if you need to get an object from the base, you need to write something like</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object o = db-&gt; query ("..."); </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- in any language. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That is, it turns out that the answer to the question ‚ÄúBut why?‚Äù Remains the same: ‚ÄúAnd why not?‚Äù, Only its meaning changes. </font><font style="vertical-align: inherit;">These are my observations based on personal experience of writing web applications in various languages ‚Äã‚Äã(C ++, Java, to a lesser extent - Python, Ruby). </font><font style="vertical-align: inherit;">And this is not a call for a holivar, but a desire to resolve it in the most peaceful way. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Behind this I take my leave, and leave the link to the source code of the project: </font></font><a href="https://github.com/ololoepepe/ololord"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/ololoepepe/ololord</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Well, of course, I invite you to the discussion. </font><font style="vertical-align: inherit;">Did you write web apps in C ++? </font><font style="vertical-align: inherit;">Have you heard a reasoned reason why this is bad? </font><font style="vertical-align: inherit;">Share your experience.</font></font></div><p>Source: <a href="https://habr.com/ru/post/252215/">https://habr.com/ru/post/252215/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252199/index.html">Zend Certification. Not so devil</a></li>
<li><a href="../252201/index.html">Monitoring for the poor or SAR + MySQL + Gnuplot</a></li>
<li><a href="../252209/index.html">Simple do-it-yourself cooling pad for laptop</a></li>
<li><a href="../252211/index.html">Galvanization of a corpse: how was it possible to revive a beaten HDD to store anything unnecessary</a></li>
<li><a href="../252213/index.html">The Seventh Annual Microsoft Research Summer School in Machine Learning and Intelligence - Cooperation with ACM Europe</a></li>
<li><a href="../252217/index.html">Air Native Extensions (ANE) Development for OS X</a></li>
<li><a href="../252219/index.html">Browsers from Russian IT companies: an unbiased review attempt</a></li>
<li><a href="../252221/index.html">Cloudmouse closes</a></li>
<li><a href="../252223/index.html">Complete energy autonomy or how to survive with solar panels in the outback (part 2.5. Practical)</a></li>
<li><a href="../252227/index.html">Site security audit - identifying risks and threats</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>