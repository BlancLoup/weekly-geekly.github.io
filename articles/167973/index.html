<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Artificial Intelligence. Simulate a rescue operation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps the headline is too flashy, the muse on the headlines left me. And, yes, there will be no Japanese robots and a plot of films where these same...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Artificial Intelligence. Simulate a rescue operation</h1><div class="post__text post__text-html js-mediator-article">  <i>Perhaps the headline is too flashy, the muse on the headlines left me.</i>  And, yes, there will be no Japanese robots and a plot of films where these same robots take over the world.  But there will be artificial intelligence (AI), since AI can be considered present if an evaluation function is used when making a decision.  And it will be in our pathfinding algorithm.  And yes, it will be a simulation of a rescue operation, it will be that the rescue team needs to go around all the buildings (all the rooms), find people there (who, according to the author, cannot escape themselves) and take them out of the building.  Everything will be implemented on JavaScipt, Canvas, and some PHP for working with the database.  I thought at first to make an article in the style of <a href="http://habrahabr.ru/post/167007/">my last</a> , that is, we are discussing exactly JavaScript, <b>but I don‚Äôt want to repeat it</b> , so here we‚Äôll most likely go over the architecture of the program itself (yes, I‚Äôll tell you if someone can really wait for the second part of the snake, it is I will not say anything new about this in the comments).  <i>With bureaucracy, it seems, everything, let's get started.</i> <br><a name="habracut"></a><br><h4>  Some theory </h4><br>  What do we need to do?  We will have a graph, that is, all the control points of the building, on which our people will run.  It will look like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/aa6/6ad/388/aa66ad3885f135389228797344a80424.jpg" alt="image"><br><br>  <i>By the way the building is real, this is the layout of one of the buildings of my uni.</i>  Okay, we have a graph for which to run.  What has not just run, and the shortest paths.  This is where our AI comes in.  <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%2594%25D0%25B5%25D0%25B9%25D0%25BA%25D1%2581%25D1%2582%25D1%2580%25D1%258B">Dijkstra‚Äôs algorithm</a> will be used to find the shortest path <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%2594%25D0%25B5%25D0%25B9%25D0%25BA%25D1%2581%25D1%2582%25D1%2580%25D1%258B">.</a>  On Habr√© about him a lot of articles, and even a few implementations that I have simplified a lot of work.  The algorithm is taken out separately, the input will be the graph and the initial vertex - the set of paths to all the other vertices will return.  One way is an array of points along which rescuers will run.  As we see, we have four exits, that is, it is logical that rescuers will lead people to the nearest exit.  <i>With theory everything.</i>  <i>Let's start to practice.</i> <br><br><h4>  Implementation </h4><br>  Here we have a <s>link</s> , but first a couple of words about the interface: <br>  - you can change the number of rescuers <br>  - you can add people (as you like) to the rooms (just click on the room) <br>  - you can display a graph and vertices (for which you can drag_end_dropit) <br>  - we start by the button with the corresponding name <br>  who read the instructions <a href="http://lyashenko-inc.in.ua/projects/logproj_upload/www/">click here</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see, I have a lot of buttons up there (which I commented <s>so that no one gets anything wrong</s> ).  They are there to build the graph itself.  that is, we click on the stage, add a vertex, then connect vertices into edges, then expose the room graph (they will turn green), exits (dark cherry), we can change the vertex position along the way, dragging it when the graph is ready - click save to base.  Then, during initialization, the plate of points and the plate of edges are counted and a graph is constructed. <br>  The points were built by means of html, but you could make them using the same <a href="https://github.com/theshock/libcanvas/">LibCanvas</a> framework <a href="https://github.com/theshock/libcanvas/">,</a> for example, and also draw them on the canvas, it would probably be a better solution.  But it was done the way it was originally not just a point, and there, on clicking on it, a menu of settings fell out, which changed its type, added a person, etc.  But the result was redone differently.  And since it was done on the last night, <s>as always, there was no</s> time to change. <br>  We will have the class of this point, which will store the coordinates and whatnot.  There will be a lot of points and it‚Äôs convenient to work with these all. <br><div class="spoiler">  <b class="spoiler_title">We look code</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PointGR</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = PointGR.setId(); PointGR.statArr.push(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } PointGR.statArr = []; PointGR.getPointGRById = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = PointGR.statArr.length; i--;) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PointGR.statArr[i].id == _id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PointGR.statArr[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } PointGR.idPoint = <span class="hljs-number"><span class="hljs-number">0</span></span>; PointGR.setId = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PointGR.idPoint++; }</code> </pre> <br></div></div><blockquote>  These are the first lines that I write in all classes whose objects will fill in arrays (that is, there will be many). <br>  1. We put a unique identifier.  This is done (logically) through a static field. <br>  2. In the constructor, add each newly created object to the static array. <br>  3. We write the function to which we pass the identifier and it, by scanning the array, returns the object we need.  The function is also static (it is possible and not, that is, to cling to the class prototype, but, as practice shows, static is more convenient) <br></blockquote><br>  <i>So ... the muse of tips on javascript is also gone, following the muse by headlines.</i> <br>  Although no, it seems still here.  You can still say about optimization.  Initially, everything was on the same canvas and each frame was redrawn.  But when viewing the CPU load while displaying the graph, logical conclusions were made and changes were made. <blockquote>  We take out all static elements on a separate canvas.  What I did.  The graph is drawn separately from the running man.  With that one time.  When we start dragging over the vertices, the redrawing is turned on as soon as we stop - the last time is redrawn and stops. </blockquote><br>  On a large number of people (and these are all objects of classes, and by the way they are still physical bodies (on the same engine that they wrote recently), but in this case with the collision turned off), of course, lags are noticeable, unfortunately. <br>  Here, I kind of scored all the rooms with people. <br><img src="https://habrastorage.org/getpro/habr/post_images/0df/392/b40/0df392b409a0a89276256ebf473aef35.jpg" alt="image"><br><br>  Almost 1800 objects, each of which is animated. <br><img src="https://habrastorage.org/getpro/habr/post_images/3c2/956/a12/3c2956a12f12f1e868566909977181f2.jpg" alt="image"><br><br>  Everything else on the code seems to be obvious and not difficult.  <i>With the code all.</i>  <i>We proceed to the section "How it works."</i>  <s>("on fingers")</s> <br><br><h4>  Section "How it works" </h4><br><ul><li>  1. None of the rescuers know where people are, they run around the rooms, and see if there are people there, if there are people leading them to the exit. </li><li>  2. Starting from the entrance to the building, each rescuer is given the path to run, that is, at the ‚Äúzero‚Äù point, the shortest paths from this point to the rooms are searched (more precisely, to all points, this is how the AI ‚Äã‚Äãalgorithm works, but we take only those that end with a dot ‚Äúroom‚Äù).  That is, we take the first path, give it to the first rescuer, and so on to all.  As soon as the path to the final ‚Äúroom‚Äù was assigned to someone, it drops out of the list ‚Äúwhere you need to go in and see if there are any people there‚Äù. </li><li>  3. When the rescuer ran into the room, the point of the room is checked with the person‚Äôs point inside (or close) to that room.  That is, when we arrange people at the beginning, each person is attached to some point-room (by simply searching for the closest one) </li><li>  4. Okay, come running, there are people, takes all people into an array of their ‚Äúchild‚Äù elements, and recalculates, again the AI ‚Äã‚Äãalgorithm, the path to the exits, takes the shortest of all.  Runs to him, pulling people along.  Leaves all people there (at the exit).  By the way, someone can learn this <a href="http://lyashenko-inc.in.ua/projects/snake/">snake</a> , but this is it, the same technique. </li><li>  5. Looks to see if there are still untested rooms (the rescuers, according to legend, communicate with each other, therefore they know which rooms have not been visited yet), if they stayed, again, from the current point, there is the shortest path to the rooms.  If there are no more rooms, it remains at the exit. </li><li>  6. If there were no people in the 4th point - if there are any rooms that have not been checked, if there are, then the paths are recalculated, runs to them, if there are no more rooms, point 5. </li><li>  7. Everything ends when all the rescuers leave the building. </li></ul><br>  <i>Everybody is here.</i>  <i>Go to the section "A little more about anything"</i> <br><br>  A little more about anything (no, there will be no title) <br><br>  I repeat, so as not to scroll up: A few words about the interface: <br>  - you can change the number of rescuers <br>  - you can add people (as you like) to the rooms (just click on the room) <br>  - you can display a graph and vertices (for which you can drag_end_dropit) <br>  - we start by the button with the corresponding name <br>  To try <a href="http://lyashenko-inc.in.ua/projects/logproj_upload/www/">click here</a> . <br>  Files can be taken <a href="">by clicking here</a> . <br><br>  <i>PS It was done on the last night before the change <s>as always</s> (logic programming course), so the stylization of the code is not <s>well, in</s> some places <s>I think, many people have such code when written in the rhythm of the ‚Äúsession‚Äù</s></i> <i><br><br></i>  <i>PPS Originally planned two-story buildings, and fire.</i>  <i>The operation was limited in time (until everything burned down) and at the end people had to jump from the windows.</i>  <i>But at the request of the teacher, it was excluded from the task (to jump from the windows).</i>  <i>And the meaning of the two floors disappeared.</i>  <i>But buttons of explosions of an exit were made (he caught fire), and rescuers "excluded" him from possible exits and looked for the following.</i>  <i>But since he did not have time to debug (once out of four they just ran into the fire) this was excluded from the "final" version.</i> </div><p>Source: <a href="https://habr.com/ru/post/167973/">https://habr.com/ru/post/167973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167961/index.html">"Clean Internet" in the Kostroma region will be only with the consent of users</a></li>
<li><a href="../167965/index.html">Integration of 1C and B2B systems using HTTPS</a></li>
<li><a href="../167967/index.html">How not to become a defendant under article 128.1 of the Criminal Code of the Russian Federation ‚ÄúSlander‚Äù for repost</a></li>
<li><a href="../167969/index.html">Thoughts on the perfect HTPC</a></li>
<li><a href="../167971/index.html">High performance Google Chrome</a></li>
<li><a href="../167975/index.html">The digest of interesting news and materials from the world of IT for the last week ‚Ññ42 (January 26 - February 1, 2013)</a></li>
<li><a href="../167977/index.html">Google has laid out the Grand Canyon panoramas</a></li>
<li><a href="../167979/index.html">NASA is testing a robot digger for exploring the moon</a></li>
<li><a href="../167981/index.html">Objective-C as the first programming language</a></li>
<li><a href="../167983/index.html">Scrum evaluation network for planning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>