<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple MVC model implementation with template hierarchy support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article shows an example of the implementation of the MVC model using PHP. The proposed implementation is extremely simple both for understanding...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple MVC model implementation with template hierarchy support</h1><div class="post__text post__text-html js-mediator-article">  This article shows an example of the implementation of the MVC model using PHP.  The proposed implementation is extremely simple both for understanding and for execution.  Useful features are easy extensibility and support for a hierarchy of patterns.  All this allows us to put it in the basis of a fairly complex web project. <br><a name="habracut"></a><br><h5>  A little bit about MVC </h5><br>  The MVC development pattern has been discussed many times and it is unlikely to describe it in detail.  For familiarization with the subject you can read: <br><br><ul><li>  <a href="http://habrahabr.ru/post/150267/">MVC pattern implementation using the example of creating a business card site in PHP</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/Model-View-Controller">Wikipedia article</a> </li></ul><br><br>  Therefore, we only briefly mention the key components of this system: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>Controller (controller)</b> - The most important component of the system.  It is the set of controllers and the commands they process (actions) that determine what kind of functionality the system will have.  The controller is the first element in the implementation of the business logic of the application and should determine what happened in the system and how to respond to it.  In particular, the controller determines which representation (View) is needed to display the state of the system and how (Model) this data should be obtained.  However, the controller, as a good commander, should not delve into how his subordinates will perform the task.  His job is to choose performers and give them orders.  It is important to bear in mind that even within the framework of processing one command, the controller is not tied to one view and one model.  On the contrary, he can choose silt on the fly.  For illustration, consider the following example: user authorization (pseudocode): <br><pre> &lt;code&gt;
 userController-&gt; actionAuth ($ login, $ pass)
 {
 $ model = new userModel ();
 if ($ model-&gt; authorize ($ login, $ pass) {
 $ view = "authok";
 }
 else {
 $ view = "authfailure";
 }
 processView ($ view);
 }
 &lt;/ code&gt;
</pre><br>  In this case, the controller has no idea how exactly the model performs the authorization.  Working with data is purely model tasks.  The model only informs the controller whether processing was successful or not.  Depending on this, the controller decides which page to display to the user. <br></li><li>  <b>View (View)</b> - Responsible for presenting data to the user.  Submission has no idea (sorry for the pun) about how to obtain the data that he needs.  It knows only where this data can be taken from and how to present it to the user.  As a rule, the main source of data for presentation is a model.  However, as we will see later - the model is not always able to provide data in full.  It is important that several views can interact with the same model.  As shown in the example, both the ‚Äúauthok‚Äù view and the ‚Äúauthfailure‚Äù view will use data from the same $ model. <br></li><li>  <b>Model (model)</b> - A very important component, but somewhat reminiscent of a scattered scientist who is able with the same interest to solve the problems of immortality and the destruction of all life.  In other words, the model should be able to collect the necessary data or process incoming data.  This is her horse.  However, the model usually has no idea about the context in which it was called, in response to which command, what is happening in the system as a whole.  Moreover, the model cannot assume whether the system will need additional data to process the command or not.  Obviously, to collect all possible data for "just in case" no model is able to. <br></li></ul><br><br>  Attempting to collect all the data in one view can lead to multiple code duplication.  For example, user profile data of a certain site may be needed for a variety of tasks (from editing a user‚Äôs profile to specifying a link to the author of the published material. If each model requests such data on its own, complexity and duplication of code will increase exponentially. <br>  If the submission is able to request data in chunks, defining each time who can provide this data, the programmer‚Äôs life will be easy and cloudless, since it will be possible to concentrate on solving a separate task, without having to keep the whole project in mind.  However, this implies the need for organizing hierarchical processing of views.  If we can from another place of the template request the data of another controller and get a ready-made fragment of the output code (for example, already formatted html), it will become easier.  However, for this we will at some point need to suspend the processing of the current thread and transfer control to another handler.  The problem is that PHP copes with this task, to put it mildly, not brilliantly.  The data passes through the interpreter only once and constructions like <code>echo('&lt;?php echo($msg'); ?&gt;');</code>  will not work.  An internal appeal to the interpreter will not work. <br><br>  In part, the problem of block building output helps solve template engines.  There are a lot of them, different in capabilities and convenience of work.  However, they have one common flaw - they are an add-on to PHP and introduce their own markup language that needs to be learned.  At the same time, such functionality within the framework of PHP is obviously redundant, since this language in itself provides quite good possibilities for working with templates.  I think everyone had to write constructions like: <br><pre> &lt;code&gt;
 &lt;html&gt;
 ...
 &lt;? php echo ($ msg);  ?&gt; <font></font>
<font></font>
 or more complex<font></font>
<font></font>
 &lt;table&gt;
 &lt;?  php foreach ($ array as $ val) {?&gt;
 &lt;tr&gt; &lt;td&gt; $ val &lt;/ td&gt; &lt;/ tr&gt;
 &lt;?}?&gt;
 &lt;/ table&gt;
 &lt;/ code&gt;
</pre><br>  In such constructions, PHP features as a template engine are used.  By the way, designers to such inserts are without fear. <br>  Now let's get to the practical part, and see how within the page template you can implement the insertion of a whole block, which in turn can be composed of a whole set of sub-blocks.  This can be implemented in pure PHP, without using an additional markup language. <br><br><h5>  Practice </h5><br>  We will consider a simplified version of the system, in which such moments as the work with CNC (human-understandable URL) and the settings of the .htaccess file are omitted to ensure a single point of entry into the system.  These questions are widely covered in the network and there is no point in repeating.  Also, we will not consider the issues of diligent folding of the system components by catalogs, as this is essentially a personal matter for everyone.  Focus on solving the problem of nesting patterns. <br>  The system itself in action can be seen <a href="http://www.fotogenius.ru/templateengine/test.html">here.</a> <br><br>  The main component of the system and the main entry point is the application.php file: <br><pre> &lt;code&gt;
 &lt;? php<font></font>
<font></font>
<font></font>
	 class webApplication
	 {
		 protected $ dataBuf;<font></font>
		<font></font>
		 protected static $ _classInstance;
		 protected $ defaultHandler;
		 protected $ sefRequestParams;  // To support SEF technology<font></font>
		<font></font>
		 private function __construct ()
		 {
			 $ this-&gt; dataBuf = "";
			 $ this-&gt; defaultController = "mainpage";
			 $ currentURL = $ _SERVER ['REQUEST_URI'];
			 $ this-&gt; sefRequestParams = explode ("/", $ currentURL);<font></font>
			<font></font>
			 // It could be a good idea.
		 }<font></font>
		<font></font>
		 private function __clone ()
		 {
    	 }<font></font>
    	<font></font>
    	 public function getSEFParams () // sef params app
    	 {
    		 return $ this-&gt; sefRequestParams;
    	 }<font></font>
    	<font></font>
		 public static function getApp ()		
		 {
        	 if (null === self :: $ _ classInstance) 
            	 self :: $ _ classInstance = new self ();<font></font>
<font></font>
        	 return self :: $ _ classInstance;
         }<font></font>
		<font></font>
		 public function handle ($ controller, $ action)
		 {
			 if (! isset ($ controller) || $ controller == "")
				 $ controller = $ this-&gt; defaultController;
			 $ val = $ controller. '. php';
			 $ res = require_once ($ val);
			 if ($ res! = 1)
			 {
				 echo ("requested controller not found!");
				 return 0;
			 }
			 $ controlClass = new $ controller ();
			 if ($ controlClass == NULL)
			 {
				 echo ("Controller initialization error!");
				 return 0;
			 }
			 ob_start ();
			 $ controlClass-&gt; dispatchAction ($ action, &amp; $ this);
			 $ this-&gt; dataBuf = ob_get_contents ();
			 ob_end_clean ();
			 echo ($ this-&gt; dataBuf);
			 return 1;
		 }<font></font>
		<font></font>
		 public function handleHttp ()
		 {
			 $ controller = $ _ REQUEST ['controller'];
			 $ action = "";
			 if (! isset ($ controller) || $ controller == "") // Assume we're using SEF technics
			 {
				 $ controller = $ this-&gt; sefRequestParams [0];
				 $ action = $ this-&gt; sefRequestParams [1];
			 }
			 else
			 {
				 $ action = $ _ REQUEST ['action'];
			 }
			 return $ this-&gt; handle ($ controller, $ action);
		 }
	 }<font></font>
	<font></font>
	 $ app = webApplication :: getApp ();
	 $ app-&gt; HandleHttp ();
 ?&gt;<font></font>
<font></font>
 &lt;/ code&gt;
</pre><br>  The webApplication class is the base entry point to the system.  As can be seen from the presented code, this class implements the <a href="http://ru.wikipedia.org/wiki/Singleton">Singleton</a> pattern.  As part of the system, we always have an instance of this class, and there is always only one.  This property makes it extremely convenient for storing all global system data.  In this case, the import of system settings and their use are omitted, as they are easy to implement independently, depending on their needs. <br><br>  The key function of the class is the handle ($ controller, $ action) method.  This function accepts the name of the controller (the first parameter) and the name of the action (action) to be executed.  In accordance with the practice of good programming, we assume that the name of the controller class coincides with the name of the file in which it is stored.  Of course, if desired, the string $ val = $ controller. '. Php';  can be modified: $ val = CONTROLLER_PATH. $ controller. '. php' <br>  What is important is that this function allows you to call the desired controller by its name.  In order for controllers to interact correctly with the system, they must implement the iHandler interface, which is defined as follows: <br><pre> &lt;code&gt;
 ihandler.php:<font></font>
<font></font>
 &lt;? php
	 interface iHandler
	 {
		 public function dispatchAction ($ action, &amp; $ app);
		 public function actionDefault (&amp; $ app);
	 }
 ?&gt;
 &lt;/ code&gt;
 </pre><br>  This interface introduces two required methods: dispatchAction ($ action, &amp; $ app) and public function actionDefault (&amp; $ app); <br>  Both methods take a reference to the webApplication class (the &amp; $ app parameter) as one of the parameters.  This is done in order to avoid the PHP habit of making a complete copy of the object.  Yes, and having the desired class as a parameter is somewhat more convenient than writing global $ app;  $ app-&gt; ... <br><br>  Let's return to our example.  In our case, the welcome (welcome.php) controller will be invoked: <br><pre> &lt;code&gt;
 &lt;? php
 require_once ("ihandler.php");<font></font>
<font></font>
 class welcome implements iHandler
 {<font></font>
<font></font>
	 public function __construct ()
	 {
		 // Nothing to do here	
	 }<font></font>
		<font></font>
	 public function dispatchAction ($ action, &amp; $ app)
	 {
		 $ this-&gt; actionDefault (&amp; $ app);
	 }<font></font>
	<font></font>
	 public function actionDefault (&amp; $ app)
	 {
		 include ("welcome.html");
	 }<font></font>
	<font></font>
 }
 ?&gt;
 &lt;/ code&gt;  
</pre><br>  This controller is written strictly in the framework of the example and we can assume that it does nothing at all.  It only loads a certain HTML file.  Where, then, do the data come from?  It can be assumed that the downloaded file is a template and somehow requests them.  Is it so?  See the code: <br><pre> &lt;code&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;meta http-equiv = "Content-Type" content = "text / html; charset = utf-8"&gt;
 &lt;title&gt; Template handler output test page &lt;/ title&gt;
 &lt;/ head&gt;<font></font>
<font></font>
 &lt;body&gt;
 &lt;p&gt; Test page for template handler &lt;/ p&gt;<font></font>
<font></font>
<font></font>
 &lt;h3&gt; Starting the test &lt;/ h3&gt;
 &lt;? php $ app-&gt; handle ("hello", "say");?&gt; 
 &lt;/ body&gt;
 &lt;/ html&gt;<font></font>
<font></font>
 &lt;/ code&gt;
</pre><br>  And this is true! .. We are looking at the line &lt;? Php $ app-&gt; handle ("hello", "say");?&gt;.  Here he is a lion!  We called our webApplication class and asked to call the controller we need.  Moreover, the system will provide the preparation and insertion of the HTML we need automatically.  No rows returned.  And we used the same function handle, which was analyzed above.  We ask to call the hello controller, which is obviously located in hello.php <br><pre> &lt;code&gt;
 &lt;? php
 require_once ("ihandler.php");<font></font>
<font></font>
 class hello implements iHandler
 {<font></font>
<font></font>
	 public function __construct ()
	 {
		 // Nothing to do here	
	 }<font></font>
		<font></font>
	 public function dispatchAction ($ action, &amp; $ app)
	 {<font></font>
		<font></font>
		 switch ($ action)
		 {
			 case 'say':
				 $ this-&gt; actionSay (&amp; $ app);
				 break;
			 default:
				 $ this-&gt; actionDefault (&amp; $ app);
			 break;
		 }
	 }<font></font>
	<font></font>
	 public function actionSay (&amp; $ app)
	 {
		 require_once ("saymodel.php");
		 $ model = new sayModel ();
		 $ model-&gt; prepareString ($ _ REQUEST ['name']);
		 include ("hello.tpl");
	 }<font></font>
	<font></font>
	 public function actionDefault (&amp; $ app)
	 {
		 // Nothing to do by default
	 }<font></font>
	<font></font>
 }
 ?&gt;
 &lt;/ code&gt; 
</pre><br>  In this controller, we have implemented a method that is responsible for handling the ‚Äúsay‚Äù action - actionSay. <br>  This method performs a typical sequence of actions for the MVC model: it creates a model, passes data to it for processing, loads the view. <br><br>  First, look at the model (this is just an example, so it is extremely simple). <br><pre> &lt;code&gt;
 &lt;? php
	 class sayModel
	 {
		 public $ msg;<font></font>
		<font></font>
		 public function __construct ()
		 {
			 $ this-&gt; msg = "";
		 }<font></font>
		<font></font>
		 public function prepareString ($ name)
		 {
			 $ this-&gt; msg = "Hello $ name!";
		 }
	 }<font></font>
<font></font>
 ?&gt;
 &lt;/ code&gt;
</pre><br>  It is clear that the real model will be much more difficult.  This model provides data in the form of an accessible (public) string variable $ msg.  How does the hello.tplb view loaded by the controller use this data?  Very simple: <br><br><pre> hello.tpl
 &lt;code&gt;
 &lt;p color = "# ff0000"&gt; &lt;? php echo ($ model-&gt; msg);  ?&gt; &lt;/ p&gt;
 &lt;/ code&gt;
</pre><br><br>  As you can see, this view is just a fragment of HTML code, with the insertion of PHP that accesses the model data.  This data will go to the stream and after processing by the PHP interpreter will get to the right place of the first view.  It is clear that in general, the level of nesting and the number of controller calls is not limited. <br><br>  Everything!  We implemented a multi-level template system using the MVC model for each of them.  The proposed system can serve as a good skeleton for the implementation of complex applications. </div><p>Source: <a href="https://habr.com/ru/post/232089/">https://habr.com/ru/post/232089/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../232079/index.html">SpamAssassin Training</a></li>
<li><a href="../232081/index.html">Writing a simple interpreter in C ++ using TDD, part 2</a></li>
<li><a href="../232083/index.html">How to stop worrying and start shooting panoramas</a></li>
<li><a href="../232085/index.html">Experience using smart glasses Epson Moverio BT-200</a></li>
<li><a href="../232087/index.html">Automating the mounting of samba partitions on Mac OS</a></li>
<li><a href="../232091/index.html">Intel Pro 2500 - new SSD series with hardware encryption</a></li>
<li><a href="../232093/index.html">NASA confirms the performance of the "impossible" wave engine that does not use reactive mass - EmDrive</a></li>
<li><a href="../232095/index.html">ERPXE like a magic pill</a></li>
<li><a href="../232097/index.html">Writing a simple interpreter in C ++ using TDD, part 3</a></li>
<li><a href="../232099/index.html">Clean and dirty test environments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>