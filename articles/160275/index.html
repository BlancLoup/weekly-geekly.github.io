<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Own DynDNS on the knee</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, let's say you are a web developer. Suppose you have a Linux home computer running 24x7 and a dynamic external ip. Suppose you need to connect to i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Own DynDNS on the knee</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/462/c9a/4e8/462c9a4e81c24dbc91e5b67f493c74bf.jpg" align="left">  So, let's say you are a web developer.  Suppose you have a Linux home computer running 24x7 and a dynamic external ip.  Suppose you need to connect to it via ssh or show web projects to a customer that for some reason cannot be spread to the hosting for a long time or at all (because of the need to show something to third parties, VPN is not an option).  Suppose you do not like DynDNS services.  Let's get started <br><br>  I agree, the conditions are specific - but something in life does not happen. <br><br>  The scheme is approximately the same - home PC is knocking on your site (you are a web developer, after all, you must have a site), he fixes an ip address, and gives it to you. <br><a name="habracut"></a><br>  First, we configure the output (actually input) of the home PC (hereinafter - the server, for simplicity) to the external network.  If your PC is directly connected to the Internet, feel free to skip this item.  This is approximately how setting up a web interface of my ASUS WL-520GU router with alternative firmware tomatoUSB - I open port 666 for ssh forwarding and port 667 on the router for redirecting web requests to the server (internal address is 192.168.1.100, the ip address is fixed to the server by rules DHCP of the same router). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/1a6/a45/2d0/1a6a452d0129d71dee9a26d4d8378846.png"><br><br>  Some routers need to be rebooted, but with a high degree of probability they will report this themselves. <br><br>  It remains to configure the server to request a cron'u page on your hosting (http://my.site/testippage.php, for example). <br><br>  In the console - <br><pre><code class="bash hljs">crontab -e */5 * * * * wget http://my.site/testippage.php?key=habrahabr -O /dev/null</code> </pre> <br>  (every 5 minutes download the page <a href="http://my.site/testippage.php">my.site/testippage.php</a> to nowhere) <br><br>  The key transmitted by the get request serves as a small protection against accidental or deliberate sabotage. <br><br>  Now we configure server part.  I used to use the MySQL database to store the current ip address - but this is completely unnecessary, and in the process of editing the article I got this code: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'key'</span></span>]==<span class="hljs-string"><span class="hljs-string">'habrahabr'</span></span>){ file_put_contents ( <span class="hljs-string"><span class="hljs-string">'ip.txt'</span></span> , getenv(<span class="hljs-string"><span class="hljs-string">"REMOTE_ADDR"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $ip = file_get_contents(<span class="hljs-string"><span class="hljs-string">'ip.txt'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'page'</span></span>])){ header(<span class="hljs-string"><span class="hljs-string">'Location: http://'</span></span>.$ip.<span class="hljs-string"><span class="hljs-string">':667/'</span></span>.$_GET[<span class="hljs-string"><span class="hljs-string">'page'</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $ip; } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  As is clear from the code, if the get parameter is passed to the script, it records the knocked ip, if the page parameter redirects to your home computer, and if it does not receive anything, it simply displays the ip address. <br><br>  To show the customer the project lying in the project folder of the server - you need to give him the link <a href="http://my.site/testippage.php%3Fpage%3Dproject">my.site/testippage.php?page=project</a> . <br><br>  Now the last part is setting up a connection to the server with a single command.  Let's make a script, let's say, homeslackconnect.sh: <br><pre> <code class="bash hljs">content=$(wget http://my.site/testippage.php -q -O -) ssh <span class="hljs-variable"><span class="hljs-variable">$content</span></span> -p 666 -l niph</code> </pre><br>  it reads the ip address into the content variable and tries to connect to the received address via port 666 as the niph user.  As required initially. <br><br>  I do not argue with the fact that DynDNS is a much simpler solution, but not all routers can use free DynDNS servers, besides, they tend to become not so free, and their solution is always warmer.  Ask questions in the comments, I hope someone this decision will help simplify your life. </div><p>Source: <a href="https://habr.com/ru/post/160275/">https://habr.com/ru/post/160275/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160261/index.html">AWS officially supports Centos, Debian, and FreeBSD from the Marketplace</a></li>
<li><a href="../160263/index.html">Research robot turtle</a></li>
<li><a href="../160265/index.html">Aruba Networks now in Russia. Part 1 - First acquaintance</a></li>
<li><a href="../160267/index.html">How Samsung conducts tests of its phones</a></li>
<li><a href="../160273/index.html">Interactive IPv6 Deployment Map</a></li>
<li><a href="../160277/index.html">HP's New Year Offer: A Lifetime Server Plus Network</a></li>
<li><a href="../160279/index.html">Access to Facebook partially blocked by order of authorities in Tajikistan</a></li>
<li><a href="../160281/index.html">Web development with Gaelyk</a></li>
<li><a href="../160283/index.html">Windows XP will lose support after 497 days</a></li>
<li><a href="../160285/index.html">Hackberry Review - Miniand Single Board Computer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>