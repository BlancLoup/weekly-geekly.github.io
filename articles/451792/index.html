<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Four JavaScript sniffer that lurk you in online stores</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Practically each of us uses the services of online stores, which means, sooner or later, the risk of becoming a victim of JavaScript sniffers - a spec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Four JavaScript sniffer that lurk you in online stores</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/m2/18/ri/m218ribvsirj8bn0787eizy9oei.jpeg"><br><br>  Practically each of us uses the services of online stores, which means, sooner or later, the risk of becoming a victim of JavaScript sniffers - a special code that the attackers introduce to the site to steal bank card data, addresses, usernames and passwords. <br><br>  Almost 400,000 users of the site and the mobile application of British Airways, as well as visitors to the British site of the sports giant FILA and the American ticket distributor Ticketmaster, have already suffered from sniffers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Threat Intelligence Group-IB analyst Viktor Okorokov talks about how sniffers are embedded in the site code and steal billing information, as well as what kind of CRM they attack. <a name="habracut"></a><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l_/b0/sa/l_b0sa5cjkma2zr779uhbfi5h8m.jpeg"></div><br><br><h2>  "Hidden threat" </h2><br>  So it turned out that for a long time JS-sniffers remained out of sight of antivirus analysts, and banks and payment systems did not see them as a serious threat.  And it is in vain.  Group-IB experts <a href="https://www.group-ib.ru/media/js-sniffers-report/">analyzed</a> 2440 infected online stores, whose visitors ‚Äî a total of about 1.5 million people a day ‚Äî were at risk of compromise.  Among the victims were not only users, but also online stores, payment systems and banks that issued compromised cards. <br><br>  <a href="https://www.group-ib.ru/resources/threat-research/js-sniffers.html">The</a> Group-IB <a href="https://www.group-ib.ru/resources/threat-research/js-sniffers.html">report</a> was the first to study the darknet market of sniffers, their infrastructure and ways to monetize, bringing millions of dollars to their creators.  We identified 38 families of sniffers, of which only 12 were previously known to researchers. <br><br>  Let us dwell in detail on the four families of sniffers studied in the course of the study. <br><br><h2>  ReactGet Family </h2><br>  ReactGet family sniffers are used to steal bank card data on online stores.  The sniffer can work with a large number of different payment systems used on the site: one parameter value corresponds to one payment system, and some detected versions of the sniffer can be used to steal credentials, as well as to steal bank card data from payment forms of several payment systems at once, the so-called universal sniffer.  It was found that in some cases, attackers carry out phishing attacks on administrators of online stores in order to gain access to the administrative panel of the site. <br><br>  The campaign with the use of this family of sniffers began in May 2017, the sites under the control of CMS and platforms Magento, Bigcommerce, Shopify were attacked. <br><br><h3>  How ReactGet is embedded in an online store code </h3><br>  In addition to the ‚Äúclassic‚Äù implementation of the script by reference, the operators of the ReactGet family of sniffers use a special technique: using JavaScript code, it is checked whether the current address where the user is located meets certain criteria.  Malicious code will be run only if the current URL contains the substring <b>checkout</b> or <b>onestepcheckout</b> , <b>onepage /</b> , <b>out / onepag</b> , <b>checkout / one</b> , <b>ckout / one</b> .  Thus, the sniffer code will be executed exactly at the moment when the user goes to pay for purchases and enters payment information in the form on the website. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kz/fz/lr/kzfzlrityshdouqlvh5ns14vlhm.png"></div><br>  This sniffer uses non-standard technique.  The victim's payment and personal data are gathered together, encoded with <b>base64</b> , and then the resulting string is used as a parameter to send a request to the attackers website.  Most often, the path to the gate imitates a JavaScript file, for example, <b>resp.js</b> , <b>data.js,</b> and so on, but also links to image files, <b>GIF</b> and <b>JPG are used</b> .  The peculiarity is that the sniffer creates a 1 by 1 pixel image object and uses the previously obtained link as the image <b>src</b> parameter.  That is, for a user, such a request in traffic will look like an ordinary picture request.  A similar technique was used in ImageID sniffers.  In addition, a 1 by 1 pixel image technique is used in many legitimate online analytics scripts, which can also mislead the user. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jo/bf/xm/jobfxmbqsrjqolrvo84fkstgrhi.png"></div><br><h3>  Version Analysis </h3><br>  Analysis of the active domains used by ReactGet sniffer operators allowed us to discover many different versions of sniffer of this family.  Versions are distinguished by the presence or absence of obfuscation, and in addition, each sniffer is intended for a specific payment system that processes bank card payments for online stores.  After reviewing the value of the parameter corresponding to the version number, Group-IB specialists received a full list of available variations of sniffers, and the names of the form fields that each sniffer searches for in the page code determine the payment systems that the sniffer aims at. <br><br><div class="spoiler">  <b class="spoiler_title">List of sniffers and their respective payment systems</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th width="200">  Sniffer url <br></th><th width="200">  Payment system <br></th></tr><tr><td align="center">  <a href="">reactjsapi.com/react.js</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ajaxstatic.com/api.js?v=2.1.1</a> </td><td align="center">  Cardsave <br></td></tr><tr><td align="center">  <a href="">ajaxstatic.com/api.js?v=2.1.2</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ajaxstatic.com/api.js?v=2.1.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ajaxstatic.com/api.js?v=2.1.4</a> </td><td align="center">  eWAY Rapid <br></td></tr><tr><td align="center">  <a href="">ajaxstatic.com/api.js?v=2.1.5</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ajaxstatic.com/api.js?v=2.1.6</a> </td><td align="center">  Adyen </td></tr><tr><td align="center">  <a href="">ajaxstatic.com/api.js?v=2.1.7</a> </td><td align="center">  USAePay </td></tr><tr><td align="center">  <a href="">ajaxstatic.com/api.js?v=2.1.9</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.1.1</a> </td><td align="center">  USAePay </td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.1.2</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.1.3</a> </td><td align="center">  Moneris <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.1.5</a> </td><td align="center">  USAePay <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.1.6</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.1.7</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.1.8</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.1.9</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=2.3.0</a> </td><td align="center">  Stripe <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=3.0.2</a> </td><td align="center">  Realex </td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=3.0.3</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=3.0.4</a> </td><td align="center">  Linkpoint </td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=3.0.5</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=3.0.7</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=3.0.8</a> </td><td align="center">  Datacash <br></td></tr><tr><td align="center">  <a href="">apitstatus.com/api.js?v=3.0.9</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">asianfoodgracer.com/footer.js</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">billgetstatus.com/api.js?v=1.2</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">billgetstatus.com/api.js?v=1.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">billgetstatus.com/api.js?v=1.4</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">billgetstatus.com/api.js?v=1.5</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">billgetstatus.com/api.js?v=1.6</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">billgetstatus.com/api.js?v=1.7</a> </td><td align="center">  Moneris <br></td></tr><tr><td align="center">  <a href="">billgetstatus.com/api.js?v=1.8</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">billgetstatus.com/api.js?v=2.0</a> </td><td align="center">  USAePay <br></td></tr><tr><td align="center">  <a href="">billgetstatus.com/react.js</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=1.2</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=1.3</a> </td><td align="center">  ANZ eGate <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.4</a> </td><td align="center">  Moneris </td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.6</a> <br></td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.7</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.8</a> </td><td align="center">  Chase paymentech <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.9</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.91</a> </td><td align="center">  Adyen <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.92</a> </td><td align="center">  Psigate <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.93</a> </td><td align="center">  CyberSource </td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.95</a> </td><td align="center">  ANZ eGate <br></td></tr><tr><td align="center">  <a href="">cloudodesc.com/gtm.js?v=2.97</a> </td><td align="center">  Realex </td></tr><tr><td align="center">  <a href="">geisseie.com/gs.js</a> </td><td align="center">  USAePay <br></td></tr><tr><td align="center">  <a href="">gtmproc.com/age.js</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">gtmproc.com/gtm.js?v=1.2</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">gtmproc.com/gtm.js?v=1.3</a> </td><td align="center">  ANZ eGate <br></td></tr><tr><td align="center">  <a href="">gtmproc.com/gtm.js?v=1.5</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">gtmproc.com/gtm.js?v=1.6</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">gtmproc.com/gtm.js?v=1.7</a> </td><td align="center">  Realex <br></td></tr><tr><td align="center">  <a href="">livecheckpay.com/api.js?v=2.0</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">livecheckpay.com/api.js?v=2.1</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">livecheckpay.com/api.js?v=2.2</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">livecheckpay.com/api.js?v=2.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">livecheckpay.com/api.js?v=2.4</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">livecheckpay.com/react.js</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.1.2</a> </td><td align="center">  ANZ eGate <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.1.3</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.1.5</a> </td><td align="center">  CyberSource <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.1.7</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.1.8</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.1.9</a> </td><td align="center">  Realex </td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.0</a> </td><td align="center">  CyberSource </td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.1</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.2</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.3</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.4</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.5</a> </td><td align="center">  eWAY Rapid <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.7</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.8</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.2.9</a> </td><td align="center">  Verisign </td></tr><tr><td align="center"> <a href="">livegetpay.com/pay.js?v=2.3.0</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.3.1</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.3.2</a> </td><td align="center">  First Data Global Gateway <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.3.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.3.4</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.3.5</a> </td><td align="center">  Moneris </td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.3.6</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.3.8</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">livegetpay.com/pay.js?v=2.4.0</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">maxstatics.com/site.js</a> </td><td align="center">  USAePay <br></td></tr><tr><td align="center">  <a href="">mediapack.info/track.js?d=funlove.com</a> </td><td align="center">  USAePay <br></td></tr><tr><td align="center">  <a href="">mediapack.info/track.js?d=qbedding.com</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mediapack.info/track.js?d=vseyewear.com</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=1.2</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=1.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=1.4</a> </td><td align="center">  Stripe </td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=1.6</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=1.7</a> </td><td align="center">  eWAY Rapid <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=1.8</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.0</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.1</a> </td><td align="center">  Braintree </td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.10</a> </td><td align="center">  Braintree <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.2</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.3</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.31</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.32</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.33</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.34</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/c.js?v=2.35</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=1.2</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=1.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=1.4</a> </td><td align="center">  Stripe </td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=1.6</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=1.7</a> </td><td align="center">  eWAY Rapid <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=1.8</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.0</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.1</a> </td><td align="center">  Braintree </td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.2</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.3</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.31</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.32</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.33</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.34</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/click.js?v=2.35</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">mxcounter.com/cnt.js</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">mxcounter.com/j.js</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">newrelicnet.com/api.js?v=1.2</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">newrelicnet.com/api.js?v=1.4</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">newrelicnet.com/api.js?v=1.8</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">newrelicnet.com/api.js?v=4.5</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">newrelicnet.com/api.js?v=4.6</a> </td><td align="center">  Westpac PayWay <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.0</a> </td><td align="center">  Payfort <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.1</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.2</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.3</a> </td><td align="center">  Stripe <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.4</a> </td><td align="center">  First Data Global Gateway <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.5</a> </td><td align="center">  Psigate </td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.6</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.7</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.8</a> </td><td align="center">  Moneris </td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=2.9</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=3.1</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=3.2</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=3.3</a> </td><td align="center">  Moneris </td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=3.5</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=3.6</a> </td><td align="center">  Linkpoint <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=3.7</a> </td><td align="center">  Westpac PayWay <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=3.8</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0</a> </td><td align="center">  Moneris <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0.2</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0.3</a> </td><td align="center">  Adyen </td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0.4</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0.5</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0.6</a> </td><td align="center">  USAePay <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0.7</a> </td><td align="center">  EBizCharge <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0.8</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.0.9</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">nr-public.com/api.js?v=4.1.2</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.11</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.12</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.13</a> </td><td align="center">  Moneris <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.14</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.15</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.16</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.17</a> </td><td align="center">  Westpac PayWay <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.18</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.19</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.21</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.22</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.23</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.24</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.25</a> </td><td align="center">  Payfort <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.29</a> </td><td align="center">  CyberSource <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.4</a> </td><td align="center">  Paypal payflow pro <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.7</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.8</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=2.9</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.1</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.2</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.3</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.4</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.5</a> </td><td align="center">  Stripe <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.6</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.7</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.8</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=3.9</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=4.0</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=4.1</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=4.2</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">ordercheckpays.com/api.js?v=4.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=0.1.0</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=0.1.1</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.1.2</a> </td><td align="center">  Flint </td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.1.4</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.1.5</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.1.51</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.1.6</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.1.7</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.1.8</a> </td><td align="center">  Stripe </td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.1.9</a> </td><td align="center">  Fat zebra <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.0</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.1</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.2</a> </td><td align="center">  First Data Global Gateway <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.4</a> </td><td align="center">  eWAY Rapid <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.5</a> </td><td align="center">  Adyen <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.7</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.8</a> </td><td align="center">  QuickBooks Merchant Services <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.9</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.91</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.92</a> </td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.2.94</a> </td><td align="center">  Authorize.Net </td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.3.97</a> </td><td align="center">  Authorize.Net </td></tr><tr><td align="center">  <a href="">reactjsapi.com/api.js?v=4.5</a> </td><td align="center">  Sage pay </td></tr><tr><td align="center">  <a href="">reactjsapi.com/react.js</a> </td><td align="center">  Authorize.Net </td></tr><tr><td align="center">  <a href="">sydneysalonsupplies.com/gtm.js</a> </td><td align="center">  eWAY Rapid </td></tr><tr><td align="center">  <a href="">tagsmediaget.com/react.js</a> </td><td align="center">  Authorize.Net </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.1.2</a> </td><td align="center">  ANZ eGate </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.1.3</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.1.5</a> </td><td align="center">  CyberSource </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.1.7</a> </td><td align="center">  Authorize.Net </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.1.8</a> </td><td align="center">  Sage pay </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.1.9</a> </td><td align="center">  Realex <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.0</a> </td><td align="center">  CyberSource </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.1</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.2</a> </td><td align="center">  Paypal </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.3</a> </td><td align="center">  Paypal <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.4</a> </td><td align="center">  Verisign <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.5</a> </td><td align="center">  eWAY Rapid </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.7</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.8</a> </td><td align="center">  Sage pay <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.2.9</a> <br></td><td align="center">  Verisign </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.3.0</a> </td><td align="center">  Authorize.Net </td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.3.1</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.3.2</a> </td><td align="center">  First Data Global Gateway <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.3.3</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.3.4</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.3.5</a> </td><td align="center">  Moneris <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.3.6</a> </td><td align="center">  Authorize.Net <br></td></tr><tr><td align="center">  <a href="">tagstracking.com/tag.js?v=2.3.8</a> </td><td align="center">  Paypal <br></td></tr></tbody></table></div><br></div></div><br><h3>  Sniffer password <br></h3><br>  One of the advantages of JavaScript sniffer working on the client side of the site is universality: the malicious code embedded on the site can steal data of any type, whether it is billing information or username and password from a user account.  Group-IB specialists have discovered a sample sniffer belonging to the ReactGet family, designed to steal email addresses and passwords of users of the site. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7x/9c/x1/7x9cx1en90ze5etozgc6jmg5eh8.png"></div><br><h3>  Intersection with ImageID sniffer <br></h3><br>  An analysis of one of the infected stores revealed that his site had been infected twice: in addition to the malicious code of the ReactGet family sniffer, the code of the ImageID family sniffer was detected.  This intersection may be evidence that the operators behind the use of both sniffers use similar techniques to introduce malicious code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8s/m0/ed/8sm0edvplxoguwsczm9ja3-g_ng.png"></div><br><h3>  Universal Sniffer <br></h3><br>  An analysis of one of the domain names related to the infrastructure of ReactGet sniffers revealed that the same user registered three other domain names.  These three domains imitated the domains of real-life sites and were previously used to host sniffers.  When analyzing the code of three legitimate sites, an unknown sniffer was discovered, and further analysis showed that this is an improved version of the ReactGet sniffer.  All previously tracked versions of sniffers of this family were aimed at any one payment system, that is, for each payment system a special version of the sniffer was required.  However, in this case, a universal version of the sniffer was discovered, capable of stealing information from forms related to 15 different payment systems and e-commerce site modules for online payments. <br><br>  So, at the beginning of the work, the sniffer searched for basic form fields containing the victim's personal information: full name, physical address, telephone number. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g_/py/vs/g_pyvsjovjp7p6x2vlqzaqho5ey.png"></div><br>  Then the sniffer searched for more than 15 different prefixes, corresponding to different payment systems and modules for online payments. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dd/ty/as/ddtyasulurz4un7owfvlv-3xepu.png"></div><br>  Then, the victim's personal data and payment information were collected together and sent to the site controlled by the attacker: in this particular case, two versions of the universal ReactGet sniffer were found, located on two different hacked sites.  However, both versions sent the stolen data to the same hacked <b>zoobashop.com</b> website. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/mt/tb/eemttbv-vdn0ff9ncd3siqfzokq.png"></div><br>  The analysis of the prefixes that were used by the sniffer to search for fields containing the payment information of the victim made it possible to determine that this sample of the sniffer was aimed at the following payment systems: <br><br><ul><li>  <b>Authorize.Net</b> </li><li>  <b>Verisign</b> </li><li>  <b>First data</b> </li><li>  <b>USAePay</b> </li><li>  <b>Stripe</b> </li><li>  <b>Paypal</b> </li><li>  <b>ANZ eGate</b> </li><li>  <b>Braintree</b> </li><li>  <b>DataCash (MasterCard)</b> </li><li>  <b>Realex payments</b> </li><li>  <b>Psigate</b> </li><li>  <b>Heartland Payment Systems</b> </li></ul><br><h3>  What tools are used to steal billing information <br></h3><br>  The first tool found during the analysis of the infrastructure of the attackers serves to obfuscate malicious scripts responsible for the theft of bank cards.  A bash script was discovered on one of the attacker's hosts, using the CLI of the <b><a href="http://github.com/javascript-obfuscator/javascript-obfuscator">javascript-obfuscator</a></b> project to automate the obfuscation of sniffer code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5m/aw/lu/5mawlut23obt6lpoa3ed2luu8ss.png"></div><br>  The second detected tool is designed to generate the code responsible for loading the main sniffer.  This tool generates a JavaScript code that checks whether the user is on the payment page by searching the current address of the user for <b>checkout</b> , <b>cart,</b> and so on, and if the result is positive, then the code loads the main sniffer from the attacker's server.  To hide malicious activity, all lines, including test lines for defining the payment page, as well as a link to the sniffer, are encoded with <b>base64</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vn/ew/ym/vnewymbt1r6nc8n98roze5drnnk.png"></div><br><h3>  Phishing attacks <br></h3><br>  In analyzing the network infrastructure of the attackers, it was found that the criminal group often uses phishing to gain access to the administrative panel of the targeted online store.  The attackers register a domain that is visually similar to the domain of the store, and then unfolds on it a fake login form of the Magento administrative panel.  If successful, attackers will gain access to the CMS Magento administrative panel, which allows them to edit the site components and implement a sniffer to steal credit card data. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yf/-a/lz/yf-alzxabbg_kij0vkaq5qcr9vs.png"></div><br><div class="spoiler">  <b class="spoiler_title">Infrastructure</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th width="200">  Domain <br></th><th width="200">  Date of discovery / appearance <br></th></tr><tr><td align="center">  mediapack.info </td><td align="center">  04.05.2017 <br></td></tr><tr><td align="center">  adsgetapi.com </td><td align="center">  06/15/2017 <br></td></tr><tr><td align="center">  simcounter.com </td><td align="center">  08/14/2017 </td></tr><tr><td align="center">  mageanalytics.com </td><td align="center">  12/22/2017 </td></tr><tr><td align="center">  maxstatics.com </td><td align="center">  01/16/2018 <br></td></tr><tr><td align="center">  reactjsapi.com </td><td align="center">  01.19.2018 </td></tr><tr><td align="center">  mxcounter.com </td><td align="center">  02.02.2018 </td></tr><tr><td align="center">  apitstatus.com </td><td align="center">  03/01/2018 <br></td></tr><tr><td align="center">  orderracker.com </td><td align="center">  04/20/2018 <br></td></tr><tr><td align="center">  tagstracking.com </td><td align="center">  06.25.2018 <br></td></tr><tr><td align="center">  adsapigate.com </td><td align="center">  12.07.2018 <br></td></tr><tr><td align="center">  trust-tracker.com </td><td align="center">  07/15/2018 <br></td></tr><tr><td align="center">  fbstatspartner.com </td><td align="center">  10/02/2018 <br></td></tr><tr><td align="center">  billgetstatus.com </td><td align="center">  12.10.2018 </td></tr><tr><td align="center">  aldenmlilhouse.com </td><td align="center">  10/20/2018 <br></td></tr><tr><td align="center">  balletbeautlful.com </td><td align="center">  10/20/2018 <br></td></tr><tr><td align="center">  bargalnjunkie.com </td><td align="center">  10/20/2018 <br></td></tr><tr><td align="center">  payselector.com </td><td align="center">  10/21/2018 <br></td></tr><tr><td align="center">  tagsmediaget.com </td><td align="center">  11/02/2018 <br></td></tr><tr><td align="center">  hs-payments.com </td><td align="center">  11/16/2018 <br></td></tr><tr><td align="center">  ordercheckpays.com </td><td align="center">  11/19/2018 <br></td></tr><tr><td align="center">  geisseie.com </td><td align="center">  11/24/2018 <br></td></tr><tr><td align="center">  gtmproc.com </td><td align="center">  11/29/2018 <br></td></tr><tr><td align="center">  livegetpay.com </td><td align="center">  12/18/2018 <br></td></tr><tr><td align="center">  sydneysalonsupplies.com </td><td align="center">  12/18/2018 <br></td></tr><tr><td align="center">  newrelicnet.com <br></td><td align="center">  12/19/2018 <br></td></tr><tr><td align="center">  nr-public.com </td><td align="center">  01.03.2019 </td></tr><tr><td align="center">  cloudodesc.com </td><td align="center">  01/04/2019 <br></td></tr><tr><td align="center">  ajaxstatic.com </td><td align="center">  01.11.2019 <br></td></tr><tr><td align="center">  livecheckpay.com </td><td align="center">  01.21.2019 <br></td></tr><tr><td align="center">  asianfoodgracer.com </td><td align="center">  01/25/2019 <br></td></tr></tbody></table></div><br></div></div><br><h2>  G-Analytics Family <br></h2><br>  This family of sniffers is used to steal cards from online store customers.  The very first domain name used by the group was registered in April 2016, which may indicate the start of group activity in mid-2016. <br><br>  In the current campaign, the group uses domain names that mimic real-life services, such as Google Analytics and jQuery, masking sniffer activity with legitimate scripts and similar legitimate domain names.  Attack suffered sites running CMS Magento. <br><br><h3>  How G-Analytics is embedded in the code of an online store <br></h3><br>  A distinctive feature of this family is the use of various methods of stealing the user's payment information.  In addition to the classic implementation of JavaScript code in the client part of the site, the criminal group also used the technique of introducing code into the server part of the site, namely PHP scripts that process user input.  This technique is dangerous in that it makes it difficult for third-party researchers to detect malicious code.  Group-IB specialists discovered a version of a sniffer embedded in the site's PHP code, using <b>dittm.org</b> as the gate. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ud/m_/dk/udm_dkzu4pw_4pbxhrstk0e9oo8.png"></div><br>  An early version of the sniffer was also found, using the same <b>dittm.org</b> domain to collect stolen data, but this version is already intended for installation on the client side of the online store. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kr/0m/nh/kr0mnhgtjfxqs5lftvx53ofrm54.png"></div><br>  Later, the group changed its tactics and began to pay more attention to the concealment of malicious activity and disguise. <br><br>  In early 2017, the group began to use the domain <b>jquery-js.com</b> , disguised as a CDN for jQuery: when you go to the site of malicious users, the user redirects to the legitimate site <b>jquery.com</b> . <br><br>  And in mid-2018, the group adopted the domain name <b>g-analytics.com</b> and began to disguise the activity of the sniffer under the legitimate Google Analytics service. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rd/fj/mj/rdfjmj8foi7qtcv_fi_lix69a4u.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/y3/xp/24/y3xp24ypsp9vloflbz5lbnrrfnk.png"></div><br><h3>  Version Analysis <br></h3><br>  During the analysis of domains used for storing sniffer code, it was found that the site contains a large number of versions that differ in the presence of obfuscation, as well as in the presence or absence of unreachable code added to the file to divert attention and hide the malicious code. <br><br>  Total <b>jquery-js.com</b> site revealed six versions of sniffers.  These sniffers send stolen data to the address located on the same site as the sniffer itself: <b>hxxps: // jquery-js [.] Com / latest / jquery.min.js</b> : <br><br><ul><li>  <b>hxxps: // jquery-js [.] com / jquery.min.js</b> </li><li>  <b>hxxps: // jquery-js [.] com / jquery.2.2.4.min.js</b> </li><li>  <b>hxxps: // jquery-js [.] com / jquery.1.8.3.min.js</b> </li><li>  <b>hxxps: // jquery-js [.] com / jquery.1.6.4.min.js</b> </li><li>  <b>hxxps: // jquery-js [.] com / jquery.1.4.4.min.js</b> </li><li>  <b>hxxps: // jquery-js [.] com / jquery.1.12.4.min.js</b> </li></ul><br>  The later domain <b>g-analytics.com</b> , used by the group in attacks since mid-2018, serves as a repository for more sniffers.  A total of 16 different versions of the sniffer were found.  In this case, the gate for sending stolen data was masked as a link to a <b>GIF</b> image: <b>hxxp: // g-analytics [.] Com / __ utm.gif? V = 1 &amp; _v = j68 &amp; a = 98811130 &amp; t = pageview &amp; _s = 1 &amp; sd = 24-bit &amp; sr = 2560x1440 &amp; vp = 2145x371 &amp; je = 0 &amp; _u = AACAAEAB ~ &amp; jid = 1841704724 &amp; gjid = 877686936 &amp; cid</b> <b><br></b>  <b>= 1283183910.1527732071</b> : <br><br><ul><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.1 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.10 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.11 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.12 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.13 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.14 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.15 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.16 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.3 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.4 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.5 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.6 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.7 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.8 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / 1.0.9 / analytics.js</b> </li><li>  <b>hxxps: // g-analytics [.] com / libs / analytics.js</b> </li></ul><br><h3>  Monetization of stolen data <br></h3><br>  The criminal group monetizes stolen data by selling cards through a specially created underground store that provides services to carders.  Analysis of the domains used by the attackers made it possible to determine that <b>google-analytics.cm</b> was registered by the same user as the <b>cardz.vc</b> domain.  Domain <b>cardz.vc</b> belongs to the store for the sale of stolen bank cards Cardsurfs (Flysurfs), which gained popularity even during the time of activity of the underground marketplace AlphaBay as a store selling bank cards that were stolen using a sniffer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k6/l6/-w/k6l6-wxdifwkyfd-kq-3xicgsdq.png"></div><br>  Analyzing the <b>analytic.is</b> domain located on the same server as the domains used by sniffers to collect stolen data, Group-IB experts discovered a file containing the cookie-stiller logs, which, it seems, was later abandoned by the developer.  One of the records in the log contained the domain <b>iozoz.com</b> , which was previously used in one of the sniffers active in 2016.  Presumably, this domain was previously used by the attacker to collect cards stolen with the help of a sniffer.  This domain was registered at the email address <b>kts241@gmail.com</b> , which was also used to register the <b>cardz.su</b> and <b>cardz.vc</b> domains related to the card store Cardsurfs. <br><br>  Based on the data obtained, it can be assumed that the G-Analytics family of sniffers and the underground store selling Cardsurfs bank cards are managed by the same people, and the store is used to sell bank cards stolen using a sniffer. <br><br><div class="spoiler">  <b class="spoiler_title">Infrastructure</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th width="200">  Domain <br></th><th width="200">  Date of discovery / appearance <br></th></tr><tr><td align="center">  iozoz.com </td><td align="center">  04/08/2016 </td></tr><tr><td align="center">  dittm.org </td><td align="center">  09/10/2016 <br></td></tr><tr><td align="center">  jquery-js.com </td><td align="center">  01.02.2017 </td></tr><tr><td align="center">  g-analytics.com </td><td align="center">  05.31.2018 <br></td></tr><tr><td align="center">  google-analytics.is </td><td align="center">  11/21/2018 <br></td></tr><tr><td align="center">  analytic.to </td><td align="center">  12/04/2018 </td></tr><tr><td align="center">  google-analytics.to </td><td align="center">  12/06/2018 <br></td></tr><tr><td align="center">  google-analytics.cm </td><td align="center">  12/28/2018 <br></td></tr><tr><td align="center">  analytic.is </td><td align="center">  12/28/2018 <br></td></tr><tr><td align="center">  googlc-analytics.cm </td><td align="center">  01/17/2019 <br></td></tr></tbody></table></div><br></div></div><br><h2>  Illum family </h2><br>  Illum is a family of sniffers used to attack online stores running CMS Magento.  In addition to introducing malicious code, the operators of this sniffer also use the introduction of full fake payment methods that send data to gates controlled by the attackers. <br><br>  When analyzing the network infrastructure used by the operators of this sniffer, a large number of malicious scripts, exploits, fake payment forms, as well as a collection of examples with malicious competitor sniffers were noted.  Based on the information about the dates of the domain names used by the group, it can be assumed that the campaign began at the end of 2016. <br><br><h3>  How Illum is embedded in the online store code </h3><br>  The first detected versions of the sniffer were introduced directly into the code of the compromised site.  The stolen data was sent to <b>cdn.illum [.] Pw / records.php</b> , the gate was encoded using <b>base64</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m0/ek/gs/m0ekgsjvued_xicxubpz6dprhag.png"></div><br>  Later, a packaged version of the sniffer was discovered using another gate - <b>records.nstatistics [.] Com / records.php</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yy/zq/3d/yyzq3dtgunc6ansnwrk2eun4mjy.png"></div><br>  According to the <a href="https://gwillem.gitlab.io/2018/10/15/csu-shop-magecarted/">report of</a> Willem de Groot, the same host was used in the sniffer, which was introduced to the <a href="https://www.csu-shop.de/">site of a store</a> owned by the German political party CSU. <br><br><h3>  Analysis of the site intruders <br></h3><br>  Group-IB specialists discovered and analyzed the site used by this criminal group for storing tools and collecting stolen information. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dm/ze/i3/dmzei3jrukearwtcs-9ch_b2nue.png"></div><br>  Among the tools found on the attackers' server were found scripts and exploits to enhance privileges in Linux: for example, Linux Privilege Escalation Check Script, developed by Mike Chumak (Mike Czumak), as well as an exploit for CVE-2009-1185. <br><br>  The attackers used two exploits directly to attack online stores: the <a href="https://maxchadwick.xyz/blog/using-cve-2016-4010-gadget-chain-in-magento-1">first</a> is able to inject malicious code into <b>core_config_data</b> using CVE-2016-4010, the <a href="https://steemit.com/cybersecurity/%40nullbyte/2-0day-rce-magento-plugin-s-exploits">second</a> exploits an RCE vulnerability in CMS Magento plug-ins, allowing the execution of arbitrary code on a vulnerable web server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j7/st/5r/j7st5ryg0ixjehutzjvneckqaw8.jpeg"></div><br>  Also during the analysis of the server, various samples of sniffers and fake payment forms used by hackers to collect payment information from hacked sites were discovered.  As you can see from the list below, some scripts were created individually for each hacked site, while for certain CMS and payment gateways a universal solution was used.  For example, the <b>segapay_standart.js</b> and <b>segapay_onpage.js scripts</b> are intended for deployment to sites that use the Sage Pay payment gateway. <br><br><div class="spoiler">  <b class="spoiler_title">List of scripts for various payment gateways</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th width="200">  Script </th><th width="200">  Payment gateway </th></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / visiondirect.co.uk.js </td><td align="center">  //request.payrightnow[.‚ÇΩcf/checkpayment.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / topdierenshop.nl.js </td><td align="center">  //request.payrightnow interview.ccf/alldata.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / tiendalenovo.es.js </td><td align="center">  //request.payrightnow interview.ccf/alldata.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / pro-bolt.com.js </td><td align="center">  //request.payrightnow interview.ccf/alldata.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / plae.co.js </td><td align="center">  //request.payrightnow interview.ccf/alldata.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / ottolenghi.co.uk.js </td><td align="center">  //request.payrightnow interview.ccf/alldata.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / oldtimecandy.com.js </td><td align="center">  //request.payrightnow[.‚ÇΩcf/checkpayment.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / mylook.ee.js </td><td align="center">  //cdn.illum[.‚ÇΩpw/records.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / luluandsky.com.js </td><td align="center">  //request.payrightnow[.‚ÇΩcf/checkpayment.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / julep.com.js </td><td align="center">  //cdn.illum[.‚ÇΩpw/records.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / gymcompany.es.js </td><td align="center">  //request.payrightnow interview.ccf/alldata.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / grotekadoshop.nl.js </td><td align="center">  //request.payrightnow interview.ccf/alldata.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / fushi.co.uk.js </td><td align="center">  //request.payrightnow[.‚ÇΩcf/checkpayment.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / fareastflora.com.js </td><td align="center">  //request.payrightnow[.‚ÇΩcf/checkpayment.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs_special / compuindia.com.js </td><td align="center">  //request.payrightnow interview.ccf/alldata.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs / segapay_standart.js </td><td align="center">  //cdn.illum[.‚ÇΩpw/records.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs / segapay_onpage.js </td><td align="center">  //cdn.illum[.‚ÇΩpw/records.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs / replace_standart.js </td><td align="center">  //request.payrightnow[.‚ÇΩcf/checkpayment.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs / all_inputs.js </td><td align="center">  //cdn.illum[.‚ÇΩpw/records.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / mjs / add_inputs_standart.js </td><td align="center">  //request.payrightnow[.‚ÇΩcf/checkpayment.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / magento / payment_standart.js </td><td align="center">  //cdn.illum[.‚ÇΩpw/records.php <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / magento / payment_redirect.js </td><td align="center">  //payrightnow[.//cf/?payment= <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / magento / payment_redcrypt.js </td><td align="center">  //payrightnow[.//cf/?payment= <br></td></tr><tr><td align="center">  <a href="http://sr.illum/">sr.illum</a> [.] pw / magento / payment_forminsite.js </td><td align="center">  //paymentnow[.menttk/?payment= <br></td></tr></tbody></table></div><br></div></div><br>  The <b>paymentnow [.] Tk</b> host, used as a gate in the <b>payment_forminsite.js</b> script, was detected as <b>subjectAltName</b> in several certificates related to the CloudFlare service.  In addition, the host was a script <b>evil.js.</b>  Judging by the name of the script, it could be used within the framework of operating CVE-2016-4010, thanks to which you can inject malicious code into the footer of the site running CMS Magento.  As a gate, this script used the <b>request.requestnet [.]</b> <b>Tk</b> host, using the same certificate as the <b>paymentnow [.] Tk</b> host. <br><br><h3>  Fake Payment Forms <br></h3><br>  The figure below shows an example of a form for entering map data.  This form was used to embed an online store site and steal card data. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/vz/9b/vdvz9bvo34cv-5sp86ost9kadvg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The following figure is an example of a fake PayPal payment form that was used by attackers to deploy to sites with this payment method. </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6o/rk/92/6ork92ddgqisrzpksczgd-gcwyu.png"></div><br><div class="spoiler">  <b class="spoiler_title">Infrastructure</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th width="200">  Domain <br></th><th width="200"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Date of discovery / appearance </font></font></th></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cdn.illum.pw </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11/27/2016 </font></font><br></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> records.nstatistics.com </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 06/09/2018 </font></font><br></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> request.payrightnow.cf </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 05/25/2018 </font></font><br></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paymentnow.tk </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 07/16/2017 </font></font><br></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> payment-line.tk </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 03/01/2018 </font></font><br></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paymentpal.cf </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 09/09/2017 </font></font><br></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> requestnet.tk </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 28/06/2017 </font></font><br></td></tr></tbody></table></div><br></div></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CoffeMokko Family </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The family of sniffers CoffeMokko, designed to steal bank cards of users of online stores, has been in use since at least 2017. </font><font style="vertical-align: inherit;">Presumably, the operators of this family of sniffers are the criminal group Group 1, described by RiskIQ experts in 2016. </font><font style="vertical-align: inherit;">Sites running CMS such as Magento, OpenCart, WordPress, osCommerce, Shopify have been attacked.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How CoffeMokko is embedded in the code of the online store </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operators of this family create unique sniffers for each infection: the sniffer file is located in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">js</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directory </font><font style="vertical-align: inherit;">on the attackers server. </font><font style="vertical-align: inherit;">The implementation of the site code is carried out by a direct link to the sniffer.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wn/pz/s8/wnpzs8nq8gwew8hgxkmhocu8nv0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the code of the sniffer, the names of the form fields from which the data should be stolen are hard-coded. </font><font style="vertical-align: inherit;">Also, the sniffer checks if the user is on the payment page, checking the list of keywords with the current address of the user.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fh/pj/am/fhpjamaj2zikswysse44wophdxq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Some detected versions of the sniffer were obfuscated and contained an encrypted string in which the main array of resources was stored: it contained the names of the form fields for various payment systems, as well as the gateway address to which the stolen data should be sent. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ia/wz/qw/iawzqwyetk6kadgy3hjgcbhalgi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The stolen billing information was sent to a script on the attacker's server along the path </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/savePayment/index.php or /tr/index.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Presumably, this script is used to send data from the gate to the main server, which consolidates data from all sniffers. </font><font style="vertical-align: inherit;">To hide the transmitted data, all of the victim's payment information is encoded with </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base64</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and then several character replacements occur:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the symbol "e" is replaced by ":" </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the symbol ‚Äúw‚Äù is replaced by ‚Äú+‚Äù </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the symbol ‚Äúo‚Äù is replaced by ‚Äú%‚Äù </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the symbol ‚Äúd‚Äù is replaced by ‚Äú#‚Äù </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the symbol "a" is replaced by "-" </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the symbol "7" is replaced by "^" </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äúh‚Äù is replaced by ‚Äú_‚Äù </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the symbol "T" is replaced by "@" </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the character "0" is replaced by "/" </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the symbol "Y" is replaced by "*" </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result of the replacement of characters, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base64-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> encoded </font><font style="vertical-align: inherit;">data cannot be decoded without performing the inverse transform. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is a sniffer code snippet that has not been obfuscated:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/iv/rw/jv/ivrwjvwtjyflx73jxnzyedtgqxw.png"></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Infrastructure analysis </font></font><br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the early campaigns, the attackers registered domain names similar to the domains of legitimate online shopping sites. Their domain could differ from the legitimate one symbol or another TLD. Registered domains were used to store the sniffer code, the link to which was embedded in the store code. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, this group used domain names resembling the name of popular plugins for jQuery ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slickjs [.] Org</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for sites using the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slick.js</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plugin </font><font style="vertical-align: inherit;">), payment gateways ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sagecdn [.] Org</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for sites using the Sage Pay payment system). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Later, the group began to create domains whose name had nothing to do with the store domain or the store theme.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/8p/mc/nc8pmckp6ig-wh6zqiflqsvvuv8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each domain has a corresponding website where the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ js</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ src</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directory was created </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sniffer scripts were stored in this directory: one sniffer for each new infection. </font><font style="vertical-align: inherit;">Sniffer was injected into the site code for a direct link, but in rare cases, attackers modified one of the site files and added malicious code to it.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code analysis </font></font><br></h3><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> First obfuscation algorithm </font></font><br></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In some detected samples of sniffers of this family, the code was obfuscated and contained encrypted data necessary for the sniffer to work: in particular, the gateway address of the sniffer, the list of fields of the payment form, and in some cases the code of the fake payment form. </font><font style="vertical-align: inherit;">In the code inside the function, the resources were encrypted using </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XOR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by the key, which was passed by the argument of the same function.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uu/io/h2/uuioh2egdec0k1wpsa4wxti_1qc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Having decrypted a string with a corresponding key, unique for each sample, it is possible to obtain a string containing all the lines from the sniffer code through a separator character. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yi/ma/ch/yimachmb5zfakdeqn-u4v-dwesc.png"></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Second obfuscation algorithm </font></font><br></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the later samples of sniffers of this family, another obfuscation mechanism was used: in this case, the data were encrypted using a self-written algorithm. </font><font style="vertical-align: inherit;">The string containing the encrypted data necessary for the operation of the sniffer was passed as an argument to the decryption function.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/co/hs/bi/cohsbisd1wm4g_46sclbiq-wngc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Using the browser console, you can decrypt the encrypted data and get an array containing sniffer resources. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a8/zw/eh/a8zweh8fi_s1p6x-pgl6l7ugfei.png"></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Link to early MageCart attacks </font></font><br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the analysis of one of the domains used by the group as a gate for collecting stolen data, it was found that the infrastructure for theft of credit cards, identical to that used by Group 1, is one of the first groups </font></font><a href="https://www.riskiq.com/blog/labs/magecart-keylogger-injection/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discovered</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by RiskIQ specialists. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two files were found on the host of the CoffeMokko sniffer family:</font></font><br><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mage.js</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - file containing the sniffer code of Group 1 with the gate address </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">js-cdn.link</font></font></b> </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mag.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - PHP script responsible for collecting stolen data sniffer</font></font></li></ul><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contents of the mage.js file</font></font></b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/84/mx/99/84mx99wtkbnzni7faierof1lxbs.png"></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It was also found that the earliest domains used by the group behind the CoffeMokko family of sniffers were registered on May 17, 2017: </font></font><br><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link-js [.] link</font></font></b> </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">info-js [.] link</font></font></b> </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">track-js [.] link</font></font></b> </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">map-js [.] link</font></font></b> </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smart-js [.] link</font></font></b> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The format of these domain names coincides with the domain names of Group 1, which were used in the 2016 attacks.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the basis of the facts discovered, it can be assumed that there is a connection between the operators of the CoffeMokko sniffers and the criminal group Group 1. </font><font style="vertical-align: inherit;">Presumably, CoffeMokko operators could borrow tools and software for card theft from their predecessors. </font><font style="vertical-align: inherit;">However, it is more likely that the criminal group behind the use of CoffeMokko family sniffers is the same people who carried out the attacks as part of Group 1. After the publication of the first report on the activities of the criminal group, all their domain names were blocked, and the tools were studied in detail and are described. </font><font style="vertical-align: inherit;">The group was forced to take a break, modify its internal tools and rewrite the code of the sniffers in order to continue their attacks and go unnoticed.</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Infrastructure</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th width="200">  Domain </th><th width="200"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Date of discovery / appearance </font></font></th></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> link-js.link </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 05/17/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> info-js.link </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 05/17/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> track-js.link </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 05/17/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> map-js.link </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 05/17/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> smart-js.link </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 05/17/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adorebeauty.org </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 09/03/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> security-payment.su </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 09/03/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> braincdn.org </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 09/04/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sagecdn.org </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 09/04/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> slickjs.org </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 09/04/2017 </font></font></td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oakandfort.org </font></font></td><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 09/10/2017 </font></font></td></tr><tr><td align="center"> citywlnery.org </td><td align="center">  09/15/2017 </td></tr><tr><td align="center"> dobell.su </td><td align="center"> 04.10.2017 </td></tr><tr><td align="center"> childsplayclothing.org </td><td align="center"> 31.10.2017 </td></tr><tr><td align="center"> jewsondirect.com </td><td align="center"> 05.11.2017 </td></tr><tr><td align="center"> shop-rnib.org </td><td align="center"> 15.11.2017 </td></tr><tr><td align="center"> closetlondon.org </td><td align="center"> 16.11.2017 </td></tr><tr><td align="center"> misshaus.org </td><td align="center"> 28.11.2017 </td></tr><tr><td align="center"> battery-force.org </td><td align="center"> 01.12.2017 </td></tr><tr><td align="center"> kik-vape.org </td><td align="center"> 01.12.2017 </td></tr><tr><td align="center"> greatfurnituretradingco.org </td><td align="center"> 02.12.2017 </td></tr><tr><td align="center"> etradesupply.org </td><td align="center">  12/04/2017 </td></tr><tr><td align="center"> replacemyremote.org </td><td align="center">  12/04/2017 </td></tr><tr><td align="center"> all-about-sneakers.org </td><td align="center"> 05.12.2017 </td></tr><tr><td align="center"> mage-checkout.org </td><td align="center"> 05.12.2017 </td></tr><tr><td align="center"> nililotan.org </td><td align="center"> 07.12.2017 </td></tr><tr><td align="center"> lamoodbighats.net </td><td align="center">  12/08/2017 </td></tr><tr><td align="center"> walletgear.org </td><td align="center">  12/10/2017 </td></tr><tr><td align="center"> dahlie.org </td><td align="center">  12.12.2017 </td></tr><tr><td align="center"> davidsfootwear.org </td><td align="center">  12/20/2017 </td></tr><tr><td align="center"> blackriverimaging.org </td><td align="center"> 23.12.2017 </td></tr><tr><td align="center"> exrpesso.org </td><td align="center"> 02.01.2018 </td></tr><tr><td align="center"> parks.su </td><td align="center">  09.01.2018 </td></tr><tr><td align="center"> pmtonline.su </td><td align="center"> 12.01.2018 </td></tr><tr><td align="center"> ottocap.org </td><td align="center">  01/15/2018 </td></tr><tr><td align="center"> christohperward.org </td><td align="center"> 27.01.2018 </td></tr><tr><td align="center"> coffetea.org </td><td align="center"> 31.01.2018 </td></tr><tr><td align="center"> energycoffe.org </td><td align="center"> 31.01.2018 </td></tr><tr><td align="center"> energytea.org </td><td align="center"> 31.01.2018 </td></tr><tr><td align="center"> teacoffe.net </td><td align="center"> 31.01.2018 </td></tr><tr><td align="center"> adaptivecss.org </td><td align="center"> 01.03.2018 </td></tr><tr><td align="center"> coffemokko.com </td><td align="center"> 01.03.2018 </td></tr><tr><td align="center"> londontea.net </td><td align="center"> 01.03.2018 </td></tr><tr><td align="center"> ukcoffe.com </td><td align="center"> 01.03.2018 </td></tr><tr><td align="center"> labbe.biz </td><td align="center">  03/20/2018 </td></tr><tr><td align="center"> batterynart.com </td><td align="center">  04/03/2018 </td></tr><tr><td align="center"> btosports.net </td><td align="center"> 09.04.2018 </td></tr><tr><td align="center"> chicksaddlery.net </td><td align="center"> 16.04.2018 </td></tr><tr><td align="center"> paypaypay.org </td><td align="center">  05.11.2018 </td></tr><tr><td align="center"> ar500arnor.com </td><td align="center"> 26.05.2018 </td></tr><tr><td align="center"> authorizecdn.com </td><td align="center"> 28.05.2018 </td></tr><tr><td align="center"> slickmin.com </td><td align="center"> 28.05.2018 </td></tr><tr><td align="center"> bannerbuzz.info </td><td align="center">  06/03/2018 </td></tr><tr><td align="center"> kandypens.net </td><td align="center"> 08.06.2018 </td></tr><tr><td align="center"> mylrendyphone.com </td><td align="center">  06/15/2018 </td></tr><tr><td align="center"> freshchat.info </td><td align="center"> 01.07.2018 </td></tr><tr><td align="center"> 3lift.org </td><td align="center"> 02.07.2018 </td></tr><tr><td align="center"> abtasty.net </td><td align="center"> 02.07.2018 </td></tr><tr><td align="center"> mechat.info </td><td align="center"> 02.07.2018 </td></tr><tr><td align="center"> zoplm.com </td><td align="center"> 02.07.2018 </td></tr><tr><td align="center"> zapaljs.com </td><td align="center">  09/02/2018 </td></tr><tr><td align="center"> foodandcot.com </td><td align="center">  09/15/2018 </td></tr><tr><td align="center"> freshdepor.com </td><td align="center">  09/15/2018 </td></tr><tr><td align="center"> swappastore.com </td><td align="center">  09/15/2018 </td></tr><tr><td align="center"> verywellfitnesse.com </td><td align="center">  09/15/2018 </td></tr><tr><td align="center"> elegrina.com </td><td align="center"> 18.11.2018 </td></tr><tr><td align="center"> majsurplus.com </td><td align="center"> 19.11.2018 </td></tr><tr><td align="center"> top5value.com </td><td align="center"> 19.11.2018 </td></tr></tbody></table></div><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/451792/">https://habr.com/ru/post/451792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451780/index.html">Audit in 60 minutes - free of charge, we check the resilience of employees to phishing attacks through Sophos Phish Threat</a></li>
<li><a href="../451782/index.html">Windows Subsystem for Linux (WSL) version 2: how will it be? (FAQ)</a></li>
<li><a href="../451784/index.html">Hybrid drives for Enterprise storage. Experience using Seagate EXOS</a></li>
<li><a href="../451786/index.html">Run instrumental tests in the Firebase Test Lab. Part 1: iOS project</a></li>
<li><a href="../451790/index.html">Danger of in-game data collection</a></li>
<li><a href="../451794/index.html">Pixel padding in a texture scan</a></li>
<li><a href="../451796/index.html">Writing a secure browser extension</a></li>
<li><a href="../451798/index.html">Migrating data with mongoDB and Spring Boot</a></li>
<li><a href="../4518/index.html">Network insults cost the American $ 11 million</a></li>
<li><a href="../45180/index.html">Habra chat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>