<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cross-platform use of .Net classes in 1C through Native VK. Or replacing COM with Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a continuation of the article ‚ÄúCross-platform use of .Net classes from unmanaged code. Or analogue IDispatch on Linux . ‚Äù 

 There we got the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cross-platform use of .Net classes in 1C through Native VK. Or replacing COM with Linux</h1><div class="post__text post__text-html js-mediator-article">  This is a continuation of the article <a href="https://habrahabr.ru/post/304482/">‚ÄúCross-platform use of .Net classes from unmanaged code.</a>  <a href="https://habrahabr.ru/post/304482/">Or analogue IDispatch on Linux</a> . <a href="https://habrahabr.ru/post/304482/">‚Äù</a> <br><br>  There we got the opportunity to use .Net classes in an unmanaged application.  Now we will use the <a href="https://its.1c.ru/db/metod8dev">‚ÄúCreating Components Using the Native API Technology‚Äù</a> . <br><br>  So, let's begin. <br><a name="habracut"></a><br>  First, let's define the classes to use: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//       typedef bool(*CallAsFunc) (void * , tVariant* , tVariant* , const long); //        //      switch class MethodsArray { public: //     //1      wstring MethodName; //    CallAsFunc Method; //  long ParamCount; //   bool HasRetValue; //    void Init(wstring MethodName, CallAsFunc Method, long ParamCount, bool HasRetValue); }; /////////////////////////////////////////////////////////////////////////////// // class CAddInNative class BaseNetObjectToNative : public IComponentBase { public: static BaseNetObjectToNative* pCurrentObject; //     MethodsArray* pMethodsArray; //    int SizeArray; //    1 wstring ClassName; //     wstring MethodName; //        .Net ManagedDomainLoader* NetProvider; //    .Net     . wstring RefNetObject; //       .Net long IdNetObject; //     MethodsArray* CurrentElem; //              long LastParamsIndex;</span></span></code> </pre> <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoaderCLR</span></span></span><span class="hljs-class"> :</span></span><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BaseNetObjectToNative { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-comment"><span class="hljs-comment">//      MethodsArray MethodsArray[2]; LoaderCLR(); virtual ~LoaderCLR(); virtual bool ADDIN_API Init(void* pConnection); virtual bool ADDIN_API setMemManager(void* memManager); //     .Net static bool CreateDamain(void* Self, tVariant* pvarRetValue, tVariant* paParams, const long lSizeArray); //     DLL static bool LoadDLL(void* Self, tVariant* pvarRetValue, tVariant* paParams, const long lSizeArray); //          .Net static void* GetMem(long ByteCount); //          .Net static void AddError(const wchar_t* ErrorInfo); }; class NetObjectToNative :public BaseNetObjectToNative { public: MethodsArray MethodsArray[3]; NetObjectToNative(); //              .Net static bool SetNetObjectRef(void* Self, tVariant* pvarRetValue, tVariant* paParams, const long lSizeArray); //       static bool GetNetObjectRef(void* Self, tVariant* pvarRetValue, tVariant* paParams, const long lSizeArray); };</span></span></code> </pre><br><br>  We now turn to the implementation.  I will dwell only on the main <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------// long BaseNetObjectToNative::FindProp(const WCHAR_T* wsPropName) { //     .Net . if (NetProvider == nullptr) return -1; long plPropNum = 1; //  MethodName   GetPropVal  SetPropVal //       .Net MethodName = wsPropName; return plPropNum; } //---------------------------------------------------------------------------// const WCHAR_T* BaseNetObjectToNative::GetPropName(long lPropNum, long lPropAlias) { //   MethodName  . return 0; } //---------------------------------------------------------------------------// bool BaseNetObjectToNative::GetPropVal(const long lPropNum, tVariant* pvarPropVal) { //          SetMemoryManager(); //     .Net .        //MethodName return NetProvider-&gt;pGetPropVal(IdNetObject,MethodName.c_str(), pvarPropVal); } //---------------------------------------------------------------------------// bool BaseNetObjectToNative::SetPropVal(const long lPropNum, tVariant* varPropVal) { //  GetPropVal return NetProvider-&gt;pSetPropVal(IdNetObject, MethodName.c_str(), varPropVal); } //---------------------------------------------------------------------------// bool BaseNetObjectToNative::IsPropReadable(const long lPropNum) { //     .Net. // ,      ,   //      .    1    . return true; } //---------------------------------------------------------------------------// bool BaseNetObjectToNative::IsPropWritable(const long lPropNum) { //  IsPropReadable return true; } //---------------------------------------------------------------------------// long BaseNetObjectToNative::GetNMethods() { //     return 0; } //---------------------------------------------------------------------------// long BaseNetObjectToNative::FindMethod(const WCHAR_T* wsMethodName) { //    MethodName = wsMethodName; //        long res= findMethod(MethodName); if (res==0 &amp;&amp; NetProvider == nullptr) return -1; //    .Net     params //   ,    . //LastParamsIndex          LastParamsIndex = -1; MethodName = wsMethodName; return res; } //---------------------------------------------------------------------------// const WCHAR_T* BaseNetObjectToNative::GetMethodName(const long lMethodNum, const long lMethodAlias) { return 0;//MethodName.c_str(); } //---------------------------------------------------------------------------// long BaseNetObjectToNative::GetNParams(const long lMethodNum) { //     //   16  if (lMethodNum==0) return NetProvider-&gt;pGetNParams(IdNetObject, MethodName.c_str()); else return CurrentElem-&gt;ParamCount; } //---------------------------------------------------------------------------// bool BaseNetObjectToNative::GetParamDefValue(const long lMethodNum, const long lParamNum, tVariant *pvarParamDefValue) { //         //          if (LastParamsIndex == -1) LastParamsIndex = lParamNum; pvarParamDefValue-&gt;vt = VTYPE_I4; pvarParamDefValue-&gt;lVal = 0; return true; } //---------------------------------------------------------------------------// bool BaseNetObjectToNative::HasRetVal(const long lMethodNum) { if (lMethodNum &gt; 0) return CurrentElem-&gt;HasRetValue; //  .Net      .   ,   null return true; } //---------------------------------------------------------------------------// bool BaseNetObjectToNative::CallAsProc(const long lMethodNum, tVariant* paParams, const long lSizeArray) { //  .  1        ,    HasRetVal if (lMethodNum==0) { SetMemoryManager(); if (LastParamsIndex == -1) LastParamsIndex = lSizeArray; return NetProvider-&gt;pCallAsFunc(IdNetObject, MethodName.c_str(), 0, paParams, LastParamsIndex); } return CurrentElem-&gt;Method(this, 0, paParams, lSizeArray); } //---------------------------------------------------------------------------// bool BaseNetObjectToNative::CallAsFunc(const long lMethodNum, tVariant* pvarRetValue, tVariant* paParams, const long lSizeArray) { //  .  1        ,    HasRetVal //       1    . pvarRetValue-&gt;vt = VTYPE_NULL; pvarRetValue-&gt;lVal = 0; if (lMethodNum == 0) { SetMemoryManager(); if (LastParamsIndex == -1) LastParamsIndex = lSizeArray; return NetProvider-&gt;pCallAsFunc(IdNetObject, MethodName.c_str(), pvarRetValue, paParams, LastParamsIndex); } return CurrentElem-&gt;Method(this, pvarRetValue, paParams, lSizeArray); } //----------------------------</span></span></code> </pre><br><br>  These are the main methods.  Now you can go to the code calls from 1C. <br><br>  First, we declare variables and auxiliary functions. <br><br><pre> <code class="1c hljs"><span class="hljs-keyword"><span class="hljs-keyword"></span></span> ,; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) <span class="hljs-comment"><span class="hljs-comment">//        .Net  //   &lt;&gt;‚Ññ_%)?&amp;2  12        //        .Net  = ("AddIn.NetObjectToNative.NetObjectToNative"); .();    // ()  () //     = ("AddIn.NetObjectToNative.NetObjectToNative"); //    .();    // () //      //             ()  (.());  //      //         ()  (.());   () //     AddInNetObjectToNative.dll // NetObjectToNative.dll //   Microsoft.NETCore.App\1.0.0\ //    32     1 32  //    https://github.com/dotnet/cli //     64  Core Clr = (.); =.; =+"\AddInNetObjectToNative.dll"; (, "NetObjectToNative",.Native);  = ("AddIn.NetObjectToNative.LoaderCLR"); CoreClrDir=+"\bin\"; NetObjectToNative=; =.(CoreClrDir,NetObjectToNative,""); .DLL(); </span></span></code> </pre><br><br>  Now, rubbing your hands, you can create code to use .Net in 1C.  And this exciting moment has come! <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) =(.<span class="hljs-keyword"><span class="hljs-keyword"></span></span>(<span class="hljs-string"><span class="hljs-string">"System.Text.StringBuilder"</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>)); CultureInfo=(<span class="hljs-string"><span class="hljs-string">"System.Globalization.CultureInfo"</span></span>); CultureInfoES=(.<span class="hljs-keyword"><span class="hljs-keyword"></span></span>(CultureInfo.(),<span class="hljs-string"><span class="hljs-string">"es-ES"</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(.Capacity); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(.()); InvariantCulture=(CultureInfo.InvariantCulture); <span class="hljs-comment"><span class="hljs-comment">//   1              //      =.Append(" "); .(); =.AppendLine(); .(); =.Append(" "); .(); =.AppendLine(); .(); =.AppendFormat("AppendFormat {0}, {1}, {2}, {3}, {4},", "", 21, 45.89, (), ); .(); =.AppendLine(); .(); //                =.AppendFormat(CultureInfoES.(),"AppendFormat {0}, {1}, {2}, {3}, {4},", "", 21, 45.89, (), ); .(); =.AppendLine(); .(); =.AppendFormat(InvariantCulture.(),"AppendFormat {0}, {1}, {2}, {3}, {4},", "", 21, 45.89, (), ); (.ToString()); (" ="+.Capacity); //   .Capacity=.Capacity+40; ("  ="+.Capacity); //     ultureInfo    </span></span></code> </pre><br><br>  Immediately, I note that for some reason 1C wants to set the InvariantCulture property, although nobody asks for it. <br>  If I call the Sb.Apppend method (‚ÄúNew Line‚Äù);  as a procedure, 1C still calls as a function and on the .Net side is stored in the list from which it is necessary to free it. <br><br>  Now let's see a more complex example. <br><br><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//  HttpClient   Get     //                  //      HttpClient=("System.Net.Http.HttpClient, System.Net.Http, Version=4.0.1.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"); HttpClientHandler = ("System.Net.Http.HttpClientHandler, System.Net.Http, Version=4.0.1.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"); DecompressionMethods= ("System.Net.DecompressionMethods, System.Net.Primitives, Version=4.0.11.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"); handler = (HttpClientHandler.()); //    .     //handler.AutomaticDecompression=.OR(DecompressionMethods.GZip,DecompressionMethods.Deflate); GZip=DecompressionMethods.GZip; Deflate=DecompressionMethods.Deflate; //  1   .     .Net   handler.AutomaticDecompression=.OR(GZip,Deflate); .(GZip); .(Deflate);  = (.(HttpClient.(),handler.())); uriSources ="https://msdn.microsoft.com/en-us/library/system.net.decompressionmethods(v=vs.110).aspx"; =(.GetStringAsync(uriSources)).Result; (());</span></span></code> </pre><br><br>  Wow, and it works! <br><br>  You can load third-party libraries. <br><br><pre> <code class="1c hljs">=(<span class="hljs-string"><span class="hljs-string">"TestDllForCoreClr., TestDllForCoreClr, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span>); =(.<span class="hljs-keyword"><span class="hljs-keyword"></span></span>(.(),<span class="hljs-string"><span class="hljs-string">"   "</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(.); .=<span class="hljs-string"><span class="hljs-string">"  1"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(.); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(.); .=(<span class="hljs-string"><span class="hljs-string">"   1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(.); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(.());</code> </pre><br><br>  We now turn to the sadder. <br>  In the previous article there was a speed test, the call time was only more than 300,000 calls per second. <br><br>  We will conduct a similar test for 1C: <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">// ()  2() //   . =200000; =("TestDllForCoreClr., TestDllForCoreClr, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"); =(.(.(),"   ")); stopWatch = ("System.Diagnostics.Stopwatch,System.Runtime.Extensions, Version=4.0.11.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"); =""; .(1); =(); stopWatch.Start();  =1    .(); ; stopWatch.Stop(); =()-; (" ="+); (stopWatch); =(); stopWatch.Restart();  =1    (); ; stopWatch.Stop(); =()-; (" ="+); (stopWatch); </span></span></code> </pre><br><br>  00: 00: 06.45 For .Net <br>  00: 00: 01.20 For 1C <br><br>  That is, the call rate has decreased to 30,000 calls per second. <br>  But this is enough, usually heavier methods are called. <br><br>  Added support for objects with IDynamicMetaObjectProvider support <br><br>  For the test, create ExpandoObject <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> ExpandoObject() { <span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ExpandoObject(); res. = <span class="hljs-string"><span class="hljs-string">" ExpandoObject"</span></span>; res. = <span class="hljs-number"><span class="hljs-number">456</span></span>; res. = (Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;)(() =&gt; res.); res. = (Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;)((x, y) =&gt; x + y); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre><br><br>  And the heir to DynamicObject <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestDynamicObject</span></span> : <span class="hljs-title"><span class="hljs-title">DynamicObject</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrySetMember</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SetMemberBinder binder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//   public override bool TryGetMember(GetMemberBinder binder, out object result) { result = binder.Name; return true; } //   public override bool TryInvokeMember(InvokeMemberBinder binder, object[] args, out object result) { var res = new StringBuilder("{0}("); var param = new object[args.Length + 1]; param[0] = binder.Name; if (args.Length &gt; 0) { Array.Copy(args, 0, param, 1, args.Length); for (int i = 0; i &lt; args.Length; i++) { res.AppendFormat("{{{0}}},", i + 1); } res.Remove(res.Length - 1, 1); } res.Append(")"); result = String.Format(res.ToString(), param); return true; } }</span></span></code> </pre><br><br>  Now you can call on 1C <br><br><pre> <code class="1c hljs">=(<span class="hljs-string"><span class="hljs-string">"TestDllForCoreClr., TestDllForCoreClr, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span>); =(.<span class="hljs-keyword"><span class="hljs-keyword"></span></span>(.(),<span class="hljs-string"><span class="hljs-string">"   "</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//   ,     =(.ExpandoObject()); ("="+.()); ("=" + .(1, 2)); (.); (.); .=" "; .=768; //    .=" "; (.); (.); (.); =(.("System.Dynamic.ExpandoObject, System.Dynamic.Runtime, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a")); .=" "; .=123; .=.(); ((.).); TestDynamicObject=("TestDllForCoreClr.TestDynamicObject, TestDllForCoreClr, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"); =(TestDynamicObject.()); .="  "; ( .); (.(1,3.45,()));</span></span></code> </pre><br><br>  This is convenient when working with various parsers. <br><br>  Added type inference for generic methods <br>  Now you can not display a separate method <br><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">// public T &lt;V, T&gt;(V param1, T param2, V param3) (.(1,"",3)); // //public V 2&lt;K, V&gt;(Dictionary&lt;K, V&gt; param1, K param2, V param3) = ("System.Collections.Generic.Dictionary`2[System.Int32,System.String]"); (.2(.(),3,"2")); // public K 3&lt;K&gt;(IList&lt;K&gt; param1, int param2, K param3) List=("System.Collections.Generic.List`1[System.String]"); (.3(List.(),3,"3"));</span></span></code> </pre><br><br>  Made support external event <br>  In the class, create a body of type Action &lt;string, string, string&gt; <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>  { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    . public async void Test() { for(int i=0;i&lt;100; i++) { var  = i.ToString(); Task.Run(async() =&gt; { await Task.Delay(1000).ConfigureAwait(false); 1?.DynamicInvoke("", "", ); }); await Task.Delay(50).ConfigureAwait(false); } }</span></span></code> </pre><br>  In 1C. <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) <span class="hljs-comment"><span class="hljs-comment">//   . ("="+); ("="+); ("="+);   () //   . =("TestDllForCoreClr., TestDllForCoreClr, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"); =(.(.(),"   ")); =(.1C()); .1=.(); .Test(); </span></span></code> </pre><br>  And do not forget to install in the Variables module <br><pre> <code class="1c hljs"><span class="hljs-keyword"><span class="hljs-keyword"></span></span> ;</code> </pre><br><br>  In the future, I will add <a href="http://infostart.ru/public/417830/">.NET (C #)</a> analogue <a href="http://infostart.ru/public/417830/">for 1C.</a>  <a href="http://infostart.ru/public/417830/">Dynamic compilation of a wrapper class for using .Net events in 1C via Add Handler or Processing an External Event</a> <br><br>  Now it is worth talking about the shortcomings of the 1C implementation of the Technology of External Components. <br><br>  1. Absolutely not needed methods are FindMethod, FindProp, IsPropReadable, IsPropWritable, GetNParams, HasRetVal, GetParamDefValue <br>  Since the methods <br>  bool CallAsProc <br>  bool CallAsFunc <br>  bool SetPropVal and bool GetPropVal is the return value for success <br>  Error information is returned via AddError. <br>  And the index call is an anachronism from IDiapatch where there was a description of the interfaces <br>  to increase call speed. <br><br>  2. When returning with the SetPropVal and GetPropVal methods, an exception is not raised. <br>  3. Why does the installation of properties occur, where it is not required in the code? <br>  4. A method is called as a function, where the method is called as a procedure. <br><br>  5. One of the main ones is that it is impossible to return and transfer a copy of the VK from the VK methods. <br><br>  I personally do not see any problems.  Determine the value for this type and set the link in the pInterfaceVal field. <br><br>  Reference counting takes place on the 1C side.  It is possible to transfer including 1C objects only for the duration of the method call. <br><br>  In the future, you can develop to use the events of .Net objects in 1C following the example of <a href="http://infostart.ru/public/417830/">.NET (C #) for 1C.</a>  <a href="http://infostart.ru/public/417830/">Dynamic compilation of a wrapper class for using .Net events in 1C via Add Handler or Processing an External Event</a> <br><br>  Use asynchronous calls by the example <a href="http://infostart.ru/public/466052/">".Net in 1C. Asynchronous HTTP requests, sending Post several multipart / form-data files, compressing traffic using gzip, deflate, convenient parsing of sites, etc."</a> <br><br>  In general, .Net integration is in Microsoft Dynamics AX <a href="https://blogs.msdn.microsoft.com/x/2010/01/19/traversing-elements-in-an-ienumerable-from-x/">ClrObject</a> . <br><br>  Using cross-platform Core Clr can be integrated into 1C.  This is especially true for Linux as import substitution. <br>  While checked running on Windows 7.10.  Linux and IOS yet, but soon I will check on the virtual machine.  .Net Core CLR can be downloaded <a href="https://github.com/dotnet/cli">here.</a> <br>  With what I would love to help 1C.  There is a huge experience of using .Net classes in 1C. <br><br>  Sources and tests can be viewed <a href="https://yadi.sk/d/jRSHEA19svgrn">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/304542/">https://habr.com/ru/post/304542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304532/index.html">Critical vulnerability of Symantec Endpoint antivirus allows remote code execution</a></li>
<li><a href="../304534/index.html">Drum machine on the neural network</a></li>
<li><a href="../304536/index.html">Process management. Do not exceed RPS API limit (QPS)</a></li>
<li><a href="../304538/index.html">Fintech: why are programmers waiting here</a></li>
<li><a href="../304540/index.html">Improved interaction experience through the use of cards in the design</a></li>
<li><a href="../304546/index.html">ZigBee and Intel Edison: the practice of automating meeting rooms</a></li>
<li><a href="../304548/index.html">My cool stories</a></li>
<li><a href="../304550/index.html">My condolences: now you support the popular open source project</a></li>
<li><a href="../304554/index.html">Supermen on the assembly line: how we made an exoskeleton for teachers</a></li>
<li><a href="../304556/index.html">Teach children to program - they will change the world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>