<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Avoiding Hell with Monads</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As programmers, we sometimes find ourselves in a ‚Äúprogrammer hell‚Äù, a place where our usual abstractions do not cope with solving a number of recurrin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Avoiding Hell with Monads</h1><div class="post__text post__text-html js-mediator-article"><p><img align="right" src="https://habrastorage.org/web/814/47a/733/81447a733da24283b56ec84793f3d362.jpg">  As programmers, we sometimes find ourselves in a ‚Äúprogrammer hell‚Äù, a place where our usual abstractions do not cope with solving a number of recurring problems. </p><br><p>  This article will discuss such problems, the syntactic constructs used to solve them, and finally how these problems can be solved uniformly with the help of monads. </p><br><h2 id="ad-proverki-na-null">  Null check hell </h2><br><p>  This problem occurs when several partial functions (functions that may not return a value) must be executed sequentially. </p><br><p>  Such functions usually result in deeply embedded and hard-to-read code with an excessive amount of syntactic noise. </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = getData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = getMoreData(a); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = getMoreData(b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = getEvenMoreData(a, c) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { print(d); } } } }</code> </pre> <a name="habracut"></a><br><h3 id="vstroennoe-reshenie-elvis-operator">  Embedded Solution: Elvis Operator </h3><br><p>  This is a special (?.) Syntax that helps navigate between calls to partial functions.  Unfortunately, it is unnecessarily tied to the object-oriented style of entries and access to methods. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = getData(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = a?.getMoreData(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = b?.getMoreData(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = c?.getEvenMoreData(a); print(d);</code> </pre> <br><h3 id="monada-maybe">  Monad Maybe </h3><br><p>  If our functions explicitly return the type Maybe (sometimes he calls Option), we can chain these functions using do notation (using the fact that Maybe / Option is monadic). </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">do</span></span> a &lt;- getData b &lt;- getMoreData a c &lt;- getMoreData b d &lt;- getEvenMoreData ac print d</code> </pre> <br><h2 id="ad-for-cikla">  Cycle hell </h2><br><p>  The problem arises when you need to go through several dependent data sets.  Just like when checking for null, the code becomes deeply nested with a lot of syntactic noise. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = getData(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a_i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = getMoreData(a_i); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b_j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> b) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = getMoreData(b_j); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c_k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> c) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = getMoreData(c_k); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d_l <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d) { print(d_l); } } } }</code> </pre> <br><h3 id="vstroennoe-reshenie-spiskovoe-vklyuchenie">  Embedded solution: List inclusion </h3><br><p>  A more elegant solution to the problem was found with the introduction of a special syntactic structure called list inclusion, much like SQL ( <em>for example, in C # the similarity reaches a maximum in approx. Transl.</em> ). </p><br><pre> <code class="python hljs">[ print(d) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> getData() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> getMoreData(a) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> getMoreData(b) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> getEvenMoreData(a, c) ]</code> </pre> <br><h3 id="list-monada">  List Monad </h3><br><p>  Having noticed that the lists are monads and using do-notation, you can write the same elegant solution without any additional syntax. </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">do</span></span> a &lt;- getData b &lt;- getMoreData a c &lt;- getMoreData b d &lt;- getEvenMoreData ac print d</code> </pre> <br><h2 id="ad-kolbekov">  Hell kolbekov </h2><br><p>  The most famous and possibly the most painful circle of hell.  Here, the inversion of control is necessary for the implementation of asynchrony that is conducted to deeply nested code and syntactic noise, difficulty in tracking error handling and a number of other sores. </p><br><pre> <code class="javascript hljs">getData(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function"> =&gt;</span></span> getMoreData(a, b =&gt; getMoreData(b, c =&gt; getEvenMoreData(a, c, d =&gt; print(d), err =&gt; onErrorD(err) ) err =&gt; onErrorC(err) ), err =&gt; onErrorB(err) ), err =&gt; onErrorA(err) )</code> </pre> <br><h3 id="vstroennoe-reshenie-asyncawait">  Embedded solution: async / await </h3><br><p>  To overcome this complexity, another special syntax was invented - async / await.  Typically, this approach delegates error handling using the try / catch syntax, which in itself leads to another hell. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getData <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getMoreData(a) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getMoreData(b) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getEvenMoreData(a, c) print(d) }</code> </pre> <br><h3 id="vstroennoe-reshenie-promises">  Embedded solution: Promises </h3><br><p>  Promises is another possible solution (also Futures / Tasks).  While the problem with attachments is partially solved, using the result of promises in several places forces us to manually create a lexical script for such values.  This will result in one level of investment for each variable used in several places.  In addition, using promises directly through the then syntax is not as clean as using async / await </p><br><pre> <code class="javascript hljs">getData().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function"> =&gt;</span></span> getMoreData(a) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">b</span></span></span><span class="hljs-function"> =&gt;</span></span> getMoreData(b)) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> getEvenMoreData(a, c)) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function"> =&gt;</span></span> print(d) );</code> </pre> <br><h3 id="monada-continuation">  Monad Continuation </h3><br><p>  It should no longer be a surprise that we can solve this problem using the same approach as for the two previous problems (noting that promises form a monad). </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">do</span></span> a &lt;- getData b &lt;- getMoreData a c &lt;- getMoreData b d &lt;- getEvenMoreData ac print d</code> </pre> <br><h2 id="ad-peredachi-sostoyaniya">  Transfer status hell </h2><br><p>  Even without side effects in the world of pure functions there are difficulties.  In some cases, excessive parameter transfer between functions can be a problem. </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> (a, st1) = getData initalState (b, st2) = getMoreData (a, st1) (c, st3) = getMoreData (b, st2) (d, st4) = getEvenMoreData (a, c, st3) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print(d)</code> </pre> <br><h3 id="vstroennoe-reshenie-imperativnye-yazyki">  Embedded solution: imperative languages </h3><br><p>  This problem can be solved by using an implicit state, which allows functions to communicate with each other without explicitly passing all parameters.  Unfortunately, the use of an imperative model significantly complicates the understanding of the code.  The life cycle and size of the state usually has no static bounds. </p><br><pre> <code class="javascript hljs">a = getData(); b = getMoreData(a); c = getMoreData(b); d = getEvenMoreData(a, c); print(d)</code> </pre> <br><h3 id="monada-state">  Monad State </h3><br><p>  This monad allows you to use pure functional states for which there are no external links, which allows you to use many useful operations, such as state serialization or the implementation of functions such as excursion, something similar to what I do libraries like Redux. </p><br><p>  The State Monad limits the life cycle of computing with the state and ensures that the programs remain easy to understand. </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">do</span></span> a &lt;- getData b &lt;- getMoreData a c &lt;- getMoreData b d &lt;- getEvenMoreData ac print d</code> </pre> <br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Monads can solve a number of problems in a uniform way.  Instead of complicating the design and grammar of the language with additional syntax, we can solve them with the help of a monadic library which in turn can be adapted to solve a number of other problems. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/329242/">https://habr.com/ru/post/329242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329232/index.html">How cloud can help future technology</a></li>
<li><a href="../329234/index.html">8 skills required in the profession of Data Scientist</a></li>
<li><a href="../329236/index.html">Games and gameplay: different types of players</a></li>
<li><a href="../329238/index.html">We do GraphQL API on PHP and MySQL. Part 2: Mutations, Variables, Validation and Security</a></li>
<li><a href="../329240/index.html">JSF 2 + Maven + Jetty. Training</a></li>
<li><a href="../329244/index.html">What addresses do we see in traceroute</a></li>
<li><a href="../329246/index.html">Loading real landscapes in unity 3d</a></li>
<li><a href="../329248/index.html">Clever blocking bypass in Ukraine</a></li>
<li><a href="../329250/index.html">Artists map, awkward search for links in the data and how to reinvent the wheel</a></li>
<li><a href="../329252/index.html">Golos - study in practice. First conclusions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>