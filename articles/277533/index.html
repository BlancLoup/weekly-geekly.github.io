<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a user interface for Blend4Web (Part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes I consider myself a pioneer, opening new pages using Blend4Web. This is a young engine, with an energetic development team, rich features an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a user interface for Blend4Web (Part 1)</h1><div class="post__text post__text-html js-mediator-article">  Sometimes I consider myself a pioneer, opening new pages using Blend4Web.  This is a young engine, with an energetic development team, rich features and a lot of not-well-documented features.  Something I scoop from the source of a large number of demos, pull developers on all sorts of questions, and most often I act by the method of ‚Äúscientific poking‚Äù.  In this article I want to share my work on creating a user interface for an application.  And what is important, with the help of Blend4Web and HTML5 you can make quite a decent GUI game. <br><br><img src="https://habrastorage.org/files/1bc/646/493/1bc646493f2943348c4a72f8812c50fe.jpg"><br><a name="habracut"></a><br>  In the game, when the ships fly, successfully shooting hordes of meteorites and their own kind, I want to see a little more on the screen, that is, to receive any information about the gameplay.  These are all sorts of text messages about missions or points earned, ‚Äúlife strips‚Äù, etc.  All these elements can be created in two ways: using the HTML / CSS functions and through Blender / JavaScript. <br><br>  In December 2015, the next Blend4Web release was released with a curious feature.  The conversation is about the tool <b>Viewport Alignment</b> - it is nothing more than a tool for automatically aligning user interface elements with respect to the camera.  It seems nothing surprising, but you need to know that the traditional GUI layout for the Blend4Web application is done using HTML / CSS.  To me personally, this approach seems inconvenient and I prefer to do everything in Blender itself.  Previously, it was difficult, because the interface ‚Äúsprawled‚Äù when changing the resolution or proportions of the screen.  It is now possible to avoid HTML problems and create GUIs directly in the Blender scene. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Static elements </h4><br>  From the point of view of Blend4Web, the GUI element is no different from any object in the scene, except that it is tied to the active camera.  All the magic is done in Blender itself. <br><br>  GUI elements are traditionally considered two-dimensional, but in the case of Blend4Web, they are always three-dimensional objects.  True, they can look different.  The easiest option is to create a plane (Plane) with a stretched texture. <br><br>  There is a handy plugin called <i>‚ÄúImport Images as Planes‚Äù</i> , which is included in the basic Blender package.  Its purpose is to create a plane with an already finished texture.  It really speeds up the process, after all, just select the desired picture and it appears on the scene.  But I do not recommend using this plugin for GUI for one simple reason - it is not optimal.  It is desirable to store all drawn interface elements on one texture, i.e.  create the so-called atlas. <br><br>  You can draw the interface in anything, but it is important to fit everything on a texture with the same aspect ratio of a multiple of 4, for example, 512x512, 1024x1024.  And do not get involved in size.  Too small texture is bad, too big is also not very.  So, the maximum size should be limited to a resolution of 2048x2048, although for me this is a lot.  In general, it is considered to be good practice to output interface elements pixel to pixel, without any scaling.  But in our case it is unrealistic, because each element is an ordinary three-dimensional object. <br><br>  So it turns out that the creation of the interface is performed using standard Blender tools.  Consider the basic steps: <br><br><ul><li>  Create a Plane primitive ( <i>menu ADD | Mesh</i> ).  First, switch to the Camera view.  When you add a Plane to the scene, pay attention to the additional panel on the left with the parameters of the created primitive.  There is an option <i>Align To View</i> .  If you activate it, Plane will turn to face the camera. </li><li>  Adjust the UV coordinates.  It is more convenient to do this with the UV Editing window layout enabled.  Select your plane, press Tab to go to edit mode and <i>U -&gt; Unwrap</i> to set coordinates.  Just pre-open in the next window the desired texture.  Now, using standard Blender movement and scaling methods (hotkeys G and S), place the vertices of UV around the desired pattern. </li></ul><br><br><img src="https://habrastorage.org/files/549/cdd/bfd/549cddbfda314021bf937c87c5e60bb7.jpg"><br><br><ul><li>  Create material and adjust texture.  In principle, this action is no different from the usual work with materials in Blender.  Look at the picture below.  I outlined the key options for adjusting the texture and material with transparency.  The <i>Shadeless</i> option is also included <i>here</i> .  This is useful if you want your material to not respond to light sources. </li></ul><br><br><img src="https://habrastorage.org/files/2ca/9ff/4a7/2ca9ff4a704946a3a514f9bc5c03e23d.jpg"><br><br>  So, in the scene there is a plane with a texture turned towards the camera.  It is time to consider the Viewport Alignment tool (do not forget that the options of the Blend4Web engine will only be visible after selecting the same-named render). <br><br>  Viewport Alignment allows you to ‚Äúattach‚Äù the selected object to the borders or corners of the active camera.  By doing this in Blender, you will be sure that the interface elements will remain in place regardless of the screen resolution. <br><br>  First you need to create a parent-child relationship between your plane and the camera itself.  Highlight Plane, and then Camera with the <i>Shift</i> key pressed.  In the <i>Object -&gt; Parent</i> menu, select <i>Object</i> .  If everything is done correctly, then when moving the camera, the plane will obediently slide after it. <br><br>  And only now will the Viewport Alignment options in the Object panel become available. <br><br><img src="https://habrastorage.org/files/197/aea/590/197aea590e2a470b85e3b76439108542.jpg"><br><br>  Turn on Viewport Alignment and select the desired side to bind from the menu.  If you now try to export the scene and view the result in the browser, then most likely you will get an amazing result.  The object will ‚Äústick‚Äù to the selected place, but it will not look at all like it was expected. <br><br>  The panel has a <i>Fit to Camera</i> button.  With its help, you can place an object in accordance with the chosen parameters of the reference and distance ( <i>Distance</i> option).  Therefore, by clicking on it, you finally move the item to the right place.  There is another nuance that for some reason is not explained in the official documentation. <br><br>  The fact is that the binding is performed depending on the center of the object.  And for proper installation, it must be shifted in the right direction.  The figure below highlights the center of the element, which is pressed to the top right corner. <br><br>  To shift the center, go to edit mode ( <i>Tab</i> key). Place the 3D cursor in the desired place (by clicking the left mouse button) and select the menu item <i>Object -&gt; Transform -&gt; Origin to 3D Cursor.</i> <br><br><img src="https://habrastorage.org/files/4f3/e4e/e23/4f3e4ee23a64473c8d21ae75e33e0d74.jpg"><br><br>  In this simple way, you can create any interface elements that are attached to the camera and automatically change their location when the screen resolution changes <br><br>  By the way, even though I called this part of the lesson ‚ÄúStatic Elements‚Äù, nothing prevents you from creating any animations for GUI elements.  All this is done in the standard ways for Blender. <br><br><h4>  Dynamic elements </h4><br>  Do you think I'll start talking about cool animation effects?  No, I will leave this fertile ground to other authors, and let me pass on to what topic ... <br><br>  In the game, all kinds of indicators are very often needed: life, protection, weapon heating, etc.  Their visual appearance depends on the current action.  The hero is rich in ‚Äúlife‚Äù - a long strip, loses ‚Äúlife‚Äù and the strip decreases. <br><br>  The simplest thing that comes to mind is to create object animation, say, with a change in scale.  But we must also take into account the convenience of working with such an animation, because the size of the indicator must correspond to a certain numerical value.  Therefore, the most advantageous is the change in geometry, the so-called vertex animation.  Moreover, it is enough to create two forms: initial and final.  And the transitions between them to perform from the code. <br><br>  Algorithm for creating shape animation (see figure below): <br><ul><li>  Give the object its initial shape. </li><li>  Go to the Object Data panel and set the base key (in the screenshot it is called Basis). </li><li>  Add a new key (key 1) and set the Value to one. </li><li>  Go to edit mode and give the object a final shape. </li><li>  Open the Object panel and enable the Export Shape Keys option. </li></ul><br><br><img src="https://habrastorage.org/files/11c/261/9ff/11c2619ff8e545809f5f29e99e01bfec.jpg"><br><br>  If everything is done correctly, then when the Value value changes, the geometry of the object will change. <br><br>  This is where the magic lies.  The Blend4Web API allows you to control the Value parameter from code.  Its values ‚Äã‚Äãvary from 0 to 1, so it is easy to write a function to adapt any digital data in relation to the animation of the status bar. <br><br>  A small example: <br><br><pre><code class="javascript hljs">... var m_scene = b4w.require(<span class="hljs-string"><span class="hljs-string">"scenes"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_geom = b4w.require(<span class="hljs-string"><span class="hljs-string">"geometry"</span></span>); ‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">//      "Object Name" var obj = m_scene.get_object_by_name("Object Name"); //  Value  Key 1,  0.5 (50%) m_geom.set_shape_key_value(obj , "Key 1", 0.5); ...</span></span></code> </pre> <br><br><h4>  Text output </h4><br>  These are all sorts of messages, points earned and all that kind of thing that allows the player to get a return on the gameplay. <br><br>  At first glance, Blend4Web has nothing to display textual information on the screen, not in the form of pictures or 3D, but of plain text itself.  To be honest, I was at first confused when I tried to implement a simple printing of the Score.  No native functions were found in the API.  But there is an excellent mechanism for working with HTML5 Canvas.  And already with his help with the text, you can work wonders. <br><br>  Working with HTML5 canvas in the official documentation of the engine is considered very sparingly.  Some important points are simply not taken into account.  Hereinafter I will try to tell about them. <br><br>  So, the basis of the canvas in the world of Blend4Web is any surface of a three-dimensional object.  This means that you can display textual or other information on the canvas (for example, video), and then work with this object as you please.  There are ample opportunities for the coolest effects.  After all, the 3D model with canvas is no different from any other three-dimensional object - rotate, scale, apply animation and physics.  Here is <a href="https://www.blend4web.com/apps/code_snippets/code_snippets.html%3Fscene%3Dcanvas_texture">an example of working with canvas</a> that the developers themselves give. <br><br>  In my game for the Score, I used a simple rectangular plane attached to a corner of the screen.  There is no need to apply any special settings to the carrier object.  The material is created the most common, but the texture used is special. <br><br>  Preparing an object surface for HTML5 Canvas output: <br><ul><li>  Create a UV scan for the plane where the canvas is supposed to be displayed.  Be careful and start placing your UV grid from the top of the texture.  For some reason, I initially placed UV at the bottom of the texture and lost a lot of time trying to figure out why there is no rendering. </li></ul><br><br><img src="https://habrastorage.org/files/143/cd5/0dc/143cd50dcac74fd3a1cee23f9adaa97d.jpg"><br><br><ul><li>  Add a new None texture to the texture slot of the material.  Give it a normal name. </li><li>  In the texture options, set the Source Type as Canvas. </li></ul><br>  In principle, everything.  Go to the code. <br><br>  In the examples on the website Blend4Web there is a <a href="https://www.blend4web.com/ru/article/87/">ready-made piece of code</a> that literally displays text on the canvas.  That's what I used in my project.  I quote with some changes and additions. <br><br><pre> <code class="javascript hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_tex = b4w.require(<span class="hljs-string"><span class="hljs-string">"textures"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_scene = b4w.require(<span class="hljs-string"><span class="hljs-string">"scenes"</span></span>); ... <span class="hljs-comment"><span class="hljs-comment">//    var text = ["Hello‚Äù, ‚ÄúWorld!"]; var MARGIN_LEFT = 250; var LINE_SPACING = 10; var MARGIN_TOP = 120; //  -  var obj = m_scene.get_object_by_name("Object"); //     var ctx_image = m_tex.get_canvas_ctx(obj, "tex_id"); var font = ctx_image.font.split("px"); var font_height = parseInt(font[0]); //HTML5 Canvas    ctx_image.fillStyle = "rgba(255,230,0,255)"; ctx_image.clearRect(0,0,512,512); ctx_image.font = "120px Arial"; ctx_image.textAlign = "start"; //  for (var i = 0; i &lt; text.length; i++) ctx_image.fillText(text[i], MARGIN_LEFT, Math.round(LINE_SPACING * font_height * i + MARGIN_TOP)); //   m_tex.update_canvas_ctx(obj, "tex_id");</span></span></code> </pre><br><br>  There is nothing difficult in this code and it is hard-working to write a letter by a letter.  The most interesting thing is the parameters of the HTML5 Canvas itself.  Here are truly great opportunities.  Consider some of them. <br><br><h4>  HTML5 Canvas Magic </h4><br>  You can use not only system fonts, but also downloadable ones.  To do this, add the following description to the CSS file: <br><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">font-face</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: MyFont; <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(fonts/MyFont.ttf); }</code> </pre><br><br>  In this case, the font initialization line will look like this: <br><br><pre> <code class="javascript hljs">ctx_image.font = <span class="hljs-string"><span class="hljs-string">"120px MyFont"</span></span>;</code> </pre><br><br>  Font color in RGBA format is set by the line: <br><br><pre> <code class="javascript hljs"> ctx_image.fillStyle = <span class="hljs-string"><span class="hljs-string">"rgba(255,230,0,255)"</span></span>;</code> </pre><br><br>  You can change the alignment of the text inside the canvas.  For example, in the center: <br><br><pre> <code class="javascript hljs">ctx_image.textAlign = <span class="hljs-string"><span class="hljs-string">"center"</span></span>;</code> </pre><br><br>  There are some effects with shadows: <br><br><pre> <code class="javascript hljs"> ctx_image.shadowOffsetX = <span class="hljs-number"><span class="hljs-number">5</span></span>; ctx_image.shadowOffsetY = <span class="hljs-number"><span class="hljs-number">5</span></span>; ctx_image.shadowBlur = <span class="hljs-number"><span class="hljs-number">10</span></span>; ctx_image.shadowColor = <span class="hljs-string"><span class="hljs-string">"rgba(255, 132, 0, 1)"</span></span>;</code> </pre><br><br>  In the end, having played a little with the HTML5 Canvas features, I got the Score I demanded. <br><br><img src="https://habrastorage.org/files/496/174/373/49617437344245e3a20a69e1a57f0c63.jpg"><br><br>  So, the traditional conclusions.  Tool Viewport Alignment solves all the problems on the positioning of elements.  Integration with HTML5 Canvas allows you to easily display information with a wide range of text effects.  3D + canvas is generally a unique feature for creating unusual three-dimensional menus, windows and more complex elements. <br><br>  And here is a spoon of tar (wherever without it, then) - there is not enough tool to easily customize the output of information on HTML5 Canvas.  With any change in the parameters of the canvas, you have to export the project to verify the result.  This, of course, takes a lot of time for such experiments.  But in general, there were no special problems in creating a custom UI for the Blend4Web application. </div><p>Source: <a href="https://habr.com/ru/post/277533/">https://habr.com/ru/post/277533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277519/index.html">About MongoDB Online University</a></li>
<li><a href="../277521/index.html">Setting Safebrowsing from Yandex to Firefox</a></li>
<li><a href="../277525/index.html">Bidirectional rendering with diacritics support</a></li>
<li><a href="../277527/index.html">The benefits of big data technology in everyday life</a></li>
<li><a href="../277529/index.html">Fake Novella: a small game, the development of which taught me a lot and another ban from Google</a></li>
<li><a href="../277535/index.html">Robotic arm control with Intel RealSense cameras</a></li>
<li><a href="../277537/index.html">Vision-based SLAM: monocular SLAM</a></li>
<li><a href="../277539/index.html">Yelp, Wunderlist and GIPHY introduced new type applications</a></li>
<li><a href="../277541/index.html">Another approximation by polynomial of a function of several variables</a></li>
<li><a href="../277543/index.html">Clean code architecture and development through testing in PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>