<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telegram bot development for Instagram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share the result of my work, the development of Telegram bot for massfollowing on Instagram. 

 Most likely, some of you are not familiar wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telegram bot development for Instagram</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/7o/5t/zx/7o5tzx9hk64hcdqp8mypmhh57ia.jpeg"><br><br>  I want to share the result of my work, the development of Telegram bot for massfollowing on Instagram. <br><br>  Most likely, some of you are not familiar with this term, here is a short description: <br><blockquote>  <b>Massfollowing</b> - a mass subscription to people according to certain criteria. <br>  In simple language, you subscribe to a person, he sees in the tape that someone has subscribed to him, goes to your page. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On this goal, this tool for business is completed. <br></blockquote>  Services for massfollowing already exist long ago, 2 years ago I noticed the activity of my friends on Instagram, namely, the desire to promote my business through this social network.  To do this, they used different mass subscription services, where a monthly subscription costs about 1000 rubles, and according to them, the effect is quite noticeable, especially for restaurants, food delivery services. <br><a name="habracut"></a><br>  It became interesting to me, I registered on one of the popular services, I looked at the functionality, it seemed interesting to me, I used it for a while. <br>  It is worth saying that at that moment Telegram presented the <a href="https://telegram.org/blog/bot-revolution">Bot Platform platform</a> , it gained sharply popularity, many developers tried to do something based on it, including me, in particular, I used to send notifications from sites. <br><br>  So I thought that working through the site was rather inconvenient, for example, I started the task for a subscription, it ended in a week, and I don‚Äôt even know that it ended, sometimes I even forgot about it.  Also, I constantly had to go to the site, log in, watch tasks and create new tasks. <br><br>  The solution was simple, why not write a Telegram bot, with which you can add accounts, create tasks for subscriptions and formal replies, and receive an alert directly to the messenger about the completion of the task? <br><br>  I started to develop a prototype somewhere in a year and a half in March 2017, at that time and even now I just did not find analogues, I decided to write. <br><br>  The first difficulty was to get access to the instagram API, of course, after my request I didn‚Äôt receive it, I had to look for a solution, it was found quickly enough, good people maintain the <a href="https://github.com/huttarichard/instagram-private-api">instagram-private-api</a> repository, this is the private Instagram API, it was possible most required actions. <br><br>  I started development on Node.js, used MongoDB for data storage. <br><br>  The main features that I wanted to write were: <br><br><ul><li>  <b>Creating tasks (Subscription or Unsubscribe)</b> <br>  In this section, the user selects the account for which you want to perform the action, then selects the type of task (subscription or unsubscribe), and then indicates the source (user, hashtag or location), then the total number of subscriptions, the number of actions per day and likes each user. <br></li><li>  <b>Activity</b> <br>  The user in this section can select an account, and see the active task, in what status it is, how much is left before completion, as well as editing the task and canceling the task. <br></li><li>  <b>Accounts</b> <br>  Add Instagram accounts <br></li></ul><br>  Next, create a scheme for the database, you need to keep a list of users, accounts, tasks, list of subscriptions and likes for all the time (not to re-subscribe). <br><br>  The scheme for storing id telegram users to identify them: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UserSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> db.mongoose.Schema({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'idRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'nameRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now } })</code> </pre> <br>  The scheme for storing Instagram accounts: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AccountSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> db.mongoose.Schema({ <span class="hljs-attr"><span class="hljs-attr">user</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'userRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">login</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'loginRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'passwordRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">verified</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now } })</code> </pre><br>  As well as the scheme for the tasks: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TaskSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> db.mongoose.Schema({ <span class="hljs-attr"><span class="hljs-attr">user</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'userRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">login</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'loginRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'typeRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'paramsRequired'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-string"><span class="hljs-string">'active'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now }, <span class="hljs-attr"><span class="hljs-attr">start</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: [<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'startReqiured'</span></span>] } })</code> </pre><br>  In the <code>params</code> property, we store specific data for a specific task, for example, for a subscription: <br><table><tbody><tr><td>  <b>sourceType</b> </td><td>  Source type (user, hashtag, location) </td></tr><tr><td>  <b>source</b> </td><td>  source name (username, # hashtag, [lat, long]) </td></tr><tr><td>  <b>actionFollow</b> </td><td>  total number of subscriptions / formal replies </td></tr><tr><td>  <b>actionFollowDay</b> </td><td>  number of actions per day </td></tr><tr><td>  <b>actionLikeDay</b> </td><td>  number of likes to each user </td></tr></tbody></table><br>  The remaining schemes are available in the repository of the <a href="https://github.com/hazratgs/instalator-telegram/tree/master/app/models">instalator-telegram</a> project. <br><br>  Next, it was necessary to process incoming commands from the user, at this moment I had problems, I did not find a ready solution at that moment, I made it quite simple, perhaps many people would not like this approach, made a map of the path: <br><br><div class="spoiler">  <b class="spoiler_title">Project Map</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'home'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">' '</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:create'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">' + '</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:user'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:user:select'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:action'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:actionPerDay'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:like'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:hashtag'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:hashtag:find'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:action'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:actionPerDay'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:like'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:select'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:action'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:actionPerDay'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:follow+like:source:like'</span></span> }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'location:back'</span></span> } } }, : { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:type'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'task:select:type:unfollow'</span></span> <span class="hljs-comment"><span class="hljs-comment">// await: true }, : { event: 'location:back' } } }, : { event: 'location:back' } } }, ' ': { event: 'account:add', children: { '*': { event: 'account:await', await: true }, : { event: 'location:back' } } }, : { event: 'location:back' } } }, : { event: 'actions', children: { '*': { event: 'actions:account', children: { : { event: 'actions:account:update', children: { '*': { event: 'actions:account:update:one', children: { '*': { event: 'actions:account:update:two', children: { '*': { event: 'actions:account:update:three' } } } } }, : { event: 'location:back' } } }, : { event: 'actions:account:cancel' }, : { event: 'location:back' } } }, : { event: 'location:back' } } }, : { event: 'account:list', children: { '*': { event: 'account:select', children: { : { event: 'account:edit', children: { '*': { event: 'account:edit:await', await: true }, : { event: 'location:back' } } }, : { event: 'account:delete', await: true }, : { event: 'location:back' } } }, ' ': { event: 'account:add', children: { '*': { event: 'account:await', await: true }, : { event: 'location:back' } } }, : { event: 'location:back' } } }, : { event: 'limit:message', children: { : { event: 'location:back' } } } } }</span></span></code> </pre><br></div></div><br>  The map contains ‚Äúevent‚Äù objects, it contains an <b>event</b> property, which contains the name of the event <b>EventEmitter</b> , as well as the <b>children</b> property, which contains child ‚Äúroutes‚Äù, corresponding in structure. <br><br>  How it works, the user sends a command, for example, <b>Create a task</b> , having received a message, walk through the tree, if there is a property, call the appropriate <b>EventEmitter</b> event, and then write the user id to the <b>state</b> object, where we will store the current location of the users, for example: <br><br><pre> <code class="javascript hljs">state = { <span class="hljs-number"><span class="hljs-number">23445432</span></span>: [<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">' + '</span></span>], <span class="hljs-number"><span class="hljs-number">1345532</span></span>: [<span class="hljs-string"><span class="hljs-string">''</span></span>] }</code> </pre><br>  Now if the user sends a message under id <b>23445432</b> , the <b>task: select: follow + like</b> event will be called in response, and what if the corresponding message is not in the map?  or do we need to get some data from the user that is not registered in the map, for example, the number of subscriptions per day?  To do this, one of the properties of <b>children</b> must be marked with an asterisk, like this: <b>*</b> , then inside it we describe the <b>event</b> that needs <b>to</b> be <b>called</b> . <br><br>  Directly "routing" itself: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> router = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   if (msg.text) msg.text = emoji.decode(msg.text) // No user status, we give the main menu if (!state[msg.from.id]) { commandEvents.emit('/home', msg) // Adding the user to the state state[msg.from.id] = [] } else { // Go to the desired branch const findBranch = state[msg.from.id].reduce((path, item) =&gt; { // If there are no child partitions if (!path.children) { return path } else { if (path.children[item]) { return path.children[item] } else { // If there is no suitable branch, then we try to use a common branch if (path.children['*']) { return path.children['*'] } else { return path } } } }, map) // Call branch method const callBranch = branch =&gt; { const action = findBranch.children[branch] // Call action event.emit(action.event, msg, action, (value = msg.text) =&gt; { event.emit('location:next', msg, action, value) }) } // We check the existence of the method if (findBranch.children.hasOwnProperty(msg.text)) { callBranch(msg.text) } else if (findBranch.children['*']) { // If there is no suitable branch, then we try to use a common branch callBranch('*') } else { // back event.emit('location:back', msg) } } }</span></span></code> </pre><br>  If there is no property in the map, then we call the event <b>back</b> , return the user one step higher. <br><br>  Talking in detail about how the handlers are arranged does not make sense, these are the usual callback functions that change certain data in the database, for example, here is the handler for sending the list of accounts to the user: <br><br><pre> <code class="javascript hljs">event.on(<span class="hljs-string"><span class="hljs-string">'account:list'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (msg, action, next) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> list = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Account.list(msg.from.id) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`There are no accounts for </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${msg.</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.id}</span></span></span><span class="hljs-string">`</span></span>) } <span class="hljs-comment"><span class="hljs-comment">// Sending the list of accounts const elements = list.map(item =&gt; item.login) send.keyboard(msg.from.id, ' ', [ ...elements, ' ', '' ]) next &amp;&amp; next() } catch (e) { event.emit('account:empty', msg) next &amp;&amp; next() } })</span></span></code> </pre><br>  The <b>next ()</b> method takes the user to the next level in the map, for this he adds the active section to the <b>state</b> , and the <b>keyboard</b> method sends the buttons to the user. <br><br>  Further, if you notice, in the <b>Task</b> scheme, we have a start property, in which the minute in which the task is created is recorded, so it‚Äôs time to start the tasks, for this we iterate over all the tasks created in the current minute, the full code of the cron: <br><br><div class="spoiler">  <b class="spoiler_title">cron.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">cron.schedule(conf.cron, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> list = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> task.currentList() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'No active assignments'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> list) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = item._id.toString() <span class="hljs-comment"><span class="hljs-comment">// Missing running tasks if (activeTask.includes(id)) continue switch (item.type) { case ' + ': activeTask.push(id) actions .followLike(item) .then(res =&gt; { // Remove from list const keyActiveTask = activeTask.indexOf(id) delete activeTask[keyActiveTask] if (res.name === 'AuthenticationError') { send.message( item.user, `Ô∏è    ${item.login}  ,  !` ) throw new Error(' ') } // notify the user when the task is completed if (res) { send.message( item.user, ` ${item.type}    ${item.login}` ) } }) .catch(e =&gt; console.log(e)) break case '': activeTask.push(id) actions .unFollow(item) .then(res =&gt; { // Remove from list const keyActiveTask = activeTask.indexOf(id) delete activeTask[keyActiveTask] if (res.name === 'AuthenticationError') { send.message( item.user, `Ô∏è    ${item.login}  ,  !` ) throw new Error(' ') } // notify the user when the task is completed if (res) { send.message( item.user, ` ${item.type}    ${item.login}` ) } }) .catch(e =&gt; console.log(e)) break default: // Job type is not defined break } } } catch (e) { // No active assignments return e } })</span></span></code> </pre><br></div></div><br>  To work with Telegram, I set up a webhook, if you don't need it yet, you can run it in dev mode (npm run dev). <br><br>  I recommend setting up the webook, so your server will not send polling requests all the time, the configuration is in the conf.json file. <br><br>  And probably the last thing is working with the Instagram private API, it makes no sense to consider it, the documentation is available with examples from the project repository. <br><br>  <b>And finally, an example of a working functional:</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/M5-CSqoWx5o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Conclusion </h3><br>  I would like to say that all the same there are problems, they are related to the fact that Instagram blocks and does not give permission to authorize more accounts from the same IP address of some VPS.  So in my case I was able to log in from several accounts, then access was already blocked for adding new ones, but the ones added earlier had no problems, unless of course the daily limits were violated. <br><br>  Of course, you can get around all this, if you use a proxy for each account or several accounts, but I did not set goals to develop a whole service, it was important for me to make a convenient and free tool and gain additional development experience, as well as a contribution to open source. <br><br>  It is important to say that if you placed a bot somewhere in a rented virtual server, from which you did not naturally go to Instagram before (unless of course you‚Äôre not using openvpn), then you need to confirm that you are trying to access Instagram from the Netherlands or where your server, this message will appear when you log in to Instagram, after which you can re-add your account. <br><br>  Of course, this is not a complete analogue of the service substitute, but I implemented the basic methods that most of the people I surveyed use. <br><br>  Be careful using the bot!  Especially for you added the ‚ÄúLimits‚Äù section, where some information was written that will prevent you from blocking by Instagram. <br><br>  Important!  Passwords are stored in unencrypted form, do not enter your password! <br>  <a href="https://github.com/hazratgs/instalator-telegram"><b>Project repository</b></a> </div><p>Source: <a href="https://habr.com/ru/post/355014/">https://habr.com/ru/post/355014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../355002/index.html">Bought tickets for miles Aeroflot. Could not fly. How to return money / miles?</a></li>
<li><a href="../355004/index.html">How to understand that your site has been hacked?</a></li>
<li><a href="../355006/index.html">RIPE distributed the last block / 22 of the last block / 8. What's next?</a></li>
<li><a href="../355008/index.html">May 19, welcome to Badoo Techleads Meetup # 3</a></li>
<li><a href="../355010/index.html">Check Point Dashboards - that's what I love</a></li>
<li><a href="../355016/index.html">Common mistakes made by developers in the UX</a></li>
<li><a href="../355018/index.html">GPU Ray Tracing in Unity</a></li>
<li><a href="../355020/index.html">Signal processing in PHP, or cooking delicious</a></li>
<li><a href="../355022/index.html">Project Arena - webinar for creators of serious VR projects</a></li>
<li><a href="../355024/index.html">Rethinking Conference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>