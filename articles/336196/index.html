<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Room: Android data storage for everyone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Room is a new way to save application data in an Android application introduced this year on Google I / O. This is part of the new Android Architectur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Room: Android data storage for everyone</h1><div class="post__text post__text-html js-mediator-article"><p>  <b>Room</b> is a new way to save application data in an Android application introduced this year on <i>Google I / O.</i>  This is part of the new <i>Android Architecture</i> , a group of libraries from Google that support the relevant application architecture.  Room is offered as an alternative to Realm, ORMLite, GreenDao and more. </p><br><p>  <b>Room</b> is a high-level interface for the low-level SQLite bindings built into Android, which you can learn more about in the <a href="https://developer.android.com/training/basics/data-storage/databases.html">documentation</a> .  It performs most of its work at compile time, creating the API over the embedded SQLite API, so you don‚Äôt need to work with <i>Cursor</i> or <i>ContentResolver</i> . </p><a name="habracut"></a><br><h3>  Use Room </h3><br><p>  First, <a href="https://developer.android.com/topic/libraries/architecture/adding-components.html">add</a> Room to your project.  After that you will need to transfer to the Room what your data looks like.  Suppose there is a simple model class that looks like this: </p><br><pre><code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Person { <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> name; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> age; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> favoriteColor; }</code> </pre> <br><p>  To tell <strong>Room</strong> about the <strong>Person</strong> class, add the <em><a href="https://habrahabr.ru/users/entity/" class="user_link">Entity</a></em> annotation to the class and <em>@PrimaryKey</em> to the key: </p><br><pre> <code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; String favoriteColor; }</code> </pre> <br><p>  Thanks to these two annotations, <strong>Room</strong> now knows how to create a table to hold instances of <em>Person</em> . </p><br><p>  An important thing to consider when setting up your models: each field that is stored in the database must be public or have a getter and setter in the standard <strong>Java Beans</strong> style (for example, <em>getName ()</em> and <em>setName (string name)</em> ). </p><br><p>  The <em>Person</em> class now has all the information <strong>Room</strong> needs to create tables, but you have no way to actually add, query, or delete data from the database.  That is why you will need to make a data access object (DAO).  <strong>DAO</strong> provides an interface to the database itself and handles the handling of stored Person data. </p><br><p>  Here is a simple DAO interface for the Person class: </p><br><pre> <code class="hljs ruby">@Dao public interface PersonDao { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  Person   @Insert void insertAll(Person... people); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  Person   @Delete void delete(Person person); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Person   @Query(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM person"</span></span>) List&lt;Person&gt; getAllPeople(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Person     @Query(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM person WHERE favoriteColor LIKE :color"</span></span>) List&lt;Person&gt; getAllPeopleWithFavoriteColor(String color); }</code> </pre> <br><p>  The first thing to notice is that <strong>PersonDao</strong> is <u>an interface, not a class</u> .  Another interesting detail is the SQL statements in the <em><a href="https://habrahabr.ru/users/query/" class="user_link">Query</a> ()</em> annotations.  SQL statements tell Room what information you want to retrieve from the database.  They are also checked at compile time.  Therefore, if you change the signature of the getAllPeopleWithFavoriteColor ( <strong>color name</strong> ) method to List getAllPeopleWithFavoriteColor ( <strong>int color</strong> ), Room will generate an error at compile time: <br></p><pre> <code class="hljs pgsql">incompatible <span class="hljs-keyword"><span class="hljs-keyword">types</span></span>: <span class="hljs-type"><span class="hljs-type">int</span></span> cannot be converted <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> String</code> </pre> <br><p>  And if you make a typo in the SQL statement, for example, write <em>favoriteColors (</em> <strong>plural</strong> <em>)</em> instead of <em>favoriteColor (</em> <strong>singular</strong> <em>)</em> , Room will also generate a compilation error: </p><br><pre> <code class="hljs sql">There is a problem <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">query</span></span>: [SQLITE_ERROR] <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">missing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> such <span class="hljs-keyword"><span class="hljs-keyword">column</span></span>: favoriteColors)</code> </pre> <br><p>  You cannot get an instance of PersonDao, because this is an interface.  To be able to use DAO classes, you need to create a database class.  Behind the scenes, this class will be responsible for maintaining the database itself and providing DAO instances. </p><br><p>  You can create your own database class in just a couple of lines: </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@Database</span></span>(entities = {<span class="hljs-type"><span class="hljs-type">Person</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-comment"><span class="hljs-comment">/*, AnotherEntityType.class, AThirdEntityType.class */</span></span>}, version = <span class="hljs-number"><span class="hljs-number">1</span></span>) public <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDatabase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoomDatabase</span></span></span><span class="hljs-class"> </span></span>{ public <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-type"><span class="hljs-type">PersonDao</span></span> getPersonDao(); }</code> </pre> <br><p>  This is just a description of the database structure, but the database itself will live in one file.  To get an <strong>AppDatabase</strong> instance stored in a file called <strong>populus-database</strong> , you would write: </p><br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">AppDatabase</span></span> db = <span class="hljs-type"><span class="hljs-type">Room</span></span>.databaseBuilder(getApplicationContext(), <span class="hljs-type"><span class="hljs-type">AppDatabase</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>, <span class="hljs-string"><span class="hljs-string">"populus-database"</span></span>).build();</code> </pre> <br><p>  If you want to get all the data about all the Person that are in the database, you could write: </p><br><pre> <code class="hljs xml">List<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Person</span></span></span><span class="hljs-tag">&gt;</span></span> everyone = db.getPersonDao().getAllPeople();</code> </pre> <br><h3 id="preimuschestva-ispolzovaniya-room">  Benefits of using Room </h3><br><p>  Unlike most ORMs, <strong>Room</strong> uses an annotation handler to perform all of its data storage.  This means that neither your application classes, nor the model classes should expand anything in the <strong>Room</strong> , unlike many other ORMs, including Realm and SugarORM.  As you saw in the errors with the <a href="https://habrahabr.ru/users/query/" class="user_link">Query</a> () annotations above, you also get the ability to validate SQL queries during compilation, which can save you a lot of trouble. </p><br><p>  Room also allows you to monitor data changes, integrating them with both <a href="https://developer.android.com/topic/libraries/architecture/livedata.html">the LiveData API of</a> Architectural Components and RxJava 2. This means that if you have a complicated scheme where changes in the database should appear in several places in your application, Room makes notifications about changes.  This powerful add-on can be included in one line.  All you need to do is change the type of the returned values. </p><br><p>  For example, this method: </p><br><pre> <code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM person"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllPeople</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre> <br><p>  Becomes as follows: </p><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Query(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SELECT * FROM person"</span></span></span><span class="hljs-meta">)</span></span> LiveData&lt;List&lt;Person&gt;&gt; <span class="hljs-comment"><span class="hljs-comment">/* or Observable&lt;List&lt;Person&gt;&gt; */</span></span> getAllPeople();</code> </pre> <br><h3 id="samoe-bolshoe-ogranichenie-v-room-vzaimosvyazi">  Room's biggest limitation: interconnections </h3><br><p>  The biggest limitation in Room is that it will not handle relationships with other types of entities for you automatically, like other ORMs.  This means that if you want to track pets: </p><br><pre> <code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; String favoriteColor; List&lt;Pet&gt; pets; } <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> String name; String breed; }</code> </pre> <br><p>  That Room will generate a compilation error, since it does not know how to keep the relationship between Person and Pet: </p><br><pre> <code class="hljs pgsql">Cannot figure <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> how <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> save this field <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span>. You can consider adding a <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> converter <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> it.</code> </pre> <br><p>  Compile error offers a type converter that converts objects to primitives that can be directly stored in SQL.  Since the List cannot be reduced to a primitive, you need to do something else.  This is a one-to-many relationship, where one Person can have a lot of Pet.  Room cannot model such relationships, but she can cope with inverse relationships ‚Äî each Pet has one Person.  To model this, remove the field for <em>Pet</em> in <strong>Person</strong> and add the <em>ownerId</em> field to the <strong>Pet</strong> class: </p><br><pre> <code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; String favoriteColor; } <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span>(foreignKeys = <span class="hljs-meta"><span class="hljs-meta">@ForeignKey</span></span>( entity = Person.class, parentColumns = <span class="hljs-string"><span class="hljs-string">"name"</span></span>, childColumns = <span class="hljs-string"><span class="hljs-string">"ownerId"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> String name; String breed; String ownerId; <span class="hljs-comment"><span class="hljs-comment">// this ID points to a Person }</span></span></code> </pre> <br><p>  This will cause Room to provide a foreign key constraint between objects.  Room will not call a one-to-many and many-to-one relationship, but it gives you the tools to express these relationships. </p><br><p>  To get all pets that belong to a particular person, you can use a query that finds all pets with a given owner ID.  For example, you can add the following method to your DAO: </p><br><pre> <code class="hljs sql">@Query("<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pet <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ownderId <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> :ownerId<span class="hljs-string"><span class="hljs-string">") List&lt;Pet&gt; getPetsForOwner(String ownerId);</span></span></code> </pre> <br><h3 id="stoit-li-ispolzovat-room">  Should I use the Room? </h3><br><p>  If you have already configured to save data in your application and are happy with it, then do not change anything.  Each ORM and embedded implementation of SQLite will continue to work the same way as before.  Room is just another option for saving data. </p><br><p>  If you are using SQLite or are going to use it, you should try Room.  It has all the capabilities necessary to perform advanced queries, at the same time eliminating the need to write SQL queries to support the database on its own. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/336196/">https://habr.com/ru/post/336196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336182/index.html">Creating modules for MODX Evolution in 2017 for the smallest</a></li>
<li><a href="../336184/index.html">The implementation of the list with the title, footer and pagination in Android</a></li>
<li><a href="../336188/index.html">Veeam Academy - practical classes for beginners C # developers</a></li>
<li><a href="../336190/index.html">ITMO University Digest: study, sports programming and science</a></li>
<li><a href="../336194/index.html">Tautological tests</a></li>
<li><a href="../336198/index.html">Neuro-authentication: an introduction to biometric authentication</a></li>
<li><a href="../336202/index.html">Another way to work with Promise for Redux</a></li>
<li><a href="../336204/index.html">How to become the best Android application developer: 31 tips</a></li>
<li><a href="../336208/index.html">Crashplan closes service for individuals</a></li>
<li><a href="../336210/index.html">Sustainable channel based on a cellular modem cluster (SD-WAN): solve route selection problems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>