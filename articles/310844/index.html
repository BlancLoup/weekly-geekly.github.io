<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development extensions for firefox, or my first experience, on the example of a screenshot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After writing the article System scripts in php for linux, we write a screenshoter , I had the idea ‚ÄúWhy not write an extension to tie into my script,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development extensions for firefox, or my first experience, on the example of a screenshot</h1><div class="post__text post__text-html js-mediator-article">  After writing the article <a href="https://habrahabr.ru/post/310694/">System scripts in php for linux, we write a screenshoter</a> , I had the idea ‚ÄúWhy not write an extension to tie into my script, with the option of automatically uploading to the Yandex disk.‚Äù ... After reading the documentation on the development of extensions, I decided start writing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/98a/70f/140/98a70f140621ef986405d5145f75283a.png" alt="image"><br><br>  This is a small button and a screenshot on the Yandex disk, the result of a prototype extension written in a couple of hours.  About the process of its creation under the cut ... <br><a name="habracut"></a><br>  Attention: this is the first version of the application, in the future the script from the previous article will be a screenshoter ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The extension I developed has the following file structure: <br><br><div class="spoiler">  <b class="spoiler_title">Structure</b> <div class="spoiler_text">  -chrome.manifest <br>  -install.rdf <br>  --content <br>  ---- browserOverlay.js <br>  ---- browserOverlay.xul <br>  ---- options.xul <br>  --skin <br>  ---- browserOverlay.css <br></div></div><br>  Now we are interested in files: chrome.manifest and install.rdf.  chrome.manifest contains the description of the project structure: <br><br><div class="spoiler">  <b class="spoiler_title">chrome.manifest</b> <div class="spoiler_text"><pre><code class="hljs ruby">content xulphpsrc content/ skin xulphpsrc classic/<span class="hljs-number"><span class="hljs-number">1.0</span></span> skin/ overlay <span class="hljs-symbol"><span class="hljs-symbol">chrome:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/browser/content</span></span><span class="hljs-regexp"><span class="hljs-regexp">/browser.xul chrome:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/xulphpsrc/content</span></span><span class="hljs-regexp"><span class="hljs-regexp">/browserOverlay.xul</span></span></code> </pre> </div></div><br>  The first two lines of the chrome manifest contain: data type, package name, path to the package files. <br><br>  The third line records the so-called overlay (surface layer) i.e.  This layer fits as if on top of an existing one, and adds controls to the browser. <br><br>  The install.rdf file is an installation manifest that contains information about the extension to be added: <br><br><div class="spoiler">  <b class="spoiler_title">install.rdf</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RDF</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:em</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.mozilla.org/2004/em-rdf#"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Description</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">about</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:mozilla:install-manifest"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:id</span></span></span><span class="hljs-tag">&gt;</span></span>phpsrc@phpsrc.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:name</span></span></span><span class="hljs-tag">&gt;</span></span>xulphpsrc<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:description</span></span></span><span class="hljs-tag">&gt;</span></span>PHP screenshoter extensions!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:optionsURL</span></span></span><span class="hljs-tag">&gt;</span></span>chrome://xulphpsrc/content/options.xul<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:optionsURL</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:creator</span></span></span><span class="hljs-tag">&gt;</span></span>Naumov<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:creator</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:type</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Mozilla Firefox --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:targetApplication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:id</span></span></span><span class="hljs-tag">&gt;</span></span>{ec8030f7-c20a-464f-9b0e-13a3a9e97384}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:minVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:minVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:maxVersion</span></span></span><span class="hljs-tag">&gt;</span></span>10.*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:maxVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">em:targetApplication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RDF</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  As you can see.  It contains an identifier, application name, version, creator, application type, settings panel URL, etc.  information. <br><br>  I do not think that it is necessary to focus on this file, since everything is quite obvious.  We can only parse one options optionsURL, this is the url that leads to the expansion settings, the settings are in turn described by the options.xul file: <br><br><div class="spoiler">  <b class="spoiler_title">options.xul</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?xml-stylesheet href="chrome://global/skin/" type="text/css"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">prefwindow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xulphpsrc-prefs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc api yandex settings"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">prefpane</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_api_set"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PHPsrc setting api yandex"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">preferences</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">preference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"extensions.xulphpsrc.login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">preferences</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">preferences</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">preference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_pass"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"extensions.xulphpsrc.pass"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">preferences</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">align</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">control</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_login_label"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" : "</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textbox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">preference</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_login_label"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">maxlength</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">control</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_pass_label"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" : "</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textbox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">preference</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_pass"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phpsrc_pass_label"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">maxlength</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">prefpane</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">prefwindow</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  In this file, we described only 2 fields of login and password.  Pay attention to the names "extensions.xulphpsrc.login" and "extensions.xulphpsrc.pass" they contain a sort of tree structure, and it will be more convenient to get them from the total mass of records, and there is some guarantee of uniqueness of the keys ... <br><br>  Next, consider the browserOverlay.xul file: <br><br><div class="spoiler">  <b class="spoiler_title">browserOverlay.xul</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?xml-stylesheet type="text/css" href="chrome://global/skin/" ?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?xml-stylesheet type="text/css" href="chrome://xulphpsrc/skin/browserOverlay.css" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">overlay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xulphpsrc-browser-overlay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/x-javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"chrome://xulphpsrc/content/browserOverlay.js"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">toolbar</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">hbox</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">toolbarbutton</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xulphpsrc-button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button-screen"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">tooltiptext</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">oncommand</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"XULPHPsrcChrome.BrowserOverlay.makeScreen(event);"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">hbox</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">toolbar</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">overlay</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre></div></div><br>  What is he doing?  it connects two files browserOverlay.css, browserOverlay.js and creates a toolbar and a single button on it ‚ÄúScreenshot‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ea/f44/700/2eaf447005bbb4b26ceae32235706546.png"><br><br>  All application logic is embedded in browserOverlay.js <br><br><div class="spoiler">  <b class="spoiler_title">browserOverlay.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * XULPHPsrcChrome namespace. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"undefined"</span></span> == <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(XULPHPsrcChrome)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> XULPHPsrcChrome = {}; } <span class="hljs-comment"><span class="hljs-comment">/** * Controls the browser overlay. */</span></span> XULPHPsrcChrome.BrowserOverlay = { <span class="hljs-comment"><span class="hljs-comment">/** * craete screen shot by rect * @param aEvent */</span></span> makeScreen: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">aEvent</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> date = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileScreen = date.getTime().toString() + <span class="hljs-string"><span class="hljs-string">'_screen.png'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = [<span class="hljs-string"><span class="hljs-string">"-s"</span></span>, <span class="hljs-string"><span class="hljs-string">"/tmp/"</span></span> + fileScreen]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.systemRequest( <span class="hljs-string"><span class="hljs-string">'/usr/bin/scrot'</span></span>, args ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.uploadToYandex(fileScreen); }, <span class="hljs-comment"><span class="hljs-comment">/** * analog php system * @param shell * @param args */</span></span> systemRequest: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shell, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/file/local;1"</span></span>] .createInstance(Components.interfaces.nsIFile); file.initWithPath(shell); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> process = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/process/util;1"</span></span>] .createInstance(Components.interfaces.nsIProcess); process.init(file); process.run(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, args, args.length); }, <span class="hljs-comment"><span class="hljs-comment">/** * upload screen to yandex * @param name */</span></span> uploadToYandex: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xml = <span class="hljs-string"><span class="hljs-string">'&lt;propertyupdate xmlns="DAV:"&gt;&lt;set&gt;&lt;prop&gt;&lt;public_url xmlns="urn:yandex:disk:meta"&gt;true&lt;/public_url&gt;&lt;/prop&gt;&lt;/set&gt;&lt;/propertyupdate&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> auth = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getPreference().login + <span class="hljs-string"><span class="hljs-string">':'</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getPreference().pass; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.systemRequest(<span class="hljs-string"><span class="hljs-string">'/usr/bin/curl'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'-s'</span></span>, <span class="hljs-string"><span class="hljs-string">'--user'</span></span>, auth, <span class="hljs-string"><span class="hljs-string">'-T'</span></span>, <span class="hljs-string"><span class="hljs-string">'/tmp/'</span></span> + name, <span class="hljs-string"><span class="hljs-string">'-X'</span></span>, <span class="hljs-string"><span class="hljs-string">'PUT'</span></span>, <span class="hljs-string"><span class="hljs-string">'https://webdav.yandex.ru'</span></span> ]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.systemRequest(<span class="hljs-string"><span class="hljs-string">'/usr/bin/curl'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'-s'</span></span>, <span class="hljs-string"><span class="hljs-string">'--user'</span></span>, auth, <span class="hljs-string"><span class="hljs-string">'-d'</span></span>, xml, <span class="hljs-string"><span class="hljs-string">'-X'</span></span>, <span class="hljs-string"><span class="hljs-string">'PROPPATCH'</span></span>, <span class="hljs-string"><span class="hljs-string">'https://webdav.yandex.ru/'</span></span> + name ]); alert(<span class="hljs-string"><span class="hljs-string">" "</span></span>); }, <span class="hljs-comment"><span class="hljs-comment">/** * get system configuration * @returns {{login: *, pass: *}} */</span></span> getPreference: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefs = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>] .getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myPrefs = prefs.getBranch(<span class="hljs-string"><span class="hljs-string">"extensions.xulphpsrc."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">login</span></span>: myPrefs.getCharPref(<span class="hljs-string"><span class="hljs-string">'login'</span></span>), <span class="hljs-attr"><span class="hljs-attr">pass</span></span>: myPrefs.getCharPref(<span class="hljs-string"><span class="hljs-string">'pass'</span></span>) } } };</code> </pre></div></div><br>  We will analyze this file in a little more detail, although it is trivial and performs only 2 actions: it takes a screenshot and downloads it to the yandex disk.  It makes a screenshot by calling the system utility crot, and loads the result using curl.  Handler "click" on the button "screenshot" we put the method makeScreen: <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * craete screen shot by rect * @param aEvent */</span></span> makeScreen: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">aEvent</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> date = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileScreen = date.getTime().toString() + <span class="hljs-string"><span class="hljs-string">'_screen.png'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = [<span class="hljs-string"><span class="hljs-string">"-s"</span></span>, <span class="hljs-string"><span class="hljs-string">"/tmp/"</span></span> + fileScreen]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.systemRequest( <span class="hljs-string"><span class="hljs-string">'/usr/bin/scrot'</span></span>, args ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.uploadToYandex(fileScreen); },</code> </pre><br>  This is the entry point into the application, the name of the future screenshot is formed here and the call, linux program, scrot occurs  We select the screen area with the mouse and take a snapshot, after that the program goes to the next method UploadToYandex, and passes the file name for upload. <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * upload screen to yandex * @param name */</span></span> uploadToYandex: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xml = <span class="hljs-string"><span class="hljs-string">'&lt;propertyupdate xmlns="DAV:"&gt;&lt;set&gt;&lt;prop&gt;&lt;public_url xmlns="urn:yandex:disk:meta"&gt;true&lt;/public_url&gt;&lt;/prop&gt;&lt;/set&gt;&lt;/propertyupdate&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> auth = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getPreference().login + <span class="hljs-string"><span class="hljs-string">':'</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getPreference().pass; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.systemRequest(<span class="hljs-string"><span class="hljs-string">'/usr/bin/curl'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'-s'</span></span>, <span class="hljs-string"><span class="hljs-string">'--user'</span></span>, auth, <span class="hljs-string"><span class="hljs-string">'-T'</span></span>, <span class="hljs-string"><span class="hljs-string">'/tmp/'</span></span> + name, <span class="hljs-string"><span class="hljs-string">'-X'</span></span>, <span class="hljs-string"><span class="hljs-string">'PUT'</span></span>, <span class="hljs-string"><span class="hljs-string">'https://webdav.yandex.ru'</span></span> ]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.systemRequest(<span class="hljs-string"><span class="hljs-string">'/usr/bin/curl'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'-s'</span></span>, <span class="hljs-string"><span class="hljs-string">'--user'</span></span>, auth, <span class="hljs-string"><span class="hljs-string">'-d'</span></span>, xml, <span class="hljs-string"><span class="hljs-string">'-X'</span></span>, <span class="hljs-string"><span class="hljs-string">'PROPPATCH'</span></span>, <span class="hljs-string"><span class="hljs-string">'https://webdav.yandex.ru/'</span></span> + name ]); alert(<span class="hljs-string"><span class="hljs-string">" "</span></span>); },</code> </pre><br>  In this method, as you can see there is nothing extraordinary, it makes 2-va requests using curl in yandex.disk, one loads the created file, the other publishes it.  Thanks to <a href="https://habrahabr.ru/users/lexore/" class="user_link">lexore</a> for the <a href="https://habrahabr.ru/post/310694/">comment</a> .  In the end, we get a notification that the screenshot is saved. <br><br>  Well, now we have an extension how to install it?  For development, we can, simply, create a file under the name of the application in the folder: <br><br><pre> <code class="hljs ruby">~<span class="hljs-regexp"><span class="hljs-regexp">/.mozilla/firefox</span></span><span class="hljs-regexp"><span class="hljs-regexp">/[id].[user]/extensions</span></span><span class="hljs-regexp"><span class="hljs-regexp">/</span></span></code> </pre> <br>  Where id is an identifier, [user] is a firefox user for example, I did this: <br><br><pre> <code class="hljs scala">~/.mozilla/firefox/pta4nm6g.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>/extensions/phpsrc<span class="hljs-meta"><span class="hljs-meta">@phpsrc</span></span>.ru</code> </pre> <br>  And containing the path to the directory with the extension files: ~ / extensions / phpsrc / (for example, I have one). <br><br>  The final touch, we need to disable the signature check extensions in firefox.  To do this, go to the address about: config, find the xpinstall.signatures.required option and set the value to false. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33e/a83/fd6/33ea83fd63045a9f8ce682e42333e915.png"><br><br>  Reboot firefox and everything is ready ... Setting up the extension, go to the add-ons and look for your extension, click on the button to set up, enter the username and password from yandex'a and ready, now you can click the button and take a screenshot ... <br><br>  <strong>Conclusions: The</strong> first time I wrote an extension for firefox, and it took me more time to write an article.  This is the first version of the application in the future there are plans to develop in the direction of using php in this area.  All screenshots are made by the developed extension.  Thank you all for your attention, all the best ... <br><br>  <strong>UPD:</strong> <a href="https://github.com/lnroma/fscreenshooter">github repository</a> </div><p>Source: <a href="https://habr.com/ru/post/310844/">https://habr.com/ru/post/310844/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310832/index.html">Implementing Row Level Security on MySQL</a></li>
<li><a href="../310834/index.html">Protection of digital content: how to apply DMCA and not go on the path of litigation?</a></li>
<li><a href="../310836/index.html">Functional safety, Part 3 of 7. IEC 61508: Systematic randomness or random systematicity?</a></li>
<li><a href="../310838/index.html">As MegaFon and Nokia in Nizhny Novgorod, 5G networks demonstrated</a></li>
<li><a href="../310842/index.html">Intel tools for optimizing applications and the problem of flows in porous media</a></li>
<li><a href="../310848/index.html">Modern operating system: what the developer needs to know</a></li>
<li><a href="../310850/index.html">In the tunnel under my house, I meet with elves. They give me advice on how to make supercomputers better.</a></li>
<li><a href="../310852/index.html">GitHub will open the GLB own load balancer code</a></li>
<li><a href="../310854/index.html">Redux Action Creators. No constant and headache</a></li>
<li><a href="../310856/index.html">Our first million rubles on upwork - personal experience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>