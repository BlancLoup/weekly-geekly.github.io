<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP.NET MVC Lesson B. Json</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The purpose of the lesson. Learn to work with json format. Tools for working with json. Writing third-party requests, authorization through receiving ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP.NET MVC Lesson B. Json</h1><div class="post__text post__text-html js-mediator-article">  <b>The purpose of the lesson.</b>  Learn to work with json format.  Tools for working with json.  Writing third-party requests, authorization through receiving data from facebook and vkontakte.  Ajax to work with json (rewrite authorization).  Site API <br><br><h5>  Json and Json.net </h5><br>  Json is a textual data format based on Javascript. <br>  Sample data in Json: <br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"firstName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"lastName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"address"</span></span>: { <span class="hljs-string"><span class="hljs-string">"streetAddress"</span></span>: <span class="hljs-string"><span class="hljs-string">" ., 101, .101"</span></span>, <span class="hljs-string"><span class="hljs-string">"city"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"postalCode"</span></span>: <span class="hljs-number"><span class="hljs-number">101101</span></span> }, <span class="hljs-string"><span class="hljs-string">"phoneNumbers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"812 123-1234"</span></span>, <span class="hljs-string"><span class="hljs-string">"916 123-4567"</span></span> ] }</code> </pre> <br><a name="habracut"></a><br><br>  In my practice I worked with json with such applications as yandex.maps api, facebook api, vk api, bronni api (this is such a travel portal), and even when working with a bitcoin wallet.  To do this, use the JSON.net library from <a href="http://james.newtonking.com/pages/json-net.aspx">http://james.newtonking.com/pages/json-net.aspx</a> . <br>  We study it in more detail: <br><ul><li>  Install </li><li>  Let's study conversions from json to objects and back. </li><li>  Deserialization from complex formats </li><li>  Work with facebook API (example) - authorization </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Eliminate <br><pre> <code class="hljs pgsql">PM&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-Package <span class="hljs-type"><span class="hljs-type">Json</span></span>.net Id <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span> Description/<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span> Notes <span class="hljs-comment"><span class="hljs-comment">-- ------- ------------------------- Newtonsoft.Json 4.5.1 Json.NET is a popular high-performance... PM&gt; Install-Package Newtonsoft.Json Successfully installed 'Newtonsoft.Json 4.5.11'. Successfully added 'Newtonsoft.Json 4.5.11' to LessonProject.</span></span></code> </pre><br><br>  Documentation <br>  This <a href="http://james.newtonking.com/projects/json/help/">link</a> is documentation.  We will start with a simple conversion of an object to json format and back.  Create LessonProject.Console and make it a default project.  Add a User type: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">User</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> MiddleName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UserName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Gender { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  Create an object and convert to json: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User() { Id = <span class="hljs-string"><span class="hljs-string">"404"</span></span>, Email = <span class="hljs-string"><span class="hljs-string">"chernikov@gmail.com"</span></span>, UserName = <span class="hljs-string"><span class="hljs-string">"rollinx"</span></span>, Name = <span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>, FirstName = <span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>, MiddleName = <span class="hljs-string"><span class="hljs-string">"Alexandrovich"</span></span>, LastName = <span class="hljs-string"><span class="hljs-string">"Chernikov"</span></span>, Gender = <span class="hljs-string"><span class="hljs-string">"M"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsonUser = JsonConvert.SerializeObject(user); System.Console.Write(jsonUser); System.Console.ReadLine();</code> </pre><br><br>  Result: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"Id"</span></span>:<span class="hljs-string"><span class="hljs-string">"404"</span></span>,<span class="hljs-string"><span class="hljs-string">"Name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"FirstName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"MiddleName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Alexandrovich"</span></span>,<span class="hljs-string"><span class="hljs-string">"LastName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Chernikov"</span></span>,<span class="hljs-string"><span class="hljs-string">"UserName"</span></span>:<span class="hljs-string"><span class="hljs-string">"rollinx"</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender"</span></span>:<span class="hljs-string"><span class="hljs-string">"M"</span></span>,<span class="hljs-string"><span class="hljs-string">"Email"</span></span>:<span class="hljs-string"><span class="hljs-string">"chernikov@gmail.com"</span></span>}</code> </pre><br>  Let's try the opposite: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsonUserSource = <span class="hljs-string"><span class="hljs-string">"{\"Id\":\"405\",\"Name\":\"Andrey\",\"FirstName\":\"Andrey\",\"MiddleName\":\"Alexandrovich\",\"LastName\":\"Chernikov\",\"UserName\":\"rollinx\",\"Gender\":\"M\",\"Email\":\"chernikov@gmail.com\"}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user2 = JsonConvert.DeserializeObject&lt;User&gt;(jsonUserSource);</code> </pre><br><br>  And we get the result: <br><br><img src="https://habrastorage.org/storage2/390/8cb/94b/3908cb94b4ab738179d90cca35051c63.jpg"><br><br>  Those.  works in both directions.  But a little complicate.  For example, let's set Gender through the enumerated types Male and Female, and it is Male and Female that must be passed to json.  And Id is a numeric value: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">User</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> GenderEnum { Male, Female } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> MiddleName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UserName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GenderEnum Gender { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  We try the first part: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User() { Id = <span class="hljs-number"><span class="hljs-number">404</span></span>, Email = <span class="hljs-string"><span class="hljs-string">"chernikov@gmail.com"</span></span>, UserName = <span class="hljs-string"><span class="hljs-string">"rollinx"</span></span>, Name = <span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>, FirstName = <span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>, MiddleName = <span class="hljs-string"><span class="hljs-string">"Alexandrovich"</span></span>, LastName = <span class="hljs-string"><span class="hljs-string">"Chernikov"</span></span>, Gender = User.GenderEnum.Male }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsonUser = JsonConvert.SerializeObject(user);</code> </pre><br><br>  Result: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"Id"</span></span>:<span class="hljs-number"><span class="hljs-number">404</span></span>,<span class="hljs-string"><span class="hljs-string">"Name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"FirstName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"MiddleName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Alexandrovich"</span></span>,<span class="hljs-string"><span class="hljs-string">"LastName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Chernikov"</span></span>,<span class="hljs-string"><span class="hljs-string">"UserName"</span></span>:<span class="hljs-string"><span class="hljs-string">"rollinx"</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"Email"</span></span>:<span class="hljs-string"><span class="hljs-string">"chernikov@gmail.com"</span></span>}</code> </pre><br>  Add: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">JsonConverter(typeof(StringEnumConverter))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> GenderEnum { Male, Female }</code> </pre><br><br>  Result: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"Id"</span></span>:<span class="hljs-number"><span class="hljs-number">404</span></span>,<span class="hljs-string"><span class="hljs-string">"Name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"FirstName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"MiddleName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Alexandrovich"</span></span>,<span class="hljs-string"><span class="hljs-string">"LastName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Chernikov"</span></span>,<span class="hljs-string"><span class="hljs-string">"UserName"</span></span>:<span class="hljs-string"><span class="hljs-string">"rollinx"</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender"</span></span>:<span class="hljs-string"><span class="hljs-string">"Male"</span></span>,<span class="hljs-string"><span class="hljs-string">"Email"</span></span>:<span class="hljs-string"><span class="hljs-string">"chernikov@gmail.com"</span></span>}</code> </pre><br><br>  Already better.  Check back - everything is ok.  We study other attributes that define fine tuning rules.  For example, in json-format there will be names in the Hungarian record of the type first_name: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">JsonObject</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">User</span></span> { [JsonConverter(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(StringEnumConverter))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> GenderEnum { Male, Female } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"id"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"first_name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"middle_name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> MiddleName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"last_name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"user_name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UserName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"gender"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GenderEnum Gender { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"email"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  Result: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">404</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"first_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"middle_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Alexandrovich"</span></span>,<span class="hljs-string"><span class="hljs-string">"last_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Chernikov"</span></span>,<span class="hljs-string"><span class="hljs-string">"user_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"rollinx"</span></span>,<span class="hljs-string"><span class="hljs-string">"gender"</span></span>:<span class="hljs-string"><span class="hljs-string">"Male"</span></span>,<span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"chernikov@gmail.com"</span></span>}</code> </pre><br><br>  To describe the list, add the Photo class: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">JsonObject</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Photo</span></span> { [JsonProperty(<span class="hljs-string"><span class="hljs-string">"id"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  And add to User: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"photo_album"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;Photo&gt; PhotoAlbum { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br><br>  Result: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">404</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"first_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"middle_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Alexandrovich"</span></span>,<span class="hljs-string"><span class="hljs-string">"last_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Chernikov"</span></span>,<span class="hljs-string"><span class="hljs-string">"user_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"rollinx"</span></span>,<span class="hljs-string"><span class="hljs-string">"gender"</span></span>:<span class="hljs-string"><span class="hljs-string">"Male"</span></span>,<span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"chernikov@gmail.com"</span></span>,<span class="hljs-string"><span class="hljs-string">"photo_album"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"  "</span></span>},{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"    "</span></span>}]}</code> </pre><br>  Everything is simple and predictable. <br>  Let us consider a difficult case, for example, when for Gender we need to describe not Male \ Female, but M \ F.  To do this, create a class for parsing GenderEnumConverter: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GenderEnumConverter</span></span> : <span class="hljs-title"><span class="hljs-title">JsonConverter</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">JsonReader reader, Type objectType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> existingValue, JsonSerializer serializer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = reader.Value.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Compare(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-string"><span class="hljs-string">"M"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> User.GenderEnum.Male; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Compare(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-string"><span class="hljs-string">"F"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> User.GenderEnum.Female; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> User.GenderEnum.Male; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">JsonWriter writer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, JsonSerializer serializer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = (User.GenderEnum)<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Write associative array field name writer.WriteValue(value.ToString().Substring(0,1)); } public override bool CanConvert(Type objectType) { return false; } }</span></span></code> </pre><br><br>  And install this converter to handle <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">JsonConverter(typeof(GenderEnumConverter))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> GenderEnum { Male, Female }</code> </pre><br><br>  In general, converters can be infinitely difficult to parse json data.  You can handle atypical records of dates, complex data structures, form the serialization of their classes. <br><br><h5>  Work with facebook </h5><br>  All this is understandable and boring, so we are working with the facebook API.  Entertainment to all!  For a start we will get the project LessonProject.FacebookAPI.  Add Json.NET there and link it with the main project. <br><br>  On facebook you need to get ApplicationID at: <br>  <a href="https://developers.facebook.com/apps">https://developers.facebook.com/apps</a> <br><br><img src="https://habrastorage.org/storage2/65b/3d3/c73/65b3d3c739c963cbcd1e766a3bbad20d.jpg"><br><br>  We create, we receive: <br><img src="https://habrastorage.org/storage2/42f/cb2/162/42fcb21629b2f905e5c139d196bd8add.jpg"><br><br>  We will be interested in AppID and AppSecret. <br>  Add this data to Config / FacebookSetting.cs (we already know how to do it): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FacebookSetting</span></span> : <span class="hljs-title"><span class="hljs-title">ConfigurationSection</span></span> { [ConfigurationProperty(<span class="hljs-string"><span class="hljs-string">"AppID"</span></span>, IsRequired = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AppID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-string"><span class="hljs-string">"AppID"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-string"><span class="hljs-string">"AppID"</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } [ConfigurationProperty(<span class="hljs-string"><span class="hljs-string">"AppSecret"</span></span>, IsRequired = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AppSecret { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-string"><span class="hljs-string">"AppSecret"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-string"><span class="hljs-string">"AppSecret"</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } }</code> </pre><br><br>  Communication with Facebook is as follows: <br><ul><li>  We ask the user to log in, so we will find out what rights we have </li><li>  The answer to this will be the access token, we will receive information on it </li><li>  Get information about the user himself </li></ul><br><br>  Create an interface that will implement our FacebookSetting (to be backward compatible) (LessonProject.FacebookAPI / IFbAppConfig.cs): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IFbAppConfig</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AppID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AppSecret { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre><br>  Add to FacebookSetting (/Global/Config/FacebookSetting.cs): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FacebookSetting</span></span> : <span class="hljs-title"><span class="hljs-title">ConfigurationSection</span></span>, <span class="hljs-title"><span class="hljs-title">IFbAppConfig</span></span></code> </pre><br>  Using our AppID, we go through the type string: <br><pre> <code class="hljs perl">https:<span class="hljs-regexp"><span class="hljs-regexp">//www</span></span>.facebook.com/dialog/oauth?client_id=<span class="hljs-number"><span class="hljs-number">136398216534301</span></span>&amp;redirect_uri=http%3A%2F%2Flocalhost%3A54484%2FFacebook%2FToken&amp;scope=email</code> </pre><br>  And it looks like this: <br><br><img src="https://habrastorage.org/storage2/d9e/e2e/c5f/d9ee2ec5fbcfc88463e31f6e601fbe65.jpg"><br><br>  If we click "Go to application" - then we are forwarded to the page <br> <code><a href="http://localhost/"></a> localhost:54484/Facebook/Token</code>  <code><a href="http://localhost/"></a> localhost:54484/Facebook/Token</code> with the code parameter by which we can get the token (which is valid for a while).  We execute such request: <br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/graph.facebook.com/oauth</span></span><span class="hljs-regexp"><span class="hljs-regexp">/access_token?client_id=136398216534301&amp;redirect_uri=http:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/localhost:54484/</span></span>Facebook/Token&amp;client_secret=e6de78fd40596f00e225dce861b34a1a&amp;code=AQAScKUYKGpzwijzT3Y3SHjNOd4Q5nsyrYPdJaPhX-<span class="hljs-number"><span class="hljs-number">88</span></span>r-wBOuMrdimL8h82bGv3HAh7TL6oJyZ0gNgiB8BcCeH8G_Zj7h6hlft_BFbOfIJIZJB9nKW6Q4iR3a0VVImxM0QYJas3eVg4qtYNkqUcWbgXDSK2JENcuomUX38haxFUFdKXrVjL1acNZSocESsx6nfx_FyF_QlbwnUO5cwogrLp</code> </pre><br>  What we get the answer: <br><pre> <code class="hljs 1c">access_token=AAAB8Da8ZBmR0BAMCOx5293ZArYvFu5oRkmZCrwZAbvpWZB3ZCLBeiooslyYPZBVwHjxSpe3KzJ4VLFPIxwwf0D6TIEiM5ApzU8EMoDpOxE4uAZDZD<span class="hljs-meta"><span class="hljs-meta">&amp;expires=5183977</span></span></code> </pre><br>  We need this access_token, save it, and with it we request the data by reference: <br><pre> <code class="hljs objectivec">https:<span class="hljs-comment"><span class="hljs-comment">//graph.facebook.com/me?access_token=AAAB8Da8ZBmR0BAImiTO9QwuUXbgHPLZBQWmAyZBUkjR2A37aVNs4vaqaFmt6h1ZBvurUpvN95EXddy5d6J1ldZA2jWTxSd3eZBHlYMzKwdxgZDZD</span></span></code> </pre><br><br>  To which he answers us: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"708770020"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey Chernikov"</span></span>,<span class="hljs-string"><span class="hljs-string">"first_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Andrey"</span></span>,<span class="hljs-string"><span class="hljs-string">"last_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Chernikov"</span></span>,<span class="hljs-string"><span class="hljs-string">"link"</span></span>:<span class="hljs-string"><span class="hljs-string">"http:\/\/www.facebook.com\/chernikov1"</span></span>,<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"chernikov1"</span></span>,<span class="hljs-string"><span class="hljs-string">"gender"</span></span>:<span class="hljs-string"><span class="hljs-string">"male"</span></span>,<span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"chernikov\u0040gmail.com"</span></span>,<span class="hljs-string"><span class="hljs-string">"timezone"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">"locale"</span></span>:<span class="hljs-string"><span class="hljs-string">"ru_RU"</span></span>,<span class="hljs-string"><span class="hljs-string">"verified"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"updated_time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2013-03-06T15:01:28+0000"</span></span>}</code> </pre><br><br>  And this we will bring to the class FbUserInfo (LessonProject.FacebookAPI / FbUserInfo.cs): <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">JsonObject</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FbUserInfo</span></span> { [JsonProperty(<span class="hljs-string"><span class="hljs-string">"id"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"first_name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"last_name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"link"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Link { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"username"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UserName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"gender"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Gender { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"email"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"locale"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Locale { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"timezone"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>? Timezone { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"verified"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>? Verified { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"updated_time"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime? updatedTime { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  All the above work is concluded in FbProvider.cs (LessonProject.FacebookAPI / Provider.cs): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FbProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AuthorizeUri = <span class="hljs-string"><span class="hljs-string">"https://graph.facebook.com/oauth/authorize?client_id={0}&amp;redirect_uri={1}&amp;scope=email"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> GetAccessTokenUri = <span class="hljs-string"><span class="hljs-string">"https://graph.facebook.com/oauth/access_token?client_id={0}&amp;redirect_uri={1}&amp;client_secret={2}&amp;code={3}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> GetUserInfoUri = <span class="hljs-string"><span class="hljs-string">"https://graph.facebook.com/me?access_token={0}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> GraphUri = <span class="hljs-string"><span class="hljs-string">"https://graph.facebook.com/{0}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IFbAppConfig Config { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AccessToken { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Authorize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> redirectTo</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(AuthorizeUri, Config.AppID, redirectTo); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAccessToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> code, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> redirectTo</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(GetAccessTokenUri, Config.AppID, redirectTo, Config.AppSecret, code); WebClient webClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> response = webClient.DownloadString(request); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pairResponse = response.Split(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>); AccessToken = pairResponse[<span class="hljs-number"><span class="hljs-number">0</span></span>].Split(<span class="hljs-string"><span class="hljs-string">'='</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> JObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(GetUserInfoUri, AccessToken); WebClient webClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> response = webClient.DownloadString(request); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JObject.Parse(response); } }</code> </pre><br><br>  Where <br><ul><li>  <b>Authorize</b> is the formation of a link to request rights. </li><li>  <b>GetAccessToken</b> is a request for a temporary token. </li><li>  <b>GetUserInfo</b> is a request to get user data. </li></ul><br><br>  Notice how we use <code>WebClient.DownloadString</code> - and op-pa, we obtained the necessary data from the depths of the Internet. <br><br>  We go further.  Create a FacebookController controller (/Areas/Default/Controllers/FacebookController.cs): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FacebookController</span></span> : <span class="hljs-title"><span class="hljs-title">DefaultController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FbProvider fbProvider; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.Web.Routing.RequestContext requestContext</span></span></span><span class="hljs-function">)</span></span> { fbProvider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FbProvider(); fbProvider.Config = Config.FacebookSetting; <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Initialize(requestContext); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Redirect(fbProvider.Authorize(<span class="hljs-string"><span class="hljs-string">"http://"</span></span> + HostName + <span class="hljs-string"><span class="hljs-string">"/Facebook/Token"</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Token</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Request.Params.AllKeys.Contains(<span class="hljs-string"><span class="hljs-string">"code"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = Request.Params[<span class="hljs-string"><span class="hljs-string">"code"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fbProvider.GetAccessToken(code, <span class="hljs-string"><span class="hljs-string">"http://"</span></span> + HostName + <span class="hljs-string"><span class="hljs-string">"/Facebook/Token"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jObj = fbProvider.GetUserInfo(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fbUserInfo = JsonConvert.DeserializeObject&lt;FbUserInfo&gt;(jObj.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(fbUserInfo); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(<span class="hljs-string"><span class="hljs-string">"CantInitialize"</span></span>); } }</code> </pre><br><br>  In Initialize we transfer to <code>FbProvider</code> <code>AppID</code> and <code>AppSecret</code> .  After entering - we redirect to facebook with a request for user rights (permission window).  If the user has already allowed us to do this so as not to ask 100 times, facebook will forward us to / Facebook / Token.  If the code to get the token could not be obtained, return the View CantInitialize (/Areas/Default/Views/Facebook/CantInitialize.cshtml): <br><pre> <code class="html hljs xml">@{ ViewBag.Title = "CantInitialize"; Layout = "~/Areas/Default/Views/Shared/_Layout.cshtml"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>CantInitialize<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>   -  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Otherwise, when everything is fine, then we get our token (it is saved in fbProvider) and ask for data about the user.  When we receive it, we convert it into an object of the FbUserInfo class and output it to View (/Areas/Default/Views/Facebook/Token.cshtml): <br><pre> <code class="html hljs xml">@model LessonProject.FacebookAPI.FbUserInfo @{ ViewBag.Title = "Token"; Layout = "~/Areas/Default/Views/Shared/_Layout.cshtml"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>      :<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dl-horizontal"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>ID<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span>@Model.Id<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>FirstName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span>@Model.FirstName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>LastName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span>@Model.LastName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>Link<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span>@Model.Link<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h5>  Client Code / Server Code (Access-Control-Allow-Origin) </h5><br><br>  Consider another situation where all this interaction is concluded in js-files, we only perform ajax requests.  Change the token method code.  We receive user data not by server code from facebook, but are passed to View a token (/Areas/Default/Controllers/FacebookController.cs:Token): <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Token</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Request.Params.AllKeys.Contains(<span class="hljs-string"><span class="hljs-string">"code"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = Request.Params[<span class="hljs-string"><span class="hljs-string">"code"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fbProvider.GetAccessToken(code, <span class="hljs-string"><span class="hljs-string">"http://"</span></span> + HostName + <span class="hljs-string"><span class="hljs-string">"/Facebook/Token"</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">/* var jObj = fbProvider.GetUserInfo(); var fbUserInfo = JsonConvert.DeserializeObject&lt;FbUserInfo&gt;(jObj.ToString()); */</span></span> ViewBag.Token = fbProvider.AccessToken; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(<span class="hljs-string"><span class="hljs-string">"CantInitialize"</span></span>); }</code> </pre><br><br>  Let's change Token.cshtml (/Areas/Default/Views/Facebook/Token.cshtml): <br><pre> <code class="html hljs xml">@{ ViewBag.Title = "Token"; Layout = "~/Areas/Default/Views/Shared/_Layout.cshtml"; } @section scripts { @Scripts.Render("~/Scripts/default/facebook-token.js") } @Html.Hidden("Token", ViewBag.Token as string) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>      :<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dl-horizontal"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>ID<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ID"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>FirstName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FirstName"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>LastName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LastName"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>Link<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Link"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Add facebook-token.js (/Scripts/default/facebook-token.js): <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FacebookToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ _this = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ajaxGetUserInfo = <span class="hljs-string"><span class="hljs-string">"https://graph.facebook.com/me?access_token="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.init = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = $(<span class="hljs-string"><span class="hljs-string">"#Token"</span></span>).val(); $.ajax({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: _this.ajaxGetUserInfo + token, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#ID"</span></span>).text(data.id); $(<span class="hljs-string"><span class="hljs-string">"#FirstName"</span></span>).text(data.first_name); $(<span class="hljs-string"><span class="hljs-string">"#LastName"</span></span>).text(data.last_name); $(<span class="hljs-string"><span class="hljs-string">"#Link"</span></span>).text(data.link); } }) } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> facebookToken = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; $().ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ facebookToken = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FacebookToken(); facebookToken.init(); });</code> </pre><br><br>  We start, we check.  All perfectly.  But pay attention to this parameter in the http-answer: <br><br><img src="https://habrastorage.org/storage2/3b4/8ae/b5e/3b48aeb5ee8abb6a21c088f3edd48675.jpg"><br><br>  Access-control-allow-origin is a parameter that, when set, allows you to make ajax requests from a browser to a site hosted on another domain. <br>  Those.  if we are accessing $ .ajax () from the browser and there is no response in this header, an error is generated: <br> <code><a href="http://localhost/"></a> Origin localhost:8080 is not allowed by Access-Control-Allow-Origin</code> <br>  To do this, create an attribute that will add this header if we want to organize access to our site from other sites (/Atribute/AllowCrossSiteJson.cs): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AllowCrossSiteJsonAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ActionFilterAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ActionExecutingContext filterContext</span></span></span><span class="hljs-function">)</span></span> { filterContext.RequestContext.HttpContext.Response.AddHeader(<span class="hljs-string"><span class="hljs-string">"Access-Control-Allow-Origin"</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnActionExecuting(filterContext); } }</code> </pre><br><br>  Add use.  For example, the action method OK, which will always return {‚Äúresult‚Äù: ‚ÄúOK‚Äù} (/Areas/Default/Controllers/HomeController.cs): <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AllowCrossSiteJson</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OK</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Json(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { result = <span class="hljs-string"><span class="hljs-string">"OK"</span></span> }, JsonRequestBehavior.AllowGet); }</code> </pre><br><br>  That's all for Json and work with facebook.  You can practice and work with authorization and interaction with vk api.  Documentation here: <a href="http://vk.com/developers.php">http://vk.com/developers.php</a> . <br><br>  All sources are located at <a href="https://bitbucket.org/chernikov/lessons">https://bitbucket.org/chernikov/lessons</a> </div><p>Source: <a href="https://habr.com/ru/post/176087/">https://habr.com/ru/post/176087/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176075/index.html">ASP.NET MVC Lesson A. Notification and Distribution</a></li>
<li><a href="../176077/index.html">Quite an interesting replacement for the standard terminal.</a></li>
<li><a href="../176079/index.html">Road to the clouds: SaaS vs desktop</a></li>
<li><a href="../176081/index.html">eBay plans to ‚Äúflood the planet‚Äù by 2015</a></li>
<li><a href="../176083/index.html">People began to move to Yukoz</a></li>
<li><a href="../176089/index.html">Deploy NetScaler VPX Express to Vmware ESX / Hyper-V</a></li>
<li><a href="../176091/index.html">Review of the Chinese tablets Ainol Spark and Ainol Venus: Price vs Quality</a></li>
<li><a href="../176093/index.html">Basics of security of the Android operating system. Security at the Application Framework level. Binder ipc</a></li>
<li><a href="../176097/index.html">ASP.NET MVC Lesson D. Scaffolding</a></li>
<li><a href="../176101/index.html">Why register a computer program?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>