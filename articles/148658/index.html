<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using external web services in 1C on the example of downloading currency rates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I know that the habre is not very much favor long-suffering 1C. Although, with the release of platform 8.3 (with clients under Linux), they began to l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using external web services in 1C on the example of downloading currency rates</h1><div class="post__text post__text-html js-mediator-article">  I know that the habre is not very much favor long-suffering 1C.  Although, <a href="http://habrahabr.ru/post/147077/">with the release of platform 8.3</a> (with clients under Linux), they began to love it a little more.  By the way, just recently, the interface of one of the main developments of 1C - configuration Management of a manufacturing enterprise - was fully translated into English.  Many times I met questions about why they don‚Äôt write about 1C here.  The answer to them is quite obvious - there are many specialized resources where you can quickly discuss all the issues and read something. <br><br>  There is every reason to believe that this article will not survive here, but I still risk it, because in 1C there are some interesting things that are worth telling. <br><br>  For some time now, the opportunity to use web services has appeared in 1C 8.x: 1C can act as both a supplier and a consumer.  In this article, I will show how to use 1C as a consumer using the example of obtaining exchange rates from a CBR server. <br><a name="habracut"></a><br><h4>  Web service </h4><br>  The Central Bank has a web service for receiving daily data: exchange rates, news, exchange rates, etc.  Service description can be found here <a href="http://www.cbr.ru/scripts/Root.asp%3FPrtid%3DDWS">http://www.cbr.ru/scripts/Root.asp?Prtid=DWS</a> .  We are interested in one of the methods of this service: <b>GetCursOnDate (On_date)</b> - getting currency rates for a given date.  One <b>On_date</b> argument is <b>passed to the method</b> - this is the date on which you want to get the courses.  As a result, XML is returned that contains the <b>ValuteCursOnDate</b> table (the courses themselves and related information). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Configuration </h4><br>  For development, I took 1C 8.2 (8.2.15.317 in my case) and created an empty configuration.  There is a WS-link object for using external web services, but it is not necessary to use it, the service can be accessed dynamically from code.  I will use the first option and then show how you can use the second.  In the configuration, created the processing and called it "LoadingCursesValutSBR."  Added a form (managed) and made it basic.  On the form, I created the details and placed the controls as shown in the figure. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8d7/420/668/8d7420668a65b4217f7d41467dcf6c7c.png"><br><br>  Now the most important thing is to create a link to the web service description.  In the configuration, add a new object of type WS-link.  In the window that appears, specify the link to WSDL (the description of this format is beyond the scope of the article, you can <a href="http://ru.wikipedia.org/wiki/WSDL">read about it on Wikipedia</a> ): <a href="">http://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx?WSDL</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cbf/e75/a06/cbfe75a06fdc7de9ffe9ca9f9f569628.png"><br><br>  1C, based on the received description, will automatically create a visual map of the web service.  You can see the name of the web service, see what operations are available to it, as well as the data types used. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d65/8b4/7f7/d658b47f75e9630b4fe8a63c22d3bb37.png"><br><br>  The configuration on this is almost complete, it remains to make a couple of strokes to make our application look more aesthetically pleasing.  Click the right mouse button on the configuration root and call the "Open command interface of the desktop" menu.  In the window that appears, you must uncheck the "Visibility" flag opposite the processing of "Loading CBR exchange rates".  Click OK.  Next, another right click on the root of the configuration and call the menu "Open the workspace of the desktop", there we will make the setting as in the figure: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/15a/bc0/19e/15abc019eb5acff8836e92381c8ad908.png"><br><br>  These settings will allow us to display the processing form right on the desktop (meaning the desktop of the 1C program) in the 1C Enterprise mode. <br><br><h4>  Programming </h4><br>  Now it remains to fill in the meaning of our processing: to make it receive exchange rates and display it in a table on a form.  In the form editing mode, you need to add a new form command, let's call it the Load Currency.  This command must be associated with a button located on the form.  Fill the action for the command with the following code (author's comment: wow, there is a 1C code highlighting on the habr, though it doesn't work correctly): <br><br><pre><code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">&amp;</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  () </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> () </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> ("</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">   !", .); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">; .(); (); </span></span></code> </pre> <br>  Here it is first checked whether the date is filled (if not filled, then we inform the user about it and do nothing else).  Then the table on the form is cleared and the LoadCursesCurrency () procedure is called, to which the date is passed. <br><br>  Procedure code DownloadCoursesCurrency (), explanations given in the comments to the code: <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) <span class="hljs-comment"><span class="hljs-comment">//      -, //    URI  ,  ,  .  = WS.CBR_DailyInfoWebServ.WS( "http://web.cbr.ru/", "DailyInfo", "DailyInfoSoap"); //  ,     GetCursOnDate. WS = .XDTO..( "http://web.cbr.ru/").("GetCursOnDate"); //         On_Date. WS = .XDTO.(WS); WS.On_Date = ; //  -,     .  = .GetCursOnDate(WS); //  ValuteCursOnDate,    //      (   ).     .GetCursOnDateResult.diffgram.ValuteData.ValuteCursOnDate   = .(); . = .Vname; . = .Vnom; . = .Vcode; . = .VChCode; . = .Vcurs; ; </span></span></code> </pre><br>  Now you can update the configuration of the database (F7) and run the 1C Enterprise (F5).  If everything is done correctly, you should see a window like in the image below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1bf/8a9/cea/1bf8a9ceab7fd044379accc9b462d3a9.png"><br><br>  To check the result, we need to enter the date on which we want to receive exchange rates and click on the ‚ÄúLoad currencies‚Äù button.  In case of a successful request, the table on the form will be filled with the course values: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1fb/696/d91/1fb696d9163fff16c8511892873545f3.png"><br><br>  Finally, I want to show how you can dynamically access an external web service, that is, without adding a WS-link object.  Thus, we can use such web services from external processing without reference to the configuration. <br><br>  In the procedure DownloadCurrenciesCurrency () line <br><br><pre> <code class="1c hljs"> = <span class="hljs-built_in"><span class="hljs-built_in">WS</span></span>.CBR_DailyInfoWebServ.WS(<span class="hljs-string"><span class="hljs-string">"http://web.cbr.ru/"</span></span>, <span class="hljs-string"><span class="hljs-string">"DailyInfo"</span></span>, <span class="hljs-string"><span class="hljs-string">"DailyInfoSoap"</span></span>);</code> </pre><br>  must be replaced by the following two lines <br><br><pre> <code class="1c hljs"> = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type">WS</span></span>(<span class="hljs-string"><span class="hljs-string">"http://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx?WSDL"</span></span>);  = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type">WS</span></span>(, <span class="hljs-string"><span class="hljs-string">"http://web.cbr.ru/"</span></span>, <span class="hljs-string"><span class="hljs-string">"DailyInfo"</span></span>, <span class="hljs-string"><span class="hljs-string">"DailyInfoSoap"</span></span>);</code> </pre><br>  First we create the so-called definitions for the web service from its WSDL.  Then we also create a proxy to access it. <br><br>  As you can see, using external web services from 1C as a whole is quite simple (although there is some difficulty in understanding the definition of types, including myself). <br><br>  If this publication finds a response here, then there are a few more topics that you can talk about. <br><br>  Under the <a href="">link</a> you can download the configuration with an example (cf-file). </div><p>Source: <a href="https://habr.com/ru/post/148658/">https://habr.com/ru/post/148658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148653/index.html">Tiled Map Editor: pixelart tileset editor</a></li>
<li><a href="../148654/index.html">Metrics in software development projects</a></li>
<li><a href="../148655/index.html">Hidden messages in music</a></li>
<li><a href="../148656/index.html">Soldering for beginners</a></li>
<li><a href="../148657/index.html">C ++ memory management</a></li>
<li><a href="../148662/index.html">Why are projects late?</a></li>
<li><a href="../148663/index.html">RFID attacks</a></li>
<li><a href="../148664/index.html">The reasons for the total failure of Nokia Lumia and Windows Phone in particular</a></li>
<li><a href="../148665/index.html">Electronic freelance</a></li>
<li><a href="../148668/index.html">Freelance as a means of earning. Part 1 Project start</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>