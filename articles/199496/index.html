<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RMI means C ++ and boost.preprocessor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is my first publication on this resource, therefore, I ask you to treat with understanding the mistakes I made. 

 RMI is a very commonplace task...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RMI means C ++ and boost.preprocessor</h1><div class="post__text post__text-html js-mediator-article">  <i>This is my first publication on this resource, therefore, I ask you to treat with understanding the mistakes I made.</i> <br><br>  <a href="https://en.wikipedia.org/wiki/Java_remote_method_invocation">RMI</a> is a very commonplace task for PLs supporting <a href="https://en.wikipedia.org/wiki/Type_introspection">introspection</a> .  But, C ++, unfortunately, does not apply to them. <br><br>  In this publication I want to demonstrate the possibility of implementing a very usable RMI using C ++ preprocessor. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Formulation of the problem </h4><br>  1. Provide as simple a syntax as possible so that it is impossible to make a mistake. <br>  2. Identification (binding) of procedures must be hidden from the user in order to make it impossible to make a mistake. <br>  3. Syntax should not impose restrictions on the used C ++ types. <br>  4. There should be the possibility of versioning procedures, but, so that compatibility with existing clients does not break. <br><a name="habracut"></a><br>  Regarding the fourth point: <br>  For example, we already have two add / div procedures, one version of each.  We want to add add new version.  If you just add another version, we‚Äôll have the IDs of the procedures, which are known to the client programs collected before making this change. <br><br><h4>  Tool selection </h4><br>  Since  The end result is supposed to be used in conjunction with C ++ code. I see three options: <br><ul><li>  We invent syntax and we write the kodogenerator. </li><li>  We use C ++ preprocessor. </li><li>  We are looking for something ready and finish it for yourself (if necessary). </li></ul><br><br>  I will speak about each of the options, respectively: <br><ul><li>  Why an additional stage of code generation? </li><li>  I love the preprocessor, and often use it. </li><li>  A waste of time and energy.  And, it is not clear whether this makes sense. </li></ul><br><br>  Regarding the first, second and third paragraphs of the requirements - the preprocessor version is suitable. <br><br>  So, the choice is made - we use a preprocessor.  And yes, of course <a href="http://www.boost.org/doc/libs/1_54_0/libs/preprocessor/doc/index.html">boost.preprocessor</a> . <br><br><h4>  Little about the preprocessor </h4><br>  Data types With ++ preprocessor: <br><ul><li> <a href="http://www.boost.org/doc/libs/1_54_0/libs/preprocessor/doc/data/arrays.html">arrays</a> : <code>(size, (elems, ....))</code> </li><li>  <a href="http://www.boost.org/doc/libs/1_54_0/libs/preprocessor/doc/data/lists.html">lists</a> : <code>(a, (b, (c, BOOST_PP_NIL)))</code> </li><li>  <a href="http://www.boost.org/doc/libs/1_54_0/libs/preprocessor/doc/data/sequences.html">sequences</a> : <code>(a)(b)(c)</code> </li><li>  <a href="http://www.boost.org/doc/libs/1_54_0/libs/preprocessor/doc/data/tuples.html">tuples</a> : <code>(a, b, c)</code> </li></ul><br>  Types, as you can see, more than enough. <br>  A little thought, reading about the possibilities and limitations of each of them, as well as taking into account the desired simplicity of the syntax and the inability to make a mistake - the choice was made in favor of sequences and tuples. <br><br>  A few explanatory examples. <br>  <code>(a)(b)(c)</code> - sequence.  Here, we described a sequence consisting of three elements. <br>  <code>(a)</code> - also sequence, but consisting of one element.  (Attention!) <br>  <code>(a)(b, c)(d, e, f)</code> - again the sequence, but consisting of three tuples.  (pay attention to the first element - the trick, however, but this is really a tuple) <br>  <code>(a)(b, c)(d, (e, f))</code> - again sequence, and also consisting of three tuples.  But!  The last tuple consists of two elements: 1) any element, 2) tuple. <br>  And, finally, such an example: <code>(a)(b, c)(d, (e, (f)(g)))</code> - then figure it out yourself;) <br>  As you can see, everything is really unreal simple. <br><br><h4>  We prototype syntax </h4><br>  After a brief reflection, the following syntax appears: <br><pre> <code class="cpp hljs">(proc_name0, <span class="hljs-comment"><span class="hljs-comment">//   (signature_arg0, signature_arg1, signature_argN) //    (signature_arg0) //    ) (proc_name1, //   (signature_arg0, signature_arg1) //     ) (proc_name2, //   () //     ( ) )</span></span></code> </pre><br>  Well ... quite useful, however. <br><br><h4>  Some implementation details </h4><br>  Since  One of the requirements is the versioning of the procedures, and even such that compatibility with existing customers does not break - we will need two ID `s to identify the procedures.  The first is the procedure ID, the second is the version ID. <br><br>  Let me explain by example. <br>  Suppose this is a description of the API of our service.  Suppose we already have client programs using this API. <br><pre> <code class="cpp hljs">(proc_name0, <span class="hljs-comment"><span class="hljs-comment">// procID=0 (signature_arg0, signature_arg1) // sigID=0 ) (proc_name1, // procID=1 (signature_arg0, signature_arg1) // sigID=0 ) (proc_name2, // procID=2 () // sigID=0 )</span></span></code> </pre><br>  Now, for <code>proc_name0()</code> we need to add another version with a different signature. <br><pre> <code class="cpp hljs">(proc_name0, <span class="hljs-comment"><span class="hljs-comment">// procID=0 (signature_arg0, signature_arg1) // sigID=0 (signature_arg0, signature_arg1, signature_arg2) // sigID=1 ) (proc_name1, // procID=1 (signature_arg0, signature_arg1) // sigID=0 ) (proc_name2, // procID=2 () // sigID=0 )</span></span></code> </pre><br>  Thus, we have a new ID version of the procedure, while the former remained unchanged. <br>  It was: (0: 0), it became: (0: 0) (0: 1) <br>  Those.  this is what we tried to achieve.  Previous clients both used (0: 0) and will continue to use these identifiers without worrying about the new versions of these procedures. <br>  We also agree that all new procedures should be added to the end. <br><br>  Next, we need to make sure that ID `s automatically put on both sides of the service.  Easily!  - just use the same described sequence twice, to generate client and server sides! <br><br>  It's time to imagine how we want to see all this in the end: <br><pre> <code class="cpp hljs">MACRO( client_invoker, <span class="hljs-comment"><span class="hljs-comment">// name of the client invoker implementation class ((registration, // procedure name ((std::string, std::string)) // message : registration key )) ((activation, ((std::string)) // message )) ((login, ((std::string)) // message )) ((logout, ((std::string)) // message )) ((users_online, ((std::vector&lt;std::string&gt;)) // without args )) , server_invoker, // name of the server invoker implementation class ((registration, ((std::string)) // username )) ((activation, ((std::string, std::string, std::string)) // registration key : username : password )) ((login, ((std::string, std::string)) // username : password )) ((logout, (()) // without args )) ((users_online, (()) // without args ((std::string)) // substring )) )</span></span></code> </pre><br>  So that there is no confusion as to who is the leader and who is the slave - we agree that the procedures described on one of the parties are implementations on the opposite side.  Ie, for example, <code>client_invoker::registration(std::string, std::string)</code> tells us that the implementation of this procedure will be on the server side, while the interface to this procedure will be on the side customer and vice versa. <br>  (we use double parentheses because the preprocessor, when forming the argument for our MACRO (), will deploy the API described by us. This can be overcome, but I don‚Äôt know whether it is necessary? ..) <br><br><h4>  Total </h4><br>  From the above macro call, the code will be generated, which is under the spoiler. <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> yarmi { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Impl, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> IO = Impl&gt; struct client_invoker { client_invoker(Impl &amp;impl, IO &amp;io) :impl(impl) ,io(io) {} <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> yarmi_error(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> &amp;arg0, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> &amp;arg1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;arg2) { yas::binary_mem_oarchive oa(yas::no_header); oa &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; arg0 &amp; arg1 &amp; arg2; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;arg0)</span></span></span><span class="hljs-function"> </span></span>{ yas::<span class="hljs-function"><span class="hljs-function">binary_mem_oarchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">oa</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(yas::no_header)</span></span></span></span>; oa &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; arg0; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">activation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;arg0, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;arg1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;arg2)</span></span></span><span class="hljs-function"> </span></span>{ yas::<span class="hljs-function"><span class="hljs-function">binary_mem_oarchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">oa</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(yas::no_header)</span></span></span></span>; oa &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; arg0 &amp; arg1 &amp; arg2; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;arg0, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;arg1)</span></span></span><span class="hljs-function"> </span></span>{ yas::<span class="hljs-function"><span class="hljs-function">binary_mem_oarchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">oa</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(yas::no_header)</span></span></span></span>; oa &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">3</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; arg0 &amp; arg1; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ yas::<span class="hljs-function"><span class="hljs-function">binary_mem_oarchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">oa</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(yas::no_header)</span></span></span></span>; oa &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>); yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">users_online</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ yas::<span class="hljs-function"><span class="hljs-function">binary_mem_oarchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">oa</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(yas::no_header)</span></span></span></span>; oa &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">5</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>); yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">users_online</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;arg0)</span></span></span><span class="hljs-function"> </span></span>{ yas::<span class="hljs-function"><span class="hljs-function">binary_mem_oarchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">oa</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(yas::no_header)</span></span></span></span>; oa &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">5</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span>) &amp; arg0; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ptr, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> call_id, call_version; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* names[] = { <span class="hljs-string"><span class="hljs-string">"yarmi_error"</span></span> ,<span class="hljs-string"><span class="hljs-string">"registration"</span></span> ,<span class="hljs-string"><span class="hljs-string">"activation"</span></span> ,<span class="hljs-string"><span class="hljs-string">"login"</span></span> ,<span class="hljs-string"><span class="hljs-string">"logout"</span></span> ,<span class="hljs-string"><span class="hljs-string">"users_online"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> versions[] = { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { yas::<span class="hljs-function"><span class="hljs-function">binary_mem_iarchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ia</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ptr, size, yas::no_header)</span></span></span></span>; ia &amp; call_id &amp; call_version; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( call_id &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || call_id &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> errstr[<span class="hljs-number"><span class="hljs-number">1024</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>( errstr ,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(errstr) ,<span class="hljs-string"><span class="hljs-string">"%s::%s(): bad call_id %d"</span></span> ,<span class="hljs-string"><span class="hljs-string">"client_invoker"</span></span> ,__FUNCTION__ ,<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(call_id) ); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::runtime_error(errstr); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( call_version &gt; versions[call_id] ) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> errstr[<span class="hljs-number"><span class="hljs-number">1024</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>( errstr ,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(errstr) ,<span class="hljs-string"><span class="hljs-string">"%s::%s(): bad call_version %d for call_id %d(%s::%s())"</span></span> ,<span class="hljs-string"><span class="hljs-string">"client_invoker"</span></span> ,__FUNCTION__ ,<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(call_version) ,<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(call_id) ,<span class="hljs-string"><span class="hljs-string">"client_invoker"</span></span> ,names[call_id] ); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::runtime_error(errstr); } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( call_id ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> arg0; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> arg1; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> arg2; ia &amp; arg0 &amp; arg1 &amp; arg2; impl.on_yarmi_error( arg0 , arg1 , arg2); }; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> arg0; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> arg1; ia &amp; arg0 &amp; arg1; impl.on_registration(arg0, arg1); }; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> arg0; ia &amp; arg0; impl.on_activation(arg0); }; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> arg0; ia &amp; arg0; impl.on_login(arg0); }; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> arg0; ia &amp; arg0; impl.on_logout(arg0); }; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; arg0; ia &amp; arg0; impl.on_users_online(arg0); }; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception &amp;ex) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> errstr[<span class="hljs-number"><span class="hljs-number">1024</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>( errstr ,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(errstr) ,<span class="hljs-string"><span class="hljs-string">"std::exception is thrown when %s::%s() is called: '%s'"</span></span> ,<span class="hljs-string"><span class="hljs-string">"client_invoker"</span></span> ,names[call_id] ,ex.what() ); yarmi_error(call_id, call_version, errstr); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (...) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> errstr[<span class="hljs-number"><span class="hljs-number">1024</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>( errstr ,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(errstr) ,<span class="hljs-string"><span class="hljs-string">"unknown exception is thrown when %s::%s() is called"</span></span> ,<span class="hljs-string"><span class="hljs-string">"client_invoker"</span></span> ,names[call_id] ); yarmi_error(call_id, call_version, errstr); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: Impl &amp;impl; IO &amp;io; }; <span class="hljs-comment"><span class="hljs-comment">// struct client_invoker template&lt;typename Impl, typename IO = Impl&gt; struct server_invoker { server_invoker(Impl &amp;impl, IO &amp;io) :impl(impl) ,io(io) {} void yarmi_error(const std::uint8_t &amp;arg0, const std::uint8_t &amp;arg1, const std::string &amp;arg2) { yas::binary_mem_oarchive oa(yas::no_header); oa &amp; static_cast&lt;std::uint8_t&gt;(0) &amp; static_cast&lt;std::uint8_t&gt;(0) &amp; arg0 &amp; arg1 &amp; arg2; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } void registration(const std::string &amp;arg0, const std::string &amp;arg1) { yas::binary_mem_oarchive oa(yas::no_header); oa &amp; static_cast&lt;std::uint8_t&gt;(1) &amp; static_cast&lt;std::uint8_t&gt;(0) &amp; arg0 &amp; arg1; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } void activation(const std::string &amp;arg0) { yas::binary_mem_oarchive oa(yas::no_header); oa &amp; static_cast&lt;std::uint8_t&gt;(2) &amp; static_cast&lt;std::uint8_t&gt;(0) &amp; arg0; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } void login(const std::string &amp;arg0) { yas::binary_mem_oarchive oa(yas::no_header); oa &amp; static_cast&lt;std::uint8_t&gt;(3) &amp; static_cast&lt;std::uint8_t&gt;(0) &amp; arg0; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } void logout(const std::string &amp;arg0) { yas::binary_mem_oarchive oa(yas::no_header); oa &amp; static_cast&lt;std::uint8_t&gt;(4) &amp; static_cast&lt;std::uint8_t&gt;(0) &amp; arg0; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } void users_online(const std::vector&lt;std::string&gt; &amp;arg0) { yas::binary_mem_oarchive oa(yas::no_header); oa &amp; static_cast&lt;std::uint8_t&gt;(5) &amp; static_cast&lt;std::uint8_t&gt;(0) &amp; arg0; yas::binary_mem_oarchive pa; pa &amp; oa.get_intrusive_buffer(); io.send(pa.get_shared_buffer()); } void invoke(const char *ptr, std::size_t size) { std::uint8_t call_id, call_version; static const char* names[] = { "yarmi_error" ,"registration" ,"activation" ,"login" ,"logout" ,"users_online" }; static const std::uint8_t versions[] = { 0, 0, 0, 0, 0, 1 }; try { yas::binary_mem_iarchive ia(ptr, size, yas::no_header); ia &amp; call_id &amp; call_version; if ( call_id &lt; 0 || call_id &gt; 5 ) { char errstr[1024] = {0}; std::snprintf( errstr ,sizeof(errstr) ,"%s::%s(): bad call_id %d" ,"server_invoker" ,__FUNCTION__ ,static_cast&lt;int&gt;(call_id) ); throw std::runtime_error(errstr); } if ( call_version &gt; versions[call_id] ) { char errstr[1024] = {0}; std::snprintf( errstr ,sizeof(errstr) ,"%s::%s(): bad call_version %d for call_id %d(%s::%s())" ,"server_invoker" ,__FUNCTION__ ,static_cast&lt;int&gt;(call_version) ,static_cast&lt;int&gt;(call_id) ,"server_invoker" ,names[call_id] ); throw std::runtime_error(errstr); } switch ( call_id ) { case 0: { std::uint8_t arg0; std::uint8_t arg1; std::string arg2; ia &amp; arg0 &amp; arg1 &amp; arg2; impl.on_yarmi_error(arg0, arg1, arg2); }; break; case 1: { std::string arg0; ia &amp; arg0; impl.on_registration(arg0); }; break; case 2: { std::string arg0; std::string arg1; std::string arg2; ia &amp; arg0 &amp; arg1 &amp; arg2; impl.on_activation(arg0, arg1, arg2); }; break; case 3: { std::string arg0; std::string arg1; ia &amp; arg0 &amp; arg1; impl.on_login(arg0, arg1); }; break; case 4: { impl.on_logout(); }; break; case 5: { switch ( call_version ) { case 0: { impl.on_users_online(); }; break; case 1: { std::string arg0; ia &amp; arg0; impl.on_users_online(arg0); }; break; } }; break; } } catch (const std::exception &amp;ex) { char errstr[1024] = {0}; std::snprintf( errstr ,sizeof(errstr) ,"std::exception is thrown when %s::%s() is called: '%s'" ,"server_invoker" ,names[call_id] ,ex.what() ); yarmi_error(call_id, call_version, errstr); } catch (...) { char errstr[1024] = {0}; std::snprintf( errstr ,sizeof(errstr) ,"unknown exception is thrown when %s::%s() is called" ,"server_invoker" ,names[call_id] ); yarmi_error(call_id, call_version, errstr); } } private: Impl &amp;impl; IO &amp;io; }; // struct server_invoker } // ns yarmi</span></span></code> </pre><br></div></div><br>  (another project is used as serialization - <a href="https://github.com/niXman/yas">YAS</a> ) <br><br>  As a bonus, the system procedure <code>yarmi_error()</code> was added - used to inform the opposite party that an error occurred while trying to make a call.  Look carefully, <code> client_invoker::invoke()</code> , deserialization and call are wrapped in a <code>try{}catch()</code> block, and in <code>catch()</code> blocks a call is made to <code>yarmi_error()</code> .  Thus, if an exception is raised during deserialization or a procedure call, it will be successfully intercepted by the <code>catch()</code> block, and the exception information will be sent to the caller.  The same thing will happen in the opposite direction.  Those.  If the server has called the client for the procedure that caused the exception during the call, the client will send the error information to the server, also giving the ID and the version of the call that caused the exception.  But, you can use <code>yarmi_error()</code> yourself, nothing prohibits this.  Example: <code>yarmi_error(call_id, version_id, "message");</code> <br><br>  As you can see, on the side of their implementation, the prefix <code>on_</code> <br><br>  The <code>client_invoker</code> and <code>server_invoker</code> take two parameters.  Their first bottom is the class in which the callable procedures are implemented, the second is the class in which the <code>send(yas::shared_buffer buf)</code> method <code>send(yas::shared_buffer buf)</code> implemented. <br>  If you have the same class performs both roles, you can do this: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">client_session</span></span></span><span class="hljs-class">:</span></span> yarmi::client_base&lt;client_session&gt;, yarmi::client_invoker&lt;client_session&gt; { client_session(boost::asio::io_service &amp;ios) :yarmi::client_base&lt;client_session&gt;(ios, *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ,yarmi::client_invoker&lt;client_session&gt;(*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; {} };</span></span></code> </pre><br>  The final version looks like this: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">client_session</span></span></span><span class="hljs-class">:</span></span> yarmi::client_base&lt;client_session&gt;, yarmi::client_invoker&lt;client_session&gt; { client_session(boost::asio::io_service &amp;ios) :yarmi::client_base&lt;client_session&gt;(ios, *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ,yarmi::client_invoker&lt;client_session&gt;(*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_registration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;msg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ¬Ækey)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_activation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;msg)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;msg)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_logout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;msg)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_users_online</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; &amp;users)</span></span></span><span class="hljs-function"> </span></span>{} };</code> </pre><br><br>  The interface to the opposite side will be inherited from the ancestor of <code>yarmi::client_invoker</code> .  Ie, for example, being in the constructor of our <code>client_session</code> , you can call the <code>registration()</code> procedure as follows: <br><pre> <code class="cpp hljs">{ registration(<span class="hljs-string"><span class="hljs-string">"niXman"</span></span>); }</code> </pre><br>  We will get the answer in our implementation <code>client_session::on_registration(std::string msg, std::string regkey)</code> <br>  Everything! <br><br>  Of the shortcomings should note the following: <br>  Commas cannot be used in type names that describe procedures, because the preprocessor does not understand the context in which they are used.  Will be fixed. <br><br>  Ultimately, all of this resulted in a project called <a href="https://github.com/niXman/yarmi">YARMI</a> (Yet Another RMI). <br>  The described code generator is encoded in one file - <a href="">yarmi.hpp</a> .  In total, the implementation of the code generator took one working day. <br><br>  An example of using this whole thing can be seen <a href="https://github.com/niXman/yarmi/tree/master/examples/chat">here</a> and <a href="https://github.com/niXman/yarmi/tree/master/examples/echo">here</a> .  The first test project is still not completed, unfortunately. <br><br>  In addition to the described, on the project page you will find the codes of the asynchronous multi-user single-threaded server, and the codes of the client. <br><br><h4>  Instead of conclusion </h4><br>  Plans: <br>  1. Generating multiple interfaces <br>  2. Describe the specification (although it is nowhere easier) <br>  3. The ability to use your own allocator <br><br>  I would be grateful for constructive criticism and suggestions. <br><br>  PS <br>  This code is used in several of our commercial projects, in game dev. </div><p>Source: <a href="https://habr.com/ru/post/199496/">https://habr.com/ru/post/199496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../199484/index.html">Testing terminals VCS Huawei TE30</a></li>
<li><a href="../199488/index.html">Data transfer efficiency and information theory</a></li>
<li><a href="../199490/index.html">Create an ELF file with debug information (DWARF) manually (for ARM microcontrollers)</a></li>
<li><a href="../199492/index.html">External resources in Android applications</a></li>
<li><a href="../199494/index.html">Trackball. Say no to "tunnel syndrome"</a></li>
<li><a href="../199498/index.html">Easy localization of the name of the Windows Phone application</a></li>
<li><a href="../199500/index.html">Something went wrong</a></li>
<li><a href="../199502/index.html">RESTful Api using Zend framework 2</a></li>
<li><a href="../199506/index.html">Motorola Ara - a project to create modular smartphones</a></li>
<li><a href="../199508/index.html">IEEE 802.11s Wi-Fi Mesh for the smallest part one</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>