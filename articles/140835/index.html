<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Semi-automatic version numbering with git</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Walking through github I have seen many times in different repositories simultaneously tags like ‚Äúv2.3.4‚Äù and commits with messages like ‚ÄúBump version...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Semi-automatic version numbering with git</h1><div class="post__text post__text-html js-mediator-article">  Walking through github I have seen many times in different repositories simultaneously tags like ‚Äúv2.3.4‚Äù and commits with messages like ‚ÄúBump version‚Äù and changing the version numbers somewhere in lib / version.rb.  And it always seemed to me that something was superfluous. <br><br>  And when it came time to think about the distribution of version numbers to me, I said: ‚ÄúNo!  I will not register these numbers in the files by hand.  Let my version control system do it for me! ‚Äù <br><a name="habracut"></a><br><h4>  So, as I see it: </h4><br><ol><li>  The version number looks like a triple of numbers: the major.minor.patch version and is increased according to the <a href="http://docs.rubygems.org/read/chapter/7">rational version assignment policy</a> ; </li><li>  When releasing each new minor version, I create a tag of the form v &lt;major&gt;. &lt;Minor&gt; for a certain commit in history; </li><li>  Git automatically gives me the version number, based on the last tag (for this commit) and the number of commits after it. </li></ol><br><br><h4>  How it works: </h4><br>  As part of git there are many useful commands, we will be interested in two: <br><ol><li> <code>git describe</code> - shows information about the latest tag available from this commit; </li><li>  <code>git show</code> - displays various types of objects (but we will be interested only in the current commit). </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Armed with this knowledge, I put the version.rb file in my rails project in the config / initializers folder as follows: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppName</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Version</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Described</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IO::popen</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">git</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">describe</span></span></span><span class="hljs-class"> --</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">long</span></span></span><span class="hljs-class">') { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gs</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gs</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read</span></span></span><span class="hljs-class"> }).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strip</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Number</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Described</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gsub</span></span></span><span class="hljs-class">('-', '.').</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gsub</span></span></span><span class="hljs-class">(/^</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v</span></span></span><span class="hljs-class">/, '').</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">split</span></span></span><span class="hljs-class">('.')[0..-2].</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">join</span></span></span><span class="hljs-class">('.') </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strptime</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IO::popen</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">git</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class"> -</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class"> --</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">="%</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ct</span></span></span><span class="hljs-class">"') { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gs</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gs</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read</span></span></span><span class="hljs-class"> } , "%</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">") </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Revision</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IO::popen</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">git</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class"> -</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class"> --</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">="%</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">H</span></span></span><span class="hljs-class">"') { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gs</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gs</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read</span></span></span><span class="hljs-class"> }).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strip</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br>  Here the following happens: <br><br>  The <code>git describe --long</code> displays a message similar to the following: <code>v0.8-3-g387f83f</code> , where <br><ul><li>  <code>v0.8</code> - tag name </li><li>  <code>3</code> - the number of commits after this tag (0 if the tag is set for the current commit) </li><li>  <code>387f83f</code> - short hash of the current commit. </li></ul><br>  The line <code>Described.gsub('-', '.').gsub(/^v/, '').split('.')[0..-2].join('.')</code> Leads this message to the form <code>0.8.3</code> <br><br>  Using the <code>git show -s --format="%ct"</code> command <code>git show -s --format="%ct"</code> we get the date for creating the current commit in Unix format. <br><br>  And <code>git show -s --format="%H"</code> returns us the full hash of the commit. <br><br><h4>  Result </h4><br>  Now at the start of the application, the current version number and release date are automatically available to us.  And now, somewhere on the page we can write: <br><br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">" AppName.  </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{AppName::Version::Number}</span></span></span><span class="hljs-string">  </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{I18n.l AppName::Version::Date, </span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:format</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> =&gt; </span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:long</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string"> ."</span></span></code> </pre><br>  And to get <br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">" AppName.  0.8.3  27  2012 ."</span></span></code> </pre><br><br><h4>  Advantages and disadvantages </h4><br><h5>  pros </h5><ul><li>  Soaring over the version numbers is now less, and the cases ‚ÄúAh, damn, forgot to increase the version number!‚Äù Will now be less frequent (after all, the minor and major versions do not come out every day, right?); </li><li>  (As a result of the previous paragraph) The potential incompatibility of version numbers in the repository and in the code is eliminated (there are no more in the code); </li><li>  Ideal for compiled programs (C ++), as part of the build process. </li></ul><br><h5>  Minuses </h5><ul><li>  Outside the repository will not work (and who and why was going to keep the code outside the repository?); </li><li>  Hard binding of the number of commits to the patch version number (on the other hand, do not commit to each line of code); </li><li>  Sometimes the version number must still be hard coded; </li><li>  Not suitable for, for example, PHP, since calling a couple of three shell commands for each request is expensive. </li></ul><br><br><h4>  What to read? </h4><br>  Well, first of all, manuals for <a href="http://schacon.github.com/git/git-describe.html">git describe</a> and <a href="http://schacon.github.com/git/git-show.html">git show</a> . <br><br>  In general, a search on "&lt;CVS&gt; autoversioning" (where &lt;CVS&gt; is the name of your favorite version control system) will give you a considerable amount of recipes for any cases, programs and technologies. <br><br>  Good luck to you in establishing order (at least in versions). </div><p>Source: <a href="https://habr.com/ru/post/140835/">https://habr.com/ru/post/140835/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140828/index.html">Chalk-cepstral coefficients (MFCC) and speech recognition</a></li>
<li><a href="../140829/index.html">Web archive for Evernote</a></li>
<li><a href="../140830/index.html">And which exchange do you use?</a></li>
<li><a href="../140831/index.html">World frontend stars</a></li>
<li><a href="../140833/index.html">Runetology (140): founder of KupiVIP.ru Oscar Hartmann</a></li>
<li><a href="../140836/index.html">Google Pac-Man on your site</a></li>
<li><a href="../140838/index.html">The most important toolkit</a></li>
<li><a href="../140839/index.html">Hurl: Comfortable Curl</a></li>
<li><a href="../140841/index.html">Modern design of websites under the heading "Updated classics"</a></li>
<li><a href="../140842/index.html">Apply Attributes in C #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>