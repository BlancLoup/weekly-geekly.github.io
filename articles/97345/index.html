<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tracking an object by its color using Aforge.NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Frequent phrase: "my first post" :). In it I want to tell you about my small project to track an object by its color. Now it has a fairly wide ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tracking an object by its color using Aforge.NET</h1><div class="post__text post__text-html js-mediator-article">  Hello.  Frequent phrase: "my first post" :).  In it I want to tell you about my small project to track an object by its color.  Now it has a fairly wide range of applications, for example, the same joysticks from Wii and Playstation 3. The basis for the work was the development of Andrei Kirillov Aforge.NET - a rather powerful thing for self-made image processing. <br>  The code does not claim to be ‚Äúthe ultimate truth‚Äù, much has been simplified (in one place, in a sense, duplication was allowed - I created my own class for quick access to the pixels, although there were similar developments in Aforge).  But nevertheless, the code works, tracks the object, gives information about the location, allows you to dynamically calculate the shade of the object (in case of a change in lighting). <br><br>  For those interested - please under the cat. <br><a name="habracut"></a><br><br><h4>  A short excursion to AForge. </h4><br>  A framework is a set of libraries, each of which is designed to solve a specific kind of task: <br><ul><li>  <b>AForge.Imaging</b> - library with filters and calculations for image processing; </li><li>  <b>AForge.Vision</b> - computer vision library; </li><li>  <b>AForge.Neuro</b> - a library for working with neural networks; </li><li>  <b>AForge.Geneti</b> c - library for working with genetic algorithms; </li><li>  <b>AForge.Fuzzy</b> - fuzzy computing library; </li><li>  <b>AForge.MachineLearning</b> - a library for machine learning; </li><li>  <b>AForge.Robotics</b> - a library that provides support for some of the Robotics kits; </li><li>  <b>AForge.Video</b> - a set of libraries for video processing. </li></ul><br>  Included with the library is a set of examples. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  User interface </h4><br>  I did not write my project from scratch, I took the example of Vision \ MotionDetector as a basis.  He already knows how to connect to a webcam, a remote webcam (via JPEG, MJPEG url), and also open certain video files (which, I confess, did not experiment): <br><img src="http://img375.imageshack.us/img375/5395/image1t.png" alt="image"><br><br>  The original example is able to identify motion on a stream using several algorithms, the simplest of which is finding the difference between two consecutive frames. <br>  The form code was processed by a file, and sharpened specifically for the task.  On the Motion tab, you need to select an object search algorithm: <br><img src="http://img710.imageshack.us/img710/2408/image2zd.png" alt="image"><br><br>  Then select an object via the Define color tracking object form: <br><img src="http://img63.imageshack.us/img63/9282/image3bq.png" alt="image"><br><br>  Information about the object will be displayed in the status bar of the main form: <br><img src="http://img20.imageshack.us/img20/160/image4rv.png" alt="image"><br><br>  As an additional setting, the color difference threshold is provided - the ability to not track a single color, but to take into account its variations: <br><img src="http://img819.imageshack.us/img819/3656/image5p.png" alt="image"><br><br>  Additionally, the user can specify if he wants the object color to be also tracked during processing (that is, not only the object itself is tracked by color, but also the new color of the object is calculated during processing): <br><img src="http://img156.imageshack.us/img156/6403/image6gt.png" alt="image"><br><br>  The next bun comes as standard with the Aforge Motion Detector.  The object can be highlighted in different ways on the image: <br><img src="http://img256.imageshack.us/img256/9784/image7tg.png" alt="image"><br><br><h4>  Implementation </h4><br>  AForge.Vision.Motion.  <b>IMotionDetector</b> - an interface that allows you to search for the difference between images.  It inherits the <i>ColorDetection</i> class that performs the processing. <br>  To interact with the user interface, the <i>Initialize</i> (Image Image, Rectangle rect) method was added, which initializes the processing of subsequent frames.  Here is the collection of information about the target object (selected rectangle in the image).  Information is collected on the dominant color in the selected area (this property will continue to serve as the basis for tracking).  The position of the target is also remembered. <br><br>  <b>The iMotionDetector</b> has the following methods: <br><ul><li>  <i>ProcessFrame</i> (AForge.Imaging.UnmanagedImage) - transfers to the object the next frame received from the image capture device.  The next frame is an object of the AForge.Imaging.UnmanagedImage type, a class that allows pixels to be approached much faster than <i>Bitmap.GetPixel (x, y)</i> . </li><li>  <i>Reset</i> () - resets the contents of the class. </li></ul><br>  Properties: <br><ul><li>  AForge.Vision.Motion.IMotionDetector.  <i>MotionFrame</i> is a property of type AForge.Imaging.  <i>UnmanagedImage</i> , which is responsible for highlighting the region with the object. </li><li>  AForge.Vision.Motion.IMotionDetector.  <i>MotionLevel</i> - ‚Äúmovement level‚Äù (from 0 to 1) is an ephemeral value.  Did not implement. </li></ul><br>  To update the information in the status bar of the application, Get Properties has been added: <br><ul><li>  Point center </li><li>  Rectangle boundsbox </li><li>  Color ObjectColor </li></ul><br>  In order to use not only the target color, but also some shades, Set Property <i>DifferenceThreshold is used</i> . <br>  The main frame processing takes place in the <i>ProcessFrame</i> function.  The algorithm can be divided into the following steps: <br><ol><li>  Expansion of the region of the presence of the object.  We will look for a new position not across the whole screen, but only in the area adjacent to the previous position.  This makes the search more accurate from the point of view that the target object will not be confused with another object of the same color (in another part of the image). </li><li>  Calculation of the object boundaries in the above described area through the definition of the extreme points of the color that is dominant for the object (here also the possible color deviation - DifferenceThreshold) is taken into account. </li><li>  Creating a "mask" <i>MotionFrame</i> , which will allow MotionDetector to highlight the target object in the image. </li><li>  Next, the ‚Äúaverage color‚Äù and the size of the new object are calculated. </li><li>  If the object is too small (for example, in the next frame, our target object was completely closed by another object) - we do not change the position and color information inherited from the processing of the previous frame. </li><li>  Otherwise, the new position and boundaries of the object are remembered, and if the algorithm follows the color change, which is set using the bool DynamicColorTracking property, the new calculated color is also remembered. </li></ol><br>  This completes the image processing. <br><br><h4>  Possible improvements </h4><br>  As it was already mentioned about controllers to game consoles, their color usually differs in contrast with any other objects in the frame.  Therefore, it is possible to make a primary search for the target color throughout the frame (and not only in the adjacent area).  This will allow you to track the object with faster movement. <br><br><h4>  Useful links on the topic </h4><br>  ‚Ä¢ <a href="http://code.google.com/p/aforge/">Aforge project website</a> . <br>  ‚Ä¢ <a href="http://www.codeproject.com/KB/recipes/aforge.aspx">Aforge - an article on CodeProject</a> . <br><br>  PS <a href="http://depositfiles.com/files/xadwm7ihp">Link to the source at depositfiles</a> . <br>  <a href="https://docs.google.com/leaf%3Fid%3D0B1J52wcxzQF8MWFhNDMzNWMtMjgzNC00ZDA2LWJjNmUtMGJmNmU1NzNhZDhk%26hl%3Den">Link to the source in Google Docs</a> <br><br>  <b>UPD.</b>  Thanks for the karma, transferred to the thematic blog. </div><p>Source: <a href="https://habr.com/ru/post/97345/">https://habr.com/ru/post/97345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../97330/index.html">Medvedev "follows" the White House and Obama, and only?</a></li>
<li><a href="../97331/index.html">Is Dmitry Medvedev registered on Habr√©?</a></li>
<li><a href="../97333/index.html">Toshiba Libretto W100</a></li>
<li><a href="../97343/index.html">Software Asset Management or how to clean up the software</a></li>
<li><a href="../97344/index.html">How will Russia respond to cyber attacks?</a></li>
<li><a href="../97346/index.html">All the points on "e"</a></li>
<li><a href="../97347/index.html">Interactive On-line Advertising 2. We zhmakay by phone</a></li>
<li><a href="../97349/index.html">New Parallels Small Business Panel</a></li>
<li><a href="../97350/index.html">Intel Labs Petersburg: Oleg Semenov about SoC, programmable accelerators and new algorithms</a></li>
<li><a href="../97352/index.html">SE Xperia X10i: video review and bug-report</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>