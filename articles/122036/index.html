<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arrays vs containers in matmodelling problems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction  It so happened that my work is closely related to mathematical modeling of physical processes. Mathematical modeling is a very special a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arrays vs containers in matmodelling problems</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4>  It so happened that my work is closely related to mathematical modeling of physical processes.  Mathematical modeling is a very special area of ‚Äã‚Äãprogramming.  The calculation of even a relatively simple physical process can take several days or even weeks.  Therefore, the performance of the program comes to the fore, even at the expense of the convenience of writing and reading code.  However, until recently, the speed of my programs was of little concern to me: there were enough rough grids for which the calculations took about a day or so.  But gradually the grids became more detailed, and the program runtime grew steadily.  Then I began to look for bottlenecks in my program.  First in the algorithms.  Then it came to data structures.  And here I was very interested in the question ‚Äúwhat is better to use for storing vectors: arrays or containers?‚Äù <a name="habracut"></a>  In mathematical modeling, operations with large-dimension vectors and matrices, in particular, iterative methods for solving SLAEs, occupy one of the key positions.  Theoretically, working with arrays should be faster, but working with containers is more convenient.  The whole question is how to translate this "more" in the language of numbers?  Is it worth the convenience of such costs?  Search on the Internet did not give clear answers.  There were either vague formulations from the category of ‚Äúmore or less‚Äù, ‚Äúessentially-unimportant‚Äù or, at best, the simplest tests for repeated repetition of the same actions on elements of a vector.  But tests are one thing, and combat reality is quite another.  Moreover, having conducted some of these tests on my own, I was surprised to find that on different tests, different data structures have the advantage.  Then, as a test, I decided to use a real physical problem. <h4>  Task </h4>  As a test, I took the problem of convective flow known in thermal physics in an infinitely long square tube filled with liquid and heated from the side.  Since the pipe has an infinite length (for definiteness, along the z coordinate) and the boundary conditions do not depend on z, the problem can be considered as two-dimensional.  The left and right walls are maintained at constant, but different, temperatures.  Upper and lower walls are insulated.  On all walls, the conditions of impermeability and adhesion are specified, i.e.  equality to zero of all components of speed.  Convective heat transfer in a fluid is described by the system of equations of Navier-Stokes and continuity in the coordinates temperature-vortex-current function: <br><img src="http://www.eunnet.net/paint/metod_materials/wm1/P3/Image152.gif" alt="image"><br>  The problem was solved by the finite element method on a triangular grid with linear basis functions.  The size of the ax is 100x100 knots.  As a solver of SLAE, LOS with LU preconditioning was used. <h4>  Source codes </h4>  Source codes of programs can be found <a href="http://www.mediafire.com/%3Fr0nfwu2mfa9tbv9">here</a> . <h4>  Test results </h4>  So.  Actually for what it was all started.  It was written three software implementation of the solution of the above tasks.  C ++ was used as a programming language.  In the first program, dynamic arrays were used to store matrices and vectors, in the second, std :: vector containers, and in the third, QVector containers.  The program work times (in ticks) are presented in the table: <table><tbody><tr><td colspan="8">  Release </td></tr><tr><td></td><td>  one </td><td>  2 </td><td>  3 </td><td>  four </td><td>  five </td><td>  The average </td><td>  Loss of time </td></tr><tr><td>  Arrays </td><td>  21820000 </td><td>  21760000 </td><td>  21730000 </td><td>  21660000 </td><td>  21850000 </td><td>  21764000 </td><td>  0% </td></tr><tr><td>  std :: vector </td><td>  26680000 </td><td>  26660000 </td><td>  26900000 </td><td>  26870000 </td><td>  26790000 </td><td>  26780000 </td><td>  23% </td></tr><tr><td>  QVector </td><td>  43760000 </td><td>  43770000 </td><td>  43820000 </td><td>  43840000 </td><td>  43770000 </td><td>  43792000 </td><td>  101% </td></tr><tr><td colspan="8">  Debug </td></tr><tr><td></td><td>  one </td><td>  2 </td><td>  3 </td><td>  four </td><td>  five </td><td>  The average </td><td>  Loss of time </td></tr><tr><td>  Arrays </td><td>  50290000 </td><td>  50630000 </td><td>  50760000 </td><td>  - </td><td>  - </td><td>  50560000 </td><td>  0% </td></tr><tr><td>  std :: vector </td><td>  118830000 </td><td>  119560000 </td><td>  118240000 </td><td>  - </td><td>  - </td><td>  118877000 </td><td>  135% </td></tr><tr><td>  QVector </td><td>  306800000 </td><td>  297400000 </td><td>  294400000 </td><td>  - </td><td>  - </td><td>  299530000 </td><td>  492% </td></tr></tbody></table><h4>  findings </h4>  So, the main conclusion from the test results can be drawn as follows: the use of containers is unacceptable when solving the problems of mathematical modeling.  No convenience in writing code, no security code can justify a drop in performance of 23%.  Frankly, I did not expect such a noticeable fall.  The results of QVector's testing became an even more unpleasant surprise for me, because I used it in my program.  This serious lag seems to be due to the use of the concept of SharedMemory.  Saving on copying, we lose on access to the elements of the container, because when you change each!  element is an additional check for the need to perform deferred copying. <h4>  Bonus: Mathematical Simulation Results </h4><table><tbody><tr><td>  Temperature: <br><img src="https://habrastorage.org/getpro/habr/post_images/92c/8fa/ae2/92c8faae2e58f35238108096f473b6fb.jpg"></td><td>  Current function: <br><img src="https://habrastorage.org/getpro/habr/post_images/d11/b35/e1a/d11b35e1a5020ad30fd4866090268f8a.jpg"></td></tr><tr><td>  Vortex: <br><img src="https://habrastorage.org/getpro/habr/post_images/804/6eb/d1c/8046ebd1cfe23be283e23f0ed5d3a22c.jpg"></td><td>  Vx: <br><img src="https://habrastorage.org/getpro/habr/post_images/23d/17d/f8c/23d17df8c74a1cca59f16211768f4b83.jpg"></td></tr><tr><td>  Vy: <br><img src="https://habrastorage.org/getpro/habr/post_images/ec3/0d1/04c/ec30d104c33582158831654e8056aa3b.jpg"></td></tr></tbody></table></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/122036/">https://habr.com/ru/post/122036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122030/index.html">Choosing a microcontroller together</a></li>
<li><a href="../122031/index.html">Interview Mark Shuttleworth: in Ubuntu, the default browser will be Google Chrome</a></li>
<li><a href="../122033/index.html">Kinect for Windows SDK beta</a></li>
<li><a href="../122034/index.html">PDF rendering using HTML5 and JavaScript (pdf.js)</a></li>
<li><a href="../122035/index.html">Startup from scratch: the story of Github</a></li>
<li><a href="../122037/index.html">Hide 1C for the fireproof wall</a></li>
<li><a href="../122038/index.html">Automatically add files to the WiX installer</a></li>
<li><a href="../122039/index.html">UserEcho visualization flexibly transforms to customer requests</a></li>
<li><a href="../122042/index.html">Introducing Evernote for Windows Phone 7</a></li>
<li><a href="../122043/index.html">Approach to testing code in real life. Part two</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>