<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing games for Windows 8 using MonoGame: touchscreen support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article it was told about the main points related to the development of games for Windows 8 and MonoGame. Despite the fact that the ga...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing games for Windows 8 using MonoGame: touchscreen support</h1><div class="post__text post__text-html js-mediator-article">  In the previous <a href="http://habrahabr.ru/company/microsoft/blog/164217/">article</a> it was told about the main points related to the development of games for Windows 8 and MonoGame.  Despite the fact that the game is already running, it lacks the important functions that are necessary when implementing an application for Windows 8. This is touch support and a mandatory privacy policy screen. <br><a name="habracut"></a><br><br><h4>  Implementation of touch support <br></h4><br>  Windows 8 can run on the most diverse range of devices, including tablets that do not have a keyboard.  Our game is a classic platformer, to control the character in the game only support for the gamepad and keyboard is implemented.  To support devices without a keyboard but with a touch screen, code additions are needed. <br><br>  The current implementation of MonoGame for Windows 8 allows you to poll the state of the screen sensor using the <code>TouchPanel</code> class from the <code>Xna.Framework.Input.Touch.</code>  Supports gestures, and the combined interaction with the mouse.  In the simplest case, in order to find out whether there is a click on the screen, it is enough to call the <code>GetState()</code> method which will return the list of points to which the touch is currently performed: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (TouchLocation location <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> TouchPanel.GetState()) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (location.State) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TouchLocationState.Moved: <span class="hljs-comment"><span class="hljs-comment">// location.Position.X; // location.Position.Y; // location.Pressure // location.Id break; case TouchLocationState.Pressed: break; case TouchLocationState.Released: break; case TouchLocationState.Invalid: break; } }</span></span></code> </pre><br><br>  The returned <code>TouchLocation</code> object contains data on the type, coordinates of the touch, its sequence number (up to five simultaneous points are supported as standard) and the force of pressing. <br><br>  To support touches, we implement the standard approach adopted in many games - we will simply draw on the screen an image of the cursor keys and a jump button.  Further it will be necessary only to calculate the coordinates of the touch areas, and poll them for the fact of pressing. <br><br>  In the CastleX game itself, control event handling is implemented in two ways.  The main menu handles events using the InputState class in each <code>Update()</code> method (before calling <code>Draw</code> ).  At the same time, the <code>InputState</code> class remembers the previous state of keystrokes.  Additionally, direct player status is used to control the player.  These standard handlers are required to be modified. <br><br>  The first thing we need to do is create images of the cursor keys and jump buttons.  Using Paint.NET, two PNG files with transparency were created: <br><img src="https://habrastorage.org/storage2/8bc/508/12c/8bc50812ca8ddaba5551c1a6ceb82ae7.png"><br><img src="https://habrastorage.org/storage2/3cd/9ac/7f9/3cd9ac7f9765b6b27b437a98533b4d1a.png"><br><br>  Next, these files must be placed in the <code>Assets/GameContent</code> .  In principle, we do not even need to create an XNB file, the content subsystem in MonoGame can read PNG files directly. <br><img src="https://habrastorage.org/storage2/91a/147/d28/91a147d285058d2d8618cbd8c8ed2fcf.png"><br><br>  As an example, the cursor keys will be displayed in the screen manager, and the Jump button only in the game screen. <br><br>  Load the texture file in the <code>LoadContent()</code> method: <br><br><pre> <code class="cs hljs">arrowkeys_texture = Content.Load&lt;Texture2D&gt;(<span class="hljs-string"><span class="hljs-string">@"transparent_arrow_keys"</span></span>);</code> </pre><br><br>  And display on the screen in the method <code>Draw()</code> <br><br><pre> <code class="cs hljs"> SpriteBatch.Begin(); SpriteBatch.Draw(arrowkeys_texture, drawPos, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); SpriteBatch.End();</code> </pre><br><br><br>  In this case, the alpha channel will be taken into account in the PNG file and, as a result, semi-transparent images of the cursor keys and buttons will be displayed on the screen: <br><img src="https://habrastorage.org/storage2/2fc/231/e15/2fc231e15ffc970f305af7e83ce314ab.png"><br><br>  But for now these are just static images and you need to handle push events in this area. <br><br>  For this, a simple method will be used - just set the coordinates of the clicked area and we will check this coordinate for the state of the <code>TouchLocationState.Moved</code> <br><br>  I would also like to keep the current infrastructure of event handling from the keyboard and gamepad implemented in the <code>InputState</code> class. <br><br>  In the special method <code>AddTouchKey(Keys key, Rectangle rect)</code> coordinate associated with the key will be specified, and in addition to polling the keyboard status, the <code>UpdateTouchKeys()</code> method will also be called <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateTouchPos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Dictionary&lt;Keys, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; key_states </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> touched = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Keys key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _touchKeys.Keys) key_states.Add(key,<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (TouchLocation location <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> TouchPanel.GetState()) { touched = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _touchKeys.Keys) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.State == TouchLocationState.Moved) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_touchKeys[k].Contains((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)location.Position.X, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)location.Position.Y)) { key_states[k] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> touched; }</code> </pre><br><br><br>  This method polls all the clicked coordinates, and if they are included in the list of keypress areas associated with the keys, this button is added to the list of keystrokes for further use in the <code>IsKeyDown()</code> and <code>IsKeyUp()</code> methods <code>IsKeyDown()</code> <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsKeyDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Keys key</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (touchKeys.ContainsKey(key) &amp;&amp; isTouched) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> touchKeys[key]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> orig_key_state.IsKeyDown(key); }</code> </pre><br><br><br>  It should be noted that based on this code, pressing the screen has a higher priority than the keyboard.  In principle, the changes made are enough for the game to work with the support of on-screen keys.  Before standard polling, you only need to set the polling coordinates and associate them with the keys: <br><br><pre> <code class="cs hljs"> Input.AddTouchKey(Keys.Down, hitPosDown); Input.AddTouchKey(Keys.Up, hitPosUp); Input.AddTouchKey(Keys.Left, hitPosLeft); Input.AddTouchKey(Keys.Right, hitPosRight); Input.Update();</code> </pre><br><br><br><h4>  Add a privacy agreement to the game </h4><br><br>  One of the important conditions for passing certification when publishing applications is the existence of a privacy policy. <br><img src="https://habrastorage.org/storage2/518/c74/9d9/518c749d90840bbfd0d31aca80346dcb.png"><br><br>  For applications on MonoGame, such a screen is implemented in a simple way; in the Init method of the basic class of the game, subscription to the events of the application properties call is made and the handler is set: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Initialize(); SettingsPane.GetForCurrentView().CommandsRequested += PaneRequest; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PaneRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SettingsPane sender, SettingsPaneCommandsRequestedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { UICommandInvokedHandler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UICommandInvokedHandler(onPrivacyPolicyCommand); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> privPolicyCmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SettingsCommand(<span class="hljs-string"><span class="hljs-string">"PrivacyPolicyId"</span></span>, <span class="hljs-string"><span class="hljs-string">"Privacy Policy"</span></span>, handler); args.Request.ApplicationCommands.Add(privPolicyCmd); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPrivacyPolicyCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IUICommand command</span></span></span><span class="hljs-function">)</span></span> { Launcher.LaunchUriAsync(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"http://wincommunity.ru/baller/privacy.html"</span></span>)); }</code> </pre><br><br>  You can download the original project with these changes at <a href="http://aka.ms/cgt2fr">aka.ms/cgt2fr</a> </div><p>Source: <a href="https://habr.com/ru/post/167815/">https://habr.com/ru/post/167815/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167803/index.html">The most notable problems of cloud providers for 2012</a></li>
<li><a href="../167805/index.html">IOS Alarm Log Demystification</a></li>
<li><a href="../167807/index.html">Yandex Map Kit for Android. Card rotation</a></li>
<li><a href="../167809/index.html">Information universe. Private conclusions from the assumption</a></li>
<li><a href="../167813/index.html">How google & yandex find pictures</a></li>
<li><a href="../167817/index.html">Sierpinski Triangle and Pascal's Triangle</a></li>
<li><a href="../167819/index.html">Yandeks.Narod: hosting moves to uCoz</a></li>
<li><a href="../167821/index.html">Impressions of the Enot V134 tablet</a></li>
<li><a href="../167823/index.html">Separate server for MySQL database - how to save traffic and speed up the application</a></li>
<li><a href="../167827/index.html">How we did our last amateur translation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>