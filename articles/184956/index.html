<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parsing a CSV file with bash and awk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habrochitatel! 

 I needed to translate the interface of one system. The translation for each form lies in a separate XML file, and the file...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parsing a CSV file with bash and awk</h1><div class="post__text post__text-html js-mediator-article"> Good day, Habrochitatel! <br><br>  I needed to translate the interface of one system.  The translation for each form lies in a separate XML file, and the files are grouped in folders, which is very inconvenient.  It was decided to create a single dictionary in Excel to work with the translation of all forms.  This task, in turn, is divided into 2 subtasks: extract information from all XML files into one CSV file; after transferring from a CSV file, create XML files with the same structure.  Bash and awk were chosen as tools.  It makes no sense to describe the first subtask, since it is rather trivial.  But how to parse the CSV file? <br><a name="habracut"></a><br>  On the Internet you can find a lot of information on this topic.  Most of the examples easily handle only simple options.  But I did not find anything suitable, for example, for this: <br><br> <code>./web/analyst/xml/list.template.xml;test;"t ""test""; est"</code> <br> <code>./web/analyst/xml/list.template.xml;%1 _{factory_desc}s found. Displaying %2 through %3; : %1.   %2  %3 <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In Excel, these lines look like this: <br><table><tbody><tr><th>  File </th><th>  Tag </th><th>  Transfer </th></tr><tr><td>  ./web/analyst/xml/list.template.xml </td><td>  test </td><td>  t "test";  est </td></tr><tr><td>  ./web/analyst/xml/list.template.xml </td><td>  % 1 _ {factory_desc} s found.  Displaying% 2 through% 3 </td><td>  Found objects:% 1.  Displayed from% 2 to% 3 </td></tr></tbody></table><br>  Taking the <a href="http://www.opennet.ru/tips/info/1811.shtml">example</a> from OpenNET as a basis, I decided to change it.  Here is the text of the awk program: <br><br><pre> <code class="cpp hljs">{ $<span class="hljs-number"><span class="hljs-number">0</span></span>=$<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-string"><span class="hljs-string">";"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($<span class="hljs-number"><span class="hljs-number">0</span></span>) { #       ,  ;  <span class="hljs-string"><span class="hljs-string">""</span></span>; match($<span class="hljs-number"><span class="hljs-number">0</span></span>,/[^;<span class="hljs-string"><span class="hljs-string">"]*;|^"</span></span>[^<span class="hljs-string"><span class="hljs-string">"]*("</span></span><span class="hljs-string"><span class="hljs-string">"[^"</span></span>]*)*<span class="hljs-string"><span class="hljs-string">";/); #     F  SF SF=F=substr($0,RSTART,RLENGTH); #  ;  "</span></span><span class="hljs-string"><span class="hljs-string">"; gsub(/^"</span></span>|<span class="hljs-string"><span class="hljs-string">";$|;$/,"</span></span><span class="hljs-string"><span class="hljs-string">",F); #      gsub("</span></span>\<span class="hljs-string"><span class="hljs-string">"\""</span></span>,<span class="hljs-string"><span class="hljs-string">"\""</span></span>,F); ++c; #    file_to   xml-      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c%<span class="hljs-number"><span class="hljs-number">3</span></span>==<span class="hljs-number"><span class="hljs-number">1</span></span>) file_to=AWK_XML_PATH F; #   xml- tag      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c%<span class="hljs-number"><span class="hljs-number">3</span></span>==<span class="hljs-number"><span class="hljs-number">2</span></span>) print <span class="hljs-string"><span class="hljs-string">" &lt;ResourceString&gt;\r\n &lt;tag&gt;"</span></span>F<span class="hljs-string"><span class="hljs-string">"&lt;/tag&gt;"</span></span> &gt; file_to; #   xml- value      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c%<span class="hljs-number"><span class="hljs-number">3</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span>) print <span class="hljs-string"><span class="hljs-string">" &lt;value&gt;"</span></span>F<span class="hljs-string"><span class="hljs-string">"&lt;/value&gt;\r\n &lt;/ResourceString&gt;\r\n"</span></span> &gt; file_to; #     <span class="hljs-function"><span class="hljs-function">SF </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gsub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(/\\/,</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"\\\\"</span></span></span></span><span class="hljs-function"><span class="hljs-params">,SF)</span></span></span></span>; #  .    <span class="hljs-function"><span class="hljs-function">SF </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gsub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"([][?$|^+*()])"</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"\\\\"</span></span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"&amp;"</span></span></span></span><span class="hljs-function"><span class="hljs-params">,SF)</span></span></span></span>; #       SF   .  sub(SF,<span class="hljs-string"><span class="hljs-string">""</span></span>); } }</code> </pre><br>  And here is a fragment of the bash-script ( <code>XML_PATH</code> is a variable with the path along which folders with XML files are located): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#         iconv -f WINDOWS-1251 -t UTF8 $1 | tr -d '\r' | sed '1d' &gt; translation.csv # ""     xml- awk -v AWK_XML_PATH="$XML_PATH" ‚Äìf csv_parse.awk translation.csv</span></span></code> </pre><br>  As a result, from the table <br><table><tbody><tr><th>  File </th><th>  Tag </th><th>  Transfer </th></tr><tr><td>  ./web/analyst/xml/list.template.xml </td><td>  test </td><td>  t "test";  est </td></tr><tr><td>  ./web/analyst/xml/list.template.xml </td><td>  % 1 _ {factory_desc} s found.  Displaying% 2 through% 3 </td><td>  Found objects:% 1.  Displayed from% 2 to% 3 </td></tr></tbody></table><br>  A list.template.xml file is generated with the following contents: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>t "test"; est<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag">&gt;</span></span>%1 _{factory_desc}s found. Displaying %2 through %3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> : %1.   %2  %3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceString</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  PS <br>  I know that you can choose other tools that can solve the problem more efficiently.  Perhaps Python.  This example will be useful to those who for some reason cannot use them. </div><p>Source: <a href="https://habr.com/ru/post/184956/">https://habr.com/ru/post/184956/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184942/index.html">Building scalable applications in TypeScript. Part 1 - Asynchronous Module Loading</a></li>
<li><a href="../184946/index.html">Why I refused to use the Vkontakte API</a></li>
<li><a href="../184950/index.html">Turning on the server using a mobile phone from the outside world</a></li>
<li><a href="../184952/index.html">Build CLDC HotSpot Implementation for ARM</a></li>
<li><a href="../184954/index.html">Windows 8.1 (aka Blue) Preview available for download</a></li>
<li><a href="../184958/index.html">Drawings in SVG format. Part 1 - Draft Standard</a></li>
<li><a href="../184960/index.html">Self build cURL for iOS and Android</a></li>
<li><a href="../184962/index.html">Travel book tester</a></li>
<li><a href="../184964/index.html">Setting up your own GIT / SVN / Mercurial server based on SCM Manager for Tomcat under Debian</a></li>
<li><a href="../184966/index.html">Home mini climate control do-it-yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>