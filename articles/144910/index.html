<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is the cause of the blockage? Web application statistics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the past, our post attentive dovg habrauzer noted a screenshot with a beautiful schedule. It reflected the time of the various search operations. A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is the cause of the blockage? Web application statistics</h1><div class="post__text post__text-html js-mediator-article">  In the past, our post attentive dovg <a href="http://habrahabr.ru/users/dovg/" class="user_link">habrauzer</a> noted a screenshot with a beautiful schedule.  It reflected the time of the various search operations.  And since statistics and performance analysis of high-load projects is a rather topical issue, we decided to tell you about the system that we use to collect and analyze Mamba statistics.  As in the case of search, we use our own solution, but unlike BTP (no one remembers how this abbreviation came into being, but for some reason it became the name) is in the public domain, and if you want, you can install it on their servers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2e/37f/570/a2e37f5708ff7f4d7b90ce602a3b89db.png" alt="image"><br><a name="habracut"></a><br>  The system provides the following types of statistics: <br><ul><li>  on operations on the service (for example, "mysql" or "memcache") </li><li>  on operations on a specific service server (for example, the mysql service and the db7 server) </li><li>  on scripts that use some kind of service operation (for example, ‚Äúupdate‚Äù of the ‚Äúmysql‚Äù service) </li><li>  on services / operations that a particular script uses </li></ul><br>  To get the most complete picture of how applications work, we used the information view in two hierarchies.  The first is quite traditional: service-server-operation.  It allows you to determine the load on services, the uniform distribution of load across servers and the frequency of use of specific operations. <br><br>  Here is reflected, for example, the number of queries to clustered databases.  Monitoring the response time of each of them allows us to understand the overall performance, and in case of problems, find out which specific base slows down the most.  In the same hierarchy, we look at the fact that only selects have increased, or also updates;  normal or increased cache load, etc.  In other words, in case of problems, here we determine the point of failure - which service / server reduces overall performance.  At the same time, processing the information, the web interface also takes data from the second hierarchy, displaying which scripts most use the operation of interest to us of a particular service. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The second hierarchy, the script-service-operation, can be used to find out the specific ‚Äúcause of blockage,‚Äù namely, what the inhibitory script refers to and what it spends time on.  In this hierarchy, you can determine which specific services the script uses, how many requests it makes and how long it takes to respond to these requests.  This is how it is possible, for example, to determine why a change in the script code led to an increase in the load on a specific database. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/867/443/1b1/8674431b1a0828800d7e85c100a9c80d.jpg"><br><br>  The most common measure of web application performance is response time.  Many systems limit analytics to average and borderline response times, but in practice these data may turn out to be a ‚Äúspherical horse in a vacuum.‚Äù  Suppose that 10% of visitors get the right page 10-20 times slower than the rest 90%.  This does not affect the average, but with a million audience it will result in hundreds of thousands of disgruntled users.  Therefore, we use reports on percentiles and we can see not only the average indicators, but also the values ‚Äã‚Äãthat contain 50, 80, 95 and 99 percent of operations.  This allows us to get a much more relevant result in terms of ‚Äúuser satisfaction‚Äù. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/89e/7d6/01c/89e7d601c8eec7f2c90fd1b8fc366432.png" title="BTP statistics system"></a> <br><br>  In developing the system, we immediately assumed that the number and composition of the measured parameters may vary.  In addition, long-term analytics is impossible without analyzing the data stored for a certain period of time, so we also paid special attention to storing the available statistics. <br><br>  As a result, from a technical point of view, the system consists of the following parts: <br><ol><li>  <b>Demon</b> <br>  Accepts and processes data counters;  considers, stores and issues statistics.  It works using the JSON-RPC protocol, and uses the kyoto cabinet library for storage (the key-value embedded repository). </li><li>  <b>Web interface</b> <br>  The actual interface for viewing statistics.  Draws graphs (more on the graphs below). </li><li>  <b>Customer</b> <br>  This is the part that integrates into your application.  Sends counters to the daemon.  In this case, you can use a ready-made client in PHP or Python, and also, if you wish, write your own. </li></ol><br>  When you enter the web interface, you immediately see the statistics on the counters from your script.  Statistics for the last ~ 2 hours is calculated with a resolution of 5 seconds.  Day - with a resolution of 1 minute (well, there is, of course, statistics for the month and year with a resolution of 30 minutes and 6 hours, respectively). <br><br>  For drawing graphs, the web interface uses client templates, Backbone.js and dygraphs, and almost all is written in javascript, with the exception of the small http-to-json-rpc-proxy js.php file, and index.php (which collects client templates on the page from a separate directory). <br><br>  Actually on the charts should stay separately.  For their generation and output we tried to use several different libraries, including highcharts, raphael.js and envision.js, but we stopped at dygraphs.  We talked about as follows: <br><br>  <b>Raphael:</b> svg-based library, in which almost everything has to be done by hand.  Including draw a grid in the form of segments SVG.  And while it does not have a high speed. <br>  <b>Highcharts:</b> much simpler than Raphael, also svg-based, but with customization, there are some difficulties.  And also not very fast (3-4 graphics with 1.5 thousand points significantly slow down). <br>  <b>Envision.js:</b> canvas-based, a bit faster (if you don‚Äôt use all sorts of interesting things like mini-navigation).  In general, a good option. <br>  <b>Dygraphs:</b> the smartest.  The existing functionality is implemented relatively simply, but some possibilities are not enough (for example, it was not possible to draw two graphs on one screen in different representations: in the form of a filled area and a simple line).  However, the speed of work has exceeded that of other libraries by several times.  As a result, the choice was stopped on Dygraphs. <br><br>  Naturally, there are other systems for collecting statistics, for example, New Relic and Pinba.  But BTP has several advantageous differences. <br><br>  It differs from New Relic in that, firstly, it is an open product, and secondly, it is focused on monitoring application parameters (what is called custom metrics in new relic).  And thirdly, the installation of php extension and the java proxy agent is not necessary.  Although we must admit that the interface for New Relic is more ‚Äúlicked‚Äù. <br><br>  Our system differs from Pinba, firstly, by simpler installation (no plugin for MySQL is needed, extension is not needed), and secondly, by the fact that pinba is only involved in calculating statistics.  Pinba does not store and does not display data, and in order to do this, you have to attach cron-scripts to Pinba, rrdtool with a bunch of command line parameters and tools for drawing graphs.  And of course, when adding new counters, you need to remember to save the data from them too. <br><br>  References: <br>  BTP / Demon <br>  <a href="https://github.com/mambaru/btp-daemon">https://github.com/mambaru/btp-daemon</a> <br>  <a href="http://imgur.com/a/idFF6">Pictures</a> <br><br>  BTP / Web Interface <br>  <a href="https://github.com/mambaru/btp-webui">https://github.com/mambaru/btp-webui</a> <br><br>  BTP / Our client <br>  <a href="https://github.com/mambaru/btp-api">https://github.com/mambaru/btp-api</a> <br><br>  BTP / Python client <br>  <a href="https://github.com/mastergenius/pybtp">https://github.com/mastergenius/pybtp</a> <br><br>  New relic <br>  <a href="https://newrelic.com/docs/php/the-php-api">https://newrelic.com/docs/php/the-php-api</a> <br><br>  Pinba <br>  <a href="http://pinba.org/wiki/Main_Page">http://pinba.org/wiki/Main_Page</a> </div><p>Source: <a href="https://habr.com/ru/post/144910/">https://habr.com/ru/post/144910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144902/index.html">Especially strong novelties of Sony: Xperia acro S and Xperia go</a></li>
<li><a href="../144903/index.html">Top places on Google+</a></li>
<li><a href="../144904/index.html">Banks. Errors and Vulnerabilities</a></li>
<li><a href="../144905/index.html">Comparison of the speed of range-based for, foreach (Qt) and some of the STL when calculating the sum of container elements</a></li>
<li><a href="../144906/index.html">So.cl: Microsoft's Search Engine</a></li>
<li><a href="../144911/index.html">Happy Hacking Keyboard</a></li>
<li><a href="../144913/index.html">Dirty programming with a pure soul: the development of heuristic systems (part 2)</a></li>
<li><a href="../144914/index.html">IPO Vkontakte postponed indefinitely due to the failure of Facebook</a></li>
<li><a href="../144915/index.html">WebAPI: auto-generated REST API web documentation</a></li>
<li><a href="../144917/index.html">Instant porridge - do CRUD in Cach√© using jqGrid</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>