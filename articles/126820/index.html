<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creation and promotion of Symbian-hit. Part 1 Development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post, a story is published about how the Magic Brush app was created, and about the difficulties encountered during its development. Currently...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creation and promotion of Symbian-hit. Part 1 Development</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/2122bf20/d9f0b57f/2c16e80d/5acb62fa.jpg" align="left">  In this post, a story is published about how the Magic Brush app was created, and about the difficulties encountered during its development.  Currently Magic Brush is one of the most popular applications in the Ovi Store, which provides a steady income.  In good times, the number of app sales only in the Ovi Store reaches 4K copies per month.  And the Lite version was downloaded about 1.7 M times.  But the fun thing that was originally conceived completely different application.  Everything in order under the cut. <br><a name="habracut"></a><br><br>  The work of the program Magic Brush: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/w-q46NdCOAo&amp;xid=25657,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjvOetu3x7VU2_P7kiggokehHJAYw" frameborder="0" allowfullscreen=""></iframe><br><br>  <b>Program Page:</b> <a href="http://www.tarasov-mobile.com/magicbrush.html">http://www.tarasov-mobile.com/magicbrush.html</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What was intended, or the engine for the game </h4><br>  It all started in February 2010.  Then I bought my first smartphone - Nokia 5800 Express Music.  Having played around for about a month with a new device, I remembered my childhood dream and decided to write a game for a touch-phone.  And all I wanted then was this: <br><ul><li>  gain new experience; </li><li>  get fan out of development; </li><li>  maybe make some money.  :) </li></ul><br>  I chose the genre of physical 2D puzzles, but I wanted my toy to stand out against the background of already existing Symbian games.  After studying the content from the Ovi Store, I decided to make a game with vector graphics, anti-aliasing and sub-pixel positioning of objects in the game.  And as soon as the decision was made, I took up the implementation.  The first step was to create an engine. <br><br>  Getting to know the Symbian SDK first shocked me.  First, Symbian C ++ seemed to me extremely strange and unusual.  Secondly, Symbian ^ 1 smartphones (5800, N97, etc.) were built on a rather weak hardware platform without a graphics accelerator on board.  The SDK had OpenGL libraries, but they were implemented programmatically.  Thirdly, despite the support of smartphone CPUs for floating-point operations, the SDK compiler did not know how to generate a code that performs floating-point operations in hardware. <br><br>  The first problem was solved rather quickly.  Fortunately, you can write code not only on Symbian C ++, but also on standard C ++.  And since my game with the Symbian API practically didn‚Äôt work, only initialization was written on Symbian C ++, interaction with sensors and a timer.  Everything else was successfully written in classic C ++ using STL. <br><br>  Having dealt a bit with the charms of Symbian C ++, I started working on displaying graphics on the screen.  I had no experience with OpenGL, besides, on Symbian ^ 1 OpenGL would not give a performance boost (since there is no accelerator).  But in Symbian, a very nice feature was discovered - Direct Screen Access (DSA).  With DSA, I was able to directly access the video memory of the device. <br><br>  Ok, the access to the video buffer has been obtained, now you can programmatically render everything that your heart desires at the maximum possible speed.  Quite quickly, methods for outputting sprites to the buffer were written, and <a href="http://www.antigrain.com/">Anti Grain Geometry (AGG)</a> library was included for smoothed vector graphics.  Rather, its very lite version: AGG Lite.  Using AGG, methods were quickly written for displaying simple graphic primitives (line, circle, etc.) on the screen.  Everything worked quite fast, and the picture was pleasing to the eye. <br><br>  To store information about complex vector objects consisting of many colorful figures, container classes were used.  In them, I also implemented methods for displaying these objects on the screen in certain coordinates, at a certain angle and with a certain scale.  After that, <a href="http://www.box2d.org/">Box2D</a> was connected to the project, and the picture on the screen began to obey the laws of physics. <br><br>  And then the problems started.  The picture on the screen looked great, all the lines were smoothed, but due to the sub-pixel accuracy of the output, all the movements of the objects seemed very smooth ... While there were few moving objects on the screen.  If 10‚Äì12 game vector objects were added to the screen, then fps fell disastrously.  It was necessary to do something to save the situation. <br><br>  First of all, all floating point arithmetic was rewritten to fixed-point arithmetic.  This was helped by the Fixed class from Box2D, then pre-calculated tables were added to calculate the trigonometric functions, optimized methods for calculating the square root and random numbers.  In the project, there is not a single use of floating-point numbers.  This gave a good performance boost, but still not enough.  It was possible to find several places in AGG that are optimizable.  For example, turning off color mixing and turning on simple copying to display opaque areas of objects.  This added a couple more fps, but still failed to raise fps above 15.  It was possible to play at 15 fps, but ... I had to think over another gameplay, in which there would be less dynamics and more static objects. <br><br>  In parallel with thinking about new gameplay, I continued working on the engine: added support for bitmap fonts from the <a href="http://www.angelcode.com/products/bmfont">AngelCode</a> converter, self-made localization support and a window system, as well as a small set of widgets. <br><br><h4>  What happened, or Magic Brush </h4><br>  And then I came across this article on Habr√©: <a href="http://habrahabr.ru/company/intel/blog/92390/">Dmitry Ryzhkov and his My Little Artist won a solid prize in the competition for the best application for the Intel Atom</a> .  Looking at My Little Artist in my work and looking at <a href="http://mrdoob.com/projects/harmony">harmony by mr.doob</a> , I realized that I could very quickly implement something like that on an already existing engine.  In just 15 minutes, the first brush was added and tested, and it worked great!  I analyzed and rewrote the code for the harmony brushes in C ++ with some optimizations.  Nine new brushes were also added, UI applications were written, and each brush had additional settings (color, line thickness, transparency, etc.). <br><br>  The work of various brushes can be seen in this video: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/sZ6N_kZazSU%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhiaQcoT8Pe9CYiUinbAn2X_NsRb2w" frameborder="0" allowfullscreen=""></iframe><br><br>  Well, as an example, I will describe how the Smoke brush was implemented: <br><br><img src="https://habrastorage.org/storage1/9f5b440e/f35c6f12/8d4f2451/093d44b7.jpg"><br><br>  In my program, all classes of brushes, including SmokeBrush, implement 3 purely virtual base class methods that output to the screen: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StrokeStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fixed x, Fixed y)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stroke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fixed x, Fixed y)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StrokeEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fixed x, Fixed y)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><br>  They are called when you touch the screen, move your finger and tear it away from the screen surface, respectively.  In addition, the base class contains attributes that are responsible for color, transparency and thickness of the lines: <br><br><pre> <code class="cpp hljs">agg::rgba8 color; Fixed opacity; Fixed width;</code> </pre> <br><br>  and a pointer to the current output buffer: <br><br><pre> <code class="cpp hljs">BufferGraphics* graphics;</code> </pre> <br><br>  To implement the brush, you will need Smoke from thin lines - ‚Äústreams‚Äù of smoke - to build a thicker line.  To do this, you need to know the current position of each ‚Äújet‚Äù relative to the current position of the user's finger.  For this purpose, SmokeBrush uses the vector of points: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Point&gt; points;</code> </pre> <br><br>  It is also necessary to memorize the previous position of the finger in order to draw lines from it to the current position: <br><br><pre> <code class="cpp hljs">Point previousFingerPosition;</code> </pre> <br><br>  The logic of the brush is described in the StrokeStart and Stroke methods: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SmokeBrush::StrokeStart(Fixed x, Fixed y) { points.clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(width * Fixed(<span class="hljs-number"><span class="hljs-number">3</span></span>)) + <span class="hljs-number"><span class="hljs-number">16</span></span>; ++i) { Fixed r = (fixrand() * Fixed(<span class="hljs-number"><span class="hljs-number">0.4f</span></span>) + Fixed(<span class="hljs-number"><span class="hljs-number">0.1f</span></span>)) * width; Fixed a = fixrand() * Fixed::PI2; points.push_back(Point(r * <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(a), r * <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(a))); } previousFingerPosition = Point(x, y); }</code> </pre> <br><br>  When you touch the screen, you need to clear the vector points from the values ‚Äã‚Äãthat remained in it after the previous use of the brush.  Then a new point cloud is written to this vector.  And the greater the thickness of the brush, the more ‚Äújets‚Äù will be needed to display the brush on the screen.  Each individual ‚Äújet‚Äù is located at a random distance from the touch point of the screen, but not more than half the thickness of the brush.  You also need to remember the current touch point for later use. <br><br>  Earlier, I wrote that in the project there was not a single use of floating point numbers, but in the text you can see float.  Fortunately, the compiler is smart enough to properly handle the inline constructor of the Fixed class.  As a result, at the execution stage, the work actually occurs only with integer values. <br><br>  In the Stroke method, output to the screen: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SmokeBrush::Stroke(Fixed x, Fixed y) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Point&gt;::iterator i = points.begin(); i != points.end(); ++i) { Fixed newX = i-&gt;x + (fixrand() - Fixed(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>)) * width * Fixed(<span class="hljs-number"><span class="hljs-number">0.25f</span></span>); Fixed newY = i-&gt;y + (fixrand() - Fixed(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>)) * width * Fixed(<span class="hljs-number"><span class="hljs-number">0.25f</span></span>); Fixed d = newX * newX + newY * newY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d &gt; width * width * Fixed(<span class="hljs-number"><span class="hljs-number">0.25f</span></span>)) { newX = i-&gt;first; newY = i-&gt;second; } graphics-&gt;DrawLine(previousFingerPosition.x + i-&gt;x, previousFingerPosition.y + i-&gt;y, x + newX, y + newY, width * Fixed(<span class="hljs-number"><span class="hljs-number">0.0625f</span></span>), color); i-&gt;x = newX; i-&gt;y = newY; } previousFingerPosition = Point(x, y); }</code> </pre> <br><br>  In the loop, all points in the cloud are traversed.  For each point, a small random offset from its current position is calculated.  If the point has shifted too far from the point of touch of the screen (more than half the thickness of the brush), then it remains in its old place.  Then a separate ‚Äújet‚Äù is drawn on the screen, and the thickness of the individual ‚Äújet‚Äù depends on the thickness of the brush as a whole.  At the end of the cycle, the offset point is written back to points.  This allows you to get wavy thin lines in the composition of a thicker brush. <br><br>  In such a simple way you can make a brush, which in skillful hands can become a useful tool for drawing: <br><br><img src="http://habrastorage.org/storage1/a021ae17/771dfb42/ff8b1947/3e27557e.jpg"><br><br><h4>  Product launch </h4><br>  So, about a month after reading the article on Habr√©, the Magic Brush was completely ready.  While still working on the program, I thought about how I would sell it, and realized that marketing takes a tremendous amount of time.  In parallel with the development, I studied various materials about the promotion of applications in the Store'ah and once in the process of googling I came across an article by Dmitry Tarasov <a href="http://dtarasov.ru/symbian_apps_as_a_business_rus.pdf">‚ÄúMobile software as a business‚Äù</a> .  This was the beginning of our cooperation and a new, no less interesting, stage of development of Magic Brush - marketing magic.  But about this in the next part of our story. <br><br>  And finally - a link to the drawings made in MagicBrush: <a href="http://vk.com/album-19391365_127709331">http://vk.com/album-19391365_127709331</a> . </div><p>Source: <a href="https://habr.com/ru/post/126820/">https://habr.com/ru/post/126820/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126814/index.html">Development on a laptop. Laptop monitor size you program at home</a></li>
<li><a href="../126815/index.html">Duck that's where Steve Jobs takes iPhones</a></li>
<li><a href="../126816/index.html">Digest Wanted.VC # 11</a></li>
<li><a href="../126817/index.html">Russian Paypal accounts will be able to accept money</a></li>
<li><a href="../126818/index.html">Late optimization</a></li>
<li><a href="../126821/index.html">Samsung Smart TV: network services, Internet surfing, media player and IPTV - in one TV!</a></li>
<li><a href="../126822/index.html">Something about mailbox naming conventions</a></li>
<li><a href="../126824/index.html">How often do you use mobile internet?</a></li>
<li><a href="../126825/index.html">The results of the competition for habravchan children</a></li>
<li><a href="../126826/index.html">Ciklum Supports International Chrome Hackathon & Contest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>