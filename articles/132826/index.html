<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simultaneous cross-site authentication without a bike</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Simultaneous cross-site authentication (SSO), what is it for? Suppose we have, let's call it an anachronistic term ‚Äúportal‚Äù, with blogs, photos, feils...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simultaneous cross-site authentication without a bike</h1><div class="post__text post__text-html js-mediator-article">  Simultaneous cross-site authentication (SSO), what is it for?  Suppose we have, let's call it an anachronistic term ‚Äúportal‚Äù, with blogs, photos, feils (or files, to whom how), call it fail.ru (not to be confused with the e-mail service with the letter M), and all this is complicated by the following factors : <br>  - the functionality is completely different; <br>  - the code is written by different people, using different technologies; <br>  - all this works on different servers in different data centers and with different databases; <br>  - servers are on different domains. <br><br>  And at such Koshchei we will need to break an egg and give the user the opportunity to log in only once, and then go to all friendly resources without confirming their identity again. <br><br>  This <a href="http://habrahabr.ru/tag/sso/">has</a> already been written a lot, and the code as well.  But we will not go on the beaten track of the bicycle industry, but as real engineers we will take ready-made developments and use them.  The method is simple, and is suitable even for such a difficult situation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, we will look at self-written alternatives, OpenID, OAuth, SAML, and why all this is not a generally good solution, storage of authentication data, and some security issues that you shouldn‚Äôt use without good knowledge, what is cross-site authentication in general, dispel some myths. <a name="habracut"></a><br><br><h4>  Successful solutions for less universal cases </h4><br>  In real life, everything is not so triggered, as in the case that we are considering, and sometimes it seems that you can get away with making <a href="http://habrahabr.ru/qa/12046/">a common cookie</a> , but as soon as the external domain appears, or the common database for storing sessions disappears, the solution disappears. <br><br>  You can use the option described <a href="http://habrahabr.ru/blogs/webdev/80900/">here</a> , but in the comments there is quite a lot of negative about iframe, javascript, and other things. <br><br><h4>  Openid </h4><br>  In the network there is a <a href="http://www.quora.com/OpenID/What-s-wrong-with-OpenID">very interesting note</a> about the fact that OpenID solves the problem, which he himself invented.  OpenID is not a necessary layer between the mail and the site on which you want to authenticate.  For example, you have an account on coolopenid.net, which is tied to your mail.  When you enter the target site, you will be sent to coolopenid.net, they will either look at the cookie, if you are already logged in, or ask for an email and password, confirm your identity, and then enter the target site, such as, for example, foo1@coolopenid.net.  True, not much easier than confirming via a link to an email? <br><br>  For cross-site authentication, OpenID is not very convenient with a large number of friendly sites, since the user will have to verify his identity when entering each site. <br><br><h4>  Oauth </h4><br>  OAuth performs a dual task, authentication on a third-party site and authorization on the provider site, giving the user the opportunity to use the capabilities of a third-party resource to expand the capabilities of the provider site, for example, upload links to photos on Twitter, add information about your current location to Facebook.  A good explanation of the difference is <a href="http://stackoverflow.com/questions/2033026/sso-with-cas-or-oauth">here</a> .  This is a wonderful and useful thing, but it is designed to combine the sites of different providers, while we still have a common central repository of user names. <br><br><h4>  Saml </h4><br>  A bit of criticism would not hurt, but I can only indirectly indicate the not very successful experience of my colleagues in implementing this solution into the infrastructure of a huge company with a huge number of internal and external projects.  In addition, the number of libraries implementing this protocol for various programming languages ‚Äã‚Äãis not large at all. <br><br><h4>  CAS </h4><br>  The reader probably already realized that I am leaning towards one thing, trying to convince him of the unambiguity of the right choice.  Yes and no.  I wanted to describe my throwing, my choice and my practice.  There is no definite choice, although for my needs and with my background of knowledge, CAS is the simplest and most comprehensive solution. <br><br>  CAS is a protocol specifically designed for simultaneous intersite authentication.  The protocol has at least <a href="http://www.jasig.org/cas">two</a> <a href="https://github.com/rubycas/rubycas-server">implementations</a> , at least <a href="https://github.com/rubycas/rubycas-server">one</a> of which is actively developing.  The choice in favor of the second can be bolstered by the fact that there is no need for the server to drag after itself frightening many Java dependencies (to the detriment of having to drag at itself frightening many Ruby dependencies). <br><br>  Also from the pros, it can be noted that CAS can work even <a href="http://groups.google.com/group/rubycas-server/browse_thread/thread/d04731de27e5824c">with fat clients</a> , and does not even require the ability to install cookies with a client agent.  There are a sufficient number of clients for different platforms for easy integration of user authentication through CAS. <br><br>  CAS does not do much.  He does not store data about users, he does not store their roles, and does not know anything about other participants.  As a user repository you can use: <br>  - database <br>  - LDAP / AD <br>  - SPNEGO <br>  - RADIUS <br>  - third-party service <br>  - ... yes even a text file <br><br>  It can be used with both two-factor authentication and usb-tokens using X.509 certificates. <br><br><h5>  Crete and Myths </h5><br><blockquote>  CAS is an old project, it does not develop.  The current server version is 3.4.8, the latest revision of the protocol is 2005. </blockquote><br>  Last updated - <a href="https://github.com/gunark/rubycas-server">November 9th of this year</a> . <br>  Apparently, the protocol fully implements the functionality necessary for the needs of SSO, and further development is not required, as, for example, the HTTP protocol has not been updated since June 1999. <br><br><blockquote>  CAS is an <a href="http://www.jasig.org/cas/deployments">unpopular project</a> .  Despite the fact that he is more than one year old, he never received recognition - almost none.  The fact that they use 120 schools, colleges and universities AND NO MORE does anyone say that no one else can use it. </blockquote><br>  It‚Äôs not a fact that all who use this one of the implementations are shown here. <br><br><blockquote>  CAS is developed by one firm for its specific task.  Programmers who wrote CAS are committed to making <a href="http://www.jasig.org/uportal">their own educational portal</a> . </blockquote><br>  I suppose that these people are not such patrons of the arts to make software for someone else‚Äôs common task.  And once done, it‚Äôs not a pity to give in to the general access. <br><br><blockquote>  CAS is a private development that has no real success stories anywhere except in a very narrow field of application (universities, student control) and nowhere except for someone else‚Äôs solution (uPortal). </blockquote><br>  The same can be said about the other solutions mentioned in the topic under discussion.  Although, perhaps, I do not know something. <br><br><blockquote>  Amazingly small community.  If we look at the network for a typical common property error, we will find <a href="http://www.google.ru/search%3Fq%3DCAS%2Bis%2BUnavailable">only</a> 100 reviews. </blockquote><br>  Looking for the right.  About 3,210,000 results (0.21 seconds).  If you put in quotes, that is, look for an exact match - 7.5 thousand. <br><br><blockquote>  A surprisingly small number of implementations.  Actually, there are ONLY TWO CAS server implementations.  And how many COTS implementations of OpenID providers are written? </blockquote><br>  OpenID is not an alternative, as described above.  The number of implementations does not speak about the simplicity of integration. <br><br><h5>  Principle of operation </h5><br>  First entry. <br>  1. A user visits a page that only authorized users have access to. <br>  2. Website makes HTTP redirect to CAS server. <br>  3. The user enters the username and password. <br>  4. CAS through the correct adapter determines the correct login and password. <br>  5. In case of successful authentication, the CAS server redirects the user to the page indicated by the site as a successful login page, attaching a service check ticket in the request. <br>  6. The site makes an internal cross-site HTTP request to the CAS server to verify the ticket. <br>  7. The user is authorized, you can associate his session cookie with the login received from the CAS server. <br><br>  Re-entry (for example, on site 2). <br>  1. A user visits a page that only authorized users have access to. <br>  2. Website makes HTTP redirect to CAS server. <br>  3. The CAS server sees the user's cookies and redirects the user to the page indicated by the site as a successful login page, attaching a service check ticket to the request. <br>  4. The site makes an internal cross-site HTTP request to the CAS server to verify the ticket. <br>  5. The user is authorized, you can associate his session cookie with the login received from the CAS server. <br><br>  This method closes a sufficient number of security holes. <br><br><h5>  Installation </h5><br>  1. Ruby version manager <br>  bash &lt;&lt;(curl -s <a href="https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer">raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer</a> ) <br>  echo '[[-s "$ HOME / .rvm / scripts / rvm"]] &amp;&amp;.  "$ HOME / .rvm / scripts / rvm" # Load RVM function '&gt;&gt; ~ / .bash_profile <br><br>  2. Ruby <br>  rvm install 1.9.2 <br>  rvm use --default 1.9.2 <br>  gem install bundler <br><br>  3. rubycas-server <br>  git clone git@github.com: <b>rubycas</b> / <b>rubycas-</b> server.git <br>  cd rubycas-server <br>  bundle install <br><br>  4. Install thin (web server) and start <br>  gem install thin <br>  thin start <br>  This is the easiest, but not the best option.  It is worth considering running under unicorn and nginx. <br><br><h5>  Client use </h5><br>  For example Ruby / Rack / Sinatra applications: <br><br>  Gemfile: <br>  ... <br>  gem 'oa-enterprise',: require =&gt; 'omniauth / enterprise' <br>  ... <br><br>  Application: <br>  ... <br>  set: login_page, "/ auth / cas" <br><br>  use OmniAuth :: Strategies :: CAS,: cas_server =&gt; 'https://ruby-cas.mydomain.com' <br><br>  get '/ auth / cas / callback' do <br>  auth = request.env ["omniauth.auth"] <br>  account = Account.first (: email =&gt; auth ["uid"]) ||  Account.first (: email =&gt; auth ["uid"],: role =&gt;: external) <br>  set_current_account (account) <br>  redirect '/' <br>  end <br>  ... </div><p>Source: <a href="https://habr.com/ru/post/132826/">https://habr.com/ru/post/132826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132818/index.html">Home Virtualization or Atom Virtualization</a></li>
<li><a href="../132819/index.html">Ubuntu 11.10 build from NNLUG</a></li>
<li><a href="../132821/index.html">Mobile version of 2GIS appeared in the OVI Store</a></li>
<li><a href="../132822/index.html">Deploying Kaviza VDI-in-a-Box</a></li>
<li><a href="../132823/index.html">PROhq for legal freelance: each freelancer can apply for IE for free</a></li>
<li><a href="../132828/index.html">Plugin Detector - jQuery plugin catalog and rating</a></li>
<li><a href="../132830/index.html">Bicyclist robot</a></li>
<li><a href="../132832/index.html">‚ÄúDouble‚Äù StartUp or how the customer became a performer</a></li>
<li><a href="../132834/index.html">Asynchronous UI: the future of web interfaces</a></li>
<li><a href="../132835/index.html">TechCrunch Moscow 2011</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>