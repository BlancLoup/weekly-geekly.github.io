<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why I love so much EF, or features that are hard to give up</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We recently published an article based on a visit to the DEVIntersection conference. We bring to your attention another useful "squeeze" dedicated to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why I love so much EF, or features that are hard to give up</h1><div class="post__text post__text-html js-mediator-article">  We recently published <a href="http://habrahabr.ru/company/nixsolutions/blog/273753/">an article</a> based on a visit to the <a href="https://www.devintersection.com/">DEVIntersection</a> conference.  We bring to your attention another useful "squeeze" dedicated to the Entity Framework (EF). <br><a name="habracut"></a><br>  ORM frameworks have long become familiar tools for us to interact with the database.  In particular, if you are developing applications on the .NET platform, you will most likely use the Entity Framework, and no one is surprised.  But, despite the popularity of EF and the abundance of information about it, quite often there is an incorrect understanding of what it is, why it is necessary and how to use it.  In this article we will look at the most important, subjective, features in the Entity Framework 6.1.x.  It should be immediately emphasized that EF will not solve all the problems of interaction with the database, but it will still help get rid of many. <br><br><h3>  Database Migrations and Initialization </h3><br>  EF allows you to generate classes of migrations, based on the entities in the context, which, in turn, implement the methods <code>Up()</code> and <code>Down()</code> .  This allows you to move up and down the chain of migrations, thereby controlling the version of the database.  The <code>Seed(DbContext)</code> method allows you to add the necessary data to initialize the database.  This is a great way to quickly make changes to the database, respond to new requirements or solve problems. <br><br>  We also have the ability to migrate stored procedures by adding them to migration classes using the <code>AlterStoredProcedure</code> method.  Many C # developers would gladly refuse to keep them, because maintaining them is a little more difficult.  But you cannot get away from them, because if all operations are implemented in code, after what time the application will start to work very slowly, and requests to the database will be performed slowly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <code>Lazy loading</code> automatically loads automatic entities or collections that are associated directly with the entity for which a query is being made to the database.  This approach has drawbacks related to the fact that we literally pull out everything related to the records we need, while EF will put them in context and track changes to these records.  To put it mildly, this can cause a number of problems and inconveniences. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Category</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ICollection&lt;Product&gt; Products { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  <code>Eager loading</code> - allows you to load the necessary entities as part of the request using the <code>Include</code> method. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> categories = context.Categories .Include(p =&gt; p.Products).ToList();</code> </pre><br>  <code>Explicit Loading</code> is a way to explicitly pull up the necessary entities if Lazy Loading has been disabled. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> category = context.categories.Find(<span class="hljs-number"><span class="hljs-number">1</span></span>); context.Entry(category).Collection(p =&gt; p.Products).Load();</code> </pre><br> <code>System.ComponentModel.DataAnnotations (DataAnnotation) <br></code>  - a way to customize the model so that both EF and ASP.NET MVC understand the configuration rules.  <code>DataAnnotation</code> allows you to specify validation rules or simply describe primary and foreign keys using attributes ( <code>[Key], [RoreignKey], [Index], [StringLength], [Required], [NotMapped]</code> and others). <br><br> <code>System.Data.Entity.ModelConfiguration.Conventions (Code firs conventions) <br></code>  - a series of rules that apply to the model and describe it using the C # classes.  You can specify navigation properties, primary and foreign keys, complex types. <br><br><h3>  Co-editing </h3><br>  There are cases when several users edit the same entry.  Suppose one just got a record for editing, and the other saved the changes.  After the first one has decided to save his changes, we will overwrite already changed records, which may lead to the loss of important data.  Often, nothing terrible happens if you just apply the latest changes. <br><br>  Of course, there are several ways to solve the problem of simultaneously editing data.  Let's look at Pessimistic and Optimistic concurrency. <br><br>  Pessimistic Concurrency is one of the ways to prevent data loss, which involves blocking entities.  If someone already edits the entity, then we will not let other users edit it, so we don‚Äôt need to think about which records to keep.  This approach can cause a number of problems and slow down the application, so it is supported by few DBMSs.  EF also does not support pessimistic concurrency. <br><br>  An alternative to this method can be considered Optimistic Concurrency.  With this approach, conflict situations are allowed and handled, and here EF can already help.  A conflict can be handled by responding to an <code>OptimisticConcurrencyException</code> thrown by the Entity Framework, but first you need to teach EF to understand when a conflict has occurred.  To do this, you need to add a property with the help of which you could monitor the versions (usually <code>rowversion</code> ), and then indicate that this is a <code>ConcurencyToken</code> .  This can be done through the <code>IsConcurrencyToken</code> method, indicating which property should be monitored. <br><br><h3>  Logging </h3><br>  Starting with EF 6, it became possible to intercept commands sent to the database.  Thus, you can implement logging, change or cancel the execution of commands.  You can assign a delegate to the DbContext.Database.Log <code>DbContext.Database.Log</code> , which accepts a string as a parameter.  It will process this line, for example, it will simply save logs to a file or output it to the console.  In essence, logging is just interception of commands, and if you need to implement your own logic, then you need an <code>IDbCommandInterceptor</code> implementation with which you can subscribe to events and do the necessary operations with the database context. <br><br><h3>  Connection resilency </h3><br>  If, for some reason, the Internet has fallen off, but EF fulfills the request or saves the changes, now it is possible to repeat it again.  This is a very useful feature if, for example, the database is hosted on Azure and problems may arise with the Internet.  You can customize using <code>IDbConnectionStrategy</code> . <br><br>  * * * <br><br>  Of course, this is not all the features that EF provides us.  At first glance, one might get the impression that they are not so important.  However, it seems to us that these features will be useful in any project and will give the necessary flexibility and functionality in the application development process. </div><p>Source: <a href="https://habr.com/ru/post/273755/">https://habr.com/ru/post/273755/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273745/index.html">History of the 5th place in the Russian AI Cup 2015</a></li>
<li><a href="../273747/index.html">IBM is working on a project to create an open-source blockchain for business representatives.</a></li>
<li><a href="../273749/index.html">Weather Station on Arduino with data visualization</a></li>
<li><a href="../273751/index.html">bala.js - jQuery killer in less than 400 characters of code *</a></li>
<li><a href="../273753/index.html">ASP.NET 5 Identity 3 and new authentication / authorization toolkit</a></li>
<li><a href="../273757/index.html">Veeam Backup: nice little tricks</a></li>
<li><a href="../273759/index.html">Budget homemade TCP "on the knees" (mobile television station). Part 1</a></li>
<li><a href="../273765/index.html">As I wrote and published a book based on my posts with Habr</a></li>
<li><a href="../273771/index.html">Parallel calculations on CPU and GPU</a></li>
<li><a href="../273773/index.html">3D-lab for people from MIEM, sling their heads inside the prototype trace of printed circuit boards</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>