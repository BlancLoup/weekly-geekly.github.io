<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Snap is a new reporting platform. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a previous article, I made a preliminary review of Snap, our reporting product designed to make it easier for you and your users to create business...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Snap is a new reporting platform. Part 2</h1><div class="post__text post__text-html js-mediator-article">  In a <a href="http://habrahabr.ru/company/devexpress/blog/227691/">previous article,</a> I made a preliminary review of Snap, our <a href="https://www.devexpress.com/Products/NET/Controls/WinForms/Snap/">reporting product</a> designed to make it easier for you and your users to create business documentation. <br><br>  Today we will look at how to make a finished report entirely from code.  In the process of creating the application, we will take a closer look at some of the principles of how Snap works and will talk in more detail about its internal structure and the mechanisms that we have implemented in it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1b/be5/ea0/e1bbe5ea0c4111bc30bd9102dfe8dae1.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, under the cut you will find the promised entertaining mechanics. <br><a name="habracut"></a><br><br><h4>  Application Preparation <br></h4><br>  To begin with, we will create a new Windows Forms application in Visual Studio and drag SnapControl from the <b>DX14.1: Reporting</b> tab to the main form, which will be added to the toolbox after installing Snap. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/be8/09c/bab/be809cbaba9199ab3755ee17d374f875.png"><br><br>  Now add the menu using the corresponding items in the list that appears when you click on the smart tag of the control. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ae/d43/ba1/0aed43ba1786a958ed3c80eb57cbf9d8.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3cf/04f/172/3cf04f17207f0d484dab8625905e78d2.png"><br><br>  Everything, the skeleton is ready, now we will build up muscles. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae4/365/6fe/ae43656fec47955f4ffc986cb50a6c41.png"><br><br><h4>  Data binding <br></h4><br>  As I mentioned earlier, it makes sense to start work by providing access to the data.  Snap supports multiple data source assignment scripts.  The most obvious is the use of the user interface.  Data sources added through the UI are assigned to a specific document, but they can also be saved for other reports.  The user can independently configure the connection using the wizard, which can be invoked by selecting the Add New Data Source command on the File tab: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/978/e97/fa4/978e97fa4614ebda70bfed189524b2ad.png"><br><br>  Or, you can select the Add Data Source item in the context menu opened by right-clicking an empty space in the Data Explorer: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d2/c21/105/0d2c211053d5c7ccffb6282aecfe13a7.png"><br><br>  The Data Source Preparation Wizard maintains an impressive list of possible suppliers: <br><br><ul><li>  Microsoft SQL Server </li><li>  Microsoft Access 97 </li><li>  Microsoft Access 2007 </li><li>  Oracle </li><li>  Xml file </li><li>  SAP Sybase Advantage </li><li>  SAP Sybase ASE </li><li>  IBM DB2 </li><li>  Firebird </li><li>  Mysql </li><li>  Pervasive psql </li><li>  PostgreSQL </li><li>  Visddb </li><li>  Microsoft SQL Server CE </li><li>  Sqlite </li></ul><br>  But do not forget that, depending on the selected provider, you may need to configure various connection parameters - identification type, database name, etc.  Since for the average user all this seems to be very esoteric knowledge, it makes sense to set up a turnkey system. <br><br>  It should be borne in mind that Snap separates the data sources of the level of a specific report and more global data of the application level that is available for any document opened in it.  Application-level data is set through the SnapControl - DataSource properties for the main default data source, and DataSources is a collection of named data sources.  As a data source, standard .Net providers, lists and XML files can be used. <br><br><pre><code class="hljs pgsql">snapControl1.DataSource = dataSet1; snapControl1.DataSources.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DataSourceInfo("NWindDataSource2", dataSet2));</code> </pre> <br>  Now when you start the application, Data Explorer will display the available data sources. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c8/0ef/03b/7c80ef03b3617e1c3393b29f14ce5149.png"><br><br>  To set data sources for a specific report, use the same pair of document properties. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">snapControl1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Document</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.BeginUpdateDataSource</span></span>(); <span class="hljs-selector-tag"><span class="hljs-selector-tag">this</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.snapControl1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Document</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.DataSources</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Add</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DataSourceInfo</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">Cars</span></span>", <span class="hljs-selector-tag"><span class="hljs-selector-tag">e1List</span></span>)); <span class="hljs-selector-tag"><span class="hljs-selector-tag">this</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.snapControl1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Document</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.DataSources</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Add</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DataSourceInfo</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">Company</span></span>", <span class="hljs-selector-tag"><span class="hljs-selector-tag">e2List</span></span>)); <span class="hljs-selector-tag"><span class="hljs-selector-tag">snapControl1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Document</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.EndUpdateDataSource</span></span>();</code> </pre><br>  If for some reason the connection to the data source failed, the SnapDocument.ConnectionError event will be raised.  Its processing allows you to override the standard behavior, which consists in invoking the connection wizard to re-request parameters. <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> Document_ConnectionError(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, DevExpress.DataAccess.ConnectionErrorEventArgs e) { Access2007ConnectionParameters parameters = (Access2007ConnectionParameters)e.ConnectionParameters; string <span class="hljs-type"><span class="hljs-type">path</span></span> = "C:\\Public\\Documents\\DevExpress Demos 14.1\\Components\\Data\\nwind.mdb"; parameters.FileName = <span class="hljs-type"><span class="hljs-type">path</span></span>; parameters.<span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> = "masterkey"; }</code> </pre><br><h4>  API <br></h4><br>  Now you can proceed directly to creating a report.  Like many of his other abilities, Snap has inherited the mechanism for adding dynamic content from the Rich Text Editor.  Snap uses fields as a template that is filled with real data.  In most cases, it is easier to allow Snap to add fields automatically.  If you know the field code, you can enter it in the right place of the document yourself.  Just press the Ctrl + F9 keys and enter the code between the curly braces.  And you can use the API and completely create the document programmatically. <br><br>  The main field used to combine the various markup elements into a single model, on the basis of which the data-filled part of the document will be created, is SnapList.  SnapList has a hierarchical structure and is divided into several parts, each of which is used to define different list items: a header, a template for each line and a footer.  These parts can contain nested fields, forming a tree structure that provides the ability to create complex master-detail reports.  Using the following code, you can add SnapList to a document and customize it by defining a list header and a sample for each entry: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> GenerateLayout(SnapDocument doc) { // SnapList   SnapList list = doc.CreateSnList(doc.Range.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "List"); list.BeginUpdate(); //   list.EditorRowLimit = <span class="hljs-number"><span class="hljs-number">11</span></span>; list.DataSourceName = "NWindDataSource2"; list.DataMember = "Products"; //   SnapDocument listHeader = list.ListHeader; <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> listHeaderTable = listHeader.InsertTable(listHeader.Range.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); TableCellCollection listHeaderCells = listHeaderTable.FirstRow.Cells; listHeader.InsertText(listHeaderCells[<span class="hljs-number"><span class="hljs-number">0</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "Product Name"); listHeader.InsertText(listHeaderCells[<span class="hljs-number"><span class="hljs-number">1</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "Units in Stock"); listHeader.InsertText(listHeaderCells[<span class="hljs-number"><span class="hljs-number">2</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "Unit Price"); //     SnapDocument listRow = list.RowTemplate; <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> listRowTable = listRow.InsertTable(listRow.Range.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); TableCellCollection listRowCells = listRowTable.FirstRow.Cells; listRow.CreateSnText(listRowCells[<span class="hljs-number"><span class="hljs-number">0</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "ProductName"); listRow.CreateSnText(listRowCells[<span class="hljs-number"><span class="hljs-number">1</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "UnitsInStock"); listRow.CreateSnText(listRowCells[<span class="hljs-number"><span class="hljs-number">2</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, @"UnitPrice \$ $0.00"); list.EndUpdate(); list.Field.<span class="hljs-keyword"><span class="hljs-keyword">Update</span></span>(); }</code> </pre><br>  Now, when we launch our application, we will already receive a report filled with data: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a56/e9c/e68/a56e9ce6859225cb41c417cf72ff0111.png"><br><br>  You can also switch to the view of field codes and see how the resulting SnapList works from the inside: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/463/017/41a/46301741a77035a5a9858adbac86ffb1.png"><br><br>  Not bad, but I would like to customize the appearance of the resulting document.  The code below will give a more professional look to our report: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> FormatListHeader(SnapList list) { SnapDocument <span class="hljs-keyword"><span class="hljs-keyword">header</span></span> = list.ListHeader; <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> headerTable = <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Tables</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]; headerTable.SetPreferredWidth(<span class="hljs-number"><span class="hljs-number">50</span></span> * <span class="hljs-number"><span class="hljs-number">100</span></span>, WidthType.FiftiethsOfPercent); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (TableRow <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> headerTable.<span class="hljs-keyword"><span class="hljs-keyword">Rows</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (TableCell cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>.Cells) { //    cell.Borders.Left.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; cell.Borders.Right.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; cell.Borders.Top.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; cell.Borders.Bottom.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; cell.BackgroundColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.SteelBlue; //    CharacterProperties formatting = <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.BeginUpdateCharacters(cell.ContentRange); formatting.Bold = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; formatting.ForeColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.EndUpdateCharacters(formatting); } } } <span class="hljs-type"><span class="hljs-type">void</span></span> FormatRowTemplate(SnapList list) { //      SnapDocument rowTemplate = list.RowTemplate; <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> rowTable = rowTemplate.<span class="hljs-keyword"><span class="hljs-keyword">Tables</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]; rowTable.SetPreferredWidth(<span class="hljs-number"><span class="hljs-number">50</span></span> * <span class="hljs-number"><span class="hljs-number">100</span></span>, WidthType.FiftiethsOfPercent); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (TableRow <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rowTable.<span class="hljs-keyword"><span class="hljs-keyword">Rows</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (TableCell cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>.Cells) { cell.Borders.Left.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.Transparent; cell.Borders.Right.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.Transparent; cell.Borders.Top.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.Transparent; cell.Borders.Bottom.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.LightGray; } } }</code> </pre><br>  As a result, we get the following picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e29/10f/c1b/e2910fc1b0da31e27e3ae02a37685e07.png"><br><br>  SnapList also provides relevant properties for grouping, sorting and filtering data: <br><br><pre> <code class="hljs pgsql">SnapList.<span class="hljs-keyword"><span class="hljs-keyword">Groups</span></span>; SnapList.Sorting; SnapList.Filters; <span class="hljs-type"><span class="hljs-type">void</span></span> FilterList(SnapList list) { string <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> = "[UnitPrice] &gt;= 19"; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!list.Filters.Contains(<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>)) { list.Filters.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>); } } <span class="hljs-type"><span class="hljs-type">void</span></span> SortList(SnapList list) { list.Sorting.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SnapListGroupParam("UnitPrice", ColumnSortOrder.Descending)); } <span class="hljs-type"><span class="hljs-type">void</span></span> GroupList(SnapList list) { //   SnapListGroupInfo <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> = list.<span class="hljs-keyword"><span class="hljs-keyword">Groups</span></span>.CreateSnapListGroupInfo( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SnapListGroupParam("CategoryID", ColumnSortOrder.Ascending)); list.<span class="hljs-keyword"><span class="hljs-keyword">Groups</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>); //      SnapDocument groupHeader = <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>.CreateHeader(); <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> headerTable = groupHeader.InsertTable(groupHeader.Range.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); headerTable.SetPreferredWidth(<span class="hljs-number"><span class="hljs-number">50</span></span> * <span class="hljs-number"><span class="hljs-number">100</span></span>, WidthType.FiftiethsOfPercent); TableCellCollection groupHeaderCells = headerTable.FirstRow.Cells; groupHeader.InsertText(groupHeaderCells[<span class="hljs-number"><span class="hljs-number">0</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "Category ID: "); groupHeader.CreateSnText(groupHeaderCells[<span class="hljs-number"><span class="hljs-number">0</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "CategoryID"); CustomizeGroupCellsFormatting(groupHeaderCells); //      SnapDocument groupFooter = <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>.CreateFooter(); <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> footerTable = groupFooter.InsertTable(groupFooter.Range.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); footerTable.SetPreferredWidth(<span class="hljs-number"><span class="hljs-number">50</span></span> * <span class="hljs-number"><span class="hljs-number">100</span></span>, WidthType.FiftiethsOfPercent); TableCellCollection groupFooterCells = footerTable.FirstRow.Cells; groupFooter.InsertText(groupFooterCells[<span class="hljs-number"><span class="hljs-number">0</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, "Count = "); groupFooter.CreateSnText(groupFooterCells[<span class="hljs-number"><span class="hljs-number">0</span></span>].ContentRange.<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>, @"CategoryID \sr Group \sf Count"); CustomizeGroupCellsFormatting(groupFooterCells); } <span class="hljs-type"><span class="hljs-type">void</span></span> CustomizeGroupCellsFormatting(TableCellCollection cells) { //    cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].BackgroundColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.LightGray; cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].Borders.Bottom.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].Borders.Left.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].Borders.Right.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].Borders.Top.LineColor = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing.Color.White; }</code> </pre><br>  As a result, we get a full-fledged report created exclusively from code using the public Snap API.  At the same time, the visual tree of all lists in the document, taking into account grouping, will be displayed in a special element intended for navigation through the document - the Report Explorer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79a/46b/df8/79a46bdf8fa79b2d49d7f056fe34a870.png"><br><br>  In addition to plain text, you can use a whole set of special fields to represent data: <br><br><ul><li>  SnapBarCode - displays barcodes of various types; </li><li>  SnapCheckBox - inserts the check-box; </li><li>  SnapHyperlink - designed to insert hyperlinks; </li><li>  SnapImage - adds images to a document; </li><li>  SnapSparkline - sparklines; </li><li>  SnapText - inserts formatted text. </li></ul><br><br><h4>  Event model <br></h4><br>  Virtually any action that changes the structure of the report is accompanied by a corresponding event, which allows you to control the entire process and, if necessary, perform various additional actions. <br><br>  Adding a new list: <br><br>  SnapDocument.BeforeInsertSnList - in the event handler for this event, you can access the columns that will be inserted into the document and, if necessary, edit it, for example, delete some of the elements; <br>  SnapDocument.PrepareSnList - provides access to the structure of the added list, allowing you to add arbitrary text or change it using the API described above (change the templates of the header or data lines, apply sorting, or apply a filter); <br>  SnapDocument.AfterInsertSnList - allows you to make final edits of a dynamically inserted list, indicating the positions to which it will be added <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnBeforeInsertSnList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, BeforeInsertSnListEventArgs e</span></span></span><span class="hljs-function">)</span></span> { e.DataFields = ShowColumnChooserDialog(e.DataFields); } <span class="hljs-function"><span class="hljs-function">List&lt;DataFieldInfo&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowColumnChooserDialog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;DataFieldInfo&gt; dataFields</span></span></span><span class="hljs-function">)</span></span> { ColumnChooserDialog dlg = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColumnChooserDialog(); dlg.SetFieldList(dataFields); dlg.ShowDialog(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dlg.Result; }</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/9c0/721/583/9c0721583124fdc3e4cb89dbe2a1fca4.gif"><br><br>  Adding columns to an existing list: <br><br>  The presence of hot zones allows the user to add new columns to an existing list.  The following events will occur: <br><br>  SnapDocument.BeforeInsertSnListColumns - in the event handler for this event, you can access the columns that will be inserted into the list and, if necessary, change them, for example, reorder or add new ones; <br>  SnapDocument.PrepareSnListColumns - rises for each added column, allowing you to customize the header and main patterns of the list item; <br>  SnapDocument.AfterInsertSnListColumns - occurs after all columns have been added, returning the final list in their arguments.  This event provides the final opportunity to customize the list before generating the document using real data (for example, add grouping or sorting); <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> OnPrepareSnListColumns(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, PrepareSnListColumnsEventArgs e) { e.<span class="hljs-keyword"><span class="hljs-keyword">Header</span></span>.InsertHtmlText(e.<span class="hljs-keyword"><span class="hljs-keyword">Header</span></span>.Range.<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>, "&lt;u&gt;Auto-generated header for column&lt;/u&gt;\r\n"); }</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/0a8/f2c/4a0/0a8f2c4a0f8d64a71a9f176201c6d7e8.gif"><br><br>  Add nested list: <br><br>  If a hierarchical object is used as a data source (for example, a DataSet with several tables and relations defined between them), the user can use hot zones to create master-detail reports.  In this case, the following set of events will be raised: <br><br>  SnapDocument.BeforeInsertSnListDetail - rises immediately after the selected fields have been thrown on the hot zone.  Through the arguments, it provides access both to the master-list, to which detail will be added, and to those fields that will be added.  In the event handler for this event, you can change both the set of fields and their order (for example, you can completely clear this set, so that no changes will occur in the document as a result); <br>  SnapDocument.PrepareSnListDetail - rises after the generation of the nested list has been completed, allowing you to programmatically change it; <br>  SnapDocument.AfterInsertSnListDetail - rises when a nested list has been added; <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> OnAfterInsertSnListDetail(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, AfterInsertSnListDetailEventArgs e) { PaintTable(); snapControl1.Document.Selection = e.Master.Field.Range; } <span class="hljs-type"><span class="hljs-type">void</span></span> PaintTable() { SnapDocument document = snapControl1.Document; TableCollection <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span> = document.<span class="hljs-keyword"><span class="hljs-keyword">Tables</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; document.BeginUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>.Count; k++) { <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> table = <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>[k]; TableCellProcessorDelegate <span class="hljs-keyword"><span class="hljs-keyword">reset</span></span> = ResetCellStyle; <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>.ForEachCell(<span class="hljs-keyword"><span class="hljs-keyword">reset</span></span>); TableCellProcessorDelegate setStyle = SetCellStyle; <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>.ForEachCell(setStyle); } document.EndUpdate(); }</code> </pre><br><img src="http://habrastorage.org/files/bd9/f0e/4c3/bd9f0e4c34a545dd855c84b35d1018bd.gif"><br><br>  If any report creation scenarios are left uncovered or you have any suggestions for improving the product, I invite you to the discussion in the comments.  I will try to answer all your questions. </div><p>Source: <a href="https://habr.com/ru/post/229351/">https://habr.com/ru/post/229351/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229341/index.html">Sony Xperia C3 - a serious approach to selfie</a></li>
<li><a href="../229343/index.html">What is what in ‚ÄúNGFW | NGIPS | UTM ‚Äù</a></li>
<li><a href="../229345/index.html">A review of the new educational kit in electronics from Amperki (Matryoshka Z)</a></li>
<li><a href="../229347/index.html">Mathematica 10 is released, containing 700+ new features and an incredible amount of R & D.</a></li>
<li><a href="../229349/index.html">Detailed photograph of the NSA data center transferred to the public domain.</a></li>
<li><a href="../229355/index.html">We protect the router from the user using dd-wrt</a></li>
<li><a href="../229357/index.html">RosCanSat or ‚Äúsatellite‚Äù in an aluminum can in Russian</a></li>
<li><a href="../229359/index.html">About screen size, pixel and item</a></li>
<li><a href="../229367/index.html">The sad story of the social network "Uberlov"</a></li>
<li><a href="../229369/index.html">Evernote for Android Wear</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>