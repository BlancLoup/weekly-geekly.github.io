<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Type classes in Scala</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, in the community of Scala-developers began to pay more and more attention to the design pattern Type classes . It helps to deal with unneces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Type classes in Scala</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/storage2/c24/f23/cb9/c24f23cb9ca42448dedf716582b90ee2.png"><br>  Recently, in the community of Scala-developers began to pay more and more attention to the design pattern <i>Type classes</i> .  It helps to deal with unnecessary dependencies and at the same time make the code cleaner.  Below with examples, I will show how to apply it and what advantages this approach has. <br><br>  It can be designed not only for Scala programmers, but also for Java - perhaps they will get an answer for themselves, as, at least in theory, the solution looks for many applied tasks, in which the components are not interconnected and are extensible after writing .  It may also be of interest to developers and designers in any other languages. <br><a name="habracut"></a><br><h2>  Prerequisites </h2><br>  Everyone was faced with a task when some class needed to add behavior associated with this class: comparison, serialization, reading from serialized, creating an instance of the class, rendering, this may be another behavior that your very useful library requires. <br><br>  To solve these problems in the Java-world there are several methods: <br><ul><li>  write the interface and implement it in the class itself (for example, Comparable), </li><li>  write a separate interface, a specific instance of which will receive a class object and carry out the necessary actions (for example, the Comparator); </li><li>  for individual tasks there are even special methods: <ul><li>  to create objects - the Factory template, </li><li>  Adapter is used to link to third-party libraries, </li><li>  Reflection is sometimes used for serialization and reading.  This is reminiscent of the autopsy of the abdomen from a <a href="http://habrahabr.ru/post/147148/">recent post</a> , but abdominal surgery is also sometimes needed, I‚Äôll just make a reservation, Type classes will not be able to replace it. </li></ul></li></ul><br>  So, in essence, we now have two alternatives: either rigidly associate third-party functionality with the class or take the functionality into a separate object and then take care of its transfer.  As an example, take the users of the application.  This is how adding the ability to compare our users may look: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,    def sort[T &lt;: Comparable[T]](elements: Seq[T]): Seq[T] //   class Person(val id: Id[Person], val name: String) extends Comparable[Person] { def compareTo(Person anotherPerson): Int = { return this.name.compareTo(anotherPerson.name) } } //  sort(persons)</span></span></code> </pre> <br>  Here it is good that the concrete use of sorting looks very clear.  But the comparison logic is rigidly connected with the class (and probably no one likes that the model objects depend, for example, on the XML library that writes and writes to the database).  In addition, another problem appears: it is impossible to define more than one method of comparison - that is, if tomorrow we want to compare users by id elsewhere in the program, we will fail, rewriting the comparison method for closed classes also fails. <br><br>  Java has a Comparator class for this purpose, it allows you to get more flexibility: <br><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,    def sort[T](elements: Seq[T], comparator: Comparator[T]): Seq[T] //   class Person(val id: Id[Person], val name: String) trait Comparator[T] { def compare(object1: T, object2 T): Int } class PersonNameComparator extends Comparator[Person] { def compare(onePerson: Person, anotherPerson: Person): Int = { return onePerson.name.compareTo(anotherPerson.name) } } //  val nameComparator = new PersonNameComparator() sort(persons, nameComparator)</span></span></code> </pre><br>  Now you can define several comparison methods, the comparison logic is no longer associated with the model class.  Also, nothing prevents you from writing your comparator, even if the class and definition of the sorting algorithm is closed to us.  It is worth noting that the sorting call has become somewhat more difficult. <br><br>  The use of factories and adapters implies a similar lifecycle management and transfer of their instances.  And still it is necessary to remember all these cool titles for, in general, one typical task. <br><br><h2>  And here Type classes appear </h2><br>  This is where the Scala option comes to help implicitly pass parameters.  Let's take as a basis our previous example, but we will define the algorithm differently, we will pass the Comparator implicitly: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sort</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>](elements: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>])(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> comparator: <span class="hljs-type"><span class="hljs-type">Comparator</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>]): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>]</code> </pre><br>  This means that if there is a suitable Comparator in the field of visibility with the desired value of the type parameter, it will be automatically substituted into the compiler method without additional efforts from the programmer.  So, put in the scope of a suitable Comparator: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> personNameComparator = <span class="hljs-type"><span class="hljs-type">Comparator</span></span>[<span class="hljs-type"><span class="hljs-type">Person</span></span>] { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compare</span></span></span></span>(onePerson: <span class="hljs-type"><span class="hljs-type">Person</span></span>, anotherPerson: <span class="hljs-type"><span class="hljs-type">Person</span></span>): <span class="hljs-type"><span class="hljs-type">Int</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> onePerson.name.compareTo(anotherPerson.name) } }</code> </pre><br>  The key word <i>implicit</i> is responsible for the fact that the value will be used in the substitution.  It is important to note that our implicit implementations must be stateless, because in the course of the program, only one instance of each type is created. <br><br>  Now the sorting can be called as well as it was in the original version with the implementation of Comparable: <br><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//   sort(persons)</span></span></code> </pre><br>  And this is despite the fact that the method of comparison itself is in no way connected with the object of the model.  We can put in the field of visibility any comparison methods and they will be used for our objects. <br><br>  A slightly more interesting variant arises when one wants the type parameter to be itself typed.  That is, for <i>Map [Id [Person], List [Permission]],</i> we want <i>MapJsonSerializer</i> , <i>IdJsonSerializer</i> , <i>ListJsonSerializer</i> and <i>PermissionJsonSerializer</i> , which can be reused in any order, not <i>PersonPermissionsMapJsonSerializer</i> , whose analogues we will write each time.  In this case, the method for defining an implicit object is slightly different, now we do not have an object, but a function: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ListComparator</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">V</span></span>](<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> comparator: <span class="hljs-type"><span class="hljs-type">Comparator</span></span>[<span class="hljs-type"><span class="hljs-type">V</span></span>]) = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Comparator</span></span>[<span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">V</span></span>]] { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compare</span></span></span></span>(oneList: <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">V</span></span>], anotherList: <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">V</span></span>]): <span class="hljs-type"><span class="hljs-type">Int</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>((one, another) &lt;- oneList.zip(anotherList)) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> elementsCompared = comparator,compare(one, another) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(elementsCompared &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(elementsCompared &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre><br>  That's the whole method.  The best thing is that you can get all sorts of JSONParser, XMLSerializers together with PersonFactory, without storing the corresponding classes and objects anywhere - the Scala compiler does everything for us. <br><br>  In TKS, we use such a method, for example, to wrap exceptions in the classes of our model.  Type classes allow you to create instances of exceptions of the type in which you want to wrap an abandoned block.  If this were done by the traditional method, we would have to create and transfer a factory of exceptions, so it would have been easier to throw exceptions in the old-fashioned way.  Now everything is beautiful. <br><br><h2>  What's next? </h2><br>  In fact, the Type classes theme does not end here and as a continuation I recommend the video of <a href="http://www.youtube.com/watch%3Fv%3DsVMES4RZF-8">Typeclasses in Scala</a> . <br><br>  Even more fundamentally, the question is set forth in <a href="http://ropas.snu.ac.kr/~bruno/papers/TypeClasses.pdf">this article</a> . </div><p>Source: <a href="https://habr.com/ru/post/147759/">https://habr.com/ru/post/147759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147754/index.html">History of MdlVis, Warcraft III Model Editor</a></li>
<li><a href="../147755/index.html">Decrypted In-App App Store Mechanism</a></li>
<li><a href="../147756/index.html">Implementing a cache with a limit on the number of elements in Python - solutions: simple and more complicated</a></li>
<li><a href="../147757/index.html">Write once, render anywhere - we use one template engine on the client and server</a></li>
<li><a href="../147758/index.html">A set of notes. Performance and protection, from site to system</a></li>
<li><a href="../147761/index.html">US smartphone market (new research)</a></li>
<li><a href="../147762/index.html">The history of computer science in persons</a></li>
<li><a href="../147763/index.html">"Clouds" in enterprises: current trends</a></li>
<li><a href="../147767/index.html">Translation: What I have learned in 30 years of programming</a></li>
<li><a href="../147772/index.html">Debug kits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>