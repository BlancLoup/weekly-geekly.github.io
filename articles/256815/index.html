<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BalanceBall. Self-balancing platform from A to Z</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am a student of the Physical Engineering Institute, the Faculty of Radio Engineering and Cybernetics, and as it should be for all the second-year st...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BalanceBall. Self-balancing platform from A to Z</h1><div class="post__text post__text-html js-mediator-article">  I am a student of the Physical Engineering Institute, the Faculty of Radio Engineering and Cybernetics, and as it should be for all the second-year students, in the spring semester it is necessary to do a project in computer science and microcontrollers.  I decided to kill two birds with one stone and combined the two projects into one. <br><br>  Long chose the theme of the project.  From ideas there was a game similar to Guitar Hero, but the controller was your hands tapping the drum bits on the table.  I also thought about creating an LED matrix that is controlled via Bluetooth from a computer with its own simple scripting language for writing animations.  The ideas were interesting, but I still seemed something wrong.  Then I accidentally stumbled upon <a href="https://www.youtube.com/watch%3Fv%3Dj4OmVLc_oDw">this video</a> and immediately set about trying to implement something like that.  This is what I ended up with: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/p65XPP53rLo%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhis3lMms2oPjlH4XNShFjaaMgQJkg" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Who is interested in the process of creating this platform from designing details to writing computer vision, please under cat. <br><a name="habracut"></a><br><h4>  Schematic diagram </h4><br>  For several days I thought about what components this device should consist of and how they should interact with each other.  In the end, came to this scheme: <br><br>  1. The webcam transmits the image to the laptop <br>  2. The ball coordinates are determined from the image. <br>  3. The coordinates are fed to the input of the PID regulators (2 independent regulators in X and Y), and the regulators count the angles that the servos must turn <br>  4. Corners are transmitted to the Arduino and set on servo drives. <br><br>  You can portray it like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02a/6e8/8ed/02a6e88edf6f1e759a4220183d62a07c.jpg" alt="image"><br><br><h4>  Designing the mechanics of the platform </h4><br>  The first thing to decide is how the platform will look and move.  On Youtube you can find a lot of videos with the implementation of this platform.  After reviewing everything and reading a couple of publications on this topic, I decided that the platform would be fixed on the ball bearing, and would be tilted with the help of 2 servo drives mounted on a plate on which the whole structure would hold.  At the very beginning of the video, the implementation of the platform mechanics is visible. <br><br>  Servos decided to take stronger, to be sure that they can tilt the platform.  Stopped on the TOWER PRO MG996R, with a moment of 9.4 kg / cm. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d9/987/753/1d9987753b2970d7caff2c40615afdd4.jpg" alt="image"><br><br>  It was decided to cut out the platform, some fastenings from org glass on a laser cutter (good at our institute).  Designed everything in SolidWorks.  From the bottom, it was decided to attach a crosspiece to the platform, in order to attach both the ball bearing and corner brackets to it.  Here are some photos of the creation process: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c4/bde/764/1c4bde764175c5fb671214149d1dc486.jpg" alt="Paltform"><br><img src="https://habrastorage.org/getpro/habr/post_images/9f2/ca8/bfb/9f2ca8bfb5914b39abd8862b27a640a3.jpg" alt="Fixer"><br><br>  Began to look for ball bearings.  Finding the right one was quite difficult, and, moreover, they were expensive.  I suggested that instead of a ball, you can use a kardanchik, as on the keys.  Bought kardanchik, a large bolt (it keeps everything) and nuts.  By kardanchiku welded nut.  Here's what happened: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c01/046/49a/c0104649af94157da664983c3f0c48e3.jpg" alt="Cardan"><br><br><h4>  Platform assembly </h4><br>  I fixed everything on the bolts.  Firstly, because if something is suddenly wrong, you can quickly unscrew the nuts and correct the error.  Secondly, the design eventually turned out to be rather cumbersome, but since it is bolted, it is very easy to disassemble and compactly fit, for example, in a closet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cff/0df/163/cff0df163921b04eeaee67cd4a90a697.jpg" alt="image"><br><br>  From plywood cut a square platform, which was all fastened.  This is how the platform looked assembled: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/649/8ac/a58/6498aca585b35439c9522762f86541ae.jpg" alt="image"><br><br>  Mounts for the camera decided to do later, in order to know exactly the height at which it should be raised. <br><br>  The question arose: at what distance should servo drives be fixed from the center in order to achieve maximum deflection angles.  The task was purely geometric, and after sitting with a pencil and paper for some time, it turned out to find this distance.  Servos secured on plywood, pressing them to the plywood with a metal plate and bolts. <br><br><h4>  First experience </h4><br>  After complete assembly wrote a simple sketch for the Arduino, which tilted the platform at some angles. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/qNIasAQ-Qa8%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhI81S8Qka3-PbPWbDc_kVkCwVZzQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Everything seemed to work, and it was hard to believe it. <br><br>  Having played a little with the device, determined the angles when the platform is parallel to the floor, determined the maximum and minimum angles (¬± 13 degrees).  It's time to write the code. <br><br><h4>  Code writing </h4><br>  After long thinking about the structure of the program, I divided it into 4 modules: <br><br>  1. Computer vision <br>  2. Implementing a PID Regulator <br>  3. Communication with Arduino on the serial port <br>  4. Sketch for Arduino <br><br>  I wrote everything in C ++.  All code can be viewed in <a href="https://github.com/karfly/balanceball">this repository</a> . <br><br><h4>  Computer vision </h4><br>  Used OpenCV.  Detection of the object decided to do in color.  <a href="http://opencv-srf.blogspot.ru/2010/09/object-detection-using-color-seperation.html">This article</a> helped me a <a href="http://opencv-srf.blogspot.ru/2010/09/object-detection-using-color-seperation.html">lot</a> .  The object detection algorithm can be decomposed into several steps: <br><br>  1. Getting the frame from the camera <br>  2. Conversion from RGB to HSV <br>  3. Passing through a mask of a certain color (in my case, white) <br>  4. The calculation of the moments of the image <br>  5. Calculation of ball coordinates by moments <br><br><h4>  Implementation of the PID controller </h4><br>  After reading on <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%2598%25D0%2594-%25D1%2580%25D0%25B5%25D0%25B3%25D1%2583%25D0%25BB%25D1%258F%25D1%2582%25D0%25BE%25D1%2580">Wikipedia</a> about PID regulators and looking at several ready-made implementations on github, I had no difficulty in implementing it in C ++.  On Habr√©, I saw a lot of articles about PID-regulators, so I will not dwell on it. <br><br><h4>  Communication with the Arduino on the serial port </h4><br>  I wrote all the code and ran it on OSX, so there were no problems with communication on the serial port.  I sent the angles to the Arduino in the form of the line "[ANGLE_X]: [ANGLE_Y] $", where ANGLE_X and ANGLE_Y were respectively responsible for the tilt on its axis and varied from -100 to 100 (angles in percent).  To send this line, I just wrote to a file like "/ dev/tty.usbmodem1421". <br><br><h4>  Sketch for Arduino </h4><br>  The wiring diagram looked like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/19e/28a/01d/19e28a01d2d2527b895ffb07f93cbdc6.png" alt="image"><br><br>  Arduino received a line on the serial port, parsed it and then put the right angles on the servos. <br><br><h4>  Conclusion </h4><br>  I spent about 2 months to create BalanceBall.  The most difficult was the implementation of mechanics.  PID set up experimentally.  The plans include the creation of a mathematical model of the platform and the theoretical calculation of the coefficients of PID controllers. <br><br>  Thank you all for your attention! <br><br><h4>  Links </h4><br>  Project repository: <a href="https://github.com/karfly/balanceball">github.com/karfly/balanceball</a> <br>  Folder with materials: <a href="http://goo.gl/bmkexm">goo.gl/bmkexm</a> <br><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%2598%25D0%2594-%25D1%2580%25D0%25B5%25D0%25B3%25D1%2583%25D0%25BB%25D1%258F%25D1%2582%25D0%25BE%25D1%2580">PID controller</a> <br>  <a href="http://robot-develop.org/archives/2833">Discrete PID Controller</a> <br>  <a href="http://opencv-srf.blogspot.ru/2010/09/object-detection-using-color-seperation.html">Color Detection &amp; Object Tracking</a> </div><p>Source: <a href="https://habr.com/ru/post/256815/">https://habr.com/ru/post/256815/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256803/index.html">IO Ninja is a programmable terminal emulator / sniffer (part 3). We write "answering machine"</a></li>
<li><a href="../256805/index.html">HP StormRunner Load. A practical guide. Part II</a></li>
<li><a href="../256809/index.html">HP Blade Workshop Video</a></li>
<li><a href="../256811/index.html">Dino Esposito will perform in St. Petersburg</a></li>
<li><a href="../256813/index.html">Vivaldi TP3 - we do the browser together</a></li>
<li><a href="../256817/index.html">Native Script. One code for all platforms</a></li>
<li><a href="../256819/index.html">Interesting notes on C # and CLR</a></li>
<li><a href="../256821/index.html">How IQueryable and LINQ Data Providers Work</a></li>
<li><a href="../256823/index.html">Features of conceptual domain modeling</a></li>
<li><a href="../256825/index.html">What prepares us for C # 7 (Part 1. Tuples)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>