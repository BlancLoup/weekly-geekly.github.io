<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Intel tools for optimizing applications and the problem of flows in porous media</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Modern computer systems, from a typical laptop to a computing cluster, are designed for parallel data processing. Therefore, the more fully programs u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Intel tools for optimizing applications and the problem of flows in porous media</h1><div class="post__text post__text-html js-mediator-article">  Modern computer systems, from a typical laptop to a computing cluster, are designed for parallel data processing.  Therefore, the more fully programs use this feature, the more chances they have to unleash the potential of existing hardware solutions.  However, before proceeding to a parallel code execution scheme, this code should work as efficiently as possible in single-threaded mode.  Otherwise, an increase in the number of threads will not yield the expected productivity growth. <br><br>  Optimizations that affect the speed of calculations when using any number of threads are reduced to taking into account in the code the features of processor architectures, instruction sets, to finding the most rational ways of working with different types of memory.  Assistance in such optimization can be provided, for example, by a top-down <a href="https://software.intel.com/en-us/top-down-microarchitecture-analysis-method-win">approach</a> to performance research using low-level data on system events, which are converted to high-level indicators that are available for analysis and practical application. <br><br> <a href="https://habrahabr.ru/company/intel/blog/310842/"><img src="https://habrastorage.org/files/8e0/389/7c1/8e03897c1065404f8f078d27114dd3a2.jpg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here we will consider a technique for optimizing computations related to modeling flows of multiphase liquids in porous media according to the method proposed in <a href="http://onlinelibrary.wiley.com/doi/10.1002/fld.3794/abstract">this</a> paper.  This is a numerical method for solving partial differential hyperbolic equations. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1d/333/1f1/f1d3331f12e617a5037d63b7803d1056.jpg"></div><br>  <i><font color="#999999">Simulation of flows of multiphase fluids in porous media</font></i> <br><br>  This task is used in many areas.  For example, in the field of oil and gas, industry, ecology. <br><br>  We will consider the methods of vectorization of the code, tell you about the transition from serial to parallel execution, we will conduct a series of experiments.  The experiments were conducted on Intel platforms, various software tools were used to analyze and optimize the application, in particular, Intel VTune Amplifier. <br><br>  The material consists of three main sections: <br><br><ul><li>  In the first we will talk about the automatic vectorization of the code and conduct experiments on a system with an Intel Core i5-4350U processor in single-threaded mode. <br><br></li><li>  The second section is devoted to comparing single-threaded and two-threaded execution of the application.  Here we will compare the speed of the different versions of the program on the processor Intel Core i7-5500U. <br><br></li><li>  The third section is devoted to the preparation of applications for execution in a multi-threaded environment.  It includes a story about analyzing and optimizing the application using the Intel Parallel Advisor.  We will test the code on the compute cluster node with 4 Intel Xeon E5-2698 v3. <br></li></ul><br><h2>  <font color="#0071c5">Analysis and automatic code vectorization</font> </h2><br><h3>  <font color="#0071c5">‚ñç Test platform and Intel AVX2 instruction set</font> </h3><br>  Here, as a hardware platform for experiments, the system is used on Ubuntu 14.04 with an installed Intel Core i5-4350U processor (1.4 GHz, 2 cores, 4 threads) with 3 MB of cache and 4 GB of RAM.  Our experimental environment is built on a processor belonging to the Intel Haswell family, which is fully supported by the Intel AVX2 instruction set.  Using the capabilities of this set of instructions, in particular, improved support for vectorization, improves the performance of applications designed for a wide range of platforms, including server solutions based on Intel Xeon and Intel Xeon Phi. <br><br>  When developing for the Intel AVX2, the same programming model was used that was used in the previous version, Intel AVX, however, the new instructions extend what it was by offering most 128-bit integer SIMD instructions with the ability to handle 256-bit numbers.  The vectorization of the code allows to reveal the potential of a single-threaded version of the program, which is extremely important before proceeding to the next step - parallel execution. <br><br>  Intel Parallel Studio XE 2015 is used here to analyze performance and evaluate optimization quality. <br><br><h3>  <font color="#0071c5">‚ñçAbout identifying optimization potential</font> </h3><br>  In order to understand how to optimize the code, you need to analyze it and find the program blocks, the execution of which can be accelerated through vectorization and parallelization.  In order to achieve this, you can use the tools of Intel, such as Intel VTune Amplifier and Intel Parallel Advisor.  In this regard, the reports generated by the compiler are very useful. <br><br>  Such tools allow you to analyze the source code of the application and executable files, giving hints about the directions of optimization.  The main bottlenecks in the processor pipeline are mostly explored. <br><br>  Modern microprocessors implement pipelining of instructions, and, along with this approach, they use other techniques, such as hardware flows, execution of commands with a change in their order, and parallelism at the instruction level.  All this is done in order to make the most of the resources of the system. <br><br>  The programmer who is engaged in code optimization is not an easy task.  The main difficulty here is that he needs to use the hardware capabilities of the computer as efficiently as possible, and they are at the level of the microarchitecture of the computing system, which is located quite far from the level of abstraction provided by modern programming languages ‚Äã‚Äãsuch as C, C ++ and Fortran. <br><br>  Intel tools can help optimize code by analyzing the compilation and composition of the application, giving information about the timing of program execution to determine exactly how the hardware resources are used.  Among these tools are compiler reports, Intel VTune, Intel Parallel Advisor.  Here's how to organize work with them. <br><br><ul><li>  <b>Analysis of the compiler report</b> .  The compiler is able to generate a report from which you can find out which automatic optimizations were applied to the code, and which ones were not.  Sometimes, for example, a certain cycle can be automatically vectorized, and sometimes this does not happen.  At the same time, the compiler reports this in both cases, and this information is useful for the programmer, since they allow him to decide whether his intervention in the code is necessary or not. <br><br></li><li>  <b>Analysis using Intel VTune Amplifier.</b>  This tool allows you to monitor how the application is executed on the pipeline, how it uses memory.  In addition, using VTune Amplifier, you can find out how long each module takes to execute, and how effectively system resources are used.  Intel VTune Amplifier creates a high-level scorecard with which you can analyze all this.  Among such indicators, for example, the number of clock cycles required per instruction. <br><br></li><li>  <b>Analysis using Intel Parallel Advisor.</b>  This tool can predict expected performance gains when switching to parallelism at the thread level.  In addition, Parallel Advisor can help in preparing the code for parallel execution. <br></li></ul><br>  A programmer, by combining the data obtained using the above tools, can change the source code of the program and the compilation parameters in order to achieve optimization targets. <br><br><h3>  <font color="#0071c5">‚ñçAutomatic code vectorization</font> </h3><br>  Modern compilers are able to vectorize executable code.  In particular, for this, the optimization parameter is set to - <code>O2</code> or higher.  You can disable automatic vectorization using the <code>‚Äìno-vec</code> compiler option.  This can be useful for comparing the performance of different executable code variants. <br><br>  In a nutshell, vectorization is the transformation of a program, after which one instruction is able to perform some operations with several data sets.  Consider as an example the processing of the cycle below. <br><br><pre> <code class="hljs matlab"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>&lt;=MAX; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) {      c[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] = b[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] + a[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]; }</code> </pre> <br>  If this cycle has not been subjected to vectorization, the use of registers in its execution looks something like the one shown in the figure below. <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/OcbdpuYkWeCBCHvLyyqptWogm62BVhJZb7B-KavNu-eyVJP10RqgUA65CfbkYCr3a4SVpo4A0Tv93WqEvJsAmt-tcKosspvOAFj_FSPI-36N19Lg0Ps3WzJ1bM0AhNYUo6XKeNvn"></div><br>  <i><font color="#999999">Using registers when executing a loop that has not been subjected to vectorization</font></i> <br><br>  If the same cycle is vectorized, additional registers will be involved, as a result, it will be possible to perform four addition operations using one instruction.  This is called ‚Äúone command stream ‚Äî many data streams‚Äù (Single Instruction Multiple Data, SIMD). <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/DB84vb8fd0NpxG7wYjQHZYKrZ7fu4-9NbINMJT1gY9xVHwMmhep-RHpPWr0U4GDxBmDEk1mPBaBNpDNW9XZrh-6LqXPK5SLncEToxBlXO1OSCXmxfsBfiAy4V-54UmloJRzD8HOG"></div><br>  <i><font color="#999999">Execution of a vectorized cycle</font></i> <br><br>  Such an approach usually improves performance, since one instruction processes multiple data sets instead of one. <br><br>  In the flow simulation application in porous media, the optimization of which we are engaged in, automatic vectorization allowed us to double the performance of the Haswell processor, which supports the Intel AVX2 instruction set. <br><br>  The - <code>xHost</code> instructs the compiler to generate executable code that is appropriate for the architecture of the system on which the compilation is being performed.  In the case when such a system is a computer with a processor of the Haswell family, the use of this parameter guarantees the use of Intel AVX2 instructions. <br><br>  The figure below shows the summary report of the Intel VTune Amplifier program compiled without using the parameter - <code>xHost</code> .  Here, the execution time was 186.6 seconds, the number of clock cycles per instruction (Clocks per Instruction, CPI) is approximately 0.5, the number of instructions executed is 1.067.768.800.000. <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/sVv1eCsxgkH49w9arOxkjezul7wfHUud5VNQ69HQQWu33N7n68I9mG-dXlulqaB6rxdFhwHqyp72OvthGRiE9olU5mfrcsN-Lk8Og73kgNFM2kfzpPnNVdhwGZ_SDK7R2zz9v7Sr"></div><br>  <i><font color="#999999">VTune Amplifier report, the -xHost parameter is not used</font></i> <br><br>  The main goal of optimization in this case is to reduce the code execution time and increase the CPI, which, ideally, should be 0.75, which means taking full advantage of the capabilities of the pipeline. <br><br>  The figure below shows a list of application modules, sorted by effective computer time. <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/wB4y7n1ihpXTIE0ZlBmyxfjW5_HAkQM4vnPsKtApP_sABqafgq2YM2B8hoYfZTYe9rNseIlgqXunkj5VZ8zcsF5MPivgIWKD1aj8IV0XHDS06SLBBUgHlS0k_qaTse1asdjzz8qA"></div><br>  <i><font color="#999999">List of application modules</font></i> <br><br>  Note that the <code>vizinhanca</code> function creates the maximum load on the system, using about 20% of the processor time.  This function is occupied by step-by-step calculation of the parameters of porosity, permeability, velocity, flow in each element and in all its neighboring elements in the simulated medium. <br><br>  Note that the CPI is very bad for the function <code>fkt</code> , which is busy calculating the flow parameters at a given time step.  This function calls the <code>vizinhanca</code> function. <br><br>  Here is the source code snippet for the <code>visinhanca.</code> function <code>visinhanca.</code>  Here there is information about the time required for each line to be executed and an assembler code for the selected line, which is occupied by a linear reconstruction, is output.  Note that the code does not include Intel AVX2 instructions. <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/GJ1J8EfoF7pOarNY-I1AlNG_fhVTPD71yhPrIcxYpPkf3WjKw_VhLYwpDWDIw-0662jb9XcqENtG-6AqnJzPxyFoVWf61OH9io6_taqCWH0SwdnVdA7fCXaj4d1-z2H_j7T2pdcF5Wim1Vz4Bg"></div><br>  <i><font color="#999999">Fragment of the assembly code linear reconstruction</font></i> <br><br>  The following instructions can be seen in this code snippet: MULSD, MOVSDQ, SUB, IMUL, MOVSXD, MOVL, MOVQ, ADDQ.  They are all from the Intel Streaming SIMD Extensions 2 (Intel SSE2) instruction set.  These ‚Äúold‚Äù instructions appeared with the release of the Intel Pentium 4 processor in November 2000. <br><br>  Having compiled the same code with the <code>‚ÄìxHost</code> parameter, which indicates to the compiler that it is necessary to generate executable code for the architecture of the system being used, and having analyzed its execution using the Intel VTune Amplifier, we obtained the following. <br><br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/wGxdmIfbVxIk3jd_amWoxM9D8tZWBStKDLG8QGtGwZlvSubmqBXZ9Mf8dLFJIvRAtAkGIw1tD3Vc_yTcyH_fPIMfKxZg1v9y3JvOVR-gPkFWgeHf8MBq2S87bJlIbk9Sl1eyEILGV6Os5KnVhg"></div><br>  <i><font color="#999999">VTune Amplifier report, the -xHost parameter is used</font></i> <br><br>  Namely, the code execution time is now 65.6 seconds, CPI is 0.62, which is much better than it was before and closer to the ideal value of 0.75. <br><br>  In order to understand the reason for this increase in performance, you can look at the assembler code.  There you will find instructions from the Intel AVX2 command set.  In addition, comparing VTune Amplifier reports, you can see that when using Intel AVX2, the number of executed instructions is much less than in the case of using SSE2 in a non-vectorized version of the code. <br><br>  This is due to the fact that the final data does not take into account the instructions whose execution was canceled, as they were in the branch where the code should not have been executed due to incorrect branch prediction.  A smaller number of such errors also explains the improvement in the CPI parameter. <br><br>  Here is the same fragment of the source code, which we considered above, but now its assembly representation is obtained after turning on the parameter - <code>xHost</code> . <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/v-d109TrmBzWa9_A2G5Uneh30TML0dctuSkHWcygKusX5GQ1x8oKIpR56H_vA3PFn0fCGGH9bOs0Grzgvv5Al_ytNOzS2kIdeQeuXG7Clo20OmNi7jtUdPD7iEk-toNdVOQvnX7i"></div><br>  <i><font color="#999999">Fragment of vectorized assembler linear reconstruction code</font></i> <br><br>  Please note that most of the instructions here are vector, from the Intel AVX2 kit, and not from SSE2.  Vector instruction names begin with the prefix <code>V</code> <br><br>  For example, using a VMOV instruction instead of MOV indicates that we are dealing with vectorized code. <br><br>  In the figure below you can see the register comparison for the Intel SSE2, AVX and AVX2 instruction sets. <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/e7LHwpQMADsp4McFdYxbw3rpPjS6U056lsdfaFzHOzbqtT8Gma101zJhWBCPOy6PCPuUr5btg6ySmQNirpCTVij24N7Vsd7Ovl00RX2plTpeVzyQ3k5q92_69BDQFnmB-Bpy3gRG"></div><br>  <i><font color="#999999">Registers and instruction sets</font></i> <br><br>  An easy-to-use approach with the inclusion of automatic vectorization allows you to achieve a threefold increase in productivity. <br><br><h3>  <font color="#0071c5">‚ñç Find problem areas of the code</font> </h3><br>  In the system with which we experiment, 4 threads can run on two physical cores.  Now the only improvement in the code that has been made is the automatic vectorization performed by the compiler.  We are still far from a program that is able to work at the limit of the system capabilities, the code can still be optimized.  In order to continue improving the code, you need to identify its bottlenecks.  For example, in the original version of our application there are many lines where division is used. <br><br>  The <code>‚Äìno-prec-div</code> option indicates to the compiler that the division operations should be replaced with multiplication operations with inverse values.  We will use this opportunity during the optimization of our application. <br><br>  Here is a fragment of the source code where the division operation is often used.  This code is located inside the <code>udd_rt</code> function, which, according to the previous analysis, is one of the bottlenecks. <br><br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/21dgfv0m-Kt6Hw8QZsLUe4McRjG3YinoSP_cFrwu6uhJsHQbh3WTK31cW1z3z5FvEepzUeOw0YA2Sqx7imoDbflFKo4fUj0bEYo7np1zl747j5Z7urgeqo3blcnmBms8j-CZaFw_"></div><br>  <i><font color="#999999">Many division operations in an important section of code</font></i> <br><br>  However, the <code>‚Äìno-prec-div</code> option has one problem.  Sometimes, after this optimization, the values ‚Äã‚Äãobtained are not as accurate as when using the usual IEEE division.  If accuracy is important for an application, use this option to disable optimization, which will lead to more accurate results with some performance drop. <br><br>  Here is another important issue that can be solved with Intel tools.  In our case, it lies in the fact that many application modules are written in Fortran, which complicates their optimization.  In order for interprocedural optimization to be performed when preparing the code for execution, the <code>‚Äìipo</code> option is <code>‚Äìipo</code> , which indicates to the compiler and linker that such optimization should be carried out.  In this case, some of the actions to optimize the code are made at the layout stage. <br><br>  Using the <code>‚Äìipo</code> , <code>‚ÄìxHost</code> and <code>‚Äìno-prec-div</code> options, the total program execution time decreased even more, to 53.5 seconds. <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/PJuA-CqPAVbnCFxCnyRq3XW3gHjzCJos6hxkZ3raVUsr0LR1WYBtd62idziYB2uQpOAndtnFoiYwcV5fTiJdgJ-KjMMniOjFRsQoAHVrZnf02eceWO6j1hSeUkdY_pi-BmB-c_f42wOCaEU9pQ"></div><br>  <i><font color="#999999">The result of using the options ‚Äìipo, -xHost and ‚Äìno-prec-div</font></i> <br><br>  In order to better understand the contribution to the performance of the program, which makes use of the <code>‚Äìno-prec-div</code> option, a test was conducted with this option disabled.  As a result, the execution time increased to 84.324 seconds.  This means that this option gives about a 1.5-fold increase in performance. <br><br>  Another test, this time with the <code>‚Äìipo</code> option <code>‚Äìipo</code> , showed that the execution time increased to 69.003 seconds.  This suggests that this option gives about a 1.3-fold increase in performance. <br><br><h3>  <font color="#0071c5">‚ñçUse Intel VTune Amplifier General Exploration to identify processor and memory limitations</font> </h3><br>  Intel VTune Amplifier can not only report on the time spent on program execution, on the CPI, and on how many instructions have been executed.  Using his General Exploration profile, you can get information about the behavior of the program inside the processor pipeline and find out whether it is possible to improve performance, given the limitations of the processor and memory. <br><br>  Restrictions of the computational core (Core Bounds) relate to problems that are not related to the transfer of data in memory and affect performance when executing instructions with a change in their order or when the operating units are overloaded.  Memory bounds can cause inefficient pipeline operation due to the need to wait for the load / save instructions to complete.  Together, these two parameters define what is called Back-End Bounds, this indicator can be interpreted as constraints arising inside the pipeline. <br><br>  If pipeline downtime is caused by empty slots, that is, by the fact that microcommands do not have time to enter it for any reason, and part of the pipeline does not perform useful work only because it has nothing to process, we already have the so-called Front-End Bounds - external to the pipeline restrictions. <br><br>  Here is a diagram of a typical modern pipeline that supports code execution with a change in the sequence of commands. <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/ZCpMUsdWDlzp9wmRBGGyQevRyvXmZkPr6RMKm95_ICi3qnictEEZKwbNjNuXYiNSZBfjjEVvlJRor9iaheWLrE0QCUfemUdxpAhRuQjVZbQyfAQZH85uFTgjUEW4TJW9h6Zk0YgXNKVyehS3uA"></div><br>  <i><font color="#999999">Intel processor pipeline that supports the execution of instructions with a change in their order</font></i> <br><br>  Internal structures, back-end pipelines, are ports for delivering instructions to the ALU, to the load and store blocks.  Unbalanced use of these ports usually has a bad effect on performance, since some units can either be idle or not be used as evenly as others that are overloaded. <br><br>  For the application that we are reviewing here, the analysis has shown that even when using automatic vectorization performed by the compiler, there are problems with the execution of the code.  Namely - the high value of Core Bound due to the unbalanced distribution of instructions on the ports. <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/Gt3v3DF_8oGah2zsYM4h3ulXYk8F8fbGcauGJw95aHa35WSYzKHsH-ltVFix9080evJSJjUX-BJBjXpgIjTrRdL3Hr3OBfX_4Fz-oNES02N7cdCSu_sd2yQRXZ5bpGX1VXBQVWdh9z-diBM68A"></div><br>  <i><font color="#999999">Limitations of the compute core</font></i> <br><br>  The analysis results shown in the figure above indicate a high level of clock cycles (0.203, or 20.3%), in which no ports are involved.  This indicates inefficient use of processor resources.  In addition, a high level of cycles (0.311, or 31.1%) is noticeable when three or more ports are involved.  This situation leads to overload.  Obviously, we have an unbalanced use of resources. <br><br>  The results of the situation analysis, performed in the Intel VTune Amplifier and shown in the figure below, reveal the causes of the problems described above.  In this case, there are four functions ( <code>fkt</code> , <code>udd_rt</code> , <code>xlo</code> , and <code>xmax_speed</code> ), which have a high Back-End Bound.  In addition, the <code>xmax_speed</code> function <code>xmax_speed</code> characterized by a too high level of incorrect predictions (Bad Speculation).  All is not well in the <code>transport</code> module. <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/zac8l1Abw7SDJYxGF47Nmg1ilUv2pGkTVLf3csUpVNL0x2QMtoiT8sEo1h8Y_wjKbnRp3VB45orsBOwVMhB7SrN0l4PAqYXGgYEUwNbhSMxeehIY7liw9rnl072D6jifDUixZxOD"></div><br>  <i><font color="#999999">Back-End Bound and Bad Speculation Analysis</font></i> <br><br>  The next step in our research is to use the Intel VTune Amplifier as a tool for analyzing the problems identified.  We are going to thoroughly examine each function noted above in order to find code points that are wasting CPU time. <br><br>  Analyzing each function that has a high rate in the column Back-End Bound, you can find out exactly where problems arise.  In the several figures below, you can see that the Intel VTune Amplifier shows the source code and the corresponding metrics for each row.  Among them are successfully completed instructions (Retiring), prediction errors (Bad Speculation), measures (Clockticks), CPI, restrictions within the pipeline (Back-End Bound).  In general, the high value of the Clockticks index indicates the responsible lines of code, and VTune highlights the corresponding values. <br><br>  Here is an analysis of the <code>transport</code> function, featuring a high Back End Bound. <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/wTQ8lG4_-mzgN9dBnCoM3IQvBTgYcjepftJZk1teH73U6tkCB2Sh9ifATjHvwVV2Ktt6Qf2adcAaG3KW49ViHJftJggG8uXDg3xJhEpFgpOQC7B8QC05rERBhp3_F609H8ucMPwEV2nTw93Z8w"></div><br>  <i><font color="#999999">Analysis of the reasons for the high value of the Back-End Bound in the transport function</font></i> <br><br>  The function <code>fkt</code> can also be classified as responsible.  It calls the functions <code>g</code> and <code>h</code> to compute the flow and the function <code>udd_rt</code> to calculate the saturation of the initial grid element.  Analytical data on this function is shown in the figure below. <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/-WyH3ouLFTf81ZYwECKO52nAEJvYVH2p7DkE7wF7aME0lMtSm9Igv8dWmHtjKXP5OFhc1RCpaXpWIdE5o8LZhP5gUOQXDujQAv7-nlymU0CTf3bkR2cNMBLv8R3sjD3gZSMIc_RN8MnTnfbeew"></div><br>  <i><font color="#999999">Fkt function analysis</font></i> <br><br>  Here is the code for the functions <code>g</code> and <code>h</code> that <code>fkt</code> . <br><br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uu,vv,xk,VDISPY,POROSITY)</span></span></span><span class="hljs-function"> !      !  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-function">     ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mPropGeoFisica</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">only</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlw</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlo</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlt</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gf2</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rhoo</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rhow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">implicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uu</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vv</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xk</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">REAL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VDISPY</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">POROSITY</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fw</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlwu</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlou</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xemp</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xg</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlwu</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uu)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlou</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uu)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fw</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlwu</span></span></span><span class="hljs-function">/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xlwu+xlou)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xg</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gf2</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xemp</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fw</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xg</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlou</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xk</span></span></span><span class="hljs-function">*</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rhoo-rhow)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fw</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vv</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xemp</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uu,vv,xk,VDISPZ,POROSITY)</span></span></span><span class="hljs-function"> !      !  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-function">     ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mPropGeoFisica</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">only</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlw</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlo</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlt</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gf3</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rhoo</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rhow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">implicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uu</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vv</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xk</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">REAL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VDISPZ</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">POROSITY</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fw</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlwu</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlou</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> :: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xemp</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xg</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlwu</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uu)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlou</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uu)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fw</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlwu</span></span></span><span class="hljs-function">/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xlwu+xlou)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xg</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gf3</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xemp</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fw</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xg</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlou</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xk</span></span></span><span class="hljs-function">*</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rhoo-rhow)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fw</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vv</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xemp</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span></code> </pre> <br>  Here it is important to pay attention to the fact that here we are talking about the two-dimensional components of the vector <code>F</code> , which represents the flow of the conserved value <code>s</code> in accordance with the following expression. <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/8FXkYT0g98JiNmhUaDTt831HHHI6k8-4ts8fMNyqdHjNJ_grrbbvIyHhb3yPrdSBwfK18q56sKjrn3H_I2O6AJeliaV0yQtAXJEsjvPuZaimx32zM-k0ZVhxDK5pcZTgPC6PiscG"></div><br>  The <code>xlo</code> function, which finds overall mobility in accordance with the mobility of water and oil, also has a high Back-End Bound.  Here is her analysis. <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/cvqVfME5d9fTed0L6PyIMoo3Cd9H0AYCaAYR6fO5IPWyc4x3pLZ8yworDzXFaJpMhsJFPedeO3t6QWrXlmAJUuPRT3378Xj3IUFsyS57_4Bl6HlU8v4uN1XeH6nBHnzW1nc7qYyG"></div><br>  <i><font color="#999999">Xlo function</font></i> <br><br>  Here is an analysis of the <code>xmax_speed</code> function, which calculates the maximum speed in the <code>x</code> direction.  This feature also makes a significant contribution to the overall level of the Back-End Bound. <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/7hJUOfaH0biPTMd5gKt0f_TYya--LLinYfZyA4tSgxPh5AzujSsAfO2PbQ23FyrcikmXmz-TP2GCCk8ueFH2I_mhBhzcBMHBl6UST2gRL8DfFrt26LsH5-H2YkCX8Xjnlei3_jSmPbW7g1HIvg"></div><br>  <i><font color="#999999">Xmax_speed function</font></i> <br><br>  Intel VTune Amplifier uses the data on the functions we analyzed above to find the final Back-End Bound score. <br><br>  As already mentioned, the reason for such restrictions may be inefficient use of the processor or memory.  Since automatic vectorization has already been applied to our code, it is very likely that the cause of the situation is in memory.  Further analysis, namely, consideration of the Memory Bound metric, the data on which is given below, suggests that the program uses the first-level cache inefficiently (L1 Bound metric). <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/tWc5erU96346L-nIrIChuibQvmvvsLub60DJ6eIE89nDs3QgIG0Z2tglXXZxtHNgQPjXNFZnh-IAE-wMlxIiKCT5ZaQ6NQo8ewenfF_hN3HxnJcjMPG24fFIhW6pkbiT2HPhF46H"></div><br>  <i><font color="#999999">Memory Bound</font></i> <br><br>  Since the application has a large number of data structures, such as vectors, required in a variety of different functions, they need to be carefully examined in order to find approaches to improving performance by reducing memory latency.  In addition, you should pay attention to the alignment of the data in order to help vectorize the code. <br><br><h3>  <font color="#0071c5">‚ñçApplication of compiler reports to find additional ways to optimize</font> </h3><br>  In order to discover more possibilities of code optimization by means of vectorization, you should use the compiler reports, as you can find information about cycles that can be vectorized.  The <code>MTRANSPORT</code> module became the central object of analysis, since it concentrates a significant amount of computation. <br><br>  Some external loops are not vectorized due to the fact that the corresponding inner loops are already vectorized due to the automatic vectorization technique described above.  In this situation, the compiler gives the following message: <br><br><pre> <code class="hljs pgsql">remark #####: <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> vectorized: <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> was already vectorized</code> </pre> <br>  In some cases, the compiler instructs the developer to use the SIMD directive to cycle the vector, but when this is done, the cycle still does not vectorize due to the fact that the assignment to a scalar variable is performed in it: <br><br><pre> <code class="hljs dos">!<span class="hljs-built_in"><span class="hljs-built_in">DIR</span></span>$ SIMD     <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> n=<span class="hljs-number"><span class="hljs-number">1</span></span>,nstep+<span class="hljs-number"><span class="hljs-number">1</span></span>     ss=smin+(n-<span class="hljs-number"><span class="hljs-number">1</span></span>)*ds</code> </pre> <br>  Here is the corresponding compiler message: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> at ./fontes/transporte.F90(<span class="hljs-number"><span class="hljs-number">143</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>)    remark #<span class="hljs-number"><span class="hljs-number">15336</span></span>: simd <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> vectorized: conditional    assignment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a scalar   [ ./fontes/transporte.F90(<span class="hljs-number"><span class="hljs-number">166</span></span>,<span class="hljs-number"><span class="hljs-number">23</span></span>) ]    remark #<span class="hljs-number"><span class="hljs-number">13379</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> vectorized <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> "simd"</code> </pre> <br>  Most of the cycles were automatically vectorized by the compiler, and in some cases the potential performance increase estimated by the compiler ranged from 1.4 (most cycles) to 6.5 (this figure was obtained only for one cycle). <br><br>  When the compiler detects that after vectorization, performance drops (that is, the performance increase is less than 1.0), it does not conduct vectorization.  Here is one example of a compiler message in a similar situation. <br><br><pre> <code class="hljs delphi">LOOP <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> at ./fontes/transporte.F90(<span class="hljs-number"><span class="hljs-number">476</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>)     remark <span class="hljs-string"><span class="hljs-string">#15335</span></span>: loop was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> vectorized: vectorization possible but seems inefficient. Use vector always directive <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> -vec-threshold0 <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>     remark <span class="hljs-string"><span class="hljs-string">#15451</span></span>: unmasked <span class="hljs-keyword"><span class="hljs-keyword">unaligned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> stride stores: <span class="hljs-number"><span class="hljs-number">1</span></span>     remark <span class="hljs-string"><span class="hljs-string">#15475</span></span>: --- <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> vector loop cost summary ---     remark <span class="hljs-string"><span class="hljs-string">#15476</span></span>: scalar loop cost: <span class="hljs-number"><span class="hljs-number">3</span></span>     remark <span class="hljs-string"><span class="hljs-string">#15477</span></span>: vector loop cost: <span class="hljs-number"><span class="hljs-number">3.000</span></span>     remark <span class="hljs-string"><span class="hljs-string">#15478</span></span>: estimated potential speedup: <span class="hljs-number"><span class="hljs-number">0.660</span></span>     remark <span class="hljs-string"><span class="hljs-string">#15479</span></span>: lightweight vector operations: <span class="hljs-number"><span class="hljs-number">2</span></span>     remark <span class="hljs-string"><span class="hljs-string">#15481</span></span>: heavy-overhead vector operations: <span class="hljs-number"><span class="hljs-number">1</span></span>     remark <span class="hljs-string"><span class="hljs-string">#15488</span></span>: --- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> vector loop cost summary --- LOOP <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre> <br>  In reality, the performance after automatic vectorization has increased about three times, in accordance with the average value estimated by the compiler. <br><br>  Analysis of the reasons why the compiler does not vectorize certain cycles should be carried out before using other optimization methods. <br><br><h3>  <font color="#0071c5">‚ñçExperiments with different mesh sizes</font> </h3><br>  All tests that were carried out up to the present moment were carried out as applied to solving a problem, the space of which is a grid of 100x20x100 in size, and 641 computation steps are carried out using a single computational flow. <br><br>  Here we take a look at working with grids of other sizes in order to compare the overall performance gains obtained through automatic vectorization.  Here is a comparison. <br><table><tbody><tr><td>  <b>Grid</b> <br></td><td>  <b>Execution time without vectorization</b> <br></td><td>  <b>Execution time with vectorization</b> <br></td><td>  <b>Productivity growth</b> <br></td><td>  <b>Number of steps</b> <br></td></tr><tr><td>  100 √ó 20 √ó 100 <br></td><td>  186,628 <br></td><td>  53,590 <br></td><td>  3.4 <br></td><td>  641 <br></td></tr><tr><td>  50 √ó 10 √ó 50 <br></td><td>  17,789 <br></td><td>  5.277 <br></td><td>  3.4 <br></td><td>  321 <br></td></tr><tr><td>  25 √ó 5 √ó 25 <br></td><td>  0.773 <br></td><td>  0,308 <br></td><td>  2.5 <br></td><td>  161 <br></td></tr><tr><td>  10 √ó 2 √ó 10 <br></td><td>  0.039 <br></td><td>  0,0156 <br></td><td>  2.5 <br></td><td>  65 <br></td></tr></tbody></table><br>  These tests showed that the larger the mesh, the greater the productivity growth achieved due to automatic vectorization.   ,       ,  ,   . <br><br>        ,    . <br><br><h2> <font color="#0071c5">     </font> </h2><br><h3> <font color="#0071c5">‚ñç </font> </h3><br>  ,   ,    , ,   ,   ,      ,          .                   .       Intel VTune Amplifier. <br><br> ,     ,   ,    ,     .     Ubuntu 14.04.3 LTS,    Intel Core i7-5500U (2.4 , 4  -)        HT (    ).      Intel Broadwell,      Intel AVX2.    7.7   . <br><br>   Broadwell    14- ,   Haswell.   ¬´-¬ª (¬´tick-tock¬ª),   Intel,      ¬´¬ª,  ,  ,         ,  . <br><br><h3> <font color="#0071c5">‚ñç </font> </h3><br>      Intel VTune XE 2016.       ,     <code>‚Äìipo</code> , <code>‚ÄìxHost</code>  <code>‚Äìno-prec-div</code> .    ,   . <br><br>    641        100x20x100,  39.259 ,          Haswell   1.4 .        Intel VTune Amplifier. <br><br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/UNAnZ-vgkMqsg1HXLwiB4iVTSOnBVzf8_5EQWpY_uqtMFrcbPjLfCMqbpv9m2VxZ6nnBtAD3j0dc2A3dqN96_LSBGLC9XnBNUzxWvmg0FB2HdVy3Ru1fOOr3Hntmer8rhPG6KoJw"></div><br> <i><font color="#999999"> Intel VTune Amplifier</font></i> <br><br>   ,  ,     ,    1.7  ,  ,     .  ,          1.4,      . <br><br>   ,   Back-End Bound  0.375.    ,          ,        . <br><br>         Back-End Bound. <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/2RAyEAmXf21OEF38xeysaPsYFNkx811uJ-1zNvnAXZugN6cuIU3XPLKxZKc0fvaJnzE54Em44cww-oULYCI_m6xZZx_fVkMPnuoZIR_dEDF_YA1ViMR7RU6-8YOknG75WWiL7JM6twPgNBgJ5A"></div><br> <i><font color="#999999">  Intel VTune Amplifier</font></i> <br><br>  ,       Back-End Bound    ( Core Bound),   ‚Äì     (Divider).    ,     ,     Port Utilization.    ,       ALU.   Core Bound ‚Äì                .      ,  ,     . ,  ,  ,   ,    ,     . ,  ,      ,    . <br><br>    ,       ,     .      ,     . <br>             Back-End Bound,  , ,       ,       .      . <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/AHZGcDfHVyv2du6RjkukEWMd4349VfAl4hTfVplR4eH3uViECb-SfZ4pLAx0KhYrSQ-vrpznZju3OCU6OUNkOHXtmMQgvc7I8uNA0xKkZ0MO66FtZnnnrdOthiyU37ZdDhWklBONKhd0bkDq7w"></div><br> <i><font color="#999999">  Intel VTune Amplifier</font></i> <br><br>      ,            ,       -              -    . <br><br><h3> <font color="#0071c5">‚ñç    </font> </h3><br>                    OpenMP. <br><br>     ,        Hyper-Threading,          ,  ,                . <br><br>    Intel VTune   . <br><br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/VDOmdB3YutTay1A3M8bCDBt0-WkNZ5lvx8sh3OJrT1H8koZ-D2UgrUTYQbVS6Qq9Itk0FQtH3kriA0VgDHxNhOZ9b1_fR1pROnJCNGyBL-sx9niA3bH9BV6bXFUW-7eiEfyYv1ZU"></div><br> <i><font color="#999999"> Intel VTune</font></i> <br><br>     ,    ,     ,    OMP_NUM_THREADS     2.     1.8  ,   Back-End Bound          ,     . <br><br>    .      ,   ,  ,  ,     Bad Speculation   <code>xlo</code>     Retiring   <code>xlw</code> . <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/W7QEBxn-JJJyFepow2ktOwxWHtGs_Lf3pr3fFW3n94oGos6z2AsnlSeZ4aXz9OfgK7jptULG4l3VsneWjWlYS3NucRkDMI7e9pIbatjDxRW1h3QiWb1901vsaahbysUKow5bCAtA"></div><br> <i><font color="#999999">  Intel VTune Amplifier</font></i> <br><br>    Bad Speculation   ,      -   .       . -,       ,   . -,     -      . <br><br>    ,       ,     .         ,        .   CPI Rate   <code>xlw</code>   ,      . <br><br>  ,        ,              . <br><br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/SvocBvq7fNNv2FQcNjMKM9I0V9kknAuNAgFrJxf04MDRPaPepztr_88M2IEQmkYiGFu70hTFu40bTq8BZa8Bpg7L5vY2ndLiVDTakZmgdcBEa8d_2lkCaKyu6YCmekSXK-kVXureaWXy_sgpwA"></div><br> <i><font color="#999999">  </font></i> <br><br>   ¬´O¬ª  ,    ,   ,     : , ,   . ,  -  ‚Äì  ,   ,   . -    ,       .  xl, xln, xlc, xr, xrn, xrc, yun, yu, yuc, ydc, yd  ydn ‚Äì  ,              ,        ,   ,             OpenMP. <br><br>  ,  ,      ,   ,     .   . <br><table><tbody><tr><td>  <b>Grid</b> <br></td><td> <b> ,  </b> <br></td><td> <b> ,  </b> <br></td><td> <b> </b> <br></td><td> <b> </b> <br></td></tr><tr><td> 100√ó20√ó100 <br></td><td> 39.259 <br></td><td> 21.429 <br></td><td>  1.83 <br></td><td>  641 <br></td></tr><tr><td> 50√ó10√ó50 <br></td><td> 2.493 <br></td><td> 1.426 <br></td><td> 1.74 <br></td><td>  321 <br></td></tr><tr><td> 25√ó5√ó25 <br></td><td> 0.185 <br></td><td> 0.112 <br></td><td>  1.65 <br></td><td>  161 <br></td></tr><tr><td> 10√ó2√ó10 <br></td><td> 0.014 <br></td><td>  0.015 <br></td><td> 0.94 <br></td><td>  65 <br></td></tr></tbody></table><br>                . ,      , 10x2x10,      . ,        , ,    . ,    ,        OpenMP,  ,     . <br><br>   Intel VTune Amplifier,          . <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/tRb_jm1yFFq5hB31qAyfEnHrOLI4tQySyLmJedU0iGXvoGVXhU1Ieh9kOi55C6y09BiDfUvfb_L94g2SEzSEDaW5acx-T3lvO0mTBQQdCfc2-fWoB8lbPQU31Kj9zm3hU_AT5Rqc"></div><br> <i><font color="#999999"> Intel VTune, 1 </font></i> <br><br>  ‚Äì   ,     . <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/YTKkwypg2FFJhlP-v2wABzuTWW2DxKNzi2IxEMNYaMMAsjldx9kamRzG1ZQLahXdFgNj0VfHPEQapyMdbjWllhJiLvYn8YYZbBloCu_iQVohJvcHNxkf-iUHj9SptbP_RI-wiIBc"></div><br> <i><font color="#999999"> Intel VTune, 2 </font></i> <br><br>    ,      Front-End Bound  ,  Back-End Bound ‚Äì .        ,   ‚Äì . <br><br><h2> <font color="#0071c5">   </font> </h2><br><h3> <font color="#0071c5">‚ñç     Intel Parallel Advisor</font> </h3><br> Intel Parallel Advisor ‚Äì   ,         .          ,       . <br><br>  Intel Parallel Advisor    : <br><br><ol><li>  . </li><li>    . </li><li>  . </li><li>  . </li></ol><br>        ,      .        ,    , <code>transport</code> ,   .  ,       ,  ,    . <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/cBaeTAXkNwbxxQ64dCj-EfgcTNl7_7dcQu4XD73IGGNJoYtdVUpSVLaWMcDD-HYAqyK3-TJQYLB587lb-PnL87LCUT23fqk-JFZDhCtau5ecpeaI_hCgDU5qS-yznohd6msFuHPKZe1pAlqiRQ"></div><br> <i><font color="#999999">Intel Parallel Advisor</font></i> <br><br> Intel Parallel Advisor   ,  ,    ,   (  ),    (Intel AVX, AVX2, SSE   ).        ,      ,       .      ,         ,     ,        .       <code>ktdd_rt</code> ,   <code>transport</code> ,   98%  ,     . <br><br>  ,   ,      ,      .         ,  Intel Advisor    ,        .                 API,          . <br><br>         ,      ,  ,    ,        .  ‚Äì ,      ,   ,  ,     .   ,      ,       ,    . <br><br>       ,   .   Parallel Advisor   .     . <br><br><ul><li>      (parallel site)     ,     .            . <br><br></li><li>      (parallel task)        .  ,      ,   ,             .          .  ,                                . <br><br></li><li>    (locking synchronization)    ,               . <br></li></ul><br>        . <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">call</span></span> annotate_site_begin("principal") <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> annotate_iteration_task("maxder") <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> maxder(numLadosELem,ndofV,numelReserv,vxmax,vymax,vzmax,vmax,phi,permkx,v) <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> annotate_site_end <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> annotate_site_begin("loop2")    <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> nel=<span class="hljs-number"><span class="hljs-number">1</span></span>,numel <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> annotate_iteration_task("loop_nelem") [‚Ä¶] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> annotate_site_end</code> </pre> <br>         <code>maxder</code> .  ‚Äì ,           . <br><br>              ,   .            (  <code>principal</code> )     .  ,             ( 32-)  .   ,    . <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/MicCopYnXUmvCY5-PKuWl38AIH45r0TrhgPDfn5dhLgW7pmrpqwn8meMW43vxsAE6EgJLorU76_v05GphnqlWi52lWa-gAmL8MHhjDH0hX6pku1n32jrPUXbCLspPq9A5t0pF_6PpbNAoCi9gQ"></div><br> <i><font color="#999999">    principal  Intel Parallel Advisor</font></i> <br><br>       <code>loop2</code> ,     64- . <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/qjr8fh338ZIpnr2O1-Atp5YyKczUo-diY6m1BDjRegEg42DxedPeWTJydshSttv8uF_Zz0iF3ZXP-Mdj1r4OoPbE3DEnjuW8XbRBS5ydm7NBQkToLKwbRNFqOLURjCvH2G4aO33n"></div><br> <i><font color="#999999">    loop2  Intel Parallel Advisor</font></i> <br><br>  ,     OpenMP ( CPU Count    4) Intel Parallel Advisor      2.47    ¬´principal¬ª   2.5   ¬´loop2¬ª.  ,   ,   ,    ,      . <br><br><h3> <font color="#0071c5">‚ñç </font> </h3><br>  ,  ,      ,      ,     Intel Xeon E5-2698 V3 (2.3 , 40  -). <br><br><h3> <font color="#0071c5">‚ñç    </font> </h3><br>       100x20x100  200x40x200  ,  ,         .      Intel Parallel Advisor,  ,          32- .        . <br><br>        ,       47 .   ,   .       . <br><br>     (100x20x100)          ,      25.      .     ,    ,   32-       ,    25.  32-       ‚Äì  ,   . <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/a9-tUKL5WhaaZsl2Dr930vSEVrd4bUajOMlkOku8PgYPNK5HgJGXoiWz8-TLAHYZCzRV0VYkGpLXXlfQY9r_pAzWD9hQF_58TcE9iLK2i7iTwbB_5PbY6g67Xyh3VPTmspKNdy1r"></div><br> <i><font color="#999999">    ,  100x20x100</font></i> <br><br>             :  1  25 ,  26  32,   33  47.  ,  ,     .  ‚Äì       Intel Hyper-Threading.  ‚Äì   <a href="https://static.ph.ed.ac.uk/dissertations/hpc-msc/2010-2011/IakovosPanourgias.pdf">NUMA-</a> . <br><br>    NUMA (Non Uniform Memory Access)       SMP, , -     ,     . <br><br>  NUMA     .    NUMA-         ,  ,     SMP. ,           . <br><br> ,  ,       ,      ,      , ,   ,    ,  ,    .  ,       NUMA-,      ,     ,       . <br><br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/u98ZtmOIPiHCdKymy1KhuSS3j_SuEGEYXV6nG_pbxlyC_7EnU1W3Fz6zuJyptyRNmonnJ-VOr0VHb01zQkMhD_fVwRixFQlpnZ5A0mfZEprYPXpJgqfcLwn0h461QmkdghYjXpai"></div><br> <i><font color="#999999"> NUMA</font></i> <br><br>  ,    ,     ,        .  ,      NUMA-. <br><br>    ,              Intel Hyper-Threading. <br><br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/zGFxMeMvJYQEZ06oofQ5CzzOG2BXiyzClZsoWt8wg5-HObHujPONZh4YlD7q37cNjeWB1AC-TqDj8AF3VCNsEjYZc-BYBh5S-EXGTfp84RoSU6NRs9vvY7PRvmEAWqYQYmYQCBWm"></div><br> <i><font color="#999999">Intel Hyper-Threading</font></i> <br><br>          ,    .    ,    ,      ,     .    ,     . <br><br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/i2_tiJq4xpF8Sd-_O2ppcPLnfdvpKCbJO_DDt_J35wX_wwKawaz0AF03Q1_wEXMpaAN-UvvxDAH6NYBoxIhXtDJF7Ctz9wD1Zw2wYmQKHv_wMnZ4R-e-EdVj4FPRBC53AZDDKXVb"></div><br> <i><font color="#999999">Intel Hyper-Threading</font></i> <br><br> ,    ,     ,     ,   ,   . <br><br> ,    ,       ,   <a href="https://www.dasher.com/will-hyper-threading-improve-processing-performance/"> </a> . ¬´  ‚Äì  ,         Intel HT. 64-  Intel Xeon       .   Intel HT ,        ‚Ññ1    ‚Ññ2.   ,         .    HT,        .     HT        10  7¬ª. <br><br>      10  7      1.5 . <br><br>      (200x40x200).    1281 ,    1000    (  100x20x100),      . <br><br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/8c3fdWqKrBeGn3_7CgcqOMoi-jV2AVkzNEjxjFIv_LRtz1MEv88t2JYo5ev5GCO7HZdqRcbECgpQARi23RfNwCyOIfbUaKpgLHsP5AiPOCg94_2nFXLlrN0OH1w3B__S43nNvh_2CTFfcCjR6Q"></div><br> <i><font color="#999999">    ,  200x40x200</font></i> <br><br>  ,             ,      16.     ,      .    1  16    19  32-       .          . <br><br>       ,     ,        ,      ,           ,  Intel Parallel Advisor,      ,    :  NUMA-    Hyper-Threading. <br><br>      ,          . <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/RgWSJe9VwbvZ0sBSHbcSPNwihckpuYvj1z9ngWJYZhtYRUHtIeBVDBht8jNHy0Je4sjuhP7iuivzVxEwkhLZEH_SsOUf_P3WBiCjf2Nf3HrZit667ent-r6CYvMp4659pmzymaFi"></div><br> <i><font color="#999999">   100x20x100</font></i> <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/qLUBVBHuWYg_Z6-_p1yo0VdVYR5iZcLhYkbtTTf4A-Qz3gNieG8tfE_4Fsjpb4l9sJNC-miFsGYPzaXl80RqWNxW8D-prqdp9oYMl5gBC7AyjMg-5lD7FPZTwgX-YCO99zRULcOcDz3ojYBsAA"></div><br> <i><font color="#999999">   200x40x200</font></i> <br><br>          ,    .     ,   ,    ,     ,   .  ,       ,       ,       ,    . <br><br>   ,  ,     ,          (Cr) c 0.125  0.0125.    ,       19 .     100x20x100     641  6410,    200x40x200 ‚Äì  1281  12810.  ,       ,   10 ,   Cr    10 . <br><br>       . <br><br><div style="text-align:center;"><img src="https://lh4.googleusercontent.com/8cWajd3B9tkEk52kvdgC7mjHb5GOAiGB0OQBYfmzbRz_zLzTpfcRN0cys_BQ9b_iXM952HVTLL2MfZ2Kc5tqtdsmpVwRLwZ6Qiq-jd8l1D6etRuYkm8To-Wf_ZGaLDCNPb1gSFCBSFJYvDjHlA"></div><br> <i><font color="#999999">   100x20x100, Cr = 0.0125</font></i> <br><br>  ,       ,      34-.          .  ,   4     HT,    9 .     ,      :  Hyper-Threading  ,   ,      . <br><br>   ,          ,         ,         .    ,            ,       .          200x40x200,      ,    ,          ,      16.         ,          ? <br><br>   ,     ,   .  ‚Äì    ,      , ,  ,     .  ‚Äì    ,             Cr.   ,     100x20x100,         .   ,        ,  403,16 ,    36  ‚Äì 14,22 ,     28-  . <br><br>  ,    ,       ,   ,    .           6577,53 .     36 ,     216,16 ,  ,     30 . <br><br>         ,        ,    .    ,  ,        ,      ,    . <br><br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/KYNvX-tBP9NeDZ0CkPCCAosJziUZhzFHhdPVriqqr63pzsK-9Shj4khIsNIvAqPRHAtXrdI-E57mF_ACD888dLddWQz4JqhXp9omwwIvXj5WpF-b2O3lsY2OoskcqtODPQhcUiPUg-uCG3Xduw"></div><br> <i><font color="#999999">   200x40x200, Cr = 0.0125</font></i> <br><br>          ,       ,          . <br><table><tbody><tr><td></td><td> <b> 100√ó20√ó100</b> <br></td><td> <b> 200√ó40√ó200</b> <br></td></tr><tr><td> Cr = 0.125 <br></td><td>   <br></td><td>   <br></td></tr><tr><td> Cr = 0.0125 <br></td><td>   <br></td><td>   <br></td></tr></tbody></table><br>    , ,      (   Cr)     ,   ,     -,      ,   ‚Äì  NUMA-.    ,          , ,  Intel Xeon Phi. <br><br><h2>  <font color="#0071c5">Results</font> </h2><br>              .    ,   ,   . <br>        . ,     , , ,        . ,   ,  ,      ,      . , ,     ,         .  ,     ,  ,        .  ,     . <br><br>       Intel,  ,       . ,        2.5    ,    3  ‚Äì    . <br><br>       ,      ,  ,                 ,      .  ,  ,          .   ,         . <br><br>    ,      ,    (OpenMP)  ,  ,            1.8 ,    ,     . <br><br>    Intel Parallel Advisor , ,  ,  32-  ,  ,     , ,             25  16     .     Parallel Advisor   ,  ,  NUMA-    Hyper-Threading. <br><br>  ,        .  ,          .        ,   ,     -,     .   NUMA- ,             ,      . <br><br>    ,   ,     ,       . ,            . ,        . </div><p>Source: <a href="https://habr.com/ru/post/310842/">https://habr.com/ru/post/310842/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310830/index.html">How to get the most out of code minification</a></li>
<li><a href="../310832/index.html">Implementing Row Level Security on MySQL</a></li>
<li><a href="../310834/index.html">Protection of digital content: how to apply DMCA and not go on the path of litigation?</a></li>
<li><a href="../310836/index.html">Functional safety, Part 3 of 7. IEC 61508: Systematic randomness or random systematicity?</a></li>
<li><a href="../310838/index.html">As MegaFon and Nokia in Nizhny Novgorod, 5G networks demonstrated</a></li>
<li><a href="../310844/index.html">Development extensions for firefox, or my first experience, on the example of a screenshot</a></li>
<li><a href="../310848/index.html">Modern operating system: what the developer needs to know</a></li>
<li><a href="../310850/index.html">In the tunnel under my house, I meet with elves. They give me advice on how to make supercomputers better.</a></li>
<li><a href="../310852/index.html">GitHub will open the GLB own load balancer code</a></li>
<li><a href="../310854/index.html">Redux Action Creators. No constant and headache</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>