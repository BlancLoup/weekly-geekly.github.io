<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practical use of Asterisk at home</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Like many colleagues in the shop, I have a small network built at home. And, of course, there is a home server, a sort of springboard for testing new ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practical use of Asterisk at home</h1><div class="post__text post__text-html js-mediator-article">  Like many colleagues in the shop, I have a small network built at home.  And, of course, there is a home server, a sort of springboard for testing new technologies.  With regular periodicity in the quiet evenings under the monotonous mumbling of some podcast, I am visited with thoughts of picking up something new and interesting.  The announcement of the provider to open the <a href="http://ru.wikipedia.org/wiki/SIP">sip-telephony service</a> prompted me to go towards voip.  An interesting and promising direction.  It would seem that there is such a thing - I installed a softphone, or even better, an iron sip gateway and enjoy life.  But unless it is that way which we have chosen, having gone on the way of the engineer, the system administrator, the programmer (it is necessary to underline).  It will be much more interesting to set up your own VoIP server, hang up <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25BE%25D0%25BB%25D0%25BE%25D1%2581%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D0%25BF%25D0%25BE%25D1%2587%25D1%2582%25D0%25B0">voice mail</a> on it and let them answer the calls in a beautiful female voice when no one can pick up the phone.  Of course, the choice fell on <a href="http://ru.wikipedia.org/wiki/Asterisk">Asterisk</a> . <br><a name="habracut"></a><br><br><h4>  Installation distribution </h4><br>  The home server is running <a href="http://ru.wikipedia.org/wiki/FreeBSD">FreeBSD</a> .  All procedures and paths will apply to this operating system.  Actually, with a little effort, everything perfectly adapts to any platform on which Asterisk can work. <br><br>  Once before, I installed Asterisk from source.  I do not remember what the problem was, that's not the point.  There is nothing difficult in the assembly.  This time I didn‚Äôt get bored and used the ports system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>cd /usr/ports/net/asterisk <br> make install clean</code> <br> <br>  Left everything by default in the configurator.  All gathered without further questions.  As it should be, the configs are in <i>/ usr / local / etc / asterisk /</i> .  And as usual there were not a few of them.  We, in fact, need only three of them. <br><br>  Do not forget about the autorun daemon: <br> <code>echo 'asterisk_enable=‚ÄùYES‚Äù' &gt;&gt; /etc/rc.conf</code> <br> <br><h4>  Configuration </h4><br>  The provider provides sip telephony services.  Gives a direct city number.  According to the terms of reference, my server should automatically register with the provider‚Äôs server and, in the event of an incoming call from the provider, route it to an internal telephone.  The internal telephone is a regular telephone connected via an iron sip gateway to our server.  If no one picks up the phone, then we play the voice message and offer the caller to leave a voice message. <br><br>  When calling from a ‚Äúlocal‚Äù phone, we will use the prefix to access the provider (I stopped at 9, as the most familiar option).  When dialing a number (in my case 777, we get into the voice mail menu).  It was possible to make an exit ‚Äúto the city‚Äù without a prefix, but my plans are to connect to sipnet.ru and use long-distance and international destinations through it.  After all, if you face it, the service of my local provider is only useful, that the direct city number and cheap calls within the city. <br><br>  Let's go back to the configuration. <br>  All connections will be made using the SIP protocol.  Everything related to the operation of Asterisk with sip is described in the file <i>/usr/local/etc/asterisk/sip.conf</i> : <br><br> <code>[general] <br> videosupport=no <br> useragent=boorhomepbx <br> register=&lt;_username&gt;:&lt;_password&gt;@&lt;_server_address&gt;/200 <br> <br> [100] <br> type=friend <br> host=dynamic <br> username=100 <br> secret=    <br> language=ru <br> nat=no <br> canreinvite=no <br> context=home <br> mailbox=200@default <br> disallow=all <br> allow=ulaw <br> allow=alaw <br> deny=0.0.0.0/0 <br> permit=192.168.0.0/24 <br> <br> [ext-out] <br> type=peer <br> context= extrnl <br> username=username <br> secret=&lt;_password&gt; <br> host=server_address <br> dtmf=inband <br> nat=yes <br> canreinvite=no <br> insecure=invite,port <br> fromuser=&lt;_username&gt; <br> fromdomain=&lt;_server_address&gt; <br> authname=&lt;_username&gt; <br> authuser=&lt;_username&gt;</code> <br> <br>  100 is a local phone <br>  ext-out is a provider <br>  <i>_username</i> - username to register with the provider <br>  <i>_password</i> - password to register with the provider <br>  <i>_server address</i> - the address of the provider's server <br><br>  It is important to pay attention to the line: <br> <code>register=&lt;_username&gt;:&lt;_password&gt;@&lt;_server_address&gt;/200</code> <br> <br>  Here we tell the server to register with the provider and in case of an incoming call, send it (call) to 200 extensions. <br><br>  <i>Also (as a <a href="https://habrahabr.ru/users/litnimax/" class="user_link">litnimax</a> rightly recommended), it is worthwhile to get into the habit of using the deny / permit directives.</i>  <i>Be careful, as they say, God protects.</i> <br><br>  Next you need to set up a dialplan so that the server knows what he needs to do with the incoming calls.  Dialplan is configured in the <i>/usr/local/etc/asterisk/extensions.conf</i> file: <br><br> <code>[home] <br> exten =&gt; 777,1,VoiceMailMain(300) <br> exten =&gt; _9.,1,Dial(SIP/ext-out/${EXTEN:1},30,r) <br> <br> [extrnl] <br> exten =&gt; 200,1,Dial(SIP/100,20,Ttr) <br> exten =&gt; 200,2,Playback(vm-nobodyavail) <br> exten =&gt; 200,3,Voicemail(200@default) <br> exten =&gt; 200,n,Hangup</code> <br> <br>  Here we have two contexts: home and extrnl.  The first one is used for ‚Äúlocal‚Äù calls, the second one gets calls ‚Äúoutside‚Äù (the context option in sip.conf). <br>  Home has only two lines.  The first allows you to get into the voice mail menu when dialing 777 (let's deal with it later). <br>  The second line is somewhat trickier.  Here, when you try to dial a number with prefix 9, the first character (prefix) is automatically discarded, and the remaining number is unchanged to the provider. <br><br>  In the extrnl prefix we describe extension 200. Recall the register option in sip.conf.  Actually, here first of all we are trying to call the SIP / 100 subscriber - this is our local phone ( <i>exten =&gt; 200,1, Dial (SIP / 100,20, Ttr)</i> ), if nobody picks up the phone within 20 seconds we play the voice message ( <i>exten =&gt; 200.2, Playback (vm-nobodyavail)</i> ) and transfer the caller to voice mail ( <i>exten =&gt; 200.3, Voicemail (200 @ default)</i> ).  The last action is "hang up". <br>  It uses standard sound files from the distribution.  They can be replaced with your own. <br><br>  Next you need to deal with voice mail.  The file <i>/usr/local/etc/asterisk/voicemail.conf</i> is responsible for this: <br><br> <code>[general] <br> format=wav49|gsm|wav <br> serveremail=asterisk <br> attach=yes <br> skipms=3000 <br> maxsilence=10 <br> silencethreshold=128 <br> maxlogins=3 <br> emaildateformat=%A, %d %B %Y at %H:%M:%S <br> mailcmd=/usr/sbin/sendmail ‚Äìt <br> sendvoicemail=yes <br> <br> [zonemessages] <br> eastern=America/New_York|'vm-received' Q 'digits/at' Imp <br> central=America/Chicago|'vm-received' Q 'digits/at' Imp <br> central24=America/Chicago|'vm-received' q 'digits/at' HN 'hours' <br> military=Zulu|'vm-received' q 'digits/at' HN 'hours' 'phonetic/z_p' <br> european=Europe/Copenhagen|'vm-received' adb 'digits/at' HM <br> <br> [default] <br> ;   +    e-mail <br> ; = , _,  ,  _ <br> 200 = 123, Incoming , email@me.com, attach=yes</code> <br> <br>  Here in the section [general] we specify the options, the names speak for themselves.  In [default] we describe the mailboxes of subscribers.  We have one subscriber with the box 200. Remember the line <i>exten =&gt; 200,3, Voicemail (200 @ default) from extensions.conf</i> ? <br><br>  These are the minimum settings for which we will get a working system.  Monitoring, debugging and server management can be performed via an interactive console, which is called by the asterisk ‚Äìr command. <br><br>  In general, the possibilities of Asterisk are truly endless.  As I said, you can register with several voip providers and route calls to the most financially advantageous areas.  You can automatically track the availability of certain areas.  Purely ryushechek instead of the standard beeps when you call you can screw some beautiful melody.  This can play into your hands when working as a freelancer from home. <br><br>  If you go further, you can screw the cell phone.  To do this, you need a sim card from a gsm provider (preferably with unlimited calls to your number and back) and a sip-gsm gateway.  Iron or soft.  From software I know only <a href="http://www.sipgsm.ru/">www.sipgsm.ru</a> .  There is one huge, in my opinion, flaw - it works only under windows.  And so he worked during the test period is quite stable.  This is the question of how to get gsm on your asterisk.  Well, then we set up the queue and please - you are always in touch.  When an incoming call we call the first subscriber (home landline phone), if no one takes it, we try to call our cellular via gsm-gateway.  With some imagination, you can get an opportunity to exit from your cell phone to the intercity at the rates of the sip provider.  In general, here it is possible to do this, which is very scary.  Everything is limited only by your imagination. <br><br><h5>  References: </h5><br>  <a href="http://www.asterisk.org/">Official project page</a> <br>  <a href="http://asterisk.ru/">Asterisk in Russian</a> <br>  <a href="http://voip.rus.net/tiki-index.php%3Fpage%3DAsterisk">Materials in Russian</a> <br>  <a href="http://asteriskpbx.ru/">Asterisk Knowledge Base</a> <br>  <a href="http://asterisk-support.ru/">Questions - Asterisk: Questions and Answers</a> <br>  <a href="http://asteriskblog.ru/">ATS Company Blog Design</a> <br>  <a href="http://www.voip-info.org/wiki/view/Asterisk">Asterisk - voip-info.org</a> </div><p>Source: <a href="https://habr.com/ru/post/120374/">https://habr.com/ru/post/120374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120368/index.html">Bundle rvm + Rails + Nginx + Unicorn or deploy rails correctly</a></li>
<li><a href="../120369/index.html">Can Tor trigger a world war?</a></li>
<li><a href="../120370/index.html">The input element in html 5, multi-flood</a></li>
<li><a href="../120371/index.html">Ebay sniper on a specific example</a></li>
<li><a href="../120373/index.html">NSPK: injured and winners</a></li>
<li><a href="../120375/index.html">Patterns of Command and Strategy in terms of functional programming</a></li>
<li><a href="../120377/index.html">New in Windows Azure Development Center on MSDN</a></li>
<li><a href="../120378/index.html">Dropbox - we get an additional 9 GB in one day</a></li>
<li><a href="../120380/index.html">Password protection for transmission over an open channel (part 1)</a></li>
<li><a href="../120382/index.html">Social Media Monitoring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>