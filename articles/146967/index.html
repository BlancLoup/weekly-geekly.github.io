<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SAP security in numbers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Notes 
 According to the partnership agreement with SAP, we do not have the right to publish detailed information about the vulnerabilities found befo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SAP security in numbers</h1><div class="post__text post__text-html js-mediator-article"><h5>  Notes </h5><br>  According to the partnership agreement with SAP, we do not have the right to publish detailed information about the vulnerabilities found before the patch is released.  Therefore, in this report, only those vulnerabilities are described in detail, information about which we have the right to disclose at the moment.  However, examples of exploitation of all the mentioned vulnerabilities, proving that they really exist, can be found on conference videos, as well as on erpscan.ru and dsec.ru. <br><br>  It should also be noted that our research in the field of SAP security in general and statistics collection in particular does not end with this report.  We plan to publish new statistics at least annually or as new methods of attack appear.  The latest statistics updates from SAP systems present on the Internet can be found on sapscan.com. <br><br><h5>  1. Introduction </h5><br>  The core of every large company is an ERP system;  It includes all business-critical processes, ranging from purchasing, payment and delivery, to the management of human resources, products and financial planning.  All information stored in ERP-systems is of great importance, and any unauthorized access to it can incur enormous losses, including stopping a business.  According to the Theft and Fraud Investigation Association (ACFE) report, from 2006 to 2010, the loss of organizations from internal fraud <a href="http://www.lasvegassun.com/news/2009/nov/06/managing-fraud-lesson-recession/">amounted to</a> about 7 percent of annual revenue (!).  That is why we decided to conduct a detailed study on SAP security using ERPScan - the Digital Security security monitoring system developed by SAP systems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  The common myth that ERP security is just the SOD matrix has exhausted itself over the last 5 years and already seems like a long history of days gone by.  Over the past 5 years, SAP security experts have presented many reports detailing various attacks on SAP's internal subsystems, such as the RFC data exchange protocol, the access control system SAP ROUTER, SAP web applications and client workers. stations running <a href="http://erpscan.com/publications/sap-security-attacking-sap-clients/">SAP GUI</a> .  Each year, interest in the topic increases exponentially: if in 2007 at specialized technical conferences on hacking and protection there was only 1 report about SAP, then in 2011 there were more than 20. Recently, a number of hacking tools have been released, confirming the possibility SAP attacks. <br><br>  According to the statistics of vulnerabilities in business applications, in 2009 more than 100 vulnerabilities in SAP products were eliminated, whereas in 2010 there were already more than 500. In total, in March 2012 there are more than 2000 SAP security notes other SAP components. <br><br>  Most of these vulnerabilities allow an unauthorized user to gain access to all of the company's critical business data, which makes it necessary to think about the use of certain solutions aimed at protecting SAP systems. <br><br><h6>  1.1.  New corporate security trends </h6><br>  The trends in the development of the infrastructure of companies have recently moved from a decentralized model to the integration of all business processes into unified systems.  If earlier the company had many servers, such as mail, file, domain controller and others, now all these functions are integrated into a single business application, which provides, on the one hand, ease of access, and on the other, a single point of failure.  Business applications and ERP systems store all critical company data, ranging from financial statements and personal data, to lists of counterparties and corporate secrets.  For an external attacker or insider, such a system is the main target, and its ultimate goal is not the administrator‚Äôs rights on the domain controller. <br><br>  However, many security experts are now unfortunately extremely superficially aware of the protection of business applications such as SAP.  The problem also lies in the fact that the security functions do not lie with the CISO, but with the owners of the system, who actually control themselves.  As a result, no one is responsible for the security of the most critical elements of the system. <br><br>  Of the less global problems, it is also worth noting: <br><br>  ‚Ä¢ <b>Lack of qualified specialists.</b>  In most companies, SAP security is perceived by SAP specialists only as an SOD problem, but by security services, understanding SAP threats is, at best, superficial, not to mention fine-tuning. <br><br>  ‚Ä¢ <b>A huge number of fine settings.</b>  In the standard settings of the system there are more than 1000 parameters, as well as a huge mass of fine-tuning, not to mention the differentiation of rights to various objects, such as transactions, tables, RFC-procedures and others - for example, web interfaces for accessing the system maybe a few thousand.  In all this mass of settings, the task of ensuring the security of even one system can be a daunting task. <br><br>  ‚Ä¢ <b>Customizable settings.</b>  It is unlikely that there will be two identical SAP systems, since most of the settings are somehow sharpened for the customer, and in addition, their own programs are being developed, the safety of which should also be taken into account in the integrated assessment. <br><br>  ‚Ä¢ <b>Automation.</b>  Having a large number of systems with constantly changing configurations also introduces additional problems. <br><br>  Our goal is to bring this problem from a theoretical level to a practical one, based on real data and measurements: ranging from information on the number of problems detected and their popularity to the number of vulnerable systems.  To this end, we have implemented a global <a href="http://sapscan.com/">project</a> to scan SAP systems available from the Internet. <br><br><h5>  2. Vulnerability statistics </h5><br><h6>  2.1.  The number of SAP security notifications </h6><br>  From time to time, SAP issues an internal document called a ‚Äú <a href="https://websmp208.sap-ag.de/securitynotes">Security Notice</a> ‚Äù (SAP Security note).  It typically stores information about one or more vulnerabilities in SAP products or configuration errors that pose a risk to SAP systems.  The first such notice was published in 2001.  Since 2007, their number has been growing exponentially. <br><br>  As of April 26, 2012, more than 2000 SAP security notices have been published. <br><br>  During 2011, on Critical Patches Day (every second Tuesday), approximately 65 SAP security notifications were usually posted.  When compared with other manufacturers, it is more than that of Microsoft, Oracle and Cisco.  It is worth noting that only 3 years ago there were much fewer of them. <br><br><img src="https://habrastorage.org/storage2/ed5/7e6/093/ed57e609397ae7f3abbe87c7fd64fe93.png"><br>  <i>Number of SAP security notifications by year</i> <br><br><h6>  2.2.  SAP Criticality Security Notifications </h6><br>  SAP uses 5 levels of severity for its notifications: <br><br>  1 - Sensation <br>  2 - High priority <br>  3 - Medium priority <br>  4 - Low priority <br>  5 - Recommendations / additional information <br><br>  Most of the problems (69%) have a high priority, which means that about 2/3 of the published vulnerabilities need to be fixed quickly. <br><br><h6>  2.3.  SAP Security Notifications by Type </h6><br>  We analyzed all published SAP security notices by type.  The most popular problems are presented on the chart: <br><br><img src="https://habrastorage.org/storage2/2f7/159/d5d/2f7159d5d43d7b57252ce3a23c9db089.png"><br><br>  It is worth noting that the new type of vulnerability, which is called <a href="http://erpscan.com/wp-content/uploads/2011/08/A-crushing-blow-at-the-heart-SAP-J2EEengine_whitepaper.pdf">Verb Tampering</a> , has become one of the most popular.  This ‚Äúauthentication bypass‚Äù vulnerability was first discovered by Digital Security, and later as many as 18 problems of this type were found. <br><br>  About 20% of vulnerabilities were not included in this rating, since a significant number of unique problems are present in SAP systems.  Some of them are described in our presentation ‚Äú <a href="http://erpscan.com/wp-content/uploads/2012/06/Top-10-most-interesting-vulnerabilities-and-attacks-in-SAP-2012-InfoSecurity-Kuwait.pdf">Top 10 most interesting vulnerabilities in SAP</a> ‚Äù. <br><br><h6>  2.4.  Number of thanks to outside researchers </h6><br>  In 2010, SAP decided to <a href="http://scn.sap.com/docs/DOC-8218">thank</a> third-party security researchers for the vulnerabilities found in their products.  The diagram shows the number of vulnerabilities discovered by third-party researchers since 2010.  Half of the vulnerabilities were found and successfully fixed by SAP using Digital Security (50 vulnerabilities and 26% of the total) and VirtualForge (44 vulnerabilities, that is 23%).  The second half was discovered by dozens of other companies, and their number is growing, which proves the growing popularity of this area. <br><br><img src="https://habrastorage.org/storage2/f8d/e4a/91e/f8de4a91e2353a3d402ac35dbe6118cf.png"><br><br><h6>  2.5.  Amount of publicly available information </h6><br>  The most dangerous are vulnerabilities, information about exploitation of which (detailed description of vulnerability, PoC-exploits or full-fledged exploits) is available online.  We have gathered information from the following popular sources: <br><br>  <a href="http://securityfocus.com/">SecurityFocus</a> - here you can find a detailed description, sometimes a PoC-exploit.  All vulnerabilities in this database have a high probability of exploitation.  Details about 123 vulnerabilities were found here (6% of the total). <br><br>  <a href="http://exploit-db.com/">Exploit-DB</a> - here are ready-made exploits that can be used without making changes and without having any knowledge about the operation of the corresponding system.  All vulnerabilities in this database have a critical exploitation probability.  24 exploits were found here (1% of the total number of vulnerabilities). <br><br><h6>  2.6.  Top 5 most important vulnerabilities in 2011 </h6><br>  Of the many vulnerabilities published, we selected the top 5 issues that pose the greatest threat: <br><br>  ‚Ä¢ <a href="http://erpscan.com/advisories/dsecrg-11-041-sap-netweaver-authentication-bypass-verb-tampering/">Authentication bypass with Verb Tampering</a> <br>  ‚Ä¢ <a href="http://virtualforge.com/tl_files/Theme/whitepapers/201106_SAP_Security_Recommendations_Protecting_JAVA_ABAP.pdf">Bypass authentication using Invoker Servlet</a> <br>  ‚Ä¢ <a href="http://virtualforge.com/tl_files/Theme/whitepapers/BlackHat_EU_%25202011_Wiegenstein_The_ABAP_Underverse-WP.pdf">Buffer overflow in ABAP kernel call</a> <br>  ‚Ä¢ <a href="http://erpscan.ru/advisories/dsecrg-11-039-sap-netweaver-th_grep-module-code-injectionvulnerability-new/">Remote code execution through TH_GREP</a> <br>  ‚Ä¢ <a href="http://www.onapsis.com/resources/get.php%3Fresid%3Dadv_onapsis-2011-002">Extend JSESSIONID using the SAP Management console</a> <br><br>  <b>1. Bypass authentication using Verb Tampering</b> <br><br>  This vulnerability was discovered in the SAP NetWeaver J2EE engine.  It allows an anonymous hacker to completely compromise the SAP system.  It was found about 40 applications vulnerable to this attack.  In the most critical case, it was possible to create any user, assign him any role in the system and execute any command in the OS. <br><table border="1" width="631"><tbody><tr><td width="177">  <strong>Spying Risk</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>The risk of sabotage</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>Fraud Risk</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>Availability</strong> <strong>:</strong> </td><td width="454">  Anonymously over the Internet </td></tr><tr><td width="177">  <strong>Ease of operation</strong> <strong>:</strong> </td><td width="454">  High </td></tr><tr><td width="177">  <strong>CVSSv2:</strong> </td><td width="454">  ten </td></tr><tr><td width="177">  <strong>Description</strong> <strong>:</strong> </td><td width="454">  <a href="http://erpscan.com/advisories/dsecrg-11-041-sap-netweaver-authentication-bypass-verb-tampering/">http://erpscan.com/advisories/dsecrg-11-041-sap-netweaver-authentication-bypass-verb-tampering/</a> </td></tr><tr><td width="177">  <strong>Patch</strong> <strong>:</strong> </td><td width="454">  SAP Security Notices: 1589525, 1624450 </td></tr><tr><td width="177">  <strong>Author</strong> <strong>:</strong> </td><td width="454">  Alexander Polyakov (Digital Security) </td></tr></tbody></table><br>  <b>2. Bypass authentication using Invoker Servlet</b> <br><br>  This vulnerability was discovered in the SAP NetWeaver J2EE engine.  It allows an anonymous hacker to bypass the security restrictions of SAP web services and directly invoke critical functions by the names of their classes.  About 30 applications are vulnerable to this attack.  Depending on the specific application, you can add new users to the system, read system files, including database files, or reveal critical information. <br><table border="1" width="631"><tbody><tr><td width="177">  <strong>Spying Risk</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>The risk of sabotage</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>Fraud Risk</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>Availability</strong> <strong>:</strong> </td><td width="454">  Anonymously over the Internet </td></tr><tr><td width="177">  <strong>Ease of operation</strong> <strong>:</strong> </td><td width="454">  High </td></tr><tr><td width="177">  <strong>CVSSv2:</strong> </td><td width="454">  ten </td></tr><tr><td width="177">  <strong>Description</strong> <strong>:</strong> </td><td width="454">  <a href="http://help.sap.com/saphelp_nw70ehp2/helpdata/en/bb/f2b9d88ba4e8459%2520e5a69cb513597ec/frameset.htm">http://help.sap.com/saphelp_nw70ehp2/helpdata/en/bb/f2b9d88ba4e8459 e5a69cb513597ec / frameset.htm</a> </td></tr><tr><td width="177">  <strong>Patch</strong> <strong>:</strong> </td><td width="454">  SAP Security Notice: 1585527 </td></tr><tr><td width="177">  <strong>Author</strong> <strong>:</strong> </td><td width="454">  SAP </td></tr></tbody></table><br>  <b>3. Buffer overflow in ABAP kernel call</b> <br><br>  A buffer overflow vulnerability was discovered in an ABAP kernel call.  It can be exploited by invoking an ABAP report that uses a vulnerable kernel call and passes the data entered by the user into it.  This vulnerability allows a user with BASIS rights to compromise the OS and execute any commands with the rights of the user adm.  Now only the PoC-exploit is publicly available, but there is also a working exploit created in our laboratory. <br><table border="1" width="631"><tbody><tr><td width="177">  <strong>Spying Risk</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>The risk of sabotage</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>Fraud Risk</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>Availability</strong> <strong>:</strong> </td><td width="454">  Requires a user with BASIS rights. </td></tr><tr><td width="177">  <strong>Ease of operation</strong> <strong>:</strong> </td><td width="454">  Average.  It is necessary to know well the technology of writing exploits for various platforms. </td></tr><tr><td width="177">  <strong>CVSSv2:</strong> </td><td width="454">  4.8 </td></tr><tr><td width="177">  <strong>Description</strong> <strong>:</strong> </td><td width="454">  <a href="http://virtualforge.com/tl_files/Theme/whitepapers/BlackHat_EU_%25202011_Wiegenstein_The_ABAP_Underverse-WP.pdf">http://virtualforge.com/tl_files/Theme/whitepapers/BlackHat_EU_ 2011_Wiegenstein_The_ABAP_Underverse-WP.pdf</a> </td></tr><tr><td width="177">  <strong>Patch</strong> <strong>:</strong> </td><td width="454">  SAP Security Notices: 1487330, 1529807 </td></tr><tr><td width="177">  <strong>Author</strong> <strong>:</strong> </td><td width="454">  Andreas Wiegenstein (Andreas Wiegenstein) </td></tr></tbody></table><br>  <b>4. Remote code execution through TH_GREP</b> <br><br>  ABAP remote command execution vulnerabilities became popular in 2011.  One of the most known such vulnerabilities was found in the function module TH_GREP.  Interestingly, Joris found this vulnerability back in 2010, it was fixed, but our researcher Alexey Tyurin analyzed the patch and found that it did not completely solve the problem: in Windows, the patch could be bypassed.  And only then this vulnerability was finally fixed.  It allows an authorized user with BASIS rights to compromise the OS and execute any commands with the rights of the user adm. <br><table border="1" width="631"><tbody><tr><td width="177">  <strong>Spying Risk</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>The risk of sabotage</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>Fraud Risk</strong> <strong>:</strong> </td><td width="454">  Critical </td></tr><tr><td width="177">  <strong>Availability</strong> <strong>:</strong> </td><td width="454">  Requires a user with BASIS rights. </td></tr><tr><td width="177">  <strong>Ease of operation</strong> <strong>:</strong> </td><td width="454">  High. </td></tr><tr><td width="177">  <strong>CVSSv2:</strong> </td><td width="454">  6 </td></tr><tr><td width="177">  <strong>Description</strong> <strong>:</strong> </td><td width="454">  <a href="http://erpscan.ru/advisories/dsecrg-11-039-sap-netweaver-th_grep-module-code-injection-vulnerability-new/">http://erpscan.ru/advisories/dsecrg-11-039-sap-netweaver-th_grep-module-code-injection-vulnerability-new/</a> </td></tr><tr><td width="177">  <strong>Patch</strong> <strong>:</strong> </td><td width="454">  SAP Security Notice: 1620632 </td></tr><tr><td width="177">  <strong>Author</strong> <strong>:</strong> </td><td width="454">  Joris van de Wiz and Alexei Tyurin (Digital Security) </td></tr></tbody></table><br>  <b>5. Extend JSESSIONID using the SAP Management console</b> <br><br>  Mariano Nunez discovered a vulnerability in SAP MMC that allowed anonymous reading of any log file in the SAP system.  In turn, during the testing of SAP penetration systems, we found that the JSESSIONID value is sometimes stored in the log files, if the maximum trace level is set.  And access to JSESSIONID means the ability to insert its value into a cookie and enter the SAP system under the guise of an existing user. <br><table border="1" width="631"><tbody><tr><td width="177">  <strong>Spying Risk</strong> <strong>:</strong> </td><td width="454">  Tall </td></tr><tr><td width="177">  <strong>The risk of sabotage</strong> <strong>:</strong> </td><td width="454">  Average </td></tr><tr><td width="177">  <strong>Fraud Risk</strong> <strong>:</strong> </td><td width="454">  Tall </td></tr><tr><td width="177">  <strong>Availability</strong> <strong>:</strong> </td><td width="454">  Average.  Remote MMC access required </td></tr><tr><td width="177">  <strong>Ease of operation:</strong> </td><td width="454">  Average.  Tracing must be enabled. </td></tr><tr><td width="177">  <strong>CVSSv2:</strong> </td><td width="454">  5.6 </td></tr><tr><td width="177">  <strong>Description</strong> <strong>:</strong> </td><td width="454">  <a href="http://erpscan.com/wp-content/uploads/2012/06/Top-10-most-interesting-vulnerabilities-and-attacks-in-SAP-2012-InfoSecurity-Kuwait.pdf">http://erpscan.com/wp-content/uploads/2012/06/Top-10-most-interesting-vulnerabilities-and-attacks-in-SAP-2012-InfoSecurity-Kuwait.pdf</a> </td></tr><tr><td width="177">  <strong>Patch</strong> <strong>:</strong> </td><td width="454">  SAP Security Notice: 1439348 </td></tr><tr><td width="177">  <strong>Author</strong> <strong>:</strong> </td><td width="454">  First discovered by Mariano Nunes (Mariano Nunez);  new vector found by Alexei Tyurin (Digital Security) </td></tr></tbody></table><br><h5>  3. Increasing interest </h5><br>  Information security trends currently focus mainly on mobile applications, cloud services, social networks, and critical infrastructure facilities that may be targeted by attackers in the near future.  However, there is such an area as the security of ERP-systems, and these systems are under threat now.  Therefore, a growing number of companies that are engaged in the security of ERP-systems and develop software to audit their security.  At the same time, new companies are constantly appearing that offer specialized consulting services in the field of ERP system security. <br><br><h6>  3.1.  Number of safety reports at technical conferences </h6><br>  Since 2006, SAP security has received increasing attention at technical security conferences such as BlackHat, HITB, etc.  Since 2010, this trend has spread to other conferences.  More and more companies and researchers are publishing SAP security research.  From 2006 to 2009, most of the reports were devoted to the classic IS threats in the SAP landscape: SAP web application security, SAP client security, backdoors, and trojans under SAP.  Last year, the focus shifted to highly specialized studies of various types of vulnerabilities in SAP, in the ABAP code and in SAP Kernel, such as <a href="http://virtualforge.com/tl_files/Theme/Presentations/HITB2011.pdf">SQL injection</a> , <a href="http://virtualforge.com/tl_files/Theme/whitepapers/BlackHat_EU_%25202011_Wiegenstein_The_ABAP_Underverse-WP.pdf">buffer overflow</a> , vulnerabilities in the J2EE engine.  The most striking examples are <a href="http://erpscan.com/advisories/dsecrg-11-041-sap-netweaver-authentication-bypass-verb-tampering/">Verb Tampering</a> , <a href="http://www.taddong.com/docs/BlackHat_EU_2011_Siles_SAP_Session-Slides.pdf">Session Fixation</a> , <a href="http://erpscan.com/wp-content/uploads/2011/08/A-crushing-blow-at-the-heart-SAP-J2EEengine_whitepaper.pdf">Invoker Servlet</a> , as well as vulnerabilities in their own SAP protocols - <a href="http://www.sensepost.com/cms/resources/labs/tools/poc/sapcap/44con_2011_release.pdf">DIAG</a> and <a href="http://erpscan.com/wp-content/uploads/2011/08/A-crushing-blow-at-the-heart-SAP-J2EEengine_whitepaper.pdf">P4</a> . <br><br><img src="https://habrastorage.org/storage2/a21/708/19e/a2170819ee36ee8de4d10961cb290dba.png"><br><br>  The number of SAP security reports presented at various conferences each year is shown on the graph.  For 2012, an approximate amount is calculated based on data for the first 4 months. <br><br><h5>  4. SAP on the Internet </h5><br>  Among the many people working with SAP, there is a myth that SAP systems are isolated from the Internet, so all vulnerabilities in SAP can only be exploited by insiders. <br><br><blockquote>  <b>From <a href="http://www.cio.com/article/216940/The_ERP_Security_Challenge">an interview</a> with Saccar Paulus (Sachar Paulus, senior vice president of product protection and security at SAP) for CIO magazine:</b> <br><br>  <b>CIO</b> : What, in your opinion, are the most important SAP security threats?  What aspects of SAP security do you consider the most difficult? <br><br>  <b>Sakkar</b> : Another threat is <b>people who connect their SAP systems to the Internet</b> in order to increase support for the supply chain in the system or to add new functionality to make life easier for employees.  <b>The problem here is that the classic, well-studied network threats are poorly understood by the ERP community.</b>  People who are in charge of ERP systems understand the threat of an insider attack, because they have been dealing with it for many years, but when business requirements dictate the need to connect the system to the Internet, <b>these people do not think about such threats as cross-site scripting</b> .  Viruses or worms may appear under the ERP platform, while these people do not understand the importance of patches.  This is the hardest challenge for organizations.  To accept this challenge, <b>cooperation is needed between people who understand the security of ERP systems, and people who understand the security of the Internet, email and web services</b> . </blockquote><br>  Business applications are not only accessible from the internal network;  This is a myth that was a reality ten years ago, when all information about a company was usually stored on one server.  Business is changing, and companies need network connections between different applications.  They need to have a connection with branches all over the world, exchange data with clients through web portals, SRM and CRM systems, and have access to information from anywhere in the world through mobile solutions.  Almost all business applications now have access to the Internet. <br><br>  To destroy this myth, we will demonstrate which services are remotely accessible, which companies they belong to and in what respect these services are vulnerable to modern threats. <br><br><h6>  4.1.  Google search results by country </h6><br>  These statistics were collected using simple queries in the well-known search engine Google. <br><table border="1"><tbody><tr><td width="306">  <strong>Application Server Type</strong> </td><td width="308">  <strong>Search query</strong> </td></tr><tr><td width="306">  <strong>SAP NetWeaver ABAP</strong> <br><br></td><td width="308">  Inurl: / SAP / BC / BSP <br><br></td></tr><tr><td width="306">  <strong>SAP NetWeaver J2EE</strong> <br><br></td><td width="308">  Inurl: / irj / portal <br><br></td></tr><tr><td width="306">  <strong>SAP BusinessObjects</strong> <br><br></td><td width="308">  inurl: infoviewapp </td></tr></tbody></table><br>  The scan revealed about 610 unique servers with various SAP web applications.  Obviously, the most popular platform is J2EE.  Unfortunately, such servers are more vulnerable than the ABAP engine, since this platform has at least 3 different vulnerabilities that can be exploited anonymously and provide full access to the system.  On the other hand, in the ABAP engine, <a href="http://erpscan.com/press-center/blog/sap-application-server-security-essentials-default-passwords/">many</a> predefined user accounts with standard logins and passwords can be used by hackers.  SAP BusinessObjects has both of these problems. <br><table border="1" width="614"><tbody><tr><td width="398">  <strong>Apps server</strong> </td><td width="119">  <strong>amount</strong> </td><td width="97">  <strong>%</strong> <br><br></td></tr><tr><td width="398">  <strong>SAP NetWeaver J2EE</strong> </td><td width="119">  268 </td><td width="97">  44% </td></tr><tr><td width="398">  <strong>SAP Web Application Server</strong> </td><td width="119">  163 </td><td width="97">  27% </td></tr><tr><td width="398">  <strong>SAP BusinessObjects</strong> </td><td width="119">  106 </td><td width="97">  17% </td></tr><tr><td width="398">  <strong>SAP NetWeaver ABAP</strong> </td><td width="119">  73 </td><td width="97">  12% </td></tr></tbody></table><br><img src="https://habrastorage.org/storage2/dcb/c52/c7b/dcbc52c7b1c74296a5938e932b123a75.png"><br>  <i>Application Servers by Country</i> <br><br><h6>  4.2.  Search results for Shodan by country </h6><br>  <a href="http://www.shodanhq.com/">Www.shodanhq.com</a> was chosen as the second resource for searching SAP web interfaces on the Internet.  The peculiarity of this service is that it not only finds applications that have been indexed by search robots, but scans the entire Internet for the presence of the open 80th port (and others), so it was used for an additional search for SAP systems. <br><br>  In general, we found 2677 servers with a variety of SAP web applications.  This is 4.5 times more than with Google. <br><table border="1" width="640"><tbody><tr><td width="412">  <strong>Apps server</strong> </td><td width="119">  <strong>amount</strong> </td><td width="108">  <strong>%</strong> <br><br></td></tr><tr><td width="412">  <strong>SAP NetWeaver J2EE</strong> </td><td width="119">  863 </td><td width="108">  32% </td></tr><tr><td width="412">  <strong>SAP Web Application Server</strong> </td><td width="119">  734 </td><td width="108">  27% </td></tr><tr><td width="412">  <strong>SAP BusinessObjects</strong> </td><td width="119">  686 </td><td width="108">  26% </td></tr><tr><td width="412">  <strong>SAP NetWeaver ABAP</strong> </td><td width="119">  394 </td><td width="108">  15% </td></tr></tbody></table><br><img src="https://habrastorage.org/storage2/9bf/00b/fb0/9bf00bfb019d1d8684f310f23dc5bcc1.png"><br><br><h6>  4.3.  Port scan results by country </h6><br>  The most interesting and difficult part of the study is scanning the Internet not only for the presence of web services, but also for services that should not be accessible on the Internet at all. <br>  At this stage, this task was performed using a simple algorithm that scanned only the subnets of the servers that were found through Google and Shodanhq (these are about 1,000 subnets).  We found a large number of ports that are monitored by SAP services such as Message Server HTTP, SAP Gateway, SAP HostControl.  The number of open ports will be updated online at <a href="http://www.sapscan.com/">www.sapscan.com</a> - the official project website. <br><br>  Another project that has not yet been completed is a global scan of the Internet for open ports.  At the moment, only a number of the largest countries have been completely scanned. <br><br>  As an example, below are the results of scanning Russia.  A total of 58 SAP routers installed by default on port 3299 were detected. After receiving the list of SAP routers on all subnets where SAP routers were detected, a scan was started for the presence of prohibited external services, such as SAP Hostcontrol, SAP Dispatcher , SAP Message Server, SAP Management console. <br><br>  10% of Russian companies that use SAP, open access to the Internet bypassing the router for SAP Dispatcher. <br><br>  The diagram below shows the percentage of companies that provide Internet access to certain critical SAP services. <br><br><img src="https://habrastorage.org/storage2/1fc/f0f/824/1fcf0f82448cc0ee615ee06ca4ec831a.png"><br><br><h5>  5. SAP Versions </h5><br>  We checked which versions of the ABAP and J2EE engines are most often present on the Internet in order to understand the life cycle of SAP products and find out which versions of products are currently popular.  We also checked which OS and RDBMS are used in conjunction with SAP systems most often. <br><br><h6>  5.1.  ABAP engine versions </h6><br>  To find out the versions of ABAP, we connected to the root of the application server and analyzed HTTP responses.  We also took advantage of the information disclosure vulnerability.  The SAP NetWeaver version can be easily recognized if the application is configured insecurely and allows an attacker to extract information from / sap / public / info. <br><br>  After scanning all the available SAP NetWeaver ABAP servers, it was discovered that 59% of them are vulnerable to information disclosure. <br><br>  The best security settings, such as disabling access to all BSPs, are available by default in the EHP 2 update, but EHP 2 is installed on only 11% of servers.  This means that, even though SAP itself is concerned about the security of its systems, without the participation of system administrators, the efforts of developers are useless. <br><br>  The most popular version (45%) is NetWeaver 7.0, and in fact it was released in 2005! <br><br><img src="https://habrastorage.org/storage2/bbe/17a/1f6/bbe17a1f6610522848805a5e22034ab7.png"><br><br><h6>  5.2.  J2EE engine versions </h6><br>  J2EE version information can be easily found by reading the HTTP response.  However, detailed information about the patch version is available if the application server is <a href="http://erpscan.com/advisories/dsecrg-11-023-sap-netweaver-sld-information-disclosure/">configured incorrectly</a> and allows an attacker to view information from certain pages.  For example, these two pages reveal information about the J2EE engine: /rep/build_info.jsp and /bcb/bcbadmSystemInfo.js. <br><br>  After scanning all the available SAP NetWeaver J2EE servers, it turned out that 62% of them are vulnerable to information disclosure through the /rep/build_info.jsp page and 17% through the /bcb/bcbadmSystemInfo.jsp page. <br><br>  Detailed information on product versions is presented below. <br><br><img src="https://habrastorage.org/storage2/a5d/00e/045/a5d00e0450110248ba27b5b2342c6b58.png"><br><br><h6>  5.3.  Popular OS for SAP </h6><br>  Using the page / sap / public / info, you can get information about the OS versions where ABAP is deployed.  Analysis of the search results for SAP systems that have access to the Internet showed that the most popular operating systems are Windows NT (28%) and AIX (25%).  Our statistics, compiled during the SAP internal auditing process, shows the great popularity of * .NIX systems, although Windows is leading in systems connected to the Internet. <br><br><img src="https://habrastorage.org/storage2/7ea/842/bcb/7ea842bcb8ad45e886c90e81b7dddf34.png"><br><br><h6>  5.4.  Popular DBMS for SAP Backend </h6><br>  The most popular DBMS is still Oracle - 59%.  Other DBMSs are listed below. <br><br><img src="https://habrastorage.org/storage2/33b/84d/be1/33b84dbe13bd91cd95a1cba2125009bf.png"><br><br>  It is worth noting that the Oracle DBMS installed together with SAP is vulnerable to a very dangerous <a href="http://www.lan-ks.de/~jochen/sap-r3/ora-hack-en.html">attack</a> , where authorization costs and an unauthorized user gets direct access to the database without any authentication data, due to the incorrect use of the REMOTE_OS_AUTHENT parameter.  This is a very old problem, published back in 2002, but it is still relevant. <br><br><h5>  6. Critical Internet Services </h5><br>  In addition to web interfaces that need to be available on the Internet due to various business requirements, such as SAP Portal solutions, SAP SRM or SAP CRM, there are services that should not be accessible from the outside.  They not only carry potential risk, but also have real vulnerabilities and configuration errors, which are well known and well described in public sources.  Of course, we do not provide a complete list of critical SAP services, only the most popular ones.  About 1000 subnets of companies using SAP were scanned.  The graph shows the percentage of companies where critical SAP-services were open for remote access. <br><br><img src="https://habrastorage.org/storage2/53f/912/d62/53f912d628db1e6a63d04504a23d4b3b.png"><br><br>  It is easy to notice that the most popular service is SAP Router, and this is normal, because its purpose is to be open to remote connections.  But what about the other services?  They should not be available via the Internet, however they are available.  And the number of them is not as small as we assumed before the start of the project. <br><br><h6>  6.1.  WebRFC service as part of NetWeaver ABAP </h6><br>  WebRFC is a default web service available on the SAP NetWeaver ABAP platform.  It allows you to perform dangerous RFC functions using HTTP requests to the NetWeaver ABAP port and to the / sap / bs / web / rfc page.  Some of these functions are critical, for example: <br><br>  ‚Ä¢ Reading data from SAP tables <br>  ‚Ä¢ Creating SAP users <br>  ‚Ä¢ Running OS commands <br>  ‚Ä¢ Financial transactions, etc. <br><br>  By default, any user has access to this interface and the ability to execute the RFC_PING command by sending an XML packet.  Additional authorizations are required to perform other functions.  Thus, there are two main risks: <br><br>  ‚Ä¢ If the system has a default user with a pre-set password, an attacker can perform many dangerous RFC functions, because users have fairly dangerous permissions by default. <br>  ‚Ä¢ If a hacker finds out remotely the authentication data of any existing user, he can execute a denial of service <a href="http://erpscan.com/advisories/dsecrg-11-029-sap-netweaver-soap-rfc-%25E2%2580%2593-denial-of-serviceinteger-overflow/">attack by</a> sending an RFC_PING request with a modified XML package. <br><br>  It was found that the WebRFC service is included in 40% of ABAP systems. <br><br>  <i>We did not check whether standard passwords are used in these systems, but in accordance with various statistics collected during our research and research of colleagues, one or more accounts have a default account in 95% of the systems.</i> <br><br><h6>  6.2.  CTC service as part of NetWeaver J2EE </h6><br>  CTC, or ConfigTool, is the default web service installed on the NetWeaver J2EE engine.  It allows you to remotely control the J2EE engine.  This web service can be found through Google, and it is often found in SAP Portal systems.  It is possible to perform such functions as: <br><br>  ‚Ä¢ Creating users <br>  ‚Ä¢ Assigning Roles to Users <br>  ‚Ä¢ Running OS commands <br>  ‚Ä¢ Remotely enable and disable the J2EE engine <br><br>  Digital Security researchers have discovered a vulnerability in this service called <a href="http://erpscan.com/wp-content/uploads/2011/08/A-crushing-blow-at-the-heart-SAP-J2EEengine_whitepaper.pdf">Verb Tampering</a> .  It allows you to bypass authorization checks when accessing the CTC service remotely.  This means that anyone can remotely get full unauthorized access to all business-critical information located in the J2EE engine. <br><br>  It was found that CTC was enabled on 61% of J2EE systems on the Internet. <br><br>  <i>We did not check whether these systems are vulnerable, but our experience with penetration tests shows that about 50% of the systems are potentially vulnerable.</i> <br><br><h6>  6.3.  SAP Message Server HTTP </h6><br>  The SAP Message Server HTTP is the HTTP port of the SAP Message Server service that allows you to balance the load on SAP application servers.  Usually this service is available only within the company, however, in some systems external IP addresses were discovered that, as a rule, are not needed to perform business tasks and at the same time can lead to performing critical actions in the system.  By default, the SAP Message Server listens on port 80NN, where NN is the system number.  One of the problems of SAP Message Server HTTP is the ability to get the values ‚Äã‚Äãof the configuration parameters of the SAP system remotely without authorization.  They can be used for further attacks. <br><br>  A scan of a sample of 1000 subnets of companies using SAP found 98 Message Server HTTP open access systems.  Approximately every 10th company is vulnerable to unauthorized collection of system parameters remotely via the Internet;  most of them are located in China (55%) and India (20%). <br><br><h6>  6.4.  SAP Management Console </h6><br>  SAP HostControl is a service that allows you to remotely monitor SAP systems.  Its main functions are remote on and off, to use them you need to know your login and password.  ,  ,   ,    .        ,      .          <a href="http://www.sdn.sap.com/irj/scn/go/portal/prtroot/docs/library/uuid/4e515a43-0e01-0010-2da1-9bcc452c280b%3FQuickLink%3Dindex%26overridelayout%3Dtrue%2642472931642836"></a>    (Chris John Riley),  . <br><br>    <a href="http://erpscan.com/wp-content/uploads/2012/06/Top-10-most-interesting-vulnerabilities-and-attacksin-SAP-2012-InfoSecurity-Kuwait.pdf"></a>  Digital Security          JSESSIONID. JSESSIONID ‚Äì  ,   HTTP.           JSESSIONID   cookie -       . <br><br>    ,       , ,   9%   SAP Management   .    548.   11-    ,          . <br><br><h6>  6.5.  SAP Dispatcher </h6><br> SAP Dispatcher ‚Äì    -   SAP.     SAP NetWeaver    SAP GUI   DIAG.  SAP Dispatcher       ,              . <i>:    Dispatcher,    WEB Dispatcher, , ,     .</i> <br><br>   ,  1000 ,   832  SAP Dispatcher,    ,  15% .  6-    DoS-         SAP Dispatcher. <br><br>   ? <br><br> -,       SAP-    SAP GUI,     ,     .   SAP   ,        ,     95% . <br><br>  ,      Core Security,   ,   SAP Dispatcher     ,       ¬´  ¬ª,        <a href="http://blog.coresecurity.com/2012/05/09/core-labs-discovery-of-six-vulnerabilities-within-sapnetweaver/"></a>  . 9     ,         -   .  , ,  ,         DIAG   2  3 ‚Äì    .        ,       . <br><br><h5> 7.  </h5><br>   ,     SAP    .         SAP,   ,  ,   SAP          (  APT),       ¬´¬ª,       . <br><br>        SAP Security Response Team        ,     ,   .  SAP        SAP-,         .      SAP       ,     ,  ,   ,        ABAP    . </div><p>Source: <a href="https://habr.com/ru/post/146967/">https://habr.com/ru/post/146967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146961/index.html">Mozilla makes its mobile OS under the brand Firefox</a></li>
<li><a href="../146962/index.html">Comparison of Google Search in Android 4.1 and Siri</a></li>
<li><a href="../146964/index.html">A critical view from the side on processors Multiklet / Multiclet</a></li>
<li><a href="../146965/index.html">Declaration of Freedom on the Internet</a></li>
<li><a href="../146966/index.html">Build Hifidiy Mini USB DAC Mk2 Kit</a></li>
<li><a href="../146969/index.html">Mirroring webinar with Cach√© and Ensemble: High Availability and Backup</a></li>
<li><a href="../146971/index.html">Scalaxy closes Xen cloud</a></li>
<li><a href="../146973/index.html">Great rake webinar in internet marketing</a></li>
<li><a href="../146974/index.html">Activision Blizzard sells for $ 8.1 billion</a></li>
<li><a href="../146975/index.html">Do you still think that plugging a pair of wires into the Arduino is DIY?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>