<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Own browser - the way the mouse: Theory</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, you decided to raise your browser. 

 You understand all the accompanying nuances and behavior of the Browser Administrator: habrahabr.ru/post/249...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Own browser - the way the mouse: Theory</h1><div class="post__text post__text-html js-mediator-article">  So, you decided to raise your browser. <br><br>  You understand all the accompanying nuances and behavior of the Browser Administrator: <a href="https://habrahabr.ru/post/249625/">habrahabr.ru/post/249625</a> <br>  You clearly realize that the only reasonable option, why it is worth harnessed in is self-development, and this is not the best way: <a href="https://habrahabr.ru/post/249705/">habrahabr.ru/post/249705</a> <br><br>  Mice prick and cry, but continued to eat the cactus ... <br><a name="habracut"></a><br>  Okay.  In your tenacious paws got some browser engine downloaded from an Internet.  At best, it will be an open source with a good number of forks (that is, free from ‚Äúchildish problems‚Äù).  Perhaps it will be so-called.  ‚ÄúDump‚Äù - i.e.  merged from a live commercial server engine with a database dump.  But most likely - it will be another "hack on the subject."  Here we will stop on the last case - because the minimally necessary actions are common for all three cases. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here I implicitly assume that your engine is based on PHP + MySQL.  It is for this bunch that I will lead the further story.  If you have an unexpected Python + PostgressSQL - do not worry.  The fundamental principles of working with such engines are identical - only the implementation is different. <br><br>  What do you need to do first with the engine?  It is not so easy to answer this question without familiarizing yourself with the basic principles of working with data inside the browser engine (and indeed, any site or even any program).  These principles are few and very simple. <br><br><h1>  Data from the user is toxic. </h1><br>  DO NOT TRUST THE USER INPUT! <br>  All data coming from the user is considered to be ‚Äútoxic‚Äù by definition - i.e.  wrong, invalid or even malicious until the opposite is proven.  This means that all data from the user must be checked on the server side. <br><br>  Do you think that you have a wonderful JavaScript validator that will not miss incorrect data to the backend?  MISTAKE!  Any request from the frontend (the part that is directly visible to the user and is responsible for interacting with it) of your engine can be falsified - so the backend (the part that performs actual data processing on the server side and writes the changes to the database) MUST always repeat the frontend calculations, to be sure that you did not feed the bullshit. <br><br><h1>  Data normalization </h1><br>  All operations inside the frontend and backend should be performed on the source data with minimal conversion.  A little incomprehensible? <br><br>  Well, for example, you have a sequence of characters, which in fact is a multi-line text.  It seems to be nothing complicated and everything is obvious, right?  MISTAKE!  The string can be obtained from an external file. <br><br>  Here immediately begin dancing with a tambourine about the newline character.  Indeed, in different systems the end of the line is encoded differently.  Files of Unix-like systems beat off a new line with the LF (Line Feed, ASCII 0x0A) symbol.  Older systems (MacOS up to version 9, Commodore and some more) loved to end the line with the CR symbol (Carriage Return, ASCII 0x0D).  The most desktop OS of Windows (as the heir of MS-DOS) adore the combination CR + LF - and in that order! <br><br>  And here comes the great HTML, for which everything outside of the ‚Äúpre‚Äù tag (and other similar tags) is the essence of one line.  And line breaks are done with the <code>&lt;br&gt;</code> tag.  Which, of course, correctly spelled as <code><br></code>  .  Allowed the same <code>&lt;br/&gt;, <br></code> <code>&lt;br/&gt;, <br></code>  etc <br><br>  The problem with normalizing strings is not mentioned in vain first.  Usually incorrect row normalization does not give critical errors - but most often it is visible to players.  It‚Äôs nice to see something like instead of text-formatted text <br>  <code> 1\r\n 2\r\n 3</code> ?  Or even <code> 1 <br>  2 <br>  3</code> <code> 1 <br>  2 <br>  3</code>  <code> 1 <br>  2 <br>  3</code> , which happens when there is a simultaneous error in data normalization and output formatting. <br><br>  The numbers are not without similar problems.  It would seem - what could be simpler than numbers?  intval () and floatval () (and their counterparts in JavaScript - however, this is a separate conversation. JS allows you to shoot yourself in the foot in many sophisticated ways ...) should solve all the problems, right?  MISTAKE! <br><br>  What number is obtained in a variable, if in the PHP backend we write intval (0123)?  Think - 123?  Well, then go ahead, read the manual: <a href="http://php.net/manual/ru/language.types.integer.php">php.net/manual/ru/language.types.integer.php</a> <br><br>  A separate song is floating point numbers in PHP and their comparison.  This is not a lesson in PHP - so again I‚Äôll refer to the documentation: <a href="http://php.net/manual/ru/language.types.float.php">php.net/manual/ru/language.types.float.php</a> . I suggest paying special attention to the insertion ‚ÄúAccuracy of floating-point numbers‚Äù and subsection ‚ÄúComparison of floating-point numbers‚Äù . <br><br>  It is unlikely that this will be relevant at the first stage of development, but to understand the importance of data normalization I cannot but mention a separate interesting issue of identifiers in the database.  Well, these are the funniest numbers declared as BIGINT (20) in the database and defining the uniqueness of each record. <br>  To fully understand the essence of the problem - again refer to the PHP documentation <a href="http://php.net/manual/ru/reserved.constants.php">php.net/manual/ru/reserved.constants.php</a> Search the text for the keyword PHP_INT_MAX.  Count the number of characters.  Compare with the description of the database structure above.  Hint - in MySQL, this declaration means a number with 20 significant characters to the comma.  If you work carelessly with such an identifier in PHP or JS code, it can easily contact the float with a loss of accuracy. <br><br>  What conclusion can be drawn from all the above?  Data should be NORMALIZED - i.e.  given to some kind of standardized form, which will be perceived by your engine from now on and everywhere.  Usually the author (s) of the engine implicitly choose any one form of normalization.  Unfortunately - the same author (s) observe it by no means always and everywhere. <br><br><h1>  Escaping Output </h1><br>  You will be surprised how often the game will need to display data for the players!  Here we are also waiting for a bunch of interesting revelations. <br><br><h2>  HTML output </h2><br>  The most important rule is this: ANY output to HTML of uncontrolled data should be made exclusively through the function htmlentities () <a href="http://php.net/manual/ru/function.htmlentities.php">php.net/manual/ru/function.htmlentities.php</a> !  Once again I emphasize - ANY!  WITH NO EXCEPTIONS! <br><br>  Here it should be noted that the data in the engine are divided into "controlled" and "uncontrolled."  The first group includes such entities as simple localization strings, guaranteed normalized integers, guaranteed normalized single-line strings, and ... perhaps everything.  All other data are ‚Äúuncontrollable‚Äù and must pass through a small sieve htmlentities ().  Yes, this seems to be an unnecessary complication - but in the future it will at least save you from damaging the type of game, and as a maximum - to a certain extent guarantees the impossibility of infecting the player‚Äôs computer with hostile scripts (100% guarantee is provided only by Gosstrakh). <br><br>  Here it is worth making a digression and talk in detail about each type of monitored data. <br><br><h3>  HTML Controlled Data </h3><br>  Let's start with the simplest - with guaranteed normalized integers.  These include $ variable variables that are_int ($ variable) checked for 'true'.  Stupid.  Straight.  Head-on.  100% guarantee that these variables in the output will consist of only decimal digits, do not contain anything extraneous and look equally beautiful in HTML and JS. <br><br>  Simple localization strings are strings from the current locale, which consist of one line, do not contain HTML tags, do not contain special HTML characters like &lt;&gt; "', line breaks, are not regexps and are not templates. Here, too, everything seems to be clear from the first Looks. It seems that the localization line is completely controlled by the engine developer. It seems that there should be no pitfalls - and all these specifications are superfluous ... WRONG! <br><br>  The most common mistake is to use the ‚ÄúStart of line% s remaining line‚Äù line patterns with the subsequent use of the sprintf () function.  We remember that our data should be normalized, i.e.  reduced to standard format.  But nowhere is it said that the normal format is safe for at least something!  Normalization of the format of variables only guarantees the uniformity of the type of data processed in different pieces of code - and nothing more.  Whether the data is safe for output in HTML or (especially!) For writing to the database is unknown to us (generally known, by definition, they are not).  Therefore, direct data output to the template without specifying additional modifiers is not allowed.  Moreover, not every modifier guarantees safe data output. <br><br>  I note - here we are talking about the security of the conclusion, and not about correctness.  For example, the output of a variable to the template "% d" is safe, but not correct - if, for example, a string is supplied to the input that cannot be reduced to a integer.  Here again, I can not not refer to the documentation: <a href="http://php.net/manual/ru/function.sprintf.php">php.net/manual/ru/function.sprintf.php</a> <br><br>  In normal cases, all localization strings should be guaranteed to be simple.  However, the ideal is what it aspires to, but at the same time that which is unattainable in reality. <br><br>  Practical aspects and calculations of labor costs say that sometimes you have to do non-simple localization lines ‚Äî for example, add HTML formatting directly to a line.  I think that this is acceptable as long as the developer is aware of all the risks and controls the use of unconventional localization strings. <br><br>  Why guaranteed normalized lines should contain only one line / paragraph - it should be clear from the read above.  But just in case, I repeat - multi-line strings (even normalized) require a different attitude when outputting to HTML, JS, or when saved to a database. <br><br><h3>  Uncontrolled HTML data </h3><br>  Above, we looked at three types of controlled data, which (with reservations) can be displayed directly in HTML, bypassing the htmlentities () function.  All other data MUST be passed through the above function!  However, there are nuances. <br><br>  In fact, the ‚Äúuncontrolled data‚Äù is user data, or strings that do not fit the above criteria.  How to work with user data will be described in detail in the next article.  And working with engine lines (in particular, localization) is quite a delicate topic. <br>  Depending on the quality of the original product, the principles of working with strings, the source of which is the engine itself, can be very different.  I can only give recommendations - which in no case should not be a dogma.  A lot depends on how the engine describes multi-line data in general and localization strings in particular. <br><br>  1. If the engine uses CR, LF or a combination of CR + LF to separate lines in the text - first use htmlentities (), and then the PHP function nl2br () <a href="http://php.net/manual/ru/function.nl2br.php">php.net/manual/ru/function.nl2br.php</a> <br>  2. If the engine uses a tag to separate lines <code><br></code>  - output data directly if you have completely checked the code and are confident in its security <br>  3. All output templates using the format "% s" and the like - always MUST go through htmlentities ()! <br><br>  In any case, it is ALWAYS necessary to remember the fundamental principle - it is better to bring the player to an ‚Äúugly‚Äù, but guaranteed safe line, than to remove ‚Äúbeauty‚Äù in 99.99%, and in 0.01% to infect the player‚Äôs computer with a malicious script. <br><br>  In the following article: <br>  - Data output in JavaScript - features and jokes; <br>  - Writing data to the database - how not to ‚Äúget‚Äù on SQL-injection; <br>  - How to make sure that the data from the user are not "toxic"; <br>  - ‚Ä¶ and much more </div><p>Source: <a href="https://habr.com/ru/post/275767/">https://habr.com/ru/post/275767/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275755/index.html">Query Processing in Oracle and PostgreSQL: Implications of a Single Solution</a></li>
<li><a href="../275757/index.html">How to safely store and use secret data in R</a></li>
<li><a href="../275759/index.html">Highly accurate coordinates (+ -2cm) for virtual reality, kopter and robots</a></li>
<li><a href="../275761/index.html">Script automatic update DDNS for No-IP</a></li>
<li><a href="../275765/index.html">Considering difference schemes in Mathcad Express</a></li>
<li><a href="../275769/index.html">Work with geolocation in iOS 24/7</a></li>
<li><a href="../275771/index.html">Pets vs cattle</a></li>
<li><a href="../275779/index.html">Microsoft sent a request for appruv ChakraCore support implementation in Node.js along with the V8 engine</a></li>
<li><a href="../275781/index.html">The digest of interesting materials for the mobile developer # 137 (on January 18-24)</a></li>
<li><a href="../275783/index.html">Swift improve performSegueWithIdentifier or convenient router with storyboards</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>