<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Theory and practice of passive pyroelectric sensors or how to make an indicator of the direction of movement</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our imperfect world, various technical things are highly demanded, designed to guard the property and tranquility of citizens. Therefore it is diff...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Theory and practice of passive pyroelectric sensors or how to make an indicator of the direction of movement</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/70a/3b3/6bd/70a3b36bdc8ec6edaec38d819000c1dc.jpg"><br>  In our imperfect world, various technical things are highly demanded, designed to guard the property and tranquility of citizens.  Therefore it is difficult, I believe, to find a person who would never see security alarms equipped with motion sensors.  The physical principles of their work, as well as the implementation may be different, but it is probably the most common pyroelectric passive infrared sensors (PIR). <br><br><div class="spoiler">  <b class="spoiler_title">Some such:</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/ceb/321/6f1/ceb3216f18901f244701dcf384476af2.jpg"><br></div></div><br><br>  They react to changes in radiation in the infrared range, namely in its middle part - 5-15 microns (the body of an average healthy person radiates in the range of about 9 microns).  From the point of view of the end user, the piece is very simple - a power input (usually 12 volts) and a relay output (usually solid-state and with normally closed contacts).  Somebody sneaked past by - the relay worked.  Boredom.  But inside is not so simple. <br>  Today we will devote a little time to theory, and then gut one such device and make it not just a sensor that reacts to the fact of movement, but records the direction of movement. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  Some theory </h4><br>  Some crystalline substances have the property of polarizing under the action of radiation incident on them.  With a change in the intensity of radiation, the polarization also changes, and, consequently, the electric field intensity in the crystal.  Hence the name - pyroelectrics.  Further, by measuring the potential difference between different points of the crystal, it is possible to judge the magnitude of the radiation.  True, the potential difference arising is rather quickly compensated by ‚Äústicking‚Äù to the crystal with charged particles, which are sufficient in the surrounding space.  For this reason, pyroelectric is not very suitable for measuring the constant intensity of radiation.  This is precisely the change in radiation that can be recorded.  But for the purposes in which such sensors are used - motion fixation, this is what is needed. <br>  It seems simple, but there is a small problem.  We are not interested in changing radiation at all, but it is interesting to change it because of the intruder‚Äôs passage.  But the sun rises and sets, summer gives way to winter, heating is turned on and off, and the infrared radiation falling on the sensor varies within very large limits, although no one has thought to encroach on our property.  It is clear that the practical value of the device that reacts to anything, is close to zero.  Bypassing this trouble is quite simple - instead of one sensitive element, two are used.  Including them in a chain consistently so that changes in tension on them occur in opposite directions.  And constructively arranging so that the ‚Äúglobal‚Äù change in the level of infrared radiation (say, with a change in air temperature) affects them equally, and the ‚Äúlocal‚Äù (movement of an object like a person) in a different one.  To make it clearer, let's move on to an illustration (the drawings are intentionally made by hand, in order to somewhat diversify the dominance of computer graphics). <br><img src="https://habrastorage.org/storage2/8fa/77a/784/8fa77a7849d0f7f7b1ef40b125bac9dc.gif"><br>  Inside the metal case (shown in blue) are placed two pyroelectric crystals.  For the measured radiation in the body there is a window closed by a filter (red), which passes only the wavelength range we need.  In front of the window is placed the optical system (green), forming the desired radiation pattern of the sensor.  Biconvex lens is drawn, of course, conditionally.  Real sensors use Fresnel lenses stamped on plastic (transparent in the necessary frequency range, of course).  Like these ones: <br><img src="https://habrastorage.org/storage2/900/ed8/4b1/900ed84b145314cf5aea304f3209e02f.jpg"><br>  About lenses more later. <br>  Right next to the crystals inside the case (in order not to lose the measured value in the "long road"), a field effect transistor is placed, the drain and source of which are already brought outside.  Field transistor for good reason.  This device, as is known, is controlled by an electric charge, the change of which on a crystal is actually measured by us.  The bipolar transistor here would absolutely not fit, as a device controlled by a current, which the pyroelectric can not issue.  The resistor is needed to drain parasitic static charges, although it somewhat degrades the sensitivity of the device. <br>  Now about the lenses.  Without lenses, the sensor has a very wide radiation pattern - 100-120 ¬∞ vertically and horizontally.  At the same time (conditionally) one half of the space is ‚Äúseen‚Äù by one crystal, the other - by the other.  Those.  it turns out such a cone, cut by a plane, the direction of which depends on the relative position of the crystals.  Usually this plane is vertical.  With the help of a lens, two relatively narrow ‚Äúbeams‚Äù of the radiation pattern are formed from the two resulting half-cones.  This increases the distance sensitivity of the sensor and reduces parasitic noise.  However, the narrowness of the diagram leads to the ability of the intruder to easily bypass the sensitive areas.  To prevent this from happening, the lenses make several (this is just seen in the photo above) and, accordingly, form several pairs of rays.  Their appearance and number depend on the field of application of the sensor.  Let's say for the corridors you need to "see" narrowly, but far.  For square rooms - close and wide.  Somewhere you need to protect the area under the sensor, somewhere above it, etc. But this is all not important, so we will focus on one pair of rays that a moving warm object crosses. <br><img src="https://habrastorage.org/storage2/164/faa/da0/164faada0d9f5cd84c1be00b641ba1d3.gif"><br>  As it moves, the object will fall into the field of view of a single crystal, and it will form a voltage pulse in accordance with changes in the level of infrared radiation.  When an object falls into the field of view of another crystal, it will also generate an impulse, but of a different direction (we remember that the crystals are included in the opposite polarity).  If an object crosses several pairs of rays, then this whole process will repeat. <br><img src="https://habrastorage.org/storage2/d36/9bc/89c/d369bc89c479844582b0a86adcb3bd2a.gif"><br><blockquote>  <i>Note: Due to the fact that the power supply of the sensor, as a rule, is unipolar, one cannot speak of a positive and negative impulse.</i>  <i>You can only talk about the change in voltage up or down from a certain average value of "rest", depending on the parameters of the sensor, its switching circuit, and the state of the environment.</i>  <i>But for the sake of convenience, we will speak about negative and positive impulses.</i> </blockquote><br>  From this point on, it becomes clear how to determine the direction of movement.  If a positive impulse is recorded first, and then a negative one, then the direction is one; if, on the contrary, it is another.  However, in the household sensors, which we are talking about, this property is not used.  But then we fix it. <br>  It is impossible to use the signal directly from the sensor - it is too small, and its average value ‚Äúfloats‚Äù within wide limits.  The signal needs to be strengthened, and hundreds of thousands of times, to get rid of the mean value drift and convert to a discrete form ‚Äî there is movement / no movement.  A typical block diagram of a motion sensor that solves these problems has the following form: <br><img src="https://habrastorage.org/storage2/091/bbd/12d/091bbd12dc13c7fdcf334bc35bd67b4c.gif"><br>  The weak signal of the sensor is amplified and fed to a pair of comparators, one of which records the excess of the specified amplitude with a positive pulse, the second - with a negative pulse.  An already discrete signal from the comparators is sent to the actuator.  The last one is usually the waiting multivibrator, which for some fixed time turns on the relay, and then it already opens / closes the security loop.  In more advanced sensors, instead of comparators, there can be more complex schemes that provide protection against false alarms, sharp fluctuations in environmental parameters, actuations from the movement of small animals, additional reaction to a fire, etc. In most modern sensors, all this is not done by analog circuits and DSP. <br>  However, to achieve this goal, we will be interested only in what is up to the comparator.  Those.  the amplifying part, and more specifically, the output of the already amplified signal of the pyroelectric sensor.  In order to be able to find this place in the disassembled sensor, let's see what needs to be looked for.  And you need to search first of all the op-amp chips (OU), located near the sensor. <br>  A typical amplifier circuit looks like this (drawn approximately, since variations of specific versions are not considered): <br><img src="https://habrastorage.org/storage2/ad3/97e/68f/ad397e68fd102517f38c644585e1a48d.gif"><br>  In this case, the first stage is a non-inverting amplifier, the second inverting.  The gains of each of them are about tens of thousands, and both are of the order of hundreds of thousands.  But the main ‚Äúsecret‚Äù is that the OU feedbacks contain elements (namely, capacitors) that make these connections dependent on frequency.  The element ratings are such that near zero frequency (direct current), the overall gain tends to zero, near the frequency of 5 hertz there is a gain maximum, and at frequencies above 10 hertz again tends to zero.  This frequency response is not random.  The size of the area that captures our pair of rays, about 0.5-1 meters.  The speed of movement of a person is about 1-3 m / s.  Accordingly, the frequency of intersection of sensitive zones will be just units of hertz.  And the signals lying outside this range can be considered parasitic.  Including the drift of the constant component of the signal.  Those.  in the giblets of the sensor you need to look for something like the output of the second gain stage. <br><br><h4>  Go to the practical exercises. </h4><br>  Having armed with theoretical information we will get a soldering iron.  The photo shows a disassembled sensor (removed the front cover with Fresnel lenses and a metal screen). <br><img src="https://habrastorage.org/storage2/18c/509/428/18c5094283b5670b680af3a58139e33e.jpg"><br>  We look at the marking of the closest to the pyroelectric sensor (a round metal with a window - this is it) of the microcircuit and (oh, good luck!) It turns out to be the LM324 - quad op amp.  By looking at the surrounding elements, we find the output of an opamp that is most likely suitable for our purposes (in my case, this turned out to be output 1 of the microcircuit).  Now it would be nice to check, and whether we found.  Usually, an oscilloscope is used for this.  I did not have it at hand.  But it turned out to be arduino.  Since the signal level after amplification is of the order of units of a volt, and we don‚Äôt need special measurement accuracy (a sufficiently qualitative assessment), the Arduino ADC inputs are fine.  To the found OU output and the power supply minus we solder the wiring and output it to the layout board.  Wires should not be long.  Otherwise, there is a chance to measure not the sensor signal, but something completely different. <br>  Now let's think about how fast the signal needs to be read in order to get something sane.  Above it was said that the frequency range of the useful signal is limited to approximately 10 Hz.  Recalling the Kotelnikov theorem (or Nyquist - who likes what more), we can conclude that there is no sense in measuring the signal with a frequency higher than 20 Hz.  Those.  A sampling period of 50 ms is fine.  We write a simple sketch that reads port A1 every 50 ms and dumps its value into the series (strictly speaking, signal measurements occur less frequently than 50 ms, since it also takes time to write to the port, but for our purposes this is not important). <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> time; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); pinMode(A1, INPUT); time=millis(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis()-time) &gt;= <span class="hljs-number"><span class="hljs-number">50</span></span>) { Serial.println(analogRead(A1)); } time=millis(); }</code> </pre> <br><br>  We turn on and wave our hands in front of the sensor (you can run, even more useful).  On the side of the computer, the data from the port is dumped into a file. <br><pre> <code class="bash hljs">stty -F /dev/ttyUSB0 raw ispeed 9600 ospeed 9600 -ignpar cs8 -cstopb -<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> cat /dev/ttyUSB0 &gt; output.txt</code> </pre><br>  Build a graph (a column with numbering counts has been added to the file): <br><pre> <code class="bash hljs">gnuplot&gt; plot <span class="hljs-string"><span class="hljs-string">"output.txt"</span></span> using 1:2 with lines</code> </pre><br><img src="https://habrastorage.org/storage2/0b3/5d3/263/0b35d3263e2ab142c9bd5f8ee9e1f2c6.gif"><br>  And we see what, in fact, wanted to - bipolar voltage surges.  Hooray, the theory works and the wire is soldered where necessary.  A simple analysis (in other words, a review) of the graph allows us to conclude that the deviation of the signal by 150 units from the average value can be considered as a more or less reliable fixation of the presence of motion. <br>  It is time to finally make the direction sensor. <br>  Modify the scheme.  In addition to the analog signal of the sensor, we will connect a pair of LEDs to Arduino (ports 2 and 3, do not forget the current-limiting resistors) and write a slightly more complex sketch. <br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> state2=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> average=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> time; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, OUTPUT); pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, OUTPUT); pinMode(A1, INPUT); digitalWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, LOW); digitalWrite(<span class="hljs-number"><span class="hljs-number">3</span></span>, LOW); delay (<span class="hljs-number"><span class="hljs-number">30000</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    //    30 . time=millis(); //      //    //      while (n &lt;= 1000) { ++n; a1=analogRead(A1); average=average+a1; delay(50); } average=average/1000; //   //,    digitalWrite(2, HIGH); digitalWrite(3, HIGH); delay(1000); digitalWrite(2, LOW); digitalWrite(3, LOW); time=millis(); } void loop() { //   50  if ((millis()-time) &gt;= 50) { //     //     -1/0/1 a1=(analogRead(A1)-average)/150; //    ,  //   switch (a1) { case 1: if (state2=-1) {digitalWrite(2, HIGH);digitalWrite(3, LOW);} state2=a1; break; case -1: if (state2=1) {digitalWrite(2, LOW);digitalWrite(3, HIGH);} state2=a1; break; } //  time=millis(); } }</span></span></code> </pre><br></div></div><br>  In order to leave only one pair out of the entire set of rays of the radiation pattern of the sensor, we close all but one Fresnel lens with a paper screen. <br><img src="https://habrastorage.org/storage2/ca8/5d8/cef/ca85d8cef692fdbbc4632b5dd5a0a722.jpg"><br>  Enjoying the result. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/R2HEzEsDfTs%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700190,15700253,15700259&amp;usg=ALkJrhi5lA28Pcv0Oms7EzqnjcGUKIN_8Q" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/167201/">https://habr.com/ru/post/167201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167179/index.html">Avast! opens the hunt for mistakes</a></li>
<li><a href="../167181/index.html">Functional PHP programming</a></li>
<li><a href="../167187/index.html">ITU officially approved draft of H.265 video compression standard</a></li>
<li><a href="../167195/index.html">How technology and social sciences help plan</a></li>
<li><a href="../167199/index.html">Counter-Strike 1.6 is available for Linux</a></li>
<li><a href="../167203/index.html">NASA in Russian: # 2 video digest about space</a></li>
<li><a href="../167205/index.html">Copyright Reform Proposals submitted by MEP Christian Engstr√∂m</a></li>
<li><a href="../167209/index.html">Easy management of your Arduino via the web</a></li>
<li><a href="../167211/index.html">Ultra-compact, highly integrated x86 board from AMD</a></li>
<li><a href="../167213/index.html">Eliminating asymmetric routing in Juniper SRX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>