<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using drivers from the Android application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Route gives almost absolute power over the Android device. Today I will tell you how to get even more inclined to programming and the desire to explor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using drivers from the Android application</h1><div class="post__text post__text-html js-mediator-article">  Route gives almost absolute power over the Android device.  Today I will tell you how to get even more inclined to programming and the desire to explore the system on your device.  Who is interested - I ask under the cat. <br><a name="habracut"></a><br>  Well, let's start in order. <br><h5>  What is necessary </h5><br><ol><li>  Minimum knowledge of C. </li><li>  Minimal knowledge of Java. </li><li>  Some insight into how the elements of the Android system interact. </li><li>  Rutted Android phone. </li><li>  IDE with support for Android SDK / NDK (in my case eclipse, it is very easy to configure to work with Android and described it many times). </li><li>  Tulchain for the cross-compilation of which the kernel was assembled on the target device. </li><li>  Assembled core for our device with the correct local version. </li></ol><br><br>  It is worth saying that I used Linux OS Ubuntu 11.10 and I will give all the examples for it. <br>  The first 3 points are obvious, how to achieve 4 and 5 is easy to find on the Internet.  Consider the last two in detail. <br><br><h6>  Choosing a toolchain for cross-compiling kernel modules (drivers) </h6><br>  In this article we do not consider the possibility of flashing a personally assembled kernel on your phone, so we must follow certain rules. <br>  In order to find out how the compiler builds the kernel on our device, execute the command: <br><pre><code class="bash hljs">cat /proc/version</code> </pre> <br>  using any terminal emulator or using adb utility: <br><pre> <code class="bash hljs">adb shell <span class="hljs-string"><span class="hljs-string">"cat /proc/version"</span></span></code> </pre><br>  As a result, we get a string like this: <br><pre> <code class="bash hljs">Linux version 3.0.69-g26a847e (blindnumb@iof303) (gcc version 4.7.2 20120701 (prerelease) (Linaro GCC 4.7-2012.07)) <span class="hljs-comment"><span class="hljs-comment">#1 PREEMPT Mon Mar 18 12:19:10 MST 2013</span></span></code> </pre><br>  We see that we have installed the kernel version 3.0.69 of the local version "-g26a847e" and compiled it with the linaro GCC 4.7-2012.07 toolchain.  Knowing the version we find the necessary toolchain and unpack it into any folder.  My path looked like this: <br><pre> <code class="bash hljs">/home/user/android/android_prebuilt_linux-x86_toolchain_arm-gnueabihf-linaro-4.7</code> </pre><br><h6>  Kernel build </h6><br>  To begin, let us know which core our device uses.  This can be done by executing the command indicated above or by entering the settings in the section ‚ÄúAbout the phone‚Äù on the device. <br><div class="spoiler">  <b class="spoiler_title">System Information</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/12d/324/282/12d324282c5287e9dba7ac5e7a00f9ee.png"><br></div></div><br>  As mentioned above in my case, this is 3.0.69-g26a847e.  Having a little picking on the firmware githaba (PACman for HTC Desire S) I determined that this is the core of AndromadusMod. <br>  We copy the found ihodniki to my local machine (I first forked the necessary repository in my github and executed git clone, manufacturers like Google and manufacturers of custom firmware keep the kernel sources in the open source repositories, some just allow you to download the source as an archive).  For me, it looked like this: <br><pre> <code class="bash hljs">/home/user/android/saga-3.0.69</code> </pre><br>  Now you need to find the configuration with which the core of our device is assembled.  In most cases, the configuration lies on the device itself and you can get it using adb, unpack and copy to the folder with the kernel sources: <br><pre> <code class="bash hljs">adb pull /proc/config.gz . gunzip ./config.gz cp ./config /home/user/android/saga-3.0.69/arch/arm/my_device_defconfig</code> </pre><br>  It is also necessary to slightly change the configuration - install the local version to the identical one that we learned earlier and turn off the automatic assignment of the local version.  This can be done using any text editor: <br><pre> <code class="bash hljs">CONFIG_LOCAL_VERSION=<span class="hljs-string"><span class="hljs-string">"-g26a847e"</span></span> CONFIG_LOCAL_VESION_AUTO=n</code> </pre><br>  After we go to the source folder, set up the environment variables for the build and build the kernel itself: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/user/android/saga-3.0.69 <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ARCH=arm <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CROSS_COMPILE=/home/user/android/android_prebuilt_linux-x86_toolchain_arm-gnueabihf-linaro-4.7/bin/arm-eabi- <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LOCALVERSION= all make my_device_defconfig make</code> </pre><br>  Now you can go to programming. <br><h5>  Code writing </h5><br><h6>  Android app </h6><br>  Given the huge number of articles on the writing of Android applications, I will consider only the moments related to the task. <br>  Our application will have a total of 1 Activity: <br><div class="spoiler">  <b class="spoiler_title">activity_main.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_centerHorizontal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/btnText1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onClick"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/editText1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_below</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"42dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:ems</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16sp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:inputType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"textMultiLine"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  It looks like this in the end: <br><img src="https://habrastorage.org/storage2/ff2/203/87f/ff220387f25d7cf64838fc0b46c7ab74.png"><br>  We assign an event to the button that will receive information from our driver and write it in the text field: <br><div class="spoiler">  <b class="spoiler_title">MainActivity class</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EditText text; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); text = (EditText)findViewById(R.id.editText1); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateOptionsMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Menu menu)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Inflate the menu; this adds items to the action bar if it is present. getMenuInflater().inflate(R.menu.main, menu); return true; } public void onClick(View view) { switch (view.getId()) { case R.id.button1: text.setText(IoctlWrapper.getData()); } } }</span></span></code> </pre><br></div></div><br>  Now we will create a wrapper class for our jni library: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IoctlWrapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//   ,      public static String getData() { return getKData(); } static { System.loadLibrary("ioctlwrap"); } }</span></span></code> </pre><br><h6>  Jni </h6><br>  Create a jni folder in the root of the Android application project. <br>  Next, generate a C header for our native library: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> src javac -d /tmp/ com/propheta13/amoduse/IoctlWrapper.java <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp javah -jni com.propheta13.amoduse.IoctlWrapper</code> </pre><br>  We get the header and copy it to the previously created folder, create the appropriate .c and Android.mk build configuration: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> [PATH TO ANDROIDPROJ]/jni cp /tmp/com_propheta13_amoduse_IoctlWrapper.h ./ioctlwrap.h touch ./ioctlwrap.c touch ./Android.mk</code> </pre><br>  Android.mk content: <br><pre> <code class="cmake hljs">LOCAL_PATH := $(call my-dir) <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(CLEAR_VARS) LOCAL_MODULE := ioctlwrap LOCAL_SRC_FILES := ioctlwrap.c</code> </pre><br>  The algorithm of the library: <br><ol><li>  Open the driver node. </li><li>  Allocate buffer for information from driver </li><li>  Get information using ioctl request. </li><li>  Close the node. </li><li>  Convert the information into a Java string and pass it into a wrapper. </li></ol><br>  Full code: <br><div class="spoiler">  <b class="spoiler_title">ioctlwrap.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>[] = <span class="hljs-string"><span class="hljs-string">"Driver open failed."</span></span>; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BUF_SIZE 4096 JNIEXPORT jstring JNICALL Java_com_propheta13_amoduse_IoctlWrapper_getKData (JNIEnv *env, jclass jcl) { char *info_buf = NULL; int dfd = 0, rc = 0; dfd = open(TKMOD_DEV_PATH, O_RDONLY); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(dfd </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 0) { jstring RetString = (*env)-&gt;NewStringUTF(env, string); goto exit; } info_buf = malloc(BUF_SIZE); rc = ioctl(dfd, TKMOD_IOCTL_GET_DATA, info_buf); if(rc &lt; 0) { strerror_r(rc, info_buf, BUF_SIZE); } jstring RetString = (*env)-&gt;NewStringUTF(env, info_buf); free(info_buf); close(dfd); exit: return RetString; }</span></span></span></span></code> </pre><br></div></div><br><h6>  Kernel driver </h6><br>  I will not fully describe the process of writing a driver; I will only make a couple of notes: <br><ol><li>  The driver written for this article does nothing supernatural - it only returns the list of network interface names. </li><li>  The ioctl mechanism is used to communicate with the driver. </li><li>  The makefile for the build allows you to specify the kernel for which you want to build this driver, for this you need to correctly specify the environment variables and use the command: </li></ol><br><pre> <code class="bash hljs">make KMODDIR=[path to kernel]</code> </pre><br><h5>  Launch </h5><br>  To begin, fill in the assembled driver on the device, and install it into the kernel, at the same time we will make the driver node accessible for everyone: <br><pre> <code class="bash hljs">adb push ./test_kmod.ko /data/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/tmp root@android:/ <span class="hljs-comment"><span class="hljs-comment"># rmmod test_kmod root@android:/ # insmod /data/local/tmp/test_kmod.ko root@android:/ # chmod 777 /dev/tkmod_device</span></span></code> </pre><br>  If the kernel version is modified correctly and the kernel matches the one that was on the device, there should be no errors. <br>  After that, you can run the Android application directly via eclipse or install it.  Push a single button and get the result: <br><img src="https://habrastorage.org/storage2/530/a1b/837/530a1b83776363cc4c81e9d4c6e070b4.png"><br>  Kernel logs can be obtained with the command: <br><pre> <code class="bash hljs">root@android:/ <span class="hljs-comment"><span class="hljs-comment"># dmesg | grep [TEST_KMOD] #        .</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Kernel log</b> <div class="spoiler_text"><pre> <code class="bash hljs">&lt;6&gt;[ 8695.448028] [TEST_KMOD] == Module init == &lt;7&gt;[ 8775.583587] [TEST_KMOD] tkmod opened. Descriptor: 0xc2e98e00. &lt;7&gt;[ 8775.583770] [TEST_KMOD] TKMOD_IOCTL_GET_DATA request. &lt;6&gt;[ 8775.583923] [TEST_KMOD] name = lo &lt;6&gt;[ 8775.584167] [TEST_KMOD] name = dummy0 &lt;6&gt;[ 8775.584259] [TEST_KMOD] name = rmnet0 &lt;6&gt;[ 8775.584320] [TEST_KMOD] name = rmnet1 &lt;6&gt;[ 8775.584503] [TEST_KMOD] name = rmnet2 &lt;6&gt;[ 8775.584564] [TEST_KMOD] name = rmnet3 &lt;6&gt;[ 8775.584655] [TEST_KMOD] name = rmnet4 &lt;6&gt;[ 8775.584777] [TEST_KMOD] name = rmnet5 &lt;6&gt;[ 8775.584930] [TEST_KMOD] name = rmnet6 &lt;6&gt;[ 8775.585021] [TEST_KMOD] name = rmnet7 &lt;6&gt;[ 8775.585113] [TEST_KMOD] name = gre0 &lt;6&gt;[ 8775.585266] [TEST_KMOD] name = sit0 &lt;6&gt;[ 8775.585357] [TEST_KMOD] name = ip6tnl0 &lt;7&gt;[ 8775.585479] [TEST_KMOD] tkmod_ 0xc2e98e00 closed successfuly.</code> </pre><br></div></div><br><h5>  Conclusion </h5><br>  The shown use of this bundle is not the only one.  Using kernel drivers allows you to directly work with any device interfaces, influence the operation of any application and the system as a whole, also allows you to work with interfaces that are hidden deep in the system behind a whole bunch of APIs and frameworks - for example, a driver that will write the information you need directly into the video memory buffer devices.  This solution is applicable not only for phones but also for any devices based on Android. <br>  The complete sources are on <a href="https://github.com/Propheta13/android_mod_use">github</a> . <br>  At this end, thank you for your attention.  I hope that this material will be useful for someone. <br><h5>  Resources used: </h5><br>  1. <a href="http://developer.android.com/">developer.android.com</a> - Android SDK / NDK and more. <br>  2. <a href="http://www.vogella.com/">www.vogella.com</a> - pretty good and understandable articles on the development of Android applications. <br>  3. <a href="http://blog.edwards-research.com/2012/04/tutorial-android-jni/">blog.edwards-research.com/2012/04/tutorial-android-jni</a> - tutorial on using JNI. <br>  4. <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/functions.html">docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/functions.html</a> - reference material on the JNI interface. <br>  5. Linux Device Drivers, 3ed - the bible of the Linux Kernel programmer. <br><h5>  UPD </h5><br>  Corrected several typos, errors in the code.  Thanks: <a href="http://habrahabr.ru/users/bmx666/" class="user_link">bmx666</a> , <a href="http://habrahabr.ru/users/shirixae/" class="user_link">Shirixae</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/174077/">https://habr.com/ru/post/174077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174055/index.html">MacBANG journal notepad! in your evernote</a></li>
<li><a href="../174057/index.html">How browsers work: how modern web browsers work</a></li>
<li><a href="../174067/index.html">Sun and Cloud - a digital camera that does not need an external charger</a></li>
<li><a href="../174069/index.html">Table for selecting the screen diagonal and resolution</a></li>
<li><a href="../174075/index.html">Drawing lessons or how the film ‚ÄúThe Second of Free Fall‚Äù was made</a></li>
<li><a href="../174081/index.html">About N9 and Nokia in general</a></li>
<li><a href="../174085/index.html">IBM has come up with an ionic transistor</a></li>
<li><a href="../174089/index.html">Online broadcast via Nginx-RTMP: several ready-made recipes</a></li>
<li><a href="../174091/index.html">JSonCmp - we compare in JavaScript correctly</a></li>
<li><a href="../174093/index.html">Dropbox: New Albums Feature</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>