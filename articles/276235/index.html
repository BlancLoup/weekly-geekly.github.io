<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we stopped being afraid of UI tickets</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 
 More than a year has passed since we started using ReactJS in development. Finally the moment came to share how much happier our company has ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we stopped being afraid of UI tickets</h1><div class="post__text post__text-html js-mediator-article">  Hello. <br>  More than a year has passed since we started using ReactJS in development.  Finally the moment came to share how much happier our company has become.  In the article I am going to talk about the reasons that prompted us to use this library and how we do it. <br><br><h2>  Why all this </h2><br>  We are a small company, our staff is about 50 people, 20 of which are developers.  Now we have 4 development teams, each of which has 5 fullstack developers.  But one thing is to call yourself a fullstack developer, and another is really <u>good at</u> understanding the intricacies of SQL Server, ASP.NET, developing in C #, OOP, DDD, knowing HTML, CSS, JS and being able to use it all wisely.  Of course, every developer has something to do with his own, but all of us, anyway, are experts in .NET development and we write 90% of the code in C #. <br>  Our product - marketing automation system - implies a large amount of settings for each specific client.  In order for our managers to be able to customize the product for clients, there is an administrative site in which you can start mailing lists, create triggers and other mechanics, customize services and much more.  This administrative site contains many different nontrivial UIs, and the more subtle moments we give to customize, the more features we release in production, the more interesting the UI becomes. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Create trigger</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d61/99f/b9a/d6199fb9a9ec417e97406841057fe6f6.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Filter by product categories</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/868/2e9/1d0/8682e91d0938408ca825b5a6efc72d46.png"><br></div></div><br>  How did we cope with the development of such a UI before?  We coped badly.  Basically, I got off with rendering on the server pieces of HTML that were received by ajax.  Or just on events using jQuery.  For the user, this usually resulted in constant downloads, preloaders for each and strange bugs.  From the point of view of the developer, these were the real macaroni that everyone feared.  Any ticket on the UI on the planning immediately received an estimate of L and poured into a ton of the bathert while writing the code.  And, of course, there were a lot of bugs associated with such UI'em.  It happened this way: in the first implementation some kind of small mistake was made.  And when repairing something else was inevitably falling apart, because there were no tests for this miracle. <br>  An example from life.  This is the operation creation page.  Without going into details on business, I will only say that our operations are something like REST services that our customers' contractors can use.  The operation has restrictions on availability according to the stages of registration of consumers, and in order to configure this, there was such a control: <br><div class="spoiler">  <b class="spoiler_title">Creating an operation</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/7bf/fb6/2b0/7bffb62b07ad46a492dcf8c0c19cbfb3.png"><br></div></div><br>  And here is the old code for this controller: <br><div class="spoiler">  <b class="spoiler_title">Kontolla code indicating the availability of operations</b> <div class="spoiler_text">  View slice <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"column-header"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"link-action"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-event-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ToggleElements"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-event-param</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{"selector":"#WorkFlowAllowance", "callback": "toggleWorkflowAvailability"}'</span></span></span><span class="hljs-tag">&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.HiddenFor(m =&gt; m.IsAllowedForAllWorkflow, new { Id = "IsAllowedForAllWorkflow" }) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WorkFlowAllowance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@(Model.IsAllowedForAllWorkflow ? "</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">none</span></span></span><span class="hljs-tag">" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">string.Empty</span></span></span><span class="hljs-tag">) </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">row</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">form_horizontal</span></span></span><span class="hljs-tag">"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table table_hover table_control @(Model.OperationWorkflowAllowances.Any() ? String.Empty : "</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">none</span></span></span><span class="hljs-tag">")" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"operationAllowanceTable"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> @Model.OperationWorkflowAllowances.Each( @<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @item.Item.WorkflowDisplayName <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OperationTypeViewModel.OperationWorkflowAllowances[@(item.Index)].WorkflowName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@item.Item.WorkflowName"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OperationTypeViewModel.OperationWorkflowAllowances[@(item.Index)].WorkflowDisplayName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@item.Item.WorkflowDisplayName"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OperationTypeViewModel.OperationWorkflowAllowances[@(item.Index)].Id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@item.Item.Id"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cell-grid__right button button_icon-only button_red removeOperationAllowance"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon icon_del"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cell-grid__wraps"</span></span></span><span class="hljs-tag">&gt;</span></span>@(item.Item.StageName ?? "")<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OperationTypeViewModel.OperationWorkflowAllowances[@(item.Index)].StageName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@item.Item.StageName"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OperationTypeViewModel.OperationWorkflowAllowances[@(item.Index)].StageDisplayName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@item.Item.StageDisplayName"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span>) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"col col_462"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group form-group_all"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> @if (Model.WorkFlows.Any()) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-label"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DropDownList("WorkflowList", Model.WorkFlows, new Dictionary<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string,</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">object</span></span></span><span class="hljs-tag">&gt;</span></span> { { "class", "form-control select2 w470" }, { "data-placeholder", "  " }, { "id", "workflowList" }, { "disabled", "disabled" } }) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-list"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"isAllowedForAllStagesForCurrentWorkflow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"StageMechanicsRegistratioName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autocomplete</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"off"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"isAllowedForAllStagesForCurrentWorkflow"</span></span></span><span class="hljs-tag">&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"exceptAnonymus"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"workflowName"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-label"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DropDownList("WorkflowStageList", new SelectListItem[0], new Dictionary<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string,</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">object</span></span></span><span class="hljs-tag">&gt;</span></span> { { "class", "form-control select2 w470" }, { "data-placeholder", "  " }, { "id", "workflowStageList" }, { "disabled", "disabled"} }) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button button_blue"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addOperationAllowance"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> } else { @:     } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  But js, which made this view work (I didn‚Äôt want to show the code that can be run, I just show how sad it was): <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initOperationAllowance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">typeSelector</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>).prop(<span class="hljs-string"><span class="hljs-string">'disabled'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>).trigger(<span class="hljs-string"><span class="hljs-string">'change'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(typeSelector).val() == <span class="hljs-string"><span class="hljs-string">'PerformAction'</span></span>) { $(<span class="hljs-string"><span class="hljs-string">'#exceptAnonymus'</span></span>).html(<span class="hljs-string"><span class="hljs-string">'( )'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $(<span class="hljs-string"><span class="hljs-string">'#exceptAnonymus'</span></span>).html(<span class="hljs-string"><span class="hljs-string">''</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggleWorkflowAvailability</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> element = $(<span class="hljs-string"><span class="hljs-string">"#IsAllowedForAllWorkflow"</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#operationAllowanceTable tbody tr'</span></span>).remove(); parameters.selectedAllowances = []; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> element.val().toLowerCase() == <span class="hljs-string"><span class="hljs-string">'true'</span></span> ? element.val(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) : element.val(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteRow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">row</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = getRowIndex(row); row.remove(); parameters.selectedAllowances.splice(index, <span class="hljs-number"><span class="hljs-number">1</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#operationAllowanceTable input'</span></span>).each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentIndex = getFieldIndex($(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentIndex &gt; index) { decrementIndex($(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), currentIndex); } }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameters.selectedAllowances.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { $(<span class="hljs-string"><span class="hljs-string">'#operationAllowanceTable'</span></span>).hide(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateWorkflowSteps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">operationType</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> workflow = $(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>).val(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (workflow == <span class="hljs-string"><span class="hljs-string">''</span></span>) { $(<span class="hljs-string"><span class="hljs-string">'#isAllowedForAllStagesForCurrentWorkflow'</span></span>) .prop(<span class="hljs-string"><span class="hljs-string">'checked'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) .prop(<span class="hljs-string"><span class="hljs-string">'disabled'</span></span>, <span class="hljs-string"><span class="hljs-string">'disabled'</span></span>); refreshOptionList( $(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>), [{ <span class="hljs-attr"><span class="hljs-attr">Text</span></span>: <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-attr"><span class="hljs-attr">Value</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">Selected</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }] ); $(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>).trigger(<span class="hljs-string"><span class="hljs-string">'change'</span></span>).select2(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = parameters.stagesUrlTemplate + <span class="hljs-string"><span class="hljs-string">'?workflowName='</span></span> + workflow + <span class="hljs-string"><span class="hljs-string">'&amp;OperationTypeName='</span></span> + operationType; $.getJSON(url, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#isAllowedForAllStagesForCurrentWorkflow'</span></span>) .prop(<span class="hljs-string"><span class="hljs-string">'checked'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) .removeProp(<span class="hljs-string"><span class="hljs-string">'disabled'</span></span>); refreshOptionList($(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>), data); $(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>).trigger(<span class="hljs-string"><span class="hljs-string">'change'</span></span>).select2(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshOptionList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">list, data</span></span></span><span class="hljs-function">) </span></span>{ list.find(<span class="hljs-string"><span class="hljs-string">'option'</span></span>).remove(); $.each(data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index, itemData</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> option = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Option(itemData.Text, itemData.Value, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, itemData.Selected); list[<span class="hljs-number"><span class="hljs-number">0</span></span>].add(option); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rowsCount = $(<span class="hljs-string"><span class="hljs-string">'#operationAllowanceTable tr'</span></span>).length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = rowsCount - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-string"><span class="hljs-string">'&lt;tr '</span></span> + (rowsCount % <span class="hljs-number"><span class="hljs-number">2</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-string"><span class="hljs-string">'class="bgGray"&gt;'</span></span> : <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;td&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'{DisplayWorkflowName}'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;input type="hidden" name="OperationTypeViewModel.OperationWorkflowAllowances['</span></span> + index + <span class="hljs-string"><span class="hljs-string">'].WorkflowName" value="{WorkflowName}"/&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;input type="hidden" name="OperationTypeViewModel.OperationWorkflowAllowances['</span></span> + index + <span class="hljs-string"><span class="hljs-string">'].Id" value=""/&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;input type="hidden" name="OperationTypeViewModel.OperationWorkflowAllowances['</span></span> + index + <span class="hljs-string"><span class="hljs-string">'].WorkflowDisplayName" value="{DisplayWorkflowName}"/&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/td&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;td&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;button class="cell-grid__right button button_icon-small button_red removeOperationAllowance"&gt;&lt;span class="icon icon_del"&gt;&lt;/span&gt;&lt;/button&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;span class="cell-grid__wraps"&gt;{DisplayStageName}&lt;/span&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;input type="hidden" name="OperationTypeViewModel.OperationWorkflowAllowances['</span></span> + index + <span class="hljs-string"><span class="hljs-string">'].StageName" value="{StageName}"/&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;input type="hidden" name="OperationTypeViewModel.OperationWorkflowAllowances['</span></span> + index + <span class="hljs-string"><span class="hljs-string">'].StageDisplayName" value="{DisplayStageName}"/&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/td&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/tr&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data) { result = result.replace(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">'{'</span></span> + key + <span class="hljs-string"><span class="hljs-string">'}'</span></span>, <span class="hljs-string"><span class="hljs-string">'g'</span></span>), data[key]); } $(<span class="hljs-string"><span class="hljs-string">'#operationAllowanceTable'</span></span>).show().append(result); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidForm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = ValidateList($(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>), <span class="hljs-string"><span class="hljs-string">'    '</span></span>) &amp; ValidateListWithCheckBox($(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>), $(<span class="hljs-string"><span class="hljs-string">'#isAllowedForAllStagesForCurrentWorkflow'</span></span>), <span class="hljs-string"><span class="hljs-string">'     '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!result) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> workflowName = $(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>).val(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stageName = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$(<span class="hljs-string"><span class="hljs-string">'#isAllowedForAllStagesForCurrentWorkflow'</span></span>).is(<span class="hljs-string"><span class="hljs-string">':checked'</span></span>)) { stageName = $(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>).val(); } hideError($(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>)); hideError($(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; parameters.selectedAllowances.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameters.selectedAllowances[i].workflow == workflowName &amp;&amp; parameters.selectedAllowances[i].stage == stageName) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stageName == <span class="hljs-string"><span class="hljs-string">''</span></span>) { showError($(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>), <span class="hljs-string"><span class="hljs-string">'      '</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showError($(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>), <span class="hljs-string"><span class="hljs-string">'     '</span></span>); } result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameters.selectedAllowances[i].workflow == workflowName &amp;&amp; parameters.selectedAllowances[i].stage == <span class="hljs-string"><span class="hljs-string">''</span></span>) { showError($(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>), <span class="hljs-string"><span class="hljs-string">'      '</span></span>); result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field, message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field.val() == <span class="hljs-string"><span class="hljs-string">""</span></span>) { showError(field, message); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } hideError(field); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateListWithCheckBox</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field, checkBoxField, message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!checkBoxField.prop(<span class="hljs-string"><span class="hljs-string">'checked'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ValidateList(field, message); } hideError(field); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field, message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (message) === <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { message = <span class="hljs-string"><span class="hljs-string">'   '</span></span>; } field.addClass(<span class="hljs-string"><span class="hljs-string">'input-validation-error form-control_error'</span></span>); field.parent(<span class="hljs-string"><span class="hljs-string">'.form-group'</span></span>).find(<span class="hljs-string"><span class="hljs-string">'div.tooltip-error'</span></span>).remove(); field.closest(<span class="hljs-string"><span class="hljs-string">'.form-group'</span></span>).append( <span class="hljs-string"><span class="hljs-string">'&lt;div class="tooltip-icon tooltip-icon_error"&gt;&lt;div class="tooltip-icon__content"&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;strong&gt;&lt;/strong&gt;&lt;br&gt;'</span></span> + message + <span class="hljs-string"><span class="hljs-string">'&lt;/div&gt;&lt;/div&gt;'</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field</span></span></span><span class="hljs-function">) </span></span>{ field.removeClass(<span class="hljs-string"><span class="hljs-string">'input-validation-error form-control_error'</span></span>); field.parent(<span class="hljs-string"><span class="hljs-string">'.form-group'</span></span>).find(<span class="hljs-string"><span class="hljs-string">'div.tooltip-icon_error'</span></span>).remove(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRowIndex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">row</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getFieldIndex(row.find(<span class="hljs-string"><span class="hljs-string">'input:first'</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFieldIndex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = field.prop(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startIndex = name.indexOf(<span class="hljs-string"><span class="hljs-string">'['</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> endIndex = name.indexOf(<span class="hljs-string"><span class="hljs-string">']'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name.substr(startIndex, endIndex - startIndex); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrementIndex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field, index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = field.prop(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newIndex = index - <span class="hljs-number"><span class="hljs-number">1</span></span>; field.prop(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, name.replace(<span class="hljs-string"><span class="hljs-string">'['</span></span> + index + <span class="hljs-string"><span class="hljs-string">']'</span></span>, <span class="hljs-string"><span class="hljs-string">'['</span></span> + newIndex + <span class="hljs-string"><span class="hljs-string">']'</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeWorkflowAllowance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">settings</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ parameters.selectedAllowances = settings.selectedAllowances; initOperationAllowance(parameters.typeSelector); $(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>).change(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ updateWorkflowSteps($(parameters.typeSelector).val()); }); $(<span class="hljs-string"><span class="hljs-string">'#addOperationAllowance'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ event.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsValidForm()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = { <span class="hljs-string"><span class="hljs-string">'StageName'</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#workflowStageList'</span></span>).val(), <span class="hljs-string"><span class="hljs-string">'WorkflowName'</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#workflowList'</span></span>).val(), }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-string"><span class="hljs-string">'#isAllowedForAllStagesForCurrentWorkflow'</span></span>).is(<span class="hljs-string"><span class="hljs-string">':checked'</span></span>)) { data.DisplayWorkflowName = $(<span class="hljs-string"><span class="hljs-string">'#workflowList option[value='</span></span> + data.WorkflowName + <span class="hljs-string"><span class="hljs-string">']'</span></span>).text(); data.DisplayStageName = <span class="hljs-string"><span class="hljs-string">''</span></span>; data.StageName = <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { data.DisplayWorkflowName = $(<span class="hljs-string"><span class="hljs-string">'#workflowList option[value='</span></span> + data.WorkflowName + <span class="hljs-string"><span class="hljs-string">']'</span></span>).text(); data.DisplayStageName = $(<span class="hljs-string"><span class="hljs-string">'#workflowStageList option[value='</span></span> + data.StageName + <span class="hljs-string"><span class="hljs-string">']'</span></span>).text(); } AddRow(data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.StageName == <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> indexes = []; <span class="hljs-comment"><span class="hljs-comment">//      for (var i = 0; i &lt; parameters.selectedAllowances.length; i++) { if (parameters.selectedAllowances[i].workflow == data.WorkflowName) { indexes.push(i); } } $("#operationAllowanceTable tbody tr").filter(function (index) { return $.inArray(index, indexes) &gt; -1; }).each(function () { deleteRow($(this)); }); } parameters.selectedAllowances.push({ workflow: data.WorkflowName, stage: data.StageName }); $("#workflowList").val('').trigger('change'); updateWorkflowSteps($(parameters.typeSelector).val()); } }); $('#isAllowedForAllStagesForCurrentWorkflow').click(function () { if ($(this).is(":checked")) { $('#workflowStageList').prop('disabled', 'disabled'); } else { $('#workflowStageList').removeProp('disabled'); } }); $('#operationAllowanceTable').on('click', 'button.removeOperationAllowance', function (event) { var row = $(this).parent().parent(); setTimeout(function () { deleteRow(row); }, 20); event.preventDefault(); }); });</span></span></code> </pre><br></div></div><br><br><h2>  New Hope </h2><br>  At some point we realized that it was no longer possible to live this way.  After some discussion, we came to the conclusion that we need a person from the outside, who understands the front end and guides us on the right path.  We hired a freelancer who suggested we use React.  He did not work very hard with us, but he managed to make a couple of controls to show what was happening, and the sensations turned out to be twofold.  I really liked React from the moment of the <a href="https://facebook.github.io/react/docs/tutorial.html">tutorial on the official site</a> , but not everyone liked it.  In addition, hardcore front-end users love javascript, but in the statically typed world of our development, javascript is not popular (to say the least), so all the webpacks and grunt that we were offered to use just scared us.  As a result, it was decided to make several prototypes of a complex UI, using different frameworks in order to decide which ones we need to deal with.  Proponents of each of the frameworks from which we chose, had to make a prototype of the same control, so that we could compare the code.  We compared Angular, React and Knockout.  The latter did not even go through the prototype stage, and I don‚Äôt even remember for what reason.  However, between supporters of Angular and React, a real civil war broke out in the company! <br>  Joke :) In fact, each framework had one supporter, everyone else did not like one or the other.  All hesitated and could not solve anything.  In Angular, everyone was annoyed by its complexity, and in React, by the dumb syntax, the lack of support for which in Visual Studio at that time was indeed a very unpleasant fact. <br>  Fortunately for us, our boss (one of the owners of the company) came to our aid, who of course has not been programming for a long time, but keeps abreast.  After it became clear that the prototypes did not produce any effect, and the development spends time is not clear on what (at that moment we planned to make another prototype a lot more, to have more code for comparison!), We had to make a decision his.  Now, remembering why his choice then fell on React, Sasha <a href="https://habrahabr.ru/users/agornik/" class="user_link">agornik</a> Gornik told me the following (I cite his words not for holivar, this is just an opinion. The spelling, of course, is preserved, although I corrected something) : <br><blockquote>  There were several prototypes: reactor, angular, and something else.  I watched.  I did not like Angular, I liked the reactor. <br>  But [some] shouted the loudest, and everyone else was like vegetables.  I had to read and watch. <br>  I saw that the reactor was in production on a bunch of cool sites.  FB, Yahoo, WhatsApp and something else there.  Obviously, a huge admission is coming and there is a future. <br>  And on angular - [nothing good].  I looked at the future.  I saw that everything that I didn‚Äôt like in the prototype of the angulyar was strengthened in 2.0. <br>  I understood that react is a thing for life made solving a specific problem.  And the angular is the bearded theorists from Google from the brain come up with all sorts of concepts.  As was the case with GWT or how it is there. <br>  Well, I realized that we need a strong-willed decision to take the side of vegetables, otherwise the screaming, but wrong will win.  Before I did this, I threw 33 million proofs and links into the channel, I enlisted the support of [our chief architect] and tried to make sure that nobody would stop. <br>  And I remembered how hellishly important the argument was.  For the reactor, there was a beautiful way to do it step by step and screw it into existing pages, and the angular required to redo them entirely, and this also corrected with [its bad] architecture. <br>  Then I also read that in theory, in theory, you can even use the UI for the web.  And every server there js / react and where it all goes.  And finally, not a single argument was left to take. <br>  I realized that support for the studio was done very quickly.  In the end, everything exactly happened.  I'm certainly hellishly pleased with this decision) </blockquote><br><h2>  What happened? </h2><br>  It's time to reveal the cards and show how we are cooking the UI now.  Of course, the front-end players will start laughing now, but for us this code is a real victory, we are very pleased with it :) <br>  For example, I will use the page for creating additional fields.  Brief Business Note: Some entities, such as Consumers, Orders, Purchases and Products, may have some customer-specific related data.  In order to store such data, we use the classic <a href="https://en.wikipedia.org/wiki/Entity%25E2%2580%2593attribute%25E2%2580%2593value_model">Entity ‚Äì attribute ‚Äì value model</a> .  Initially, additional fields for each client were started right in the database (in order to save development time), but finally there was also time for the UI. <br>  Here is the page for adding an additional field in the project: <br><div class="spoiler">  <b class="spoiler_title">Adding an additional field of type Enumeration</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/6ec/a82/249/6eca822491a44d0888a2c9af677d063a.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Adding an additional field of type String</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c4c/3b6/1f6/c4c3b61f64e94be587391c32c648f698.png"><br></div></div><br>  And here is what the code for this page looks like on React: <br><div class="spoiler">  <b class="spoiler_title">Component of the page for adding / editing additional fields</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;reference path="../../references.d.ts"/&gt; module DirectCrm { export interface SaveCustomFieldKindComponentProps extends Model&lt;CustomFieldKindValueBackendViewModel&gt; { } interface SaveCustomFieldKindComponentState { model?: CustomFieldKindValueBackendViewModel; validationContext: IValidationContext&lt;CustomFieldKindValueBackendViewModel&gt;; } export class SaveCustomFieldKindComponent extends React.Component&lt;SaveCustomFieldKindComponentProps, SaveCustomFieldKindComponentState&gt; { private _componentsMap: ComponentsMap&lt;CustomFieldKindConstantComponentDataBase, CustomFieldKindTypedComponentProps&gt;; constructor(props: SaveCustomFieldKindComponentProps) { super(props); this.state = { model: props.model, validationContext: createTypedValidationContext&lt;CustomFieldKindValueBackendViewModel&gt;(props.validationSummary) }; this._componentsMap = ComponentsMap.initialize(this.state.model.componentsMap); } _setModel = (model: CustomFieldKindValueBackendViewModel) =&gt; { this.setState({ model: model }); } _handleFieldTypeChange = (newFieldType: string) =&gt; { var clone = _.clone(this.state.model); clone.fieldType = newFieldType; clone.typedViewModel = { type: newFieldType, $type: this._componentsMap[newFieldType].viewModelType }; this._setModel(clone); } _getColumnPrefixOrEmptyString = (entityType: string) =&gt; { var entityTypeDto = _.find(this.props.model.entityTypes, et =&gt; et.systemName === entityType); return entityTypeDto &amp;&amp; entityTypeDto.prefix || ""; } _hanleEntityTypeChange = (newEntityType: string) =&gt; { var clone = _.clone(this.state.model); clone.entityType = newEntityType; var columnPrefix = this._getColumnPrefixOrEmptyString(newEntityType); clone.columnName = `${columnPrefix}${this.state.model.systemName || ""}`; this._setModel(clone); } _handleSystemNameChange = (newSystemName: string) =&gt; { var clone = _.clone(this.state.model); clone.systemName = newSystemName; var columnPrefix = this._getColumnPrefixOrEmptyString(this.state.model.entityType); clone.columnName = `${columnPrefix}${newSystemName || ""}`; this._setModel(clone); } _renderComponent = () =&gt; { var entityTypeSelectOptions = this.state.model.entityTypes.map(et =&gt; { return { Text: et.name, Value: et.systemName } }); var fieldTypeSelectOptions = Object.keys(this._componentsMap). map(key =&gt; { return { Text: this._componentsMap[key].name, Value: key }; }); var componentInfo = this._componentsMap[this.state.model.fieldType]; var TypedComponent = componentInfo.component; return ( &lt;div&gt; &lt;div className="row form_horizontal"&gt; &lt;FormGroup label=" " validationMessage={this.state.validationContext.getValidationMessageFor(m =&gt; m.entityType)}&gt; &lt;div className="form-control"&gt; &lt;Select value={this.state.model.entityType} options={entityTypeSelectOptions} width="normal" placeholder=" " onChange={this._hanleEntityTypeChange} /&gt; &lt;/div&gt; &lt;/FormGroup&gt; &lt;DataGroup label=" " value={this.state.model.columnName} /&gt; &lt;FormGroup label="" validationMessage={this.state.validationContext.getValidationMessageFor(m =&gt; m.name)}&gt; &lt;Textbox value={this.state.model.name} width="normal" onChange={getPropertySetter( this.state.model, this._setModel, viewModel =&gt; viewModel.name)} /&gt; &lt;/FormGroup&gt; &lt;FormGroup label=" " validationMessage={this.state.validationContext.getValidationMessageFor(m =&gt; m.systemName)}&gt; &lt;Textbox value={this.state.model.systemName} width="normal" onChange={this._handleSystemNameChange} /&gt; &lt;/FormGroup&gt; &lt;FormGroup label=" " validationMessage={this.state.validationContext.getValidationMessageFor(m =&gt; m.fieldType)}&gt; &lt;div className="form-control"&gt; &lt;Select value={this.state.model.fieldType} options={fieldTypeSelectOptions} width="normal" placeholder=" " onChange={this._handleFieldTypeChange} /&gt; &lt;/div&gt; &lt;/FormGroup&gt; &lt;TypedComponent validationContext={this.state.validationContext.getValidationContextFor(m =&gt; m.typedViewModel)} onChange={getPropertySetter( this.state.model, this._setModel, viewModel =&gt; viewModel.typedViewModel)} value={this.state.model.typedViewModel} constantComponentData={componentInfo.constantComponentData} /&gt; &lt;FormGroup&gt; &lt;Checkbox checked={this.state.model.isMultiple} label="       " onChange={getPropertySetter( this.state.model, this._setModel, viewModel =&gt; viewModel.isMultiple)} disabled={false} /&gt; &lt;/FormGroup&gt; {this._renderShouldBeExportedCheckbox()} &lt;/div&gt; &lt;/div&gt;); } _getViewModelValue = () =&gt; { var clone = _.clone(this.state.model); clone.componentsMap = null; clone.entityTypes = null; return clone; } render() { return ( &lt;div&gt; &lt;fieldset&gt; {this._renderComponent() } &lt;/fieldset&gt; &lt;HiddenInputJsonSerializer model={this._getViewModelValue()} name={this.props.modelName} /&gt; &lt;/div&gt;); } _renderShouldBeExportedCheckbox = () =&gt; { if (this.state.model.entityType !== "HistoricalCustomer") return null; return ( &lt;FormGroup validationMessage={this.state.validationContext.getValidationMessageFor(m =&gt; m.shouldBeExported)}&gt; &lt;Checkbox checked={this.state.model.shouldBeExported} label="   " onChange={getPropertySetter( this.state.model, this._setModel, viewModel =&gt; viewModel.shouldBeExported)} disabled={false} /&gt; &lt;/FormGroup&gt;); } } }</span></span></code> </pre><br></div></div><br><h3>  TypeScript </h3><br>  ‚ÄúWhat was it?‚Äù - you can ask if you expected to see javascript.  This is a tsx version of React jsx under TypeScript.  Our UI is completely statically typed, no ‚Äúmagic strings‚Äù.  Agree, this could be expected from such hardcore backendors like us :) <br>  Here you need to say a few words.  I have no goal to raise holivar on the topic of statically and dynamically-typed languages.  It just so happened that in our company no one likes dynamic languages.  We believe that it is <s>not</s> very difficult to write a large, supported project for them, which will refactor over the years.  Well, it's hard to just write, because IntelliSense does not work :) This is our conviction.  One can argue that everything can be covered with tests, and then it will be possible with a dynamically typed language, but we will not argue on this topic. <br>  The tsx format is supported by the studio and the new R #, which is another very important point.  But a year ago in the studio (not just in R #) there was no support even for jsx, and for developing on js, you had to have another code editor (we used Sublime and Atom).  In consequence of this, half of the files were missing in the Studio Solution, which only added batherths.  But let's not talk about it, because happiness has already come. <br>  It should be noted that even typescript in its pure form does not give the level of static typing that we would like.  For example, if we want to set a property in the model (actually, we can reduce the UI controller to some property of the model), we can write a callback function for each such property that takes a long time, and we can use one callback that takes the name of the property, which is never statically typed.  Specifically, we have solved this problem with something like this code (you can see examples using getPropertySetter above): <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;reference path="../../libraries/underscore.d.ts"/&gt; function getPropertySetter&lt;TViewModel, TProperty&gt;( viewModel: TViewModel, viewModelSetter: {(viewModel: TViewModel): void}, propertyExpression: {(viewModel: TViewModel): TProperty}): {(newPropertyValue: TProperty): void} { return (newPropertyValue: TProperty) =&gt; { var viewModelClone = _.clone(viewModel); var propertyName = getPropertyNameByPropertyProvider(propertyExpression); viewModelClone[propertyName] = newPropertyValue; viewModelSetter(viewModelClone); }; } function getPropertyName&lt;TObject&gt;(obj: TObject, expression: {(obj: TObject): any}): string { return getPropertyNameByPropertyProvider(expression); } function getPropertyNameByPropertyProvider(propertyProvider: Function): string { return /\.([^\.;]+);?\s*\}$/.exec(propertyProvider.toString())[1]; }</span></span></code> </pre><br>  There is no doubt that the implementation of getPropertyNameByPropertyProvider is very, very dumb (you can't even pick up another word).  But there is no other choice typescript yet.  ExpressionTree and nameof are not there, and the positive aspects of getPropertySetter outweigh the negative aspects of such an implementation.  In the end, what could happen to her?  It may start to slow down at some point, and it will be possible to assign some caching there, and maybe by that time some nameof in typescript will be done. <br>  Thanks to this <i>hack</i> , for example, renaming works on the whole code and we don‚Äôt have to worry about something falling apart somewhere. <br>  Otherwise, everything works just magically.  Did you specify any required prop for the component?  Compilation error.  Did you transfer the prop of the wrong type to the component?  Compilation error.  No stupid PropTypes with their warnings in runtime.  The only problem here is that the backend is still in C # and not in typescript, so each model used on the client needs to be described twice: on the server and on the client.  However, a solution to this problem exists: we ourselves wrote a prototype of the type generator for typescript from types on .NET after trying open source solutions that did not satisfy us, but then read <a href="https://habrahabr.ru/post/266899/">this article</a> .  It looks like you just need to apply this utility somehow and see how it behaves in combat conditions.  Apparently everything is fine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Component rendering </h3><br>  I'll tell you in more detail how we initialize the components when opening the page and how they interact with the server code.  Immediately I warn you that the capling is quite high, but what to do. <br>  For each component on the server there is a model-view for which this component will be squeezed during a POST request.  Usually, the same model view is used to initialize the component initially.  For example, here is the code (C #) that initializes the page view of the additional fields shown above: <br><div class="spoiler">  <b class="spoiler_title">Initialization code for the view model on the server</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareForViewing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MvcModelContext mvcModelContext</span></span></span><span class="hljs-function">)</span></span> { ComponentsMap = ModelApplicationHostController .Instance .Get&lt;ReactComponentViewModelConfiguration&gt;() .GetNamedObjectRelatedComponentsMapFor&lt;CustomFieldKindTypedViewModelBase, CustomFieldType&gt;( customFieldViewModel =&gt; customFieldViewModel.PrepareForViewing(mvcModelContext)); EntityTypes = ModelApplicationHostController.NamedObjects .GetAll&lt;CustomFieldKindEntityType&gt;() .Select( type =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EntityTypeDto { Name = type.Name, SystemName = type.SystemName, Prefix = type.ColumnPrefix }) .ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ModelApplicationHostController.NamedObjects.Get&lt;DirectCrmFeatureComponent&gt;().Sku.IsEnabled()) { EntityTypes = EntityTypes.Where( et =&gt; et.SystemName != ModelApplicationHostController.NamedObjects .Get&lt;CustomFieldKindEntityTypeComponent&gt;().Purchase.SystemName) .ToArray(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { EntityTypes = EntityTypes.Where( et =&gt; et.SystemName != ModelApplicationHostController.NamedObjects .Get&lt;CustomFieldKindEntityTypeComponent&gt;().Sku.SystemName) .ToArray(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FieldType.IsNullOrEmpty()) { TypedViewModel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringCustomFieldKindTypedViewModel(); FieldType = TypedViewModel.Type; } }</code> </pre><br></div></div><br>  Here some properties and collections are initialized that will be used to populate the lists. <br>  In order to draw some component using the data of this twist model, the HtmlHelper Extension-method is written.  In fact, in any place where we need to render the component, we use the code: <br><pre> <code class="cs hljs">@Html.ReactJsFor(<span class="hljs-string"><span class="hljs-string">"DirectCrm.SaveCustomFieldKindComponent"</span></span>, m =&gt; m.Value)</code> </pre><br>  The first parameter is the name of the component, the second is the PropertyExpression - the path in the view model of the page where the data for this component is located.  Here is the code for this method: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IHtmlString ReactJsFor&lt;TModel, TProperty&gt;( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> HtmlHelper&lt;TModel&gt; htmlHelper, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> componentName, Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> initializeObject = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> validationData = htmlHelper.JsonValidationMessagesFor(expression); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> metadata = ModelMetadata.FromLambdaExpression(expression, htmlHelper.ViewData); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> modelData = JsonConvert.SerializeObject( metadata.Model, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonSerializerSettings { TypeNameHandling = TypeNameHandling.Auto, TypeNameAssemblyFormat = FormatterAssemblyStyle.Full, Converters = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringEnumConverter() } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initializeData = JsonConvert.SerializeObject(initializeObject); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlString(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"&lt;div data-react-component='{0}' data-react-model-name='{1}' data-react-model='{2}' "</span></span> + <span class="hljs-string"><span class="hljs-string">"data-react-validation-summary='{3}' data-react-initialize='{4}'&gt;&lt;/div&gt;"</span></span>, HttpUtility.HtmlEncode(componentName), HttpUtility.HtmlEncode(htmlHelper.NameFor(expression)), HttpUtility.HtmlEncode(modelData), HttpUtility.HtmlEncode(validationData), HttpUtility.HtmlEncode(initializeData))); }</code> </pre><br> ,    div,      ,    :  ,     , ,    ,   ,    -    .          div   : <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initializeReact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'div[data-react-component]'</span></span>, context).each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> that = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = $(that).data(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> component = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(data.reactComponent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.reactInitialize == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { data.reactInitialize = {}; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> props = $.extend({ <span class="hljs-attr"><span class="hljs-attr">model</span></span>: data.reactModel, <span class="hljs-attr"><span class="hljs-attr">validationSummary</span></span>: data.reactValidationSummary, <span class="hljs-attr"><span class="hljs-attr">modelName</span></span>: data.reactModelName }, data.reactInitialize); React.render( React.createElement(component, props), that ); }); }</code> </pre><br>     ,      ‚Äî            state.           ,          (   /    select'). <br><br><h3> Binding </h3><br> ,   ,        ? <br>  It's pretty simple.      .         .      ,      ,        (      ,    ),   hidden input,    ,   json.  ,   json    ASP.NET ,    ModelBinder. <br>   hidden input'.        : <br><pre> <code class="javascript hljs">&lt;HiddenInputJsonSerializer model={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._getViewModelValue() } name={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.modelName} /&gt;</code> </pre><br>    : <br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HiddenInputJsonSerializer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">&lt;</span></span>{ model: any, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: string }, {}&gt; { render() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> json = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.model); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.name; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{json}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{name}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); } }</span></span></code> </pre><br>         ‚Äî  json  ,    this.props.modelName ‚Äî     ,     data-react-model-name   (. ),        -   -,   json'. <br>  ,   json   -  ,   .  ,  -,      json',     JsonBindedAttribute.     -,    -,     json: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomFieldKindCreatePageViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">AdministrationSiteMasterViewModel</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomFieldKindCreatePageViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Value = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomFieldKindValueViewModel(); } [JsonBinded] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CustomFieldKindValueViewModel Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">      - }</span></span></code> </pre><br>  ,  -        CustomFieldKindCreatePageViewModel.Value  .  - ‚Äî ModelBinder.   :    JsonBindedAttribute ‚Äî           ,  CustomFieldKindValueViewModel (  ).   : <br><div class="spoiler"> <b class="spoiler_title"> ,    json</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MindboxDefaultModelBinder</span></span> : <span class="hljs-title"><span class="hljs-title">DefaultModelBinder</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeserializeJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> json, Type type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fieldNamePrefix, ModelBindingContext bindingContext, ControllerContext controllerContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonSerializerSettings { TypeNameHandling = TypeNameHandling.Auto, MetadataPropertyHandling = MetadataPropertyHandling.ReadAhead, Converters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonConverter[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReactComponentPolimorphicViewModelConverter(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FormBindedConverter(controllerContext, bindingContext, fieldNamePrefix) } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JsonConvert.DeserializeObject(json, type, settings); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindProperty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> ControllerContext controllerContext, ModelBindingContext bindingContext, PropertyDescriptor propertyDescriptor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!propertyDescriptor.Attributes.OfType&lt;JsonBindedAttribute&gt;().Any()) { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.BindProperty(controllerContext, bindingContext, propertyDescriptor); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ControllerContext controllerContext, ModelBindingContext bindingContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.BindModel(controllerContext, bindingContext); <span class="hljs-comment"><span class="hljs-comment">// ... // ,      // ... if (result != null) { FillJsonBindedProperties(controllerContext, bindingContext, result); } return result; } private static string BuildFormVariableFullName(string modelName, string formVariableName) { return modelName.IsNullOrEmpty() ? formVariableName : string.Format("{0}.{1}", modelName, formVariableName); } private void FillJsonBindedProperties( ControllerContext controllerContext, ModelBindingContext bindingContext, object result) { var jsonBindedProperties = result.GetType().GetProperties() .Where(pi =&gt; pi.HasCustomAttribute&lt;JsonBindedAttribute&gt;()) .ToArray(); foreach (var propertyInfo in jsonBindedProperties) { var formFieldFullName = BuildFormVariableFullName( bindingContext.FallbackToEmptyPrefix ? string.Empty : bindingContext.ModelName, propertyInfo.Name); if (controllerContext.HttpContext.Request.Params.AllKeys.Contains(formFieldFullName)) { var json = controllerContext.HttpContext.Request.Params[formFieldFullName]; if (!json.IsNullOrEmpty()) { var convertedObject = DeserializeJson( json, propertyInfo.PropertyType, formFieldFullName, bindingContext, controllerContext); propertyInfo.SetValue(result, convertedObject); } } else { throw new InvalidOperationException( string.Format( "    property {0}   {1}.  99.9%      js.", formFieldFullName, result.GetType().AssemblyQualifiedName)); } } } }</span></span></code> </pre><br></div></div><br> ,    ,      json,    json  ,  ,    99.9%   -   , -      .        ,        . <br>  ,          ,          html,   ,  react- <i></i> .  ,  -    react',        ,        react'.   , ,    .    ,          : <br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b32/481/9cf/b324819cfd044abc8817319b04428926.png"><br></div></div><br>      ,       ¬´¬ª,     js    ,     react ‚Äî ,   .   js,   ,     html  ,  js      . ,         ,        UI-,      ,  react.         ¬´ ¬ª,  ,  react' . <br>      ?  ,   ,   input'        name,       ,   react.    input'    hidden input',   -   .     ,   POST-,    ,   -,   ,  JsonBindedAttribute,  ,              json.  ,     -    ,       FormBindedAttribute,     json   FormBindedConverter,    : <br><div class="spoiler"> <b class="spoiler_title"> FormBindedConverter</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FormBindedConverter</span></span> : <span class="hljs-title"><span class="hljs-title">JsonConverter</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ControllerContext controllerContext; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ModelBindingContext parentBindingContext; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> formNamePrefix; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Type currentType = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Type[] primitiveTypes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormBindedConverter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> ControllerContext controllerContext, ModelBindingContext parentBindingContext, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> formNamePrefix</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.controllerContext = controllerContext; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parentBindingContext = parentBindingContext; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.formNamePrefix = formNamePrefix; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CanConvert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type objectType</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentType != objectType &amp;&amp; !primitiveTypes.Contains(objectType); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">JsonReader reader, Type objectType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> existingValue, JsonSerializer serializer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentJsonPath = reader.Path; currentType = objectType; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = serializer.Deserialize(reader, objectType); currentType = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resultType = result.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formBindedProperties = resultType.GetProperties().Where(p =&gt; p.HasCustomAttribute&lt;FormBindedAttribute&gt;()); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formBindedProperty <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> formBindedProperties) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formBindedPropertyName = formBindedProperty.Name; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formBindedPropertyFullPath = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{formNamePrefix}</span></span></span><span class="hljs-string">.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{currentJsonPath}</span></span></span><span class="hljs-string">.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{formBindedPropertyName}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formBindedPropertyModelBinderAttribute = formBindedProperty.PropertyType.TryGetSingleAttribute&lt;ModelBinderAttribute&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> effectiveBinder = GetBinder(formBindedPropertyModelBinderAttribute); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formBindedObject = effectiveBinder.BindModel( controllerContext, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModelBindingContext(parentBindingContext) { ModelMetadata = ModelMetadataProviders.Current.GetMetadataForType( () =&gt; formBindedProperty.GetValue(result), formBindedProperty.PropertyType), ModelName = formBindedPropertyFullPath }); formBindedProperty.SetValue(result, formBindedObject); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IModelBinder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBinder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ModelBinderAttribute formBindedPropertyModelBinderAttribute</span></span></span><span class="hljs-function">)</span></span> { IModelBinder effectiveBinder; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (formBindedPropertyModelBinderAttribute == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { effectiveBinder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MindboxDefaultModelBinder(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { effectiveBinder = formBindedPropertyModelBinderAttribute.GetBinder(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> effectiveBinder; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">JsonWriter writer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, JsonSerializer serializer</span></span></span><span class="hljs-function">)</span></span> { serializer.Serialize(writer, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre><br></div></div><br>      -    json,         FormBindedAttribute.  -    ,   ,  binder         ,   binder      . <br>           MindboxDefaultModelBinder,     FormBindedConverter,     FilterViewModelBinder,      MindboxDefaultModelBinder. <br><br><h3>  - </h3><br>   UI   ,          .          : <br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/717/f00/787/717f00787659486b8931db5004c79745.png"><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/a38/cbc/88e/a38cbc88e0cb4772ac0ac6baab4a55d2.png"><br></div></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/bec/e74/c88/bece74c8850b45f1826a6caa2f86c294.png"><br></div></div><br>         UI.    ,  switch   ,       .  ,           ,        .    : <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span> DirectCrm { <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringCustomFieldKindComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFieldKindComponentBase</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stringViewModel = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> StringCustomerFieldKindTypedBackendViewModel; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stringConstantData = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.constantComponentData <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> StringCustomFieldKindConstantComponentData; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> validationContext = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.validationContext <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IValidationContext&lt;StringCustomerFieldKindTypedBackendViewModel&gt;; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {super.render() } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FormGroup</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">validationMessage</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{validationContext.getValidationMessageFor(m</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> m.validationStrategySystemName) } &gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Commons.Select</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{stringViewModel.validationStrategySystemName}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"normal"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{getPropertySetter(</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">stringViewModel</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">vm</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> this.props.onChange(vm), m =&gt; m.validationStrategySystemName) } options={stringConstantData.validationStrategies} disabled={this.props.disabled}/&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FormGroup</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">); } } }</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span> DirectCrm { <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultCustomFieldKindComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFieldKindComponentBase</span></span></span><span class="hljs-class"> </span></span>{ } }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span> DirectCrm { <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFieldKindComponentBase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DirectCrm</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFieldKindTypedComponentProps</span></span></span><span class="hljs-class">, </span></span>{}&gt; { render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;FormGroup label = " " validationMessage = { this.props.validationMessageForFieldType } &gt; &lt;div className="form-control"&gt; &lt;Commons.Select value={this.props.fieldType} options={this.props.fieldTypeSelectOptions} width="normal" placeholder=" " onChange={this.props.handleFieldTypeChange} disabled = {this.props.disabled}/&gt; &lt;/div&gt; {this.renderTooltip() } &lt;/FormGroup&gt; } renderTooltip() { return &lt;Commons.Tooltip additionalClasses="tooltip-icon_help" message={this.props.constantComponentData.tooltipMessage }/&gt; } } }</code> </pre><br>             ? <br>        ,      : <br><pre> <code class="javascript hljs">_renderComponent = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fieldTypeSelectOptions = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._componentsMap). map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">Text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._componentsMap[key].name, <span class="hljs-attr"><span class="hljs-attr">Value</span></span>: key }; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentInfo = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._componentsMap[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.model.fieldType]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> TypedComponent = componentInfo.component; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div&gt; &lt;div className="row form_horizontal"&gt; &lt;div className="col-group"&gt; //    &lt;TypedComponent validationContext={this.state.validationContext.getValidationContextFor(m =&gt; m.typedViewModel) } onChange={getPropertySetter( this.state.model, this._setModel, viewModel =&gt; viewModel.typedViewModel) } value={this.state.model.typedViewModel} fieldType={this.state.model.fieldType} validationMessageForFieldType={this.state.validationContext.getValidationMessageFor(m=&gt; m.fieldType) } fieldTypeSelectOptions={fieldTypeSelectOptions} handleFieldTypeChange={this._handleFieldTypeChange} constantComponentData={componentInfo.constantComponentData} disabled={!this.state.model.isNew}/&gt; &lt;/div&gt; //    &lt;/div&gt;); }</code> </pre><br>     ,    TypedComponent,         _componentsMap.  _componentsMap ‚Äî  ,    (   ¬´ ¬ª)   componentInfo,  ,     :   ,   (, url-  -    ),      .NET ,     ,     -.  _componentsMap  json  : <br><div class="spoiler"> <b class="spoiler_title"> ComponentsMap'</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"componentsMap"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"Integer"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"viewModelType"</span></span>:<span class="hljs-string"><span class="hljs-string">"Itc.DirectCrm.Web.IntegerCustomFieldKindTypedViewModel, itc.DirectCrm.Web, Version=6.459.0.3741, Culture=neutral, PublicKeyToken=null"</span></span>, <span class="hljs-string"><span class="hljs-string">"componentName"</span></span>:<span class="hljs-string"><span class="hljs-string">"DirectCrm.DefaultCustomFieldKindComponent"</span></span>, <span class="hljs-string"><span class="hljs-string">"constantComponentData"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"$type"</span></span>:<span class="hljs-string"><span class="hljs-string">"Itc.DirectCrm.Web.IntegerCustomFieldKindTypedViewModel, itc.DirectCrm.Web, Version=6.459.0.3741, Culture=neutral, PublicKeyToken=null"</span></span>, <span class="hljs-string"><span class="hljs-string">"tooltipMessage"</span></span>:<span class="hljs-string"><span class="hljs-string">": 123456"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"Integer"</span></span> } }, <span class="hljs-string"><span class="hljs-string">"String"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"viewModelType"</span></span>:<span class="hljs-string"><span class="hljs-string">"Itc.DirectCrm.Web.StringCustomFieldKindTypedViewModel, itc.DirectCrm.Web, Version=6.459.0.3741, Culture=neutral, PublicKeyToken=null"</span></span>, <span class="hljs-string"><span class="hljs-string">"componentName"</span></span>:<span class="hljs-string"><span class="hljs-string">"DirectCrm.StringCustomFieldKindComponent"</span></span>, <span class="hljs-string"><span class="hljs-string">"constantComponentData"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"$type"</span></span>:<span class="hljs-string"><span class="hljs-string">"Itc.DirectCrm.Web.StringCustomFieldKindTypedViewModel, itc.DirectCrm.Web, Version=6.459.0.3741, Culture=neutral, PublicKeyToken=null"</span></span>, <span class="hljs-string"><span class="hljs-string">"validationStrategies"</span></span>:[ { <span class="hljs-string"><span class="hljs-string">"Disabled"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Group"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Selected"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"Text"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Value"</span></span>:<span class="hljs-string"><span class="hljs-string">"Default"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"Disabled"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Group"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Selected"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Text"</span></span>:<span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"Value"</span></span>:<span class="hljs-string"><span class="hljs-string">"IsValidLatinStringWithWhitespaces"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"Disabled"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Group"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Selected"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Text"</span></span>:<span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"Value"</span></span>:<span class="hljs-string"><span class="hljs-string">"IsValidLatinStringWithDigits"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"Disabled"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Group"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Selected"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Text"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"Value"</span></span>:<span class="hljs-string"><span class="hljs-string">"IsValidDigitString"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"validationStrategySystemName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Default"</span></span>, <span class="hljs-string"><span class="hljs-string">"tooltipMessage"</span></span>:<span class="hljs-string"><span class="hljs-string">": \"\""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"String"</span></span> } }, <span class="hljs-string"><span class="hljs-string">"Enum"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"viewModelType"</span></span>:<span class="hljs-string"><span class="hljs-string">"Itc.DirectCrm.Web.EnumCustomFieldKindTypedViewModel, itc.DirectCrm.Web, Version=6.459.0.3741, Culture=neutral, PublicKeyToken=null"</span></span>, <span class="hljs-string"><span class="hljs-string">"componentName"</span></span>:<span class="hljs-string"><span class="hljs-string">"DirectCrm.EnumCustomFieldKindComponent"</span></span>, <span class="hljs-string"><span class="hljs-string">"constantComponentData"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"$type"</span></span>:<span class="hljs-string"><span class="hljs-string">"Itc.DirectCrm.Web.EnumCustomFieldKindTypedViewModel, itc.DirectCrm.Web, Version=6.459.0.3741, Culture=neutral, PublicKeyToken=null"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectedEnumValues"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"forceCreateEnumValue"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"tooltipMessage"</span></span>:<span class="hljs-string"><span class="hljs-string">":   - \"ExternalId\",  - \"123\""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"Enum"</span></span> } } }</code> </pre><br></div></div><br>     ?        .  ,   ComponentsMap    -  : <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareForViewing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MvcModelContext mvcModelContext</span></span></span><span class="hljs-function">)</span></span> { ComponentsMap = ModelApplicationHostController .Instance .Get&lt;ReactComponentViewModelConfiguration&gt;() .GetNamedObjectRelatedComponentsMapFor&lt;CustomFieldKindTypedViewModelBase, CustomFieldType&gt;( customFieldViewModel =&gt; customFieldViewModel.PrepareForViewing(mvcModelContext)); <span class="hljs-comment"><span class="hljs-comment">//  -  }</span></span></code> </pre><br>  ,  ReactComponentViewModelConfiguration ,  -   CustomFieldKindTypedViewModelBase,    .    : <br><pre> <code class="cs hljs">configuration.RegisterNamedObjectRelatedViewModel&lt;CustomFieldKindTypedViewModelBase, CustomFieldType&gt;( () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringCustomFieldKindTypedViewModel()); configuration.RegisterNamedObjectRelatedViewModel&lt;CustomFieldKindTypedViewModelBase, CustomFieldType&gt;( () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntegerCustomFieldKindTypedViewModel()); configuration.RegisterNamedObjectRelatedViewModel&lt;CustomFieldKindTypedViewModelBase, CustomFieldType&gt;( () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EnumCustomFieldKindTypedViewModel());</code> </pre><br>    -       ,    .         -   C# .    ,   . <br><br><h3>  </h3><br>         : <br><ul><li>      </li><li>      </li><li>       </li></ul><br>    ,       ,   -  ,     .  -           <a href="http://martinfowler.com/eaaDev/Notification.html"> </a> .       ,         .   ,        ,     ,         .        ,       ,   . <br>    .             data-react-validation-summary (.  ReactJsFor ). Validation summary ‚Äî   json,      -    (  ),  ,     -.  ,   validationSummary     : <br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/94d/7f1/aa8/94d7f1aa89b74f5bba745a1134b3fd42.png"><br></div></div><br>         ,   ,      . <br>    validation summary   : <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"typedViewModel"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"selectedEnumValues[0]"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"systemName"</span></span>:[ <span class="hljs-string"><span class="hljs-string">"      250 "</span></span> ] } }, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:[ <span class="hljs-string"><span class="hljs-string">" "</span></span> ] }</code> </pre><br>  ,      ‚Äî     ,    ,   .     ValidationContext,     validation summary,     : <br><pre> <code class="javascript hljs">interface IValidationContext&lt;TViewModel&gt; { <span class="hljs-attr"><span class="hljs-attr">isValid</span></span>: boolean; getValidationMessageFor: { (propertyExpression: {(model: TViewModel):any}): JSX.Element }; validationMessageExpandedFor: { (propertyExpression: {(model: TViewModel):any}): JSX.Element }; getValidationContextFor: { &lt;TProperty&gt;(propertyExpression: {(model: TViewModel):TProperty}): IValidationContext&lt;TProperty&gt; }; getValidationContextForCollection: { &lt;TProperty&gt;(propertyExpression: {(model: TViewModel):TProperty[]}): {(index: number): IValidationContext&lt;TProperty&gt;} } }</code> </pre><br>  ,    .    . ,           ¬´¬ª: <br><pre> <code class="javascript hljs">&lt;FormGroup label=<span class="hljs-string"><span class="hljs-string">""</span></span> validationMessage={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.validationContext.getValidationMessageFor(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m</span></span></span><span class="hljs-function"> =&gt;</span></span> m.name) }&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Commons.Textbox</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.state.model.name}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"normal"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{getPropertySetter(</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this.state.model</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this._setModel</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">viewModel</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> viewModel.name) } /&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FormGroup</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>    this.state.validationContext   IValidationContext&lt;CustomFieldKindValueBackendViewModel&gt;,          .          getPropertyNameByPropertyProvider,  ,           getValidationMessageFor     validation summary    . <br>   ,    validation summary  . <br>        ,   -      ,      .       ,   ,           .         ,         ‚Äî  -.            -    - .      ,      ,      . ,    ‚Äî  ,     ,   ,      ,      ,   validation summary. <br>       -      ¬´¬ª   : <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterEndUserInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> ISubmodelInputRegistrator&lt;CustomFieldKindValueViewModel&gt; registrator, CustomFieldKind customFieldKind</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   registrator.RegisterEndUserInput( customFieldKind, cfk =&gt; cfk.Name, this, m =&gt; m.Name); //   }</span></span></code> </pre><br>  this ‚Äî   -,   Name,   ,     Name  CustomFieldKind customFieldKind.          ,        Name  -. <br>    CustomFieldKind   : <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Validate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ValidationContext validationContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    validationContext .Validate(this, cfk =&gt; cfk.Name) .ToHave(() =&gt; !Name.IsNullOrEmpty()) .OrAddError&lt;CustomFieldCustomizationTemplateComponent&gt;(c =&gt; c.NameRequired); //    }</span></span></code> </pre><br>        ,       ,  ,   CustomFieldKind.Name    ,       ,      . <br><br><h2>  Finally </h2><br>          ,        UI.             ,  ,    ,       :) <br>   ,  ,    -     ,    UI ,      Enterprise.   ,   .    ReactJS,      - . -, ,     ,       ,         !         . </div><p>Source: <a href="https://habr.com/ru/post/276235/">https://habr.com/ru/post/276235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276219/index.html">Researchers have found many critical vulnerabilities in payment protocols</a></li>
<li><a href="../276221/index.html">Typescript 1.8: a lot of new and useful</a></li>
<li><a href="../276223/index.html">UX as Kung Fu (a guide for trolling and staffing adjustments)</a></li>
<li><a href="../276227/index.html">man! (C => D)</a></li>
<li><a href="../276229/index.html">Greetings from FOSDEM 2016</a></li>
<li><a href="../276237/index.html">Analytics Instagram and GAE</a></li>
<li><a href="../276239/index.html">TotalView extends status monitoring for IP PBX 3CX Phone System</a></li>
<li><a href="../276247/index.html">Working with JSON in Swift</a></li>
<li><a href="../276249/index.html">Top free vector icon collections</a></li>
<li><a href="../276251/index.html">Procedurally generated world maps on Unity C #, part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>