<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Virtuozzo Improves Docker Security for Service Providers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the business division, Odin * recently announced support for Docker containers in Virtuozzo . This support is part of our strategy for implementing...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Virtuozzo Improves Docker Security for Service Providers</h1><div class="post__text post__text-html js-mediator-article"><img width="300" src="https://habrastorage.org/files/cf8/72e/2ca/cf872e2ca704469da459376e67ff42ba.jpg" alt="image" align="left">  In the business division, Odin * recently <a href="http://www.odin.com/news/pr/release/article/parallels-virtuozzo-now-provides-native-support-for-docker/">announced support for Docker containers in Virtuozzo</a> .  This support is part of our strategy for implementing Virtuozzo as the infrastructure foundation for container virtualization platforms that are most suitable for work in environments where security and performance are key requirements. <br><br>  It is worth noting that container projects such as Docker are sometimes called competitors to our own development.  In fact, we work at different levels - Docker handles the management of applications, and we virtualize - including the one used in Docker.  As a result, we are often linked by partnerships and collaboration.  For example, together with Docker, we are developing system library projects that provide an interface to nuclear container components ‚Äî this is the Libcontainer project started by Docker (together with Canonical, Google and RedHat), and ours is libct (together with LXC and Google). <br>  Below is an example of the opportunities offered by collaborative technologies. <br><a name="habracut"></a><br>  Docker support inside Virtuozzo adds ‚Äúcontainers inside containers‚Äù to the core of Virtuozzo Linux, allowing you to create Docker containers inside Virtuozzo containers.  This is how additional Docker namespaces appear inside the Virtuozzo virtual container.  A similar scenario in hypervisors, such as KVM, works by default - since the kernel of the guest OS and the server core are separated there, the namespaces do not initially overlap.  Now it is possible to do the same, adding the advantages of container virtualization, namely: fast launch, instant scaling, high elasticity and performance, equal to the performance of physical equipment. <br>  For service providers and everyone else who needs multi-user mode, this also means that the Virtuozzo container can eliminate the Docker security issues without the performance loss that hypervisors provide.  Docker's own delineation tools are very limited ‚Äî for example, as noted <a href="http://reventlov.com/advisories/using-the-docker-command-to-root-the-host">in this article</a> , having access to the Docker command line essentially means having root rights on the server. <br>  Here is an example of a command to get root: <br><br><pre><code class="bash hljs">$ docker run -v <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>:/stuff -t my-docker-image /bin/sh -c \ <span class="hljs-string"><span class="hljs-string">'cp /bin/sh /stuff &amp;&amp; chown root.root /stuff/sh &amp;&amp; chmod a+s /stuff/sh'</span></span></code> </pre> <br><img src="https://habrastorage.org/files/42f/a31/bd0/42fa31bd008246d69b2caf34b5c505ef.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The result of its execution will be a copy of the shell in the current directory, with the suid bit set (which allows you to start the shell not on behalf of the current user, but on behalf of the owner of the file - in this case root). <br><br>  Obviously, in such a configuration it is absolutely impossible to place on the same physical equipment a multitude of potentially hostile users using Docker.  Since they will not be isolated from the point of view of physical resources, one user will be able to easily access the data of another and destroy them. <br><br>  However, this problem is easily solved if Virtuozzo is running on the server.  Creating containers Virtuozzo effectively shares server resources, making the server truly multi-user.  Clients isolated from each other using Virtuozzo containers can use Docker in the same way as on a physical server, but with the addition of a new level of isolation and resource management (and therefore clients do not compete with each other for physical memory, disk space and processor).  As a result, each has its own Docker containers, and the overall performance remains as if they were on a physical server. <br><br>  Here's an example of why Docker is extremely convenient for users who need to run an application in the cloud.  To begin with, let's try running the Docker application on our own laptop: <br><br><pre> <code class="bash hljs">$ docker run hello-world Unable to find image <span class="hljs-string"><span class="hljs-string">'hello-world:latest'</span></span> locally Pulling repository hello-world 91c95931e552: Pulling image (latest) from hello-world, endpoint: https://registr91c95931e552: Download complete a8219747be10: Download complete Status: Downloaded newer image <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> hello-world:latest Hello from Docker. This message shows that your installation appears to be working correctly. ...</code> </pre><br><br>  This can be done many times, correcting the code and eliminating the bugs (of course, when it is not hello world, but something more useful) - at some point we make a decision - everything is ready, it's time to release and implement. <br><br>  Further we do this: <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> DOCKER_HOST=tcp://server:2376 DOCKER_TLS_VERIFY=1</code> </pre><br><br>  (It is assumed that TLS certificates are already decomposed and Docker is configured to trust them).  Server is the address of the server where our application is running in the cloud.  Running a fresh copy of the application on it now is already familiar. <br><br><pre> <code class="bash hljs">$ docker run hello-world</code> </pre><br><br>  Done - the application is running, and, importantly, it hit the server along with the environment and system libraries with which it was debugged and tested - that is, the probability of breaking it with the wrong settings is almost nil. <br>  As a member of the unix docker group inside the Virtuozzo container, each user will still have the opportunity to increase access to root level - but this will be the root of the isolated container, not the root server.  That is, the Virtuozzo container remains single-user ‚Äî but there may already be many of them on the physical server with Docker. <br>  This is just one of the first scenarios supported in Virtuozzo with application containers that we implemented and which we wanted to talk about.  There will be others, so stay tuned. <br><br>  <i>* Under this new brand, a business division of Parallels company has been operating since March 2015, responsible for solutions for service providers</i> <br><br>  The video below shows clearly how to start Wordpress using Docker inside the Virtuozzo container: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/rh4oPpLtdYc%3Ffeature%3Doembed&amp;xid=17259,1500004,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiCdI0fakr7xR3SgaBVlQlqOp7khw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/256961/">https://habr.com/ru/post/256961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256945/index.html">FlyElephant is a creative laboratory for scientists and engineers. Part 1. The history of creation</a></li>
<li><a href="../256947/index.html">SwipeRefreshLayout: not spherical and not in vacuum</a></li>
<li><a href="../256951/index.html">Unity3d: Experiments with the Social Interface</a></li>
<li><a href="../256955/index.html">Microsoft Research for young scientists - communication and the opportunity to discuss their work with leading scientists from Microsoft</a></li>
<li><a href="../256959/index.html">So why implement ERP systems?</a></li>
<li><a href="../256963/index.html">Frameworks spoil development</a></li>
<li><a href="../256965/index.html">What is Virtual DOM?</a></li>
<li><a href="../256967/index.html">Apple is investing $ 1.9 billion in EU infrastructure. What is it, expansion to Europe or escape from the USA?</a></li>
<li><a href="../256971/index.html">Waski loader is used to distribute the banker Dyreza Trojan</a></li>
<li><a href="../256975/index.html">Audit of one ‚Äúslow‚Äù application in one large concern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>