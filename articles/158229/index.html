<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience developing a plugin for Yasca</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to share the experience of using one useful utility that allows you to automate the assembly and analysis of code quality. It w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience developing a plugin for Yasca</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to share the experience of using one useful <a href="http://www.scovetta.com/yasca.html">utility</a> that allows you to automate the assembly and analysis of code quality.  It will be about Yasca - free software, which is a small PHP engine and a set of utilities for performing Java, C ++ or PHP code analysis, including PMD, JLint and RATS.  The very integration of the execution of these utilities is carried out by developing small plug-ins in PHP.  The development process of such a plugin and will be discussed further. <br><a name="habracut"></a><br>  To begin with, we need to achieve the functioning of Yasca itself.  To do this is quite simple.  Go to <a href="http://sourceforge.net/projects/yasca/files/Yasca%25202.x/Yasca%25202.1/">the download page</a> and download the actual <a href="http://sourceforge.net/projects/yasca/files/Yasca%25202.x/Yasca%25202.1/yasca-2.1.zip/download">yasca</a> and one of the <a href="http://sourceforge.net/projects/yasca/files/Yasca%25202.x/Yasca%25202.1/yasca-2.1-pmd.zip/download">codecs</a> .  Create a local directory (for example, c: / yasca) and simply unpack all the archives into it in turn.  Immediately after this, the tool is ready to go.  We type in the command line (or save to cmd-file) the command (replacing the ellipsis with the directory path with some Java or C ++ project): <br><br><pre><code class="bash hljs">yasca.exe -o ./Report ...</code> </pre> <br>  After working for some time, Yasca forms the Report.html report containing comments on the coding style of our project.  The report lines contain links to the source code and the only thing that is inconvenient is that when you click a link, we get to the beginning of the file, and it may be a bit tiring to search for the required line by number.  That is what I propose to fix.  Let the links position us immediately to the desired line of source code. <br><br>  It is clear that we cannot turn this focus directly on the source code, but we can build temporary html files on their basis by forming a bookmark in each line, for which name we use the line number.  At the same time, on the left, we will put line numbers to make it easier to navigate.  It sounds scary, but in fact, is done quite simply.  The plug-in itself (you will need to put it in the plugins folder, calling Mirror.php) will look like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@extends</span></span></span><span class="hljs-comment"> Plugin * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@package</span></span></span><span class="hljs-comment"> Yasca */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plugin_Mirror</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plugin</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $valid_file_types = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"java"</span></span>, <span class="hljs-string"><span class="hljs-string">"c"</span></span>, <span class="hljs-string"><span class="hljs-string">"cpp"</span></span>, <span class="hljs-string"><span class="hljs-string">"h"</span></span>, <span class="hljs-string"><span class="hljs-string">"cs"</span></span>, <span class="hljs-string"><span class="hljs-string">"sql"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rmdir_recurse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($path)</span></span></span><span class="hljs-function"> </span></span>{ $path= rtrim($path, <span class="hljs-string"><span class="hljs-string">'/'</span></span>).<span class="hljs-string"><span class="hljs-string">'/'</span></span>; $handle = opendir($path); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> !== ($file = readdir($handle));) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($file != <span class="hljs-string"><span class="hljs-string">"."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $file != <span class="hljs-string"><span class="hljs-string">".."</span></span> ) { $fullpath= $path.$file; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( is_dir($fullpath) ) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;rmdir_recurse($fullpath); rmdir($fullpath); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> unlink($fullpath); } closedir($handle); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $yasca =&amp; Yasca::getInstance(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $once = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($once) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;rmdir_recurse(<span class="hljs-string"><span class="hljs-string">'./Mirror'</span></span>); } $once = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!check_in_filetype(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;filename, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;valid_file_types)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } $filename = preg_replace(<span class="hljs-string"><span class="hljs-string">'/\w:/'</span></span>, <span class="hljs-string"><span class="hljs-string">'./Mirror'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;filename) . <span class="hljs-string"><span class="hljs-string">".html"</span></span>; $dir_name = preg_replace(<span class="hljs-string"><span class="hljs-string">'/[\\\\\\/][^\\\\\\/]+$/'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $filename); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($dir_name)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mkdir($dir_name, <span class="hljs-number"><span class="hljs-number">0777</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($filename)) { unlink($filename); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$handle = fopen($filename, <span class="hljs-string"><span class="hljs-string">'w+'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; fwrite($handle,<span class="hljs-string"><span class="hljs-string">"&lt;html&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html;charset=windows-1251\" /&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;\n"</span></span>); $line = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;file_contents <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $file_line) { $str = $line; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (strlen($str)&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>) { $str = <span class="hljs-string"><span class="hljs-string">" "</span></span> . $str; } fwrite($handle,<span class="hljs-string"><span class="hljs-string">"&lt;a name=$line&gt;&lt;/a&gt;$str: $file_line&lt;br&gt;\n"</span></span>); $line++; } fwrite($handle,<span class="hljs-string"><span class="hljs-string">"&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;"</span></span>); fclose($handle); } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  Now, after the next launch of yasca, we will receive copies of all analyzed files in the Mirror directory in the prepared in html form.  In order to make these files useful, we will have to intervene in the course of building the report and replace the links to our version that they form.  Fortunately, this code is also written in PHP.  Go to the lib directory and find the HTMLGroupReport.php file used to create the report, by default.  In this file, we find the fragment: <br><br><pre> <code class="php hljs">fwrite($handle, <span class="hljs-string"><span class="hljs-string">"&lt;a style=\"margin-right: 12px;\" source_code_link=\"true\" href=\"file://$filename\" target=\"_blank\" title=\"$filename\"&gt;$filename_base$line_number_field&lt;/a&gt;"</span></span> . <span class="hljs-string"><span class="hljs-string">"&lt;/td&gt;"</span></span>);</code> </pre><br>  And replace it with: <br><br><pre> <code class="php hljs">$chg_file_name = getcwd(); $chg_file_name = preg_replace(<span class="hljs-string"><span class="hljs-string">'/\\\\/'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>, $chg_file_name); $chg_file_name = preg_replace(<span class="hljs-string"><span class="hljs-string">'/^\w:/'</span></span>, $chg_file_name . <span class="hljs-string"><span class="hljs-string">'/Mirror'</span></span>, $filename); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match(<span class="hljs-string"><span class="hljs-string">'/\.java$|\.c$|\.cpp$|\.h$|\.cs$|\.sql$/i'</span></span>, $chg_file_name)) { fwrite($handle, <span class="hljs-string"><span class="hljs-string">"&lt;a style=\"margin-right: 12px;\" source_code_link=\"true\" href=\"file://$chg_file_name.html#$line_number\" target=\"code\" title=\"$filename\"&gt;$filename_base$line_number_field&lt;/a&gt;"</span></span> . <span class="hljs-string"><span class="hljs-string">"&lt;/td&gt;"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { fwrite($handle, <span class="hljs-string"><span class="hljs-string">"&lt;a style=\"margin-right: 12px;\" source_code_link=\"true\" href=\"file://$filename\" target=\"_blank\" title=\"$filename\"&gt;$filename_base$line_number_field&lt;/a&gt;"</span></span> . <span class="hljs-string"><span class="hljs-string">"&lt;/td&gt;"</span></span>); }</code> </pre><br>  After that, run Yasca again and make sure that everything works.  In terms of further automation, our imagination is not very limited.  We, for example, had a plugin automating the assembly of a large C ++ project under Windows using MSBuild.  Since the build itself took about an hour, a slight slowdown associated with the work of Yasca and the codecs did not play a role.  But at the exit we received a report containing both Warning and comments on the Code Style, with convenient positioning in the source code. <br></div><p>Source: <a href="https://habr.com/ru/post/158229/">https://habr.com/ru/post/158229/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158215/index.html">Freelance School</a></li>
<li><a href="../158217/index.html">DARPA is working on an intelligent crime prediction system.</a></li>
<li><a href="../158219/index.html">We work with SteamWorks. Part 3</a></li>
<li><a href="../158223/index.html">Life in the era of "dark" silicon. Part 1</a></li>
<li><a href="../158225/index.html">Dynamic personalized reporting reporting tools Crystal Reports</a></li>
<li><a href="../158231/index.html">Pseudo-Holography Screen Technologies</a></li>
<li><a href="../158233/index.html">Karateka game remake</a></li>
<li><a href="../158235/index.html">Writing a plugin for jQuery</a></li>
<li><a href="../158239/index.html">About cameras and lenses</a></li>
<li><a href="../158245/index.html">Matt Cutts: Do not keep the domain in the parking lot before opening the site</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>