<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Weka project for the task of recognition of tonality (sentiment)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a translation of my publication in English . 

 The Internet is full of articles, notes, blogs, and successful machine learning (ML) stories t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Weka project for the task of recognition of tonality (sentiment)</h1><div class="post__text post__text-html js-mediator-article">  This is a translation of my <a href="http://dmitrykan.blogspot.fi/2014/04/weka-template-project-for-sentiment.html">publication in English</a> . <br><br>  The Internet is full of articles, notes, blogs, and successful machine learning (ML) stories to solve practical problems.  Someone uses it for good and just cheer up like this image: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/171/65a/730/17165a730ce59e47fa1020b4e11e4aaf.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, it is sometimes not so easy for a person who is not an expert in these areas to get close to existing tools.  There are certainly good and relatively fast paths to practical machine learning, for example, the <a href="http://scikit-learn.org/stable/">scikit</a> Python library.  By the way, <a href="https://github.com/DmitryKey/kaggle_stackexchange_prediction">this project</a> contains code written in the SkyNet team (the author happened to be its leading participant) and illustrating the simplicity of interaction with the library.  If you're a Java developer, there are a couple of good tools: <a href="http://www.cs.waikato.ac.nz/ml/weka/">Weka</a> and <a href="https://mahout.apache.org/">Apache Mahout</a> .  Both libraries are universal in terms of applicability to a specific task: from recommender systems to text classification.  There are tools and more honed under the text machine learning: <a href="http://mallet.cs.umass.edu/">Mallet</a> and a set of libraries <a href="http://www-nlp.stanford.edu/software/index.shtml">Stanford</a> .  There are also lesser-known libraries like <a href="http://java-ml.sourceforge.net/">Java-ML</a> . <br><br>  In this post, we will focus on the Weka library and make a draft or template project for text machine learning with a specific example: the task of recognizing tonality or sentiment (sentiment analysis, sentiment detection).  Despite all this, the project is fully operational and even under a commercial-friendly license (Weka itself under GPL 3.0), i.e.  with a great desire, you can even apply the code in your projects. <a name="habracut"></a><br><br>  From the entire set of generally suitable Weka algorithms for the selected task, we use the <a href="http://en.wikipedia.org/wiki/Naive_Bayes_classifier">Multinomial Naive Bayes</a> algorithm.  In this post, I almost always cite the same links as in the English version.  But since the translation task is creative, let me give a link on the subject to the <a href="http://www.machinelearning.ru/wiki/index.php%3Ftitle%3D%25D0%259D%25D0%25B0%25D0%25B8%25D0%25B2%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B1%25D0%25B0%25D0%25B9%25D0%25B5%25D1%2581%25D0%25BE%25D0%25B2%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25BA%25D0%25BB%25D0%25B0%25D1%2581%25D1%2581%25D0%25B8%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580">domestic resource for machine learning</a> . <br><br>  In my opinion and experience of interacting with machine learning tools, usually a programmer is looking for a solution to three problems when using this or that ML library: setting up an algorithm, training an algorithm and I / O, i.e.  saving to disk and loading from disk of the trained model into memory.  In addition to these purely practical aspects of the theoretical, perhaps the most important is the assessment of the quality of the model.  We will touch this too. <br><br>  So, in order. <br><br><h4>  Setting the classification algorithm </h4><br>  Let's start with the task of recognition of tonality into three classes. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThreeWayMNBTrainer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> NaiveBayesMultinomialText classifier; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String modelFile; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instances dataRaw; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThreeWayMNBTrainer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String outputModel)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// create the classifier classifier = new NaiveBayesMultinomialText(); // filename for outputting the trained model modelFile = outputModel; // listing class labels ArrayList&lt;attribute&gt; atts = new ArrayList&lt;attribute&gt;(2); ArrayList&lt;string&gt; classVal = new ArrayList&lt;string&gt;(); classVal.add(SentimentClass.ThreeWayClazz.NEGATIVE.name()); classVal.add(SentimentClass.ThreeWayClazz.POSITIVE.name()); atts.add(new Attribute("content",(ArrayList&lt;string&gt;)null)); atts.add(new Attribute("@@class@@",classVal)); // create the instances data structure dataRaw = new Instances("TrainingInstances",atts,10); } }</span></span></code> </pre> <br>  In the above code, the following happens: <br><br><ul><li>  An object of the classification algorithm class is created (we love puns) </li><li>  A list of target class labels is given: NEGATIVE and POSITIVE </li><li>  Creates a data structure to store pairs (object, class label) </li></ul><br><br>  Similarly, but with a larger number of output labels, a classifier is created for 5 classes: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiveWayMNBTrainer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> NaiveBayesMultinomialText classifier; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String modelFile; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instances dataRaw; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FiveWayMNBTrainer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String outputModel)</span></span></span><span class="hljs-function"> </span></span>{ classifier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NaiveBayesMultinomialText(); classifier.setLowercaseTokens(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); classifier.setUseWordFrequencies(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); modelFile = outputModel; ArrayList&lt;Attribute&gt; atts = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Attribute&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>); ArrayList&lt;String&gt; classVal = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;String&gt;(); classVal.add(SentimentClass.FiveWayClazz.NEGATIVE.name()); classVal.add(SentimentClass.FiveWayClazz.SOMEWHAT_NEGATIVE.name()); classVal.add(SentimentClass.FiveWayClazz.NEUTRAL.name()); classVal.add(SentimentClass.FiveWayClazz.SOMEWHAT_POSITIVE.name()); classVal.add(SentimentClass.FiveWayClazz.POSITIVE.name()); atts.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Attribute(<span class="hljs-string"><span class="hljs-string">"content"</span></span>,(ArrayList&lt;String&gt;)<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); atts.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Attribute(<span class="hljs-string"><span class="hljs-string">"@@class@@"</span></span>,classVal)); dataRaw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Instances(<span class="hljs-string"><span class="hljs-string">"TrainingInstances"</span></span>,atts,<span class="hljs-number"><span class="hljs-number">10</span></span>); } }</code> </pre><br><br><h4>  Classifier Training </h4><br>  The training of the classification algorithm or classifier consists in reporting the example algorithm (object, label) placed in the pair (x, y).  An object is described by some features, by a set (or vector) of which one can qualitatively distinguish an object of one class from an object of another class.  For example, in the task of classifying objects-fruits, for example, into two classes: oranges and apples, such signs could be: size, color, presence of pimples, presence of a tail.  In the context of the key recognition task, the feature vector may consist of words (unigrams) or pairs of words (bigrams).  And the labels will be the names (or sequence numbers) of the tonality classes: NEGATIVE, NEUTRAL or POSITIVE.  Based on the examples, we expect that the algorithm will be able to learn and generalize to the level of prediction of the unknown label y 'by the feature vector x'. <br><br>  We implement the method of adding a pair (x, y) to classify tonality into three classes.  We assume that the feature vector is a list of words. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTrainingInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SentimentClass.ThreeWayClazz threeWayClazz, String[] words)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[] instanceValue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[dataRaw.numAttributes()]; instanceValue[<span class="hljs-number"><span class="hljs-number">0</span></span>] = dataRaw.attribute(<span class="hljs-number"><span class="hljs-number">0</span></span>).addStringValue(Join.join(<span class="hljs-string"><span class="hljs-string">" "</span></span>, words)); instanceValue[<span class="hljs-number"><span class="hljs-number">1</span></span>] = threeWayClazz.ordinal(); dataRaw.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DenseInstance(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, instanceValue)); dataRaw.setClassIndex(<span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br><br>  In fact, as a second parameter, we could pass in a method and a string instead of an array of strings.  But we deliberately work with an array of elements so that the code above is able to impose the filters we want.  For the analysis of tonality, a completely relevant filter is the gluing of the words of the negatives (particles, etc.) followed by the word: <b>do not</b> <i>like</i> =&gt; <b>do not</b> _ <i>like</i> .  Thus, signs <i>like</i> and <b>not</b> <i>like</i> form bipolar entities.  Without gluing, we would get that the word <i>like</i> can occur in both positive and negative contexts, which means it does not carry the right signal (as opposed to reality).  In the next step, when building the classifier, the string from the element-rows will be tokenized and turned into a vector. <br><br>  Actually, the classifier training is implemented in one line: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trainModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ classifier.buildClassifier(dataRaw); }</code> </pre><br><br>  Simply! <br><br><h4>  I / O (saving and loading model) </h4><br>  A very common scenario in the field of machine learning is the training of the classifier model in memory and the subsequent recognition / classification of new objects.  However, to work as part of a product, the model must be supplied on disk and loaded into memory.  Saving to disk and loading from disk to the memory of a trained model in Weka is achieved very simply due to the fact that the classes of classification algorithms implement the Serializable interface among many others. <br><br>  Saving a trained model: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ weka.core.SerializationHelper.write(modelFile, classifier); }</code> </pre><br><br>  Trained model loading: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String _modelFile)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ NaiveBayesMultinomialText classifier = (NaiveBayesMultinomialText) weka.core.SerializationHelper.read(_modelFile); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.classifier = classifier; }</code> </pre><br><br>  After loading the model from the disk, let's classify the texts.  For the three-class prediction, we implement the following method: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SentimentClass.<span class="hljs-function"><span class="hljs-function">ThreeWayClazz </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">classify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String sentence)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[] instanceValue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[dataRaw.numAttributes()]; instanceValue[<span class="hljs-number"><span class="hljs-number">0</span></span>] = dataRaw.attribute(<span class="hljs-number"><span class="hljs-number">0</span></span>).addStringValue(sentence); Instance toClassify = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DenseInstance(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, instanceValue); dataRaw.setClassIndex(<span class="hljs-number"><span class="hljs-number">1</span></span>); toClassify.setDataset(dataRaw); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> prediction = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.classifier.classifyInstance(toClassify); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> distribution[] = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.classifier.distributionForInstance(toClassify); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (distribution[<span class="hljs-number"><span class="hljs-number">0</span></span>] != distribution[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SentimentClass.ThreeWayClazz.values()[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)prediction]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SentimentClass.ThreeWayClazz.NEUTRAL; }</code> </pre><br><br>  Pay attention to the line <i>if (distribution [0]! = Distribution [1])</i> .  As you remember, we defined the list of class labels for this case as: {NEGATIVE, POSITIVE}.  Therefore, in principle, our classifier should be at least binary.  But!  If the probability distribution of the two tags is the same (50% for each), we can confidently assume that we are dealing with a neutral class.  Thus, we get a classifier into three classes. <br><br>  If the classifier is built correctly, then the following unit test should work correctly: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@org</span></span>.junit.<span class="hljs-function"><span class="hljs-function">Test </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testArbitraryTextPositive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ threeWayMnbTrainer.loadModel(modelFile); Assert.assertEquals(SentimentClass.ThreeWayClazz.POSITIVE, threeWayMnbTrainer.classify(<span class="hljs-string"><span class="hljs-string">"I like this weather"</span></span>)); }</code> </pre><br><br>  For completeness, we implement a wrapper class that builds and trains a classifier, saves the model to disk and tests the model for quality: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThreeWayMNBTrainerRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ KaggleCSVReader kaggleCSVReader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KaggleCSVReader(); kaggleCSVReader.readKaggleCSV(<span class="hljs-string"><span class="hljs-string">"kaggle/train.tsv"</span></span>); KaggleCSVReader.CSVInstanceThreeWay csvInstanceThreeWay; String outputModel = <span class="hljs-string"><span class="hljs-string">"models/three-way-sentiment-mnb.model"</span></span>; ThreeWayMNBTrainer threeWayMNBTrainer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ThreeWayMNBTrainer(outputModel); System.out.println(<span class="hljs-string"><span class="hljs-string">"Adding training instances"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> addedNum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((csvInstanceThreeWay = kaggleCSVReader.next()) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (csvInstanceThreeWay.isValidInstance) { threeWayMNBTrainer.addTrainingInstance(csvInstanceThreeWay.sentiment, csvInstanceThreeWay.phrase.split(<span class="hljs-string"><span class="hljs-string">"\\s+"</span></span>)); addedNum++; } } kaggleCSVReader.close(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Added "</span></span> + addedNum + <span class="hljs-string"><span class="hljs-string">" instances"</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Training and saving Model"</span></span>); threeWayMNBTrainer.trainModel(); threeWayMNBTrainer.saveModel(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Testing model"</span></span>); threeWayMNBTrainer.testModel(); } }</code> </pre><br><br><h4>  Quality model </h4><br>  As you may have guessed, testing the quality of the model is also quite simple with Weka.  The calculation of the quality characteristics of the model is necessary, for example, in order to check whether our model has been retrained or underestimated.  With the lack of knowledge of the model, it is intuitively clear: we did not find the optimal number of signs of classified objects, and the model turned out to be too simple.  Re-training means that the model is too adjusted for examples, i.e.  it does not generalize to the real world, being unnecessarily complicated. <br><br>  There are different ways to test a model.  One of these methods is to select a test sample from the training set (say, one third) and run through cross-validation.  Those.  at each new iteration, we take a new one-third of the training set as a test sample and calculate relevant quality parameters for the problem being solved, for example, accuracy / completeness / accuracy, etc.  At the end of such a run, we calculate the average for all iterations.  This will be a depreciated quality model.  That is, in practice it may be lower than in the full training data set, but closer to quality in real life. <br><br>  However, for a quick glance at the accuracy of the model, it is enough to calculate accuracy, i.e.  the number of correct answers to incorrect: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ Evaluation eTest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Evaluation(dataRaw); eTest.evaluateModel(classifier, dataRaw); String strSummary = eTest.toSummaryString(); System.out.println(strSummary); }</code> </pre><br><br>  This method displays the following statistics: <br><br><pre> <code class="tex hljs">Correctly Classified Instances 28625 83.3455 <span class="hljs-comment"><span class="hljs-comment">% Incorrectly Classified Instances 5720 16.6545 % Kappa statistic 0.4643 Mean absolute error 0.2354 Root mean squared error 0.3555 Relative absolute error 71.991 % Root relative squared error 87.9228 % Coverage of cases (0.95 level) 97.7697 % Mean rel. region size (0.95 level) 83.3426 % Total Number of Instances 34345</span></span></code> </pre><br><br>  Thus, the accuracy of the model for the entire training set of 83.35%.  The complete project with the code can be found on my <a href="https://github.com/DmitryKey/weka-mnb-sentiment-analysis-template-project">github</a> .  The code uses data from <a href="http://www.kaggle.com/c/sentiment-analysis-on-movie-reviews/">kaggle</a> .  Therefore, if you decide to use the code (or even compete in the competition), you will need to accept the conditions of participation and download data.  The task of implementing the complete code for classifying the tonality into 5 classes remains for the reader.  Successes! </div><p>Source: <a href="https://habr.com/ru/post/229779/">https://habr.com/ru/post/229779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229763/index.html">YaLinqo (LINQ to Objects for PHP) - version 2.0</a></li>
<li><a href="../229765/index.html">Juniper SRX Series Basic Setup</a></li>
<li><a href="../229767/index.html">Efficient multithreading in Python</a></li>
<li><a href="../229773/index.html">Android "Evolution": how it was</a></li>
<li><a href="../229777/index.html">How to communicate with the 36-year-old space probe using GNU Radio</a></li>
<li><a href="../229781/index.html">To help the school sysadmin</a></li>
<li><a href="../229783/index.html">Android game development</a></li>
<li><a href="../229797/index.html">Vladimir Stasevich (Bank XXI, Sberbank): "We must prepare and prepare for the next stage of evolution - mass mobile banking"</a></li>
<li><a href="../229799/index.html">Go + Heroku: web application deployment</a></li>
<li><a href="../229801/index.html">Materials for the manufacture of mobile devices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>