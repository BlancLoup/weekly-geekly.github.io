<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>From MS SharePoint to Bitrix24: One Way Ticket</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 2017, Zetta Insurance decided to abandon Microsoft SharePoint in favor of Bitrix24. Why, why and how - under the cut. 

 Among the prerequisites we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>From MS SharePoint to Bitrix24: One Way Ticket</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/618/ca9/332/618ca9332df603ab7209bc0b9b0d819e.png" alt="image"></div><br>  In 2017, Zetta Insurance decided to abandon Microsoft SharePoint in favor of Bitrix24.  Why, why and how - under the cut. <br><a name="habracut"></a><br>  Among the prerequisites were: <br><br><ul><li>  The high cost of ownership of MS SharePoint compared to the available licensing model Bitrix24; </li><li>  multifunctionality Bitrix24; </li><li>  general trend for import substitution (but this is not certain). </li></ul><br>  The deadlines were very tight, and SharePoint (SP) was branded.  It included a couple of custom modifications and contained gigabytes of data that in no case should have been lost when moving: <br><br><ul><li>  news portal with likes and comments to the news; </li><li>  separate sites for company divisions (instructions, regulations, etc.); </li><li>  dozens of file libraries; </li><li>  staff training materials; </li><li>  several automated business processes (which it was immediately decided to move out of the framework of migration - it‚Äôs still up to hand to create again). </li></ul><br>  The new portal on Bitrix24 was conceived by a branded, integrated with AD with customized SSO and user-friendly.  Ideally, users should not have felt the effect of the transition at all. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, shook hands (thanks to Habr for introducing us).  Hard work began, fragments of which we make public, so that followers do not stumble in search of solutions, sometimes very, very refined.  After all, these are not just two competing products, but two ecosystems unfriendly to each other. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f5d/7bb/d66/f5d7bbd664db24c0b0f3c5afd3bf8bc7.png" alt="image"><br><br><h3>  To sell something unnecessary, you must first buy something unnecessary.  (c) Uncle Fedor </h3><br>  The first thing to migrate is to get the data upload from SharePoint in a digestible format.  Some of the information (news, user data, file metadata) was simply taken from the SP database as XML.  It was more difficult with the files - they were unloaded into a separate archive, and in the above-mentioned XML, in addition to metadata, they recorded the path to the file from the root of the archive.  However, the content of the portal pages could not be collected in this way: not only is the information spread over dozens of sites, it is also stored in tables in an unusable form, with snippets in the SP format. <br><br>  To transfer the content of the pages, we ventured to the parsing of the combat portal, collecting the generated HTML from them - this path seemed optimal.  To do this, they took a <a href="https://github.com/FriendsOfPHP/Goutte">crawler</a> , and on the very first day they encountered a problem: it does not accept the @ symbol in NTLM authorization (I had to ask the customer to change the password for the account).  Next is the small thing - we define entry points, exceptions (so as not to collect unnecessary, for example, user profiles) and the content area (it makes no sense to parse the whole page, since Bitrix24 has its own template with a header and footer).  The content of the area was saved to a PHP file with the same name and address relative to the site root, which simplified the work on restoring links between pages and made it possible to use the regular visual editor in Bitrix24.  The received content contained calls to the SP file manager (replaced by a component call for outputting the corresponding Bitrix24 Drive folder), a call to the Flash player (replaced by HTML5 tools) and numerous links to other pages (resulted in a view relative to the site root, removing the domain name from the link). <br><br><h3>  AD: magic out of the box or purgatory integrator? </h3><br>  The unloading is ready and given to the customer for approval, and in the meantime we are moving on to the migration itself.  Let's start with users, which are initially created from Active Directory, and then enriched with data from SP by means of prepared XML. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/635/416/5af/6354165af4a7c3620be2088c62f22611.png" alt="image"><br><br>  Among customers and young integrators - anyone who has not come across in practice with the integration of Bitrix24 with AD, it is considered to be out of the box.  All so, if the box called Pandora's box.  The point is not at all that it is a bunch of technologies working on different platforms - Linux and Windows.  And not in the understanding of the work of samba, without which a step aside from the regular setup wizard is equivalent to a step in a swampy marsh.  And not even in those two weeks for which it is really possible to establish network interaction (during the last integration, our sysadmins broke the tambourine). <br><br>  When the fields were set up and users were taken away, the problem with the structure of the company was revealed.  The customer had departments with the same name, located in different branches of the company.  Bitriks24 believed that this is the same department and united them.  Of the proposed solutions (modification of the Bitrix24 core, modification of the transmitted data on the fly, modification of the structure in AD under the Bitrix24 requirements), this time the most correct one was chosen, which allowed to put an end to this question. <br><br><h3>  Partition tree </h3><br>  The next step is to transfer departmental page and file data.  With the help of the parser, we prepared a tree of sections and pages corresponding to the paths on SharePoint.  In view of the detected conflicts with some service sections of Bitrix24, we placed it in the / content / section, and for all internal links to work, we organized a redirect for apache: <br><br><pre><code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span></span></span> ^(.*)\.aspx$ /content<span class="hljs-number"><span class="hljs-number">$1</span></span>\.php<span class="hljs-meta"><span class="hljs-meta"> [R=301,L]</span></span></code> </pre> <br>  The files after uploading are also located in our tree and are located in the multi-gigabyte archive, which we will unpack to / upload / sp /.  ‚ÄúRevive‚Äù their run through the script with the addition to the Disk (for the necessary sections) and the nginx rule for the existing links: <br><br><pre> <code class="php hljs">location ~* \.(doc|docx|jpeg|jpg|pdf|png|ppt|pptx|rar|txt|xls|xlsx|zip)$ { try_files $uri /upload/files$uri = <span class="hljs-number"><span class="hljs-number">404</span></span>; }</code> </pre> <br><h3>  About bravado, branding and budget </h3><br>  There are news and appearance - the very branding, which often takes hundreds of hours and kilometers of integrators' nerves, and costs the customer a little less than putting a falcon into orbit with the return of the first stage.  The result of such a titanic effort is usually the newly revised Bitrix24 template, the maintenance costs of which are comparable to the cost of creation: any updating of the Bitrix24 interfaces will require changing the template with all the consequences. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/053/e59/dd9/053e59dd9109cde19bba85e9acd9e3b3.png" alt="image"><br>  We liked to abandon the monkey labor and save the customer‚Äôs budget: we limited ourselves to the color scheme and the addition of several elements like the slider and the custom menu.  Economy option with preservation of updates.  By the way, it turned out quite well.  We made a separate template for news, adapting the layout of the original. <br><br><h3>  Instead of an epilogue </h3><br>  To close the task, there were still a few touches like the menu settings and other cosmetics, the configuration of cluster architecture to ensure fault tolerance, but not about this today.  And today we wanted to give praise to the Russian engineers, and on the living example once again show that everything is possible.  A wolf is not so terrible, if it is not the first time in the forest, and you are riding a UAZ with Mikhalych. <br><br>  All good integrations! </div><p>Source: <a href="https://habr.com/ru/post/349110/">https://habr.com/ru/post/349110/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349098/index.html">We expand automation in a couple of hours: PHPUnit, Selenium, Composer</a></li>
<li><a href="../349100/index.html">Digest news from the world of PostgreSQL. Issue number 3</a></li>
<li><a href="../349102/index.html">Immersion in Android services</a></li>
<li><a href="../349104/index.html">Who killed the junior?</a></li>
<li><a href="../349106/index.html">What is a programmer?</a></li>
<li><a href="../349112/index.html">Why IT wages will start falling soon?</a></li>
<li><a href="../349114/index.html">Avito Data Science Meetup: Personalization</a></li>
<li><a href="../349116/index.html">Equifax is under attack again: last year‚Äôs data breach turned out to be much more serious</a></li>
<li><a href="../349120/index.html">Migration at high speeds. What to choose?</a></li>
<li><a href="../349122/index.html">How ‚Äúthe survivor‚Äôs mistake‚Äù makes it difficult to draw conclusions in content marketing and smm</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>