<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NetApp E2700 Testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I haven‚Äôt come across any tests for an entry-level array that can run up to 1.5 Gb / s through a single controller with streaming through one controll...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NetApp E2700 Testing</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/99f/47f/292/99f47f2928d9442aa3609e39651fbdc1.jpg" alt="Testing NetApp E2700" title="NetApp E2700 Testing"><br><br>  I haven‚Äôt come across any tests for an entry-level array that can run up to 1.5 Gb / s through a single controller with streaming through one controller.  NetApp E2700 just coped with this task.  In June, I spent <a href="http://habrahabr.ru/company/it-grad/blog/224701/">Unboxing NetApp E2700</a> .  And now I am ready to share with you the results of testing this storage system.  Below are the results of load tests and the resulting quantitative performance indicators of the NetApp E-Series 2700 array (IOps, Throughput, Latency). <a name="habracut"></a><br><br>  The configuration of the disk array is as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/eff/1ed/9b9/eff1ed9b91c34c40b3ea9172a801c4f2.png" alt="   NetApp E2700" title="NetApp E2700 Disk Array Configuration"><br><br>  Array connection to the server: <br><br><img src="https://habrastorage.org/files/990/9ec/710/9909ec71021f4645a40a81e13b4db834.png" alt="   NetApp E2700  " title="Connection diagram of the NetApp E2700 array to the server"><br><br>  And test server configuration: <br><br><img src="https://habrastorage.org/files/b76/941/4c6/b769414c662044a99d171966bb3e04e2.png" alt="  " title="Test Server Configuration"><br><br><h3>  Testing methodology </h3><br>  As a load generator, I use the FIO benchmark, as the most "true" benchmark under Linux.  I want to get data on average speed (bandwith, Mb / s) and average delays (latency, ms) with the following types of load: <br><ol><li>  100% sequential reading, in blocks of 256 kb, 512 Kb and 1024 Kb; </li><li>  100% sequential recording, in blocks of 256 kb, 512 Kb and 1024 Kb; </li><li>  Mixed sequential read / write (50/50), in blocks of 256 kb, 512 Kb and 1024 Kb; </li><li>  100% random reading, in blocks of 4 kb, 8 Kb and 16 Kb; </li><li>  100% random recording in blocks of 4 kb, 8 Kb and 16 Kb; </li><li>  Mixed random read / write (50/50), in blocks of 256 kb, 512 Kb and 1024 Kb; </li></ol><br>  In this case, I will use two LUNs from the array, each 1 TB in size, which are available at the server level as RAW devices: sdb and sdc. <br><br>  An important point of my tests is to compare the performance of various RAID levels that the array supports.  Therefore, I will alternately load the LUNs created on: DDP, RAID6, RAID10.  And I will create Dynamic Disk Pool and Volume Groups based on all 24 disks. <br><br>  In order not to make the results dependent on the algorithm of the work of the notorious ‚ÄúLinux memory cache‚Äù, I use block devices, without organizing a file system on top of them.  Of course, this is not the most standard configuration for streaming applications, but it is important for me to understand what exactly the array is capable of.  Although, looking ahead, I will say that when using the FIO load pattern in the parameters direct = 1 and buffered = 0, working (writing) with files at the EXT4 level shows almost the same results with block devices by bandwith.  At the same time, the latency performance when working with the file system is higher by 15-20 percent than when working with raw devices <br>  The load pattern for FIO is configured as follows: <br><br><blockquote>  [global] <br>  description = seq-reads <br>  ioengine = libaio <br>  bs = see above <br>  direct = 1 <br>  buffered = 0 <br>  rw = [write, read, rw, randwrite, randread, randrw] <br>  runtime = 900 <br>  thread <br><br>  [sdb] <br>  filename = / dev / sdc <br>  iodepth = cm  below <br><br>  [sdc] <br>  filename = / dev / sdb <br>  iodepth = cm  below </blockquote><br><br>  If I understood correctly, man by fio, the iodepth parameter, determines the number of independent threads that work with the disk at the same time.  Accordingly, in the configuration I get the number of threads equal to X * 2 (4, 8, 16). <br><br>  As a result, the test suite I got the following: <br><br><img src="https://habrastorage.org/files/a0c/975/7bb/a0c9757bbe66466ea1735c9f1e8efd33.png" alt="   NetApp E2700" title="Test suite for NetApp E2700"><br><br>  With the techniques figured out, the patterns identified, give the load.  To make admin work easier, you can cut a set of FIO patterns as separate files, in which the values ‚Äã‚Äãof two parameters will change - bs and iodepth.  Then you can write a script that, in a double loop (changing the values ‚Äã‚Äãof the two parameters), runs all our patterns and saves the indicators we need into separate files. <br><br>  Yes, I almost forgot a couple of moments.  At the array level, I configured the cache parameters as follows: <br><ul><li>  for streaming, I turned off the cache for reading; </li><li>  for streaming reading, turned off the write cache, respectively, and did not use the dynamic read prefetch algorithm; </li><li>  for mixed read and write operations, activated the cache completely. </li></ul><br>  At the Linux level, I changed the regular I / O scheduler to noop during streaming operations and on the deadline at random.  In addition, for proper balancing of traffic at the HBA level, I installed a multipath driver from NetApp, MPP / RDAC.  The results of his work pleasantly surprised me, balancing the flow of data between HBA ports was performed almost 50-by-50, which I have never seen in either Qlogic or regular linux multipathd. <br><br>  SANTricity has a number of tuning parameters (I already wrote above, for example, about managing data caching at the volume level).  Another potentially interesting parameter is the Segment Size, which can be set and changed at the volume level.  Segment Size is a block that the controller writes to one disk (data inside a segment is written in blocks of 512 bytes).  If I use DDP, then the size of this parameter is the same for all volumes created in the pool (128k) and cannot be changed. <br><br>  For volumes created on the basis of VolumeGroup, I can choose pre-configured load patterns for the volume (FileSystem, Database, Multimedia).  In addition, I can choose the size of SegmentSize independently in the range from 32 KB to 512 KB. <br><br><img src="https://habrastorage.org/files/a2d/c54/e2f/a2dc54e2fc3e400e9ba904825e23b021.png" alt="     ,    VolumeGroup" title="Selection of pre-configured load patterns for a volume created on the basis of VolumeGroup"><br><br>  In general, for the built-in Volume I / O characteristics type, the size of the Segment Size is not particularly diverse: <br><ul><li>  For the File system pattern = 128 Kb; </li><li>  For Database pattern = 128 Kb; </li><li>  For the Multimedia pattern = 256 Kb. </li></ul><br>  I did not change the default pattern when creating a volume (File system) so that the Segment Size for the volumes created on the DDP and on the regular VolumeGroup would be the same. <br><br>  Of course, I played with the size of Segment Size to understand how it affects the performance of write operations (for example).  The results are quite standard: <br><ul><li>  With the smallest size, SS = 32 Kb, I get higher performance indicators for operations with a small block size; </li><li>  With the largest size, SS = 1024 Kb, I get higher performance indicators for operations with a larger block size; </li><li>  If I align the size of the SS and the size of the block that the FIO operates on, the results are even better; </li><li>  There is one "but."  I noticed that when streaming in large blocks and SS = 1024 KB, latency values ‚Äã‚Äãare higher than for SS = 128 KB or 256 KB. </li></ul><br>  So, the utility of this parameter is obvious, and if we assume that we will have many random operations, then it makes sense to set it to 32 Kb (if, of course, we do not use DDP).  For streaming operations, I see no reason to set the SS value to the maximum, because  I did not observe a cardinal increase in the data transfer rate, and latency indicators may be critical for the application. <br><br><h3>  Results (evaluation and comparison of results) </h3><br>  <i>DDP test results</i> <br><br><img src="https://habrastorage.org/files/e94/c0d/d15/e94c0dd156c54d82a39ba1bf99ed9bd0.png" alt="   DDP  NetApp E2700" title="DDP test results for NetApp E2700"><br><br>  <i>RAID6 Test Results</i> <br><br><img src="https://habrastorage.org/files/4e1/48c/829/4e148c82918943a6814fa3d679e4e227.png" alt="   RAID6  NetApp E2700" title="RAID6 Test Results for NetApp E2700"><br><br>  <i>Test results for RAID10</i> <br><br><img src="https://habrastorage.org/files/bee/5f7/c87/bee5f7c875d54a99b42b833880e2600e.png" alt="   RAID10  NetApp E2700" title="Test results for RAID10 for NetApp E2700"><br><br><h3>  Evaluation of results </h3><br><ol><li>  The first point, which I immediately noticed, is 0% of the use of the cache for reading with any pattern (and even with the cache completely disabled for writing).  With what it was connected, it was not possible to understand it, but the results on read operations subsided significantly compared with write operations.  Perhaps this is due to the one-controller configuration of the test array, since the read cache must be mirrored between the two controllers. </li><li>  The second point is quite low rates for random operations.  This is explained by the fact that the size of the Segment Size (as I wrote above) was used by default equal to 128 KB.  For small block sizes, this SS size is not suitable.  To test this, I ran a random load on volumes in RAID6 and RAID10 with SS = 32 KB.  The results were much more interesting.  But in the case of DDP, we are not able to change the size of SS, so a random load on DDP is contraindicated. </li><li>  If we compare the performance of DDP, RAID6 and RAID10 with SS = 128 KB, we can track the following patterns: </li></ol><br><ul><li>  In general, there is no big difference between the three different logical representations of the blocks; </li><li>  RAID10 more stable keeps the load, even mixed, while giving the best latency, but loses the speed of streaming and reading RAID6 and DDP; </li><li>  RAID6 and DDP during random operations with increasing block size show the best latency and IOps values.  Most likely, this is due to the size of SS (see above).  However, RAID10 did not show this effect; </li><li>  As I wrote above, random load for DDP is contraindicated, in any case, when the block sizes are less than 32 KB. </li></ul><br><br><h3>  findings </h3><br>  I haven‚Äôt come across any tests for an entry-level array that can run up to 1.5 Gb / s through a single controller with streaming through one controller.  It can be assumed that the dual-controller configuration can handle up to 3 GB / s.  And this is a data stream up to 24 Gbit / s. <br><br>  Of course, the tests used by us are synthetic.  But the results shown are very good.  As it was supposed, the array weakly holds a mixed load during random operations, but there are no miracles :-). <br><br>  In terms of usability and the ability to optimize settings for a specific load pattern for an entry-level array, the E2700 showed itself at the height.  SANTricity has a clear and fairly simple interface, a minimum of glitches and brakes.  There are no unnecessary settings for values ‚Äã‚Äãthat are often not clear (I recall the IBM DS 4500 control interface ‚Äî it was something)).  In general, all on a solid "4". </div><p>Source: <a href="https://habr.com/ru/post/233865/">https://habr.com/ru/post/233865/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233851/index.html">Engineering culture we lost?</a></li>
<li><a href="../233855/index.html">Creating an online store in Russia and the CIS: we choose the best contractor from the TOP-10 web studios rating</a></li>
<li><a href="../233859/index.html">Oculus Rift and STEM make lightsabers a reality</a></li>
<li><a href="../233861/index.html">Epson Moverio BT-200 Developer Contest</a></li>
<li><a href="../233863/index.html">Digest photo news # 9: the best materials beginning of August</a></li>
<li><a href="../233867/index.html">We teach children to make games</a></li>
<li><a href="../233869/index.html">WGDC Competition: End of Work Registration Stage</a></li>
<li><a href="../233871/index.html">How to protect nuclear power plants from hackers</a></li>
<li><a href="../233873/index.html">Ar.Drone 2: half a year of flights</a></li>
<li><a href="../233875/index.html">The principle of Level-up in the management of the company: use with caution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>