<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yii2 RESTful API for AngularJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello dear readers! Judging by your comments on previous articles , many of you are very interested in how we will use AngularJS in conjunction with o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yii2 RESTful API for AngularJS</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/f68/9ed/aef/f689edaef537484ea81d4eccb80fcc6d.png"></div><br>  Hello dear readers!  Judging by your comments on <a href="https://habrahabr.ru/post/308948/">previous articles</a> , many of you are very interested in how we will use AngularJS in conjunction with our application on the Yii2 framework.  In this article I will raise the curtain and describe the process of connecting the AngularJS framework and how to use it. <a name="habracut"></a><br><br>  I plan to use Yii2 for the main part of the application, but I will use Angular for such parts of the application as a modal window for adding ads, searching the site, a carbilder (part of the site‚Äôs functionality that allows you to assemble your dream car and send a request to the site administrator and dealers ) etc.  Nothing that would change the current route, but this approach will give our application responsiveness and ease of interaction with the visitor. <br><br>  In the future, we will translate the project into a one-page application on AngularJS, which will interact with the Yii2 REST backend.  But at the moment, I do not want to do this, because then we will need to handle routing, validation, authorization, access rights, and the like, both in Angular.js and on the backend. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      RESTful API structure Yii provides us with a clean API that can communicate with the embedded AngularJS application, or with our mobile application in the future. <br><br>  Since we care about performance, we will walk with both feet towards REST.  A well-structured RESTful application is a big plus, especially if there is a good caching system with a flexible strategy.  Also, we plan to place the backend and database on Amazon EC2 server and provide only JSON data for minimal bandwidth usage.  Moreover, Amazon EC2 has such a feature as automatic scaling, which allows it to automatically adapt computing capacity depending on site traffic.  As for our static content, we will store it on an optimized Amazon S3 CDN, which has the lowest cost and faster response speed.  I will write about this in more detail in my next articles. <br><br>  The yii2 framework provides a range of tools to simplify the implementation and implementation of the RESTful API.  Now I will demonstrate an example of how to build a RESTful set. <br>  API, with minimal effort to write code. <br><br>  First of all, let's create a controller for the API in the <code>Lease</code> module, it will be located along the <code>modules/lease/controllers/frontend</code> file of the <code>ApiController.php</code> file and write the following in it: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">lease</span></span>\<span class="hljs-title"><span class="hljs-title">controllers</span></span>\<span class="hljs-title"><span class="hljs-title">frontend</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">rest</span></span>\<span class="hljs-title"><span class="hljs-title">ActiveController</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApiController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $modelClass = <span class="hljs-string"><span class="hljs-string">'modules\lease\models\frontend\Lease'</span></span>; }</code> </pre><br>  The controller class is inherited from <a href="http://www.yiiframework.com/doc-2.0/yii-rest-activecontroller.html">yii \ rest \ ActiveController</a> , which implements a common set of RESTful actions.  <code>modelClass</code> specifying <code>modelClass</code> as <code>modules\lease\models\frontend\Lease</code> , the controller knows which model can be used to extract and manipulate data. <br><br>  In order to provide the ability to use our API via ajax requests from other domains, you can add <code>cors</code> behavior to the controller, if necessary: <br><br><pre> <code class="php hljs">... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">behaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $behaviors = <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::behaviors(); $behaviors[<span class="hljs-string"><span class="hljs-string">'corsFilter'</span></span> ] = [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \yii\filters\Cors::className(), ]; <span class="hljs-comment"><span class="hljs-comment">//        ( ) return $behaviors; } ...</span></span></code> </pre> <br>  Notice that we want to save the configuration of behavior from <a href="http://www.yiiframework.com/doc-2.0/yii-rest-controller.html">yii \ rest \ Controller</a> , which is why we save it in the first line <code>$behaviors = parent::behaviors();</code>  and continue to add behaviors to it. <br><br>  The Yii2 REST API is capable of responding in XML and JSON formats.  We will only use the JSON format, and let us inform the framework about it: <br><br><pre> <code class="php hljs">... $behaviors[<span class="hljs-string"><span class="hljs-string">'contentNegotiator'</span></span>] = [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \yii\filters\ContentNegotiator::className(), <span class="hljs-string"><span class="hljs-string">'formats'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'application/json'</span></span> =&gt; \yii\web\Response::FORMAT_JSON, ], ]; ...</code> </pre> <br>  We can also easily configure various access rights to actions of the API controller using the <a href="http://www.yiiframework.com/doc-2.0/yii-filters-accesscontrol.html">yii \ filtersAccessControl class</a> .  Specify that only authorized users can create, edit and delete listings: <br><br><pre> <code class="php hljs">... $behaviors[<span class="hljs-string"><span class="hljs-string">'access'</span></span>] = [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \yii\filters\AccessControl::className(), <span class="hljs-string"><span class="hljs-string">'only'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'create'</span></span>, <span class="hljs-string"><span class="hljs-string">'update'</span></span>, <span class="hljs-string"><span class="hljs-string">'delete'</span></span>], <span class="hljs-string"><span class="hljs-string">'rules'</span></span> =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'actions'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'create'</span></span>, <span class="hljs-string"><span class="hljs-string">'update'</span></span>, <span class="hljs-string"><span class="hljs-string">'delete'</span></span>], <span class="hljs-string"><span class="hljs-string">'allow'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'roles'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'@'</span></span>], ], ], ]; ...</code> </pre> <br>  Also, to provide access control to actions, you can override the <code>CheckAccess()</code> method to check whether the current user has the privilege to perform a specific action on the specified data model.  For example, let's write a check so that a user can edit or delete only his listings: <br><br><pre> <code class="php hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($action, $model = null, $params = [])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         //   ForbiddenHttpException    if ($action === 'update' || $action === 'delete') { if ($model-&gt;user_id !== \Yii::$app-&gt;user-&gt;id) throw new \yii\web\ForbiddenHttpException(sprintf('You can only %s lease that you\'ve created.', $action)); } } ...</span></span></code> </pre> <br>  This method will be called automatically for actions of the <a href="http://www.yiiframework.com/doc-2.0/yii-rest-activecontroller.html">yii \ rest \ ActiveController</a> class.  If you create a new action in the controller in which you also need to perform an access check, you must explicitly call this method in the new actions. <br><br>  In the next step, we change the configuration of the <code>urlManager</code> component in the bootstrapping module class in the <code>modules/lease/Bootstrap.php</code> file <br><br><pre> <code class="php hljs">... $app-&gt;getUrlManager()-&gt;addRules( [ [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'yii\rest\UrlRule'</span></span>, <span class="hljs-string"><span class="hljs-string">'controller'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'leases'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'lease/api'</span></span>], <span class="hljs-string"><span class="hljs-string">'prefix'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'api'</span></span> ] ] ); ‚Ä¶</code> </pre> <br>  The above configuration basically adds the URL to the API controller so that the data can be accessed and manipulated using the short URL and the corresponding HTTP header.  We added <code>prefix</code> so that all links for accessing API services start with <code>/api/*</code> , so this pattern can be easily hidden from search engines in the robots.txt file.  In the future, in each module that will participate in the RESTful API, we will add the controller for the API in the same way. <br><br>  Written above with the minimum amount of code, we have already completed our task of creating a RESTful API for accessing data from the <code>Lease</code> model.  We have created APIs that include: <br><br><ul><li>  GET / api / leases: Get all listings </li><li>  HEAD / api / leases: Get the header of the response to the GET / api / leases request. </li><li>  POST / api / leases: Create a new listing </li><li>  GET / api / leases / 3: Get listing data with id = 3 </li><li>  HEAD / api / leases / 3: Get the response header GET / api / leases / 3 </li><li>  PATCH / api / leases / 3 and PUT / api / leases / 3: Change listing data with id = 3 </li><li>  DELETE / api / leases / 3: Delete listing id = 3 </li><li>  OPTIONS / api / leases: Get a list of available query methods for / api / leases </li><li>  OPTIONS / api / leases / 3: Get a list of available query methods for / api / leases / 3 </li></ul><br>  Using the Yii2 framework's RESTful API mechanism, we implemented the endpoint APIs as controller actions and use these actions for one data type (for one model). <br><br>  At the moment, we have implemented part of the backend for the application and now we can begin to implement the frontend - let's start with the fact that we connect AngularJS.  We will do this using composer, we just need to add the following lines to the <code>‚Äúrequire‚Äù</code> section of the <code>composer.json</code> file. <br><br><pre> <code class="hljs python"><span class="hljs-meta"><span class="hljs-meta">... </span></span><span class="hljs-string"><span class="hljs-string">"bower-asset/angular"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.5"</span></span>, <span class="hljs-string"><span class="hljs-string">"bower-asset/angular-animate"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.5"</span></span>, <span class="hljs-string"><span class="hljs-string">"bower-asset/angular-bootstrap"</span></span>: <span class="hljs-string"><span class="hljs-string">"^2.2"</span></span> ‚Ä¶</code> </pre> <br>  And run the command on the <code>php composer.phar update</code> command line <code>php composer.phar update</code> . <br><br>  Now let's make the <code>AssetBundle</code> in the file so that we can easily pick up AngularJS files to the layout.  This is what the <code>\frontend\assets\AngularAsset.php</code> file will look like <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">assets</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">AssetBundle</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">View</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AngularAsset</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AssetBundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $sourcePath = <span class="hljs-string"><span class="hljs-string">'@bower'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $js = [ <span class="hljs-string"><span class="hljs-string">'angular/angular.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'angular-animate/angular-animate.min.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'angular-bootstrap/ui-bootstrap.min.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'angular-bootstrap/ui-bootstrap-tpls.min.js'</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $jsOptions = [ <span class="hljs-string"><span class="hljs-string">'position'</span></span> =&gt; View::POS_HEAD, ]; }</code> </pre> <br> <code>public $jsOptions = [ 'position' =&gt; View::POS_HEAD, ];</code>  Tells Yii that you need to attach JavaScript files in the head section of our layout instead of placing them at the very end of the body section, so the AngularJS core will load as quickly as possible.  We also have to add this Bundle in the dependencies of the main <code>asset bundle</code> application and in the same place connect another <code>'js/app.js'</code> file, which will contain an instance of the AngularJS application. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">assets</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">AssetBundle</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Main frontend application asset bundle. */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppAsset</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AssetBundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $basePath = <span class="hljs-string"><span class="hljs-string">'@webroot'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $baseUrl = <span class="hljs-string"><span class="hljs-string">'@web'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $css = [ <span class="hljs-string"><span class="hljs-string">'css/site.css'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $js = [ <span class="hljs-string"><span class="hljs-string">'js/app.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'js/controllers.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'js/directives.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'js/services.js'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $depends = [ <span class="hljs-string"><span class="hljs-string">'yii\web\YiiAsset'</span></span>, <span class="hljs-string"><span class="hljs-string">'yii\bootstrap\BootstrapAsset'</span></span>, <span class="hljs-string"><span class="hljs-string">'frontend\assets\AngularAsset'</span></span> ]; }</code> </pre> <br>  Let's add the file <code>controllers.js</code> to the same bundle at the same time.  In the future, we will write in it our front-end controllers, <code>directives.js</code> and <code>services.js</code> to describe the directives and services, respectively. <br><br>  We start implementing Angular into the application views by adding the <code>ng-app</code> directive to the html element - this will launch our AngularJS application, which we will call <code>‚Äúapp‚Äù</code> . <br><br><pre> <code class="xml hljs">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"&lt;?= Yii::$app-&gt;language ?&gt;"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ng-app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span><span class="hljs-tag"> &gt;</span></span> ...</code> </pre> <br>  Please note that I wrote the <code>data-ng-app</code> directive exactly this way; otherwise, our html markup will not pass W3C validation.  This does not have any effect on the work of the directives, and the layout should be validated in accordance with the project specification.  Therefore, for all non-standard directives we will add the <code>data-</code> prefix. <br><br>  The code for the Angular application will be located in <code>frontend/web/js/app.js</code>  There we will define the application and connect to it the modules that we are going to use. <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = angular.module(<span class="hljs-string"><span class="hljs-string">'app'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'ngAnimate'</span></span>, <span class="hljs-string"><span class="hljs-string">'ui.bootstrap'</span></span>, <span class="hljs-string"><span class="hljs-string">'controllers'</span></span> <span class="hljs-comment"><span class="hljs-comment">//  frontend/web/js/controllers.js ]);</span></span></code> </pre> <br>  In the <code>frontend/web/js/services.js</code> <code>LeaseService</code> , we will write the <code>LeaseService</code> service, which will perform CRUD operations for listings through communication with the REST API of the backend: <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = angular.module(<span class="hljs-string"><span class="hljs-string">'app'</span></span>); app.service(<span class="hljs-string"><span class="hljs-string">'LeaseService'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$http</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.get = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $http.get(<span class="hljs-string"><span class="hljs-string">'/api/leases'</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.post = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $http.post(<span class="hljs-string"><span class="hljs-string">'/api/leases'</span></span>, data); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.put = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id, data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $http.put(<span class="hljs-string"><span class="hljs-string">'/api/leases/'</span></span> + id, data); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delete = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $http.delete(<span class="hljs-string"><span class="hljs-string">'/api/leases/'</span></span> + id); }; });</code> </pre> <br>  Today, our <code>controllers</code> module will contain a very simple <code>LeaseController</code> controller.  It will request data from <code>/api/leases</code> and pass the data to the display. <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> controllers = angular.module(<span class="hljs-string"><span class="hljs-string">'controllers'</span></span>, []); controllers.controller(<span class="hljs-string"><span class="hljs-string">'LeaseController'</span></span>, [<span class="hljs-string"><span class="hljs-string">'$scope'</span></span>, <span class="hljs-string"><span class="hljs-string">'LeaseService'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope, LeaseService</span></span></span><span class="hljs-function">) </span></span>{ $scope.leases = []; LeaseService.get().then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.status == <span class="hljs-number"><span class="hljs-number">200</span></span>) $scope.leases = data.data; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err); }) } ]);</code> </pre> <br>  We use this controller in the <code>\modules\lease\views\frontend\default\index.php</code> file using the <code>ng-controller</code> directive and output the data provided by the API to the table: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lease-default-index"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LeaseController"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>All Leases<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ng-show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"leases.length &gt; 0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table table-striped table-hover"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Year<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Make<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Model<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Trim<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ng-repeat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lease in leases"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>{{lease.year}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>{{lease.make}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>{{lease.model}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>{{lease.trim}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ng-show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"leases.length == 0"</span></span></span><span class="hljs-tag">&gt;</span></span> No results <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now, when we browse the page along the path <code>/lease/default/index</code> , we will see a list of all listings recorded in the database. <br><br><img src="https://habrastorage.org/files/e47/747/290/e4774729098c446393de250f99255df6.png"><br>  I hope you can see how quickly and easily you can create a RESTful API based on the Yii2 framework.  All the code described in this and previous articles is available for you in the <a href="https://github.com/pavelsingree/yii2-angular">repository</a> . <br><br>  Material prepared: <a href="https://habrahabr.ru/users/greebn9k/" class="user_link">greebn9k</a> (Sergey Gribnyak), <a href="https://habrahabr.ru/users/pavel-berezhnoy/" class="user_link">pavel-berezhnoy</a> (Pavel Berezhnoy) </div><p>Source: <a href="https://habr.com/ru/post/318242/">https://habr.com/ru/post/318242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318232/index.html">What is enterprise architecture, and why was Zachman wrong?</a></li>
<li><a href="../318234/index.html">Oracle Database History ‚Äî First Commercially Successful Relational DBMS</a></li>
<li><a href="../318236/index.html">Working with C ++ tuples (std :: tuple). Functions foreach, map and call</a></li>
<li><a href="../318238/index.html">VulnHub: Exploiting the buffer overflow vulnerability in Lord Of The Root</a></li>
<li><a href="../318240/index.html">"Distribution in request" or "we get rid of search"</a></li>
<li><a href="../318244/index.html">10 new tales of lost time</a></li>
<li><a href="../318246/index.html">IBM Watson will help NASA to surf the universe</a></li>
<li><a href="../318250/index.html">McAfee ATM Security Detects Hazardous Vulnerability</a></li>
<li><a href="../318254/index.html">How Drag works in Unity physics</a></li>
<li><a href="../318256/index.html">Programming gaming applications on the Corona SDK: part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>