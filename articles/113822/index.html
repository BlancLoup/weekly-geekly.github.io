<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How the new Photo Viewer was designed in Facebook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a translation of a post from the Facebook Engineering Blog, which is interesting, perhaps, not so much the essence of the solution, which it d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How the new Photo Viewer was designed in Facebook</h1><div class="post__text post__text-html js-mediator-article">  <i>This is a translation of a post from the Facebook Engineering Blog, which is interesting, perhaps, not so much the essence of the solution, which it describes as a story about the "kitchen" of development on Facebook.</i>  <i>We are talking about the updated photo viewing functionality, which appeared at the end of September 2010 and was slightly improved a few days ago.</i> <br><br><img src="http://photos-c.ak.fbcdn.net/hphotos-ak-snc6/182813_10150097023172200_9445547199_6127224_1926738_a.jpg" alt="image" align="left">  Thinking about updating Photo Viewer, we encountered many difficulties.  Obviously, photos are the most requested feature of Facebook.  Every day, our users upload more than 100 million photos, and the functionality designed for this was created quite a long time ago and clearly needed to be improved. <br><br>  Thanks to the work done, users began to look at 5% more photos, which in quantitative terms means about one billion additional views a day. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>How did we do it</b> <br>  We started by compiling a list of current issues: <br><ul><li>  The biggest problems were reliability.  Images loaded slowly, and sometimes the process hung indefinitely.  Users had to refresh the page in the browser to see the photos and comments to them. </li><li>  When viewing photos from the News Feed, you had to either open them in a new tab, or put up with the fact that after viewing you had to re-scroll the tape down to return to the previous position.  For computer-savvy people, this was not a particular problem, but many of our users experienced inconveniences. </li><li>  The functionality of viewing comments on photos was also not implemented in the most convenient way.  The process looked like this - you had to look at the photo, squander the page down to see the signature and comments to it, and then go back up, and so on each time. </li><li>  JavaScript, intended for uploading and caching photos, as well as for posting comments, was also not implemented in the best way.  It has remained unchanged for many years, against the background of the fact that browser technologies and requirements for them have significantly advanced. </li></ul><br>  We were faced with the task of solving the problems described above and, ideally, creating a new, more enjoyable functionality that can combine viewing photos, placing tags for people on them, the ability to comment and mark your favorite photos with "likes." <a name="habracut"></a><br><br>  We identified several design concepts and began to experiment.  Almost immediately, we realized that using pop-up windows at the same time solves several tasks we face.  The pop-up window allows you to save the current position in the news feed and at the same time can be implemented with a minimum amount of downloaded data. <br><br><img src="http://a7.sphotos.ak.fbcdn.net/hphotos-ak-ash1/180549_10150097023322200_9445547199_6127226_6529550_n.jpg" alt="image"><br>  <i>Initial Concept Photo Viewer</i> <br><br>  Given that we immediately liked the initial design of the window, it was obvious that there was no room left for a description of the photograph, comments and marks of the people depicted on it.  We have refined the window design, increasing its size and increasing the interactivity of its work.  In this case, we have provided the ability to view photos in large size, as far as the user's screen resolution allows. <br><br><img src="http://a1.sphotos.ak.fbcdn.net/hphotos-ak-snc6/181597_10150097023422200_9445547199_6127227_3622783_n.jpg" alt="image"><br>  <i>The initial prototype of Photo Viewer</i> <br><br>  Then, based on the results of prototype testing, we made a number of important decisions.  First, we found that on a dark background, photos look more colorful and perfectly stand out on the screen.  Secondly, by removing the column on the right, we got more free space for the photo itself, which could now occupy the entire width of the page.  And finally, it became clear to us that, despite all the advantages provided by the dark background when viewing photos, it is quite difficult to read the captions and comments written on it.  Therefore, we settled on a two-color version of the window containing large photographs. <br><br><img src="http://a6.sphotos.ak.fbcdn.net/hphotos-ak-snc6/180028_10150097024897200_9445547199_6127235_5545107_n.jpg" alt="image"><br>  <i>Full-screen version of the Photo Viewer window</i> <br><br>  So, we decided on the design and started working on the engineering side of the project.  Considering the need to handle large-sized photos, we encountered several significant problems.  For example, some photos were too large to fit entirely on small screens.  Our task was to save the user from having to scroll through the image in order to see it entirely.  In addition, even before starting work on the project, we were faced with the task of resolving the issue of viewing comments on large photos.  Thus, we needed to provide free space at the bottom of the photo, which will always be visible on the screen. <br><br>  As a result, we defined the following criteria for design development: <br>  ‚Ä¢ At the bottom of the photo there should be at least 100 pixels for captions and comments, which should always be visible on the screen.  This meant the need to compress photos in cases where the user's screen has a too low resolution. <br>  ‚Ä¢ The pop-up window should be on top of the main page and scroll if necessary, but the page itself should remain stationary in the background. <br>  ‚Ä¢ We had to provide the ability to easily add new features without having to rework the API. <br>  ‚Ä¢ We decided to refuse to support the new functionality of the browser IE6, if the amount of work and loss of productivity will be too large compared to the benefits of working with this version. <br>  ‚Ä¢ We had to minimize the use of javascript. <br><br>  <b>Final Solution: More CSS, a lot less JavaScript</b> <br>  The final solution was based on the use of CSS capabilities for working with a pop-up window without the need for JavaScript.  Let's take a look at the HTML and consider the line by line code used. <br><br><img src="http://a2.sphotos.ak.fbcdn.net/hphotos-ak-snc6/182729_10150097025062200_9445547199_6127237_1733172_n.jpg" alt="image"><br><ol><li> First we need to create a lightbox.  By using the root tag with a fixed position, <code>fbPhotoTheater</code> , we were able to separate the content from the <code>body</code> .  By setting the root tag <code>width</code> and <code>height 100%</code> and setting the <code>overflow</code> parameter to <code>body</code> to <code>hidden</code> , we can scroll the content without changing the page itself in the background. </li><li>  The <code>container</code> element sets the boundaries of the lightbox content horizontally at <code>960px</code> and the position of the lightbox in the center of the screen.  After adjusting the lightbox structure, the remaining elements are used to correctly position its contents. </li><li>  The <code>positioner</code> element has a <code>height 100%</code> and a <code>max-height 820px</code> .  Of these, 720 pixels are reserved for the photo itself, and the remaining 100 pixels are used for captions and comments at the bottom of the lightbox.  This is achieved by positioning the <code>photoInfoWrapper</code> at a height of 100 pixels from the bottom <code>positioner</code> .  Thus, it will always abut below the <code>stageWrapper</code> . </li><li>  The <code>stageBackdrop</code> , <code>stageWrapper</code> and <code>stageActions</code> must have the same positioning within the CSS.  This ensures their mutual overlap.  We give them a <code>max-height 720 px</code> , <code>top 0</code> and <code>bottom 100px</code> .  Thanks to this <code>bottom</code> , we are guaranteed to have 100 pixels at the bottom of the screen for captions, and <code>max-height</code> keeps the contents of the lightbox to within limits, even for photos that are too long in height.  Also for <code>stageWrapper</code> we set the value <code>text-align:center</code> so that the photo takes a central position horizontally. </li><li>  The <code>stage</code> element is used to centrally position the photo vertically.  This is the only use of <code>JavaScript</code> in positioning.  For the <code>stage</code> we need to set the <code>line-height</code> value equal to its <code>height</code> , due to this, the img child element gets the <code>vertical-align: middle</code> positioning.  It is worth noting the merit of this decision, which is that the calculation needs to be done only once, and not every time the user scrolls through several photos. </li><li>  For the image itself, the <code>max-height 100%</code> so that it always fits within the panel borders. </li><li>  Finally, for the <code>photoInfoWrapper</code> element, which should be under the <code>positioner</code> element, the relative positioning <code>top: ‚Äì 100px</code> .  Due to this, the empty interval is filled. </li></ol><br><br>  Having finished with the markup, we started to revise the contents of JavaScript.  The old version of the functional downloaded photos in packs of 20 pieces, along with captions, comments, etc.  with AJAX.  As a result, requests took three times longer than if we only loaded photos.  By separating the images from the related information, we received an additional performance gain.  Now, with each AJAX request, we can load more photos and less related data, optimizing the response time to the request.  To ensure maximum speed of loading photos, we track which way the user scrolls them, and load the next 5 photos.  Thanks to this, the photos in advance get into the browser's cache, and they are displayed immediately. <br><br>  When loading data, we separated the information about them from the JavaScript class PhotoTheater.  In response to each request for receiving data, an object comes with keys containing the identifiers of the Photo Viewer elements and the HTML code to be inserted into these elements.  We implemented a cycle in which we set the content of each element.  Thanks to this solution, we can change the design and layout of HTML, without making changes to JavaScript.  Finally, in order to maximize the download speed, we attached an HTML5 attribute containing the full version URL to each photo icon.  Thus, when a user clicks on an icon, we can get the URL from its attributes and display the first photo without using an AJAX request.  Thus, the average load time functionality for viewing photos is now less than half a second. <br><br>  As a result of our work, we got a solution with a small amount of downloaded data and a high viewing speed.  Due to this, we managed to improve the viewing experience and interactivity of the functional.  Now users are faced with fewer errors and less likely to see an indicator of waiting for data loading. <br><br>  We hope that you will get the same great pleasure from working with the new version of Facebook functionality for viewing photos, which we received from its development. <br><br><img src="http://a7.sphotos.ak.fbcdn.net/hphotos-ak-ash1/168967_10150097025282200_9445547199_6127239_6341710_n.jpg" alt="image"><br>  <i>The final version of the functionality for viewing photos.</i> <i><br></i> </div><p>Source: <a href="https://habr.com/ru/post/113822/">https://habr.com/ru/post/113822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113813/index.html">Droider Chart. Issue 39</a></li>
<li><a href="../113815/index.html">Isolation of services in Windows</a></li>
<li><a href="../113816/index.html">The head of AOL buys shares of the company</a></li>
<li><a href="../113819/index.html">Google introduced an extension for Chrome to help fight content farms.</a></li>
<li><a href="../113820/index.html">7th Startup Crash Test (February 18)</a></li>
<li><a href="../113823/index.html">Steel Tambourine 2 (Second Edition)</a></li>
<li><a href="../113824/index.html">Registering the application in the AppStore - we did it!</a></li>
<li><a href="../113826/index.html">Softline gives Russian developers access to the Windows Azure cloud platform</a></li>
<li><a href="../113828/index.html">UserAndLINUX - The application ‚ÄúMore than User!‚Äù V11.02</a></li>
<li><a href="../113829/index.html">Yota offers free service internet access and new rates.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>