<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Copy dallas keys. Record on rw1990 (rw1990.1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! Today I want to talk about how to make a device that allows you to copy Touch Memory company Dallas. The article is intended for those who have...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Copy dallas keys. Record on rw1990 (rw1990.1)</h1><div class="post__text post__text-html js-mediator-article">  Hello!  Today I want to talk about how to make a device that allows you to copy Touch Memory company Dallas.  The article is intended for those who have experience in programming in C / C ++ languages.  I don‚Äôt intend to tell how the OneWire protocol works.  On the Internet, a lot of information on this topic. <br><br>  So, what we need for the manufacture of this device: <br><br>  1) Atmega8 <br>  2) FTDI RL232 converts USB to USART <br>  3) Driver for FTDI RL232 <br>  4) Programmer (I used USBasp) <br>  5) Visual Studio <br>  6) Atmel Studio <br>  7) Breadboard <br><a name="habracut"></a><br>  With this set you can move on.  To get started, prepare a board on which to place the components. <br>  I did it like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/074/846/ec8/074846ec8a6941c897442af4daef7b0b.JPG" width="400" height="260" alt="image"><br><br><img src="https://habrastorage.org/files/966/b65/457/966b65457c8447028953d0294aaa4398.JPG" width="400" height="260" alt="image"><br><br><img src="https://habrastorage.org/files/86f/ef1/59c/86fef159c194419397ee2e76e21c3fd2.JPG" width="400" height="260" alt="image"><br><br><img src="https://habrastorage.org/files/1a4/bb4/761/1a4bb47616df42d48591d01b2f4aae6c.JPG" width="400" height="260" alt="image"><br><br>  Now let's define the parameters of USART atmega8.  I have these: <br>  1) Stop bit - 1 <br>  2) 9600boud <br>  3) Parity bit - no <br><br>  I will use the internal 4Mhz generator, so I will tune the UBRR register for this frequency.  Here is the piece of code where the USART setup is going: <br><br><pre><code class="cpp hljs">DDRD|=(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">1</span></span>); DDRD&amp;=~(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>); UBRRH=<span class="hljs-number"><span class="hljs-number">0</span></span>; UBRRL=<span class="hljs-number"><span class="hljs-number">25</span></span>; UCSRB|=(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;RXEN)|(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;TXEN); UCSRC|=(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;URSEL)|(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;UCSZ0)|(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;UCSZ1);</code> </pre> <br>  It's time to disassemble the record protocol for rw1990 discs.  The command to read the 8-byte code is identical with the dallas keys. <br><br>  Writing to rw1990 happens like this: <br>  1) Send a reset pulse, and expect the presence of a pulse; <br>  2) Send the command 0xD1, thereby allowing the recording; <br>  3) Time slot, send a logical "0" (see Figure 1); <br>  4) Send a reset pulse and wait for the presence of a pulse; <br>  5) Send the write command, 0xD5; <br>  6) We send an 8-byte code (all bits are inverted), the transfer is different from the oneWire protocol (see Figure 1); <br>  7) Send a reset pulse and wait for the presence of a pulse; <br>  8) Send the command 0xD1, thereby prohibiting the recording; <br>  9) Time slot, send a logical "1" (see Figure 1). <br><br>  Figure 1: <br><br><img src="https://habrastorage.org/files/a19/b1e/10d/a19b1e10df124e9dbc1377714d363a36.jpg" width="400" height="260" alt="image"><br><br>  A piece of code where the recording occurs: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onewire_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ onewire_low(); _delay_us(<span class="hljs-number"><span class="hljs-number">480</span></span>); onewire_high(); _delay_us(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> i= <span class="hljs-number"><span class="hljs-number">60</span></span>;i;i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!onewire_level()){ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!onewire_level()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } _delay_us(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_slot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span></span>{ onewire_low(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(data) _delay_us(<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> _delay_us(<span class="hljs-number"><span class="hljs-number">60</span></span>); onewire_high(); _delay_ms(<span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rw1990_write_bit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span></span>{ onewire_low(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data) _delay_us(<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> _delay_us(<span class="hljs-number"><span class="hljs-number">60</span></span>); onewire_high(); _delay_ms(<span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rw1990_write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>;i++){ rw1990_write_bit(data &amp; <span class="hljs-number"><span class="hljs-number">0x01</span></span>); data&gt;&gt;=<span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rw1990_newcode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (onewire_init()){ onewire_send(<span class="hljs-number"><span class="hljs-number">0xD1</span></span>); time_slot(<span class="hljs-number"><span class="hljs-number">0</span></span>); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(onewire_init()){ onewire_send(<span class="hljs-number"><span class="hljs-number">0xD5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>;i++){ rw1990_write(~buf[i]); } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (onewire_init()){ onewire_send(<span class="hljs-number"><span class="hljs-number">0xD1</span></span>); time_slot(<span class="hljs-number"><span class="hljs-number">1</span></span>); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br>  I hope it is clear.  We still need to write an application that will communicate with the microcontroller.  That is, we will send requests to read and write the key to the microcontroller from the computer.  I will lay out all source codes under a topic.  The application is quite simple. <br><br>  However, the video shows everything. <br><br><div class="spoiler">  <b class="spoiler_title">Source code for atmega8</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> F_CPU 4000000 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/io.h&gt; #include &lt;avr/interrupt.h&gt; #include &lt;util/delay.h&gt; #define ONEWIRE_PORT PORTB #define ONEWIRE_DDR DDRB #define ONEWIRE_PIN PINB #define ONEWIRE_PIN_NUM 0 void usart_init(); void onewire_high(); void onewire_low(); uint8_t onewire_level(); bool onewire_init(); void onewire_write_bit(uint8_t); void onewire_send(uint8_t); uint8_t onewire_read_bit(); uint8_t onewire_read(); bool onewire_readrom(uint8_t*); void time_slot(uint8_t); void rw1990_write_bit(uint8_t); void rw1990_write(uint8_t); bool rw1990_newcode(uint8_t*); uint8_t usart_read(); uint8_t rom[8]; uint8_t new_rom[8]; uint8_t t=0; ISR (USART_UDRE_vect){ UDR=t; UCSRB &amp;=~(1&lt;&lt;UDRIE); t=0; } int main(void) { usart_init(); asm("sei"); while(1) { uint8_t r=usart_read(); if (r==0x40){ for(uint8_t i=0;i&lt;8;i++){ new_rom[i]=usart_read(); } if(rw1990_newcode(new_rom)){ t=0x45; UCSRB |=(1&lt;&lt;UDRIE); }else{ t=0x46; UCSRB |=(1&lt;&lt;UDRIE); } }else if(r==0x30){ if(onewire_readrom(rom)){ t=0x35; UCSRB |= (1&lt;&lt;UDRIE); for (uint8_t i=0;i&lt;8;i++){ t=rom[i]; UCSRB |= (1&lt;&lt;UDRIE); _delay_ms(1); } }else{ t=0x36; UCSRB |= (1&lt;&lt;UDRIE); } } } } void onewire_high(){ ONEWIRE_PORT &amp;=~ (1&lt;&lt;ONEWIRE_PIN_NUM); ONEWIRE_DDR &amp;=~ (1&lt;&lt;ONEWIRE_PIN_NUM); } void onewire_low(){ ONEWIRE_PORT &amp;=~ (1&lt;&lt;ONEWIRE_PIN_NUM); ONEWIRE_DDR |= (1&lt;&lt;ONEWIRE_PIN_NUM); } uint8_t onewire_level(){ return ONEWIRE_PIN &amp; (1&lt;&lt;ONEWIRE_PIN_NUM); } bool onewire_init(){ onewire_low(); _delay_us(480); onewire_high(); _delay_us(2); for(uint8_t i= 60;i;i++){ if(!onewire_level()){ while(!onewire_level()); return true; } _delay_us(1); } return false; } void onewire_write_bit(uint8_t bit){ onewire_low(); if(bit){ _delay_us(5); onewire_high(); _delay_us(90); }else{ _delay_us(90); onewire_high(); _delay_us(5); } } void onewire_send(uint8_t data){ for(uint8_t i=0;i&lt;8;i++){ onewire_write_bit(data&amp;0x01); data&gt;&gt;= 1; } } void usart_init(){ DDRD|=(1&lt;&lt;1); DDRD&amp;=~(1&lt;&lt;0); UBRRH=0; UBRRL=25; UCSRB|=(1&lt;&lt;RXEN)|(1&lt;&lt;TXEN); UCSRC|=(1&lt;&lt;URSEL)|(1&lt;&lt;UCSZ0)|(1&lt;&lt;UCSZ1); } uint8_t onewire_read_bit(){ onewire_low(); _delay_us(2); onewire_high(); _delay_us(8); uint8_t r = onewire_level(); _delay_us(80); return r; } uint8_t onewire_read(){ uint8_t r = 0; for (uint8_t p = 8; p; p--) { r &gt;&gt;= 1; if (onewire_read_bit()) r |= 0x80; } return r; } void time_slot(uint8_t data){ onewire_low(); if(data) _delay_us(6); else _delay_us(60); onewire_high(); _delay_ms(10); } void rw1990_write_bit(uint8_t data){ onewire_low(); if (data) _delay_us(6); else _delay_us(60); onewire_high(); _delay_ms(2); } void rw1990_write(uint8_t data){ for(uint8_t i=0;i&lt;8;i++){ rw1990_write_bit(data &amp; 0x01); data&gt;&gt;=1; } } bool rw1990_newcode(uint8_t* buf){ if (onewire_init()){ onewire_send(0xD1); time_slot(0); }else return false; if(onewire_init()){ onewire_send(0xD5); for(uint8_t i=0;i&lt;8;i++){ rw1990_write(~buf[i]); } }else return false; if (onewire_init()){ onewire_send(0xD1); time_slot(1); }else return false; return true; } bool onewire_readrom(uint8_t* buf){ if (onewire_init()){ onewire_send(0x33); for(uint8_t i=0;i&lt;8;i++){ buf[i]=onewire_read(); } }else return false; return true; } uint8_t usart_read(){ while(!(UCSRA &amp; (1 &lt;&lt; RXC))); return UDR; }</span></span></span></span></code> </pre><br></div></div><br>  Of course, it was possible to do everything in OOP style, but for some reason I decided so. <br><br><div class="spoiler">  <b class="spoiler_title">The source of the so-called iButton terminal</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">main.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Windows.h&gt; #include &lt;iostream&gt; #include "ComPort.h" using namespace std; int main(){ char buf_file[10]; wchar_t file[10]; char name[20]; char command[10]; unsigned char rom[8]; cout&lt;&lt;"Enter COM port: "; cin&gt;&gt;buf_file; cout&lt;&lt;"Enter your name: "; cin&gt;&gt;name; mbstowcs(file,buf_file,10); ComPort port((LPCWSTR)file,CBR_9600); cout&lt;&lt;"Welcome "&lt;&lt;name&lt;&lt;"! "&lt;&lt;"If you need help, you can write command \"help\"."&lt;&lt;endl; while(strcmp(command,"exit")){ cout&lt;&lt;name&lt;&lt;"&gt; "; cin&gt;&gt;command; if(!strcmp(command,"write_rom")){ scanf("%x %x %x %x %x %x %x %x",&amp;rom[0],&amp;rom[1],&amp;rom[2],&amp;rom[3],&amp;rom[4],&amp;rom[5],&amp;rom[6],&amp;rom[7]); for(int i=0;i&lt;50;i++){ port.ComWrite(0x40); port.ComWrite((char*)rom,sizeof(rom)); char recv=port.ComRead(); if(recv==0x45){ cout&lt;&lt;"Device&gt; write successfull!"&lt;&lt;endl; break; }else if(recv==0x46){ cout&lt;&lt;"Device&gt; write fail!"&lt;&lt;endl; } Sleep(100); } }else if(!strcmp(command,"read_rom")){ for(int i=0;i&lt;50;i++){ port.ComWrite(0x30); char recv=port.ComRead(); if(recv==0x35){ for(int i=0;i&lt;8;i++){ rom[i]=port.ComRead(); } cout&lt;&lt;"Device&gt; read successfull! "; printf("%02X %02X %02X %02X %02X %02X %02X %0X\n",rom[0],rom[1],rom[2],rom[3],rom[4],rom[5],rom[6],rom[7]); break; }else if(recv==0x36){ cout&lt;&lt;"Device&gt; read fail!"&lt;&lt;endl; } Sleep(100); } } } }</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ComPort.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Windows.h&gt; #include "ComPort.h" ComPort::ComPort(LPCWSTR str,DWORD baud) { hSerial=CreateFile(str,GENERIC_READ|GENERIC_WRITE,0,0,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,NULL); ComPort::baud=baud; SerialParams.DCBlength=sizeof(SerialParams); if(!GetCommState(hSerial,&amp;SerialParams)) MessageBox(NULL,L"Getting state error!",L"Error!",MB_OK|MB_ICONERROR); SerialParams.BaudRate=baud; SerialParams.ByteSize=8; SerialParams.StopBits=ONESTOPBIT; SerialParams.Parity=NOPARITY; if(!SetCommState(hSerial,&amp;SerialParams)) MessageBox(NULL,L"Error setting serial port state!",L"Error!",MB_OK|MB_ICONERROR); } void ComPort::ComWrite(unsigned char buf) { DWORD send; WriteFile(hSerial,&amp;buf,1,&amp;send,NULL); } void ComPort::ComWrite(char* buf,int size) { DWORD send; WriteFile(hSerial,buf,size,&amp;send,NULL); } bool ComPort::ComRead(char* buf,int size) { DWORD recv; char recvchar; ZeroMemory(buf,size); for(int i=0;i&lt;size;i++){ ReadFile(hSerial,&amp;recvchar,1,&amp;recv,0); if(recvchar=='~') break; buf[i]=recvchar; } return true; } char ComPort::ComRead() { DWORD recv; char recvchar; ReadFile(hSerial,&amp;recvchar,1,&amp;recv,0); return recvchar; } ComPort::~ComPort(void) { CloseHandle(hSerial); }</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ComPort.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComPort</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: HANDLE hSerial; DCB SerialParams; LPCWSTR sPort; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> baud; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ComPort(LPCWSTR,DWORD); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComWrite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComWrite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">*,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">*,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; ~ComPort(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>); };</code> </pre><br></div></div><br></div></div><br><br>  The code, of course, is not the best, because  I tried to write faster, but it still works great. <br><br>  This is what I got at the end: <br><br><img src="https://habrastorage.org/files/f50/b76/6a7/f50b766a7ab445a997a733fcee768586.JPG" width="400" height="260" alt="image"><br><br><img src="https://habrastorage.org/files/0f3/761/e4f/0f3761e4ff2e46a5b07e2f02ddd6558e.JPG" width="400" height="260" alt="image"><br><br><img src="https://habrastorage.org/files/ec7/c4f/e9b/ec7c4fe9bb7a4135bc7370cfa63163cc.JPG" width="400" height="260" alt="image"><br><br><img src="https://habrastorage.org/files/fe5/eb3/786/fe5eb3786cb149e5928109190e591860.JPG" width="400" height="260" alt="image"><br><br>  And here is the video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/42modiJXviw%3Ffeature%3Doembed&amp;xid=17259,1500002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh-3oZbEnRF10M4y_0WZNDxqKlNUw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/260891/">https://habr.com/ru/post/260891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260875/index.html">Exceptionally simple tasks using AppSec .NET</a></li>
<li><a href="../260877/index.html">Wirmaker Abbreviations: WIM, CSRSS, EMET, CCMP, EFS, SEHOP, ASLR, KPP, UAC, DEP and one more thing</a></li>
<li><a href="../260879/index.html">Malware for OS X: the complete chronicle. The most iconic apple pests of this decade</a></li>
<li><a href="../260881/index.html">First-aid kit sysadmin. Minimal set of utilities for the most effective problem solving</a></li>
<li><a href="../260889/index.html">Microsoft cloud services popularity rating in 2015</a></li>
<li><a href="../260893/index.html">Streets and Heroes</a></li>
<li><a href="../260895/index.html">How I painted the design of the application for the contest Mail.Ru Group</a></li>
<li><a href="../260897/index.html">Small joys of structured metadata</a></li>
<li><a href="../260899/index.html">Introduction to the magic of patterns</a></li>
<li><a href="../260903/index.html">Snowden: NSA is spying on foreign antivirus companies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>