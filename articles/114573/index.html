<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My view of trees in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, actually, I decided to write this post in reply to this message from the sandbox. 
 I do not consider myself a pro in programming, although someti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My view of trees in PHP</h1><div class="post__text post__text-html js-mediator-article"> Hi, actually, I decided to write this post in reply <a href="http://habrahabr.ru/sandbox/25447/">to this</a> message from the sandbox. <br>  I do not consider myself a pro in programming, although sometimes I really want to, but still, I think it‚Äôs wrong to build trees in this way). <br>  I will not build a comment tree, but a menu tree.  My way of building a menu is easy to modify and to build a comment tree.  A menu can have any number of submenus nested.  My menu table structure is: <br><a name="habracut"></a><br> <code>m_Id <br> m_Position <br> m_LineId <br> m_ParentId <br> m_Type <br> m_Title <br> m_Description <br> m_Data <br></code> <br><br>  When I was puzzled by the construction of a tree, I was too lazy to think for myself, I decided to look for ready-made solutions for these your tyrnets.  Ready solutions are kind of like, someone suggested, but these ready solutions were implemented in frameworks that did not suit me, the rest, the trees were built with a bunch of queries to the database, but I believed that there was a way to build an arbitrarily huge tree in just 1 request , moreover, without any perversions with all kinds of COUNT () and other Labuda.  I will not take the time, I will give the code of my class that builds the menu tree: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * * var mixed        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $MenuTree; <span class="hljs-comment"><span class="hljs-comment">/** * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> mixed       , .. ,      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $MenuList; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $level=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int Id     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int/bool  bool==true -      ,     .  ,          * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($menu_id, $return_as_list = false)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         $this-&gt;sql-&gt;Query("SELECT * FROM `menus` WHERE `m_LineId`=?d ORDER BY m_Position, m_ParentId", $menu_id); // $this-&gt;MenuList = array(); $ml = array(); while($r = $this-&gt;sql-&gt;Assoc()) { //    MenuItem    $m = CommonUtils::ObjectFromArray('MenuItem', CommonUtils::DelPrefix($r,'m_')); //       $this-&gt;MenuList[] = $m; //      ,        $ml[] = clone $m; } //  $return_as_list == true       if(is_bool($return_as_list) &amp;&amp; $return_as_list) { return $this-&gt;MenuList; } // ,  $return_as_list == false    else if(!$return_as_list) { $this-&gt;MenuTree = array(); $this-&gt;MenuTree = $this-&gt;GetMenuChilds(0,$ml); return $this-&gt;MenuTree; } // ,  $return_as_list == ,      ,    else if(is_numeric($return_as_list)) { $this-&gt;MenuTree = array(); $this-&gt;MenuTree = $this-&gt;GetMenuChilds(0,$ml, $return_as_list); return $this-&gt;MenuTree; } //print_r($this-&gt;menuTree); } /** * * @param int $p_id Id    * @param mixed $menuList   ,        * @param int $levels   * @return mixed      */ private function GetMenuChilds($p_id, $menuList, $levels = null) { //     ,     $a = array(); //     foreach($menuList as $item) { //</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Optimize code //  ParentId       id, // ,      .    if($item-&gt;ParentId == $p_id) { $this-&gt;level++; //  $levels ,     $this-&gt;levels, //        ,  $levels if($levels != null &amp;&amp; $this-&gt;level &lt;= $levels) { //       .        // $this-&gt;MenuList   , ParentId   id   , // ,       $item-&gt;ChildMenus = $this-&gt;GetMenuChilds($item-&gt;Id, $menuList, $levels); //          $this-&gt;level $item-&gt;Level = $this-&gt;level; //      $a[] = $item; } else { //           $this-&gt;MenuList $item-&gt;ChildMenus = $this-&gt;GetMenuChilds($item-&gt;Id, $menuList); $item-&gt;Level = $this-&gt;level; } $this-&gt;level--; // $levels  ,  ParentId     ,   //  ,        if($levels == null) { $a[] = $item; } } } //      return $a; } /** * * @return mixed      */ public function GetMenuList() { return $this-&gt;MenuList; } /** * * @param int $menu_id Id  ,        * @return mixed    */ public function GetMenuPathTo($menu_id) { //      ,      //  ,     .    $a = array(); for($i=0; $i&lt;count($this-&gt;MenuList); $i++) { //      id  id   if($this-&gt;MenuList[$i]-&gt;Id == $menu_id) { //     $a[] = $this-&gt;MenuList[$i]; //      ,     , //    $menu_id  ,  id    $menu_id = $this-&gt;MenuList[$i]-&gt;ParentId; // ,  ) $i=-1; } } //        -&gt; , //  ,         :  -&gt;  return array_reverse($a); } /** * * @param int $menu_id Id ,     * @return MenuItem   */ public function GetMenuById($menu_id) { $this-&gt;sql-&gt;Query("SELECT * FROM `menus` WHERE `m_Id`=?d LIMIT 1", $menu_id); $record = $this-&gt;sql-&gt;Assoc(); if($record) { $record = CommonUtils::DelPrefix($record,'m_'); return CommonUtils::ObjectFromArray('MenuItem', $record); } return null; } }</span></span></code> </pre><br><br>  The code of the class that represents the menu item: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuItem</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $Id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $Position; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $ParentId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $LineId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $Type; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $Title; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $Description; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $Data; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $Level; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $ChildMenus; }</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I do not know how to highlight the php code, but not about that. <br>  In principle, I think it is clear that the <b>GetMenu ()</b> method allows you to get both the menu tree and the menu as a list.  In addition, if you specify a number from 0 as the second argument to infinity, the menu tree will load with a depth equal to that number. <br><br>  the <b>GetMenuPathTo ()</b> method <b>searches</b> for a path to the menu item whose id is passed as a parameter; this method was implemented to organize bread crumbs on the site <br><br>  <b>CommonUtils :: DelPrefix ()</b> allows you to remove prefixes in associative arrays, allowing you to get the actual names of the properties of menu items. <br>  <b>CommonUtils :: ObjectFromArray ()</b> returns an object of the class specified to it, which will be filled with values ‚Äã‚Äãfrom the associative array passed in the second parameter. <br><br>  I do not argue, perhaps, someone may not like this code, but it does an excellent job with building menu trees, in just 1 database query. <br><br>  All success. <br><br>  <b>upd</b> : // to all who leave kamenty in style: ‚Äúwhat didn‚Äôt suit the% methodname% for building trees‚Äù, or ‚Äúwhy not% methodname%?‚Äù solemnly declare: There are a lot of ways to build trees.  I brought my implementation, because  most likely did not know about your% methodname%.  Anyways, your comments are important to me and will not be left without proper attention. </div><p>Source: <a href="https://habr.com/ru/post/114573/">https://habr.com/ru/post/114573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../114568/index.html">Comile User Interface</a></li>
<li><a href="../114569/index.html">Get inspired with Cisco</a></li>
<li><a href="../114570/index.html">Simple use of AsyncTask and ProgressDialog in Android</a></li>
<li><a href="../114571/index.html">Management of requirements for IT projects</a></li>
<li><a href="../114572/index.html">InnoDB full text search</a></li>
<li><a href="../114574/index.html">Yandex.Money: direct payment from the card</a></li>
<li><a href="../114576/index.html">Notes on the Python object system part 1</a></li>
<li><a href="../114577/index.html">Facebook announced an "interactive" security policy</a></li>
<li><a href="../114578/index.html">American 2.5 years to pay bills defunct Internet girlfriend</a></li>
<li><a href="../114579/index.html">Prospects for the development of central processing units</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>