<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cobbler + puppet or Ubuntu 12.04 network installation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Sooner or later, every serious company has to think about the legalization of its IT infrastructure. Take the medium-sized company N. C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cobbler + puppet or Ubuntu 12.04 network installation</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Sooner or later, every serious company has to think about the legalization of its IT infrastructure.  Take the medium-sized company N. Central office, 30 small branches.  Everywhere there are workstations under Windows, mainly XP.  On more recent machines, laptops, there are windows 7 and 8, on servers 2k3, 2k8, ubuntu-server. <br>  The company is expanding not too fast, and the small IT department manages to roll out new machines from the previously created images of Acronis.  But in order to reduce costs / legalize infrastructure / clean conscience, a decision is made to switch to opensource.  There is a different scale of the tragedy, to reinstall many workstations with your hands - a long and ungrateful process.  Under the cut - one of the solutions to this problem. <a name="habracut"></a><br><br><h4>  1. Tools and installation of the required packages. </h4><br>  It was decided to install Ubuntu 12.04.3 LTS using PXE.  Cobbler and puppet were chosen as implementation tools. <br>  obbler is a network installation server for Linux, which provides fast building of the necessary deployment environment and managing the OS installation process on new computers or virtual machines (Xen, qemu, KVM or VMware Server), and subsequent reinstallation of systems. <br>  Cobbler is written in Python and is a bundle for some PXE, TFTP, DHCP, and other standard components for such cases. <br><br>  Install the packages we need: <br><pre><code class="bash hljs">sudo apt-get install cobbler cobbler-common cobbler-web dhcp3-server xinetd tftpd tftp debmirror</code> </pre> <br>  By default, we will get cobbler version 2.2.3, which is not very good.  Why - find out further. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then check if our cobbler is happy with everything: <br><pre> <code class="bash hljs">sudo cobbler check</code> </pre> <br>  What should be seen in response: <br><pre> <code class="bash hljs">No configuration problems found. All systems go.</code> </pre> <br>  Sync configuration: <br><pre> <code class="bash hljs">sudo cobbler sync</code> </pre> <br>  Now the cobbler is ready for further customization. <br><br><h4>  2. Configure Cobbler </h4><br>  Change the cobbler configuration by specifying the network settings of the server on which it is installed: <br><pre> <code class="bash hljs">sudo dpkg-reconfigure cobbler</code> </pre> <br>  We specify the server address on the network, the password for the cobbler web interface. <br>  Configure the cobbler to use DHCP: <br><pre> <code class="bash hljs">sudo nano /etc/cobbler/settings</code> </pre> <br>  change <br><pre> <code class="bash hljs">manage_dhcp: 0</code> </pre>  on <br><pre> <code class="bash hljs">manage_dhcp: 1</code> </pre> <br>  Reboot and sync the cobbler configuration: <br><pre> <code class="bash hljs">sudo service cobbler restart sudo cobbler sync</code> </pre> <br>  Let's change the DHCP template that cobbler will transmit to the isc-dhcp-server: <br><pre> <code class="bash hljs">sudo nano /etc/cobbler/dhcp.template</code> </pre> <br>  We lead to the form: <br><pre> <code class="bash hljs">subnet 192.168.1.0 netmask 255.255.255.0 { <span class="hljs-comment"><span class="hljs-comment"># option routers 192.168.1.254; #  option domain-name-servers 192.168.1.254; # DNS  option subnet-mask 255.255.255.0; # range dynamic-bootp 192.168.1.10 192.168.1.20; #  IP</span></span></code> </pre> <br>  And reboot the cobbler again: <pre> <code class="bash hljs">sudo service cobbler restart sudo cobbler sync</code> </pre> <br>  Now cobbler is ready to import your ISO file, but here, as promised, I will explain the situation with some nuances of cobbler 2.2.3. <br><br><h5>  Actually, the nuances. </h5><br>  <i>The first rake, which drove my bike, was the fact that I could not import the image of the desktop version.</i>  <i>After importing to cobbler, it was not visible in the list of possible distributions for installation.</i>  <i>After the forums of our overseas friends google - it turned out that you need to use alternate, server, mini versions of Ubuntu distributors, the desktop cobbler simply does not see (although there are some workaround, but it was easier for me to download alternate).</i>  <i>Also, a feature of version 2.2.3 is that it does not create a local distribution from your image, only the kernel loads during installation, all other packages are downloaded from repositories on the Internet.</i>  <i>At least so it was with the image of lubuntu-12.04-alternate-i386.</i>  <i>In version 2.4, a local distribution is created, and the packages are installed directly from your ISO image.</i> <br><br>  Continue <br>  Let's mount our image and import it into the cobbler distribution list: <br><pre> <code class="bash hljs">sudo mount -o loop lubuntu1203.iso /mnt sudo cobbler import --name=lubuntu-12-4 --path=/mnt --breed=ubuntu</code> </pre> <br>  The cobbler-web package was not in vain.  We can access its web-interface at the following address: 192.168.1.2/cobbler_web <br><br>  Here you can set up a lot of useful things, add your distributions, packages, repositories, profiles, and more.  Our task is to customize the profile we imported.  Go to Profiles, where we see lubuntu-12-4, click Edit.  Here our task is to add kickstart <br><img src="https://habrastorage.org/getpro/habr/post_images/fe4/0fe/22f/fe40fe22ffdf967735d2fd466d5f7b84.png" alt="image"><br>  Already at the last stage, when installing Ubuntu on a client machine, I came across the error ‚ÄúBad Archive Mirror‚Äù. <br>  Solved by copying and renaming the kickstart file <br><pre> <code class="bash hljs">/var/lib/cobbler/kickstarts/ubuntu-server.preseed</code> </pre>  at <br><pre> <code class="bash hljs">/etc/cobbler/precise.ubuntu.alternate.lan.preseed</code> </pre> <br>  In our profile, we will write the path to the kickstart in the appropriate place: <br><img src="https://habrastorage.org/getpro/habr/post_images/754/f53/79c/754f5379c60b4edf147ddee83cd76ce1.png" alt="image"><br><h4>  3. Puppet </h4><br>  The puppet was given the function of fine-tuning the machines.  In the example I reviewed, the presence of some packages on the client machine, and their installation, in case of absence, will be checked. <br>  Install puppet on the server: <br><pre> <code class="bash hljs">sudo apt-get install puppetmaster</code> </pre> <br>  And on the client: <br><pre> <code class="bash hljs">sudo apt-get install puppet</code> </pre> <br>  For convenience, by the way, in / etc / cobbler / settings there is a puppet_auto_setup parameter that puts the puppet automatically, but requires you to have a local copy of EPEL on your server.  Either I do not fully understand, or the idea is really stupid, but everything can be implemented through the post-install script in the cobbler itself is much easier. <br>  It is assumed that the machines get their names from DNS, otherwise, you will have to configure the hosts files on the client and the puppet server, respectively. <br><pre> <code class="bash hljs">192.168.0.1 puppetmaster.example.com puppetmaster puppet 192.168.0.10 puppetclient.example puppetclient</code> </pre> <br>  Create a manifest /etc/puppet/manifests/site.pp with the following content (the packages are chosen for an example, for detailed configuration of puppet, refer to its documentation): <br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$base_packages</span></span> = [ ‚Äúgnome‚Äù, ‚Äúmc‚Äù, ‚Äúopenssh-server‚Äù, ‚Äúvim‚Äù ] package { <span class="hljs-variable"><span class="hljs-variable">$base_packages</span></span>: ensure =&gt; installed }</code> </pre> <br>  The final step for this simple Puppet server is to restart the service: <br><pre> <code class="bash hljs">sudo /etc/init.d/puppetmaster restart</code> </pre> <br>  Now we can request a certificate from the client: <br><pre> <code class="bash hljs">puppet agent --server puppetmaster --waitforcert 60 --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span> info: Creating a new SSL certificate request <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> puppetclient</code> </pre> <br>  View the certificate signing request on the server: <br><pre> <code class="bash hljs">puppet cert --list</code> </pre> <br>  Now we have to see the request from the client, we will sign: <br><pre> <code class="bash hljs">puppet cert --sign puppetclient</code> </pre> <br>  At the first attempt to connect to the server, the puppet generated an error that the server name in the certificate does not match the name to which the request was <code>/etc/puppet/puppet.conf</code> , you need to edit <code>/etc/puppet/puppet.conf</code> <br><pre> <code class="bash hljs">[master] certname=puppetmaster</code> </pre> <br>  That's all, the client machine will install the packages specified in the manifest. <br><br><h4>  Conclusion </h4><br>  This process may differ slightly on different distributions.  You may need to create the missing folder, which will be explicitly written in the console.  It was also not possible to overcome the hangup at the beginning of the installation, for about 15 minutes, it may seem that the machine just hung.  As far as I was able to learn, deduplicate is running.  Too often found bug described in bug trackers.  Why, why - maybe someone will tell exactly here.  Criticism, advice, corrections - are welcome. </div><p>Source: <a href="https://habr.com/ru/post/204788/">https://habr.com/ru/post/204788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204770/index.html">YotaPhone went on sale</a></li>
<li><a href="../204772/index.html">Group Policy: what's new? Cheat Sheet for all occasions</a></li>
<li><a href="../204780/index.html">Managed Service Accounts</a></li>
<li><a href="../204782/index.html">Directional lighting and shading in 2D space</a></li>
<li><a href="../204784/index.html">Solving Japanese Crosswords in Wolfram Mathematica</a></li>
<li><a href="../204792/index.html">A1Agregator terminates agreements with medium-sized partners</a></li>
<li><a href="../204794/index.html">The British company proposes to extract energy using drones hovering at a height of 15 kilometers.</a></li>
<li><a href="../204796/index.html">Alert users about password expiration and account validity</a></li>
<li><a href="../204798/index.html">DEV Labs, Part 3. Online C ++ Conference</a></li>
<li><a href="../204800/index.html">Aluminum fuel vehicle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>