<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating QuickAction Conversations in Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About how to write Hello World on the Internet is full, so I decided to talk about more interesting things. The official Twitter application for Andro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating QuickAction Conversations in Android</h1><div class="post__text post__text-html js-mediator-article"> About how to write Hello World on the Internet is full, so I decided to talk about more interesting things.  The official Twitter application for Android uses patterns and GUI features introduced in the latest versions of sdk, such as Dashboard, Search Bar, QuickAction and Action Bar.  The QuickAction dialog is one of the most interesting novelties; it displays contextual actions for this ListView element.  This dialog is also used in the contacts application since version 2.0 <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/bd6/abb/b7c/bd6abbb7c0c5a34f5e8e424ba112687d.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/09a/5bc/6cb/09a5bc6cba1905baee272ab411c40291.jpg"><br>  The QuickAction dialog is not included in the standard sdk, so we will try to create it ourselves.  Initially, I had no ideas, I just had to download the source code for the Contacts application and see how this is done, android is open source.  Delving into the source code, I noticed that private API calls are being used there (com.android.internal.policy.PolicyManager), which are not available in the standard sdk. After some thought, I found an exit based on the ontacts source code.  Here are the sources of the most important class that implements the pop-up dialogue.  To use a custom dialog, we simply inherit from it. <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> <blockquote><ol><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); //       ,   window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { @Override <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> </ol> <code><code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popup. import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.BitmapDrawable; import android.graphics.drawable.Drawable; import android.view.Gravity; import android.view.LayoutInflater; import android.view.MotionEvent; import android.view.View; import android.view.View.OnTouchListener; import android.view.ViewGroup.LayoutParams; import android.view.WindowManager; import android.widget.PopupWindow; <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomPopupWindow { <font color="#0000ff">protected</font> final View anchor; <font color="#0000ff">protected</font> final PopupWindow window; <font color="#0000ff">private</font> View root; <font color="#0000ff">private</font> Drawable background = <font color="#0000ff">null</font> ; <font color="#0000ff">protected</font> final WindowManager windowManager; <font color="#0000ff">public</font> CustomPopupWindow(View anchor) { <font color="#0000ff">this</font> .anchor = anchor; <font color="#0000ff">this</font> .window = <font color="#0000ff">new</font> PopupWindow(anchor.getContext()); <font color="#008000">//       ,  </font> window.setTouchInterceptor( <font color="#0000ff">new</font> OnTouchListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean onTouch(View v, MotionEvent <font color="#0000ff">event</font> ) { <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .getAction() == MotionEvent.ACTION_OUTSIDE) { CustomPopupWindow. <font color="#0000ff">this</font> .window.dismiss(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } }); windowManager = (WindowManager) anchor.getContext().getSystemService(Context.WINDOW_SERVICE); onCreate(); } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onCreate() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> onShow() {} <font color="#0000ff">protected</font> <font color="#0000ff">void</font> preShow() { <font color="#0000ff">if</font> (root == <font color="#0000ff">null</font> ) { <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"error"</font> ); } onShow(); <font color="#0000ff">if</font> (background == <font color="#0000ff">null</font> ) { window.setBackgroundDrawable( <font color="#0000ff">new</font> BitmapDrawable()); } <font color="#0000ff">else</font> { window.setBackgroundDrawable(background); } window.setWidth(WindowManager.LayoutParams.WRAP_CONTENT); window.setHeight(WindowManager.LayoutParams.WRAP_CONTENT); window.setTouchable( <font color="#0000ff">true</font> ); window.setFocusable( <font color="#0000ff">true</font> ); window.setOutsideTouchable( <font color="#0000ff">true</font> ); window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setBackgroundDrawable(Drawable background) { <font color="#0000ff">this</font> .background = background; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView(View root) { <font color="#0000ff">this</font> .root = root; window.setContentView(root); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setContentView( <font color="#0000ff">int</font> layoutResID) { LayoutInflater inflator = (LayoutInflater) anchor.getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE); setContentView(inflator.inflate(layoutResID, <font color="#0000ff">null</font> )); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnDismissListener(PopupWindow.OnDismissListener listener) { window.setOnDismissListener(listener); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown() { showDropDown(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showDropDown( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopDownMenu); window.showAsDropDown(anchor, xOffset, yOffset); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction() { showLikeQuickAction(0, 0); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> showLikeQuickAction( <font color="#0000ff">int</font> xOffset, <font color="#0000ff">int</font> yOffset) { preShow(); window.setAnimationStyle(R.style.Animations_PopUpMenu_Center); <font color="#0000ff">int</font> [] location = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootWidth     = root.getMeasuredWidth(); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> xPos       = ((screenWidth - rootWidth) / 2) + xOffset; <font color="#0000ff">int</font> yPos       = anchorRect.top - rootHeight + yOffset; <font color="#0000ff">if</font> (rootHeight &gt; anchorRect.top) { yPos = anchorRect.bottom + yOffset; window.setAnimationStyle(R.style.Animations_PopDownMenu_Center); } window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> dismiss() { window.dismiss(); } } * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </blockquote> <br>  Now we need to write a class that will be a specific Action. <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote><ol><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> </ol> <code><code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } * This source code was highlighted with <font color="gray">Source Code Highlighter</font> . <br></font></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.graphics.drawable.Drawable; import android.view.View.OnClickListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> ActionItem { <font color="#0000ff">private</font> Drawable icon; <font color="#0000ff">private</font> String title; <font color="#0000ff">private</font> OnClickListener listener; <font color="#0000ff">public</font> ActionItem() {} <font color="#0000ff">public</font> ActionItem(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTitle(String title) { <font color="#0000ff">this</font> .title = title; } <font color="#0000ff">public</font> String getTitle() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .title; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setIcon(Drawable icon) { <font color="#0000ff">this</font> .icon = icon; } <font color="#0000ff">public</font> Drawable getIcon() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .icon; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setOnClickListener(OnClickListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">public</font> OnClickListener getListener() { <font color="#0000ff">return</font> <font color="#0000ff">this</font> .listener; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br>  We now turn to the most interesting creation of the dialog box itself. <br>  We will need to create a class that inherits from CustomPopupWindow <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> <blockquote><ol><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> </ol> <code><code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> package az.mecid.popups; import android.content.Context; import android.graphics.Rect; import android.graphics.drawable.Drawable; import android.widget.ImageView; import android.widget.TextView; import android.widget.LinearLayout; import android.widget.ScrollView; import android.view.Gravity; import android.view.LayoutInflater; import android.view.View; import android.view.View.OnClickListener; import android.view.ViewGroup.LayoutParams; import android.view.ViewGroup; import java.util.ArrayList; <font color="#0000ff">public</font> <font color="#0000ff">class</font> QuickAction extends CustomPopupWindow { <font color="#0000ff">private</font> final View root; <font color="#0000ff">private</font> final ImageView mArrowUp; <font color="#0000ff">private</font> final ImageView mArrowDown; <font color="#0000ff">private</font> final LayoutInflater inflater; <font color="#0000ff">private</font> final Context context; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_LEFT = 1; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_RIGHT = 2; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_GROW_FROM_CENTER = 3; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_REFLECT = 4; <font color="#0000ff">protected</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> ANIM_AUTO = 5; <font color="#0000ff">private</font> <font color="#0000ff">int</font> animStyle; <font color="#0000ff">private</font> ViewGroup mTrack; <font color="#0000ff">private</font> ScrollView scroller; <font color="#0000ff">private</font> ArrayList&lt;ActionItem&gt; actionList; <font color="#0000ff">public</font> QuickAction(View anchor) { super(anchor); actionList  = <font color="#0000ff">new</font> ArrayList&lt;ActionItem&gt;(); context    = anchor.getContext(); inflater   = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); root    = (ViewGroup) inflater.inflate(R.layout.popup, <font color="#0000ff">null</font> ); mArrowDown   = (ImageView) root.findViewById(R.id.arrow_down); mArrowUp   = (ImageView) root.findViewById(R.id.arrow_up); setContentView(root); mTrack       = (ViewGroup) root.findViewById(R.id.tracks); scroller    = (ScrollView) root.findViewById(R.id.scroller); animStyle    = ANIM_AUTO; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> setAnimStyle( <font color="#0000ff">int</font> animStyle) { <font color="#0000ff">this</font> .animStyle = animStyle; } <font color="#0000ff">public</font> <font color="#0000ff">void</font> addActionItem(ActionItem action) { actionList.add(action); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> show () { preShow(); <font color="#0000ff">int</font> xPos, yPos; <font color="#0000ff">int</font> [] location     = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; anchor.getLocationOnScreen(location); Rect anchorRect   = <font color="#0000ff">new</font> Rect(location[0], location[1], location[0] + anchor.getWidth(), location[1] + anchor.getHeight()); createActionList(); root.setLayoutParams( <font color="#0000ff">new</font> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); root.measure(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT); <font color="#0000ff">int</font> rootHeight     = root.getMeasuredHeight(); <font color="#0000ff">int</font> rootWidth    = root.getMeasuredWidth(); <font color="#0000ff">int</font> screenWidth   = windowManager.getDefaultDisplay().getWidth(); <font color="#0000ff">int</font> screenHeight  = windowManager.getDefaultDisplay().getHeight(); <font color="#0000ff">if</font> ((anchorRect.left + rootWidth) &gt; screenWidth) { xPos = anchorRect.left - (rootWidth-anchor.getWidth()); } <font color="#0000ff">else</font> { <font color="#0000ff">if</font> (anchor.getWidth() &gt; rootWidth) { xPos = anchorRect.centerX() - (rootWidth/2); } <font color="#0000ff">else</font> { xPos = anchorRect.left; } } <font color="#0000ff">int</font> dyTop      = anchorRect.top; <font color="#0000ff">int</font> dyBottom    = screenHeight - anchorRect.bottom; boolean onTop    = (dyTop &gt; dyBottom) ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> (onTop) { <font color="#0000ff">if</font> (rootHeight &gt; dyTop) { yPos       = 15; LayoutParams l   = scroller.getLayoutParams(); l.height    = dyTop - anchor.getHeight(); } <font color="#0000ff">else</font> { yPos = anchorRect.top - rootHeight; } } <font color="#0000ff">else</font> { yPos = anchorRect.bottom; <font color="#0000ff">if</font> (rootHeight &gt; dyBottom) { LayoutParams l   = scroller.getLayoutParams(); l.height    = dyBottom; } } showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up), anchorRect.centerX()-xPos); setAnimationStyle(screenWidth, anchorRect.centerX(), onTop); window.showAtLocation(anchor, Gravity.NO_GRAVITY, xPos, yPos); } <font color="#0000ff">private</font> <font color="#0000ff">void</font> setAnimationStyle( <font color="#0000ff">int</font> screenWidth, <font color="#0000ff">int</font> requestedX, boolean onTop) { <font color="#0000ff">int</font> arrowPos = requestedX - mArrowUp.getMeasuredWidth()/2; <font color="#0000ff">switch</font> (animStyle) { <font color="#0000ff">case</font> ANIM_GROW_FROM_LEFT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_RIGHT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_GROW_FROM_CENTER: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_REFLECT: window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Reflect : R.style.Animations_PopDownMenu_Reflect); <font color="#0000ff">break</font> ; <font color="#0000ff">case</font> ANIM_AUTO: <font color="#0000ff">if</font> (arrowPos &lt;= screenWidth/4) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Left : R.style.Animations_PopDownMenu_Left); } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (arrowPos &gt; screenWidth/4 &amp;&amp; arrowPos &lt; 3 * (screenWidth/4)) { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Center : R.style.Animations_PopDownMenu_Center); } <font color="#0000ff">else</font> { window.setAnimationStyle((onTop) ? R.style.Animations_PopUpMenu_Right : R.style.Animations_PopDownMenu_Right); } <font color="#0000ff">break</font> ; } } <font color="#0000ff">private</font> <font color="#0000ff">void</font> createActionList() { View view; String title; Drawable icon; OnClickListener listener; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; actionList.size(); i++) { title     = actionList.get(i).getTitle(); icon     = actionList.get(i).getIcon(); listener  = actionList.get(i).getListener(); view     = getActionItem(title, icon, listener); view.setFocusable( <font color="#0000ff">true</font> ); view.setClickable( <font color="#0000ff">true</font> ); mTrack.addView(view); } } <font color="#0000ff">private</font> View getActionItem(String title, Drawable icon, OnClickListener listener) { LinearLayout container  = (LinearLayout) inflater.inflate(R.layout.action_item, <font color="#0000ff">null</font> ); ImageView img      = (ImageView) container.findViewById(R.id.icon); TextView text      = (TextView) container.findViewById(R.id.title); <font color="#0000ff">if</font> (icon != <font color="#0000ff">null</font> ) { img.setImageDrawable(icon); } <font color="#0000ff">if</font> (title != <font color="#0000ff">null</font> ) { text.setText(title); } <font color="#0000ff">if</font> (listener != <font color="#0000ff">null</font> ) { container.setOnClickListener(listener); } <font color="#0000ff">return</font> container; } <font color="#0000ff">private</font> <font color="#0000ff">void</font> showArrow( <font color="#0000ff">int</font> whichArrow, <font color="#0000ff">int</font> requested { final View showArrow = (whichArrow == R.id.arrow_up) ? mArrowUp : mArrowDown; final View hideArrow = (whichArrow == R.id.arrow_up) ? mArrowDown : mArrowUp; final <font color="#0000ff">int</font> arrowWidth = mArrowUp.getMeasuredWidth(); showArrow.setVisibility(View.VISIBLE); ViewGroup.MarginLayoutParams param = (ViewGroup.MarginLayoutParams)showArrow.getLayoutParams(); param.leftMargin = requestedX - arrowWidth / 2; hideArrow.setVisibility(View.INVISIBLE); } } * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </blockquote> <br><br>  Don't be afraid of the code, it's very simple to use it, now let's try to use all this code. <br>  I will not give all the code, everything is extremely simple. <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> <blockquote><ol><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li></li><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </li> </ol> <code><code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> final ActionItem first = <font color="#0000ff">new</font> ActionItem(); first.setTitle( <font color="#A31515">"Dashboard"</font> ); first.setIcon(getResources().getDrawable(R.drawable.dashboard)); first.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Dashboard"</font> , Toast.LENGTH_SHORT).show(); } }); final ActionItem second = <font color="#0000ff">new</font> ActionItem(); second.setTitle( <font color="#A31515">"Users &amp; Groups"</font> ); second.setIcon(getResources().getDrawable(R.drawable.kontak)); second.setOnClickListener( <font color="#0000ff">new</font> OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { Toast.makeText(TestQuickAction. <font color="#0000ff">this</font> , <font color="#A31515">"Users &amp; Groups"</font> , Toast.LENGTH_SHORT).show(); } }); Button btn1 = (Button) <font color="#0000ff">this</font> .findViewById(R.id.btn1); btn1.setOnClickListener( <font color="#0000ff">new</font> View.OnClickListener() { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(View v) { QuickAction qa = <font color="#0000ff">new</font> QuickAction(v); qa.addActionItem(first); qa.addActionItem(second); qa.show(); } }); * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code></code> </blockquote> <br><img src="https://habrastorage.org/getpro/habr/post_images/567/d7d/a70/567d7da707cbdd90315c50a40c55327c.jpg"><br><br>  PS use in your applications. <br>  PSS The original article is in my <a href="http://droidstyle.blogspot.com/2010/09/blog-post.html">blog.</a> <br><blockquote>  The author of this article is <a href="https://habrahabr.ru/users/mecid/" class="user_link">Mecid</a> who for some unknown reason cannot publish it on her own. <br></blockquote></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/103582/">https://habr.com/ru/post/103582/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../103575/index.html">HTML5 for web designers. Part 2: The HTML5 Model</a></li>
<li><a href="../103576/index.html">The Japanese introduced advanced Tamagotchi</a></li>
<li><a href="../103577/index.html">Wolframalpha + Wikipedia = Galois / Wiki</a></li>
<li><a href="../103578/index.html">Kaspersky still hangs when updating</a></li>
<li><a href="../103580/index.html">In the US, put the "Nigerian" spammer for 12 years</a></li>
<li><a href="../103588/index.html">ToDoid - Quick task scheduling on Android</a></li>
<li><a href="../103589/index.html">Video Galaxy Tab</a></li>
<li><a href="../103591/index.html">Updates on 42goals: API, time tracking, tabs, goals archive</a></li>
<li><a href="../103592/index.html">Chinese Android tablet Apad iRobot</a></li>
<li><a href="../103594/index.html">Is it possible to use Java applet on the page if JS and Flash do not have the necessary functionality?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>