<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>em-dosbox and 50 gifts for the new year</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some things only get better over the years. For example, classic games designed in the DOS era are fascinating. Each one of them is a piece product ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>em-dosbox and 50 gifts for the new year</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ebd/8e6/ff9/ebd8e6ff99ac47dca992562581dd8a6a.png" align="left">  Some things only get better over the years.  For example, classic games designed in the DOS era are fascinating.  Each one of them is a piece product made with great love.  Unfortunately, the DOS platform is a thing of the past, and great products go along with it.  Return them to the modern world - is this not a real gift? <br><a name="habracut"></a><br><br>  How?  Very simple!  An interested reader, of course, remembers the emscripten project, thanks to which C ++ code can be converted to JavaScript to work in a browser.  It was with his help that DOOM, Dune 2, TTD, X-COM and many others were adapted for the browser.  However, this path is long and difficult.  One project can take up to six months.  And if you want everything at once?  Is there any other way? <br><br><h3>  em-dosbox </h3><br>  There is another way - use DosBox.  Indeed, why port each project separately, when you can port the entire DOS platform (to be exact, an MS-DOS emulator).  This brilliant idea embodied <i>Boris Gjenero</i> in the project <a href="https://github.com/dreamlayers/em-dosbox">em-dosbox</a> .  This is a DosBox javascript port made using emscripten. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, now I will tell you how to transfer ‚Äúalmost any‚Äù DOS program to the browser. <br><br>  Ingredients: <br><ul><li>  Browser </li><li>  em-dosbox (dosbox.js) </li><li>  The program works correctly in DosBox </li></ul><br><br><img src="https://habrastorage.org/files/292/1b1/40a/2921b140a1974639bc54c5438816616b.png" align="right">  During operation, the browser loads dosbox.js and a data packet with the program (usually a binary file with the packed directory of the source program).  The dosbox.js script is nothing more than DosBox ported to JavaScript, when executed it emulates a DOS platform running a program in it. <br><br><h4>  Compiling dosbox.js </h4><br>  It's simple.  Clone the em-dosbox repository and compile with autotools and make <br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/dreamlayers/em-dosbox.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> em-dosbox ./configure make</code> </pre> <br>  If successful, <i>dosbox.html</i> and <i>dosbox.js</i> appear in the <i>src</i> folder <i>.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Improve em-dosbox performance</b> <div class="spoiler_text">  Add <i>dosbox - memory-init-file 0</i> option to <i>dosbox_LDFLAGS</i> in <i>src / Makefile.am</i> .  This option disables the generation of a memory file that is used to speed up loading.  In our case, this file will be about thirty megabytes in size, which is not applicable for the browser. <br><pre> <code class="bash hljs">dosbox_LDFLAGS = -s TOTAL_MEMORY=67108864 --pre-js pre.js --memory-init-file 0</code> </pre><br>  <i>I</i> recommend replacing the <i>src / dosbox.cpp</i> file <br><pre> <code class="bash hljs">emscripten_set_main_loop(em_main_loop, 100, 1);</code> </pre>  on <pre> <code class="bash hljs">emscripten_set_main_loop(em_main_loop, 0, 1);</code> </pre><br>  This edit will increase productivity by an order of magnitude.  But you need to take into account that the target program must be smart enough and able to run at the same speed regardless of the computer performance, otherwise your program will run too fast. <br><br>  To speed up the emulator, add lines to the <i>main</i> function in the <i>src / gui / sdlmain.cpp file</i> : <br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> EMSCRIPTEN EM_ASM(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SDL.defaults.copyOnLock = false; SDL.defaults.discardOnLock = true; SDL.defaults.opaqueFrontBuffer = false;"</span></span></span><span class="hljs-meta">); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br><br></div></div><br><br><h4>  Packaging program </h4><br>  em-dosbox comes with a script that allows you to package the program directory into a binary file that can be used with dosbox.js.  For example, to get a batch file for a Dune 2 game, just run: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#python src/packager.py &lt; &gt; &lt;  &gt; &lt; &gt; python src/packager.py dune2 ~/dune2 dune2.exe</span></span></code> </pre><br>  If successful, the files <i>dune2.html</i> and <i>dune2.data</i> will be created.  The HTML file is created using the <i>dosbox.html</i> template (I remind you that it is in the <i>src</i> folder). <br><br><div class="spoiler">  <b class="spoiler_title">Change dosbox settings</b> <div class="spoiler_text">  By default, dosbox will be launched with the standard configuration.  To change it, simply create a <i>dosbox.conf</i> file in the program <i>folder</i> .  And modify the build script as follows: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#86  f.write("Module['arguments'] = [ '-conf', './dosbox.conf', './" + EXECUTABLE + "' ];\n&lt;/script&gt;\n")</span></span></code> </pre><br></div></div><br><h4>  Launch </h4><br>  So, we have three files: <br><ul><li>  program.html </li><li>  program.data </li><li>  dosbox.js </li></ul><br><br>  Placing them on the server, we can run the program in the browser. <br><br>  Happy New Year. <br>  <a href="http://js-dos.com/">50 New Year's gifts.</a> <br><br><div class="spoiler">  <b class="spoiler_title">List of adapted games</b> <div class="spoiler_text">  The following games have been adapted for the browser using the em-dosbox: <br><ul><li>  Abuse </li><li>  Alley cat </li><li>  Another world </li><li>  Arcade volleyball </li><li>  Arkanoid </li><li>  Battle chess </li><li>  Budokan: The Martial Spirit </li><li>  Cd man </li><li>  Colorado </li><li>  Dangerous Dave in the Haunted Mansion </li><li>  Deathtrack </li><li>  Digger </li><li>  Disney's Duck Tales: The Quest for Gold </li><li>  Doom </li><li>  Doom 2 </li><li>  Dune 2 </li><li>  Dyna blaster </li><li>  Earthworm Jim 2 </li><li>  Fire &amp; Forget II </li><li>  Goblins 1-3 </li><li>  Golden ax </li><li>  Heretic: Shadow of the Serpent Riders </li><li>  Incredible Machine </li><li>  The </li><li>  IndyCar racing </li><li>  Krypton egg </li><li>  Lamborghini: American Challenge </li><li>  Lode runner </li><li>  Lost vikings </li><li>  The </li><li>  Metal mutant </li><li>  Micro machines </li><li>  Mine bombers </li><li>  Mortal kombat </li><li>  Pac-man </li><li>  Prehistorik </li><li>  Prehistorik 2 </li><li>  Prince of Persia </li><li>  Scorched Earth: The Mother of All Games </li><li>  SimCity </li><li>  Stunts </li><li>  Supaplex </li><li>  Test drive </li><li>  Tetris </li><li>  Tower toppler </li><li>  Tyrian 2000 </li><li>  Ugh! </li><li>  WarCraft: Orcs &amp; Humans </li><li>  Wings of fury </li><li>  Winter Supersports 92 </li><li>  Wolfenstein 3d </li><li>  Xonix </li></ul><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/247049/">https://habr.com/ru/post/247049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247033/index.html">Hacker's guide to neural networks. Chapter 2: Machine Learning. More traditional approach: Loss functions</a></li>
<li><a href="../247039/index.html">How Iceland becomes a data center paradise</a></li>
<li><a href="../247041/index.html">VNC Roulette. Srsly?</a></li>
<li><a href="../247045/index.html">Plotter based on the Makeblock constructor</a></li>
<li><a href="../247047/index.html">C #: Internal structure of array initializers</a></li>
<li><a href="../247053/index.html">Sorting on a single-linked list in O (nlogn) time, at worst, with O (1) additional memory</a></li>
<li><a href="../247055/index.html">Adventures Tyzh-programmer. New Year's Eve Mood Post</a></li>
<li><a href="../247057/index.html">Samsung Introduces SE790C - Ultra WQHD 34-inch Curved Monitor</a></li>
<li><a href="../247059/index.html">Drupal - choosing a business consultant</a></li>
<li><a href="../247071/index.html">Features and configuration of 3CX WebMeeting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>