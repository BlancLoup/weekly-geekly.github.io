<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Manage dependencies in iOS applications correctly: Typhoon modularity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article of the cycle, we briefly reviewed the basic principles of the structure and operation of the Typhoon Framework - Dependency In...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Manage dependencies in iOS applications correctly: Typhoon modularity</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/163/7a2/b14/1637a2b14a37403c9e7f2714a3950701.jpg"><br><br>  <i>In the <a href="http://habrahabr.ru/company/rambler-co/blog/260355/">previous article of the</a> cycle, we briefly reviewed the basic principles of the structure and operation of the <b>Typhoon Framework</b> - Dependency Injection Container for iOS.</i>  <i>Nevertheless, it is not enough to understand how the instrument works - the most important thing is to use it correctly.</i>  <i>In the first part, we looked at various examples of configuring the created dependencies, now we will deal with a higher level - breaking up the TyphoonAssembly into modules and testing them.</i> <br><a name="habracut"></a><br><h4>  <b>Cycle "Manage dependencies in iOS applications correctly"</b> </h4><br><ul><li>  <a href="http://habrahabr.ru/company/rambler-co/blog/258325/">Meet Typhoon</a> </li><li>  <a href="http://habrahabr.ru/company/rambler-co/blog/260355/">Typhoon device</a> </li><li>  <a href="http://habrahabr.ru/company/rambler-co/blog/261537/">Modularity Typhoon</a> </li><li>  <a href="http://habrahabr.ru/company/rambler-co/blog/264683/">Typhoon Tips &amp; Tricks</a> </li><li>  Alternatives to Typhoon </li><li>  <i><a href="http://www.slideshare.net/Rambler-iOS/dependency-injection-ios">(Optional) Rambler.iOS # 3.</a></i>  <i><a href="http://www.slideshare.net/Rambler-iOS/dependency-injection-ios">Dependency Injection in iOS.</a></i>  <i><a href="http://www.slideshare.net/Rambler-iOS/dependency-injection-ios">Slides</a></i> </li><li>  <i><a href="https://www.youtube.com/watch%3Fv%3DLO59z3fjc9k">(Optional) Rambler.iOS # 3.</a></i>  <i><a href="https://www.youtube.com/watch%3Fv%3DLO59z3fjc9k">Dependency Injection in iOS.</a></i>  <i><a href="https://www.youtube.com/watch%3Fv%3DLO59z3fjc9k">Video</a></i> </li></ul><br><h4>  <b>Why do we need modularity</b> </h4><br>  Take as an example a fairly simple application - a client for a weather service (by the way, <a href="https://github.com/appsquickly/Typhoon-example">one of the demo applications</a> ).  It consists of the following screens: <br><ul><li>  List of cities for which there is weather data </li><li>  Information about the weather in the selected city, </li><li>  Adding a new geographic point </li><li>  Application settings. </li></ul><br><img src="https://habrastorage.org/files/9e9/341/a2f/9e9341a2ff7548988a0e1a21161a12b5.png"><br><br>  Here there are the first four methods that give definitions for these screens. <br><blockquote>  <b>Method Counter: 4</b> </blockquote><br>  We distract for a while from UI and we will pass to structure of a layer of business logic.  We group all logically related functionality into separate entities that are independent of each other, called <b>services</b> .  They perform the following tasks: <br><ul><li>  Managing the list of cities (getting a collection of cities, adding / deleting / changing any of them), </li><li>  Getting weather data (getting weather information for a selected city), </li><li>  Works with geolocation (getting current user geolocation, history of its movements), </li><li>  Handling push notifications (device registration, changing subscription settings), </li><li>  Obtaining data about the application (help, license, versioning). </li></ul><br><blockquote>  <b>Method counter: 4 + 5 = 9</b> </blockquote><br>  By themselves, these services are quite useless, as they only describe certain rules of the application business logic.  Let's see what dependencies they need. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will need several <b>clients</b> (entities responsible for interacting with an external data source).  We will thicken the colors and imagine the situation when you will have to work with several weather providers at once. <br><ul><li>  Interaction with your server, </li><li>  Working with Weather Service API 1, </li><li>  Working with Weather Service API 2, </li><li>  ... </li><li>  Working with Weather Service API n, </li><li>  Work with the database. </li></ul><br><blockquote>  <b>Method counter: 9 + n + 2 = 11 + n</b> </blockquote><br>  In addition to clients, each network service needs a <b>mapper</b> (responsible for converting raw data received from the server to model objects) and a <b>validator</b> (responsible for checking the received data). <br><br><blockquote>  <b>Method Counter: 11 + n + 2 * (n + 1) = 13 + 3n</b> </blockquote><br>  Let's not forget some more wonderful helpers: <br><ul><li>  Logging </li><li>  Work with networkActivityIndicator, </li><li>  Connection status monitoring </li></ul><br><blockquote>  <b>Method Counter: 13 + 3n + 3 = 16 + 3n</b> </blockquote><br>  The number of entities does not end there, since we return to the UI layer.  Depending on the chosen architecture, the number of dependencies for each of the screens can reach several dozen.  We, of course, make a simple application, so we will select only the most necessary objects: <br><ul><li>  Screen status animator, </li><li>  DataSource (not important for a table or any other view), </li><li>  An object that encapsulates logic related to scrolling, </li><li>  Router between the screens, </li><li>  Error handler associated with the current screen. </li></ul><br><blockquote>  <b>Counter methods: 16 + 3n + 4 * 5 = 36 + 3n</b> </blockquote><br>  In this formula, <i><b>n</b></i> is the number of weather services whose data is needed for the application to work correctly.  We want to use <i>Gismeteo</i> , <i>Yandeks.Pogodu</i> and <i>Yahoo.Weather</i> . <br><br><blockquote>  <b>Method counter: 36 + 3 * 3 = 45</b> </blockquote><br>  Forty-five methods that configure various dependencies for a seemingly very simple application.  If we stay within the framework of one <i>TyphoonAssembly</i> , then we will face several rather serious problems: <br><ul><li>  <b>The huge size of the</b> class TyphoonAssembly - it will be very difficult to analyze and maintain in a clean state. </li><li>  <b>Blur of responsibility</b> - the creation of objects of completely different and unrelated layers of abstraction occurs in the same place. </li><li>  <b>Lack of structuredness</b> - if necessary, you cannot provide various implementations of logically related definitions. </li></ul><br>  To avoid such problems, <i>TyphoonAssembly</i> is divided into modules that are interconnected both vertically and horizontally.  As I mentioned <a href="http://habrahabr.ru/company/rambler-co/blog/260355/">in the last part</a> , in fact, when several <i>assemblies are</i> activated under the hood, they create one common <i>TyphoonComponentFactory</i> containing a register of all definitions and pools of created objects.  Such a framework architecture allows us to safely decompose <i>TyphoonAssembly</i> , which is a general proxy for accessing the internal factory. <br><br>  Let's sum up.  The modularity of the <i>TyphoonAssembly</i> level <i>is</i> needed in order to: <br><ul><li>  <b>Group</b> <b>related</b> <b>dependencies</b> , thereby building a clear architecture, </li><li>  <b>Keep the interface of</b> each assembly <b>clean</b> and declare only the methods needed by other components, </li><li>  <b>Provide,</b> if necessary, <b>another implementation of</b> any of the selected components (say, the level of customers), </li><li>  To enable an outsider to <i>get an</i> <b>idea of ‚Äã‚Äãthe architecture of the entire project</b> only on the structure of <i>TyphoonAssembly</i> modules. </li></ul><br><br><h4>  <b>Module breakdown</b> </h4><br>  It is not enough to group logically related elements in separate subclasses of <i>TyphoonAssembly</i> ‚Äî in most cases they should know something about each other.  Let's return to the example of the weather application discussed earlier and see what dependencies are required for a screen with weather information in the selected city: <br><div class="spoiler">  <b class="spoiler_title">@interface RCTWeatherViewController: UIViewController</b> <div class="spoiler_text"><pre><code class="hljs vhdl">@interface RCTWeatherViewController : UIViewController //  @<span class="hljs-keyword"><span class="hljs-keyword">property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">strong</span></span>, nonatomic) id &lt;RCTCityService&gt; cityService; @<span class="hljs-keyword"><span class="hljs-keyword">property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">strong</span></span>, nonatomic) id &lt;RCTWeatherService&gt; weatherService; @<span class="hljs-keyword"><span class="hljs-keyword">property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">strong</span></span>, nonatomic) id &lt;RCTLocationService&gt; locationService; //  @<span class="hljs-keyword"><span class="hljs-keyword">property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">strong</span></span>, nonatomic) id &lt;RCTAnimator&gt; cloudAnimator; @<span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br>  Based on this, we need to build a model of interaction between three different assemblies - creating controllers, services, and animators, respectively.  <i>‚ÄúAha!‚Äù</i> You think.  <i>‚ÄúNow this guy will start injecting one module into another, and generally write a factory of factories!‚Äù</i> You must not be in a hurry!  One of the next wonderful possibilities of Typhoon is that no additional injection is required for the interaction of the modules.  It is enough only to specify other modules in the <i>TyphoonAssembly</i> interface that it needs to work with - and you can safely use their public methods: <br><div class="spoiler">  <b class="spoiler_title">@interface RCTWeatherUserStoryAssembly: TyphoonAssembly</b> <div class="spoiler_text"><pre> <code class="hljs css">@<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> RCTWeatherUserStoryAssembly : TyphoonAssembly @property (strong, nonatomic, readonly) RCTAnimatorAssembly *animatorAssembly; @<span class="hljs-keyword"><span class="hljs-keyword">property</span></span> (strong, nonatomic, readonly) TyphoonAssembly&lt;RCTServiceAssembly&gt;* serviceAssembly; <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">UIViewController</span></span> *)<span class="hljs-selector-tag"><span class="hljs-selector-tag">weatherViewController</span></span>; @<span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br>  And this is what the method for TyphoonDefinition will look like: <br><div class="spoiler">  <b class="spoiler_title">- (UIViewController *) weatherViewController</b> <div class="spoiler_text"><pre> <code class="hljs kotlin">- (UIViewController *)weatherViewController { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [TyphoonDefinition withClass:[RCTWeatherViewController <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">configuration</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">^</span></span></span></span>(TyphoonDefinition *definition) { [definition injectProperty:<span class="hljs-meta"><span class="hljs-meta">@selector(cityService)</span></span> with:[self.serviceAssembly cityService]]; [definition injectProperty:<span class="hljs-meta"><span class="hljs-meta">@selector(weatherService)</span></span> with:[self.serviceAssembly weatherService]]; [definition injectProperty:<span class="hljs-meta"><span class="hljs-meta">@selector(locationService)</span></span> with:[self.serviceAssembly locationService]]; [definition injectProperty:<span class="hljs-meta"><span class="hljs-meta">@selector(cloudAnimator)</span></span> with:[self.animatorAssembly cloudAnimator]]; }]; }</code> </pre> </div></div><br>  I will make a small digression.  It is possible, instead of directly specifying the assembly and its method, to use syntax of the following form: <br><pre> <code class="hljs kotlin">[definition injectProperty:<span class="hljs-meta"><span class="hljs-meta">@selector(cityService)</span></span>];</code> </pre> <br>  In this case, Typhoon takes the property type (class or protocol) and looks for a suitable definition for all the assembly in the project.  However, I do not recommend using such an approach - it will be much more obvious both for other project participants and for you in the future, to directly indicate the origin of the dependency.  In addition, it will avoid the emergence of implicit links between assemblies of different layers of abstraction. <br><br>  As I already mentioned, modules can be interconnected both horizontally (for example, assembly for different user stories), and vertically ( <i>RCTWeatherUserStoryAssembly</i> and <i>RCTServiceAssembly</i> from the example above).  In order to build a competent <i>TyphoonAssembly</i> architecture, you must strictly adhere to the following rules: <br><ul><li>  <b>Modules at one level of abstraction know nothing about each other</b> , </li><li>  <b>The modules of the lower level do not know anything about the modules of the upper level</b> . </li></ul><br><br>  The most basic example of splitting TyphoonAssembly modules into layers: <br><img src="https://habrastorage.org/files/f8f/cb0/ccb/f8fcb0ccb77c47b39ec54ac20b694efa.png"><br><br>  Each of the layers inside can consist of any number of assembly.  For example, it makes sense to break dependencies from <i>Presentation Level</i> into several user stories. <br><br>  Consider a more difficult case of <i>typing TyphoonAssembly</i> into modules using the example, as usual, <b>Rambler</b> . <b>Mail</b> . <br><br><h4>  <b>Assembly structure in Rambler. Mail</b> </h4><br>  In general, all modules are divided into three standard layers - Presentation, Business Logic and Core. <br><img src="https://habrastorage.org/files/fb7/792/f0f/fb7792f0f1cf4bafbe085a4d4c1c19c1.png"><br><br>  Let's run through all the Assembly: <br><ul><li>  <b>RCMApplicationAssembly</b> .  Responsible for creating application-level objects ‚Äî <i>AppDelegate</i> , <i>PushNotificationCenter</i> , <i>ApplicationConfigurator,</i> and others.  It depends on two other modules - <i>helperAssembly</i> and <i>serviceComponents</i> . </li><li>  <b>RCMUserStoryAssembly</b> .  Each storyboard in Rambler. Mail has its own Assembly, inherited from <i>RCMUserStoryAssemblyBase</i> .  These modules contain definitions for ViewControllers, routers, animators, view-models and other dependencies that are unique to this user story.  It depends on <i>helperAssembly</i> , <i>parentAssembly,</i> and <i>serviceComponents</i> . </li><li>  <b>RCMSettingsUserStoryAssemblyBase / RCMSettingsUserStoryAssemblyDebug</b> .  Depending on the selected build scheme ( <i>Release / Debug</i> ), different implementations of dependencies of the settings screen provide (more on this I will tell later).  This approach makes it easy to add special features for testers to application settings, which will not be in the assembly for the App Store. </li><li>  <b>RCMParentAssembly</b> .  Contains basic definitions for controllers, routers and error handlers.  No real instance is able to generate (all marked as <i>abstract</i> ).  Does not depend on anyone. </li><li>  <b>RCMHelperAssembly</b> .  Contains definitions for various Presentation layer helpers required for components of several <i>UserStoryAssembly</i> .  Does not depend on anyone. </li><li>  <b>RCMServiceComponentsAssemblyBase</b> .  Contains definitions of all application services.  It depends on two kernel-level modules - <i>clientAssembly</i> and <i>coreComponentsAssembly</i> . </li><li>  <b>RCMServiceComponentsAssemblyDouble</b> .  Unlike the base assembly, it returns the fake implementations of all services for which no interaction with the Internet is required.  Does not depend on anyone. </li><li>  <b>RCMClientAssembly</b> .  Responsible for creating different customers.  Does not depend on anyone. </li><li>  <b>RCMCoreComponentsAssembly</b> .  Responsible for the creation of auxiliary components necessary for the operation of services.  Does not depend on anyone. </li></ul><br>  In fact, no one bothers to additionally split <i>RCMServiceComponents</i> and <i>RCMCoreComponents</i> into several modules that are independent of each other - but this should be done as their code base increases. <br><br>  Of course, all these modules need to be activated at the same time - it‚Äôs best to do this by adding the appropriate keys to <i>Info.plist</i> , but you can also manually, by implementing a special method in <i>AppDelegate</i> (details <a href="http://habrahabr.ru/company/rambler-co/blog/260355/">in the second part of the cycle</a> ). <br><br><h4>  <b>Assembly implementation substitution</b> </h4><br>  Consider two typical situations: <br><ul><li>  We are going to start working on the application, but the server team has not yet managed to roll out the API. </li><li>  Several developers are put on the development of a fairly large project - some of them plan to deal with the UI, and the other - with business logic, moreover, apart from each other. </li></ul><br>  Both scenarios connect the same thing - the need to start work on the top level of the application (in particular, on the UI) in the absence of the implementation of business logic.  On the Assembly diagram in Rambler. Mail, the solution to this problem can be seen at the level of the business logic layer. <br><br>  The protocol defining what methods the current module should implement is written, and its two implementations - the base one, which will be populated when the API and the service layer are ready, and the fake one containing the most basic implementations of services that work, for example, with in-memory database. <br><br>  Let's see how to implement this using the preprocessing mechanism of the <i>Info.plist</i> file: <br><ol><li>  Create two files - <i>BaseHeader.h</i> and <i>DoubleHeader.h</i> : <br>  <i>BaseHeader</i> : <pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SERVICE_COMPONENTS_ASSEMBLY RCMServiceComponentsAssemblyBase</span></span></code> </pre> <br>  <i>DoubleHeader</i> : <pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SERVICE_COMPONENTS_ASSEMBLY RCMServiceComponentsAssemblyDouble</span></span></code> </pre> </li><li>  In the <i>Info.plist</i> file, in the <i>TyphoonInitialAssemblies</i> section <i>,</i> instead of the specific <i>RCMServiceComponentsAssemblyBase</i> class <i>,</i> specify the directive just specified - <i>SERVICE_COMPONENTS_ASSEMBLY</i> . </li><li>  In the Build Settings project, in the <i>Packaging</i> section, we look for the <i>Info.plist Preprocessor Prefix File</i> key, and for each of the build schemes we use, we set the corresponding header file.  For example, <i>Release</i> - <i>BaseHeader.h</i> , <i>Debug</i> - <i>DoubleHeader.h</i> . </li></ol><br><br>  Now, depending on which build scheme is chosen to run the application, the corresponding Assembly will be connected, and either the combat services or their fake implementations will be used. <br><br>  In some cases, it is not necessary to replace all objects with fake implementations, but only one dependency needs to be replaced.  In this case, the use of the <i><a href="">TyphoonDefinition + Option</a></i> category, which I will discuss in more detail in the next article, will help. <br><br><h4>  <b>Testing TyphoonAssembly Modules</b> </h4><br>  Like any other component of the application, all TyphoonAssembly <i>subclasses</i> should be tested.  Only with the full coverage of the Assembly tests, they can be used in integration testing. <br><br>  First of all, you need to decide what you need to test: <br><ul><li>  The method activated by <i>TyphoonAssembly</i> creates an object of the desired class, </li><li>  The created object contains all the necessary dependencies. </li><li>  All dependencies of the created object implement the required protocol / class. </li></ul><br>  To reduce the amount of boilerplate-code, I prepared a <a href="https://gist.github.com/igrekde/529a5519efd1a0860835">basic <i>XCTestCase</i></a> , which simplifies the testing of <i>TyphoonAssembly</i> : <br><div class="spoiler">  <b class="spoiler_title">@interface RCMAssemblyTestsBase: XCTestCase</b> <div class="spoiler_text"><pre> <code class="hljs ruby">@interface RCMAssemblyTestsBase : XCTestCase /** * @author Egor Tolstoy * *     Assembly ,       * * : * - (id &lt;RCMStoryboardBuilder&gt;)storyboardBuilder { * <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [TyphoonDefinition <span class="hljs-symbol"><span class="hljs-symbol">withClass:</span></span>[RCMStoryboardBuilderBase <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">]];</span></span> * } * * @param targetDependency   * @param targetClass ,        *<span class="hljs-regexp"><span class="hljs-regexp">/ - (void)testTargetDependency:(id)targetDependency withClass:(Class)targetClass; /</span></span>** * @author Egor Tolstoy * *     Assembly ,     * * : * <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [TyphoonDefinition <span class="hljs-symbol"><span class="hljs-symbol">withClass:</span></span>[RCMContactsMapperBase <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">] * </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">configuration</span></span></span><span class="hljs-class">:^(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TyphoonDefinition</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">definition</span></span></span><span class="hljs-class">) { * [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">definition</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">injectProperty</span></span></span><span class="hljs-class">:@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">selector</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">emailValidator</span></span></span><span class="hljs-class">) * </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">:[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapperEmailValidator</span></span></span><span class="hljs-class">]];</span></span> * }]; * * @param targetDependency   * @param targetClass ,        * @param dependencies     property *<span class="hljs-regexp"><span class="hljs-regexp">/ - (void)testTargetDependency:(id)targetDependency withClass:(Class)targetClass dependencies:(NSArray *)dependencies; /</span></span>** * @author Egor Tolstoy * *     Assembly , ,     ,   / * * @param targetDependency   * @param targetClass ,        * @param dependenciesAndTypes ,    -    property,  - Class/Protocol.      /   ,   [NSNull <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">]. */ - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">testTargetDependency</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">targetDependency</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">withClass</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Class</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">targetClass</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dependenciesAndTypes</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDictionary</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dependenciesAndTypes</span></span></span><span class="hljs-class">;</span></span> @end</code> </pre> </div></div><br>  Here is the test of one of the Assembly methods: <br><div class="spoiler">  <b class="spoiler_title">- (void) testThatAssemblyCreatesApplicationBadgeHandler</b> <div class="spoiler_text"><pre> <code class="hljs ruby">- (void)setUp { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> setUp]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.applicationAssembly = [[RCMApplicationAssembly alloc] init]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.applicationAssembly <span class="hljs-symbol"><span class="hljs-symbol">activateWithCollaboratingAssemblies:</span></span>@[[RCMHelperAssembly new], [RCMServiceComponentsAssemblyBase new], [RCMCoreComponentsAssembly new], [RCMClientAssembly new]]]; } - (void)testThatAssemblyCreatesApplicationBadgeHandler { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> given Class targetClass = [RCMApplicationBadgeHandlerBase <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">];</span></span> NSDictionary *dependenciesAndTypes = @{ NSStringFromSelector(@selector(folderService)) : @protocol(RCMFolderService) }; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> id result = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.applicationAssembly applicationBadgeHandler]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">testTargetDependency:</span></span>result <span class="hljs-symbol"><span class="hljs-symbol">withClass:</span></span>targetClass <span class="hljs-symbol"><span class="hljs-symbol">dependenciesAndTypes:</span></span>dependenciesAndTypes]; }</code> </pre> </div></div><br>  In the case of Assembly, it is necessary to test not only public methods, but also private ones, since we have to check how well all dependencies are created in the application.  Be prepared to create an extension <i>_Testable</i> for each of the selected modules. <br><br>  I have to admit that even in this form, covering all methods of Assembly with tests is quite a laborious and tedious business, so you should not postpone it for the last stage of development.  It is enough just to develop the habit of adding a new testcase when another definition <i>appears</i> in <i>TyphoonAssembly</i> . <br><br><h4>  <b>Conclusion</b> </h4><br>  In this article, we learned why it is necessary to split one large Assembly into several smaller modules, and how to do it correctly.  The given scheme of breaking all modules into layers - <i>Presentation</i> , <i>Business Logic</i> and <i>Core</i> , in one form or another can be used in almost any project.  In addition, with proper construction of the structure of the modules, it becomes possible to replace any of them with a fake implementation, which can be used as a stub in the process of working on the basic version. <br><br>  <i>TyphoonAssembly</i> is one of the most important components of a project, on which all the coherence of components with each other rests - therefore, it must be thoroughly tested.  This long and boring process will pay off many times over during the work on the project. <br><br>  After reading this part of the cycle, you are fully ready to integrate Typhoon Framework into your project, regardless of the percentage of completion.  In the next article, we will look at various Tips n 'Tricks in using Typhoon: Autowire, TyphoonConfig, TyphoonPatcher, features for working with several UIStoryboard and more. <br><br><h4>  <b>Cycle "Manage dependencies in iOS applications correctly"</b> </h4><br><ul><li>  <a href="http://habrahabr.ru/company/rambler-co/blog/258325/">Meet Typhoon</a> </li><li>  <a href="http://habrahabr.ru/company/rambler-co/blog/260355/">Typhoon device</a> </li><li>  <a href="http://habrahabr.ru/company/rambler-co/blog/261537/">Modularity Typhoon</a> </li><li>  <a href="http://habrahabr.ru/company/rambler-co/blog/264683/">Typhoon Tips &amp; Tricks</a> </li><li>  Alternatives to Typhoon </li><li>  <i><a href="http://www.slideshare.net/Rambler-iOS/dependency-injection-ios">(Optional) Rambler.iOS # 3.</a></i>  <i><a href="http://www.slideshare.net/Rambler-iOS/dependency-injection-ios">Dependency Injection in iOS.</a></i>  <i><a href="http://www.slideshare.net/Rambler-iOS/dependency-injection-ios">Slides</a></i> </li><li>  <i><a href="https://www.youtube.com/watch%3Fv%3DLO59z3fjc9k">(Optional) Rambler.iOS # 3.</a></i>  <i><a href="https://www.youtube.com/watch%3Fv%3DLO59z3fjc9k">Dependency Injection in iOS.</a></i>  <i><a href="https://www.youtube.com/watch%3Fv%3DLO59z3fjc9k">Video</a></i> </li></ul><br><h4>  <b>useful links</b> </h4><br><ul><li>  <a href="http://www.typhoonframework.org/">Typhoon Framework official website</a> </li><li>  <a href="https://github.com/appsquickly/Typhoon/wiki">Typhoon Framework Wiki</a> </li><li>  <a href="https://github.com/appsquickly/Typhoon-example">Typhoon Objective-C Sample Application</a> </li><li>  <a href="https://gist.github.com/igrekde/529a5519efd1a0860835">Base class for testing TyphoonAssembly</a> </li><li>  <a href="http://ilya.puchka.me/info-plist-preprocessing/">Info.plist preprocessing</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/261537/">https://habr.com/ru/post/261537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261527/index.html">Mobile app design: why we work in @ 1x</a></li>
<li><a href="../261529/index.html">How to replace a homogeneous background with a transparent imagemagick</a></li>
<li><a href="../261531/index.html">Push notifications via Telegram</a></li>
<li><a href="../261533/index.html">Implementing the infrastructure of the Internet of things for a smart office - the experience of Microsoft Technology Center</a></li>
<li><a href="../261535/index.html">Automatic reorganization of arrays in the memory of the graphics accelerator</a></li>
<li><a href="../261539/index.html">Alt key for mouse gestures, as well as various important fixes in Vivaldi 1.0.212.3</a></li>
<li><a href="../261541/index.html">Expanding the functionality of the "notebook"</a></li>
<li><a href="../261543/index.html">We continue to expand the functionality of the browser Vivaldi</a></li>
<li><a href="../261547/index.html">Announcement Joker 2015 University Day: Celebration on student street</a></li>
<li><a href="../261549/index.html">Distributed cryptoprocessing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>