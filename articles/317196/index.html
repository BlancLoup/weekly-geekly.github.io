<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Berkeley Unified Parallel C (UPC). Debugging with the GNU gdb C debbuger. Call stack</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good health! 

 Unified Parallel C (UPC) is an extension of the C language designed for high-performance computing on large-scale parallel machines. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Berkeley Unified Parallel C (UPC). Debugging with the GNU gdb C debbuger. Call stack</h1><div class="post__text post__text-html js-mediator-article">  Good health! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/43f/07b/08d/43f07b08df75b165c78a14312650275f.gif" alt="image" align="left">  Unified Parallel C (UPC) is an extension of the C language designed for high-performance computing on large-scale parallel machines.  The language represents a single program model for systems with shared and shared memory.  The number of parallelism is fixed at the start of the program, usually with one thread per processor core. <br><br>  ¬ª <a href="http://upc.gwu.edu/">UPC official website</a> <br>  ¬ª <a href="http://upc.lbl.gov/">Berkeley UPC official website</a> <br><habracut><br>  In the last article, <a href="https://habrahabr.ru/post/315190/">Installing in the Windows and Linux environment,</a> describes how to perform a UPC installation, but the important issue of using debugging was not disclosed.  It often happens that a program crashes if memory is incorrectly allocated somewhere or the array dimension is exceeded. <br><blockquote>  *** Caught a fatal signal: SIGSEGV (11) on node 0/1 <br>  NOTICE: Before reporting bugs, run with GASNET_BACKTRACE = 1 in the environment to generate a backtrace. <br>  Segmentation Error (cast taken) </blockquote><br>  What can be done in this situation to narrow the place of the search?  About this in the current article. <br><a name="habracut"></a><br>  For a long time, I avoided learning to debug, because  already had to do programming.  Instead of debugging, I logged in detail enough about the actions of each stream through printf.  However, the matter is overshadowed by the fact that the UPC program is translated to C and in the general case is not interpretable.  If some line was successfully executed (by logs), and the next log did not happen, then it is not a fact that the error is between logged lines!  Very often, the error of the ‚Äúfuture‚Äù affects the current situation and causes the program to collapse in a completely different place. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If it‚Äôs OK with English, full debugging information can be found on the official <a href="http://upc.lbl.gov/docs/user/upc-debugging.shtml">Debugging Berkeley UPC applications</a> page. <br><br>  If you have a mailbox in the university domain, then you can request a <a href="http://www.roguewave.com/products-services/student-request-form">student license</a> recommended by TotalView, if not, you can use the standard debugger C. <br><br>  It is necessary to pay attention that after transferring to C the main () function will turn into user_main (). <br><br>  The first is to use the special debug mode, you need to run upcc with the <code>-g</code> option.  This means that a special UPC configuration will be launched from the dbg subfolder.  In order to be able to see specific lines of code, you need to save temporary files with sources at compile time with the <code>-save-temps</code> parameter: <br><br><pre> <code class="hljs xml">upcc ./Pack_Polycubes.upc -o Pack_Polycubes -pthreads <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>-save-temps -g<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  There are several entry points to debugging.  You can stop a thread with a specific number using the <code>-freeze[=&lt;thread_id&gt;]</code> parameter, or you can just stop by mistake using <code>-freeze-on-error</code> : <br><br><pre> <code class="hljs pgsql">upcrun -n <span class="hljs-number"><span class="hljs-number">1</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">freeze</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-error ./Pack_Polycubes</code> </pre> <br><blockquote>  - WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING <br><br>  This application was built from a Berkeley UPC installation that <br>  has been configured with these optional features enabled: <br>  debugging tracing statistical collection debugging malloc <br>  This is usually <br>  trust any performance numbers reported in this program run !!! <br><br>  To suppress this message, pass '-quiet' to the upcrun command or set <br>  the UPC_NO_WARN or UPC_QUIET environment variables. <br>  - UPCR: UPC thread 0 of 1 on Rosa-VB (pshm node 0 of 1, process 0 of 1, pid = 31257) <br>  Hello, I am 0 of 1. <br>  ... <br>  *** Caught a fatal signal: SIGSEGV (11) on node 0/1 <br>  Process frozen for debugger: host = Rosa-VB pid = 31257 <br>  To unfreeze, attach a debugger and set 'gasnet_frozen' to 0, or send a SIGCONT </blockquote><br>  Next, you need to run gdb in another console session from the folder with output compilation files and specify the stream PID <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">gdb</span></span> Pack_Polycubes.o <span class="hljs-number"><span class="hljs-number">31257</span></span></code> </pre> <br><blockquote>  GNU gdb (Linaro GDB) 7.7.1_2014.06_1-10 () <br>  Copyright ¬© 2014 Free Software Foundation, Inc. <br>  ... <br>  Loaded symbols for /lib64/ld-linux-x86-64.so.2 <br>  0x00007f0afab16cd0 in __nanosleep_nocancel () from /lib64/libc.so.6 </blockquote><br>  To continue the execution of the program, you must run the following code: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">gdb</span></span>) set gasnet_frozen = <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">gdb</span></span>) continue</code> </pre> <br>  The program helpfully reports a line with an error: <br><br><blockquote>  Program received signal SIGSEGV, Segmentation fault. <br>  0x00000000004289f8 in MultiplyMatrixPackSpace (Result = 0x26274ac, Matrix = 0x2696340, CurPackSpace = 0x7ffd81634020) <br>  at ./Pack_Polycubes.upc:1065 <br>  1065 Result [row] [col] = 0; </blockquote><br>  To view the current breakpoint in more detail, you can use the command: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">gdb</span></span>) list</code> </pre> <br><blockquote>  1060 // Row-to-Column Multiplication <br>  1061 for (row = 0; row &lt;Params.Demension; row ++) <br>  1062 { <br>  1063 for (col = 0; col &lt;Params.Demension; col ++) <br>  1064 { <br>  1065 Result [row] [col] = 0; <br></blockquote><br>  Who would have thought.  I'm going to deal with indexes and allocated memory)) To find out the call stack, you can use the bt command <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">gdb</span></span>) bt</code> </pre> <br><blockquote>  # 0 0x00000000004289f8 in MultiplyMatrixPackSpace (Result = 0x26274ac, Matrix = 0x2696340, CurPackSpace = 0x7ffd81634020) <br>  # 1 0x0000000000428680 in CheckIndependancePS (CurPackSpace = 0x7ffd81634020) at ./Pack_Polycubes.upc:1032 <br>  # 2 0x0000000000428430 in AddIndependentPackSpace (CurPackSpace = 0x7ffd81634020) at ./Pack_Polycubes.upc:1011 <br>  ... <br>  # 8 0x000000000042e21 in ExplorePackSpaces () at ./Pack_Polycubes.upc:922 <br>  # 9 0x00000000004244c5 in user_main (argc = 4, argv = 0x7ffd816344e8) at ./Pack_Polycubes.up around14 ... </blockquote><br>  The call stack needs to be viewed from the bottom.  The user program starts with user_main, then the calls go successively and you can see where and with what parameters the error occurs. <br><br>  To exit debugging correctly, you need to continue further, after which you can make a <code>quit</code> . <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">gdb</span></span>) continue</code> </pre> <br><blockquote>  Continuing. <br>  Program terminated with signal SIGSEGV, Segmentation fault. <br>  The program no longer exists. </blockquote><br>  If for some reason the debugging processes are stuck, they can be killed with the help of the <code>kill</code> command from another console window, but in Rosa it is simpler with the help of Ctrl ^ C. <br><br>  The most popular gdb commands are: <br><br><blockquote>  <code>break [file:]functiop</code> - set a <code>break [file:]functiop</code> on the function <br>  <code>bt</code> call stack <br>  <code>print expr</code> - display the value of the expression <br>  <code></code> - continue program execution <br>  <code>next</code> - execute the next line of the program (jump over) <br>  <code>step</code> - step inside the program line <br>  <code>list</code> - view the current break line <br>  <code>help</code> - call help <br>  <code>quit</code> - exit </blockquote><br>  And as usual, <code>man gdb</code> <br><br>  Thank you for attention!  I hope someone will come in handy </habracut></div><p>Source: <a href="https://habr.com/ru/post/317196/">https://habr.com/ru/post/317196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317182/index.html">Remote logging in journald or Still ‚Äúyou don't need this‚Äù?</a></li>
<li><a href="../317184/index.html">Why to achieve the goal is enough notebook</a></li>
<li><a href="../317188/index.html">Experience in building Infrastructure-as-Code in VMware. Part 1: Problem Identification</a></li>
<li><a href="../317192/index.html">Software patents must survive: American practice</a></li>
<li><a href="../317194/index.html">Implementation of PCI Express v3.0 x16 on FPGA Virtex 7</a></li>
<li><a href="../317198/index.html">How to implement EDS and not screw it up</a></li>
<li><a href="../317200/index.html">How to make friends development stages with gitflow</a></li>
<li><a href="../317202/index.html">New models of radio bridges Siklu EtherHaul 2500 - transfer more, transfer further</a></li>
<li><a href="../317204/index.html">Friday format: What happens when Moore's law stops acting</a></li>
<li><a href="../317206/index.html">The spirit of change: Intel, Dell and HP in search of a warm future</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>