<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ticket Trick: Hacking hundreds of companies through customer support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few months ago, a vulnerability was discovered with which hackers could break into corporate messaging. Taking advantage of this vulnerability is no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ticket Trick: Hacking hundreds of companies through customer support</h1><div class="post__text post__text-html js-mediator-article">  A few months ago, a vulnerability was discovered with which hackers could break into corporate messaging.  Taking advantage of this vulnerability is no more difficult than clicking a mouse a couple of times; if it is used successfully, you can access the company's internal network, the accounts of its employees on social networks such as Twitter, and usually the teams in Yammer and Slack. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cb/9b/59cb9b3e11b2e291807388.png"></div><br>  <i><font color="#999999">I came up with a name and logo for my find.</font></i>  <i><font color="#999999">Take for granted.</font></i> <br><br>  The problem in question still exists.  This is not the case when everything can be instantly put in order.  Over the past few months, I have contacted dozens of companies and service providers affected by the vulnerability, as part of their bug-trapping programs, to remedy the situation.  Due to the huge number of organizations to which it applies, I am not able to contact everyone.  Following the recommendations of some people I respected and with the permission of the organizations affected by the problem, I publish this material so that everyone concerned can take action immediately.  Now I will talk about what I called Ticket Trick. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Door: register using corporate mailbox</font> </h2><br>  Popular platforms for organizing business communications, such as Slack, Yammer and Facebook Workplace, require that employees of companies are registered using corporate mailboxes.  As soon as the employee clicks the link to confirm the address sent to his work mail, he will be able to join the company group in the service and get access to internal means of communication with other members of the group. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af5/4de/fd9/af54defd9d00d7c0dd0cad1a25380862.png"></div><br>  <i><font color="#999999">Slack: users whose mailbox is open on the same corporate domain can, by default, join the team.</font></i>  <i><font color="#999999">This can be replaced with SSO or set to the connection mode by invitation only.</font></i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a5/55f/d78/5a555fd78c2fb1e696486b88680c9333.png"></div><br>  <i><font color="#999999">Yammer: anyone with a corporate inbox can join the company team</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/453/592/d03/453592d03a45e263fd2da360760ebc39.png"></div><br>  <i><font color="#999999">Facebook Workplace: one who has a corporate inbox can join the team</font></i> <br><br><h2>  <font color="#3AC1EF">Door Keys: support service or email creation feature</font> </h2><br><h3>  <font color="#3AC1EF">‚ñçMethod # 1: error tracking system</font> </h3><br>  I started research with GitLab.  Anyone with a valid @ gitlab.com mailbox can join their Slack team. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9da/86c/511/9da86c5114acb70ba6421a64278e31d5.png"></div><br>  <i><font color="#999999">Connect to the GitLab Slack Team</font></i> <br><br>  At the same time, GitLab offers the ability to create error messages by sending them ... to a unique address created on @ gitlab.com.  See what's going on? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/922/949/6df/9229496df283d37001b615ed168497bf.png"></div><br>  <i><font color="#999999">GitLab is one of many bug tracking systems that provides the ability to generate error messages using email.</font></i> <br><br>  For the sake of interest, I tried to join their Slack team using the email address I was given to create error messages. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/604/c5b/dc0/604c5bdc05eafbd2697c428a80372097.png"></div><br>  <i><font color="#999999">Register at gitlab.slack.com</font></i> <br><br>  Immediately after registration, I updated my call list, and saw that a new address confirmation letter was added to my project as a new error message. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ceb/f03/ac1/cebf03ac12f3e4fde4a618c37c312a2b.png"></div><br>  <i><font color="#999999">Address Confirmation Letter</font></i> <br><br>  The error message I just added contained a ‚Äúmagic link‚Äù needed to connect to the GitLab command on Slack: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9cd/89b/cc2/9cd89bcc2d99a731b777082993d95a83.png"></div><br>  <i><font color="#999999">A letter with a link to confirm the address</font></i> <br><br>  I clicked the link to see if it worked.  She worked.  I was offered a list of channels I can join.  I immediately deleted my account and reported a problem to GitLab. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eda/ed6/eef/edaed6eef8685763dc9889103506fe7f.jpg"></div><br>  <i><font color="#999999">Edited screenshot with the list of channels</font></i> <br><br>  The GitLab team responded to my message on the same Sunday evening when I sent it to them. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6b/8a3/9fb/f6b8a39fb7d8da63bbe27188851151a6.png"></div><br>  <i><font color="#999999">Reaction to a vulnerability report</font></i> <br><br>  They immediately changed the connection mode to their team on Slack, making it possible to connect by invitation only.  In addition, they have taken additional measures in order to inform their clients about the dangers of this functionality. <br><br><h3>  <font color="#3AC1EF">‚ñçMethod ‚Ññ2: support service</font> </h3><br>  Not many websites have a publicly available bug tracker, so I decided to dig deeper to find out if there is a more common attack vector.  As it turned out, it exists, and it occurs much more often than I could have expected: this is customer service. <br><br>  Emails sent to support@company.com are sometimes found on online support portals, such as Zendesk, Kayako, (Fresh) Desk, WHMCS, or similar systems of their own design.  As a result, I decided to experiment with this and find out if a cracker could somehow get the necessary email confirmation link from the customer support system. <br><br>  Most support portals can be integrated with single sign-on technology: an authenticated user will automatically enter support services.  This increases the usability.  More than half of the sites I checked did not require verification of the email address.  This means that anyone can register with any email address and read any support requests created using this address.  Vimeo online video platform was one of many companies that did not require verification. <br><br>  As a result, I registered an account on Vimeo using the same email address that Slack uses to send email confirmation links to feedback@slack.com. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a3/92f/211/3a392f211e68f63f9c1cfafadea846a9.png"></div><br>  <i><font color="#999999">Register with Vimeo using feedback@slack.com</font></i> <br><br>  Using the convenient Slack <a href="https://slack.com/signin/find">Find Your Workspace</a> feature, I found the Vimeo command on Slack and registered with support@vimeo.com. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/078/c6e/23c/078c6e23c38ee4d1604b50aebcbc5b03.png"></div><br>  <i><font color="#999999">Register at vimeo.slack.com using support@vimeo.com</font></i> <br><br>  In the meantime, an email was sent to feedback@slack.com at support@vimeo.com, containing a link to confirm the address. <br><br>  When support@vimeo.com receives a letter, it is classified as a ticket for technical support, created from the address feedback@slack.com ... and this is the address with which I registered. <br><br>  Then I looked into Vimeo support to check my tickets. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/716/95f/197/71695f197fb040acde265158e92618c9.png"></div><br>  <i><font color="#999999">Vimeo support service</font></i> <br><br>  It turned out one appeal, which contained the very link to confirm the address, which I needed to join the Vimeo team. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c26/2ca/f52/c262caf52906f21539ee06995c4aa196.jpg"></div><br>  <i><font color="#999999">Address verification link</font></i> <br><br>  The Vimeo team immediately responded to my bug report, they gave me $ 2000 as part of their bug search program (# <a href="https://hackerone.com/reports/220102">220102</a> , awaiting disclosure). <br><br>  This vulnerability applies to all websites in which the support portal is integrated, which does not include email confirmation.  However, it turned out to be even worse. <br><br>  I discovered two more holes in Kayako and Zendesk, which allowed me to bypass the email address verification process with their normal settings.  This allowed me to successfully carry out the attack, even in cases where the SSO service was disabled and email confirmation was required.  I reported these issues on the first of June, as part of a responsible vulnerability disclosure program.  Both projects have fixed everything. <br><br>  Further, websites that require confirmation of the address after registration, but not after its subsequent change, are also vulnerable. <br><br><h2>  <font color="#3AC1EF">Scaling up problems</font> </h2><br>  If the company does not use Slack and they believe that they are safe ... probably not so good, considering how widespread the vulnerability I discovered was.  For example, other business communication tools, such as Yammer, are also subject to this attack. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b67/d74/e65/b67d74e6546bcd4f0246b1111d1e8e81.jpg"></div><br>  <i><font color="#999999">I managed to connect to a Yammer internal network owned by a company whose name I don‚Äôt disclose</font></i> <br><br>  And since we can read letters sent to support @ addresses, we can also see the password reset links sent to these addresses.  As it turned out, quite a few companies use this particular address to register with third-party services and social networks like Twitter. <br><br>  This means that the attacker, in addition, can seize any account associated with the address type support @. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0f/fd8/5a4/f0ffd85a4b195ed9d8e84facb2d14031.jpg"></div><br>  <i><font color="#999999">Reset password on Twitter</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72d/497/780/72d4977803c994a0b94061d71313df75.jpg"></div><br>  <i><font color="#999999">I managed to capture several Twitter accounts with over a million followers.</font></i> <br><br>  In some cases, privileged accounts on company websites were also associated with these email addresses.  By registering with the address no-reply@company.com, it was possible to intercept the password reset token for support@company.com and gain access to privileged accounts that gave access to all customer information. <br><br>  If none of the above methods worked, the attacker still had the opportunity to read and respond to existing and future support tickets created using mail.  A friend of mine once sent a letter to the company's support desk, as something was wrong.  Dealing with this problem, I found out that a certain company was vulnerable, so I registered in the system using its address, went to the ‚Äúmy support cases‚Äù section and saw how the letter appeared there.  I was able to read the letters that were sent to the support service from those users who did not have an account in this service, could answer them.  As a result of this attack, users who think that they are communicating with the support service, in fact, correspond with the hacker. <br><br><h2>  <font color="#3AC1EF">Answers of companies and service owners</font> </h2><br>  I was curious to find out exactly how each company would eliminate the vulnerability I discovered.  That's what happened in the end. <br><br>  The companies that were most affected by this responded to my appeals very professionally.  Some even decided to give a <a href="https://twitter.com/securinti/status/868455423300554753">reward</a> for the discovered vulnerability in the amount of $ 8,000.  Sometimes I received negative answers, and some simply ignored me. <br><br>  The administration of the GitLab error tracking system (# <a href="https://hackerone.com/reports/218230">218230</a> , disclosed) quickly took action, namely, now the addresses opened on the company's domain are not trusted, in addition, some Slack settings have been changed.  Further, they made changes to the <a href="https://docs.gitlab.com/ee/administration/reply_by_email.html">documentation</a> so that their users did not make the same mistakes. <br><br>  I reported a problem in Slack (# <a href="https://hackerone.com/reports/239623">239623</a> , awaiting disclosure) in order to find out if we can prevent this at a higher level.  Despite the fact that they are not directly responsible for this vulnerability, it affects a considerable number of their clients. <br><br>  Slack took the problem seriously and changed its no-reply address to include a random token.  This allows you to reliably prevent such attacks on software support services.  The problem, however, is still relevant for bug tracking services and other systems integrated with e-mail.  Despite the fact that this is not a vulnerability of the Slack service itself, I received a generous reward of $ 1,500 from the company. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/840/12f/da8/84012fda8dcd39fd3025f3e28da76056.png"></div><br>  <i><font color="#999999">Slack added randomized tokens to its no-reply address in order to prevent attacks on support services.</font></i> <br><br>  In addition, I tried to contact Yammer to report this issue.  At first I did not receive a reply.  Two weeks later, I sent the following email to which I responded, saying that I had been sent to the Yammer team along with a description of the vulnerability.  So far, they have not taken any proactive measures in order to solve the problem at a higher level, as they did in Slack. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b34/4ff/77d/b344ff77da5889e5aea29cbd0fd808ef.png"></div><br>  <i><font color="#999999">Attackers can still join Yammer workspaces using the vulnerability I discovered</font></i> <br><br>  I contacted <a href="https://firebounty.com/bug-bounty-program/169/kayako">Kayako</a> and <a href="http://hackerone.com/zendesk">Zendesk</a> as part of their vulnerability scan program (# <a href="https://hackerone.com/reports/235139">235139</a> , revealed), reporting the possibility of bypassing SSO.  Companies have solved this problem and gave me, respectively, $ 1000 and $ 750. <br><br><h2>  <font color="#3AC1EF">FAQ</font> </h2><br>  <b>How to know that this may affect our company?</b> <br><br>  This vulnerability is relevant if support ticket tickets can be created using email messages, and if tickets are available to users with unconfirmed email addresses.  In addition, it exists in publicly available bug trackers, or if the system, responding to user messages, provides them with unique addresses in the company's domain to send messages that then get tickets, posts in forums, private correspondence or into the user account. <br><br>  <b>If a company is exposed to this vulnerability, how to cope with it?</b> <br><br>  I have seen several approaches to solving this problem.  Companies like AirBnb, LinkedIn and GitHub provide addresses on another domain, like <a href="https://habrahabr.ru/users/reply/" class="user_link">reply</a> .linkedin.com or <a href="https://habrahabr.ru/users/mail/" class="user_link">mail</a> .github.com.  These addresses cannot be used to register with services like Yammer or Slack.  GitLab has updated the <a href="https://docs.gitlab.com/ee/administration/reply_by_email.html">documentation</a> to include this tip to prevent such attacks in error tracking services. <br><br>  Some decided to disable e-mail functionality, support portal, or single sign-on.  Others have implemented a suitable email address verification system.  In addition, it is not recommended to register with services like Twitter, Slack or Zendesk using support @ corporate addresses. <br><br>  <b>If our public service or business communications system is exposed to this vulnerability, how to deal with it?</b> <br><br>  You can implement additional security measures for those who register with your system using customer support mailboxes, but this is usually impractical and inefficient.  For example, a more successful approach is implemented in Facebook Workplace, since they send emails from randomly generated addresses like <a href="">notification+ajivdw9kpwld@fbworkmail.com</a> .  The attacker cannot guess what this address will be like.  In response to my appeal, Slack also decided to implement this functionality. <br><br>  <b>Why do you disclose this information, because hundreds of companies are still vulnerable?</b> <br>  A large number of vulnerable companies make it impossible to inform them all.  There is a risk of being sued by companies that have not sought safety advice.  I only contacted a small number of vulnerable companies and service providers that implement publicly available vulnerability disclosure programs.  The discovery of this information was now a difficult decision, it can lead to hacking, but <a href="https://blogs.microsoft.com/on-the-issues/2017/05/14/need-urgent-collective-action-keep-people-safe-online-lessons-last-weeks-cyberattack/">history teaches us</a> that hiding information about errors is even worse. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br><ul><li>  Internal security systems of companies are usually much more vulnerable than external ones.  Studies of such systems show that employees post passwords, confidential company information and customer data in messaging channels that anyone who has joined the company‚Äôs team in such a system has access to. <br></li><li>  You can not stop in the search for vulnerabilities.  Their appearance can be expected anywhere.  The problem described here existed for many years on hundreds of sites that were checked by security professionals, but as far as I know, no one noticed this problem. <br></li><li>  Large companies have no idea what exactly their employees do.  I discussed the vulnerability with CISO of a huge payment processing company.  He assured me that this was not a problem for them, as their employees should not use Slack.  They have their own internal system for such cases.  I proved to him that he was wrong by connecting to 8 Slack channels that were open, at his own peril and risk, by the employees themselves.  These channels were used by 322 people around the world.  In the end, I got a reward of $ 5000. <br></li><li>  If you want to know which Slack teams you can join using your corporate email address, use the <a href="https://slack.com/signin/find">Find Your Team</a> feature. <br></li></ul><br>  Dear readers!  Is your company vulnerable to Ticket Trick? </div><p>Source: <a href="https://habr.com/ru/post/338822/">https://habr.com/ru/post/338822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338812/index.html">How can a never called function be called?</a></li>
<li><a href="../338814/index.html">We translate interfaces into fifty languages. Sketch</a></li>
<li><a href="../338816/index.html">MBLTdev 2017: Hardcore Android Development Reports</a></li>
<li><a href="../338818/index.html">Why headlines are needed</a></li>
<li><a href="../338820/index.html">12 personal productivity tools to help you keep track of your deadline.</a></li>
<li><a href="../338824/index.html">Who needs flakes</a></li>
<li><a href="../338828/index.html">Sending a request to all databases of all specified servers using the example of MS SQL Server and C # .NET</a></li>
<li><a href="../338830/index.html">Data geometry 6. Star graph</a></li>
<li><a href="../338832/index.html">Numbers - Douglas Crockford‚Äôs paper on number systems in life and in programming</a></li>
<li><a href="../338836/index.html">Design patterns in test automation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>