<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raspberry and Telegram: prerequisites for creating a smart home</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One Italian shop groped for new ways to use the Telegram (and earlier WhatsApps) by installing it on the Raspberry Pi single-board miniature computer....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raspberry and Telegram: prerequisites for creating a smart home</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/225/0f8/da5/2250f8da5ea2443db721e03f5f5e70ce.jpg"><br><br>  One Italian shop groped for new ways to use the Telegram (and earlier WhatsApps) by installing it on the Raspberry Pi single-board miniature computer.  As it turns out, the messenger can be used for remote communication with its own technology.  Below is a translation of articles ( <a href="http://www.instructables.com/id/Telegram-on-Raspberry-Pi/">1</a> , <a href="http://www.instructables.com/id/Raspberry-remote-control-with-Telegram">2</a> ) from the Instructables.com site.  If there are clarifications on the translation, write about it in the comments. <br><br><a name="habracut"></a>  <u><b>I. Telegram on Raspberry Pi</b></u> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Step One: Installation</b> <br><br>  <u>You will need:</u> Raspberry Pi B or B +, with the latest version of Raspbian, or an 8GB Class 10 MIcroSD card with the same pre-installed Raspbian. <br><br>  First upgrade the software packages: <br><br><pre><code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">apt-get</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">update</span></span></code> </pre> <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">apt-get</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">upgrade</span></span></code> </pre><br>  Install the libraries: readline or libedit, openssl and (if you want to use the configuration) libconfig and liblua.  If it is more convenient for you without them, put down --disable-libconfig and --disable-liblua respectively. <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">apt-get</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libreadline-dev</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libconfig-dev</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libssl-dev</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lua5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">liblua5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-dev</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libevent-dev</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">make</span></span></code> </pre><br>  Clone the GitHub archive <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">git</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clone</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--recursive</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">https</span></span>://<span class="hljs-selector-tag"><span class="hljs-selector-tag">github</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.com</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">vysheng</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.git</span></span> &amp;&amp; <span class="hljs-selector-tag"><span class="hljs-selector-tag">cd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span></code> </pre><br><pre> <code class="css hljs">./<span class="hljs-selector-tag"><span class="hljs-selector-tag">configure</span></span></code> </pre><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">make</span></span></code> </pre><br>  The execution of this command will take some time, after which the installation will be completed. <br><br>  <u>Upd:</u> run the messenger and set up an account by entering a phone number and (if) a nickname.  <a href="http://habrahabr.ru/post/249265/">Cm.</a> <br><br>  <b>Step two: automatically send messages</b> <br><br>  To automatically send a message, create a file <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nano</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span></code> </pre><br>  with this content: <br><br><pre> <code class="css hljs">#!/<span class="hljs-selector-tag"><span class="hljs-selector-tag">bin</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">bash</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span>=$1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span>=$2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">tgpath</span></span>=/<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cd</span></span> ${tgpath} (<span class="hljs-selector-tag"><span class="hljs-selector-tag">echo</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span> $<span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> $<span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span>"; <span class="hljs-selector-tag"><span class="hljs-selector-tag">echo</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">safe_quit</span></span>") | ${tgpath}/<span class="hljs-selector-tag"><span class="hljs-selector-tag">bin</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">telegram-cli</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-k</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tg-server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-W</span></span></code> </pre><br>  Save and close it, giving permission for actions: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">chmod</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-R</span></span> 0655 /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span></code> </pre><br>  Test it with <br><br><pre> <code class="css hljs">/<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Name_lastname</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">your</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">message</span></span>"</code> </pre><br><img src="https://habrastorage.org/files/16d/d87/1aa/16dd871aa7a14da281c8c1b77cf5a371.png"><br><br><img src="https://habrastorage.org/files/dd7/1aa/bd0/dd71aabd05b040eaaf0d64890bafa363.png"><br><br>  To send a photo, create a file <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nano</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg_photo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span></code> </pre><br>  and put in it <br><br><pre> <code class="css hljs">#!/<span class="hljs-selector-tag"><span class="hljs-selector-tag">bin</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">bash</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span>=$1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span>=$2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">tgpath</span></span>=/<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cd</span></span> ${tgpath} (<span class="hljs-selector-tag"><span class="hljs-selector-tag">echo</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">send_photo</span></span> $<span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> $<span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span>"; <span class="hljs-selector-tag"><span class="hljs-selector-tag">echo</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">safe_quit</span></span>") | ${tgpath}/<span class="hljs-selector-tag"><span class="hljs-selector-tag">bin</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">telegram-cli</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-k</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tg-server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-W</span></span></code> </pre><br>  Save and close it, giving permission: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">chmod</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-R</span></span> 0655 /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg_photo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span></code> </pre><br>  and test with <br><br><pre> <code class="css hljs">/<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg_photo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Name_Lastname</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">folder</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">photo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span></code> </pre><br><br>  <u><b>Ii.</b></u>  <u><b>Remote control of Raspberry Pi through Telegram</b></u> <br><br><img src="https://habrastorage.org/files/40d/874/41d/40d87441d6ad43d69ef422c9192552a7.jpg"><br><br>  Telegram is a very versatile instant messenger in which you can work using one phone number simultaneously on several devices. <br><br>  In the previous review we saw how to install it, how to send text and media files.  We also made sure that Raspberry can be configured to automatically send messages via Telegram. <br><br>  This time we will ask Raspberry to perform a specific action as a function of the message received: for example, we could send the word ‚Äúphoto‚Äù to send Raspberry a photo of us at home, or ‚Äúlamp‚Äù to turn the lamp on, or ‚Äúopen‚Äù to open the door garage.  Let's start. <br><br>  <b>Step One: Installation</b> <br><br>  We start on the basis of the actions described above.  To intercept the new incoming message, we create the action.lua file (I omit the description of the Lua language with a <a href="http://www.lua.org/">link</a> to the official website, as habraysers are <a href="http://habrahabr.ru/hub/Lua/">obviously</a> familiar with it. <i>- Note lane</i> ): <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nano</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">action</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span></code> </pre><br>  with the following content: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">function</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">on_msg_receive</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">if</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">then</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">return</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">if</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span>=='<span class="hljs-selector-tag"><span class="hljs-selector-tag">ping</span></span>') <span class="hljs-selector-tag"><span class="hljs-selector-tag">then</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">send_msg</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.from</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.print_name</span></span>, '<span class="hljs-selector-tag"><span class="hljs-selector-tag">pong</span></span>', <span class="hljs-selector-tag"><span class="hljs-selector-tag">ok_cb</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">false</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">function</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">on_our_id</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">id</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">function</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">on_secret_chat_created</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">peer</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">function</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">on_user_update</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">user</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">function</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">on_chat_update</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">user</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">function</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">on_get_difference_end</span></span> () <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">function</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">on_binlog_replay_end</span></span> () <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span></code> </pre><br>  Save and close the file.  Now that the incoming message is ‚Äúping‚Äù, the Telegram responds with the message ‚Äúpong‚Äù. <br><br>  Go to tg <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">cd</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span></code> </pre><br>  and write: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bin</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">telegram-cli</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-k</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tg-server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-W</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-s</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">action</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span></code> </pre><br>  Try sending a message.  If everything is correct, Telegram responds only to "ping" (not to "PING"), and we should see something like this: <br><br><img src="https://habrastorage.org/files/8cd/647/884/8cd6478841944232a01f36d3a390d0df.png"><br><br><img src="https://habrastorage.org/files/d0d/6c6/1b2/d0d6c61b2eb246cba91ccaacdc23c17d.png"><br><br>  OK, let's try something more amusing. <br>  Install a Raspberry camera (see <a href="http://www.emmeshop.eu/blog/%3Fq%3Dnode/42">this</a> tutorial) and create a new folder where photos from this camera will be saved by default. <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mkdir</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span></code> </pre><br>  Create a new ‚Äúcamera.ch‚Äù file <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nano</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span></code> </pre><br>  here with this stuffing <br><br><pre> <code class="css hljs">#!/<span class="hljs-selector-tag"><span class="hljs-selector-tag">bin</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">bash</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">raspistill</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-w</span></span> 800 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-h</span></span> 600 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-o</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">photo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.jpg</span></span></code> </pre><br>  Save and close it, allowing action. <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">chmod</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-R</span></span> 0655 /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span></code> </pre><br>  Edit ‚Äúaction.lua‚Äù <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nano</span></span> /<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">tg</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">action</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span></code> </pre><br>  and add these lines to the on_msg_receive function: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">if</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span>=='<span class="hljs-selector-tag"><span class="hljs-selector-tag">photo</span></span>') <span class="hljs-selector-tag"><span class="hljs-selector-tag">then</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">os</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.execute</span></span>('/<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sh</span></span>') <span class="hljs-selector-tag"><span class="hljs-selector-tag">send_photo</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">msg</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.from</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.print_name</span></span>, '/<span class="hljs-selector-tag"><span class="hljs-selector-tag">home</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">pi</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">camera</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">photo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.jpg</span></span>', <span class="hljs-selector-tag"><span class="hljs-selector-tag">ok_cb</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">false</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span></code> </pre><br><img src="https://habrastorage.org/files/8d2/8ed/46f/8d28ed46fc384eb1af25529484889a2b.png"><br><br>  <b>Step Two: Test</b> <br><br><img src="https://habrastorage.org/files/63f/d5d/ad3/63fd5dad359641e48c1e6deb92a0a261.jpg"><br><br><img src="https://habrastorage.org/files/40d/874/41d/40d87441d6ad43d69ef422c9192552a7.jpg"><br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bin</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">telegram-cli</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-k</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tg-server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-W</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-s</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">action</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span></code> </pre><br>  Now, if you send the word "photo", Raspberry will respond with a photo. <br><br>  To specify additional commands, simply modify the ‚Äúaction.lua‚Äù file by adding a new ‚Äúif‚Äù block.  For example, you can activate a switch or request an alarm status. </div><p>Source: <a href="https://habr.com/ru/post/249265/">https://habr.com/ru/post/249265/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249251/index.html">Sunset era icons from FatCow (sample by color, top 30 and other arithmetic)</a></li>
<li><a href="../249255/index.html">Welcome to Moscow.pm February 5</a></li>
<li><a href="../249257/index.html">GoDaddy stops servicing domain names registered by residents of Crimea and frees them for registration.</a></li>
<li><a href="../249259/index.html">Migrating from SQL Server to MariaDB / MySQL. What to do with XML</a></li>
<li><a href="../249263/index.html">Model View Controller (MVC) usage experience, conclusions</a></li>
<li><a href="../249267/index.html">Interface for Yandex.Disk in Ubuntu 14.04</a></li>
<li><a href="../249269/index.html">Linguistic aspects of what3words and technical analysis of dictionaries</a></li>
<li><a href="../249271/index.html">How we ‚Äúmarried‚Äù cloud PBX, GSM and realtors (part 1)</a></li>
<li><a href="../249273/index.html">STM32 and FreeRTOS. 1. Fun with streams</a></li>
<li><a href="../249275/index.html">Update cloud platform Jelastic 2.5 - scaling on the fly</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>