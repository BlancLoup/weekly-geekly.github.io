<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Print from Google Apps Script</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1. Challenge 
 Reading the tape on oDesk , I came across an interesting project in my direction (and I track, basically, the tasks to write somet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Print from Google Apps Script</h1><div class="post__text post__text-html js-mediator-article"><h4>  Part 1. Challenge </h4><br>  Reading the tape on <a href="http://www.odesk.com/">oDesk</a> , I came across an interesting project in my direction (and I track, basically, the tasks to write something, to screw something or another way to torture Google Apps Script or Google Apps application).  The client asked to write a script that will send him a selection from Google Spreadsheet at the click of a button.  But there was one phrase in the description that hooked me - "I was told that it was impossible to create a script that would print from Google Apps."  I have always loved and love ‚Äúimpossible‚Äù tasks: <br><blockquote>  ‚ÄúWe ourselves know that she has no solution,‚Äù said Junta, immediately bristling.  - We want to know how to solve it. <br>  <sub>Arkady and Boris Strugatsky.</sub>  <sub>Monday begins on Saturday</sub> </blockquote><br>  The article is intended for readers already familiar with Google Apps Script and related technologies. <br><a name="habracut"></a><br><h4>  Part 2. Torment </h4><br>  The decision was initially obvious - to use the <a href="http://www.google.com/cloudprint/">Google Cloud Print service</a> , and to transfer the printed document in PDF form.  Studying the API has shown that it is necessary to initially authenticate with the service, then send a print request.  So, I set up the service, set up the printers, and started pulling the API.  Everything works and is printed (from the client's REST)!  It's time to write the script ... <br><br><h5>  Authentication </h5><br>  ... and immediately with all my might I fly on the first pitfall: authentication.  Google Cloud Print lacks a simple login, it has its own authentication scope.  Games in the <a href="https://developers.google.com/oauthplayground/">OAuth Playground</a> allowed us to select the desired scope (easily guessed, but for some reason did not find it in the documentation) - <pre><code class="hljs objectivec">https:<span class="hljs-comment"><span class="hljs-comment">//www.googleapis.com/auth/cloudprint</span></span></code> </pre>  We start writing a script, use oAuth 1.0: <br><div class="spoiler">  <b class="spoiler_title">Authentication through oAuth 1.0</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorize_</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oauthConfig = UrlFetchApp.addOAuthService(<span class="hljs-string"><span class="hljs-string">"print"</span></span>); oauthConfig.setConsumerKey(<span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>); oauthConfig.setConsumerSecret(<span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>); oauthConfig.setRequestTokenUrl(<span class="hljs-string"><span class="hljs-string">"https://www.google.com/accounts/OAuthGetRequestToken?scope=https://www.googleapis.com/auth/cloudprint"</span></span>); oauthConfig.setAuthorizationUrl(<span class="hljs-string"><span class="hljs-string">"https://accounts.google.com/OAuthAuthorizeToken"</span></span>); oauthConfig.setAccessTokenUrl(<span class="hljs-string"><span class="hljs-string">"https://www.google.com/accounts/OAuthGetAccessToken"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invokeCloudPrint_</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">method,payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseurl = <span class="hljs-string"><span class="hljs-string">"https://www.google.com/cloudprint/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">muteHttpExceptions</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">oAuthServiceName</span></span>: <span class="hljs-string"><span class="hljs-string">"print"</span></span>, <span class="hljs-attr"><span class="hljs-attr">oAuthUseToken</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (payload != <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) options.payload = payload; authorize_(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = UrlFetchApp.fetch(baseurl+method,options); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.getResponseCode() == <span class="hljs-number"><span class="hljs-number">403</span></span>) { Browser.msgBox(<span class="hljs-string"><span class="hljs-string">"Please authorize me to print!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(response.getContentText()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchAnswer = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"search"</span></span>); Logger.log(searchAnswer); }</code> </pre><br></div></div><br><br>  After launching the <i>test ()</i> function, an authorization request appears, after which everything works fine and the response from Google Cloud Print is visible in the console log.  Problem solved?  Not really.  First, as it turned out, authorization works out only if it is run from the script editor.  That is, the user of the copy of the script should go into the script editor and call any function there that will access Google Cloud Print with the authorization request.  Secondly,‚Ä¶ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  oAuth 2.0 </h6><br>  ... oAuth 1.0 survives the last months and after April 20, 2015 support for this protocol is not guaranteed.  When you go to oAuth 2.0 authorization in Google services, if necessary, replicate the solution, there is a problem with client_id and redirect.  Namely, the authentication request specifies a unique client_id, it corresponds to a specific redirect URL (or several URLs) after authentication and a secret password.  In general terms, the redirection process follows the following scenario: <br><ol><li>  Sent the user to the authorization request page. </li><li>  On the URL redirect received a response with the code. </li><li>  Received from the code token for access to services. </li></ol><br>  The problem arises precisely with the redirect, since every script has a unique identifier in the cloud, and the URL of the redirect must correspond to this identifier.  Therefore, in the replicable solution, there are such options: <br><ul><li>  explain to each client how to register oAuth 2.0 client_id in the Google Developer Console; </li><li>  or each time you have to make a new client_id with the URL of the redirect corresponding to a new copy of the script (link to your account); </li><li>  or write a universal script that will generate a token by the parameters passed ... but, again, the script will be tied to a developer account and for any problems with this account the program will simply cease to function for all clients. </li></ul><br>  All these methods are not very convenient, they are either for themselves (first) or for in-house development (the second, sometimes the third).  Unfortunately, the oAuth architecture itself does not imply the possibility that something will change in this respect.  I would recommend the third option for a replicable solution or, if the client agrees to provide access to his account / create a neutral new one, the first one. <br>  I will give an example of the code in the first option, since I did not write the third option, I only thought it over, and the second one is no different from the first one; the only difference is in whether the client_id is created ‚Äî from the client or the developer. <br><div class="spoiler">  <b class="spoiler_title">Authentication with oAuth 2.0</b> <div class="spoiler_text"><h6>  Step 1. Create client_id </h6><br><ol><li>  Open the <a href="https://console.developers.google.com/project">Google Developers Console</a> and create a new project. </li><li>  Go to <i>APIs &amp; auth -&gt; Credentials</i> , click Create new Client ID. </li><li>  Type - Web Application;  Authorized JavaScript origins - <a href="https://script.google.com/%3B">script.google.com/;</a>  Authorized redirect URIs - look at the top of the Script Editor URL of our script, not including / edit and further, adding at the end / usercallback </li></ol><br>  It should look like this: <br><img src="https://habrastorage.org/files/456/c3f/f99/456c3ff99de342d3900555112c803bfe.jpg"><br><h6>  Step 2. Authorization code </h6><br>  Everything is simple here - we show the user a button that will transfer it to the URL for authorization using oAuth 2.0.  Redirect will go back to the function we specified: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> html = HtmlService.createTemplateFromFile(<span class="hljs-string"><span class="hljs-string">"Auth"</span></span>).evaluate().setSandboxMode(HtmlService.SandboxMode.NATIVE).setTitle(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>); SpreadsheetApp.getUi().showModalDialog(html, <span class="hljs-string"><span class="hljs-string">"Test"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAuthURL</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options= { <span class="hljs-attr"><span class="hljs-attr">client_id</span></span> : <span class="hljs-string"><span class="hljs-string">"110560935370-jdoq9cc7tvna2r94va4j9o3310m6ghth.apps.googleusercontent.com"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    scope : "https://www.googleapis.com/auth/cloudprint", redirect_uri : "https://script.google.com/macros/d/MDYeOxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/usercallback", //    state : ScriptApp.newStateToken().withMethod("getAuthResponse").createToken() }; var url = "https://accounts.google.com/o/oauth2/auth?response_type=code&amp;access_type=offline"; for(var i in options) url += "&amp;"+i+"="+encodeURIComponent(options[i]); return url; }</span></span></code> </pre><br>  Auth.html: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'&lt;?!= getAuthURL(); ?&gt;'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'_blank'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span>Authorize!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Here, the key is the <i>ScriptApp.newStateToken ()</i> function, which allows you to create a parameter for the <i>usercallback</i> method that involves calling the specified function ( <i>getAuthResponse</i> ).  When the <i>test ()</i> function is launched, a dialog box opens on the tab of the table with a button to go to the authorization page. <br><h6>  Step 3. Getting oAuth token and calling Google Cloud Print </h6><br>  After the callback we get into <i>getAuthResponse ()</i> .  Let's write this method and call some Google Cloud Print method with the received token, displaying the result on the screen: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAuthResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">q</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">muteHttpExceptions</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: { <span class="hljs-attr"><span class="hljs-attr">code</span></span>: q.parameter.code, <span class="hljs-attr"><span class="hljs-attr">client_id</span></span> : <span class="hljs-string"><span class="hljs-string">"110560935370-jdoq9cc7tvna2r94va4j9o3310m6ghth.apps.googleusercontent.com"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    client_secret : "xxxxxxxxxxxxxxxxxxxxxxxx", //    redirect_uri: "https://script.google.com/macros/d/MDYeOxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/usercallback", //    grant_type: "authorization_code" } } var response = JSON.parse(UrlFetchApp.fetch("https://accounts.google.com/o/oauth2/token", options)); var auth_string = response.token_type+" "+response.access_token; options.method = "get"; options.payload = null; options.headers = {Authorization: auth_string}; response = UrlFetchApp.fetch("https://www.google.com/cloudprint/search",options); return ContentService.createTextOutput(response.getContentText()); }</span></span></code> </pre><br>  If everything is done correctly, as a result, after clicking the <b>Authorize</b> button and authorization in the window that opens, the JSON response will be displayed on the screen with a list of connected printers. <br></div></div><br>  I will not recommend another method, but for ‚Äúmyself‚Äù it will be also easier to perform: <br><div class="spoiler">  <b class="spoiler_title">Dirty hack</b> <div class="spoiler_text">  In general, Google Apps Script supports its own oAuth 2.0 authorization token.  You can get it by calling <i>ScriptApp.getOAuthToken ()</i> .  But in this token, of course, no access rights to Google Cloud Print are provided. <br>  However, there is a way to add these rights to it.  To do this, call the authorization request window (if necessary, reset the current token by calling <i>ScriptApp.invalidateAuth ()</i> ) and copy the URL of this window (close the window without confirmation!): <br><img src="https://habrastorage.org/files/c53/5f0/ddf/c535f0ddf7fa4fdba1c4cd1ff3722a82.jpg"><br>  In the copied URL, one of the parameters will look like "scope = https: // + https: //" (the set of permissions required by the script).  Just add at the end of this parameter <pre>  + https: //www.googleapis.com/auth/cloudprint </pre>  and open the modified URL in a new browser tab, then confirm authorization.  As a result, the script will get access rights to Google Cloud Print and these rights will remain until the moment of reauthorization (for example, if you reset the token by the above <i>invalidateAuth</i> call). <br></div></div><br><h6>  GCP Web Element </h6><br>  Because of these difficulties with oAuth 2.0, I decided to try <a href="https://developers.google.com/cloud-print/docs/gadget">GCP Web Element</a> .  Not very long digging this topic, since I already had working solutions.  In short: the result is completely negative.  The fact is that Google Apps Script rewrites the JavaScript code for display in the browser.  As a result, GCP Web Element simply does not work.  Here is a sample code, creating a gadget does not occur: <br><div class="spoiler">  <b class="spoiler_title">GCP Web Element</b> <div class="spoiler_text">  Code.gs: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> html = HtmlService.createTemplateFromFile(<span class="hljs-string"><span class="hljs-string">"Print"</span></span>).evaluate().setSandboxMode(HtmlService.SandboxMode.NATIVE).setTitle(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>); SpreadsheetApp.getUi().showModalDialog(html, <span class="hljs-string"><span class="hljs-string">"Test"</span></span>); }</code> </pre><br>  Print.html: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert(window.gadget); window.gadget=new cloudprint.Gadget(); alert(window.gadget);"</span></span></span><span class="hljs-tag">&gt;</span></span>Initiate Gadget<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.google.com/cloudprint/client/cpgadget.js"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="undefined"></span><span class="undefined"></span></code> </pre><br></div></div><br>  As a result, I stopped at oAuth 1.0, as the most replicable version (although the method works until April 20, however, it is better suited as the <u>first</u> solution - it's easier to explain to the client and the client will not be scared by the complexity of oAuth 2.0). <br><br><h5>  Content and print </h5><br>  If the Google Apps Script API would work as stated in the documentation, life would undoubtedly be much simpler.  Google Spreadsheet (more precisely, the SpreadsheetApp spreadsheet application) supports on-the-fly conversion to pdf: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pdf = SpreadsheetApp.getActiveSpreadsheet().getAs(<span class="hljs-string"><span class="hljs-string">"application/pdf"</span></span>); }</code> </pre><br>  The idea was to transfer the selected range to the new Spreadsheet and convert it to pdf.  Unfortunately, a bug in Google Apps Script hinders - a PDF document is created, but it is completely empty, so this way disappears.  Workarounds: <br><ol><li>  Google Cloud Print can print Google Spreadsheet, as it turned out.  You can transfer the selection to a new table and issue a print command. </li><li>  A more elegant way: in the Google Spreadsheet menu there is an option ‚ÄúDownload as ...‚Äù with a choice of PDF-format.  And this option, in contrast to the conversion by Google Apps Script, works. </li></ol><br>  In the second version, the browser follows a specially formed link.  Let's write a code that turns the transferred Spreadsheet range into PDF: <br><div class="spoiler">  <b class="spoiler_title">PDF conversion</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloudPrint_</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">strrange,portrait</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchAnswer = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"search"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rangess = ss.getRange(strrange); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gid = rangess.getSheet().getSheetId(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r1=rangess.getRow()<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c1=rangess.getColumn()<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r2=r1+rangess.getHeight(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c2=c1+rangess.getWidth(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> docurl=<span class="hljs-string"><span class="hljs-string">"https://docs.google.com/spreadsheets/d/"</span></span>+SpreadsheetApp.getActiveSpreadsheet().getId()+<span class="hljs-string"><span class="hljs-string">"/export?format=pdf&amp;size=0&amp;fzr=false&amp;portrait="</span></span>+portrait+<span class="hljs-string"><span class="hljs-string">"&amp;fitw=true&amp;gid="</span></span>+gid+<span class="hljs-string"><span class="hljs-string">"&amp;r1="</span></span>+r1+<span class="hljs-string"><span class="hljs-string">"&amp;c1="</span></span>+c1+<span class="hljs-string"><span class="hljs-string">"&amp;r2="</span></span>+r2+<span class="hljs-string"><span class="hljs-string">"&amp;c2="</span></span>+c2+<span class="hljs-string"><span class="hljs-string">"&amp;ir=false&amp;ic=false&amp;gridlines=false&amp;printtitle=false&amp;sheetnames=false&amp;pagenum=UNDEFINED&amp;attachment=true"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> docurl; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Logger.log(cloudPrint_(<span class="hljs-string"><span class="hljs-string">"A1:D12"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>)); }</code> </pre><br></div></div><br>  Great, URL received!  It remains a trifle - upload the file and send the request to Google Cloud Print to enjoy the print.  Additionally, you must specify printerid (the id list is returned by the API search method) and xsrf from the previously received response: <br><div class="spoiler">  <b class="spoiler_title">Attempt 1. Does not work</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchAnswer = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"search"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = cloudPrint_(<span class="hljs-string"><span class="hljs-string">"A1:D12"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file = UrlFetchApp.fetch(url); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = { <span class="hljs-attr"><span class="hljs-attr">printerid</span></span>: printer, <span class="hljs-attr"><span class="hljs-attr">xsrf</span></span>: searchAnswer.xsrf_token, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: rangess.getSheet().getName(), <span class="hljs-attr"><span class="hljs-attr">ticket</span></span>: <span class="hljs-string"><span class="hljs-string">"{\"version\": \"1.0\",\"print\": {}}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">contentType</span></span>: <span class="hljs-string"><span class="hljs-string">"application/pdf"</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: file.getBlob() }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> printstatus = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>,payload); Browser.msgBox(printstatus.message); }</code> </pre><br></div></div><br>  But this code does not work, problems arise in two places.  First, oAuth 1.0 falls off and does not work when you try to transfer a file (hi Google Apps Script bugs).  Secondly, the script authentication context does not match the context of the user who called the script, and there is simply no access to the URL for uploading.  It turns out that it is necessary to open spreadsheet at the time of printing for the ‚Äúoutside world‚Äù and close it at the end of printing.  But then there is no point in intermediate PDF uploading (it still doesn‚Äôt work with oAuth), you can immediately send the upload URL to Google Cloud Print: <br><div class="spoiler">  <b class="spoiler_title">Attempt 2. Works!</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchAnswer = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"search"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = cloudPrint_(<span class="hljs-string"><span class="hljs-string">"A1:D12"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = { <span class="hljs-attr"><span class="hljs-attr">printerid</span></span>: printer, <span class="hljs-attr"><span class="hljs-attr">xsrf</span></span>: searchAnswer.xsrf_token, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: rangess.getSheet().getName(), <span class="hljs-attr"><span class="hljs-attr">ticket</span></span>: <span class="hljs-string"><span class="hljs-string">"{\"version\": \"1.0\",\"print\": {}}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">contentType</span></span>: <span class="hljs-string"><span class="hljs-string">"url"</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: url }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> drivefile = DriveApp.getFileById(SpreadsheetApp.getActiveSpreadsheet().getId()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldaccess = drivefile.getSharingAccess(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldpermission = drivefile.getSharingPermission(); drivefile.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> printstatus = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>,payload); drivefile.setSharing(oldaccess, oldpermission); Browser.msgBox(printstatus.message); }</code> </pre><br></div></div><br><h4>  Part 3. Results </h4><br>  As a result, after traveling through a maze of bugs and problems, the seal worked.  I cite the full code with oAuth 1.0 (as a self-contained solution): <br><div class="spoiler">  <b class="spoiler_title">Print from Google Apps Script</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contextauth=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloudPrint_</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">strrange,portrait,size</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchAnswer = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"search"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rangess = ss.getRange(strrange); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gid = rangess.getSheet().getSheetId(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r1=rangess.getRow()<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c1=rangess.getColumn()<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r2=r1+rangess.getHeight(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c2=c1+rangess.getWidth(); portrait = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> portrait !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ? portrait : <span class="hljs-literal"><span class="hljs-literal">true</span></span>; size = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> size !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ? size : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> docurl=<span class="hljs-string"><span class="hljs-string">"https://docs.google.com/spreadsheets/d/"</span></span>+SpreadsheetApp.getActiveSpreadsheet().getId()+<span class="hljs-string"><span class="hljs-string">"/export?format=pdf&amp;size=0&amp;fzr=false&amp;portrait="</span></span>+portrait+<span class="hljs-string"><span class="hljs-string">"&amp;fitw=true&amp;gid="</span></span>+gid+<span class="hljs-string"><span class="hljs-string">"&amp;r1="</span></span>+r1+<span class="hljs-string"><span class="hljs-string">"&amp;c1="</span></span>+c1+<span class="hljs-string"><span class="hljs-string">"&amp;r2="</span></span>+r2+<span class="hljs-string"><span class="hljs-string">"&amp;c2="</span></span>+c2+<span class="hljs-string"><span class="hljs-string">"&amp;ir=false&amp;ic=false&amp;gridlines=false&amp;printtitle=false&amp;sheetnames=false&amp;pagenum=UNDEFINED&amp;attachment=true"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prop = PropertiesService.getUserProperties(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> printer = prop.getProperty(<span class="hljs-string"><span class="hljs-string">"printer"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (printer == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { selectPrinterDlg(strrange,portrait,size); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } ss.toast(<span class="hljs-string"><span class="hljs-string">"Printing..."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> drivefile = DriveApp.getFileById(SpreadsheetApp.getActiveSpreadsheet().getId()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldaccess = drivefile.getSharingAccess(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldpermission = drivefile.getSharingPermission(); drivefile.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload={ <span class="hljs-attr"><span class="hljs-attr">printerid</span></span>: printer, <span class="hljs-attr"><span class="hljs-attr">xsrf</span></span>: searchAnswer.xsrf_token, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: rangess.getSheet().getName(), <span class="hljs-attr"><span class="hljs-attr">ticket</span></span>: <span class="hljs-string"><span class="hljs-string">"{\"version\": \"1.0\",\"print\": {}}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">contentType</span></span>: <span class="hljs-string"><span class="hljs-string">"url"</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: docurl }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> printstatus = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>,payload); drivefile.setSharing(oldaccess, oldpermission); Browser.msgBox(printstatus.message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">selectPrinterDlg</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">strrange,portrait,size</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchAnswer = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"search"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ui = UiApp.createApplication(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> panel = ui.createVerticalPanel(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lb = ui.createListBox(<span class="hljs-literal"><span class="hljs-literal">false</span></span>).setId(<span class="hljs-string"><span class="hljs-string">'lb'</span></span>).setName(<span class="hljs-string"><span class="hljs-string">'lb'</span></span>); strrange = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> strrange !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ? strrange : <span class="hljs-string"><span class="hljs-string">""</span></span>; portrait = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> portrait !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ? portrait : <span class="hljs-string"><span class="hljs-string">""</span></span>; size = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> size !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ? size : <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hidden1 = ui.createTextBox().setVisible(<span class="hljs-literal"><span class="hljs-literal">false</span></span>).setValue(strrange).setId(<span class="hljs-string"><span class="hljs-string">"range"</span></span>).setName(<span class="hljs-string"><span class="hljs-string">"range"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hidden2 = ui.createTextBox().setVisible(<span class="hljs-literal"><span class="hljs-literal">false</span></span>).setValue(portrait.toString()).setId(<span class="hljs-string"><span class="hljs-string">"portrait"</span></span>).setName(<span class="hljs-string"><span class="hljs-string">"portrait"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hidden3 = ui.createTextBox().setVisible(<span class="hljs-literal"><span class="hljs-literal">false</span></span>).setValue(size.toString()).setId(<span class="hljs-string"><span class="hljs-string">"printsize"</span></span>).setName(<span class="hljs-string"><span class="hljs-string">"printsize"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> searchAnswer.printers) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connPrinter = searchAnswer.printers[i]; lb.addItem(connPrinter.displayName, connPrinter.id); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> button = ui.createButton(<span class="hljs-string"><span class="hljs-string">"Save"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = ui.createServerHandler(<span class="hljs-string"><span class="hljs-string">"SavePrinter_"</span></span>).addCallbackElement(panel); button.addClickHandler(ui.createClientHandler().forEventSource().setEnabled(<span class="hljs-literal"><span class="hljs-literal">false</span></span>).setText(<span class="hljs-string"><span class="hljs-string">"Saving..."</span></span>)); button.addClickHandler(handler); panel.add(lb).setCellHorizontalAlignment(button, UiApp.HorizontalAlignment.CENTER); panel.add(hidden1); panel.add(hidden2); panel.add(button); ui.add(panel); SpreadsheetApp.getUi().showModalDialog(ui, <span class="hljs-string"><span class="hljs-string">"Select printer"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ PropertiesService.getUserProperties().deleteProperty(<span class="hljs-string"><span class="hljs-string">"printer"</span></span>); ScriptApp.invalidateAuth(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SavePrinter_</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ui = UiApp.getActiveApplication(); PropertiesService.getUserProperties().setProperty(<span class="hljs-string"><span class="hljs-string">"printer"</span></span>, e.parameter.lb); ui.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.parameter.range != <span class="hljs-string"><span class="hljs-string">""</span></span>) cloudPrint_(e.parameter.range,e.parameter.portrait == <span class="hljs-string"><span class="hljs-string">"true"</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(e.parameter.printsize)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ui; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invokeCloudPrint_</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">method,payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseurl = <span class="hljs-string"><span class="hljs-string">"https://www.google.com/cloudprint/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">muteHttpExceptions</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">oAuthServiceName</span></span>: <span class="hljs-string"><span class="hljs-string">"print"</span></span>, <span class="hljs-attr"><span class="hljs-attr">oAuthUseToken</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (payload != <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) options.payload = payload; authorize_(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = UrlFetchApp.fetch(baseurl+method,options); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.getResponseCode() == <span class="hljs-number"><span class="hljs-number">403</span></span>) { Browser.msgBox(<span class="hljs-string"><span class="hljs-string">"Please authorize me to print!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(response.getContentText()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchAnswer = invokeCloudPrint_(<span class="hljs-string"><span class="hljs-string">"search"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorize_</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contextauth) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oauthConfig = UrlFetchApp.addOAuthService(<span class="hljs-string"><span class="hljs-string">"print"</span></span>); oauthConfig.setConsumerKey(<span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>); oauthConfig.setConsumerSecret(<span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>); oauthConfig.setRequestTokenUrl(<span class="hljs-string"><span class="hljs-string">"https://www.google.com/accounts/OAuthGetRequestToken?scope=https://www.googleapis.com/auth/cloudprint"</span></span>); oauthConfig.setAuthorizationUrl(<span class="hljs-string"><span class="hljs-string">"https://accounts.google.com/OAuthAuthorizeToken"</span></span>); oauthConfig.setAccessTokenUrl(<span class="hljs-string"><span class="hljs-string">"https://www.google.com/accounts/OAuthGetAccessToken"</span></span>); contextauth = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ SpreadsheetApp.getUi().createMenu(<span class="hljs-string"><span class="hljs-string">"Printing"</span></span>).addItem(<span class="hljs-string"><span class="hljs-string">"Select printer..."</span></span>, <span class="hljs-string"><span class="hljs-string">"selectPrinterDlg"</span></span>).addToUi(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Print</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ cloudPrint_(<span class="hljs-string"><span class="hljs-string">"A1:D12"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre><br></div></div><br>  In addition to the disassembled pieces of code, a dialog (and menu item) for selecting a printer is made.  Installation Instructions: <br><ol><li>  Pre: set up Google Cloud Print, check test print </li><li>  Create a new Google Spreadsheet, write something in the range A1: D12 </li><li>  Open Script Editor, create a new empty project. </li><li>  Copy code, save, call the function validate - to authorize all the necessary rights </li><li>  Call the Print function.  At the first call on the tab of the table, the printer selection dialog will open. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/243421/">https://habr.com/ru/post/243421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243409/index.html">Secrets of setting goals for entrepreneurs</a></li>
<li><a href="../243411/index.html">Connect FB, VK, G + to Android. Light version</a></li>
<li><a href="../243413/index.html">Configuring Virtual Infrastructure: VDI Cluster Optimization</a></li>
<li><a href="../243417/index.html">Ethernet Weather Station 2 - Continued ...</a></li>
<li><a href="../243419/index.html">Turing test based on real search queries in Yandex</a></li>
<li><a href="../243423/index.html">New IBM Global Entrepreneurship Program Accelerates Cloud Development</a></li>
<li><a href="../243425/index.html">Compact RSA implementation for embedded applications</a></li>
<li><a href="../243427/index.html">[TRANSFER] JSON Web Token-based authentication in Django and AngularJS: part one</a></li>
<li><a href="../243429/index.html">Autostarting Node.js application on CentOS 6.2</a></li>
<li><a href="../243431/index.html">Why you should never say "never"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>