<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A smooth transition of the company's network to IPv6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, community. 

 I would like to highlight the transition of the network to IPv6, since this topic is poorly covered, especially in Russian. First...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A smooth transition of the company's network to IPv6</h1><div class="post__text post__text-html js-mediator-article"> Hello, community. <br><br>  I would like to highlight the transition of the network to IPv6, since this topic is poorly covered, especially in Russian.  First, let's look at how our network looks like before the transition: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/872/039/4b8/8720394b8756f0eb864729330733e6a4.png" alt="image"><br><a name="habracut"></a><br>  What we have?  A router connected to the Internet that performs NAT functions for internal networks.  Networks are in vlan10 and vlan20. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The configuration of the router is as follows: <br> <code>Router(config)#int fa0/0 <br> Router(config-if)#ip address 192.0.2.2 255.255.255.252 <br> Router(config-if)#ip nat outside <br> Router(config)#int fa0/1.10 <br> Router(config-if)#encapsulation dot1Q 10 <br> Router(config-if)#ip address 192.168.1.1 255.255.255.0 <br> Router(config-if)#ip nat inside <br> Router(config)#int fa0/1.20 <br> Router(config-if)#encapsulation dot1Q 20 <br> Router(config-if)#ip address 192.168.2.1 255.255.255.0 <br> Router(config-if)#ip nat inside <br> Router(config)#ip nat pool natpool 192.0.2.2 192.0.2.2 netmask 255.255.255.252 <br> Router(config)#ip nat inside source list 100 pool natpool overload <br> Router(config)#ip access-list extended 100 <br> Router(config-ext-nacl)#permit ip 192.168.1.0 0.0.0.255 any <br> Router(config-ext-nacl)#permit ip 192.168.2.0 0.0.0.255 any</code> <br> <br>  In order to switch to IPv6 - you need to get a block of addresses.  Negotiations with two providers to which the company's office is connected did not end as we would like - one provider is testing IPv6 within its network and has not yet issued blocks to customers, while the second has not even thought about using IPv6.  Short searches resulted in <a href="http://www.tunnelbroker.net/">TunnelBroker</a> from <a href="http://he.net/">Hurricane Electric</a> .  Of the options offered after registration - up to 5 blocks / 64 or / 48 (optional).  Those who have not yet experienced IPv6 are quite hard to imagine how many addresses this is.  For comparison, the entire IPv4 block - 2 <sup>32</sup> = 4.2 √ó 10 <sup>9</sup> addresses.  The IPv6 / 64 block is 2 <sup>64</sup> = 1.8 √ó 10 <sup>19</sup> addresses.  10 orders more than the entire IPv4 block. <br><br>  To get a block of IPv6 addresses, you need to fill out one form in which you must specify the external IPv4 address and select one of the servers (at the time of writing, only 18 servers ‚Äî 3 in Asia, 6 in Europe and 9 in North America). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/727/2ea/831/7272ea8315c179e1c9ecdd997516ca2a.png" alt="image"><br><br>  After receiving the block, make changes to the router. <br>  Enable ipv6 routing support: <br> <code>Router(config)#ipv6 unicast-routing <br> Router(config)#ipv6 cef</code> <br> <br>  Create a tunnel interface with an IPv6 provider (TunnelBroker): <br> <code>Router(config)#interface Tunnel0 <br> Router(config-if)#description Hurricane Electric IPv6 Tunnel Broker <br> Router(config-if)#no ip address <br> Router(config-if)#ipv6 address 2001:470:18:11A::2/64 <br> Router(config-if)#ipv6 enable <br> Router(config-if)#tunnel source GigabitEthernet0/0.510 <br> Router(config-if)#tunnel destination 216.218.221.6 <br> Router(config-if)#tunnel mode ipv6ip</code> <br> <br>  Add a default route: <br> <code>Router(config)#ipv6 route ::/0 Tunnel0</code> <br> <br>  If DNS is configured on your router, then you can already enjoy IPv6 operation: <br> <code>Router#ping ipv6.google.com <br> Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 2A00:1450:4008:C00::6A, timeout is 2 seconds: <br> !!!!! <br> Success rate is 100 percent (5/5), round-trip min/avg/max = 60/69/84 ms</code> <br> <br>  At this stage, I had a question - how to transfer the old addressing, so as not to have to remember for each computer two IP addresses - IPv4 and IPv6.  There is an exit.  First you need to convert IPv4 to hex, and then we will: <br> <code>192.168.1.0 ‚Üí C0.A8.1.0 <br> 192.168.2.0 ‚Üí C0.A8.2.0</code> <br> <br>  We write in the form of more appropriate IPv6: C0A8: 0100 and C0A8: 0200.  Leading zeros can be omitted, therefore C0A8: 100 and C0A8: 200. <br><br>  Our networks 192.168.1.0 and 192.168.2.0 had a mask of 255.255.255.0 (or more shortly / 24).  Let us recall a little theory - the mask / 24 says that the initial 24 bits do not change within the network, and only the remaining 8 bits can change (the IPv4 address consists of 32 bits - 4 bits of 8 bits).  We need to make a similar mask for the new IPv6 network, but the IPv6 address consists of already 128 bits.  The last 8 bits can change, the first 120 bits cannot.  Mask: / 120. <br><br>  When we have decided on the necessary mask - it is necessary to introduce old networks into the new IPv6 block. <br> <code>192.168.1.0/24 ‚Üí 2001:470:18:11A::C0A8:100/120 <br> 192.168.2.0/24 ‚Üí 2001:470:18:11A::C0A8:200/120</code> <br> <br>  Configure the router: <br> <code>Router(config)#int fa0/1.10 <br> Router(config-if)#ipv6 enable <br> Router(config-if)#ipv6 address 2001:470:18:11A::C0A8:101/120 <br> Router(config)#int fa0/1.20 <br> Router(config-if)#ipv6 enable <br> Router(config-if)#ipv6 address 2001:470:18:11A::C0A8:201/120</code> <br> <br>  Configuration of the router is over. <br><br>  It remains to enable IPv6 support on computers, register the address, mask, and gateway.  For example, let's configure a computer with the address 192.168.2.189: <br> <code>192.168.2.189 ‚Üí C0.A8.2.BD ‚Üí C0A8:2BD ‚Üí 2001:470:18:11A::C0A8:2BD <br> : /120 <br>  -: 2001:470:18:11A::C0A8:201</code> <br> <br>  Disable Teredo (if enabled): <br> <code>&gt;netsh interface teredo set state disabled <br> OK.</code> <br> <br>  Checking work via IPv6: <br> <code>&gt;ping ipv6.google.com <br>    ipv6.l.google.com [2a00:1450:4008:c00::6a]  32  : <br>   2a00:1450:4008:c00::6a: =80 <br>   2a00:1450:4008:c00::6a: =65 <br>   2a00:1450:4008:c00::6a: =81 <br>   2a00:1450:4008:c00::6a: =76 <br> <br>  Ping  2a00:1450:4008:c00::6a: <br> :  = 4,  = 4,  = 0 <br> (0% ) <br>   -  : <br>  = 65,  = 81 ,  = 75 </code> <br> <br>  In addition, you can enjoy the animated turtle on <a href="http://www.kame.net/">www.kame.net</a> (if your tortoise is not animated, then you have reached the site via IPv4). <br><br>  I would like to take stock.  There is no need to configure port forwarding, you can use ssh or remote desktop to access any computer / server inside the local network.  However, there is a very open security issue - the concept of the internal network disappears, now it is part of the Internet. </div><p>Source: <a href="https://habr.com/ru/post/119968/">https://habr.com/ru/post/119968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119959/index.html">Blockers of all time</a></li>
<li><a href="../119960/index.html">Xi3 ChromiumPC - pretty desktop with Chrome OS on board</a></li>
<li><a href="../119961/index.html">erlanger.ru rides Erlang Factory 2011 in London</a></li>
<li><a href="../119966/index.html">Learning to create a small template parser</a></li>
<li><a href="../119967/index.html">NASA has stopped trying to contact "Spirit"</a></li>
<li><a href="../119969/index.html">SkypeKit Description (headless Skype)</a></li>
<li><a href="../119972/index.html">Migration from one physical server to another</a></li>
<li><a href="../119973/index.html">June 9 - RoR developers meeting with Rendell Thomas</a></li>
<li><a href="../119974/index.html">PRIUT.KZ - Help for homeless animals</a></li>
<li><a href="../119979/index.html">5 minutes about the war</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>