<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of the report of Ruslan Cheryomin with JPoint 2016</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, everyone, Roman Poborchy is again on the JUG.ru blog, and today we are reviewing the report by Ruslan cheremin Cheryomin about escape ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of the report of Ruslan Cheryomin with JPoint 2016</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, everyone, Roman Poborchy is again on the JUG.ru blog, and today we are <a href="https://habrahabr.ru/users/cheremin/" class="user_link">reviewing the</a> report by Ruslan <a href="https://habrahabr.ru/users/cheremin/" class="user_link">cheremin</a> Cheryomin about escape analysis and scalarization: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/K6c3W6vhQOA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Slides can be viewed and downloaded <a href="http://public.jugru.org/jpoint/2016/msk/day_1/track_4/escape-analysis-scalarization.pdf"><u>here</u></a> .  Traditional <b>disclaimer</b> : about Java, only the article being analyzed, not the article itself. <br><a name="habracut"></a><br><h1>  Plot </h1><br>  Here I have most of the impressions - positive, everything that I think should be in the report, is in it.  The proposed changes are mainly cosmetic. <br><br><h2>  <font color="blue">Formulation of the problem</font> </h2><br>  I don‚Äôt know how you are, but Ruslan completely convinced me that it is useful to understand how escape analysis works in Java.  If you write code with this knowledge in mind, there will be fewer objects in the heap, less gc and in general the world will be better.  The answer to the question "why" is. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, the comic picture that appears at 03:37 slightly eclipses the statistics.  After the first viewing, I remembered only this graph and just wanted to complain that there are no figures about how much you can gain "on average".  At the second viewing it turned out that the numbers (~ 15% of allocations that can be eliminated) are mentioned.  If we could find and show a similar ‚Äúnormal‚Äù case, it would be better stored in memory.  Of course, it is not always easy to find such data from your practice to order, not so no. <br><br><h2>  <font color="blue">findings</font> </h2><br>  The conclusions and recommendations in the report naturally follow from the logic of the story; they are practically useful and concrete.  We do not just understand what to do ‚Äúwell‚Äù (for example, write small methods) and why it should be done.  We also found out that this ‚Äúgood‚Äù is almost always possible to find out the exact quantitative measure, and you can even redefine it if necessary!  What more to wish for happiness? <br><br>  Unless it would be possible to caution viewers: something will break if we often and mindlessly override the compiler defaults, but this will require examples and time and blur the focus. <br><br><h2>  <font color="blue">Omission</font> </h2><br>  What I lack here is the description of the experimental technique: for the first time the results of the launches appear on slide 16 (time 13:38), and there immediately appear 12 run'ov, limited not by the number of calls, but by time.  Why so?  Does this have any meaning, or is it historically so?  Why in some cases the time is 5 seconds (slides 16, 17, 19 and several others), in others 3 (slides 68, 73 and several others), and in others not specified at all (slides 89, 90, 91)? <br><br>  I am sure that it is enough to explain the technique here once, just to remove possible distrust, and all subsequent references will not require repetitive details, more about this in the section on slides. <br><br><h2>  <font color="blue">On the stage hanging gun</font> </h2><br>  The speaker was not hung by the speaker himself, someone from the audience made a shout from the spot, but, one way or another, it was about Œ¶-functions twice (in particular, half a minute since 16:40).  The compiler is one of those things for understanding of which fundamental knowledge is needed, but our audience does not always have this knowledge.  Since there was a contact of two or three <i>understanders</i> , it was worth trying in general terms to convey to everyone what it was about so that they did not feel deprived. <br><br>  I wondered if it was impossible on the fingers, since there are no prepared slides in advance, tell me in a minute what these Œ¶-functions are and what approximate relation they have to the topic of the story.  I focus on myself, that is, on the level of a person who, twenty years ago, passed a special course on compilers and has since worked with them only as a user.  At the time of viewing the report, I, of course, did not remember what it was.  So, we look at slide 23 and try to explain what is happening there: <br><br><img src="https://habrastorage.org/files/040/244/31c/04024431cbab4d2ca673c86f626db842.png"><br><br><div class="spoiler">  <b class="spoiler_title">Here's what I got:</b> <div class="spoiler_text">  The internal code representation used in HotSpot JIT complies with the requirements of a single assignment, SSA-form.  This means that assignment is done only once in each variable, and if we write somewhere many times, then the compiler gets a new <i>version of</i> this variable for each record.  This is necessary for a very large number of optimizations, which he spends just above his internal presentation.  That is, in our code v from the if-branch, v from the else-branch and v from the return-statement from the point of view of the compiler - three different variables.  For cases like return-statement, Œ¶-functions are just needed.  This is an abstraction that assigns a value to a variable, depending on which branch of performance we have come to this point.  The beauty and meaning of this function is that it is used without interrupting the base unit, although from the point of view of human logic it contains a conditional statement inside.  But the function, like the conditional operator, is not real (actually Œ¶ is short for phony, fake), such an allowed cheat.  Nevertheless, we empirically see that this construct blocks the escape analysis implemented in JIT. </div></div><br>  Only the text turns out to be quite difficult, but if you prepare in advance, you can draw a diagram and don‚Äôt be afraid to talk about the SSA-form: at the concept level, this is simple.  In the implementations, there are probably a lot of unobvious details, and in some audiences one will have to make more digressions to explain who the internal presentation and the basic block are, but nonetheless. <br><br>  If this post is read by a real compiler, he may <s>not even remove his read-out Dragonbook from the shelf,</s> point out errors and at the same time explain how to tell correctly. <br><br><h1>  Slides </h1><br>  To follow the course of the story is easy, the slides help in this.  If somewhere there is a lot of text or a big issue of the console utility, then interesting places are highlighted.  There are a lot of examples with the code, and they follow each other faster and faster in the course of the story, you get a little tired of this, but nothing critical.  A couple of things still want to attract attention. <br><br><h2>  <font color="blue">Laser pointer</font> </h2><br>  Those who have read the <a href="https://habrahabr.ru/company/jugru/blog/315864/"><u>previous analysis</u></a> already know everything about using a laser pointer.  Speech by Ruslan takes place in the same wide hall with two screens, as well as Sergey‚Äôs, and exactly the same time, the target designator is not visible at any one time about a third of the audience. <br><br>  In each case, the slide can be modified to make it immediately clear what is at stake.  For example, slide 13 (appears at 10:20) to cure is very simple: <br><br><img src="https://habrastorage.org/files/40a/903/fc8/40a903fc81e14aa9909bbfc2c4eebbf9.png"><br><br>  It is enough to show not the entire text at once, but to open the lines one by one as speech comes to them. <br><br><h2>  <font color="blue">Duplicate elements</font> </h2><br>  When watching a performance, I always wanted to do something with the quantitative results of experiments, which are found in the same format on many slides: <br><br><img src="https://habrastorage.org/files/362/a8a/975/362a8a97507c498889db13ec48c8070f.png"><br><br>  What is wrong with them? <br><br><ul><li>  It is a lot of dense text, it is difficult to read it, if you wanted to do so. </li><li>  An interesting moment comes not between the runes, but somewhere inside one, usually close to the beginning of the first.  Therefore, the results grouped by run (0.01 byte per iteration) look unusual, although it is easier to get them. </li><li>  Instant information about the outcome of the experiment, the viewer receives from the color.  This is normal, but it can create difficulties for people with a red-green color perception disorder (which, unfortunately, is the most common). </li></ul><br>  How to simplify it? <br><br>  Most indicative would be the graph, where the X-axis shows the call number (through for all the run'ov), and the Y-axis - the number of bytes allocated in the heap to this call.  In a bad case, the schedule is horizontal; in a good case, the first is how many (thousand) calls are horizontal, and then it drops to zero.  At the same time it would be clear from it how quickly the optimization is turned on, something like this: <br><br><img src="https://habrastorage.org/files/28a/f3d/3b7/28af3d3b7acf49eb996aca0ed0b6c2f7.png"><br><br>  In this form, it would be interesting to follow the dynamics of what is happening with the probability function (slides 98-91).  There, the schedule, most likely, should be some interesting: <br><br><img src="https://habrastorage.org/files/7c1/126/17e/7c112617eaf24989ba18d812071bf296.png"><br><br>  Perhaps, I do not understand something, and the data for such a schedule, even with stretch marks, cannot be obtained in principle.  Then you can try to greatly reduce the size of run'ov and build a graph on them. <br><br><h1>  Regular Parsing </h1><br>  If you want to get feedback on your performance, I‚Äôll be happy to give it to you. <br><br><div class="spoiler">  <b class="spoiler_title">What is needed for this?</b> <div class="spoiler_text"><ul><li>  Link to the video recording of the speech. </li><li>  Link to slides. </li><li>  Application from the author.  Without the consent of the speaker himself, we will not analyze anything. </li></ul><br>  All this needs to be sent to the habrauzer <a href="https://habrahabr.ru/users/p0b0rchy/" class="user_link">p0b0rchy</a> , that is, to me.  I promise that the review will be constructive and polite, as well as highlight the positive aspects, and not just what needs to be improved. </div></div></div><p>Source: <a href="https://habr.com/ru/post/317536/">https://habr.com/ru/post/317536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317524/index.html">Fast full text search in Redmine</a></li>
<li><a href="../317526/index.html">A person. John Backus - creator of the first high-level programming language</a></li>
<li><a href="../317528/index.html">Adaptive menu without javascript</a></li>
<li><a href="../317532/index.html">Early access to Google Play. What's inside?</a></li>
<li><a href="../317534/index.html">Console to the masses. Go to the bright side. Part one</a></li>
<li><a href="../317538/index.html">How to accidentally enter the top 15 IT projects for business</a></li>
<li><a href="../317544/index.html">How well to submit the results of qualitative research: the method of thematic networks (+ analysis of ATS as an example)</a></li>
<li><a href="../317546/index.html">Check-list for the preparation of high-quality presentation</a></li>
<li><a href="../317548/index.html">Wi-Fi on Linux will be faster</a></li>
<li><a href="../317550/index.html">Creating a blog engine with Phoenix and Elixir / Part 6. Markdown support</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>