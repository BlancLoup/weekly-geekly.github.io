<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of javascript applications based on Rx.js and React.js (RxReact)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="React.js allows you to work with DOM very efficiently and quickly, it is actively developing and is gaining more and more popularity every day. Recent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of javascript applications based on Rx.js and React.js (RxReact)</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/72f/ce8/cab/72fce8cabf664fd7af925bdc0811680a.png" alt="rxreactlogo"></div><br>  React.js allows you to work with DOM very efficiently and quickly, it is actively developing and is gaining more and more popularity every day.  Recently discovered the concept of reactive programming, in particular, the equally popular <a href="https://github.com/Reactive-Extensions/RxJS">Rx.js</a> library.  This library brings a new level of work with events and asynchronous code, which in UI logic, javascript applications abound.  The idea came to combine the power of these libraries into one whole and see what comes of it.  In this article, you'll learn how to make friends Rx.js and React.js. <br><a name="habracut"></a><br><br><h4>  Is RxReact a new library? </h4><br>  Maybe someone will be disappointed - but no.  One of the positive aspects of this approach is that you do not need to install any new libraries.  Therefore, I did not bother much and called this approach <b>RxReact</b> . <br>  For the impatient - <a href="https://github.com/AlexMost/RxReact">repos with test examples</a> . <br><br><h4>  What for? </h4><br>  Initially, when I first became acquainted with React, I was not at all embarrassed to stuff business components with logic, ajax requests, etc.  But as practice has shown, it is an extremely bad idea to interfere with all this inside React components by subscribing to various hooks, while maintaining the intermediate mutable state.  It becomes difficult to make changes and to understand such components - monsters.  React in my view is ideal only for drawing a specific state (snapshot) of an application at a certain point in time, but the logic of how and when this state changes is not at all his business and should be in another layer of abstraction.  The less the presentation layer knows about it, the calmer we sleep.  I wanted to bring React components as close as possible to the <b>pure</b> functions without a mutable, stored state, side effects, etc.  At the same time, I wanted to improve the work with events, it is desirable to put in a separate layer of logic a declarative description of how the application should interact with the user, respond to various events and change its state.  In addition, I wanted to be able to link chains of sequences of actions from synchronous and asynchronous operations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  No that's not exactly flux </h4><br>  An inquisitive reader who has read up to this point has already thought several times: ‚ÄúSo there is <a href="https://facebook.github.io/flux/">Flux</a> - take it and use it.‚Äù  I recently looked at him and, to my surprise, I found a lot of similarities with the concept I want to tell you about.  At the moment, I have already seen several implementations of <b>Flux</b> .  <b>RxReact</b> is not an exception, but in turn has a slightly different approach.  It so happened that he himself involuntarily came to almost the same architectural components as: <b>dispatcher</b> , <b>storage</b> , <b>actions</b> .  They are very similar to those described in the <b>Flux</b> architecture. <br><br><h4>  Main components </h4><br>  I hope that you managed to intrigue you with something and you have read this far, because here the most delicious begins.  For a more visual example, a test application will be considered: <br><img src="https://habrastorage.org/files/f52/18c/97c/f5218c97c2bc4e9ba98006e5d4d5e812.png" alt="demo"><br>  Demo site - <a href="http://alexmost.github.io/RxReact/hello_world/public/index.html">demo1</a> . <br>  The source is <a href="https://github.com/AlexMost/RxReact/tree/master/hello_world/hello_world">here</a> . <br><br>  The application itself does not do anything useful, just the click counter on the button. <br><br><h5>  View </h5><br>  The presentation layer is a React component, the main purpose of which is to draw the current state and signal events in the UI. <br><br>  <b>So, what should be able to view?</b> <br><ul><li>  draw ui </li><li>  to signal events in the UI </li></ul><br>  Below is the view code from the example ( <a href="https://github.com/AlexMost/RxReact/blob/master/hello_world/hello_world/view.coffee)">view.coffee</a> ): <br><pre><code class="coffeescript hljs">React = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> {div, button} = React.DOM HelloView = React.createClass getDefaultProps: <span class="hljs-function"><span class="hljs-function">-&gt;</span></span> clicksCount: <span class="hljs-number"><span class="hljs-number">0</span></span> incrementClickCount: <span class="hljs-function"><span class="hljs-function">-&gt;</span></span> @props.eventStream.onNext action: <span class="hljs-string"><span class="hljs-string">"increment_click_count"</span></span> render: <span class="hljs-function"><span class="hljs-function">-&gt;</span></span> div <span class="hljs-literal"><span class="hljs-literal">null</span></span>, div <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"You clicked </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{@props.clicksCount}</span></span></span><span class="hljs-string"> times"</span></span> button onClick: @incrementClickCount <span class="hljs-string"><span class="hljs-string">"Click"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = HelloView</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">javascript version of view.coffee file</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> React = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> div = React.DOM.div; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> button = React.DOM.button; HelloView = React.createClass({ <span class="hljs-attr"><span class="hljs-attr">getDefaultProps</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">clicksCount</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; }, <span class="hljs-attr"><span class="hljs-attr">incrementClickCount</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.eventStream.onNext({ <span class="hljs-attr"><span class="hljs-attr">action</span></span>: <span class="hljs-string"><span class="hljs-string">"increment_click_count"</span></span> }); }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> div(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, div(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"You clicked "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.clicksCount + <span class="hljs-string"><span class="hljs-string">" times"</span></span>), button({<span class="hljs-attr"><span class="hljs-attr">onClick</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.incrementClickCount}, <span class="hljs-string"><span class="hljs-string">"Click"</span></span>)); }}); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = HelloView;</code> </pre><br></div></div><br><br>  As you can see, all the data about clicks comes to us "from above" through the <b>props</b> object.  When you click on the button, we send the action through the <b>eventStream</b> channel.  View signals us about button clicks using <b>eventStream.onNext</b> , where eventStream is an instance of <a href="">Rx.Subject</a> .  Rx.Subject is a channel to which you can both send messages and create subscribers from it.  Further it will be described in more detail how to work with <b>Rx.Subject</b> . <br><br>  Once we have clearly defined the functions of the view and the channel of messages, they can be distinguished in the structural diagram: <br><img src="https://habrastorage.org/files/d74/d83/995/d74d8399532f43d39b958dca5c6ad2ee.png" alt="view_layer"><br>  As you can see, the view is a React component, receives the current state of the application (app state) as input, sends event messages via the event stream (actions).  In this scheme, the Event Stream is the communication channel between the view and the rest of the application (shown by a cloud).  Gradually, we will determine the specific functions of the components and make them out of the common js application block. <br><br><h5>  Storage (Model) </h5><br>  The next component is <b>Storage</b> .  Initially, I called it Model, but I always thought that model was not an appropriate name.  Since the model in my view is a certain specific entity (User, Product), and here we have a set of various data (many models, flags) with which our application works.  In the implementations of Flux, which we had to see, storage was implemented as a singleton module.  In my implementation there is no such need.  This gives the theoretical possibility of the smooth existence of several application instances on one page. <br><br>  <b>What can storage?</b> <br><ul><li>  store data </li><li>  change data </li><li>  return data </li></ul><br><br>  In my example, storage is implemented through the coffee class with some properties ( <a href="https://github.com/AlexMost/RxReact/blob/master/hello_world/hello_world/storage.coffee">storage.coffee</a> ): <br><pre> <code class="coffeescript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloStorage</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constructor</span></span></span><span class="hljs-class">: -&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clicksCount</span></span></span><span class="hljs-class"> = 0 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getClicksCount</span></span></span><span class="hljs-class">: -&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clicksCount</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">incrementClicksCount</span></span></span><span class="hljs-class">: -&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clicksCount</span></span></span><span class="hljs-class"> += 1 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">exports</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloStorage</span></span></span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">javascript storage.coffee version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> HelloStorage; HelloStorage = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clicksCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; } HelloStorage.prototype.getClicksCount = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clicksCount; }; HelloStorage.prototype.incrementClicksCount = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clicksCount += <span class="hljs-number"><span class="hljs-number">1</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HelloStorage; })(); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = HelloStorage;</code> </pre><br></div></div><br><br>  By itself, storage has no idea about the UI, that there is some kind of Rx and React.  The repository does what it should do by definition - store data (application state). <br><br>  On the structural scheme we can distinguish storage: <br><img src="https://habrastorage.org/files/2e9/6fb/cbc/2e96fbcbc3d04f38b69f9a72aa38687e.png" alt="storage layer"><br><br><h5>  Dispatcher </h5><br>  So, we have a view - the application draws at a certain point in time, storage - in which the current state is stored.  There is a lack of a binding component that will listen for events from the view, if necessary, change the state and give the command to update the view.  Such a component is just a <b>dispatcher</b> . <br><br>  <b>What should a dispatcher be able to do?</b> <br><ul><li>  respond to events from the view </li><li>  update data in storage </li><li>  initiate updates view </li></ul><br><br>  From the point of view of Rx.js, we can view the view as an endless source of certain events to which we can create subscribers.  In the demo example, we have only one subscriber in dispatcher, a subscriber for clicks on the increase values ‚Äã‚Äãbutton. <br><br>  Here‚Äôs what a subscription to clicks on a button in dispatcher‚Äôs code will look like: <br><pre> <code class="coffeescript hljs">incrementClickStream = eventStream.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({action})</span></span></span><span class="hljs-function"> -&gt;</span></span> action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-string"><span class="hljs-string">"increment_click_count"</span></span>)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">javascript version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> incrementClickStream = eventStream.filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> arg.action === <span class="hljs-string"><span class="hljs-string">"increment_click_count"</span></span>; });</code> </pre><br></div></div><br>  For a more complete understanding of the code above, you can visually portray as: <br><img src="https://habrastorage.org/files/590/8d1/5d0/5908d15d069044ea8a99308895337a47.png" alt="image"><br>  On the image we see 2 channels of messages.  The first is the eventStream (base channel) and the second, obtained from the base channel is incrementClickStream.  The circles represent the sequence of events in the channel, in each event an argument is passed by which we can filter (dispatch). <br><blockquote>  Let me remind you that messages to the channel are sent by the view using the call: <br><pre> <code class="coffeescript hljs">eventStream.onNext({action: <span class="hljs-string"><span class="hljs-string">"increment_click_count"</span></span>})</code> </pre> <br></blockquote><br>  The resulting incrementClickStream is an <b>Observable</b> instance and we can work with it the same way as with the eventStream, which we basically will do.  And then we must indicate that for each click on the button we want to increase the value in storage (change the state of the application). <br><br><pre> <code class="coffeescript hljs">incrementClickStream = eventStream.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({action})</span></span></span><span class="hljs-function"> -&gt;</span></span> action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-string"><span class="hljs-string">"increment_click_count"</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">do</span></span>(<span class="hljs-function"><span class="hljs-function">-&gt;</span></span> store.incrementClicksCount())</code> </pre><br><div class="spoiler">  <b class="spoiler_title">javascript version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> incrementClickStream = eventStream.filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> arg.action === <span class="hljs-string"><span class="hljs-string">"increment_click_count"</span></span>; }).do(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.incrementClicksCount(); });</code> </pre><br></div></div><br>  Schematically looks like this: <br><br><img src="https://habrastorage.org/files/6e5/026/15d/6e502615de2646a19db7b7fc68a170b9.png" alt="streamdo"><br><br>  This time we get the source of the values, which should update the view, as the state of the application changes (the number of clicks increases).  In order for this to happen, you need to subscribe to the source incrementClickStream and call setProps on the react component that renders the view. <br><br><pre> <code class="coffeescript hljs">incrementClickStream.subscribe(<span class="hljs-function"><span class="hljs-function">-&gt;</span></span> view.setProps {clicksCount: store.getClicksCount()})</code> </pre><br><div class="spoiler">  <b class="spoiler_title">javascript version</b> <div class="spoiler_text"><pre> <code class="javascript hljs">incrementClickStream.subscribe(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view.setProps({ <span class="hljs-attr"><span class="hljs-attr">clicksCount</span></span>: store.getClicksCount() }); });</code> </pre><br></div></div><br><br>  Thus, we close the chain and our view will be updated each time we click on the button.  There may be many such sources updating the view, so it is advisable to combine them into one event source using <a href="">Rx.Observable.merge</a> . <br><br><pre> <code class="coffeescript hljs">Rx.Observable.merge( incrementClickCountStream decrementClickCountStream anotherStream <span class="hljs-comment"><span class="hljs-comment"># etc) .subscribe( -&gt; view.setProps getViewState(store) -&gt; # error handling )</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">javascript version</b> <div class="spoiler_text"><pre> <code class="javascript hljs">Rx.Observable.merge( incrementClickCountStream, decrementClickCountStream, anotherStream) .subscribe( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view.setProps(getViewState(store)); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{}); <span class="hljs-comment"><span class="hljs-comment">// error handling</span></span></code> </pre><br></div></div><br><br>  In this code, the <b>getViewState</b> function appears.  This function only takes out the data necessary for view from storage and returns them.  In the demo example, it looks like this: <br><br><pre> <code class="coffeescript hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getViewState</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(store)</span></span></span><span class="hljs-function"> -&gt;</span></span> clicksCount: store.getClicksCount()</code> </pre><br><div class="spoiler">  <b class="spoiler_title">javascript version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getViewState = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">clicksCount</span></span>: store.getClicksCount() }; };</code> </pre><br></div></div><br><br>  Why not transfer storage directly to view?  Then, in order to avoid the temptation to write something directly from the view, call unnecessary methods, etc.  View gets the data prepared specifically for display in the visual part of the application, no more, no less. <br><br>  Schematically, Merzh sources look like this: <br><br><img src="https://habrastorage.org/files/e10/176/930/e101769301024b9a940f6e6598563daa.png" alt="stream_merge"><br><br>  It turns out, in addition to the fact that we do not need to call all sorts of "onUpdate" events from the model to update the view, we also have the ability to handle errors in one place.  The second argument to the subscribe is the function for error handling.  It works on the same principle as in Promise.  Rx.Observable has much in common with promises, but is a more advanced mechanism, since it considers not the only promised value, but an infinite sequence of return values ‚Äã‚Äãin time. <br><br>  The full dispatcher code looks like this: <br><br><pre> <code class="coffeescript hljs">Rx = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'rx'</span></span> getViewState = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(store)</span></span></span><span class="hljs-function"> -&gt;</span></span> clicksCount: store.getClicksCount() dispatchActions = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view, eventStream, storage)</span></span></span><span class="hljs-function"> -&gt;</span></span> incrementClickStream = eventStream <span class="hljs-comment"><span class="hljs-comment">#    .filter(({action}) -&gt; action is "increment_click_count") .do(-&gt; storage.incrementClicksCount()) Rx.Observable.merge( incrementClickStream #      view... ).subscribe( -&gt; view.setProps getViewState(storage) (err) -&gt; console.error? err) module.exports = dispatchActions</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">javascript version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Rx = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'rx'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getViewState = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">clicksCount</span></span>: store.getClicksCount() }; }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dispatchActions = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">view, eventStream, storage</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> incrementClickStream = eventStream.filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> arg.action === <span class="hljs-string"><span class="hljs-string">"increment_click_count"</span></span>;}) .do(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storage.incrementClicksCount(); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Rx.Observable.merge(incrementClickCountStream) .subscribe(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view.setProps(getViewState(storage)); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error === <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(err) : <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }); }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = dispatchActions;</code> </pre><br></div></div><br><br>  The full file code is <a href="https://github.com/AlexMost/RxReact/blob/master/hello_world/hello_world/dispatcher.coffee">dispatcher.coffee.</a> <br><br>  All <b>dispatching</b> logic is placed in the <b>dispatchActions</b> function, which takes as input: <br><br><ul><li>  <b>view</b> - React component instance </li><li>  <b>storage</b> - storage instance </li><li>  <b>eventStream</b> - message channel </li></ul><br><br>  Having placed the dispatcher on the scheme, we have a complete structural diagram of the application architecture: <br><br><img src="https://habrastorage.org/files/e7e/c88/73d/e7ec8873df034ed8ad308b1142719632.png" alt="image"><br><br><h5>  Component initialization </h5><br>  Next we need to somehow initialize: view, storage and dispatcher.  Let's do this in a separate file - <a href="https://github.com/AlexMost/RxReact/blob/master/hello_world/hello_world/app.coffee">app.coffe</a> : <br><pre> <code class="coffeescript hljs">Rx = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'rx'</span></span> React = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> HelloView = React.createFactory(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'./view'</span></span>) HelloStorage = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'./storage'</span></span> dispatchActions = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'./dispatcher'</span></span> initApp = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mountNode)</span></span></span><span class="hljs-function"> -&gt;</span></span> eventStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rx.Subject() <span class="hljs-comment"><span class="hljs-comment">#    store = new HelloStorage() # c  #    view view = React.render HelloView({eventStream}), mountNode #    dispatcher dispatchActions(view, eventStream, store) module.exports = initApp</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">javascript version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Rx = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'rx'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> React = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> HelloView = React.createFactory(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./view'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> HelloStorage = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./storage'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dispatchActions = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./dispatcher'</span></span>); initApp = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mountNode</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rx.Subject(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> store = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloStorage(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> view = React.render(HelloView({<span class="hljs-attr"><span class="hljs-attr">eventStream</span></span>: eventStream}), mountNode); dispatchActions(view, eventStream, store); }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = initApp;</code> </pre><br></div></div><br><br>  The initApp function accepts mountNode as input.  Mount Node, in this context, is a DOM element to which the root React component will be drawn. <br><br><h5>  The generator of the basic structure of the module RxRact (Yeoman) </h5><br>  To quickly create the above components in a new application, you can use <b>Yeoman</b> . <br>  Generator - <a href="https://github.com/AlexMost/generator-rxreact">generator-rxreact</a> <br><br><h4>  The example is more complicated </h4><br>  The example of one event source well demonstrates the principle of interaction of components, but does not at all demonstrate the advantage of using Rx in conjunction with React.  For example, let's imagine that on demand we need to improve the 1st example from demo like this: <br><br><ul><li>  ability to reduce the value </li><li>  save it to the server when it changes, but not more often than once a second, and only if it has changed </li><li>  show success message </li><li>  hide success message after 2 seconds </li></ul><br><br>  In the end, should get the following result: <br><img src="https://habrastorage.org/files/0ec/7b3/dd8/0ec7b3dd8cd347b9a7a9858f47b4752c.png" alt="demo2"><br><br>  Demo site - <a href="http://alexmost.github.io/RxReact/hello_world2/public/index.html">demo2</a> . <br>  The source code for demo2 is <a href="https://github.com/AlexMost/RxReact/tree/master/hello_world2/hello_world2">here</a> . <br><br>  I will not describe the changes in all components, I will show the most interesting thing - the changes in dispatcher and I will try to comment on what is happening in the file as thoroughly as possible: <br><br><pre> <code class="coffeescript hljs">Rx = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'rx'</span></span> {saveToDb} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'./transport'</span></span> <span class="hljs-comment"><span class="hljs-comment">#    (    ) getViewState = (store) -&gt; clicksCount: store.getClicksCount() showSavedMessage: store.getShowSavedMessage() #  view state      #     dispatchActions = (view, eventStream, store) -&gt; #  "+1"  incrementClickSource = eventStream .filter(({action}) -&gt; action is "increment_click_count") .do(-&gt; store.incrementClicksCount()) .share() #  "-1"  decrementClickSource = eventStream .filter(({action}) -&gt; action is "decrement_click_count") .do(-&gt; store.decrementClickscount()) .share() #       countClicks = Rx.Observable .merge(incrementClickSource, decrementClickSource) #   (-1, +1) showSavedMessageSource = countClicks .throttle(1000) #   1  .distinct(-&gt; store.getClicksCount()) #       .flatMap(-&gt; saveToDb store.getClicksCount()) #     .do(-&gt; store.enableSavedMessage()) #      #  ,        2  hideSavedMessage = showSavedMessageSource.delay(2000) .do(-&gt; store.disableSavedMessage()) #     ,    view Rx.Observable.merge( countClicks showSavedMessageSource hideSavedMessage ).subscribe( -&gt; view.setProps getViewState(store) (err) -&gt; console.error? err) module.exports = dispatchActions</span></span></code> </pre><br>  I hope that you, just like me, are impressed by the possibility of declaratively describing the operations performed in our application, while creating composable chains of calculations consisting of synchronous and asynchronous actions. <br>  On this I will finish the story.  Hopefully, I managed to convey the main essence of using the concept of reactive programming and React to build user applications. <br><br><h5>  Several links from the article </h5><br><ul><li>  <a href="https://github.com/AlexMost/RxReact">github repository with examples</a> </li><li>  <a href="http://alexmost.github.io/RxReact/hello_world/public/index.html">demo1</a> </li><li>  <a href="http://alexmost.github.io/RxReact/hello_world2/public/index.html">demo2</a> </li><li>  <a href="http://alexmost.github.io/RxReact/todo/public/index.html">TODO application implementation example</a> </li><li>  <a href="https://github.com/AlexMost/generator-rxreact">rxreact-generator</a> </li></ul><br><br>  <b>PS</b> All demos from the article use server side prerendering for React.js, for this purpose I created a special <b>gulp</b> plugin - <a href="https://github.com/AlexMost/gulp-react-render">gulp-react-render</a> . </div><p>Source: <a href="https://habr.com/ru/post/251835/">https://habr.com/ru/post/251835/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251823/index.html">The dangers of using open-uri</a></li>
<li><a href="../251827/index.html">MailChimp UX Team: How We Do Research [Part 3 of the book]</a></li>
<li><a href="../251829/index.html">Overview of the most interesting materials on data analysis and machine learning ‚Ññ37 (February 23 - March 1, 2015)</a></li>
<li><a href="../251831/index.html">Basic principles of system analysis in SEBoK</a></li>
<li><a href="../251833/index.html">PHPCI updated to version 1.6</a></li>
<li><a href="../251837/index.html">Smart home architecture - with Black Swift and not only</a></li>
<li><a href="../251839/index.html">A little about the important: 7 ways to "impregnate" the goal or how to set goals to achieve them</a></li>
<li><a href="../251841/index.html">We write a bot for MMORPG with assembler and draenei. Part 4.5</a></li>
<li><a href="../251845/index.html">(Video) HP Helion Presentation</a></li>
<li><a href="../251847/index.html">Yii 2.0.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>