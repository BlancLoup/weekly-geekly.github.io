<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WebRTC video chat development between iOS, Android and browser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, we described the principles of video chat development between a browser and an Android device. Now let's try to complicate th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WebRTC video chat development between iOS, Android and browser</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/57a/e36/91b/57ae3691b4204dbba9aa8810e014acbd.png"></div><br>  In the <a href="https://habrahabr.ru/company/flashphoner/blog/324914/">previous article,</a> we described the principles of video chat development between a browser and an Android device.  Now let's try to complicate the task and implement the three-way video chat on the following platforms: Google Chrome on the desktop, <b>Android application</b> on the tablet, and <b>iOS application</b> for the Apple iPhone. <br><a name="habracut"></a><br>  Recall the two basic principles of building video chat: <br><br><ol><li>  Each logged in user can send (publish) his video stream to the server. </li><li>  Users know the names of each other's video streams and have the ability to play them. </li></ol><br>  Thus, in the video chat of three participants, each of the participants will have to play two video streams. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/60d/c35/4d2/60dc354d2f2f42608d4c8ba81621c8b2.jpg"></div><br>  The sequence of nine actions is as shown below.  First, the participants publish their video streams, then play each other's streams. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Publish streams</b> <br><pre><code class="hljs css">1. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Alice</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_alice"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.publish</span></span>(); 2. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Boris</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_boris"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.publish</span></span>(); 3. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Anna</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_anna"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.publish</span></span>();</code> </pre> <br>  <b>Play streams</b> <br><pre> <code class="hljs css">4. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Alice</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_anna"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.play</span></span>(); 5. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Alice</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_boris"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.play</span></span>(); 6. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Boris</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_alice"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.play</span></span>(); 7. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Boris</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_anna"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.play</span></span>(); 8. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Anna</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_alice"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.play</span></span>(); 9. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Anna</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">session</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.createStream</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>:<span class="hljs-string"><span class="hljs-string">"stream_boris"</span></span>})<span class="hljs-selector-class"><span class="hljs-selector-class">.play</span></span>();</code> </pre><br><br>  The developer in this case is required to organize the transfer of the <b>names and status of</b> video streams to video chat participants.  This can be done on any suitable technology, such as PHP, websockets, Node.js, etc., since the transfer of the name of the video stream is no different from the transfer of a plain text message from one user to another. <br><br>  A stream can have three basic statuses: <b>PUBLISHING</b> , <b>PLAYING</b> , <b>STOPPED</b> <br><br>  For successful playback, the requested stream must be in the active <b>PUBLISHING</b> status. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/114/611/109/1146111096154aef95808a40cb255e19.jpg"></div><br>  This diagram shows how it is possible to implement the exchange of names and status of streams, in a simplified version, when Alice shows her video stream to Boris and Anna.  This procedure takes <b>8 steps</b> , and can be called a <b>signaling</b> , because  As a result of this procedure, coordination is carried out: <br><br><ol><li>  Alice sends a video stream to the WCS server. </li><li>  Alice receives confirmation from the server in the form of PUBLISHING status </li><li>  Alice sends Boris a message saying that her stream is ready for reproduction. </li><li>  Alice sends Anna a message stating that her stream is ready to play. </li><li>  Anna plays the video stream from the WCS server. </li><li>  Anna receives confirmation of the status of PLAYING. </li><li>  Boris plays the video stream from the WCS server. </li><li>  Boris receives confirmation of the status of PLAYING. </li></ol><br>  As a result, an arbitrary interaction scenario can be implemented: with the connection of two or more users to the chat, with the connection of just the viewers, etc. <br><br><h2>  Rooms </h2><br>  Organizing the exchange of names of video streams and their status is not so difficult technically, but it requires some labor and work with the code. <br><br>  On the other hand, for such a problem, some kind of universal solution suggests itself that could help users quickly reconcile the flows and get into the chat.  This solution is called <b>Room</b> or <b>Room API</b> . <br><br>  Indeed, if two or more users interact in the same context, then this is like a room.  Inside the room, users see video streams of each other, they know who is in the room and can exchange messages, including private ones. <br><br>  Thus, we have four objects that fully cover the work with the rooms: <br><br><ul><li>  Room - room </li><li>  Stream - video stream </li><li>  Participant - participant </li><li>  Message - the message </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ac0/a01/728/ac0a017285d64b3aadae45027e8242eb.jpg"></div><br><br>  <b>The Room API</b> allows you to cross-platform use the abstractions listed above: <b>Room</b> , <b>Stream</b> , <b>Participant,</b> and <b>Message</b> to implement the following functions: <br><br><h3>  Connection </h3><br><ul><li>  User can connect to the room. </li><li>  The user sets the name of the room when connecting. </li><li>  If a room with this name exists, the user enters this room. </li><li>  If there is no room with such a name, then a new room is created and the user enters the newly created room. </li><li>  The user receives notifications about the connections / disconnections of other participants. </li><li>  The user can get a list of participants. </li></ul><br><h3>  Streaming </h3><br><ul><li>  The user can publish a video stream inside the room. </li><li>  The user receives notifications about the status of video streams of other participants. </li><li>  The user can play the video stream inside the room. </li></ul><br><h3>  Messages </h3><br><ul><li>  Users can chat inside the room. </li><li>  Users can share images or other content if it is packaged in text format. </li><li>  A message can be sent to one or more participants. </li></ul><br><h2>  Room API </h2><br>  For the Web platform, the rooms were implemented as a <b>JavaScript module</b> with the following main functions: <br><br>  1. Get a connection to the server. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connection = Flashphoner.roomApi.connect({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>: <span class="hljs-string"><span class="hljs-string">"wss://host:8443"</span></span>, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-string"><span class="hljs-string">"Alice"</span></span>});</code> </pre> <br>  2. Enter the room. <br><br><pre> <code class="javascript hljs">connection.join({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"room1"</span></span>});</code> </pre> <br>  3. Get a list of room members. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> participants = room.getParticipants();</code> </pre> <br>  4. Send your video stream to the room. <br><br><pre> <code class="javascript hljs">room.publish({ <span class="hljs-attr"><span class="hljs-attr">display</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"localDisplay"</span></span>), <span class="hljs-attr"><span class="hljs-attr">constraints</span></span>: constraints, <span class="hljs-attr"><span class="hljs-attr">record</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">receiveVideo</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">receiveAudio</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> });</code> </pre> <br>  5. Reproduce the stream member. <br><br><pre> <code class="javascript hljs">participant.getStreams()[<span class="hljs-number"><span class="hljs-number">0</span></span>].play(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(pDisplay))</code> </pre> <br>  6. We follow the participants of the room: <br><br><pre> <code class="javascript hljs">connection.on(ROOM_EVENT.JOINED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">participant</span></span></span><span class="hljs-function">)</span></span>{...}); connection.on(ROOM_EVENT.LEFT, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">participant</span></span></span><span class="hljs-function">)</span></span>{...}); connection.on(ROOM_EVENT.PUBLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">participant</span></span></span><span class="hljs-function">)</span></span>{...});</code> </pre> <br>  JOINED - a new member joined the room. <br>  LEFT - member out <br>  PUBLISHED - Member has posted its video stream. <br><br>  7. Receive messages from other participants. <br><br><pre> <code class="javascript hljs">connection.on(ROOM_EVENT.MESSAGE, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">participant</span></span></span><span class="hljs-function">)</span></span>{...});</code> </pre> <br>  8. We send a private message to a specific participant. <br><br><pre> <code class="javascript hljs">participants[i].sendMessage(message);</code> </pre> <br>  9. Send a message to all participants immediately. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> participants = room.getParticipants(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; participants.length; i++) { participants[i].sendMessage(message); } }</code> </pre> <br>  Thus, the implementation of the rooms gives a simple exchange of messages and the status of all participants connected to the room. <br><br><h2>  Room API Restrictions </h2><br>  All the logic when working with rooms falls on the client.  The server controls only the basic functionality of the room: <br><br><ul><li>  notifications about connecting / disconnecting users in the room </li><li>  notifications about creating / disabling video streams by users inside the room </li><li>  message routing to specified members </li></ul><br>  Thus, authentication, access rights, the roles of the participants (moderator, viewer, presenter), and other logic should be implemented on the client and / or third-party back end.  The rooms only help to quickly exchange information about video streams and statuses. <br><br><h2>  Rooms for Web, Android, iOS </h2><br>  In each of the SDK (Web, Android, iOS) to work with the server, there is an API for working with rooms. <br>  Examples of entering the room: <br><br>  <b>Web SDK</b> <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">connection</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.join</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">name</span></span>: <span class="hljs-string"><span class="hljs-string">"room1"</span></span>});</code> </pre> <br>  <b>Android SDK</b> <br><br><pre> <code class="java hljs">Room room = roomManager.join(roomOptions);</code> </pre> <br>  <b>iOS SDK</b> <br><br><pre> <code class="hljs pgsql">room = [roomManager <span class="hljs-keyword"><span class="hljs-keyword">join</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">options</span></span>];</code> </pre> <br>  Thus, three participants from three different platforms can enter the same room: <br><br><ul><li>  Web browser </li><li>  Mobile application for Android </li><li>  IOS Mobile App </li></ul><br><h2>  Test applications for working with rooms </h2><br>  Below we give three test applications for working with rooms.  Each of them is open source and can be compiled from sources. <br><br>  Each of the following applications allows you to exchange video streams and messages to three participants: <br><br><ul><li>  Conference for Web </li><li>  Conference for Android </li><li>  Conference for iOS </li></ul><br><h3>  Conference for Web </h3><br>  The code for this application is available for download <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/conference">here</a> . <br><br>  In the HTML code you can find two div elements. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"participant1Display"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"participant2Display"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  These items are responsible for displaying video of participants. <br><br>  The div element <b>localDisplay</b> is responsible for displaying the video captured from the camera. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localDisplay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fp-localVideo"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Using the <b>Join / Leave</b> buttons you can enter and exit the room, respectively.  Using <b>Stop / Start,</b> you can send a video to a room or stop broadcasting.  <b>Login</b> field must be unique, because  identifies the participant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/76b/79f/ba8/76b79fba8b574b4fb92fb9492fdd657c.jpg"></div><br>  The next interface element is text chat.  This chat displays messages received or sent by other users, and also displays information about events occurring in the room. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/056/781/d42/056781d4247b40d39c86283ada7afcdf.jpg"></div><br>  And the last element is the link to the invitation.  If the user is logged in first, a new room is created.  In this case, named roomName = room-fb41b7.  If the second user specifies the same roomName, he will fall into the same room.  In the <b>Conference for Web</b> application, invitations are implemented by generating an input link containing a roomName as a parameter.  In versions of the application for Android and iOS, the name of the room is indicated directly in the interface. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9a3/2dd/ef3/9a32ddef317b44ae811938fe2718c90d.png"></div><br>  Thus, the <b>Conference for Web</b> test application implements all the functions of the rooms incorporated above and allows several users to connect to the same room and exchange video streams and text messages. <br><br>  The screenshot below shows how the room with three participants works.  Three tabs of the Google Chrome browser were opened and a connection to the room was initiated on each tab. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/26c/f66/5ba/26cf665baedc401ca966e3df71144a90.png"></div><br><h3>  Conference for Android </h3><br>  The code for this application is available for download <a href="https://github.com/flashphoner/wcs-android-sdk-samples/tree/master/conference">here</a> . <br><br>  In the application, you can enter the name of the room directly from the UI.  The rest of the application is very similar to <b>Conference for Web</b> , which was described above and has the same interface elements: <br><br><ul><li>  Leave / Join buttons for entering and exiting the room. </li><li>  Two video windows for playing video participants. </li><li>  One video window to display the capture video from the camera. </li><li>  Text chat with system information and member messages </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/481/728/096/4817280966fc47eea014790a1bf4c026.jpg"></div><br><h3>  Conference for iOS </h3><br>  The application code is available for download <a href="http://ttps//github.com/flashphoner/wcs-ios-sdk-samples/tree/master/WCSExample/Conference">here</a> . <br><br>  The interface of the application for iOS is practically no different from the application for Android, up to the name of the buttons and controls. <br><br>  As a result, we did a test and collected all three platforms in the same room with the number 3119d6. <br><br>  <b>The Google Chrome browser</b> is a hare that is selected from the hole: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3ee/e89/353/3eee89353e504c84a7a69cdac62daf36.png"></div><br>  <b>Android 5.1.1 on the Asus tablet</b> is a flower pot. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/aab/774/251/aab77425163e41a8bf42cf40351afad8.png"></div><br>  <b>iOS 10.1.1 on iPhone 6</b> is Ficus Benjamin on the windowsill. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a8d/1df/bf7/a8d1dfbf7bf1470597f3773664c54691.png"></div><br>  Below is a full screenshot of the iOS device: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/38d/c02/28e/38dc0228e2e14460be6590bd8486f869.png"></div><br>  Thus, we have completed testing and review of all three applications built on the basis of the Room API, and can proceed to the source code and build. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/80b/37c/892/80b37c892d2948289dc0a1a112d75430.png"></div><br><h2>  Building the Conference for iOS application from source </h2><br>  In the <a href="https://habrahabr.ru/company/flashphoner/blog/324914/">previous article,</a> we showed how to build an example of video chat for android and explain how the video chat code is arranged in the browser. <br><br>  Here we show how to build the <b>Conference for iOS</b> example and describe the main pieces of the example code. <br><br>  The first thing you need to get Mac-hardware and install the latest <b>Xcode</b> . <br><br>  The build procedure requires installing <a href="https://cocoapods.org/">Cocoapods</a> , downloading the sample code and the SDK for iOS.  We will collect in the terminal, and then we will open the project in Xcode. <br><br>  1. Install Cocoapods <br><br><pre> <code class="bash hljs">sudo gem install cocoapods</code> </pre> <br>  2. Download all the examples from github <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/flashphoner/wcs-ios-sdk-samples.git</code> </pre> <br>  3. Download iOS SDK <br><br><pre> <code class="bash hljs">wget https://flashphoner.com/downloads/builds/flashphoner_client/wcs-ios-sdk/WCS-iOS-SDK-2.3.0.tar.gz</code> </pre> <br>  4. Unpack the archive <br><br><pre> <code class="bash hljs">tar -xvzf WCS-iOS-SDK-2.3.0.tar.gz</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/af9/b76/a9c/af9b76a9c1c5441dac8ec70f58b29f27.png"></div><br>  5. Copy the folder <b>FPWCSApi2.framework</b> into examples <br><br><pre> <code class="bash hljs">cp -R FPWCSApi2.framework wcs-ios-sdk-samples</code> </pre> <br>  6. Run the assembly. <br><br><pre> <code class="bash hljs">./build_example.sh</code> </pre> <br>  If the build is successful, <b>** ARCHIVE SUCCEDED **</b> is output in the terminal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ed3/b0a/604/ed3b0a6040a641c5a550df5bbc89a0f4.png"></div><br>  After the examples are collected from the console using <b>Cocoapods</b> , all dependencies are pulled and configured and further examples can be built directly from <b>Xcode</b> . <br><br>  7. Open <b>WCSExample.xcworkspace</b> in Xcode <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a83/edf/ba9/a83edfba9c7b45b895ebaf5f412bca99.png"></div><br>  8. Select Generic iOS Device for assembly purposes.  Launch the assembly of the Conference example from the <b>Product / Build</b> menu and wait for completion. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2de/3fa/e88/2de3fae888c64dc58030d3dd33f8574b.png"></div><br>  9. Connect the iPhone via USB and run the assembled <b>Conference</b> application.  Debug information appears in the console. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/840/7e3/075/8407e3075f1346289197570b1589157c.png"></div><br>  10. The Conference application appears on the iPhone. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bcc/196/f1e/bcc196f1edf24ae9999f550d3fb7fb66.png"></div><br>  Thus, we compiled the Conference mobile app for iOS from source and used the iOS SDK version 2.3.0 + Cocoapods for this build.  As a result, we were able to run this application on an iPhone 6 connected via USB to the Mac on which this assembly was made. <br><br><h2>  Code for Web, Android, iOS video chat </h2><br>  Above, we gave examples of applications for three platforms that use the Room API and exchange video streams inside the created room.  We will try to briefly list the main pieces of code responsible for the work of the video chat in each of these three platforms: <br><table><tbody><tr><td></td><td>  <b>Web</b> </td><td>  <b>Android</b> </td><td>  <b>iOS</b> </td></tr><tr><td>  Code </td><td>  <b>Javascript</b> </td><td>  <b>Java</b> </td><td>  <b>Objective c</b> </td></tr><tr><td>  Main code </td><td>  <a href="">conference.js</a> </td><td>  <a href="">ConferenceActivity.java</a> </td><td>  <a href="">ViewController.m</a> </td></tr><tr><td>  Connect to server </td><td><pre> <code class="javascript hljs">connection = Flashphoner.roomApi.connect({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>: url, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: username});</code> </pre> </td><td><pre> <code class="java hljs">roomManager = Flashphoner.createRoomManager(roomManagerOptions);</code> </pre> </td><td><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">roomManager</span></span> = [FPWCSApi2 createRoomManager:options <span class="hljs-literal"><span class="hljs-literal">error</span></span>:&amp;<span class="hljs-literal"><span class="hljs-literal">error</span></span>];</code> </pre> </td></tr><tr><td>  Connection to the room </td><td><pre> <code class="javascript hljs">connection.join({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: getRoomName()});</code> </pre> </td><td><pre> <code class="java hljs">room = roomManager.join(roomOptions);</code> </pre> </td><td><pre> <code class="hljs pgsql">room = [roomManager <span class="hljs-keyword"><span class="hljs-keyword">join</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">options</span></span>];</code> </pre> </td></tr><tr><td>  Getting the list of participants </td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> participants = room.getParticipants();</code> </pre> </td><td><pre> <code class="java hljs">room.getParticipants()</code> </pre> </td><td><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *participants = [room getParticipants];</code> </pre> </td></tr><tr><td>  Sending a video stream to the room </td><td><pre> <code class="javascript hljs">room.publish({ <span class="hljs-attr"><span class="hljs-attr">display</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"localDisplay"</span></span>), <span class="hljs-attr"><span class="hljs-attr">constraints</span></span>: constraints, <span class="hljs-attr"><span class="hljs-attr">record</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">receiveVideo</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">receiveAudio</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> });</code> </pre> </td><td><pre> <code class="java hljs">stream = room.publish(localRenderer);</code> </pre> </td><td><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">publishStream</span></span> = [room publish:_localDisplay];</code> </pre> </td></tr><tr><td>  Play the video stream of the participant </td><td><pre> <code class="javascript hljs">participant.getStreams()[<span class="hljs-number"><span class="hljs-number">0</span></span>].play(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(pDisplay));</code> </pre> </td><td><pre> <code class="java hljs">participant.play(participantView.surfaceViewRenderer);</code> </pre> </td><td><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">participant play:pv.display</span></span>];</code> </pre> </td></tr><tr><td>  We track the accession of new members to the room </td><td><pre> <code class="javascript hljs">connection.on(ROOM_EVENT.JOINED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">participant</span></span></span><span class="hljs-function">)</span></span>{...});</code> </pre> </td><td><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onJoined</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Participant participant)</span></span></span></span>{...};</code> </pre> </td><td><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">room on:kFPWCSRoomParticipantEventJoined participantCallback:^(FPWCSApi2Room *room, FPWCSApi2RoomParticipant *participant){...}</span></span>]</code> </pre> </td></tr><tr><td>  We trace members leaving the room </td><td><pre> <code class="javascript hljs">connection.on(ROOM_EVENT.LEFT, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">participant</span></span></span><span class="hljs-function">)</span></span>{...});</code> </pre> </td><td><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Participant participant)</span></span></span></span>{...}</code> </pre> </td><td><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">room on:kFPWCSRoomParticipantEventLeft participantCallback:^(FPWCSApi2Room *room, FPWCSApi2RoomParticipant *participant){...}</span></span>]</code> </pre> </td></tr><tr><td>  We trace the publication of a video stream by the participant of the room </td><td><pre> <code class="javascript hljs">connection.on(ROOM_EVENT.PUBLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">participant</span></span></span><span class="hljs-function">)</span></span>{...});</code> </pre> </td><td><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPublished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Participant participant)</span></span></span></span>{...}</code> </pre> </td><td><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">room on:kFPWCSRoomParticipantEventPublished participantCallback:^(FPWCSApi2Room *room, FPWCSApi2RoomParticipant *participant){...}</span></span>]</code> </pre> </td></tr><tr><td>  We receive an incoming message from other participants </td><td><pre> <code class="javascript hljs">connection.on(ROOM_EVENT.MESSAGE, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">participant</span></span></span><span class="hljs-function">)</span></span>{...});</code> </pre> </td><td><pre> <code class="javascript hljs">public <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> onMessage(final Message message){...}</code> </pre> </td><td><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">room onMessageCallback:^(FPWCSApi2Room *room, FPWCSApi2RoomMessage *message){...}</span></span>]</code> </pre> </td></tr><tr><td>  Send a message to one of the participants </td><td><pre> <code class="javascript hljs">participants[i].sendMessage(message);</code> </pre> </td><td><pre> <code class="java hljs">participant.sendMessage(text);</code> </pre> </td><td><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">participant sendMessage:_messageBody.text</span></span>];</code> </pre> </td></tr></tbody></table><br>  Total we get 10 basic designs for each of the platforms.  Each of the listed constructions can be found in the corresponding file with the code. <br><br>  All three Web, iOS and Android applications were tested with the latest build of <b>Web Call Server 5</b> - video chat servers and low-latency broadcasts with support for WebRTC technology. <br><br><h2>  Links </h2><br>  <a href="https://flashphoner.com/">Web Call Server</a> - server for WebRTC video chat <br>  <a href="https://aws.amazon.com/marketplace/pp/B01D1L5EAK">EC2 launch</a> - launch a finished image on Amazon EC2 <br>  <a href="https://flashphoner.com/download/">Install</a> - install server on VPS or Dedicated host <br>  <a href="https://cocoapods.org/">Cocoapods</a> - dependency manager for build <br><br><table><tbody><tr><td></td><td>  <b>Web SDK</b> </td><td>  <b>Android SDK</b> </td><td>  <b>iOS SDK</b> </td></tr><tr><td>  Sdk </td><td>  <a href="https://flashphoner.com/wcs-web-sdk">html</a> </td><td>  <a href="https://flashphoner.com/wcs-android-sdk">html</a> </td><td>  <a href="https://flashphoner.com/wcs-ios-sdk">html</a> </td></tr><tr><td>  Download SDK </td><td>  <a href="">tar.gz</a> </td><td>  <a href="">aar</a> </td><td>  <a href="">tar.gz</a> </td></tr><tr><td>  Sample Chat Room Application </td><td>  <a href="https://wcs5-eu.flashphoner.com/demo2/conference">WCS demo</a> </td><td>  <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.flashphoner.wcsexample.conference">Google play</a> </td><td>  Ad hoc only </td></tr><tr><td>  The main sample code file </td><td>  <a href="">Conference.js</a> </td><td>  <a href="">ConferenceActivity.java</a> </td><td>  <a href="">ViewController.m</a> </td></tr><tr><td>  Source code of all examples </td><td>  <a href="">github</a> </td><td>  <a href="https://github.com/flashphoner/wcs-android-sdk-samples">github</a> </td><td>  <a href="https://github.com/flashphoner/wcs-ios-sdk-samples">github</a> </td></tr><tr><td>  Description of the procedure for assembling examples from source code </td><td>  <a href="https://flashphoner.com/docs/wcs5/wcs_docs/html/ru/wcs-developer-guide-2/index.html%3Fquick_start_web_sdk.htm">html</a> </td><td>  <a href="https://flashphoner.com/docs/wcs5/wcs_docs/html/ru/wcs-developer-guide-2/index.html%3Fquick_start_android_sdk.htm">html</a> </td><td>  <a href="https://flashphoner.com/docs/wcs5/wcs_docs/html/ru/wcs-developer-guide-2/index.html%3Fquick_start_ios_sdk.htm">html</a> </td></tr><tr><td>  Description of the code of the Conference rooms example </td><td>  <a href="https://flashphoner.com/docs/wcs5/wcs_docs/html/ru/wcs-developer-guide-2/index.html%3Fvideo_conference_web_sdk.htm">html</a> </td><td>  <a href="https://flashphoner.com/docs/wcs5/wcs_docs/html/ru/wcs-developer-guide-2/index.html%3Fvideo_conference_android_sdk.htm">html</a> </td><td></td></tr></tbody></table></div><p>Source: <a href="https://habr.com/ru/post/325444/">https://habr.com/ru/post/325444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325434/index.html">How I create a database for my applications</a></li>
<li><a href="../325436/index.html">How we did secure telephony for Wheely, a world-wide personal driver service.</a></li>
<li><a href="../325438/index.html">Continuous delivery with Travis CI and Ansible</a></li>
<li><a href="../325440/index.html">The digest of interesting materials for the mobile # 197 developer (March 27 - April 2)</a></li>
<li><a href="../325442/index.html">‚ÄúGood external restrictions are the basis for creativity‚Äù: Oleg Chirukhin on Sberbank Technologies, Java and Novosibirsk</a></li>
<li><a href="../325446/index.html">Scala: parser combinators on the example of the formula parser</a></li>
<li><a href="../325448/index.html">The holy family of information technology (April theses in the form of critical criticism)</a></li>
<li><a href="../325450/index.html">We set up a free build for writing and debugging programs for microcontrollers based on the ARM kernel under Windows 10</a></li>
<li><a href="../325452/index.html">PHP: Storing sessions in protected cookies</a></li>
<li><a href="../325454/index.html">Go application development: logic reuse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>