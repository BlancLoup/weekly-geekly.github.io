<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Animation and Canvas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My hands got to the Canvas. I looked at it for a long time, I really liked it as a tool for charts. And week Canvas on Habr√© has supported interest. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Animation and Canvas</h1><div class="post__text post__text-html js-mediator-article">  My hands got to the Canvas.  I looked at it for a long time, I really liked it as a tool for charts.  And week Canvas on Habr√© has supported interest. <br><br>  But instead of boring graphs, I began to dig in the direction of animation.  It turned out that we draw the scene every time in a new way, respectively, all the information about current frames is stored in JS.  And I decided to try to create a simple algorithm that would allow to store animations for the object, their state and choice by the user. <br><a name="habracut"></a><br><h4>  Canvas </h4><br>  Everything is simple and standard. <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;!</font> <font color="#800000">DOCTYPE</font> <font color="#ff0000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> Animation test <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="Content-Type"</font> <font color="#ff0000">content</font> <font color="#0000ff">="text/html; charset=UTF-8"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">canvas</font> <font color="#ff0000">id</font> <font color="#0000ff">="cnv"</font> <font color="#ff0000">width</font> <font color="#0000ff">="600"</font> <font color="#ff0000">height</font> <font color="#0000ff">="200"</font> <font color="#0000ff">&gt;</font> It's not working! <font color="#0000ff">&lt;/</font> <font color="#800000">canvas</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">select</font> <font color="#ff0000">id</font> <font color="#0000ff">="animations"</font> <font color="#ff0000">name</font> <font color="#0000ff">="animations"</font> <font color="#ff0000">onchange</font> <font color="#0000ff">="changeAnimation(this.value)"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="stop"</font> <font color="#0000ff">&gt;</font> Stop <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="jump"</font> <font color="#0000ff">&gt;</font> Jump <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="bum"</font> <font color="#0000ff">&gt;</font> Bum <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="dead"</font> <font color="#0000ff">&gt;</font> Dead <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">select</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;!</font> <font color="#800000">DOCTYPE</font> <font color="#ff0000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> Animation test <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="Content-Type"</font> <font color="#ff0000">content</font> <font color="#0000ff">="text/html; charset=UTF-8"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">canvas</font> <font color="#ff0000">id</font> <font color="#0000ff">="cnv"</font> <font color="#ff0000">width</font> <font color="#0000ff">="600"</font> <font color="#ff0000">height</font> <font color="#0000ff">="200"</font> <font color="#0000ff">&gt;</font> It's not working! <font color="#0000ff">&lt;/</font> <font color="#800000">canvas</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">select</font> <font color="#ff0000">id</font> <font color="#0000ff">="animations"</font> <font color="#ff0000">name</font> <font color="#0000ff">="animations"</font> <font color="#ff0000">onchange</font> <font color="#0000ff">="changeAnimation(this.value)"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="stop"</font> <font color="#0000ff">&gt;</font> Stop <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="jump"</font> <font color="#0000ff">&gt;</font> Jump <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="bum"</font> <font color="#0000ff">&gt;</font> Bum <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="dead"</font> <font color="#0000ff">&gt;</font> Dead <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">select</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;!</font> <font color="#800000">DOCTYPE</font> <font color="#ff0000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> Animation test <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="Content-Type"</font> <font color="#ff0000">content</font> <font color="#0000ff">="text/html; charset=UTF-8"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">canvas</font> <font color="#ff0000">id</font> <font color="#0000ff">="cnv"</font> <font color="#ff0000">width</font> <font color="#0000ff">="600"</font> <font color="#ff0000">height</font> <font color="#0000ff">="200"</font> <font color="#0000ff">&gt;</font> It's not working! <font color="#0000ff">&lt;/</font> <font color="#800000">canvas</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">select</font> <font color="#ff0000">id</font> <font color="#0000ff">="animations"</font> <font color="#ff0000">name</font> <font color="#0000ff">="animations"</font> <font color="#ff0000">onchange</font> <font color="#0000ff">="changeAnimation(this.value)"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="stop"</font> <font color="#0000ff">&gt;</font> Stop <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="jump"</font> <font color="#0000ff">&gt;</font> Jump <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="bum"</font> <font color="#0000ff">&gt;</font> Bum <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">option</font> <font color="#ff0000">value</font> <font color="#0000ff">="dead"</font> <font color="#0000ff">&gt;</font> Dead <font color="#0000ff">&lt;/</font> <font color="#800000">option</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">select</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br>  A Select has been added under the canvas with a list of animations for the object.  I will have one object, although the algorithm does not imply any restrictions. <br><br><h5>  Global variables </h5><br>  We now turn to JS.  Here I will need some variables for storing scene objects and possible animations. <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//   </font> <br> <font color="#0000ff">function</font> $(id) { <br> <font color="#0000ff">return</font> <font color="#0000ff">document</font> .getElementById(id); <br> } <br> <br> <font color="#0000ff">var</font> tx     = $( <font color="#A31515">'cnv'</font> ).getContext( <font color="#A31515">'2d'</font> ); <font color="#008000">// </font> <br> <font color="#0000ff">var</font> childs  = {}; <font color="#008000">//  </font> <br> <font color="#0000ff">var</font> animate = {};                        //   </font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//   </font> <br> <font color="#0000ff">function</font> $(id) { <br> <font color="#0000ff">return</font> <font color="#0000ff">document</font> .getElementById(id); <br> } <br> <br> <font color="#0000ff">var</font> tx     = $( <font color="#A31515">'cnv'</font> ).getContext( <font color="#A31515">'2d'</font> ); <font color="#008000">// </font> <br> <font color="#0000ff">var</font> childs  = {}; <font color="#008000">//  </font> <br> <font color="#0000ff">var</font> animate = {};                        //   </font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//   </font> <br> <font color="#0000ff">function</font> $(id) { <br> <font color="#0000ff">return</font> <font color="#0000ff">document</font> .getElementById(id); <br> } <br> <br> <font color="#0000ff">var</font> tx     = $( <font color="#A31515">'cnv'</font> ).getContext( <font color="#A31515">'2d'</font> ); <font color="#008000">// </font> <br> <font color="#0000ff">var</font> childs  = {}; <font color="#008000">//  </font> <br> <font color="#0000ff">var</font> animate = {};                        //   </font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All objects in the scene with basic parameters will be stored in childs.  We will go over the array and draw one by one. <br>  In animate store for the object of its animation.  Here you can do it differently, for example, in animate, we store animations only for objects that need them, and for others, we store information on drawing in the childs array itself.  In my version, each object must have at least one animation if it wants to be displayed on the canvas. <br><br><h5>  Fill arrays </h5><br>  First add our object.  I did not write the parameters, because  I think that for the sake of brevity of the code you can go for this, and the names are all intuitive. <br><br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> initAnimation() { <br> <br> <font color="#008000">// </font> <br> childs[ <font color="#A31515">'ball'</font> ] = { <br> <font color="#A31515">'at'</font> : <font color="#A31515">'jump'</font> , <font color="#008000">// </font> <br> <font color="#A31515">'w'</font> : 30, <font color="#008000">// </font> <br> <font color="#A31515">'h'</font> : 30, <font color="#008000">// </font> <br> <font color="#A31515">'fw'</font> : 30, <font color="#008000">//  </font> <br> <font color="#A31515">'x'</font> : 100, <font color="#008000">//  </font> <br> <font color="#A31515">'y'</font> : 100 <font color="#008000">//  </font> <br> } <br> <br> <font color="#008000">//     </font> <br> animate[ <font color="#A31515">'ball'</font> ] = { <br> <font color="#A31515">'jump'</font> : { <font color="#008000">//   </font> <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <font color="#008000">// Image</font> <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball.png'</font> , <font color="#008000">//  </font> <br> <font color="#A31515">'step'</font> : 0, <font color="#008000">//  </font> <br> <font color="#A31515">'speed'</font> : 3, <font color="#008000">// </font> <br> <font color="#A31515">'curr'</font> : 0, <font color="#008000">// </font> <br> <font color="#A31515">'steps'</font> : 3, <font color="#008000">//  ,   0</font> <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <font color="#008000">//     </font> <br> }, <br> <font color="#A31515">'bum'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_m.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 3, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 7, <br> <font color="#A31515">'onend'</font> : <font color="#A31515">'onBumEnd'</font> <br> }, <br> <font color="#A31515">'stop'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_s.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 10, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 0, <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <br> }, <br> <font color="#A31515">'dead'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_d.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 10, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 0, <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <br> } <br> } <br> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> o <font color="#0000ff">in</font> childs) { <br> <br> <font color="#008000">//    </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> a <font color="#0000ff">in</font> animate[o]) { <br> <br> <font color="#008000">// </font> <br> <font color="#0000ff">var</font> img = <font color="#0000ff">new</font> Image(); <br> img.src = animate[o][a].src; <br> <font color="#008000">//    </font> <br> animate[o][a].el = img; <br> <br> } <br> <br> } <br> <br> }</font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> initAnimation() { <br> <br> <font color="#008000">// </font> <br> childs[ <font color="#A31515">'ball'</font> ] = { <br> <font color="#A31515">'at'</font> : <font color="#A31515">'jump'</font> , <font color="#008000">// </font> <br> <font color="#A31515">'w'</font> : 30, <font color="#008000">// </font> <br> <font color="#A31515">'h'</font> : 30, <font color="#008000">// </font> <br> <font color="#A31515">'fw'</font> : 30, <font color="#008000">//  </font> <br> <font color="#A31515">'x'</font> : 100, <font color="#008000">//  </font> <br> <font color="#A31515">'y'</font> : 100 <font color="#008000">//  </font> <br> } <br> <br> <font color="#008000">//     </font> <br> animate[ <font color="#A31515">'ball'</font> ] = { <br> <font color="#A31515">'jump'</font> : { <font color="#008000">//   </font> <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <font color="#008000">// Image</font> <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball.png'</font> , <font color="#008000">//  </font> <br> <font color="#A31515">'step'</font> : 0, <font color="#008000">//  </font> <br> <font color="#A31515">'speed'</font> : 3, <font color="#008000">// </font> <br> <font color="#A31515">'curr'</font> : 0, <font color="#008000">// </font> <br> <font color="#A31515">'steps'</font> : 3, <font color="#008000">//  ,   0</font> <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <font color="#008000">//     </font> <br> }, <br> <font color="#A31515">'bum'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_m.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 3, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 7, <br> <font color="#A31515">'onend'</font> : <font color="#A31515">'onBumEnd'</font> <br> }, <br> <font color="#A31515">'stop'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_s.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 10, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 0, <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <br> }, <br> <font color="#A31515">'dead'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_d.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 10, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 0, <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <br> } <br> } <br> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> o <font color="#0000ff">in</font> childs) { <br> <br> <font color="#008000">//    </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> a <font color="#0000ff">in</font> animate[o]) { <br> <br> <font color="#008000">// </font> <br> <font color="#0000ff">var</font> img = <font color="#0000ff">new</font> Image(); <br> img.src = animate[o][a].src; <br> <font color="#008000">//    </font> <br> animate[o][a].el = img; <br> <br> } <br> <br> } <br> <br> }</font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> initAnimation() { <br> <br> <font color="#008000">// </font> <br> childs[ <font color="#A31515">'ball'</font> ] = { <br> <font color="#A31515">'at'</font> : <font color="#A31515">'jump'</font> , <font color="#008000">// </font> <br> <font color="#A31515">'w'</font> : 30, <font color="#008000">// </font> <br> <font color="#A31515">'h'</font> : 30, <font color="#008000">// </font> <br> <font color="#A31515">'fw'</font> : 30, <font color="#008000">//  </font> <br> <font color="#A31515">'x'</font> : 100, <font color="#008000">//  </font> <br> <font color="#A31515">'y'</font> : 100 <font color="#008000">//  </font> <br> } <br> <br> <font color="#008000">//     </font> <br> animate[ <font color="#A31515">'ball'</font> ] = { <br> <font color="#A31515">'jump'</font> : { <font color="#008000">//   </font> <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <font color="#008000">// Image</font> <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball.png'</font> , <font color="#008000">//  </font> <br> <font color="#A31515">'step'</font> : 0, <font color="#008000">//  </font> <br> <font color="#A31515">'speed'</font> : 3, <font color="#008000">// </font> <br> <font color="#A31515">'curr'</font> : 0, <font color="#008000">// </font> <br> <font color="#A31515">'steps'</font> : 3, <font color="#008000">//  ,   0</font> <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <font color="#008000">//     </font> <br> }, <br> <font color="#A31515">'bum'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_m.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 3, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 7, <br> <font color="#A31515">'onend'</font> : <font color="#A31515">'onBumEnd'</font> <br> }, <br> <font color="#A31515">'stop'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_s.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 10, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 0, <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <br> }, <br> <font color="#A31515">'dead'</font> : { <br> <font color="#A31515">'el'</font> : <font color="#0000ff">null</font> , <br> <font color="#A31515">'src'</font> : <font color="#A31515">'images/ball_d.png'</font> , <br> <font color="#A31515">'step'</font> : 0, <br> <font color="#A31515">'speed'</font> : 10, <br> <font color="#A31515">'curr'</font> : 0, <br> <font color="#A31515">'steps'</font> : 0, <br> <font color="#A31515">'onend'</font> : <font color="#0000ff">null</font> <br> } <br> } <br> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> o <font color="#0000ff">in</font> childs) { <br> <br> <font color="#008000">//    </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> a <font color="#0000ff">in</font> animate[o]) { <br> <br> <font color="#008000">// </font> <br> <font color="#0000ff">var</font> img = <font color="#0000ff">new</font> Image(); <br> img.src = animate[o][a].src; <br> <font color="#008000">//    </font> <br> animate[o][a].el = img; <br> <br> } <br> <br> } <br> <br> }</font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br><br>  I will explain a little.  Each animation is a file with all frames.  On the canvas, I bring only part of the image corresponding to the current frame.  For this, I store step and steps (number of frames). <br><br>  The image is as follows: <br><img src="https://habrastorage.org/storage/habraeffect/e7/9f/e79ff8fded793eb91b258b38979bfff3.png" alt="image"><br>  This is the largest image responsible for the longest ‚ÄúBum‚Äù animation in 8 frames. <br><br>  Speed ‚Äã‚Äãand curr are responsible for the frame switching speed.  I redraw the canvas every 16ms and that the frames change with the required speed, I consider curr and when I reach speed I change the frame. <br><br>  Onend I call at the end of the animation.  Here we can change the type of animation - from the explosion to the display of the remains or remove an object from the array.  For this, a little higher, I have a function: <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> onBumEnd() { <br> <br> <font color="#008000">//     </font> <br> childs[ <font color="#A31515">'ball'</font> ].at = <font color="#A31515">'dead'</font> ; <br> <font color="#008000">// </font> <br> animate[ <font color="#A31515">'ball'</font> ][childs[ <font color="#A31515">'ball'</font> ].at].curr = 0; <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> onBumEnd() { <br> <br> <font color="#008000">//     </font> <br> childs[ <font color="#A31515">'ball'</font> ].at = <font color="#A31515">'dead'</font> ; <br> <font color="#008000">// </font> <br> animate[ <font color="#A31515">'ball'</font> ][childs[ <font color="#A31515">'ball'</font> ].at].curr = 0; <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> onBumEnd() { <br> <br> <font color="#008000">//     </font> <br> childs[ <font color="#A31515">'ball'</font> ].at = <font color="#A31515">'dead'</font> ; <br> <font color="#008000">// </font> <br> animate[ <font color="#A31515">'ball'</font> ][childs[ <font color="#A31515">'ball'</font> ].at].curr = 0; <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br><br><h5>  Animations </h5><br>  There are 4 animations for the object: <br><ul><li>  Worth: <img src="https://habrastorage.org/storage/habraeffect/d3/f7/d3f79556a9ea11be5aecc53b06b7b51c.png" alt="stop"></li><li>  Jumps: <img src="https://habrastorage.org/storage/habraeffect/26/60/2660e2753d367131add6bfa7133ab988.png" alt="jump"></li><li>  Explodes: <img src="https://habrastorage.org/storage/habraeffect/e7/9f/e79ff8fded793eb91b258b38979bfff3.png" alt="bum"></li><li>  Dead: <img src="https://habrastorage.org/storage/habraeffect/96/a1/96a15989ce428f3f1eaa5126c2242a55.png" alt="dead"></li></ul><br><br><h5>  Function to change the animation </h5><br>  To conveniently change animations, we have Select and a function for it: <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> changeAnimation(value) { <br> <br> <font color="#008000">//   </font> <br> childs[ <font color="#A31515">'ball'</font> ].at = value; <br> <font color="#008000">// </font> <br> animate[ <font color="#A31515">'ball'</font> ][childs[ <font color="#A31515">'ball'</font> ].at].curr = 0; <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> changeAnimation(value) { <br> <br> <font color="#008000">//   </font> <br> childs[ <font color="#A31515">'ball'</font> ].at = value; <br> <font color="#008000">// </font> <br> animate[ <font color="#A31515">'ball'</font> ][childs[ <font color="#A31515">'ball'</font> ].at].curr = 0; <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> changeAnimation(value) { <br> <br> <font color="#008000">//   </font> <br> childs[ <font color="#A31515">'ball'</font> ].at = value; <br> <font color="#008000">// </font> <br> animate[ <font color="#A31515">'ball'</font> ][childs[ <font color="#A31515">'ball'</font> ].at].curr = 0; <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br><h5>  Run </h5><br>  So all the images and arrays are ready, and I run the animation. <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> startAnimation() { <br> <br> <font color="#008000">//  </font> <br> setInterval( <font color="#0000ff">function</font> () { <br> <br> <font color="#008000">// </font> <br> ctx.save(); <br> ctx.fillStyle = <font color="#A31515">'#FFFFFF'</font> ; <br> ctx.fillRect(0, 0, 600, 200); <br> ctx.restore(); <br> <br> <font color="#008000">//     </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> o <font color="#0000ff">in</font> childs) { <br> <br> <font color="#008000">//  </font> <br> <font color="#0000ff">if</font> (animate[o]) { <br> <br> <font color="#008000">//  </font> <br> <font color="#0000ff">var</font> step = animate[o][childs[o].at].step; <br> <br> <font color="#008000">// </font> <br> ctx.drawImage( <br> animate[o][childs[o].at].el, <font color="#008000">// Image </font> <br> Math.round(childs[o].fw * step), <font color="#008000">//  ,   * </font> <br> 0, <font color="#008000">//    ,  0</font> <br> childs[o].w, <font color="#008000">//   </font> <br> childs[o].h, <font color="#008000">//  </font> <br> childs[o].x, <font color="#008000">//    </font> <br> childs[o].y, <font color="#008000">//  </font> <br> childs[o].w, <font color="#008000">//   </font> <br> childs[o].h <font color="#008000">//  </font> <br> ); <br> <br> <font color="#008000">//     speed,    </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].curr &gt;= animate[o][childs[o].at].speed) { <br> <br> <font color="#008000">//,      </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].step &gt;= animate[o][childs[o].at].steps) { <br> <br> animate[o][childs[o].at].step = 0; <br> <br> <font color="#008000">// ,   ,  </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].onend) <br> window[animate[o][childs[o].at].onend](); <br> <br> } <br> <font color="#0000ff">else</font> animate[o][childs[o].at].step++; <br> <br> <font color="#008000">// </font> <br> animate[o][childs[o].at].curr = 0; <br> <br> } <br> <br> <font color="#008000">// </font> <br> animate[o][childs[o].at].curr++; <br> <br> } <br> <br> } <br> <br> }, 1000/16); <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> startAnimation() { <br> <br> <font color="#008000">//  </font> <br> setInterval( <font color="#0000ff">function</font> () { <br> <br> <font color="#008000">// </font> <br> ctx.save(); <br> ctx.fillStyle = <font color="#A31515">'#FFFFFF'</font> ; <br> ctx.fillRect(0, 0, 600, 200); <br> ctx.restore(); <br> <br> <font color="#008000">//     </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> o <font color="#0000ff">in</font> childs) { <br> <br> <font color="#008000">//  </font> <br> <font color="#0000ff">if</font> (animate[o]) { <br> <br> <font color="#008000">//  </font> <br> <font color="#0000ff">var</font> step = animate[o][childs[o].at].step; <br> <br> <font color="#008000">// </font> <br> ctx.drawImage( <br> animate[o][childs[o].at].el, <font color="#008000">// Image </font> <br> Math.round(childs[o].fw * step), <font color="#008000">//  ,   * </font> <br> 0, <font color="#008000">//    ,  0</font> <br> childs[o].w, <font color="#008000">//   </font> <br> childs[o].h, <font color="#008000">//  </font> <br> childs[o].x, <font color="#008000">//    </font> <br> childs[o].y, <font color="#008000">//  </font> <br> childs[o].w, <font color="#008000">//   </font> <br> childs[o].h <font color="#008000">//  </font> <br> ); <br> <br> <font color="#008000">//     speed,    </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].curr &gt;= animate[o][childs[o].at].speed) { <br> <br> <font color="#008000">//,      </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].step &gt;= animate[o][childs[o].at].steps) { <br> <br> animate[o][childs[o].at].step = 0; <br> <br> <font color="#008000">// ,   ,  </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].onend) <br> window[animate[o][childs[o].at].onend](); <br> <br> } <br> <font color="#0000ff">else</font> animate[o][childs[o].at].step++; <br> <br> <font color="#008000">// </font> <br> animate[o][childs[o].at].curr = 0; <br> <br> } <br> <br> <font color="#008000">// </font> <br> animate[o][childs[o].at].curr++; <br> <br> } <br> <br> } <br> <br> }, 1000/16); <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> startAnimation() { <br> <br> <font color="#008000">//  </font> <br> setInterval( <font color="#0000ff">function</font> () { <br> <br> <font color="#008000">// </font> <br> ctx.save(); <br> ctx.fillStyle = <font color="#A31515">'#FFFFFF'</font> ; <br> ctx.fillRect(0, 0, 600, 200); <br> ctx.restore(); <br> <br> <font color="#008000">//     </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> o <font color="#0000ff">in</font> childs) { <br> <br> <font color="#008000">//  </font> <br> <font color="#0000ff">if</font> (animate[o]) { <br> <br> <font color="#008000">//  </font> <br> <font color="#0000ff">var</font> step = animate[o][childs[o].at].step; <br> <br> <font color="#008000">// </font> <br> ctx.drawImage( <br> animate[o][childs[o].at].el, <font color="#008000">// Image </font> <br> Math.round(childs[o].fw * step), <font color="#008000">//  ,   * </font> <br> 0, <font color="#008000">//    ,  0</font> <br> childs[o].w, <font color="#008000">//   </font> <br> childs[o].h, <font color="#008000">//  </font> <br> childs[o].x, <font color="#008000">//    </font> <br> childs[o].y, <font color="#008000">//  </font> <br> childs[o].w, <font color="#008000">//   </font> <br> childs[o].h <font color="#008000">//  </font> <br> ); <br> <br> <font color="#008000">//     speed,    </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].curr &gt;= animate[o][childs[o].at].speed) { <br> <br> <font color="#008000">//,      </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].step &gt;= animate[o][childs[o].at].steps) { <br> <br> animate[o][childs[o].at].step = 0; <br> <br> <font color="#008000">// ,   ,  </font> <br> <font color="#0000ff">if</font> (animate[o][childs[o].at].onend) <br> window[animate[o][childs[o].at].onend](); <br> <br> } <br> <font color="#0000ff">else</font> animate[o][childs[o].at].step++; <br> <br> <font color="#008000">// </font> <br> animate[o][childs[o].at].curr = 0; <br> <br> } <br> <br> <font color="#008000">// </font> <br> animate[o][childs[o].at].curr++; <br> <br> } <br> <br> } <br> <br> }, 1000/16); <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br><br>  In principle, I think from the comments it is clear what is following what and how it works.  As a result, I was able to save the objects of the scene, dynamically set the animation and respond to its end. <br>  Since often the objects in the animation are repeated, it makes sense to use childs as an array of objects, according to the principle of the library. <br>  Of course there is something to improve, but at the moment I have not found a good article on the topic of animation and offer my version. <br><br><h5>  Complete code </h5><br>  You can see <a href="http://trick-nja.narod.ru/">here</a> . <br>  Download <a href="https://docs.google.com/leaf%3Fid%3D0B8l1rhmHOmRdYzZhZjE2ODgtMGY2OC00YzczLThjNGYtZjA4MDEyNmVhM2Fk%26hl%3Den">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/119585/">https://habr.com/ru/post/119585/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119577/index.html">All important announcements Tech-ed North America 2011</a></li>
<li><a href="../119579/index.html">Computer Language Benchmarks Game - enough of tyranny</a></li>
<li><a href="../119580/index.html">Microsoft introduced new add-ons for .NET, expanding support for multi-core processors</a></li>
<li><a href="../119582/index.html">Release of Nginx CT ++ Module 0.5 - a high-performance template engine for a web server</a></li>
<li><a href="../119584/index.html">Glif: We shoot on the iPhone correctly</a></li>
<li><a href="../119586/index.html">Augmented Reality in Air Racing with Real Aircraft</a></li>
<li><a href="../119587/index.html">TrustPort Antivirus Products Competition</a></li>
<li><a href="../119588/index.html">Primary cache in Kohana 3 using tags</a></li>
<li><a href="../119589/index.html">SMP ON-Bank: Savings</a></li>
<li><a href="../119590/index.html">Application Development at AMFPHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>