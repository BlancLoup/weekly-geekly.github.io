<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Page Visibility API and a side effect of redrawing pages</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="First, a small experiment 
 To make this small article much more interesting, I suggest simply opening Google search results and immediately return to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Page Visibility API and a side effect of redrawing pages</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>First, a small experiment</b> </h4><br>  To make this small article much more interesting, I suggest simply opening <a href="https://www.google.com/search%3Fq%3DHershey%27s%2BEaster%2BCandy%2BAssortment%2B(Hershey%27s%2BKisses%252C%2BReese%27s%2BMiniatures%2B%2526%2BHershey%27s%2BMiniatures)%252C%2B24-Ounce%2BBags%2B(Pack%2Bof%2B2)">Google search results</a> and immediately return to reading under the cut. <br><br><a name="habracut"></a><br>  Most likely, the <b>first result of your issue was Amazon.com</b> , the page of which the browser kindly preloaded: <br><br><img src="https://habrastorage.org/storage2/366/060/e4c/366060e4c5eb67e30e52cc490ee6b382.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br>  Now logging on to <a href="http://www.amazon.com/">Amazon.com</a> , <b>we‚Äôll find a bunch of sweets</b> in the "You've watched" and "Related products": <br><br><img src="https://habrastorage.org/storage2/01a/0c7/d43/01a0c7d438b74b136397699ad9e8c276.png"><br><br>  Yes, Amazon decided that this user went to the product page and began to show the appropriate recommendations.  "Worried" can write about the leakage of data on the search, but I'm more concerned about web analytics and development. <br><br><h4>  <b>Conclusions for developers</b> </h4><br>  In my opinion, <a href="https://developers.google.com/chrome/whitepapers/prerender">prerender</a> is a good thing, but it has side effects that you should now think about when developing projects. <br><br>  So, Wireshark showed that the backend will not be able to distinguish a prerender request from the usual one, therefore, at a minimum, server logs may consider ‚Äúdead souls‚Äù - visitors who were shown the site as the first result, but there was no actual transition.  Since the analytics is implemented on the back end, we received unexpected recommendations, but is it possible to solve the problem with the help of the frontend? <br><br>  Yes, in Javascript, you can use the <a href="https://developer.mozilla.org/en-US/docs/DOM/Using_the_Page_Visibility_API">Page Visibility API</a> , which tells the state of the page: <b>document.visibilityState = 'prerender'</b> .  Thus, trackers and counters can wait for the moment of the first explicit page display and, as a result, analytics and recommendations are quite correct. <br><br>  Perhaps there are other solutions that I will be glad to read in the comments. </div><p>Source: <a href="https://habr.com/ru/post/173201/">https://habr.com/ru/post/173201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../173181/index.html">Download speed rating online stores</a></li>
<li><a href="../173183/index.html">Behavioral ranking factors</a></li>
<li><a href="../173191/index.html">Google decided to bury the RSS?</a></li>
<li><a href="../173193/index.html">The results of the second week of the competition for BizSpark startups "Tell about yourself"</a></li>
<li><a href="../173195/index.html">Useful HTML5 Snippets</a></li>
<li><a href="../173203/index.html">Google is preparing a competitor Evernote</a></li>
<li><a href="../173205/index.html">Effective online store. How to create marketable content for a large online store? PART 1</a></li>
<li><a href="../173207/index.html">Moedls: smartphone + laser = 3D scanner</a></li>
<li><a href="../173209/index.html">Records from high load HPC conferences</a></li>
<li><a href="../173211/index.html">Impressions from working with Play! Framework 2.1 + Java</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>