<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a cross-platform library in Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Today we will talk a little about cross-platform development, namely, in the Python language. 

 Python language itself is considered cross-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a cross-platform library in Python</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/acronis/blog/249963/"><img src="https://habrastorage.org/files/e91/ba0/95d/e91ba095d5534c389a3ca976f07e0085.jpg" align="left" height="215"></a>  Hi, Habr!  Today we will talk a little about cross-platform development, namely, in the Python language. <br><br>  Python language itself is considered cross-platform, but as long as it does not come to the interaction of the python-script and external platform-specific components.  For example, the mechanism for connecting a network folder in Windows and Linux is completely different.  And if you write a cross-platform script or even a library, then you cannot do without organizing a cross-platform code at the highest level of abstraction. <br><a name="habracut"></a><br>  We will draw ideas from the cross-platform library itself among all Python libraries - <i>os.py.</i>  It imports low-level modules depending on the composition of the standard library.  For different platforms, the set of standard Python interpreter modules is different.  You can verify this by looking at the code for the <i>os</i> module. <br><br><pre><code class="python hljs">_names = sys.builtin_module_names <span class="hljs-comment"><span class="hljs-comment"># Note: more names are added to __all__ later. __all__ = ["altsep", "curdir", "pardir", "sep", "extsep", "pathsep", "linesep", "defpath", "name", "path", "devnull", "SEEK_SET", "SEEK_CUR", "SEEK_END"] def _get_exports_list(module): try: return list(module.__all__) except AttributeError: return [n for n in dir(module) if n[0] != '_'] if 'posix' in _names: name = 'posix' linesep = '\n' from posix import * try: from posix import _exit except ImportError: pass import posixpath as path import posix __all__.extend(_get_exports_list(posix)) del posix</span></span></code> </pre> <br>  As you can see, the names tuple contains the names of all available modules.  The module variable <i>__all__</i> answers which objects will be available at import using the <i>from os import *</i> instruction.  If the <i>‚Äúposix‚Äù</i> module is available, then we execute the posix-specific code, and also write links to its available objects in <i>os .__ all__</i> .  Then we delete the posix object so that it is not accessible by calling <i>os.posix</i> , since we no longer need it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, all objects of the posix module are available for calling using <i>os.posix_object_module</i> .  Similarly for Windows, only instead of posix - nt. <br><br>  It should be noted that in the Windows version of the interpreter only the nt module is available.  Posix, solaris and other platform modules are not included in the delivery.  Similarly for other platforms.  The fact that the interpreter is compiled for a specific platform does not fit into the idea of ‚Äã‚Äãcross-platform.  Therefore, the distribution kit of our library contains modules for all platforms. <br><br>  Let's start writing your own cross-platform library.  For example, let's write a library that will connect a network folder regardless of the platform.  Let's look at the commands that help to connect the network folder in different operating systems: <br><br>  In Linux: <br><br><pre> <code class="bash hljs">mount //server/share /mount_point -o user=user,pass=password</code> </pre><br>  In Mac OSX: <br><br><pre> <code class="bash hljs">mount_smbfs //user:password@server/share /mount_point</code> </pre><br>  In windows: <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">net</span></span> use z: \\server\share /user:user password</code> </pre><br>  Not so different teams.  As you can see, each command has in its syntax server, share, user and password.  All we need is to define the platform and execute the function with the server, share, user, password, mount_point input parameters (for win, this will be the drive letter). <br><br><h2>  <font color="#00204D">Library structure</font> </h2><br>  The file structure for our library will be as follows: <br><img src="https://habrastorage.org/files/7af/bec/1a9/7afbec1a98ae483d9c251053047552b5.png"><br><br><h3>  <font color="#00204D">__init__.py</font> </h3><br>  This file performs 2 functions: <br><br><ol><li>  Specifies that the mounter folder is a package. </li><li>  Imports into the scope of the mounter package, objects depending on the platform </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sys.platform == <span class="hljs-string"><span class="hljs-string">"win32"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mounter.win <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sys.platform == <span class="hljs-string"><span class="hljs-string">"darwin"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mounter.osx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sys.platform == <span class="hljs-string"><span class="hljs-string">"linux2"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mounter.linux <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> *</code> </pre><br><h3>  <font color="#00204D">base.py</font> </h3><br>  Contains common to all platforms objects and prototypes of classes, on the basis of which platform-specific classes will be built. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> subprocess <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Popen, PIPE <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MounterBase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> mount_cmd = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> umount_cmd = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> mount_point = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> network_folder = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.path.exists(self.mount_point): <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'creating %s folder for mounting'</span></span> % self.mount_point os.makedirs(self.mount_point) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._prepare() Popen(self.mount_cmd, stdout=PIPE, stderr=PIPE, shell=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">umount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> Popen(self.umount_cmd, stdout=PIPE, stderr=PIPE, shell=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br>  (UPD: According to the <a href="http://habrahabr.ru/users/hellman/" class="user_link">hellman</a> user note, it‚Äôs worth noting that using shell = True is <a href="https://docs.python.org/2/library/subprocess.html">not safe</a> . In order not to complicate the example, we will sacrifice some security for the sake of clarity). <br>  Here, the MounterBase class is a prototype of future platform- <i>dependent</i> classes from the files <i>win.py</i> , <i>osx.py</i> , <i>linux.py</i> and so far does not know anything useful, since the commands for mounting and unmounting are not defined.  Now consider one of the platform-dependent modules. <br><br><h3>  <font color="#00204D">linux.py</font> </h3><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mounter <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mounter</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(mounter.MounterBase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, network_folder, mount_point, user, password)</span></span></span><span class="hljs-function">:</span></span> mount_cmd = <span class="hljs-string"><span class="hljs-string">"mount {network_folder} {mount_point} -o user={user},pass={password}"</span></span> self.mount_cmd = mount_cmd.format(network_folder=network_folder, mount_point=mount_point, user=user, password=password) self.umount_cmd = <span class="hljs-string"><span class="hljs-string">"umount {mount_point}"</span></span>.format(mount_point=mount_point)</code> </pre><br>  In this class, we describe specific parameters for the Linux platform, namely, the mount and unmount commands.  Let's do the same for Mac and Windows. <br><br><h3>  <font color="#00204D">osx.py</font> </h3><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mounter</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(mounter.MounterBase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, network_folder, mount_point, user, password)</span></span></span><span class="hljs-function">:</span></span> mount_cmd = <span class="hljs-string"><span class="hljs-string">"mount_smbfs //{user}:{password}@{network_folder} {mount_point}"</span></span> self.mount_cmd = mount_cmd.format(network_folder=network_folder, mount_point=mount_point, user=user, password=password) self.umount_cmd = <span class="hljs-string"><span class="hljs-string">"umount {mount_point}"</span></span>.format(mount_point=mount_point)</code> </pre><br><h3>  <font color="#00204D">win.py</font> </h3><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mounter</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(mounter.MounterBase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, network_folder, mount_point, user, password)</span></span></span><span class="hljs-function">:</span></span> network_folder =network_folder.replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-string"><span class="hljs-string">"\\"</span></span>) mount_cmd = <span class="hljs-string"><span class="hljs-string">"net use {mount_point} \\{network_folder} /user:{user} {password}"</span></span> self.mount_cmd = mount_cmd.format(network_folder=network_folder, mount_point=mount_point, user=user, password=password) self.umount_cmd = <span class="hljs-string"><span class="hljs-string">"net use {mount_point} /delete /y"</span></span>.format(mount_point=mount_point)</code> </pre><br>  As a result, to connect the network folder, we just need to call the <i>mount ()</i> method of an instance of the <i>mounter.Mounter ()</i> class: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mounter ... mount_point = <span class="hljs-string"><span class="hljs-string">"/mnt/mount_moint"</span></span> share = mounter.Mounter(<span class="hljs-string"><span class="hljs-string">"server/share"</span></span>, mount_point, <span class="hljs-string"><span class="hljs-string">"guest"</span></span>, <span class="hljs-string"><span class="hljs-string">"secret_password"</span></span>) share.mount() copy_requared_files(source=mount_point, dest=<span class="hljs-string"><span class="hljs-string">"/tmp"</span></span>) share.umount()</code> </pre><br>  Now you do not need to remember the command syntax for all platforms.  Of course, we implemented the most primitive mechanism for connecting a network folder.  This mechanism does not take into account that the network folder can be without a password, as well as other features.  I will leave the implementation of these features to you. <br><br>  We use a similar architecture in automated testing of Acronis True Image for Windows and Acronis True Image for Mac products.  For example, to perform a backup procedure, it is enough to call the <i>TrueImage.backup ()</i> function, and depending on the platform on which the script was run, the corresponding platform-specific code will be executed. <br><br>  Previous posts in our blog: <br>  - <a href="http://habrahabr.ru/post/237971/">True Image Multiplatform Development</a> <br>  - <a href="http://habrahabr.ru/post/234107/">50 shades of blue, or a tale about how we did the design. True Image 2015</a> <br>  - <a href="http://habrahabr.ru/post/234287/">Acronis Snap Deploy 5: Bulk Deployment is fast and easy.</a> <br>  - <a href="http://habrahabr.ru/post/255131/">‚ÄúNot a single break!‚Äù Or why should a customer fight with technical support</a> <br>  - <a href="http://habrahabr.ru/post/250145/">Stages of the birth of new functionality in the software product</a> <br>  - <a href="http://habrahabr.ru/post/254577/">Golden rule of backup</a> </div><p>Source: <a href="https://habr.com/ru/post/249963/">https://habr.com/ru/post/249963/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249953/index.html">Freeloot: is freelance free?</a></li>
<li><a href="../249955/index.html">Survey online courses in mathematics</a></li>
<li><a href="../249957/index.html">HTTP / 2 (h2-14, spdy4) in Google Chrome 40</a></li>
<li><a href="../249959/index.html">Snapshot Hunter Snapshot Detector - Veeam Backup & Replication v8 integrated functionality</a></li>
<li><a href="../249961/index.html">Flickr API in Android App. Authorization</a></li>
<li><a href="../249965/index.html">Unreal Engine 4 for the development of their abilities</a></li>
<li><a href="../249967/index.html">How to recover incorrectly exposed fyuzy in ATtiny</a></li>
<li><a href="../249969/index.html">JavaScript bulletproof tests</a></li>
<li><a href="../249971/index.html">Restoring hours "Electronics 7"</a></li>
<li><a href="../249973/index.html">Alternative badge for Facebook pages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>