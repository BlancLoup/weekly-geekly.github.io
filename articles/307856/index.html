<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Launch Node.js on JVM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gone are the days when whole companies depended on one technology supplier. Even small firms and amateurs will find the optimal solution for themselve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Launch Node.js on JVM</h1><div class="post__text post__text-html js-mediator-article"><p>  Gone are the days when whole companies depended on one technology supplier.  Even small firms and amateurs will find the optimal solution for themselves, combining technologies in one project.  For a long time, Java has held the lead among server technologies.  But today Node.js is everywhere. </p><br><p><img src="https://habrastorage.org/files/27a/61b/ccb/27a61bccb5124f1886f131c011fb1d39.png"></p><br><p>  But even with the growing popularity of Node.js and JavaScript, Java does not expire.  In addition, few organizations can afford to transfer the entire platform from JVM to Node.js.  This means that the company must either continue to use the current technology stack, or run several stacks that will communicate via the network API.  However, there is another way: run Node.js right in the JVM process.  And J2V8 finally made it possible. </p><a name="habracut"></a><br><h2>  J2v8 </h2><br><p><img src="https://habrastorage.org/files/51d/08d/0b2/51d08d0b20ed4531a59689e4474fa0bb.png"></p><br><p>  J2V8 is a set of connectors to V8 for Java.  J2V8 packs V8 as a dynamic library and provides Java API for V8 through the Java Native Interface (JNI).  With J2V8, you can execute javascript using V8 as well as using Rhino or Nashorn. </p><br><p>  J2V8 was originally designed to provide high-performance JavaScript in Tabris.js, a cross-platform mobile library. </p><br><p>  Over the past months, I set up the Node.js build as a dynamic library and provided interaction with the Java API for it.  Now you can run Node.js scripts directly from Java.  Unlike other solutions that try to implement Node.js using other engines, this is a real Node.js with all the bugs and features.  Node.js runs in the same process as the JVM and all interaction occurs synchronously via JNI. </p><br><h2>  Sharing Node.js and JVM </h2><br><p>  J2V8 provides an API for running scripts in Node.js, invoking JavaScript functions from Java and vice versa, connecting NPM modules and running Node.js message queue.  All modules of the Node.js core are also present. </p><br><p>  Running Node.js on the JVM makes it easier to migrate to anyone who uses a large Java stack, but wants to start using Node.js.  For example, you can run a server (such as Express.js) on Node.js and call existing Java methods to handle requests. </p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String NODE_SCRIPT = <span class="hljs-string"><span class="hljs-string">"var http = require('http');\n"</span></span> + <span class="hljs-string"><span class="hljs-string">""</span></span> + <span class="hljs-string"><span class="hljs-string">"var server = http.createServer(function (request, response) {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" response.writeHead(200, {'Content-Type': 'text/plain'});\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" response.end(someJavaMethod());\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"});\n"</span></span> + <span class="hljs-string"><span class="hljs-string">""</span></span> + <span class="hljs-string"><span class="hljs-string">"server.listen(8000);\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"console.log('Server running at http://127.0.0.1:8000/');"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> NodeJS nodeJS = NodeJS.createNodeJS(); JavaCallback callback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JavaCallback() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(V8Object receiver, V8Array parameters)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello, JavaWorld!"</span></span>; } }; nodeJS.getRuntime().registerJavaMethod(callback, <span class="hljs-string"><span class="hljs-string">"someJavaMethod"</span></span>); File nodeScript = createTemporaryScriptFile(NODE_SCRIPT, <span class="hljs-string"><span class="hljs-string">"example"</span></span>); nodeJS.exec(nodeScript); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(nodeJS.isRunning()) { nodeJS.handleMessage(); } nodeJS.release(); }</code> </pre> <br><h2>  NPM </h2><br><p>  In addition to calling existing Java methods from Node.js, J2V8 provides the ability to call JavaScript functions (including NPM modules) directly from Java.  With this integration, Java users can immediately start using NPM modules right in the JVM.  For example, you can use jimp to process images in Java. </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> NodeJS nodeJS = NodeJS.createNodeJS(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> V8Object jimp = nodeJS.require(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"path_to_jimp_module"</span></span>)); V8Function callback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> V8Function(nodeJS.getRuntime(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JavaCallback() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(V8Object receiver, V8Array parameters)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> V8Object image = parameters.getObject(<span class="hljs-number"><span class="hljs-number">1</span></span>); executeJSFunction(image, <span class="hljs-string"><span class="hljs-string">"posterize"</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>); executeJSFunction(image, <span class="hljs-string"><span class="hljs-string">"greyscale"</span></span>); executeJSFunction(image, <span class="hljs-string"><span class="hljs-string">"write"</span></span>, <span class="hljs-string"><span class="hljs-string">"path_to_output"</span></span>); image.release(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }); executeJSFunction(jimp, <span class="hljs-string"><span class="hljs-string">"read"</span></span>, <span class="hljs-string"><span class="hljs-string">"path_to_image"</span></span>, callback); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(nodeJS.isRunning()) { nodeJS.handleMessage(); } callback.release(); jimp.release(); nodeJS.release(); }</code> </pre> <br><h2>  J2V8 connection </h2><br><p>  Integration with Node.js is already available in J2V8 (version 4.4.0).  You can use it on Windows (32-bit and 64-bit), MacOS and Linux (64-bit).  Use the following dependency in pom to get it from Maven Central (this example is for Windows 64, do not forget to change it for other platforms): </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.eclipsesource.j2v8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>j2v8_win32_x86_64<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.4.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2>  From translator </h2><br><p>  J2V8 gives us a new level of abstraction, which allows you to choose the most appropriate technology for each individual task within the whole project.  As a developer, I have always been attracted to the reliability of Java and the convenience of Node.js.  And, soon, I hope we will see examples of successful projects combining the best of two worlds. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/307856/">https://habr.com/ru/post/307856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307844/index.html">Requirements collection methods or ‚ÄúHow to understand what the customer wants?‚Äù</a></li>
<li><a href="../307848/index.html">Python dependency management: it looks like you can already use it</a></li>
<li><a href="../307850/index.html">Corporate laboratories - an actual training program for information security specialists</a></li>
<li><a href="../307852/index.html">Why does Sberbank have an incorrect SPF record for a domain?</a></li>
<li><a href="../307854/index.html">‚ÄúThink Financial Models‚Äù: Who are the quanta and how to become them</a></li>
<li><a href="../307858/index.html">An example of autocomplete implementation using PostgreSQL tsearch2 FTS engine</a></li>
<li><a href="../307860/index.html">Testing under the SCRUM. Thorns, rakes and successes</a></li>
<li><a href="../307862/index.html">Hardware acceleration of corporate computing</a></li>
<li><a href="../307864/index.html">Go 1.7 release</a></li>
<li><a href="../307866/index.html">Report on attending a YouTube conference in Kiev or Why video content has become a part of life</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>