<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Six simple examples on Mockito (translation)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Small comment:  / * 
 I decided to familiarize myself with what this library is of, and found a wonderful article , the reading of which I would like ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Six simple examples on Mockito (translation)</h1><div class="post__text post__text-html js-mediator-article"><div class="spoiler">  <b class="spoiler_title">Small comment:</b> <div class="spoiler_text">  / * <br>  I decided to familiarize myself with what this library is of, and found a wonderful <a href="http://gojko.net/2009/10/23/mockito-in-six-easy-examples/">article</a> , the reading of which I would like to consolidate, for which I decided to translate it into Russian. <br>  Of course, constructive criticism is accepted. <br>  I hope that the comments will be more useful than the article itself, as it usually happens.  ;) <br>  * / </div></div><br>  Mockito is a great mock library for Java.  I am fascinated by how easy it is to use in comparison with other similar libraries from the world of Java and .NET.  In this article, I give everything that you need to start in six very easy examples. <br><a name="habracut"></a><br>  To get started, download the mockito from <a href="http://mockito.org/">http://mockito.org/</a> (at the time of writing, it leads to <a href="https://code.google.com/p/mockito/">https://code.google.com/p/mockito/</a> ). <br><div class="spoiler">  <b class="spoiler_title">Or just add it depending on the pom of the maven project:</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.mockito<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mockito-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--      1.10.10 --&gt;</span></span></code> </pre> </div></div><br>  Almost all the fun can be taken from the org.mockito.Mockito class (or you can <a href="https://stokito.wordpress.com/2011/04/05/%25D0%25B2%25D0%25BE%25D0%25B7%25D0%25BC%25D0%25BE%25D0%25B6%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8-java-%25D1%2581%25D1%2582%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9-%25D0%25B8%25D0%25BC%25D0%25BF%25D0%25BE%25D1%2580%25D1%2582/">statically import</a> its methods, which I use in this article).  So, let's begin. <br><br>  To create a stub (or mock), use <b>mock (class)</b> .  Then use <b>when (mock) .thenReturn (value)</b> to specify the return value for the method.  If you specify more than one return value, they will be returned by the method sequentially until the last returns, then subsequent calls will return only the last value (so that the method always returns the same value, just specify it once).  For example: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.mockito.Mockito.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.junit.Assert.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Iterator; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.Test; .... <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator_will_return_hello_world</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Iterator i = mock(Iterator.class); when(i.next()).thenReturn("Hello").thenReturn("World"); // String result = i.next()+" "+i.next(); // assertEquals("Hello World", result); }</span></span></code> </pre> <br>  This example demonstrates the creation of a mock iterator and ‚Äúcauses‚Äù it to return ‚ÄúHello‚Äù the first time the <b>next ()</b> method is called.  Subsequent calls to this method will return ‚ÄúWorld‚Äù.  After that, we can perform the usual assertions. <br>  Stubs can also return different values ‚Äã‚Äãdepending on the arguments passed to the method.  Example: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with_arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Comparable c = mock(Comparable.class); when(c.compareTo(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>)).thenReturn(<span class="hljs-number"><span class="hljs-number">1</span></span>); assertEquals(<span class="hljs-number"><span class="hljs-number">1</span></span>, c.compareTo(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>)); }</code> </pre> <br>  Here we create a Comparable stub object, and return 1 if it is compared with a specific String value ("Test", in this case). <br>  If the method has some arguments, but you don‚Äôt care what is passed to them or predict it is impossible, then use <b>anyInt ()</b> (and alternative values ‚Äã‚Äãfor other types).  Example: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with_unspecified_arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Comparable c = mock(Comparable.class); when(c.compareTo(anyInt())).thenReturn(-<span class="hljs-number"><span class="hljs-number">1</span></span>); assertEquals(-<span class="hljs-number"><span class="hljs-number">1</span></span>, c.compareTo(<span class="hljs-number"><span class="hljs-number">5</span></span>)); }</code> </pre> <br>  This stub returns -1, regardless of the argument passed.  Void methods are a problem because you cannot use them in the <b>when ()</b> method. <br>  An alternative syntax in this situation would be <b>doReturn (result) .when (mock_object) .void_method_call ();</b>  .  Instead of returning the result, you can also use <b>.thenThrow ()</b> or <b>doThrow ()</b> for void methods.  Example: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>(expected=IOException.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputStreamWriter_rethrows_an_exception_from_OutputStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ OutputStream mock = mock(OutputStream.class); OutputStreamWriter osw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OutputStreamWriter(mock); doThrow(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException()).when(mock).close(); osw.close(); }</code> </pre> <br>  In this example, an IOException is thrown when the close method is called on the OutputStream stub.  We easily verify that OutputStreamWriter sends such an event to the outside. <br>  To verify that the method was actually called (typical use of stub objects), we can use <b>verify (mock_object) .method_call;</b>  .  Example: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputStreamWriter_Closes_OutputStream_on_Close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ OutputStream mock = mock(OutputStream.class); OutputStreamWriter osw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OutputStreamWriter(mock); osw.close(); verify(mock).close(); }</code> </pre> <br>  In this example, we check that OutputStreamWriter makes a call to the <b>close ()</b> method in a nested OutputStream. <br>  You can use arguments in methods and substitutions for them, such as <b>anyInt ()</b> , as in one of the previous examples.  It is worth noting that you cannot mix literals and gamers.  Use the <b>eq (value)</b> matcher to convert a literal into a matcher that compares the value.  Mockito provides a lot of ready-made matchers, but sometimes you may need a more flexible approach.  For example, OutputStreamWriter will buffer the output and then pass it to the wrapped object when the buffer is full, but we don‚Äôt know how long the buffer is going to pass to us.  Here we cannot use comparison for equality.  However, we can file our own match: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputStreamWriter_Buffers_And_Forwards_To_OutputStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ OutputStream mock = mock(OutputStream.class); OutputStreamWriter osw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OutputStreamWriter(mock); osw.write(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); osw.flush(); <span class="hljs-comment"><span class="hljs-comment">//    ,     , //      // verify(mock).write(new byte[]{'a'}, 0, 1); BaseMatcher&lt;byte[]&gt; arrayStartingWithA = new BaseMatcher&lt;byte[]&gt;() { @Override public void describeTo(Description description) { //  } // ,    -  A @Override public boolean matches(Object item) { byte[] actual = (byte[]) item; return actual[0] == 'a'; } }; // ,     -  A,       0  1. verify(mock).write(argThat(arrayStartingWithA), eq(0), eq(1)); }</span></span></code> </pre> <br>  And that's all you need to get started.  And now take and refill all this isokraschyna in your projects! <br><br><div class="spoiler">  <b class="spoiler_title">All class text with tests:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.mockito.Mockito.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.junit.Assert.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.OutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.OutputStreamWriter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Iterator; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.hamcrest.BaseMatcher; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.hamcrest.Description; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.Test; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockitoTests</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator_will_return_hello_world</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Iterator i = mock(Iterator.class); when(i.next()).thenReturn("Hello").thenReturn("World"); // String result = i.next() + " " + i.next(); // assertEquals("Hello World", result); } @Test public void with_arguments() { Comparable c = mock(Comparable.class); when(c.compareTo("Test")).thenReturn(1); assertEquals(1, c.compareTo("Test")); } @Test public void with_unspecified_arguments() { Comparable c = mock(Comparable.class); when(c.compareTo(anyInt())).thenReturn(-1); assertEquals(-1, c.compareTo(5)); } @Test(expected = IOException.class) public void OutputStreamWriter_rethrows_an_exception_from_OutputStream() throws IOException { OutputStream mock = mock(OutputStream.class); OutputStreamWriter osw = new OutputStreamWriter(mock); doThrow(new IOException()).when(mock).close(); osw.close(); } @Test public void OutputStreamWriter_Closes_OutputStream_on_Close() throws IOException { OutputStream mock = mock(OutputStream.class); OutputStreamWriter osw = new OutputStreamWriter(mock); osw.close(); verify(mock).close(); } @Test public void OutputStreamWriter_Buffers_And_Forwards_To_OutputStream() throws IOException { OutputStream mock = mock(OutputStream.class); OutputStreamWriter osw = new OutputStreamWriter(mock); osw.write('a'); osw.flush(); //    ,     , //      // verify(mock).write(new byte[]{'a'},0,1); BaseMatcher&lt;byte[]&gt; arrayStartingWithA = new BaseMatcher&lt;byte[]&gt;() { @Override public void describeTo(Description description) { //  } // ,    -  A @Override public boolean matches(Object item) { byte[] actual = (byte[]) item; return actual[0] == 'a'; } }; // ,     -  A,       0  1. verify(mock).write(argThat(arrayStartingWithA), eq(0), eq(1)); } }</span></span></code> </pre> </div></div><br>  PS: Then you can read the introduction to PowerMock: <a href="http://habrahabr.ru/post/172239/">http://habrahabr.ru/post/172239/</a> . <br>  And this article: <a href="http://habrahabr.ru/post/72617/">http://habrahabr.ru/post/72617/</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/243155/">https://habr.com/ru/post/243155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243141/index.html">Another heart on Atmega</a></li>
<li><a href="../243145/index.html">Barcode scanners in trade automation</a></li>
<li><a href="../243147/index.html">We invite to the conference on web development on November 29</a></li>
<li><a href="../243149/index.html">Free CppCat for students</a></li>
<li><a href="../243153/index.html">Windows 2008/2012 with NetApp ONTAP 8 (SAN)</a></li>
<li><a href="../243157/index.html">Personalization for search services</a></li>
<li><a href="../243159/index.html">"Secrets" of the existence of nerdy</a></li>
<li><a href="../243161/index.html">A simple way to stretch a block to the full height of the screen, or CSS3 Viewport Units</a></li>
<li><a href="../243163/index.html">WinJS + universal applications. Studying navigation</a></li>
<li><a href="../243167/index.html">Understanding the experience of gamers with disabilities</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>