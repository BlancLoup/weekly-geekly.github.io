<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Autoconfiguration (Auto Setup) of Polycom Phones Using Asterisk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task: Set up phones (or any other subscriber device) automatically based on the MAC address, preferably without getting the device out of the box. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Autoconfiguration (Auto Setup) of Polycom Phones Using Asterisk</h1><div class="post__text post__text-html js-mediator-article"><h4>  Task: Set up phones (or any other subscriber device) automatically based on the MAC address, preferably without getting the device out of the box. </h4><br><br>  The idea of ‚Äã‚Äãcentralized configuration of subscriber devices has been with me for a long time and, finally, it has been implemented in one of the projects.  <a href="https://www.youtube.com/watch%3Fv%3DaAJMNp8amwA">Video at the end of the post.</a> <br>  Virtually all (Cisco, Polycom, D-Link, Escene) IP phones I have met with in one form or another support centralized configuration from a server, i.e.  Auto-Provisioning for our autos.  In this case, an example is considered with Polycom phones, but in fact, a similar approach will allow you to configure any phone with certain adjustments. <br><br><h5>  How does it work (about Polycom)? </h5><br>  The default phone is configured to receive an IP address via DHCP, in addition to the address itself, the phone receives a number of <a href="http://www.networksorcery.com/enp/protocol/bootp/options.htm">options</a> from DHCP, including the gateway, network mask and DNS server, besides, you can specify the SNTP server and much more.  Polycoms look at options 66 and 160 by default, where they try to find the address of the auto provision server.  If the phone detects the server's address, it tries to connect to it by default via FTP (it supports HTTP, HTTPS, TFTP) using the login and password as: <br><table border="1" width="279"><tbody><tr><td>  Username <br></td><td>  PlcmSpIp <br></td></tr><tr><td>  Password <br></td><td>  PlcmSpIp <br></td></tr></tbody></table><br>  The phone requests the server version (sip.ver file) and the firmware files and configuration files themselves.  The phone downloads the new firmware, updates it, then, after rebooting, it accesses the server again, sees that the software does not require updating, downloads and applies the XML configuration files.  In general, the machine requests the following files. <br><a name="habracut"></a><br><table border="1" width="589"><tbody><tr><td>  File name <br></td><td>  Description <br></td></tr><tr><td>  0000000000.cfg <br></td><td>  General configuration file (says what to download from where) <br></td></tr><tr><td>  * .sip.ld (for split) <br>  sip.ld (for combined) * <br></td><td>  Phone firmware of the corresponding model (set with 0000000000.cfg), <br></td></tr><tr><td>  sip.ver <br></td><td>  Software version <br></td></tr><tr><td>  1234123adba.cfg <br></td><td>  Phone configuration with MAC address 1234123adba <br></td></tr></tbody></table><br>  * - the polycom has two versions of software combined (weighs a lot) - suitable for everyone, split - for each line of phones a separate small * sip.ld file (reduces the load on the network). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It would seem, that's all, the phone is ready to go!  In fact, for small systems this is the case, i.e.  enough: <br><ol><li>  Download firmware from the manufacturer's website for your phones <a href="http://support.polycom.com/PolycomService/support/us/support/voice/index.html">support.polycom.com/PolycomService/support/us/support/voice/index.html</a> </li><li>  In 0000000000.cfg specify which configuration files the phone should download from the server (CONFIG_FILES = "custom.cfg"), this is enough, because  default. </li><li>  Create custom.cfg containing settings common to all devices. </li><li>  Create several .conf files for each of the devices &lt;MAC address&gt; .cfg which will contain information unique for each subscriber i.e.  in general, only his SIP login and password. </li></ol><br><br>  This solution allows you to quickly deploy a small VoIP-infrastructure, but on large systems, you will have to create many files of the same type and is convenient and does not have much flexibility.  Besides, it's boring. <br><br>  Therefore, I went in a more sophisticated way: <br><ol><li>  Through FTP, we configure the phone so that it receives files via HTTP: 8088 </li><li>  On Asterisk, using phoneprov, we dynamically generate a configuration file for each phone based on the users.conf file. </li></ol><br>  With this method of configuration, it will be enough to add a new device to the MAC in users.conf and assign a username and password to it there, the rest of the settings will be done automatically. <br>  Now let's take a closer look at what needs to be done: <br><br><h5>  DHCP setup </h5><br>  In this case, I set the static addresses for each device through the config, i.e.  dynamic address is needed by the device only in the first and second boot, after the third one it is already fully configured and has a static IP.  Therefore, I set up the lease time - 5 minutes, so as not to occupy the pool of addresses in the empty.  In the general case, addresses can be distributed dynamically by making a reservation for each MAC.  In addition, you need to add option 66 or 160 - to taste, containing the address of the provisioning server.  In Windows, it is done like this: <br><br><img height="450" src="https://habrastorage.org/getpro/habr/post_images/172/bb0/e16/172bb0e166d1548a6a969c763ffe2688.png" width="407"><br>  In my case Mikrotik: <br><img height="308" src="https://habrastorage.org/getpro/habr/post_images/0d0/dc7/fc7/0d0dc7fc7f79c221b95c34aa7c4bb6b3.jpg" width="342"><br>  So, it is necessary that the addresses and options 66 are dynamically distributed with the address of the provision server.  In my case, the range of dynamic addresses from 20 to 99, and 101-199 range for static addresses, made it so that the internal number of the subscriber coincides with its IP. <br><br><h5>  FTP Phone Setup </h5><br>  To configure via FTP, you need FTP, set (CentOS): <br><pre><code class="bash hljs">yum install -y vsftpd chkconfig vsftpd on service vsftpd start</code> </pre> <br>  You can configure it via /etc/vsftpd/vsftpd.conf. <br>  Create a user under which polycom will try to connect: <br><pre> <code class="bash hljs">useradd PlcmSpIp passwd PlcmSpIp</code> </pre><br>  Given the complexity of the password, it will be useful to ensure that this user is as powerless as possible. <br>  Now download the archive with the firmware and unpack it in / home / PlcmSpIp <br><br>  When you download the firmware, read carefully the warnings, you will most likely have to download the bootloader updates as well, unpack them in the / home / PlcmSpIp directory as well. <br><img height="372" src="https://habrastorage.org/getpro/habr/post_images/08b/fab/f81/08bfabf81c0fa2c7293e76bc4ccfbc5e.jpg" width="623"><br>  At the moment, the phone connected to the network must, when turned on, deflate a new bootloader and firmware and update the software. <br><br><h5>  Work with configuration files </h5><br>  Then I lost a lot of time trying to edit XML with my hands, and I conjure you, oh, reader, do not rule configs with a text editor, unless you are Obi-Wan-Kenobi in the XML world.  To work with configs, I used XML Notepad 2007. If you downloaded the combined-version firmware, then in the config folder there will be several configuration files with the extension * .cfg and the XML schema polycomConfig.xsd. <br>  * .cfg - examples of configuration files are grouped thematically <br><table width="567"><tbody><tr><td>  polycomConfig.xsd <br></td><td>  Scheme <br></td></tr><tr><td>  video-integration.cfg <br></td><td>  Video integration setup <br></td></tr><tr><td>  video.cfg <br></td><td>  Setting up video calls <br></td></tr><tr><td>  site.cfg <br></td><td>  There are a lot of things, maybe even all the settings <br></td></tr><tr><td>  sip-interop.cfg <br></td><td>  Settings sip, calls, tones <br></td></tr><tr><td>  sip-basic.cfg <br></td><td>  Sip settings <br></td></tr><tr><td>  region.cfg <br></td><td>  Regional Settings <br></td></tr><tr><td>  reg-basic.cfg <br></td><td>  SIP Registration - Basic <br></td></tr><tr><td>  reg-advanced.cfg <br></td><td>  SIP Registration - Extended <br></td></tr><tr><td>  H323.cfg <br></td><td>  H323 settings <br></td></tr><tr><td>  features.cfg <br></td><td>  Transfer Forwarding Transfer Settings <br></td></tr><tr><td>  device.cfg <br></td><td>  Device settings, network system <br></td></tr><tr><td>  applications.cfg <br></td><td>  Application settings <br></td></tr></tbody></table><br><br>  Each file has the following line: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polycomConfig</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:noNamespaceSchemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"polycomConfig.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This means that if you open the configuration file with an XML editor, it will search the polycomConfig.xsd schema file in the same folder, it contains all possible configuration file fields and a list of available values ‚Äã‚Äãor a short comment.  At this stage, we need to show the device that the download should be via HTTP and specify the http-path to the configuration files. <br>  Create a custom.cfg text file in the folder with polycomConfig.xsd. <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polycomConfig</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:noNamespaceSchemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"polycomConfig.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polycomConfig</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Open it with an XML editor.  What fields that contain need to search by Google or use the <a href="http://supportdocs.polycom.com/PolycomService/support/global/documents/support/setup_maintenance/products/voice/UC_Software_Admin_Guide_v4_1_0.pdf">600-page instructions for the administrator to configure the phone manufacturer.</a> <br>  But for the most part, everything is intuitive.  First, we create an element (probably we should speak a section or something else, but I don‚Äôt know and therefore I will call it what they are called XML editor, that is, an element) using the context menu polycomConfig or simply ctrl + insert while standing on polycomConfig. <br><img height="400" src="https://habrastorage.org/getpro/habr/post_images/8aa/b32/576/8aab32576336fbccf058a55bfd1fa2b9.jpg" width="623"><br>  In the drop-down list, select the device.  We are interested in device settings, in the same way we create the device.dhcp element in the device element. <br><img height="394" src="https://habrastorage.org/getpro/habr/post_images/de9/380/491/de9380491278883589c79960bfadffb9.jpg" width="623"><br>  Now in it we create the Alt + Insert attribute or from the context menu on device.dhcp, a drop-down list of available attributes is opened, a tooltip with available values ‚Äã‚Äãpops up when hovering. <br><img height="331" src="https://habrastorage.org/getpro/habr/post_images/ea8/374/113/ea8374113eebd3e6dcb3104de49b4a6e.jpg" width="623"><br>  We put Static - in our case, this means that options 160 and 66 of DHCP should be ignored.  Similarly, we set other parameters, as a result we have the following file: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polycomConfig</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:noNamespaceSchemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"polycomConfig.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dhcp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dhcp.bootSrvUseOpt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Static"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dhcp.enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dhcp.enabled</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dhcp.enabled.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dhcp.bootSrvUseOpt</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dhcp.bootSrvUseOpt.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dhcp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.prov</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.prov.serverName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://192.168..:8088/phoneprov/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.prov.serverType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HTTP"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.prov.serverName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.prov.serverName.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.prov.serverType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.prov.serverType.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.prov</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polycomConfig</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><table border="1"><tbody><tr><td>  <b>&lt;device device.set = "1"&gt;</b> <br></td><td>  Set device settings <br></td></tr><tr><td>  device.dhcp.bootSrvUseOpt = "Static" <br></td><td>  Ignore options 66 and 160 of DHCP <br></td></tr><tr><td>  device.dhcp.enabled = "1" <br></td><td>  Use DHCP <br></td></tr><tr><td>  <b>&lt;device.dhcp.enabled device.dhcp.enabled.set = "1" /&gt;</b> <br></td><td>  Set dhcp.enabled value <br></td></tr><tr><td>  <b>&lt;device.dhcp.bootSrvUseOpt device.dhcp.bootSrvUseOpt.set = "1" /&gt;</b> <br></td><td>  Set the bootSrvUseOpt value <br></td></tr><tr><td>  device.prov.serverName = "http: //192.168.xxx.xxx: 8088 / phoneprov /" <br></td><td>  File path <br></td></tr><tr><td>  device.prov.serverType = "HTTP" <br></td><td>  Provision server type <br></td></tr><tr><td>  <b>&lt;device.prov.serverName device.prov.serverName.set = "1" /&gt;</b> <br></td><td>  Set serverName value <br></td></tr><tr><td>  <b>&lt;device.prov.serverType device.prov.serverType.set = "1" /&gt;</b> <br></td><td>  Set serverType value <br></td></tr></tbody></table><br><img height="347" src="https://habrastorage.org/getpro/habr/post_images/59d/00c/b35/59d00cb3507e2e96db8915d4433a40cb.jpg" width="623"><br>  Particular attention should be paid to the attributes highlighted in a living font, it is something like a switch, i.e.  it is not enough to simply enter the value of some parameter and it is necessary to say ‚ÄúYes‚Äù specifically, this parameter should be applied.  Especially important <b>&lt;device device.set = "1"&gt;</b>  if this parameter is 0, then all device element settings will be ignored. <br><br><h5>  Asterisk settings </h5><br>  Everything, now our phones will ask for files when downloading from <a href="http://192.168.xn--u1aaa.xn--u1aaa/">192.168.xxx.xxx</a> : 8088 / phoneprov /.  It is necessary to sublimate them there from non-existence.  For this price, Asterisk has a special module, it allows you to automatically generate files based on templates and send them through the built-in HTTP server of the asterisk.  More information can be found <a href="https://wiki.asterisk.org/wiki/display/AST/Phone%2BProvisioning%2Bin%2BAsterisk%3Fsrc%3Dbreadcrumbs-parent">here</a> and in particular it says: <br>  Make sure that /etc/asterisk/manager.conf contains: <br>  [general] <br>  enabled = yes;  - probably so necessary, although I don‚Äôt understand why <br>  webenabled = yes;  - probably so necessary, although I don‚Äôt understand why <br><br>  Make sure that /etc/asterisk/http.conf contains: <br>  [general] <br>  enabled = yes;  includes embedded HTTP server <br>  bindaddr = 192.168.xxx.xxx;  IP - on which the server will be available <br>  bindport = 8088;  - because  Port 80 is busy with apache, use 8088 <br><br>  When requesting a file from the http-server, phoneprov takes the template of the file and inserts variables into it that it takes from users.conf and, which is especially nice, you can use the text functions of the dial plan.  For example, $ {TOLOWER ($ {MAC})} in the template will be replaced when generating the configuration file with the MAC address of the user in lower case. <br>  The template can use the following variables: <br><pre> <code class="bash hljs">fullname = User Two ; <span class="hljs-variable"><span class="hljs-variable">${DISPLAY_NAME}</span></span> secret = <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> ; <span class="hljs-variable"><span class="hljs-variable">${SECRET}</span></span> username = 6001 ; <span class="hljs-variable"><span class="hljs-variable">${USERNAME}</span></span> macaddress = deadbeef4dad ; <span class="hljs-variable"><span class="hljs-variable">${MAC}</span></span> label = 6001 ; <span class="hljs-variable"><span class="hljs-variable">${LABEL}</span></span> cid_number = 6001 ; <span class="hljs-variable"><span class="hljs-variable">${CALLERID}</span></span>    : <span class="hljs-variable"><span class="hljs-variable">${SERVER}</span></span> ‚Äì   phoneprov.conf    ,    bindaddr  http.conf <span class="hljs-variable"><span class="hljs-variable">${SERVER_PORT}</span></span> -   bindport  sip.conf,    ,  5060</code> </pre><br>  The configuration file of res_phoneprov itself is /etc/asterisk/phoneprov.conf, in it you need to specify the directory of static files relative to the / var / lib / asterisk / phoneprov / path, the list of static files, the list of templates and the templates of the names of dynamically-formed files.  Here is an example: <br><pre> <code class="bash hljs">[general] serveraddr=192.168.. ;   <span class="hljs-variable"><span class="hljs-variable">${SERVER}</span></span>. serverport=5060 ;   <span class="hljs-variable"><span class="hljs-variable">${SERVER_PORT}</span></span>. default_profile=polycom ;        users.conf [polycom] staticdir =&gt; configs/ ;    , ,  ,    ..,   /var/lib/asterisk/phoneprov/ mime_type =&gt; text/xml static_file =&gt; 2345-12345-001.bootrom.ld static_file =&gt; 2345-12360-001.bootrom.ld static_file =&gt; 2345-12365-001.bootrom.ld static_file =&gt; 2345-12365-002.bootrom.ld static_file =&gt; 2345-12375-001.bootrom.ld static_file =&gt; 2345-12375-002.bootrom.ld static_file =&gt; 2345-12450-001.bootrom.ld static_file =&gt; 2345-12450-002.bootrom.ld static_file =&gt; 2345-12500-001.bootrom.ld static_file =&gt; 2345-12560-001.bootrom.ld static_file =&gt; 2345-12600-001.bootrom.ld static_file =&gt; 2345-12600-002.bootrom.ld static_file =&gt; 2345-12670-001.bootrom.ld static_file =&gt; 2345-12670-002.bootrom.ld static_file =&gt; 3111-15600-001.bootrom.ld static_file =&gt; 3111-30900-001.bootrom.ld static_file =&gt; 3111-40000-001.bootrom.ld static_file =&gt; bootrom.ld static_file =&gt; sip.ver static_file =&gt; sip.ld static_file =&gt; 000000000000-directory.xml ;-    static_file =&gt; languages/Website_dictionary_language_ru-ru.xml static_file =&gt; SoundPointIPLocalization/Russian_Russia/SoundPointIP-dictionary.xml ;------------ <span class="hljs-variable"><span class="hljs-variable">${TOLOWER(${MAC}</span></span>)}.cfg =&gt; 000000000000.cfg ; ,    http://192.168..:8088/phoneprov/111111111111.cfg      000000000000.cfg   111111111111.cfg,         users.conf      macaddress=111111111111 <span class="hljs-variable"><span class="hljs-variable">${TOLOWER(${MAC}</span></span>)}-custom.cfg =&gt; 000000000000-phone.cfg ;   http://192.168..:8088/phoneprov/111111111111-custom.cfg    111111111111-custom.cfg         users.conf      macaddress=111111111111</code> </pre><br>  With static files, everything is simple, if the file is registered in phoneprov.conf and located at the corresponding address, it will be accessible from the web server. <br>  With dynamic it seems a bit more complicated, but now everything will become clear.  Here is an example of templates: <br>  000000000000.cfg <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">APPLICATION</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">APP_FILE_PATH</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sip.ld"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CONFIG_FILES</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${TOLOWER(${MAC})}-custom.cfg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">MISC_FILES</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LOG_FILE_DIRECTORY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OVERRIDES_DIRECTORY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CONTACTS_DIRECTORY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LICENSE_DIRECTORY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">USER_PROFILES_DIRECTORY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CALL_LISTS_DIRECTORY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">APPLICATION</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  By default, all phones request the file 1234123adba.cfg, where 1234123adba is the MAC address of the phone, i.e.  The phone will send the request <a href="">http: //192.168.xxx.xxx: 8088 / phoneprov / 1234123adba.cfg</a> .  There is only one variable in this template, and the directive CONFIG_FILES = "$ {TOLOWER ($ {MAC})} - custom.cfg" turns into CONFIG_FILES = "1234123adba-custom.cfg", which tells the phone that it should download the configuration file 1234123adba -custom.cfg.  The phone will send the request <a href="">http: //192.168..: 8088 / phoneprov / 1234123adba.cfg-custom.cfg.</a> In response to this request, the server will generate another dynamic file based on the second pattern 000000000000-phone.cfg: <br>  000000000000-phone.cfg <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polycomConfig</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:noNamespaceSchemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"polycomConfig.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">call</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">call.callsPerLineKey</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">call</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${USERNAME}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.auth.password</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${SECRET}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.auth.userId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${USERNAME}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${USERNAME}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.outboundProxy.address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${SERVER}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.lineKeys</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.auth.domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${SERVER}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.displayName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${USERNAME}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.server.1.address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${SERVER}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">reg.1.server.1.register</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dhcp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dhcp.bootSrvUseOpt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Static"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dhcp.enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dhcp.enabled</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dhcp.enabled.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dhcp.bootSrvUseOpt</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dhcp.bootSrvUseOpt.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dhcp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dns</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dns.serverAddress</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"192.168.xxx.1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dns.altSrvAddress</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8.8.8.8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dns.serverAddress</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.dns.serverAddress.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.dns</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.prov</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.prov.serverName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://192.168.xxx.xxx:8088/phoneprov/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.prov.serverType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HTTP"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.prov.serverName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.prov.serverName.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.prov.serverType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.prov.serverType.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.prov</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.net</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.net.ipAddress</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"192.168.XXX.${USERNAME}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.net.subnetMask</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"255.255.255.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.net.IPgateway</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"192.168.xxx.1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.net.ipAddress</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.net.ipAddress.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.net.subnetMask</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.net.subnetMask.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.net.IPgateway</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.net.IPgateway.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.net</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.sntp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.sntp.gmtOffset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"14400"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.sntp.serverName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pool.ntp.org"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.sntp.gmtOffset</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.sntp.gmtOffset.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.sntp.serverName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device.sntp.serverName.set</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device.sntp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dialplan</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dialplan.1.digitmap</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dialplan.1.digitmap.timeOut</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dialplan.1.impossibleMatchHandling</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lcl</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lcl.ml</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lcl.ml.lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Russian_Russia"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lcl</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tcpIpApp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tcpIpApp.sntp.daylightSavings</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tcpIpApp.sntp.daylightSavings.enable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tcpIpApp.sntp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tcpIpApp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polycomConfig</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Several variables are used here: <br>  $ {SECRET} will substitute the secret value from the user description with the poppy 1234123adba from users.conf <br>  $ {USERNAME} will substitute the value of username from the description of the user with the poppy 1234123adba from users.conf. <br>  $ {SERVER} will substitute the value from phoneprov.conf <br>  Note!  After changing phoneprov.conf, you need to reload so that the settings are pulled. <br>  After everything is ready check through the console: <br>  phoneprov show routes <br><br>  Static routes should be displayed, dynamic will be only if users.conf have users who have autoprov = yes and set the mass-address <br><br><h5>  Configuring users.conf </h5><br>  Almost everything left to create /etc/asterisk/users.conf.  There is also an opportunity for optimization.  With the zxing application for android, I scanned all the MAC addresses of the phones, straight from the boxes, and from the same application sent them to my email.  It remains the case for small to compare each Maca some account.  Hands to write for each macaddress = ... ..., somehow I did not want to.  I made a <a href="http://astertelecom.ru/images/public/%25D0%25A4%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5%2520%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2584%25D0%25B8%25D0%25B3%25D0%25B0.xlsx">file for automatic generation of Asterisk configs based on tabular data</a> , it also has a password generator. <br><img src="https://habrastorage.org/getpro/habr/post_images/e6a/b67/7f6/e6ab677f6f50fd4fb6ed03d3f2ee7e07.png" width="100%"><br>  It remains only to copy the column and paste into users.conf.  The phones in this project are all the same, so it makes sense to create a template for everyone, and in the user description only add the MAC and password. <br>  /etc/asterisk/users.conf <br><pre> <code class="bash hljs">... [def](!) ;-   <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=friend fromuser=<span class="hljs-string"><span class="hljs-string">"CPZ"</span></span> host=dynamic nat=no disallow=all allow=ulaw allow=alaw hasvoicemail = no hassip = yes hasiax = no hash323 = no hasmanager = no qualify=yes autoprov = yes ;-      context=full [101](def) secret=XAHNGNCCXGR macaddress=0004f24ab859 [102](def) secret=OSANPHVZIEX macaddress=0004f24abdd6 [103](def) secret=AHUDYLSXFGT macaddress=0004f24ab766 ‚Ä¶‚Ä¶</code> </pre><br>  Everything is ready check through the console: phoneprov show routes <br>  Both static routes and dynamic routes should be displayed.  It remains to check the browser <a href="http://192.168.xn--u1aaa.xn--u1aaa/">192.168.xxx.xxx</a> : 8088 / phoneprov / 1234123adba.cfg for example, and you can turn on the phones, then everything happens by itself. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/aAJMNp8amwA%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700190,15700253&amp;usg=ALkJrhi9a_j4Lr2aVY6tR_huVs5YZ2WwVA" frameborder="0" allowfullscreen=""></iframe><br><br>  Do not forget about security, after deploying the infrastructure, it is better to disable the FTP server and on the asterisk the embedded web server, before the need to update configs or software.  If you need to change the configuration often, use HTTPS. </div><p>Source: <a href="https://habr.com/ru/post/218227/">https://habr.com/ru/post/218227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218213/index.html">RAW Developers for Mac OS X RPP and Aperture: Apple Exclusive in the hands of amateur photographer</a></li>
<li><a href="../218215/index.html">Web application evolution</a></li>
<li><a href="../218217/index.html">[video] How to put a person in place: 10 real questions about the pressure in the negotiations</a></li>
<li><a href="../218221/index.html">April 4 - the Day of St. Isidore of Seville and the day of the webmaster</a></li>
<li><a href="../218225/index.html">Micro ORM one class</a></li>
<li><a href="../218229/index.html">Compile life</a></li>
<li><a href="../218231/index.html">SaltStack: managing an arbitrary number of configuration files</a></li>
<li><a href="../218233/index.html">LPC1102 and warm lamp indicator</a></li>
<li><a href="../218237/index.html">Creating a hosting site based on Proxmox + HP ProLiant</a></li>
<li><a href="../218241/index.html">Happy webmasters!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>