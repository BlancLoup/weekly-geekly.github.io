<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What errors are hiding in the code Infer.NET?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The publication by Microsoft of the source code of their projects is quite a good reason to check them. This time was no exception, and today we will ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What errors are hiding in the code Infer.NET?</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3f/18a/6a6/d3f18a6a6127aceeae10d53591e0ce65.png"></div><br>  The publication by Microsoft of the source code of their projects is quite a good reason to check them.  This time was no exception, and today we will look at suspicious places found in the Infer.NET code.  Down with annotation - more to the point! <br><a name="habracut"></a><br><h2>  A little bit about the project and analyzer </h2><br>  Infer.NET is a machine learning system developed by Microsoft experts.  The source code for the project has recently become available on <a href="https://github.com/dotnet/infer">GitHub</a> , which was the reason for checking it out.  More details about the project can be read, for example, <a href="https://dotnet.github.io/infer/">here</a> . <br><br>  The project was checked with the help of the PVS-Studio static analyzer version 6.26.  I remind you that PVS-Studio is looking for errors in the code in C \ C ++ \ C # (and soon in Java) under Windows, Linux, macOS.  C # code while analyzing only under Windows.  The analyzer can be <a href="https://www.viva64.com/ru/pvs-studio-download/">downloaded and tried</a> on your project. <br><br>  The test itself was extremely simple and without problems.  I previously unloaded the project from GitHub, restored the required packages (dependencies) and made sure that the project is being successfully built.  This is required in order for the analyzer to have access to all the necessary information to conduct a comprehensive analysis.  After assembling in a couple of clicks, I launched the analysis of the solution through the PVS-Studio plugin for Visual Studio. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      By the way, this is not the first project from Microsoft, tested with PVS-Studio - there were others: <a href="https://www.viva64.com/ru/b/0363/">Roslyn</a> , <a href="https://www.viva64.com/ru/b/0424/">MSBuild</a> , <a href="https://www.viva64.com/ru/b/0447/">PowerShell</a> , <a href="https://www.viva64.com/ru/b/0365/">CoreFX</a> and <a href="https://www.viva64.com/ru/inspections/">others</a> . <br><br>  <b>Note</b>  If you or your friends are interested in analyzing Java code - you can write to us in <a href="https://www.viva64.com/ru/about-feedback/">support</a> by selecting the item ‚ÄúI want an analyzer for Java‚Äù.  There is no public beta-version of the analyzer yet, but it should appear soon.  Somewhere in the secret laboratory (through the wall) the guys are actively working on it. <br><br>  But enough of the abstract conversations - let's look at the problems in the code. <br><br><h2>  Is this a bug or a feature? </h2><br>  I propose to try to find the error yourself - a completely solvable problem.  No joke in the spirit of what was in the article " <a href="https://www.viva64.com/ru/b/0565/">Top 10 errors in C ++ projects for 2017</a> ", honestly.  So do not rush to read the analyzer warning presented after the code fragment. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MergeParallelTransitions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( transition1.DestinationStateIndex == transition2.DestinationStateIndex &amp;&amp; transition1.Group == transition2.Group) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (transition1.IsEpsilon &amp;&amp; transition2.IsEpsilon) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!transition1.IsEpsilon &amp;&amp; !transition2.IsEpsilon) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsInfinity(transition1.Weight.Value) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsInfinity(transition1.Weight.Value)) { newElementDistribution.SetToSum( <span class="hljs-number"><span class="hljs-number">1.0</span></span>, transition1.ElementDistribution, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, transition2.ElementDistribution); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newElementDistribution.SetToSum( transition1.Weight.Value, transition1.ElementDistribution, transition2.Weight.Value, transition2.ElementDistribution); } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3001/">warning</a> : <a href="https://www.viva64.com/ru/w/v3001/">V3001</a> There are identical.-double.IsInfinity (transition1.Weight.Value) there are identical sub-expressions.  Runtime Automaton.Simplification.cs 479 <br><br>  As can be seen from the code fragment, the method is working with a couple of variables - <i>transition1</i> and <i>transition2</i> .  The use of similar names is sometimes quite justified, but it is worth remembering that in this case the probability of accidentally making a mistake somewhere with a name increases. <br><br>  This is <i>what</i> happened when checking numbers to infinity ( <i>double.IsInfinity</i> ).  Because of the error, we checked the value of the same variable 2 times - <i>transition1.Weight.Value</i> .  The variable in the second subexpression should be <i>transition2.Weight.Value</i> . <br><br>  Another similar suspicious code. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> MethodBase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToMethodInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMethodReference imr</span></span></span><span class="hljs-function">)</span></span> { .... bf |= BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance; .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://www.viva64.com/ru/w/v3001/">V3001</a> There are identical sub-expressions of 'BindingFlags.Public'  operator.  Compiler CodeBuilder.cs 194 <br><br>  When generating the value of the <i>bf</i> variable, the <i>BindingFlags.Public</i> enumeration element is used twice.  Either this code contains an extra flag setting operation, or instead of the second use of <i>BindingFlags.Public, there</i> should be a different enum value. <br><br>  By the way, in the source this code is written in one line.  It seems to me that if it is formatted in tabular style (like here), the problem is easier to detect. <br><br>  Go ahead.  I give the whole body of the method and again I suggest you find the error (or maybe the error) on your own. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForEachPrefix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression expr, Action&lt;IExpression&gt; action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// This method must be kept consistent with GetTargets. if (expr is IArrayIndexerExpression) ForEachPrefix(((IArrayIndexerExpression)expr).Target, action); else if (expr is IAddressOutExpression) ForEachPrefix(((IAddressOutExpression)expr).Expression, action); else if (expr is IPropertyReferenceExpression) ForEachPrefix(((IPropertyReferenceExpression)expr).Target, action); else if (expr is IFieldReferenceExpression) { IExpression target = ((IFieldReferenceExpression)expr).Target; if (!(target is IThisReferenceExpression)) ForEachPrefix(target, action); } else if (expr is ICastExpression) ForEachPrefix(((ICastExpression)expr).Expression, action); else if (expr is IPropertyIndexerExpression) ForEachPrefix(((IPropertyIndexerExpression)expr).Target, action); else if (expr is IEventReferenceExpression) ForEachPrefix(((IEventReferenceExpression)expr).Target, action); else if (expr is IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); else if (expr is IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); else if (expr is IMethodInvokeExpression) ForEachPrefix(((IMethodInvokeExpression)expr).Method, action); else if (expr is IMethodReferenceExpression) ForEachPrefix(((IMethodReferenceExpression)expr).Target, action); else if (expr is IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); else if (expr is IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); else if (expr is IDelegateInvokeExpression) ForEachPrefix(((IDelegateInvokeExpression)expr).Target, action); action(expr); }</span></span></code> </pre> <br>  Found?  Checking! <br><br>  <b>PVS-Studio warnings</b> : <br><ul><li>  <a href="https://www.viva64.com/ru/w/v3003/">V3003</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 1719, 1727. Compiler CodeRecognizer.cs 1719 </li><li>  <a href="https://www.viva64.com/ru/w/v3003/">V3003</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 1721, 1729. Compiler CodeRecognizer.cs 1721 </li></ul><br>  Let's simplify the code a bit so that the problems become more obvious. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForEachPrefix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression expr, Action&lt;IExpression&gt; action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action) .... }</code> </pre> <br>  Conditional expressions and <i>then-</i> branches of several <i>if statements are</i> duplicated.  Perhaps this code was written using the copy-paste method, which is why the problem arose.  Now it turns out that the <i>then-</i> branches of duplicates will never be executed, since: <br><br><ul><li>  if the conditional expression is true, the body of the first <i>if statement</i> from the corresponding pair is executed; </li><li>  if the conditional expression is false in the first case, it will be false in the second. </li></ul><br>  Since the <i>then-</i> branches contain the same actions, now it looks like a redundant code that is confusing.  It is possible that there is a problem of another kind - instead of duplicates, other checks should have been performed. <br><br>  We continue. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Pair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; x, Pair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.First &lt; y.First) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.Second &gt;= y.Second) { <span class="hljs-comment"><span class="hljs-comment">// y strictly contains x return 1; } else { // No containment - order by left bound return 1; } } else if (x.First &gt; y.First) { if (x.Second &lt;= y.Second) { // x strictly contains y return -1; } else { // No containment - order by left bound return -1; } } .... }</span></span></code> </pre> <br>  <b>PVS-Studio warnings</b> : <br><ul><li>  <a href="https://www.viva64.com/ru/w/v3004/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  Runtime RegexpTreeBuilder.cs 1080 </li><li>  <a href="https://www.viva64.com/ru/w/v3004/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  Runtime RegexpTreeBuilder.cs 1093 </li></ul><br>  The code looks extremely suspicious, as it contains two conditional operators with the same bodies <i>then</i> and <i>else-</i> branches.  Probably in both cases it is worth returning different values.  Or, if this is conceived behavior, it will be useful to remove redundant conditional statements. <br><br>  There were interesting cycles.  Example below: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Set&lt;StochasticityPattern&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntersectPatterns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;StochasticityPattern&gt; patterns</span></span></span><span class="hljs-function">)</span></span> { Set&lt;StochasticityPattern&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Set&lt;StochasticityPattern&gt;(); result.AddRange(patterns); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> changed; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = result.Count; AddIntersections(result); changed = (result.Count != count); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (changed); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3020/">warning</a> : <a href="https://www.viva64.com/ru/w/v3020/">V3020</a> An unconditional 'break' within a loop.  Compiler DefaultFactorManager.cs 474 <br><br>  Because of the unconditional <i>break</i> statement, exactly one iteration of the loop is performed, and the <i>changed</i> control variable is not even used.  In general, the code looks strange and suspicious. <br><br>  The same method (exact copy) met in another class.  Appropriate analyzer warning: <a href="https://www.viva64.com/ru/w/v3020/">V3020</a> An unconditional 'break' within a loop.  Visualizers.Windows FactorManagerView.cs 350 <br><br>  By the way, the method met with the unconditional <i>continue</i> operator in the loop (it was found by the analyzer with the same diagnostics), but above it was a comment confirming that this is a special temporary solution: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// TEMPORARY continue;</span></span></code> </pre> <br>  I remind you that there were no such comments near the unconditional <i>break</i> operator. <br><br>  Go ahead. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> DependencyInformation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDependencyInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... IExpression resultIndex = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultIndex != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.IsDefined( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SkipIfMatchingIndexIsUniformAttribute), <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultIndex == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InferCompilerException( parameter.Name + <span class="hljs-string"><span class="hljs-string">" has SkipIfMatchingIndexIsUniformAttribute but "</span></span> + StringUtil.MethodNameToString(method) + <span class="hljs-string"><span class="hljs-string">" has no resultIndex parameter"</span></span>); .... } .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3022/">warning</a> : <a href="https://www.viva64.com/ru/w/v3022/">V3022</a> Expression 'resultIndex == null' is always false.  Compiler FactorManager.cs 382 <br><br>  Immediately, I note that between the declaration and the above test, the value of the variable <i>resultIndex</i> may change.  However, between the checks of <i>resultIndex! = Null</i> and <i>resultIndex == null, the</i> value cannot be changed.  Therefore, the result of the expression <i>resultIndex == null</i> will always be <i>false</i> , which means that an exception will never be generated. <br><br>  I hope that you have an interest in finding errors yourself without my suggestions to find a problem, but just in case I will suggest doing it again.  The code for the method is small; <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Tuple&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeMovieGenre</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> feature</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] genres = feature.Split(<span class="hljs-string"><span class="hljs-string">'|'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (genres.Length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; genres.Length &gt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Movies should have between 1 and 3 genres; given {0}."</span></span>, genres.Length)); } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / genres.Length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"{0}:{1}"</span></span>, offset + MovieGenreBuckets[genres[<span class="hljs-number"><span class="hljs-number">0</span></span>]], <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; genres.Length; ++i) { result.Append( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"|{0}:{1}"</span></span>, offset + MovieGenreBuckets[genres[i].Trim()], <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tuple&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(MovieGenreBucketCount, result.ToString()); }</code> </pre> <br>  Let's see what happens here.  The input string is parsed by the '|' character.  If the array length is not as expected, an exception must be generated.  <i>Wait a second</i> ... <i>genres.Length &lt;1 &amp;&amp; genres.Length&gt; 3</i> ?  Since there is no number that would immediately fall into both values ‚Äã‚Äãof the range ( <i>[int.MinValue..1)</i> and <i>(3..int.MaxValue]</i> ) required by the expression, the result of the expression will always be <i>false</i> .  Therefore, this check does not protect against anything, and the expected exception will not be generated. <br><br>  This is what the analyzer warns about: <a href="https://www.viva64.com/ru/w/v3022/">V3022</a> Expression 'genres.Length &lt;1 &amp;&amp; genres.Length&gt; 3' is always false.  Probably the '||'  operator should be used here.  Evaluator Features.cs 242 <br><br>  A suspicious division operation has been encountered. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateTrueThetaAndPhi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expectedRepeatOfTopicInDoc = averageDocLength / numUniqueTopicsPerDoc; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = Poisson.Sample(expectedRepeatOfTopicInDoc); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3041/">warning</a> : <a href="https://www.viva64.com/ru/w/v3041/">V3041</a> The expression was implicitly cast from 'int' type to 'double' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  LDA Utilities.cs 74 <br><br>  The following is suspicious: the integer division is performed (the variables <i>averageDocLength</i> and <i>numUniqueTopicsPerDoc</i> are of type <i>int</i> ), and the result is written to a variable of type <i>double</i> .  This begs the question: was it specially done, or was it still meant the division of real numbers?  If the variable <i>expectedRepeatOfTopicInDoc</i> were of type <i>int</i> , this would remove the possible questions. <br><br>  In other places, the <i>Poisson.Sample</i> method, whose argument is the suspicious variable <i>expectedRepeatOfTopicInDoc</i> , is used, for example, as described below. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numUniqueWordsPerTopic = Poisson.Sample((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)averageWordsPerTopic);</code> </pre> <br>  <i>averageWordsPerTopic</i> is of type <i>int</i> , which at the place of use is <i>cast</i> to <i>double</i> . <br><br>  And here is another place of use: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expectedRepeatOfWordInTopic = ((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)numDocs) * averageDocLength / numUniqueWordsPerTopic; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = Poisson.Sample(expectedRepeatOfWordInTopic);</code> </pre> <br>  Notice that the variables have the same names as in the original example, only for initializing the <i>expectedRepeatOfWordInTopic</i> , the division of real numbers is used (due to the explicit reduction of <i>numDocs</i> to <i>double</i> type). <br><br>  In general, it is worth looking at the original place to which the analyzer issued a warning. <br><br>  But thinking about whether to correct it, and how, let's leave it to the authors of the code (they know better), and go ahead.  To the next suspicious division. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NonconjugateGaussian </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BAverageLogarithm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_opt = <span class="hljs-number"><span class="hljs-number">2</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span> * (Math.Log(mx * mz / Ex2 / <span class="hljs-number"><span class="hljs-number">2</span></span>) - m); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v_opt != v) { .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3041/">warning</a> : <a href="https://www.viva64.com/ru/w/v3041/">V3041</a> The expression was implicitly cast from 'int' type to 'double' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  Runtime ProductExp.cs 137 <br><br>  The analyzer again detected a suspicious integer division operation, since  <i>2</i> and <i>3</i> are integer numeric literals, and the result of the expression 2/3 is <i>0</i> .  As a result, the whole expression takes the form: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_opt = <span class="hljs-number"><span class="hljs-number">0</span></span> * expr;</code> </pre> <br>  Agree, a bit strange.  Several times I returned to this warning, trying to find some kind of trick, and not trying to add it to the article.  The method is filled with mathematics and different formulas (which, to be honest, we didn‚Äôt really want to), is there anything to expect.  In addition, I try to be as skeptical as possible about the warnings that I write to the article, and I describe them only after studying better. <br><br>  But then it dawned on me - why do we need a multiplier in the form of <i>0</i> , written as <i>2/3</i> ?  So this place is, in any case, worth a look. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextWriter writer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defaultValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; converter = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( defaultValue == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Equals(defaultValue)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> stringValue = converter == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ToString() : converter(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); writer.Write(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">=\"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{stringValue}</span></span></span><span class="hljs-string">\" "</span></span>); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3080/">warning</a> : <a href="https://www.viva64.com/ru/w/v3080/">V3080</a> Possible null dereference.  Consider inspecting 'value'.  Compiler WriteHelpers.cs 78 <br><br>  It is a fair statement of the analyzer based on the condition.  A dereferencing null reference can occur in a <i>value.Equals (defaultValue)</i> expression if <i>value == null</i> .  Since this expression is the right operand of the operator ||, to calculate it, the left operand must be <i>false</i> , and for this it suffices that at least one of the variables <i>defaultValue</i> \ <i>value is</i> not <i>null</i> .  As a result, if <i>defaultValue! = Null</i> , and <i>value == null</i> : <br><br><ul><li>  <i>defaultValue == null</i> -&gt; <i>false</i> ; </li><li>  <i>defaultValue == null &amp;&amp; value == null</i> -&gt; <i>false</i> ;  ( <i>value</i> check failed) </li><li>  <i>value.Equals (defaultValue)</i> -&gt; <i>NullReferenceException</i> , since <i>value</i> is <i>null</i> . </li></ul><br>  Let's look at a similar case: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FeatureParameterDistribution</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> GaussianMatrix traitFeatureWeightDistribution, GaussianArray biasFeatureWeightDistribution</span></span></span><span class="hljs-function">)</span></span> { Debug.Assert( (traitFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; biasFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || traitFeatureWeightDistribution.All( w =&gt; w != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; w.Count == biasFeatureWeightDistribution.Count), <span class="hljs-string"><span class="hljs-string">"The provided distributions should be valid and consistent in the number of features."</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3080/">warning</a> : <a href="https://www.viva64.com/ru/w/v3080/">V3080</a> Possible null dereference.  Consider inspecting 'traitFeatureWeightDistribution'.  Recommender FeatureParameterDistribution.cs 65 <br><br>  Let's throw out the excess, leaving only the logic for calculating the Boolean value, to make it easier to understand: <br><br><pre> <code class="cs hljs">(traitFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; biasFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || traitFeatureWeightDistribution.All( w =&gt; w != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; w.Count == biasFeatureWeightDistribution.Count)</code> </pre> <br>  Again, the right operand of the operator ||  calculated only if the result of calculating the left is <i>false</i> .  The left operand can be <i>false</i> , including when <i>traitFeatureWeightDistribution == null</i> and <i>biasFeatureWeightDistribution! = Null</i> .  Then the right operand of the operator || will be calculated, and the call to <i>traitFeatureWeightDistribution.All</i> will result in an <i>ArgumentNullException</i> . <br><br>  Another interesting code snippet: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetQuantile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> probability, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] quantiles</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = quantiles.Length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (quantiles == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(quantiles)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"quantiles array is empty"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(quantiles)); .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://www.viva64.com/ru/w/v3095/">V3095</a> The 'quantiles' object was used against it.  Check lines: 91, 92. Runtime OuterQuantiles.cs 91 <br><br>  Notice that the <i>quantiles.Length</i> property is <i>first accessed</i> , and then <i>quantiles are</i> checked for equality <i>null</i> .  In summary, if <i>quantiles == null</i> , the method will throw an exception, just a little bit wrong, and a bit out of place where it was needed.  Apparently, they mixed up the lines in some places. <br><br>  If you have successfully coped with the detection of the errors given earlier on your own, I suggest you brew a cup of coffee and try the feat again, finding an error in the method below.  To make it a bit more interesting, I quote the whole method code. <br><br>  ( <a href="">Link to full size</a> ) <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c2c/5ff/2d9/c2c5ff2d99aca64bbda4136acfa4b1d4.png" alt="Picture 2"></p><br><br>  Okay, okay, it was a joke (or did you still succeed ?!).  Let's simplify the task a bit: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.Precision &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { precisionIsBetween = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; lowerBound = <span class="hljs-number"><span class="hljs-number">-1.0</span></span> / v; upperBound = -mean.Precision; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.Precision &lt; -mean.Precision) { precisionIsBetween = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; lowerBound = <span class="hljs-number"><span class="hljs-number">0</span></span>; upperBound = -mean.Precision; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// in this case, the precision should NOT be in this interval. precisionIsBetween = false; lowerBound = -mean.Precision; lowerBound = -1.0 / v; }</span></span></code> </pre> <br>  Got better?  The analyzer issued the following warning for this code: <a href="https://www.viva64.com/ru/w/v3008/">V3008</a> The 'lowerBound' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 324, 323. Runtime GaussianOp.cs 324 <br><br>  Indeed, in the last <i>else</i> branch, the value of the variable <i>lowerBound is</i> assigned twice in a row.  Apparently (and judging by the code above), the variable <i>upperBound</i> should participate in one of the assignments. <br><br>  Follow on. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAucMatrix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; classLabelCount; c++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> labelWidth = labels[c].Length; columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>] = labelWidth &gt; MaxLabelWidth ? MaxLabelWidth : labelWidth; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>; r &lt; classLabelCount; r++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> countWidth = MaxValueWidth; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countWidth &gt; columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>] = countWidth; } } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3081/">warning</a> : <a href="https://www.viva64.com/ru/w/v3081/">V3081</a> The 'r' counter is not used inside a loop.  Consider inspecting usage of 'c' counter.  CommandLine ClassifierEvaluationModule.cs 459 <br><br>  Please note that the internal loop counter - <i>r</i> - is not used in the body of this cycle.  Because of this, it turns out that during all iterations of the inner loop, the same operations are performed on the same elements - after all, the indices also use the counter of the outer loop ( <i>c</i> ), and not the inner one ( <i>r</i> ). <br><br>  Let's see what else was interesting. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegexpFormattingSettings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> putOptionalInSquareBrackets, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> showAnyElementAsQuestionMark, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreElementDistributionDetails, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> truncationLength, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> escapeCharacters, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useLazyQuantifier</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PutOptionalInSquareBrackets = putOptionalInSquareBrackets; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ShowAnyElementAsQuestionMark = showAnyElementAsQuestionMark; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IgnoreElementDistributionDetails = ignoreElementDistributionDetails; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TruncationLength = truncationLength; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EscapeCharacters = escapeCharacters; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3117/">warning</a> : <a href="https://www.viva64.com/ru/w/v3117/">V3117</a> Constructor parameter 'useLazyQuantifier' is not used.  Runtime RegexpFormattingSettings.cs 38 <br><br>  The constructor does not use one parameter - <i>useLazyQuantifier</i> .  It looks especially suspicious against the background of the fact that the class defines a property with the appropriate name and type - <i>UseLazyQuantifier</i> .  Apparently, they forgot to initialize it through the corresponding parameter. <br><br>  There are several potentially dangerous event handlers.  An example of one of them is shown below: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RecommenderRun</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventHandler Started; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Report that the run has been started if (this.Started != null) { this.Started(this, EventArgs.Empty); } .... } .... }</span></span></code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3083/">warning</a> : <a href="https://www.viva64.com/ru/w/v3083/">V3083</a> Unsafe invocation of event 'Started', NullReferenceException is possible.  Consider assigning an event to a local variable before invoking it.  Evaluator RecommenderRun.cs 115 <br><br>  The fact is that between checking for <i>null</i> inequality and calling the handler, an unsubscribing event can occur, and if at the time between checking for <i>null</i> and calling the handler the event has no subscribers, a <i>NullReferenceException</i> will be <i>thrown</i> .  To avoid such problems, you can, for example, save a reference to a chain of delegates to a local variable or use the '?.'  to call handlers. <br><br>  In addition to the above code snippet, there were 35 such places. <br><br>  By the way, <b>785</b> warnings of <a href="https://www.viva64.com/ru/w/v3024/">V3024</a> were met.  The warning <a href="https://www.viva64.com/ru/w/v3024/">V3024</a> is issued when comparing real numbers using the '! =' Or '==' operators.  I will not dwell here on why such comparisons are not always correct - for more details, see the documentation, there is also a link to <a href="https://stackoverflow.com/questions/1398753/comparing-double-values-in-c-sharp">StackOverflow</a> (this is it). <br><br>  Considering that formulas and calculations were often encountered, these warnings can also be important, although they are placed at level 3 (since not all projects are relevant at all). <br><br>  If there is a certainty that these warnings are irrelevant - you can remove them with <a href="https://www.viva64.com/ru/m/0013/">almost one click</a> , reducing the total number of analyzer responses. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47e/77b/72d/47e77b72dbb716dadbd1623513150819.png"></div><br><br><h2>  Conclusion </h2><br>  Somehow it happened that I hadn‚Äôt written articles about project validation for a long time, and it was quite pleasant to touch this process again.  I hope that you learned something new / useful from this article, or at least read it with interest. <br><br>  I wish the developers to fix the problem areas as soon as possible and remind that making mistakes is normal, yet we are human.  That's why additional tools like static analyzers are needed to find what a person missed, right?  Anyway - good luck with the project, and thanks for the work! <br><br>  And remember that the maximum benefit from the static analyzer is achieved with its <i>regular use</i> . <br><br>  All the best! <br><br><p> <a href="https://www.viva64.com/en/b/0590/"><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Sergey Vasiliev.  <a href="https://www.viva64.com/en/b/0590/">What Errors Lurk in Infer .NET Code?</a> </div><p>Source: <a href="https://habr.com/ru/post/429578/">https://habr.com/ru/post/429578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429566/index.html">Own VPN client on JavaScript. Part 2 - Development</a></li>
<li><a href="../429568/index.html">Reduce Zimbra downtime during a server crash with Zextras Backup</a></li>
<li><a href="../429570/index.html">Teaching an agent to play Mario Kart using filters</a></li>
<li><a href="../429572/index.html">Capturing private conversations on Skype with Devicelock DLP</a></li>
<li><a href="../429574/index.html">Free Check Point for Beginners course at CheckMates</a></li>
<li><a href="../429580/index.html">Microinteractions in iOS. Yandex lecture</a></li>
<li><a href="../429582/index.html">Analog indicator of computer load</a></li>
<li><a href="../429584/index.html">Yandex launched a rating of Russian sites: the audience is calculated by a mathematical model on machine learning</a></li>
<li><a href="../429586/index.html">How to determine the best time for a transaction on the exchange</a></li>
<li><a href="../429588/index.html">The whole truth about the RTOS. Article # 20. Semaphores: helper services and data structures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>