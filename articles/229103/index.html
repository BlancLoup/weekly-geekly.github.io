<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GUI Automation (Photoshop + Starling)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task was to automate the GUI build for one project X. 

 1 Current implementation 
 The artist does all his business in photoshop and gives them t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GUI Automation (Photoshop + Starling)</h1><div class="post__text post__text-html js-mediator-article">  The task was to automate the GUI build for one project X. <br><br><h2>  1 Current implementation </h2><br>  The artist does all his business in photoshop and gives them to programmers.  The programmers, in turn, somehow pull the textures or atlases themselves and use the wipes to position each individual element on the stage flash drives, then add all text fields and effects to the pens, prescribe coordinates to all these elements, which are obtained thanks to the utility.  The result is a very long and painful work, and when you consider that the programmer does it, it is AD. <br><a name="habracut"></a><br><h2>  1.1 Current Issues </h2><br>  The programmer has to: <br><ul><li>  long and painfully kick out all the textures from the project </li><li>  position all elements </li><li>  create instances of classes and set them the desired properties </li><li>  select text color size </li><li>  select the effect, if any </li><li>  3 million times run and check </li></ul><br>  I'm not talking about the case when something changes. <br><br><h2>  2 Solution </h2><br><ul><li>  A script that pushes JSON out of psd with all the settings and parameters + textures of all elements on the scene. </li><li>  We collect in the atlas </li><li>  Engine for the client (flash), which collects the whole thing in a heap. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  2.1 Restrictions </h2><br><ul><li>  A small preparation of psd before export, namely the union of all layers and effects of the object.  Those.  If there is a button and a layer with a highlight above it, then these layers need to be merged. </li><li>  All psd sources should be with project extension on flash </li><li>  It is necessary to rasterize all layers (maybe farther away) </li></ul><br><br><h2>  2.2 What we need </h2><br><ul><li>  Adobe Photoshop CC </li><li>  Adobe ExtendScript Toolkit CS5 </li><li>  TexturePackerGUI </li><li>  intel ideja + (starling) </li><li>  Some knowledge of JS &amp;&amp; AS </li></ul><br><br><h2>  3 psd preparation </h2><br>  * it is taken into account that each separate layer is 1 element on the scene. <br>  This is what the psd itself looks like: <br><img src="https://habrastorage.org/getpro/habr/post_images/485/cd3/835/485cd383525c8a0064a10d60cc04f3ea.jpg" alt="image"><br><br><h2>  3.1 Writing the jsx script </h2><br>  Open the Adobe ExtendScript Toolkit and change the target: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e66/a8b/d1a/e66a8bd1a877273cf5e8457dd885da02.jpg" alt="image"><br><br>  If you do not have such a tab, then I advise you to update photoshop.  I struggled with this until I found a build with the Adobe Application Manager included. <br><br><h2>  3.1.1 Script </h2><br>  The basis of the basics: <br><br><pre><code class="javascript hljs">#target photoshop <span class="hljs-comment"><span class="hljs-comment">//        app.bringToFront(); //      </span></span></code> </pre> <br><br>  Next we need to connect lib to work with JSON, since standard js does not want to work. <br>  Liba itself rather big, so put it separately.  All that is inside you just need to copy the script into the document, since we will do one document to easily transfer it. <br>  <a href="http://pastebin.com/Zmgg4bds">jam_lib</a> <br>  Constants necessary to identify the type with which we work <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> TYPE_SPRITE = <span class="hljs-string"><span class="hljs-string">"sprite"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> TYPE_TEXT = <span class="hljs-string"><span class="hljs-string">"text"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> TYPE_COLLECTION = <span class="hljs-string"><span class="hljs-string">"collection"</span></span>;</code> </pre><br><br>  Main variables in the script <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arts = app.activeDocument.artLayers<span class="hljs-comment"><span class="hljs-comment">//     var sets = app.activeDocument.layerSets;//   var respont = new Object();//.       var arr = new Array();//.     var u = 0;//  .  var width_document = app.activeDocument.width.value; var heigth_document = app.activeDocument.height.value;</span></span></code> </pre><br><br>  Then we say Start, and we ask you to choose a place to save the result in JSON format (textures will also be added there). <br><br><pre> <code class="javascript hljs">alert(<span class="hljs-string"><span class="hljs-string">"!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> defaultInFolder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Folder (<span class="hljs-string"><span class="hljs-string">"C:\\"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsonFilter =<span class="hljs-string"><span class="hljs-string">"JSON Text Files:*.json,All Files:*.*"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inFile = defaultInFolder.saveDlg (<span class="hljs-string"><span class="hljs-string">"Open JSON text file:"</span></span>, jsonFilter);</code> </pre><br><br>  Check on the validity of the selected path and run the script. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(inFile) main();</code> </pre><br><br>  The main function is our execution entry point. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j=<span class="hljs-number"><span class="hljs-number">0</span></span>; j&lt;arts.length; j++) {<span class="hljs-comment"><span class="hljs-comment">//    respont[u] = setLayers(arts[j]); //  .    u+=1; } for(var i = 0;i&lt;sets.length;i++)//    { respont[u] = setSets(sets[i]); //  .    u+=1; } for(var i = 0;i&lt;arr.length;i++)//      { visible(false);//  visibleElement(arr[i],true);//     saveLayer (arr[i]);//  } visible(true);//    jamUtils.writeJsonFile (inFile, respont, 4);//    . alert ("!"); }</span></span></code> </pre><br><br>  Sheet group pars function <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSets</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(); res[<span class="hljs-string"><span class="hljs-string">"type"</span></span>] = TYPE_COLLECTION; res[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = set.name; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j=<span class="hljs-number"><span class="hljs-number">0</span></span>; j&lt;set.artLayers.length ; j++) { res[j] = setLayers(set.artLayers[j]); <span class="hljs-comment"><span class="hljs-comment">//      } return res; }</span></span></code> </pre><br><br>  Parsing the sheet itself. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLayers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">el</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y; x = el.bounds[<span class="hljs-number"><span class="hljs-number">0</span></span>].value; y = el.bounds[<span class="hljs-number"><span class="hljs-number">1</span></span>].value; res[<span class="hljs-string"><span class="hljs-string">"x"</span></span>] = x; res[<span class="hljs-string"><span class="hljs-string">"y"</span></span>] = y; res[<span class="hljs-string"><span class="hljs-string">"alpha"</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(el.opacity)/<span class="hljs-number"><span class="hljs-number">100</span></span>;<span class="hljs-comment"><span class="hljs-comment">//   0-1 res["name"] = el.name.replace(/\s+/g, '');//     try{//      var textItem = el.textItem res["type"] = TYPE_TEXT;//     , ,   res["color"] = textItem.color.rgb.hexValue; res["font"] = textItem.font; res["size"] = Math.round(textItem.size.value); res["contents"] = textItem.contents; res["width"] = Math.round(textItem.width.value); res["height"] = Math.round(textItem.height.value); }catch(e) { res["type"] = TYPE_SPRITE; } arr.push(el); return res; }</span></span></code> </pre><br><br>  The parsing of the texture preservation itself looks like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveLayer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">layer</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textItem = layer.textItem <span class="hljs-comment"><span class="hljs-comment">// ,       return; }catch(e){ } activeDocument.activeLayer = layer; var o = layer.opacity; //     var xx = (layer.bounds[0].value); var yy = (layer.bounds[1].value); var ww = (layer.bounds[2].value); var hh = (layer.bounds[3].value); var shape = [ [xx, yy], [ww,yy], [ww,hh], [xx,hh] ]; app.activeDocument.selection.select(shape);//   app.activeDocument.selection.translate(new UnitValue(-xx,"px"),new UnitValue(-yy,"px"));//   0 0 app.activeDocument.selection.deselect();//   app.activeDocument.resizeCanvas(new UnitValue(ww-xx, "px"), new UnitValue(hh-yy, "px"), AnchorPosition.TOPLEFT);//      activeDocument.activeLayer.opacity = 100;//  100 var saveFile= File(inFile.path+"/"+layer.name.replace(/\s+/g, '')+".png"); SavePNG(saveFile);//  activeDocument.activeLayer.opacity = o;//   app.activeDocument.resizeCanvas(new UnitValue(width_document, "px"), new UnitValue(heigth_document, "px"), AnchorPosition.TOPLEFT);//   app.activeDocument. activeLayer.translate(new UnitValue(xx,"px"),new UnitValue(yy,"px"));//   } function SavePNG(saveFile){ var pngOpts = new ExportOptionsSaveForWeb; pngOpts.format = SaveDocumentType.PNG pngOpts.PNG8 = false; pngOpts.transparency = true; pngOpts.interlaced = false; pngOpts.quality = 100; activeDocument.exportDocument(new File(saveFile),ExportType.SAVEFORWEB,pngOpts); }</span></span></code> </pre><br><br>  And 2 pounds.  to display layers. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visibleElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sprite,flag</span></span></span><span class="hljs-function">) </span></span>{ sprite.visible = flag; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visible</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">flag</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;arr.length;i++) { arr[i].visible = flag; } }</code> </pre><br><br><h2>  3.2 Result </h2><br>  After pressing F5 in the editor, specify the path and wait for the words "Done", you can also see how the script does something on the screen (everything changes all the time). <br><br>  The result can be seen in the directory that was specified at the start: <br><br><img src="http://cdn.joxi.ru/uploads/prod/2014/07/07/a51/66e/beec8e251581c05b97892c9f66be8a075a43e339.jpg" alt="image"><br><br>  JSON file itself: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"0"</span></span>: { <span class="hljs-string"><span class="hljs-string">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">205</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">53</span></span>, <span class="hljs-string"><span class="hljs-string">"alpha"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"magic"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"text"</span></span>, <span class="hljs-string"><span class="hljs-string">"color"</span></span>: <span class="hljs-string"><span class="hljs-string">"0006FC"</span></span>, <span class="hljs-string"><span class="hljs-string">"font"</span></span>: <span class="hljs-string"><span class="hljs-string">"Verdana"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-string"><span class="hljs-string">"contents"</span></span>: <span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">417</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">180</span></span> }, <span class="hljs-string"><span class="hljs-string">"1"</span></span>: { <span class="hljs-string"><span class="hljs-string">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">458</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">281</span></span>, <span class="hljs-string"><span class="hljs-string">"alpha"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"el5"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"sprite"</span></span> }, ... <span class="hljs-string"><span class="hljs-string">"6"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"collection"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"btn"</span></span>, <span class="hljs-string"><span class="hljs-string">"0"</span></span>: { <span class="hljs-string"><span class="hljs-string">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">537</span></span>, <span class="hljs-string"><span class="hljs-string">"alpha"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"btn_art"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"sprite"</span></span> } } }</code> </pre><br><br>  Next, we collect the usual texture atlas, I do it using TexturePackerGUI (do not forget to specify the format Sparrow / Starling) <br>  And we throw in the engine assembled in a hurry.  The result itself is visible after N seconds of compilation: <br><br><img src="http://cdn.joxi.ru/uploads/prod/2014/07/07/159/9b9/2e99f0e38ec7c45990b592a6d5e026cca14a06e2.jpg" alt="image"><br><br>  The article turned out to be rather big, so I decided to bring the full script code to the source (starling mini engine, asses, photoshop script).  Available at the link: <a href="">https://www.dropbox.com/s/8jurdz2ze4qzz18/pr.zip</a> </div><p>Source: <a href="https://habr.com/ru/post/229103/">https://habr.com/ru/post/229103/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229091/index.html">Transmission from the depths of the sea: 800 km long NEPTUNE channel holds the Internet to the bottom of the ocean</a></li>
<li><a href="../229093/index.html">Voice over LTE - call without fallback with a very fast call. How we did it</a></li>
<li><a href="../229097/index.html">2GIS API 2.0</a></li>
<li><a href="../229099/index.html">CMS trap</a></li>
<li><a href="../229101/index.html">Game design - revealing a phenomenon or Who is a game design - scientific anatomy of a profession</a></li>
<li><a href="../229105/index.html">Unity vs Adobe Air, or As I wrote the first mobile game</a></li>
<li><a href="../229107/index.html">The portal AllDataCenters.ru with the support of IBM and MERLION launches the Internet project ‚ÄúInfrastructure Matters‚Äù</a></li>
<li><a href="../229109/index.html">Headphone history</a></li>
<li><a href="../229111/index.html">Komodo Edit and Komodo IDE 8 Overview</a></li>
<li><a href="../229113/index.html">Network Storage "WD My Book Live" and its refinement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>