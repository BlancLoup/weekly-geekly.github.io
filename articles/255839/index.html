<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fast detection of MIB modules supported by an SNMP device</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When implementing systems for monitoring and managing IT infrastructure, one often comes across ‚Äúnon-standard‚Äù devices. Often, only such a device is k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fast detection of MIB modules supported by an SNMP device</h1><div class="post__text post__text-html js-mediator-article">  When implementing systems for monitoring and managing IT infrastructure, one often comes across ‚Äúnon-standard‚Äù devices.  Often, only such a device is known for sure that it supports SNMP.  Connecting it to the project will have to start with the answer to the question of what information about yourself it provides.  Usually, a full device survey is conducted for this, and the data obtained is analyzed to reveal useful information ... But here, as they say, there are nuances.  In this post I will talk about one such thing - about the <em>algorithm</em> we have developed <em>for quickly determining the MIB modules ‚Äúsupported‚Äù by a device</em> . <a name="habracut"></a><br><br><h1>  Why is this necessary? </h1><br>  Data on the device can be quite a lot.  For example, the Cisco 2600 router, with which I experimented a bit in the process of writing this article, produces more than 12 thousand values. <br><img src="https://habrastorage.org/files/323/6f4/a66/3236f4a664e140378c8bc8c6fed3d448.png" alt="Cisco Size"><br>  And I must say, this is far from the limit. <br><br>  In this regard, a couple of problems arise: how to find useful / necessary data in this pile of informational wealth, and how to do it in a reasonable time? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The decision of the first lies on the surface: in accordance with the ancient strategy of ‚Äúdivide and conquer‚Äù, it is necessary to divide all collected values ‚Äã‚Äãinto a relatively small number of categories, each of which should be assessed for utility.  The answer to the question ‚Äúhow and to which categories should the data be split?‚Äù Is also quite obvious in this case - all (well, or almost all) data were sorted before us into MIB modules, where descriptions of logically related data elements (variables) are usually added . <br><br><img src="https://habrastorage.org/files/526/998/426/526998426b0149c89f3586b872e68177.png" alt="SNMP Assets"><br>  The standard way of splitting SNMP data in AggreGate Network Manager is by MIB modules. <br><br>  Thus, the subtask of highlighting the necessary information is reduced to displaying the received data on MIB-modules (communication is carried out by the variable identifier - <em>OID</em> ). <br><br>  There are many tools doing something like this.  And all of them (at least, all that are known to us) perform a <em>complete</em> device survey. <br><br>  So, for example, the <a href="http://www.solarwinds.com/engineers-toolset/mib-walk.aspx">MIB Walk</a> utility works as part of the <i>Engineer's Toolset</i> from <i>SolarWinds</i> , which <i>polls</i> the same "pussy" from my computer for 3.5 - 4 minutes.  It seems to be not so much.  But we must bear in mind that this is not the ‚Äúbiggest‚Äù device, and that it is available to me on a weakly loaded local network.  In the context of this ‚Äúcombat‚Äù project, where there is a serious traffic, and the device is on another network, the time of a full survey can grow by orders of magnitude.  And while such a survey is going on, a specialist, whose duties include connecting a device, will somehow become distracted, which is called ‚Äúlose context‚Äù, and here you will have to add time to ‚Äúreturn to the task‚Äù (which often turns out to be a significant weight).  It should also be noted that there are often many such devices in a serious project - in some cases we had to study between 2 and 3 dozens of devices.  In the end, comes a significant amount. <br><br>  One way or another, our own specialists in the implementation of monitoring systems, as well as users who independently set up the system, at some point often began to mention waiting for the completion of a complete survey of SNMP devices as one of the factors that significantly ‚Äúslow down‚Äù their work.  And I had to invent a way to reduce the time of useless waiting.  As a result, we invented and implemented the following algorithm in our system. <br><br><h1>  Algorithm for quick discovery of MIB modules available on an SNMP device </h1><br>  Good problem formulation is half the solution.  We can describe the task as follows. <br><blockquote>  A <em>list of MIB modules</em> and an <em>SNMP device are given.</em> <br>  It is required to determine whether this device is ‚Äúsupported‚Äù by each of these MIB modules. </blockquote>  Such a formulation immediately raises the question: What does "MIB-module <em>supported by</em> device" mean? <br>  The MIB module is a description of some set of SNMP variables.  In light of this, the following answer to the question sounds logical: we will assume that the <em>MIB module is supported if at least one variable described in it is present on the device</em> . <br>  <u>Note</u> : There is a small complexity: the same value can be described in different MIBs.  Below we take this into account. <br><br>  The <strong>idea of ‚Äã‚Äãoptimization</strong> directly follows from this definition: <em>if we find one variable from a certain MIB module on the device, the remaining variables of this module can be excluded from the survey</em> .  Since the variables of the MIB module most often go in fairly large blocks, we can not only noticeably, but, as practice shows, radically reduce the amount of data we need to get from the device.  Due to this, the polling time will also decrease. <br><br>  We get this <strong>algorithm</strong> : <br><ul><li>  First, we will create lists of OIDs described in each MIB of our library.  For each OID, remember which MIB it belongs to (there may be several, remember?), And merge these lists into a single set, sorting the OIDs in lexicographical order </li><li>  Now, having received the next variable from the device using GET_NEXT and defining the MIB-modules to which it belongs, we not only ‚Äúinclude‚Äù these modules in the list of supported, but we can remove from the list all OID belonging to (only) these MIB-modules -s </li><li>  The next GET_NEXT is already done for the first variable in the list of polls. </li></ul><br><br>  Thus, we do not "walk" (WALK) on the device, but literally rush along it in big jumps. <br><br>  Bearing in mind the high ‚Äúaccuracy‚Äù of OIDs in the MIB module, the algorithm can be slightly improved by preliminarily ‚Äúthinning out‚Äù the original OID list: if a certain sequence of OIDs belongs to the same MIB module (or, more generally, to one set of MIB modules), it makes no sense to check them all - the GET_NEXT request to the first one in any case will either give one of this group, or show that this data block is missing on the device. <br><br><h1>  results </h1><br>  The figures show the result of the discovery of MIB modules on the Cisco router mentioned above. <br>  Top of the list of detected modules: <br><img src="https://habrastorage.org/files/412/d76/ae5/412d76ae574449b2afc982b68cc36a6d.png" alt="Cisco MIBs 1"><br><br>  And this is his last page: <br><img src="https://habrastorage.org/files/4ae/f6e/c80/4aef6ec8067b453180ba86cae1aaecf5.png" alt="Cisco MIBs 2"><br><br>  As you can see, <em>found 64 MIB-module</em> .  By the way, the running time of the algorithm is <em>1‚Äì2 seconds.</em> <br><br>  The following screenshot shows the result of detection on a ‚Äúnon-standard‚Äù Hirschmann Railswitch RSB20 device. <br><img src="https://habrastorage.org/files/115/e51/82b/115e5182b6bf4c0eace3e1b51baa11c2.png" alt="Hirschmann mibs"><br>  The last two entries represent the ‚Äúcustom‚Äù MIB modules shipped with this device. <br><br>  The ‚Äúlive‚Äù process of exposing MIB modules on Hirschmann can be seen in our video clip about <a href="http://www.youtube.com/watch%3Fv%3Dr41zI3uFwvk">connecting non-standard devices</a> (gourmets may be interested in the <a href="https://www.youtube.com/watch%3Fv%3D9RhgkpXHL2o">English version</a> ).  True, all the magic with MIBs remains behind the scenes and fits into a two to three second segment, but our approach to working with SNMP devices will become clear. <br><br><h1>  Conclusion </h1><br>  The algorithm for fast detection of MIB modules supported by the device was implemented in the <a href="http://aggregate.tibbo.com/solutions/network_management.html">AggreGate</a> SNMP driver.  At the moment, he is well-established and has been working stably in various projects for monitoring IT infrastructure at various levels for several years now.  Over the past year, no errors have been identified in it, which indicates, at least, that the idea is correct.  Prior to this, from time to time there were inaccuracies, but 99% of them were associated with the agent-specific implementations of the agent implementations that were incorrect in terms of SNMP specifications.  But the client is always right, had to make corrections to the driver, taking into account such "features";  it concerned the implementation of this algorithm. </div><p>Source: <a href="https://habr.com/ru/post/255839/">https://habr.com/ru/post/255839/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255829/index.html">Spring + Hibernate for beginners</a></li>
<li><a href="../255831/index.html">Free VID PID pairs for open source projects</a></li>
<li><a href="../255833/index.html">Multiuser chat using WebRTC</a></li>
<li><a href="../255835/index.html">Zhelezyachniki vs. Programmers</a></li>
<li><a href="../255837/index.html">Debugging javascript build in IntelliJ IDEA / PHPStorm / WebStorm</a></li>
<li><a href="../255843/index.html">HP BURA (HP BackUp, Recovery and Archiving) - HP's offer for organizing data backup and archiving systems</a></li>
<li><a href="../255845/index.html">Systemd in five minutes</a></li>
<li><a href="../255847/index.html">The new algorithm of Yandex Minusinsk</a></li>
<li><a href="../255851/index.html">SAP Forum: New Opportunities for Developers and Startups</a></li>
<li><a href="../255853/index.html">New Ruby Book</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>