<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Features testing Flex UI components using FlexUnit 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At work, somehow it was necessary to add functionality to one self-signed flex component. It was important not to break the already existing behavior,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Features testing Flex UI components using FlexUnit 4</h1><div class="post__text post__text-html js-mediator-article">  At work, somehow it was necessary to add functionality to one self-signed flex component.  It was important not to break the already existing behavior, because  during its existence, the component has been used in several applications and acquired by successors. <br><br>  The standard approach to solving such problems is to start by writing unit tests covering the current behavior of a component, at the same time clarifying for itself the features of its structure. <br>  Only after that you can begin step-by-step refactoring and extending the functionality, constantly running tests to see if anything has broken as a result of the changes.  [3] <br><br>  The task, however, is complicated by the fact that the visual components in flex have a multiphase asynchronous procedure for initializing and updating properties, and they require special tools for writing tests.  FlexUnit 4 makes it easy to cope with this task, and below I will show how to do it, and at the same time I will reveal a couple of nuances. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When testing the heirs of UIComponent, we must take into account that most of the component properties are in an unstable state until it is added to the display list and passes through all initialization stages (createChildren, commitProperties, measure, updateDisplayList, etc.). <br><br>  If we run a test before this event, then depending on the speed and load of the computer on which the tests are run, we will receive the component in slightly different states.  To avoid this, we must wait for the CREATION_COMPLETE event. <br><br>  Suppose we want to create a button that would not only hide when setting visible = false, but also did not affect the location of other components, that is, includeInLayout = false. <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mx</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.adobe.com/2006/mxml"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Script</span></span></span><span class="hljs-tag">&gt;</span></span> &lt;![CDATA[ override public function set visible(value:Boolean):void { super.visible = value; invalidateProperties(); } override protected function commitProperties():void { super.commitProperties(); includeInLayout = visible; //  ,     VALUE_COMMIT //dispatchEvent(new FlexEvent(FlexEvent.VALUE_COMMIT)); } ]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Here, of course, it was possible to includeInLayout = visible in the set visible function itself, but I would like to show a more general case when there are many interrelated properties and all of them need to be updated in commitProperties. <br><br>  In order to ‚Äúsee by eye‚Äù that everything works correctly for us, we will launch a test application: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mx</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.adobe.com/2006/mxml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">local:HidingButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidingBtn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"I'll hide"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"try me"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidingBtn.visible = ! hidingBtn.visible"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Now let's try to write the test itself: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flash.events.Event; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flexunit.framework.Assert; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mx.core.Application; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mx.events.FlexEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.flexunit.asserts.assertEquals; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.flexunit.async.Async; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HidingButtonAsyncTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myBtn:HidingButton; <span class="hljs-comment"><span class="hljs-comment">//       , //   [Test] [Before( async )] public function setUp():void { myBtn = new HidingButton(); //   CREATION_COMPLETE     addChild Async.proceedOnEvent(this, myBtn, FlexEvent.CREATION_COMPLETE, 1000); Application.application.addChild(myBtn); } //       , //   [Test] [After( async )] public function tearDown():void { Application.application.removeChild(myBtn); myBtn = null; } [Test(async, description="   ")] public function testDefaultState():void { assertEquals(myBtn.visible, true); assertEquals(myBtn.includeInLayout, true); } [Test(async, description=" ")] public function testHideButton():void { myBtn.addEventListener('includeInLayoutChanged', Async.asyncHandler(this, handleVerifyProperty, 100, null, handleEventNeverOccurred), false, 0, true); myBtn.visible = false; //      ,      function handleVerifyProperty(event:Event, passThroughData:Object):void { assertEquals(myBtn.includeInLayout, false); } } //  ,     private function handleEventNeverOccurred(passThroughData:Object):void { Assert.fail('Pending Event Never Occurred'); } } }</span></span></code> </pre><br><br><h5>  Nuances </h5><br>  1. As can be seen from the code, I used a listener on the UIComponent internal event 'includeInLayoutChanged' to catch changes to the includeInLayout property.  The documentation on FlexUnit [1] recommends using FlexEvent.VALUE_COMMIT, but it does not always dispute, you have to dispute it yourself. <br><br>  In the most general case, when it is difficult to select any event, after which you can check the properties, you can test the component like any other asynchronous process: set a timer with a guaranteed large interval.  Then our test will be rewritten as follows: <br><pre> <code class="java hljs">[Test(async, description=<span class="hljs-string"><span class="hljs-string">"   "</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHideButtonWithTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer:Timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer(<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); timer.addEventListener(TimerEvent.TIMER_COMPLETE, Async.asyncHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, handleVerifyProperty, <span class="hljs-number"><span class="hljs-number">100</span></span>, {}, handleEventNeverOccurred), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); myBtn.visible = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; timer.start(); <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleVerifyProperty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event:Event, passThroughData:Object)</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(myBtn.includeInLayout, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } }</code> </pre><br>  If you need to do a lot of such tests with a timer, then the initialization and reset of the timer should be brought into the appropriate methods [Before] and [After]. <br><br>  2. This test was written under Flex Sdk 3. *, if you are working with Flex 4. *, instead of <b>Application.application.addChild (myBtn)</b> you need to use <b>FlexGlobals.topLevelApplication.addChild (myBtn)</b> . <br><br>  3. The disadvantage of adding test components directly to Application.application is that the component is visible in the test runner window, and also that the test runner styles can affect the styles of your component. <br>  To avoid this, FlexUnit has a special <b>UIImpersonator</b> class that emulates adding a component to the display list.  <s>Unfortunately, I could not get UIImpersonator to work in Ant builds and from Intellij - I get the error "Timeout Occurred before expected event".</s>  <s>Maybe someone will tell you why.</s>  Example how to use UIImpersonator, see below in the comments. <br><br>  <b>UPD:</b> To work from Intellij and ant, you need to remove flexunit-4.1.0-33-as3_3.5.0.12683.swc from the list of connected libraries.  It conflicts with the same for flex. <br><br><h5>  Bibliography </h5><br>  1. Doc on FlexUnit: <a href="http://docs.flexunit.org/index.php%3Ftitle%3DMain_Page">docs.flexunit.org/index.php?title=Main_Page</a> <br>  2. Creating and launching unit tests from FlashBuilder: <a href="http://habrahabr.ru/blogs/Flash_Platform/89487/">habrahabr.ru/blogs/Flash_Platform/89487</a> <br>  3. Handbook of refactoring: Michael Feathers.  Working Effectively with Legacy Code. </div><p>Source: <a href="https://habr.com/ru/post/132255/">https://habr.com/ru/post/132255/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132244/index.html">Primitive port monitoring with SMS notification</a></li>
<li><a href="../132245/index.html">LG Optimus Smartphones and Upgrades to Ice Cream Sandwich (Android 4.0) and Gingerbread (Android 2.3)</a></li>
<li><a href="../132247/index.html">MU-MIMO, or how OFDM in WiMAX / LTE differs from OFDM in 802.11a / g / n</a></li>
<li><a href="../132248/index.html">How to choose a TV</a></li>
<li><a href="../132254/index.html">Bible design. Part two. Crutches, exile from paradise, Cain, Abel, and again from scratch</a></li>
<li><a href="../132257/index.html">Coworking in an Internet cafe: Start</a></li>
<li><a href="../132262/index.html">DIY backups for dummies</a></li>
<li><a href="../132272/index.html">On the fixing of negotiations of cellular subscribers</a></li>
<li><a href="../132274/index.html">Installing your own time base database on Junos devices</a></li>
<li><a href="../132276/index.html">Life without patents - for and against</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>