<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How many numbers are in the array</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A little background. I have written this post for two purposes. First, run in Markdown + markup converter  in a readable form. Secondly, to tell about...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How many numbers are in the array</h1><div class="post__text post__text-html js-mediator-article">  <em>A little background.</em>  <em>I have written this post for two purposes.</em>  <em>First, run in Markdown + <a href="http://habrahabr.ru/post/263213/">markup converter</a></em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%20%5CLaTeX" alt="inline_formula"></em>  <em>in a readable form.</em>  <em>Secondly, to tell about an interesting problem from data streaming.</em>  <em>By the end of the writing, I found a <a href="http://habrahabr.ru/post/119852/">post about LogLog</a> four years ago.</em>  <em>The author of the previous post placed emphasis on implementation on my luck.</em>  <em>I'm relying on</em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%20%5CLaTeX" alt="inline_formula"></em>  <em>tell you more about mathematics.</em> <br><br>  Let's imagine that we have a router.  Through the router passes many packages at different addresses.  We are interested in receiving statistics on how many addresses are involved in communication.  There are a couple of problems. <br><br><ul><li>  There are so many packages that you cannot remember them all.  Say to the package "Come back!"  I will forgive everything, "- too. </li><li>  All possible addresses <img src="http://tex.s2cms.ru/svg/%5Cinline%202%5E%7B32%7D" alt="inline_formula">  .  So much memory on the router is not. </li></ul><br><img src="https://habrastorage.org/files/9e5/6e3/758/9e56e3758e6543cf8a7c1b2490bb7c8f" alt="some title">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>Task</strong> .  <em>There is a sequence of integers</em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Csigma%20%3D%20a_1%2C%20a_2%2C%20%5Ccdots%2C%20a_m" alt="inline_formula"></em>  <em>, all numbers take values ‚Äã‚Äãfrom</em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%200" alt="inline_formula"></em>  <em>before</em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%20n%20-%201" alt="inline_formula"></em>  <em>.</em>  <em>It is required in one pass to count the number of different numbers using</em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Coverline%7Bo%7D%28n%20%2B%20m%29" alt="inline_formula"></em>  <em>of memory</em> . <a name="habracut"></a><br><br>  I will tell the probabilistic approximate Flageolet-Martin algorithm.  TTX algorithm: <br><br><ul><li>  uses <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathcal%7BO%7D%5Cleft%28%5Clog%20%5Cdelta%5E%7B-1%7D%20%28%5Clog%20m%20%2B%20%5Clog%20n%29%5Cright%29" alt="inline_formula">  memory! </li><li>  works on any input; </li><li>  finds the answer that differs from the exact one by no more than 3 times with the probability <img src="http://tex.s2cms.ru/svg/%5Cinline%201%20-%20%5Cdelta" alt="inline_formula">  : <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3B%20%5Ctext%7BFM%7D%28%5Csigma%29%20%5Cin%20%5B%5Ctext%7Bdist%7D%28%5Csigma%29%20%5C%2C%2F%5C%2C%203%2C%20%5Ctext%7Bdist%7D%28%5Csigma%29%20%5Ccdot%203%5D%5C%3B%5Cright%5D%20%5Cgeq%201%20-%20%5Cdelta%2C%0A"></div><br>  the probability is taken according to the random bits of the algorithm. </li></ul><br>  At the end of the post I will explain why exact deterministic algorithms require <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5COmega%28%5Cmin%28n%2C%20m%29%29" alt="inline_formula">  of memory. <br><br><h3>  Flageolet-Martin Algorithm </h3><br>  Imagine that we have a segment of real numbers <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5B0%2C%201%5D" alt="inline_formula">  .  On the segment, we independently randomly throw <img src="http://tex.s2cms.ru/svg/%5Cinline%20n" alt="inline_formula">  points according to a uniform distribution.  What is the distance between the leftmost point and zero? <br><br>  It can be assumed that the points divide the segment by <img src="http://tex.s2cms.ru/svg/%5Cinline%20n%20%2B%201" alt="inline_formula">  smaller sub-ribs of approximately the same length.  If we carefully write the expectation of the distance and take the integral, we get <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BE%7D%5Cleft%5B%5C%3B%5Cmin%28x_1%2C%20%5Ccdots%2C%20x_n%29%20%5C%3B%5Cright%5D%20%3D%20%5Cint_0%5E1%20x%20%5Ccdot%20%5Cleft%28n%20%5Ccdot%20%281%20-%20x%29%5E%7Bn%20-%201%7D%20dx%20%5Cright%29%20%3D%20%5Cfrac%7B1%7D%7Bn%20%2B%201%7D.%0A"></div><br>  Let someone randomly throw several points per segment, and <img src="http://tex.s2cms.ru/svg/%5Cinline%20d" alt="inline_formula">  - distance from zero to the leftmost point.  You can estimate that the total points of the order <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cfrac%7B1%7D%7Bd%7D" alt="inline_formula">  . <br><br>  The idea of ‚Äã‚Äãthe Flageolet-Martin algorithm is to randomly drop all the numbers in a sequence. <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Csigma" alt="inline_formula">  on the segment <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5B0%2C%201%5D" alt="inline_formula">  and then find the distance from zero to the leftmost point.  If the same numbers will always be displayed in a single point, and different independently distributed over the segment, we will be able to estimate the answer. <br><br><h4>  2 independent hash functions </h4><br>  Throw numbers on a segment, we will use a random hash function. <br><br>  <strong>Definition</strong>  <em>Hash family</em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathcal%7BH%7D%20%3D%20%5C%7Bh_i%20%3A%20K%20%5Crightarrow%20V%5C%7D_i" alt="inline_formula"></em>  <em>called 2-independent if for any</em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%20k_1%20%5Cneq%20k_2%20%5Cin%20K" alt="inline_formula"></em>  <em>and</em> <em><img src="http://tex.s2cms.ru/svg/%5Cinline%20v_1%2C%20v_2%20%5Cin%20V" alt="inline_formula"></em> <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BPr%7D_%7Bh%20%5Cleftarrow%20U%28%5Cmathcal%7BH%7D%29%7D%5Cleft%5B%5C%3Bh%28k_1%29%20%3D%20v_1%20%5Ctext%7B%20and%20%7D%20h%28k_2%29%20%3D%20v_2%20%5C%3B%5Cright%5D%20%3D%20%5Cfrac%7B1%7D%7B%7CV%7C%5E2%7D.%0A"></div><br>  The meaning of the definition is as follows.  Fix any two keys <img src="http://tex.s2cms.ru/svg/%5Cinline%20k_1" alt="inline_formula">  and <img src="http://tex.s2cms.ru/svg/%5Cinline%20k_2" alt="inline_formula">  . <br>  The keys are different.  Look at random variables <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28k_1%29" alt="inline_formula">  and <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28k_2%29" alt="inline_formula">  .  Randomness is given by the choice of function. <img src="http://tex.s2cms.ru/svg/%5Cinline%20h" alt="inline_formula">  .  Then, by definition, the quantities <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28k_1%29" alt="inline_formula">  and <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28k_2%29" alt="inline_formula">  will behave as independent. <br><br>  As a result, if you take just one key <img src="http://tex.s2cms.ru/svg/%5Cinline%20k" alt="inline_formula">  then quantity <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28k%29" alt="inline_formula">  will be evenly distributed over <img src="http://tex.s2cms.ru/svg/%5Cinline%20V" alt="inline_formula">  . <br><br>  For example, take the prime number <img src="http://tex.s2cms.ru/svg/%5Cinline%20p" alt="inline_formula">  .  Let be <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Bp%5D%20%3D%20%5C%7B0%2C%20%5Ccdots%2C%20p%20-%201%5C%7D" alt="inline_formula">  . <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathcal%7BH%7D" alt="inline_formula">  Is the family of all linear mappings modulo <img src="http://tex.s2cms.ru/svg/%5Cinline%20p" alt="inline_formula">  : <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/h_%7Ba%2C%20b%7D%28x%29%20%3D%20a%20%5Ccdot%20x%20%2B%20b%20%5Ctext%7B%20mod%20%7D%20p"></div><br>  for <img src="http://tex.s2cms.ru/svg/%5Cinline%20a%2C%20b%20%5Cin%20%5Bp%5D" alt="inline_formula">  .  Then <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cbegin%7Barray%7D%7Bl%7D%0A%5Cmathbf%7BPr%7D_%7Bh%7D%5Cleft%5B%5C%3Bh%28k_1%29%20%3D%20v_1%20%5Ctext%7B%20and%20%7D%20h%28k_2%29%20%3D%20v_2%20%5C%3B%5Cright%5D%20%3D%20%5C%5C%20%3D%0A%5Cmathbf%7BPr%7D_%7Ba%2C%20b%7D%5Cleft%5B%5C%3B%5Cleft%5C%7B%5Cbegin%7Barray%7D%7Bl%7Da%20%5Ccdot%20k_1%20%2B%20b%20%3D%20v_1%20%5Ctext%7B%20%28mod%20%7Dp%29%20%5C%5C%20a%20%5Ccdot%20k_2%20%2B%20b%20%3D%20v_2%20%5Ctext%7B%20%28mod%20%7Dp%29%5Cend%7Barray%7D%20%5Cright.%20%5Cright%5D%20%3D%20p%5E%7B-2%7D.%0A%5Cend%7Barray%7D%0A"></div><br>  Insofar as <img src="http://tex.s2cms.ru/svg/%5Cinline%20k_1%20%5Cneq%20k_2" alt="inline_formula">  , the system has exactly one solution among <img src="http://tex.s2cms.ru/svg/%5Cinline%20p%5E2" alt="inline_formula">  possible: <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cbegin%7Barray%7D%7Bl%7D%0Aa%20%3D%20%28v_1%20-%20v_2%29%20%5Ccdot%20%28k_1%20-%20k_2%29%5E%7Bp%20-%202%7D%20%5Ctext%7B%20mod%20%7Dp%2C%5C%5C%0Ab%20%3D%20%28k_1%20%5Ccdot%20v_2%20-%20k_2%20%5Ccdot%20v_1%29%20%5Ccdot%20%28k_1%20-%20k_2%29%5E%7Bp%20-%202%7D%20%5Ctext%7B%20mod%20%7D%20p.%0A%5Cend%7Barray%7D%0A"></div><br>  Let's understand two important points.  First, the storage of such a function costs in <img src="http://tex.s2cms.ru/svg/%5Cinline%20O%28%5Clog%20p%29" alt="inline_formula">  memory, which is very little.  Secondly, if you look closely, you can understand that the calculations take place in the field <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathbb%7BF%7D_p" alt="inline_formula">  , and can be generalized for any <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D0%25B5%25D1%2587%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25B5">finite field</a> . <br><br>  In the test code, I will use the Galois field. <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathrm%7BGF%7D%282%5E%7B32%7D%29" alt="inline_formula">  .  In the description below, we can assume that we have a family of hash functions <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathcal%7BH%7D%20%3D%20%5C%7Bh_i%20%3A%20%5Bn%5D%20%5Crightarrow%20%5Bn%5D%5C%7D_i" alt="inline_formula">  where <img src="http://tex.s2cms.ru/svg/%5Cinline%20n" alt="inline_formula">  - power of two.  Storage of one function takes <img src="http://tex.s2cms.ru/svg/%5Cinline%20O%28%5Clog%20n%29" alt="inline_formula">  of memory. <br><br><h4>  Algorithm </h4><br>  Let be <img src="http://tex.s2cms.ru/svg/%5Cinline%20n" alt="inline_formula">  - power of two. <br>  Before starting, the algorithm randomly selects a hash function. <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%20%3A%20%5Bn%5D%20%5Crightarrow%20%5Bn%5D" alt="inline_formula">  from a 2-independent family. <br><br>  We will throw the elements of the sequence on the segment <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5B0%2C%201%5D" alt="inline_formula">  .  We take the next value <img src="http://tex.s2cms.ru/svg/%5Cinline%20a_i" alt="inline_formula">  and write: zero, point, <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28a_i%29" alt="inline_formula">  in binary form.  For example, if <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28a_i%29%20%3D%205%20%3D%2000101_2" alt="inline_formula">  then get the number <img src="http://tex.s2cms.ru/svg/%5Cinline%200.00101_2" alt="inline_formula">  . <br><br>  Denote by <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Ctext%7Bzero%7D%28h%28a_i%29%29" alt="inline_formula">  number of leading zeros in binary <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28a_i%29" alt="inline_formula">  .  Let be <img src="http://tex.s2cms.ru/svg/%5Cinline%20z%20%3D%20%5Cmax_i%20%5Ctext%7Bzero%7D%28h%28a_i%29%29" alt="inline_formula">  .  We know that the minimum value lies between <img src="http://tex.s2cms.ru/svg/%5Cinline%202%5E%7B-z%7D" alt="inline_formula">  and <img src="http://tex.s2cms.ru/svg/%5Cinline%202%5E%7B-z%20-%201%7D" alt="inline_formula">  . <br><br>  Algorithm Answer: <img src="http://tex.s2cms.ru/svg/%5Cinline%202%5E%7Bz%20%2B%200.5%7D" alt="inline_formula">  . <br><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> h = H.sample() z = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">:</span></span> z = max(z, zero(h(a)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">answer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>**(z + <span class="hljs-number"><span class="hljs-number">0.5</span></span>)</code> </pre> <br><h4>  Analysis </h4><br><br>  I plan to show that the response of the algorithm will be 3 times more true with a probability less <img src="http://tex.s2cms.ru/svg/%5Cinline%200.48" alt="inline_formula">  .  Similarly, the algorithm will return a response 3 times less than the true probability of less <img src="http://tex.s2cms.ru/svg/%5Cinline%200.48" alt="inline_formula">  .  If you do not plan to go into mathematics, feel free to go on to the next part. <br><br>  Denote by <img src="http://tex.s2cms.ru/svg/%5Cinline%20D" alt="inline_formula">  the set of all different numbers of a sequence <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Csigma" alt="inline_formula">  , but <img src="http://tex.s2cms.ru/svg/%5Cinline%20d" alt="inline_formula">  - their number. <br><br>  To analyze the algorithm, we need two sets of random variables. <br><br><ul><li><img src="http://tex.s2cms.ru/svg/%5Cinline%20X_%7Bj%2C%20r%7D%20%3D%20%5Cleft%5B%20%5Ctext%7Bzero%7D%28h%28j%29%29%20%5Cgeq%20r%20%5Cright%5D" alt="inline_formula">  .  Takes a value of 1 if the number of leading zeros in a binary entry <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28j%29" alt="inline_formula">  at least <img src="http://tex.s2cms.ru/svg/%5Cinline%20r" alt="inline_formula">  ;  otherwise - <img src="http://tex.s2cms.ru/svg/%5Cinline%200" alt="inline_formula">  . </li><li><img src="http://tex.s2cms.ru/svg/%5Cinline%20Y_r%20%3D%20%5Csum_%7Bj%20%5Cin%20D%7D%20X_%7Bj%2C%20r%7D" alt="inline_formula">  .  Magnitude <img src="http://tex.s2cms.ru/svg/%5Cinline%20Y_r" alt="inline_formula">  greater than zero if the variable <img src="http://tex.s2cms.ru/svg/%5Cinline%20z" alt="inline_formula">  at the end of the algorithm was not less <img src="http://tex.s2cms.ru/svg/%5Cinline%20r" alt="inline_formula">  . </li></ul><br>  Note that the probability <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%20%3D%201%5C%3B%5Cright%5D%20%3D%202%5E%7B-r%7D" alt="inline_formula">  : size <img src="http://tex.s2cms.ru/svg/%5Cinline%20h%28j%29" alt="inline_formula">  evenly distributed across the segment <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5B0%2C%20n%20-%201%5D" alt="inline_formula">  ; <img src="http://tex.s2cms.ru/svg/%5Cinline%20n" alt="inline_formula">  - power of two;  there is everything <img src="http://tex.s2cms.ru/svg/%5Cinline%20n%20%5Ccdot%202%5E%7B-r%7D" alt="inline_formula">  numbers with <img src="http://tex.s2cms.ru/svg/%5Cinline%20r" alt="inline_formula">  leading zeros. <br><br>  Mean expectation <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%3D%202%5E%7B-r%7D" alt="inline_formula">  .  Restrict the variance from above <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BD%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX%5E2_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20-%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%5E2%20%5Cleq%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX%5E2_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%3D%202%5E%7B-r%7D.%0A"></div><br>  Note that the variance in magnitude <img src="http://tex.s2cms.ru/svg/%5Cinline%20X_%7Bj%2C%20r%7D" alt="inline_formula">  linear.  For any two <img src="http://tex.s2cms.ru/svg/%5Cinline%20i" alt="inline_formula">  and <img src="http://tex.s2cms.ru/svg/%5Cinline%20j" alt="inline_formula"><br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BD%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%20%2B%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3B%28X_%7Bi%2C%20r%7D%20%2B%20X_%7Bj%2C%20r%7D%29%5E2%5C%3B%5Cright%5D%20-%20%5Cleft%28%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%5C%3B%5Cright%5D%20%2B%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%5Cright%29%5E2%0A"></div><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BE%7D%5Cleft%5B%5C%3B%28X_%7Bi%2C%20r%7D%20%2B%20X_%7Bj%2C%20r%7D%29%5E2%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%5E2%5C%3B%5Cright%5D%20%2B%202%20%5Ccdot%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%20%5Ccdot%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%2B%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5E2%5C%3B%5Cright%5D%20%0A"></div><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cleft%28%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%5C%3B%5Cright%5D%20%2B%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%5Cright%29%5E2%20%3D%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%5C%3B%5Cright%5D%5E2%20%2B%202%20%5Ccdot%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%5C%3B%5Cright%5D%20%5Ccdot%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%2B%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%5E2%20%0A"></div><br>  Insofar as <img src="http://tex.s2cms.ru/svg/%5Cinline%20X_%7Bi%2C%20r%7D" alt="inline_formula">  and <img src="http://tex.s2cms.ru/svg/%5Cinline%20X_%7Bj%2C%20r%7D" alt="inline_formula">  independent then <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%20%5Ccdot%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%5C%3B%5Cright%5D%20%5Ccdot%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D" alt="inline_formula">  .  So <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BD%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%20%2B%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%3D%20%28%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%5E2%5C%3B%5Cright%5D%20-%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%5C%3B%5Cright%5D%5E2%29%20%2B%20%28%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5E2%5C%3B%5Cright%5D%20-%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%5E2%29%20%3D%20%5C%5C%20%3D%20%20%5Cmathbf%7BD%7D%5Cleft%5B%5C%3BX_%7Bi%2C%20r%7D%20%5C%3B%5Cright%5D%20%2B%20%20%5Cmathbf%7BD%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%20%5C%3B%5Cright%5D.%0A"></div><br>  Moreover, <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathbf%7BD%7D%5Cleft%5B%5C%3B%5Csum_%7Bj%20%5Cin%20D%7D%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%20%3D%20%5Csum_%7Bj%20%5Cin%20D%7D%5Cmathbf%7BD%7D%5Cleft%5B%5C%3BX_%7Bj%2C%20r%7D%5C%3B%5Cright%5D" alt="inline_formula">  because magnitudes <img src="http://tex.s2cms.ru/svg/%5Cinline%20X_%7Bj%2C%20r%7D" alt="inline_formula">  - 2-independent. <br><br>  Now consider the value <img src="http://tex.s2cms.ru/svg/%5Cinline%20Y_r" alt="inline_formula">  . <br><br><ul><li><img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BY_r%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3B%5Csum_%7Bj%20%5Cin%20D%7D%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%3D%20%5Csum_%7Bj%20%5Cin%20D%7D%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3B%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%3D%20d%20%5Ccdot%202%5E%7B-r%7D" alt="inline_formula">  on linearity of expectation. </li><li><img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cmathbf%7BD%7D%5Cleft%5B%5C%3BY_r%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BD%7D%5Cleft%5B%5C%3B%5Csum_%7Bj%20%5Cin%20D%7D%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%3D%20%5Csum_%7Bj%20%5Cin%20D%7D%20%5Cmathbf%7BD%7D%5Cleft%5B%5C%3B%20X_%7Bj%2C%20r%7D%5C%3B%5Cright%5D%5Cleq%20d%20%5Ccdot%202%5E%7B-r%7D" alt="inline_formula">  linear dispersion for 2-independent values. </li></ul><br>  Let be <img src="http://tex.s2cms.ru/svg/%5Cinline%20a" alt="inline_formula">  - the minimum number is such that <img src="http://tex.s2cms.ru/svg/%5Cinline%203%20%5Ccdot%20d%20%5Cleq%202%5E%7Ba%20%2B%200.5%7D" alt="inline_formula">  .  The event ‚Äúthe algorithm gave a response 3 times the desired one‚Äù is equivalent to an event <img src="http://tex.s2cms.ru/svg/%5Cinline%20z%20%5Cgeq%20a" alt="inline_formula">  and is equivalent to the event <img src="http://tex.s2cms.ru/svg/%5Cinline%20Y_a%20%3E%200" alt="inline_formula">  .  Applying <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B5%25D0%25BD%25D1%2581%25D1%2582%25D0%25B2%25D0%25BE_%25D0%259C%25D0%25B0%25D1%2580%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25B0">Markov's inequality</a> , we limit the probability <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BFM%28%5Csigma%29%20%5Cgeq%203%20%5Ccdot%20d%20%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3Bz%20%5Cgeq%20a%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BY_%7Ba%7D%20%3E%200%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BY_%7Ba%7D%20%5Cgeq%201%5C%3B%5Cright%5D%20%5Cleq%20%5Cmathbf%7BE%7D%5Cleft%5B%5C%3BY_a%5C%3B%5Cright%5D%5C%3B%2F%5C%3B1%20%3D%20d%20%5Ccdot%202%5E%7B-a%7D%20%5Cleq%5Cfrac%7B%5Csqrt%7B2%7D%7D%7B3%7D%20%5Cleq%200.48.%0A"></div><br>  Let be <img src="http://tex.s2cms.ru/svg/%5Cinline%20b" alt="inline_formula">  - the maximum number is such that <img src="http://tex.s2cms.ru/svg/%5Cinline%202%5E%7Bb%20%2B%200.5%7D%20%5Cleq%20d%20%5C%3B%2F%5C%3B3" alt="inline_formula">  .  Similarly, the event ‚Äúthe algorithm gave a response is 3 times less than the desired one‚Äù is equivalent to the event <img src="http://tex.s2cms.ru/svg/%5Cinline%20z%20%5Cleq%20b" alt="inline_formula">  and is equivalent to the event <img src="http://tex.s2cms.ru/svg/%5Cinline%20Y_%7Bb%2B%201%7D%20%3D%200" alt="inline_formula">  .  Applying <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B5%25D0%25BD%25D1%2581%25D1%2582%25D0%25B2%25D0%25BE_%25D0%25A7%25D0%25B5%25D0%25B1%25D1%258B%25D1%2588%25D1%2591%25D0%25B2%25D0%25B0">the Chebyshev inequality</a> , we get <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cbegin%7Barray%7D%7Bl%7D%0A%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BFM%28%5Csigma%29%20%5Cleq%20d%5C%3B%2F%5C%3B3%20%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3Bz%20%5Cleq%20b%5C%3B%5Cright%5D%20%3D%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BY_%7Bb%20%2B%201%7D%20%3D%200%5C%3B%5Cright%5D%20%3D%20%5C%5C%20%5C%5C%20%3D%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3B%5Cleft%7CY_%7Bb%20%2B%201%7D%20-%20%5Cfrac%7Bd%7D%7B2%5E%7Bb%2B1%7D%7D%5Cright%7C%20%5Cgeq%20%20%5Cfrac%7Bd%7D%7B2%5E%7Bb%2B1%7D%7D%5C%3B%5Cright%5D%20%5Cleq%20%5Cfrac%7B%5Cmathbf%7BD%7D%5Cleft%5B%5C%3BY_%7Bb%20%2B1%7D%5C%3B%5Cright%5D%7D%7B%28d%20%5C%3B%2F%5C%3B2%5E%7Bb%20%2B%201%7D%29%5E2%7D%20%3D%20%5Cfrac%7B2%5E%7Bb%20%2B%201%7D%7D%7Bd%7D%20%5Cleq%20%5Cfrac%7B%5Csqrt%7B2%7D%7D%7B3%7D%20%5Cleq%200.48.%0A%5Cend%7Barray%7D%0A"></div><br><h4>  Final chord: median </h4><br>  It remains to understand how to reduce the error.  Take the case when the algorithm gives out too big an answer.  Let's run the algorithm in parallel <img src="http://tex.s2cms.ru/svg/%5Cinline%20k" alt="inline_formula">  once and return the median among the answers.  I contend that if <img src="http://tex.s2cms.ru/svg/%5Cinline%20k%20%3D%20%5COmega%28%5Clog%20%28%5Cdelta%5C%3B%2F%5C%3B2%29%5E%7B-1%7D%29" alt="inline_formula">  , the algorithm is mistaken with a probability of no more <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Cdelta%5C%3B%2F%5C%3B2" alt="inline_formula">  .  Similarly, limiting the error in the other direction, we get <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%0A%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BFM_k%28%5Csigma%29%20%5Cleq%20d%5C%3B%2F%5C%3B3%20%5Cvee%20FM_k%28%5Csigma%29%20%5Cgeq%203%20%5Ccdot%20d%5C%3B%5Cright%5D%20%5Cleq%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BFM_k%28%5Csigma%29%20%5Cleq%20d%5C%3B%2F%5C%3B3%20%5Cright%5D%20%2B%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3BFM_k%28%5Csigma%29%20%5Cgeq%203%20%5Ccdot%20d%20%5Cright%5D%20%5Cleq%20%5Cdelta.%0A%0A"></div><br>  Why does the median work like this?  By Chernov inequality.  Let's get a random variable <img src="http://tex.s2cms.ru/svg/%5Cinline%20Z_i%20%3D%20%5BFM%28%5Csigma%29%20%3C%203%20%5Ccdot%20d%5D" alt="inline_formula">  .  Magnitude <img src="http://tex.s2cms.ru/svg/%5Cinline%20Z_i" alt="inline_formula">  equals one if the response of the algorithm to <img src="http://tex.s2cms.ru/svg/%5Cinline%20i" alt="inline_formula">  run less <img src="http://tex.s2cms.ru/svg/%5Cinline%203%20%5Ccdot%20d" alt="inline_formula">  .  The probability of this event is not less than 0.52. <br><br>  If the median <img src="http://tex.s2cms.ru/svg/%5Cinline%20k" alt="inline_formula">  algorithm runs more <img src="http://tex.s2cms.ru/svg/%5Cinline%203%20%5Ccdot%20d" alt="inline_formula">  , it means that the algorithm gave at least half the answer <img src="http://tex.s2cms.ru/svg/%5Cinline%203%20%5Ccdot%20d" alt="inline_formula">  and <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Csum_i%20Z_i%20%5Cleq%20k%20%5C%3B%2F%5C%3B2" alt="inline_formula">  .  Then by <a href="https://en.wikipedia.org/wiki/Chernoff_bound">the Hefding-Chernov inequality</a> <br><br><div style="text-align:center;"><img src="http://tex.s2cms.ru/svg/%0A%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3B%5Csum_i%20Z_i%20%5Cleq%20k%5C%3B%2F%5C%3B2%20%5C%3B%5Cright%5D%20%5Cleq%20%5Cmathbf%7BPr%7D%5Cleft%5B%5C%3B%5Cleft%7C%200.52%20%5Ccdot%20k%20-%20%5Csum_i%20Z_i%20%5Cright%7C%20%5Cgeq%200.02%20%5Ccdot%20k%20%5C%3B%5Cright%5D%20%5Cleq%202%5E%7B-c%20%5Ccdot%20k%7D%2C%0A"></div><br>  Where <img src="http://tex.s2cms.ru/svg/%5Cinline%20c" alt="inline_formula">  - some constant.  Another case is shown similarly. <br><br><h3>  Lower bound for exact algorithm </h3><br>  Let's imagine that someone really came up with a deterministic algorithm that finds the exact number of different elements in one pass in one pass.  We show that such an algorithm should use <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5COmega%28%5Cmin%28n%2C%20m%29%29" alt="inline_formula">  of memory. <br><br>  Take a lot <img src="http://tex.s2cms.ru/svg/%5Cinline%20S%20%5Csubset%20%5Bn%5D" alt="inline_formula">  size <img src="http://tex.s2cms.ru/svg/%5Cinline%20n%20%5C%2C%2F%5C%2C%202" alt="inline_formula">  and put it as the beginning of the sequence.  We feed this part of the algorithm and look at its memory. <br><br>  From the memory of the algorithm alone, you can extract the entire set <img src="http://tex.s2cms.ru/svg/%5Cinline%20S" alt="inline_formula">  .  If you feed in the current state number <img src="http://tex.s2cms.ru/svg/%5Cinline%20a%20%5Cin%20S" alt="inline_formula">  , the response of the algorithm will not change;  if a <img src="http://tex.s2cms.ru/svg/%5Cinline%20a%20%5Cnot%5Cin%20S" alt="inline_formula">  , it will increase by 1. Hence, each set <img src="http://tex.s2cms.ru/svg/%5Cinline%20S" alt="inline_formula">  must match its unique memory state. <br><br>  Various subsets of <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Bn%5D" alt="inline_formula">  size <img src="http://tex.s2cms.ru/svg/%5Cinline%20n%5C%2C%2F%5C%2C2" alt="inline_formula">  about <img src="http://tex.s2cms.ru/svg/%5Cinline%202%5En%5C%2C%2F%5C%2Cn" alt="inline_formula">  .  If we want to assign a bit string to each set, we will need <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5COmega%28%5Clog%20%282%5En%20%5C%2C%2F%5C%2Cn%29%29%20%3D%20%5COmega%28n%29" alt="inline_formula"><br><br><h3>  What to read </h3><br><ol><li>  Probabilistic Counting Algorithms for Data Base Applications, Flajolet, Martin, 1983, <a href="http://www.mathcs.emory.edu/~cheung/papers/StreamDB/Probab/1985-Flajolet-Probabilistic-counting.pdf">link</a> . </li><li>  ‚ÄúThe space complexity of approximating the frequency moments‚Äù, Alon, Matias, Szegedy, 1999, <a href="http://www.tau.ac.il/~nogaa/PDFS/amsz4.pdf">link</a> . </li></ol></div><p>Source: <a href="https://habr.com/ru/post/263211/">https://habr.com/ru/post/263211/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263195/index.html">Automaker Chrysler has released a security update for the Jeep Grand Cherokee (WK2)</a></li>
<li><a href="../263199/index.html">Data storage on LTO-5 Ultrium cassettes with LTFS file system</a></li>
<li><a href="../263201/index.html">Topia. The application for creating wallpaper from satellite images for your smartphone</a></li>
<li><a href="../263203/index.html">Hackers from Anonymous or China are suspected of attacking the New York Stock Exchange</a></li>
<li><a href="../263207/index.html">How does Online Interactive and Digital TV from Online</a></li>
<li><a href="../263213/index.html">How to write a post with the formulas: markdown + LaTeX</a></li>
<li><a href="../263217/index.html">Release Visual Studio 2015 and .NET 4.6</a></li>
<li><a href="../263219/index.html">Creation of The Blacksmith: concept and decoration</a></li>
<li><a href="../263221/index.html">Unification through the "burger design": Mail.Ru Group framework for content projects</a></li>
<li><a href="../263223/index.html">What's New in Deploying Windows 10</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>