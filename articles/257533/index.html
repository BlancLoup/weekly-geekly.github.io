<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Download and store photos in Web applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why is it important? 
 On modern web sites, the volume of images can be from 30% to 70% of the total page size. For example, the volume of images on H...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Download and store photos in Web applications</h1><div class="post__text post__text-html js-mediator-article"><h4>  Why is it important? </h4><br>  On modern web sites, the volume of images can be from 30% to 70% of the total page size.  For example, the volume of images <a href="http://i.onthe.io/test%3Furl%3Dhabrahabr.ru">on Habr√© is</a> usually several megabytes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/740/db5/a09/740db5a09bb8870e3b5b0c8c7498cd1d.jpg" alt="size of pictures on the page"><br><br>  Most of the images on the Web are photos.  Profile photos in social.  networks, an album from the phone, professional photos, etc.  The correct strategy and tools for working with photos will make the site quick for visitors. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Format for photos </h4><br>  The main format for storing photos on the Web is JPEG.  However, sometimes other formats should be used. <br><br><h5>  Jpeg </h5><br>  Good for complex images, i.e.  just for photos.  The basic principle of compression in this format is to reduce quality by reducing image detail. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b6/856/111/6b68561112ac2c559de867b667414220.jpg" alt="JPEG quality"><br><br>  Selection of compression ratio can reduce the size of the source file several times without noticeable deterioration in quality.  The logic is this: the lower the quality, the easier the file.  Usually use quality score from 80 to 90. <br><br><h5>  Webp </h5><br>  This is a format designed specifically for serving images on the Web.  Can reduce file size several times without loss of quality.  Compresses pictures much better than JPEG.  However, <a href="http://caniuse.com/">not all</a> browsers support it <a href="http://caniuse.com/">yet</a> . <br><br><h5>  PNG and GIF </h5><br>  These formats are not suitable for photos.  PNG images are preserved without loss of quality and are best suited for icons and graphics.  The GIF format has a limited palette, but supports animation. <br><br><h4>  Upload photos to the server </h4><br>  If on your project there is a need to upload custom photos, you must first select the principle of their storage on the server. <br><br>  If you are going to work with hundreds of files, you should choose a tree structure: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d76/588/1e3/d765881e309d39ae55ad13b51ed5462c.jpg" alt="photo storage structure"><br><br>  This will avoid the situation with thousands of files in one folder (this slows down the file system and your own).  It is best to use a nested structure of two-character folders: <br><br><pre><code class="php hljs">$photo = $_FILES[<span class="hljs-string"><span class="hljs-string">'image'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>]; $name = md5($photo) . <span class="hljs-string"><span class="hljs-string">'.jpg'</span></span>; $dir = substr(md5(microtime()), mt_rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>) . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . substr(md5(microtime()), mt_rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>); $path = $dir . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $name; <span class="hljs-comment"><span class="hljs-comment">#     </span></span></code> </pre> <br><br><h4>  Instruments </h4><br>  After uploading photos to the server, they should be processed: <br><br><ul><li>  Reduce size to acceptable.  It makes no sense to store and display the original photos 4000x3000 size on the server. </li><li>  Delete all metadata.  Sometimes the amount of such information can be more than half the weight of the image itself. </li><li>  Perform optimization to reduce file size.  This will speed up the visitor‚Äôs download. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/511/7b8/aaa/5117b8aaaca2d1ca886c45e5261823b2.jpg" alt="image"><br><br>  For this there are a number of tools. <br><br><h5>  Imagemagick </h5><br>  Immediately after uploading the photo to the server, it makes sense to delete all the metadata and change the size to 1000x1000: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># 90 -     JPEG  convert input.jpg -strip -resize 1000x1000 -quality 90 output.jpg</span></span></code> </pre><br><br><h5>  GraphicsMagick </h5><br>  The same with the more productive <a href="http://www.graphicsmagick.org/">GraphicsMagick</a> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    600500     90 gm convert input.jpg -strip -resize 600x500 -quality 90 output.jpg</span></span></code> </pre><br><br><h5>  Jpegtran </h5><br>  This tool reduces the size of JPEG files without losing quality. <br><br><pre> <code class="bash hljs">jpegtran -copy none -optimize -outfile min.image.jpg image.jpg</code> </pre><br><br><h5>  cwebp </h5><br>  The utility allows you to convert the image to Webp format. <br><br><pre> <code class="bash hljs">cwebp -q 85 input.jpg -o output.webp</code> </pre><br><br><h4>  Return to customer </h4><br>  Photos are best given to Nginx.  Be sure to configure <a href="http://highloadtools.com/cachecontrol">Cache-control</a> and <a href="http://en.wikipedia.org/wiki/Keepalive">Keepalive</a> to increase the speed of loading pages: <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">http</span></span> { ... <span class="hljs-attribute"><span class="hljs-attribute">keepalive_timeout</span></span> <span class="hljs-number"><span class="hljs-number">75s</span></span>; <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ .\.jpg$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">expires</span></span> max; } } }</code> </pre><br><br><h4>  Thumbnails </h4><br>  Often you need to be able to display small versions of photos (for example, a thumbnail of a profile photo). <br><img src="https://habrastorage.org/getpro/habr/post_images/afa/185/3dd/afa1853ddbe1b7bafd7bb644cd561331.jpg" alt="thumbnail pictures"><br><br>  To do this, you need to generate the required dimensions when loading: <br><br><pre> <code class="bash hljs">convert file.jpg -resize 50x50 file.s.jpg convert file.jpg -resize 250x250 file.m.jpg</code> </pre><br><br>  Then each image will have a corresponding thumbnail. <br><br>  A more convenient approach is to generate a preview on the fly using, for example, the <a href="http_image_filter_module.html">Nginx image_filter</a> module. <br><br><h4>  Webp support </h4><br>  Webp is not supported by all browsers, but is gradually gaining <a href="https://onthe.io/learn%2B%25D0%25A7%25D1%2582%25D0%25BE%2B%25D1%2582%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25B5%2BWebP">popularity</a> .  In order to benefit from this format, you can give different versions of photos depending on the visitor's browser. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c61/48f/4d0/c6148f4d0ff34fdb4096d1099790aae4.jpg" alt="image"><br><br>  For each photo you need to generate a webp version: <br><br><pre> <code class="bash hljs">cwebp file.jpg -o file.jpg.webp</code> </pre><br><br>  Now you need to give the appropriate version of the image depending on the browser support for this format: <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { ... <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~* ^/.+\.(jpg|jpeg)$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$http_accept</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~* "webp")</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span> (.+) <span class="hljs-variable"><span class="hljs-variable">$1</span></span>.webp; } } ... }</code> </pre><br><br><h4>  Clouds </h4><br>  Cloud technologies are developing and becoming cheaper.  If you do not have specific tasks for processing photos, it is better to look at the option of using an external service for their storage and return. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ebe/a1b/e3f/ebea1be3f796c12e473cdd8adedf47f4.jpg" alt="image"><br><br><h6>  <a href="http://aws.amazon.com/s3/">Amazon s3</a> </h6><br>  This is a cloud storage with which you do not have to think about scaling.  Keep terabytes and do not worry.  An example of the implementation of uploading photos to <a href="https://github.com/tpyo/amazon-s3-php-class">S3 in PHP</a> : <br><br><pre> <code class="php hljs">$path = <span class="hljs-string"><span class="hljs-string">'photo_name.jpg'</span></span>; $s3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> S3(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); $s3-&gt;putObjectFile($_FILES[<span class="hljs-string"><span class="hljs-string">'image'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>], <span class="hljs-string"><span class="hljs-string">''</span></span>, $path, S3::ACL_PUBLIC_READ, []);</code> </pre><br><br>  After that, you can show a photo directly from Amazon: <br><pre> <code class="html hljs xml">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://s3-eu-west-1.amazonaws.com//photo_name.jpg"</span></span></span><span class="hljs-tag">/&gt;</span></span> ...</code> </pre><br><br><h6>  <a href="http://cloudinary.com/">Cloudinary</a> </h6><br>  Powerful service for working with photos in the cloud.  Resize, crop, face recognition, various formats, online editor and other functions. <br><br><h6>  <a href="https://i.onthe.io/">i.onthe.io</a> </h6><br>  Mega simple service that recognizes the capabilities of the browser and selects the optimal return format.  Supports URL API for resize and crop. <br><br><h4>  Abstract </h4><br><ul><li>  The correct format and compression of photos can save up to 70% of the page. </li><li>  Use only jpeg for photos. </li><li>  If possible, enable Webp support. </li><li>  Imagemagick, Graphicsmagick and Jpegtran for manipulating and optimizing photos. </li><li>  Consider cloud photo storage solutions ‚Äî it's fast and convenient. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/257533/">https://habr.com/ru/post/257533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257517/index.html">Databases honey systems based on HL7 RIM</a></li>
<li><a href="../257523/index.html">May 28 in Moscow, ‚ÄúThe Road to the Cloud‚Äù: discussion of cloud business strategies for software companies, all about new industry trends</a></li>
<li><a href="../257527/index.html">Photos from the opening of the Rostantskaya</a></li>
<li><a href="../257529/index.html">Overview of frequently asked questions about software testing at interviews and answers to them</a></li>
<li><a href="../257531/index.html">As an independent developer touched the legend. Part one</a></li>
<li><a href="../257535/index.html">Direct publication of educational materials in the SAP Learning Solution (not in the manuals)</a></li>
<li><a href="../257537/index.html">Time management games: how to make calculations and pass the intricate level</a></li>
<li><a href="../257539/index.html">Habrahabr PDF for e-book</a></li>
<li><a href="../257541/index.html">Uninvited guest. Why are virtual machines not the best solution for tomorrow's applications?</a></li>
<li><a href="../257543/index.html">Demonstration of the EMC ViPR SRM IT Infrastructure Monitoring System</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>