<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How the JPEG format works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="JPEG images are found everywhere in our digital life, but behind this cover of awareness are algorithms that eliminate details that are not perceived ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How the JPEG format works</h1><div class="post__text post__text-html js-mediator-article"><h4>  JPEG images are found everywhere in our digital life, but behind this cover of awareness are algorithms that eliminate details that are not perceived by the human eye.  The result is the highest visual quality with the smallest file size - but how exactly does all this work?  Let's see what exactly our eyes do not see! </h4><br><img src="https://habrastorage.org/webt/xh/7m/8n/xh7m8nokzhgfqixb00fnwcmkthm.jpeg"><br><br>  It is easy to take, as a matter of course, the opportunity to send a photo to a friend, and not to worry about which device, browser or operating system he uses - but this was not always the case.  By the early 1980s, computers were able to store and display digital images, but there were many competing ideas for the best way to do this.  It was impossible to simply send the image from one computer to another and hope that everything will work. <br><a name="habracut"></a><br>  To solve this problem, in 1986, a committee of experts from around the world was assembled under the name Joint Photographic Experts Group (JPEG), founded in collaboration with the International Organization for Standardization (ISO) and the International Electrotechnical Commission (IEC). ) - two international standards organizations, headquartered in Geneva (Switzerland). <br><br>  A group of people called JPEG created the standard for compressing digital images JPEG in 1992.  Anyone using the internet probably met with JPEG images.  This is the most common way to encode, send and store images.  From web pages to email and social networks, JPEG is used billions of times a day ‚Äî almost every time we watch an image online or send it.  Without JPEG, the web would be less bright, slower, and probably it would have fewer pictures of seals! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article is about decoding a jpeg image.  In other words, what is required to convert compressed data stored on a computer into an image that appears on the screen.  It is worth knowing about this, not only because it is important for understanding the technology that we use daily, but also because by revealing compression levels, we know better the perception and vision, as well as the details to which our eyes are more receptive. <br><br>  In addition, playing with images in this way is very interesting. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f8/312/709/4f831270939c4f685405283f4286e867.gif"><br><br><h2>  Looking inside jpeg </h2><br>  Everything is stored on a computer as a sequence of binary numbers.  Typically, these bits, zeros and ones, are grouped into eight, making up bytes.  When you open a JPEG image on a computer, something (browser, OS, something else) has to decode the bytes, restoring the original image as a list of colors that can be shown. <br><br>  If you download this cute <a href="https://images.unsplash.com/photo-1494256997604-768d1f608cac%3Fixlib%3Drb-1.2.1%26ixid%3DeyJhcHBfaWQiOjEyMDd9%26auto%3Dformat%26fit%3Dcrop%26w%3D1401%26q%3D80">photo of a cat</a> and open it in a text editor, you will see a bunch of incoherent characters. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e4/8a0/017/1e48a0017ada1830f50eefc5079410ea.png"><br>  <i>Here I use Notepad ++ to examine the contents of the file, because ordinary text editors, such as Notepad from Windows, will corrupt the binary file after saving, and it will no longer satisfy the JPEG format.</i> <br><br>  Opening the image in a text editor, you confuse the computer, just as you confuse your brain when you rub your eyes and start to see colored spots! <br><br>  These spots that you see are known as <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2581%25D1%2584%25D0%25B5%25D0%25BD">phosphenes</a> and are not the result of a light stimulus or hallucinations generated by the mind.  They occur because your brain believes that any electrical signals in the optic nerves convey information about light.  The brain needs to make such assumptions, since it is not possible to know whether the signal is sound, vision, or something else.  All the nerves in the body transmit exactly the same electrical impulses.  Pressing on the eyes, you send signals that are not visual, but activate the receptors of the eye that your brain interprets - in this case, it is not true - as something visual.  You can literally see the pressure! <br><br>  It's funny to think about how computers are similar to the brain, but this is also a useful analogy that illustrates how strongly the meaning of data ‚Äî transmitted over the body by nerves or stored on a computer ‚Äî depends on their interpretation.  All binary data consists of zeros and ones, the basic components capable of transmitting information of any kind.  Your computer often guesses how to interpret them using prompts such as file extensions.  And now we force him to interpret them as text, since this is what the text editor expects. <br><br>  To understand how to decode JPEG, we need to see the original signals themselves - binary data.  This can be done with a hex editor, or directly on the <a href="https://parametric.press/issue-01/unraveling-the-jpeg/">web page of the original article</a> !  There is an image, next to which all its bytes (except for the header) are shown in the text field, presented in decimal form.  You can change them, and the script recodes and outputs a new image on the fly. <br><br><img src="https://habrastorage.org/webt/0e/tu/az/0etuazw_ujtrjmepdjpaacmg_jo.png"><br><br>  You can learn a lot just by playing with this editor.  For example, can you tell in which order the pixels are stored? <br><br>  In this example, it is strange that changing some numbers does not affect the image at all, but, for example, if you replace the number 17 with 0 in the first line, the photo will completely deteriorate! <br><br><img src="https://habrastorage.org/webt/ql/47/xz/ql47xznmt7fq29yoynour0fscls.png"><br><br>  Other changes, for example, replacing 7 on line 1988 with the number 254 changes the color, but only subsequent pixels. <br><br><img src="https://habrastorage.org/webt/tj/tu/0o/tjtu0o9qppmq2pgv5mpfh02hpzw.png"><br><br>  Perhaps the strangest thing is that some numbers change not only the color, but also the shape of the image.  Change 70 in line 12 to 2 and look not at the top row of the image to see what I mean. <br><br><img src="https://habrastorage.org/webt/wr/ui/w3/wruiw3ds_yihzasjgytn8vul1de.png"><br><br>  And no matter what JPEG image you use, you will always find these mysterious chess sequences when editing bytes. <br><br>  Playing with the editor, it is hard to understand how a photo of these bytes is recreated, since JPEG compression consists of three different technologies that are applied sequentially in levels.  We will study each of them separately to uncover the mysterious behavior we observe. <br><br>  <b>Three levels of JPEG compression:</b> <br><br><ol><li>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B2%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D1%2581%25D1%2583%25D0%25B1%25D0%25B4%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">Color sub-sampling</a> . </li><li>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BA%25D0%25BE%25D1%2581%25D0%25B8%25D0%25BD%25D1%2583%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Discrete cosine transform and discretization</a> . </li><li>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B4%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B4%25D0%25BB%25D0%25B8%25D0%25BD_%25D1%2581%25D0%25B5%25D1%2580%25D0%25B8%25D0%25B9">Length</a> , <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D0%25BB%25D1%258C%25D1%2582%25D0%25B0-%25D0%25BA%25D0%25BE%25D0%25B4%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Delta,</a> and <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B4_%25D0%25A5%25D0%25B0%25D1%2584%25D1%2584%25D0%25BC%25D0%25B0%25D0%25BD%25D0%25B0">Huffman</a> <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B4%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B4%25D0%25BB%25D0%25B8%25D0%25BD_%25D1%2581%25D0%25B5%25D1%2580%25D0%25B8%25D0%25B9">Coding</a> </li></ol><br>  So that you can imagine the scale of compression, note that the image above represents 79,819 numbers, that is, about 79 Kb.  If we stored it without compression, for each pixel we would need three numbers - for the red, green and blue components.  This would be 917,700 numbers, or approx.  917 Kb.  As a result of JPEG compression, the resulting file has decreased by more than 10 times! <br><br>  In fact, this image can be squeezed much stronger.  Below are two images next to each other - the photo on the right was stung to 16 Kb, that is, 57 times smaller than the uncompressed version! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec8/a0f/b53/ec8a0fb53e28470aafb8fb6b04713de3.png"><br><br>  If you look closely, you will see that these images are not identical.  Both of them are pictures with JPEG compression, but the right one is much smaller in volume.  It also looks a little worse (look at the squares of the background colors).  Therefore, JPEG is also called lossy compression;  during compression, the image changes and loses some details. <br><br><h2>  1. Color subsampling </h2><br>  Here is an image using only the first compression level. <br><br><img src="https://habrastorage.org/webt/bn/jq/j3/bnjqj3gjgcxd3xazrfnepcfwo-s.png"><br>  <i>(The interactive version is in the <a href="https://parametric.press/issue-01/unraveling-the-jpeg/">original</a> article).</i>  <i>Removing one number destroys all colors.</i>  <i>However, if you remove exactly six numbers, it almost does not affect the image.</i> <br><br>  Now the numbers are a little easier to decipher.  This is almost a simple list of colors, in which each byte changes exactly one pixel, but at the same time it is already half the size of an uncompressed image (which would take about 300 KB in such a reduced size).  Guess why? <br><br>  You can see that these numbers do not denote the standard red, green, and blue components, because if we replace all the numbers with zeros, we get a green image (not white). <br><br><img src="https://habrastorage.org/webt/ij/ar/qj/ijarqjsfiuanba52sxsn-ovh6q0.png"><br><br>  This is because these bytes denote Y (brightness), <br><br><img src="https://habrastorage.org/webt/ab/sl/bt/abslbtgj10nk62g7ksdlx0lusck.png"><br><br>  Cb (relative blue), <br><br><img src="https://habrastorage.org/webt/_s/ao/1c/_sao1c1div5bv1dltl6gahkp86a.png"><br><br>  and Cr (relative redness) pictures. <br><br><img src="https://habrastorage.org/webt/mp/fz/jt/mpfzjtlicxlsmw3wmbrnqhywinu.png"><br><br>  Why not use RGB?  After all, this is how most modern screens work.  Your monitor can show any color, including red, green and blue colors with different intensities for each pixel.  White is obtained by turning on all three at full brightness, and black by turning them off. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c27/504/f77/c27504f7737bca3efab3468f2a09aacc.png"><br><br>  It is also very similar to the work of the human eye.  The color receptors of our eyes are called " <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BB%25D0%25B1%25D0%25BE%25D1%2587%25D0%25BA%25D0%25B8">cones</a> ", and are divided into three types, each of which is more sensitive to either red, or green, or blue [S-type cones are sensitive in violet-blue (S from the English. Short - short-wave spectrum), M-type - in green-yellow (M from English. Medium - medium wave), and L-type - in yellow-red (L from English. Long - long wave) parts of the spectrum.  The presence of these three types of cones (and rods, sensitive in the emerald-green part of the spectrum) gives a person color vision.  / approx.  trans.].  <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25BB%25D0%25BE%25D1%2587%25D0%25BA%25D0%25B8_(%25D1%2581%25D0%25B5%25D1%2582%25D1%2587%25D0%25B0%25D1%2582%25D0%25BA%25D0%25B0)">Sticks</a> , a different type of photoreceptor in our eyes, can detect changes in brightness, but are much more sensitive to color.  In our eyes there are about 120 million rods and only 6 million cones. <br><br>  Therefore, our eyes notice much better changes in brightness than changes in color.  If you separate the color from the brightness, you can remove a little color, and no one will notice.  Color subsampling is the process of representing the color components of an image at a lower resolution than the brightness components.  In the example above, each pixel has exactly one component Y, and each separate group of four pixels has exactly one Cb component and one Cr.  Therefore, the image contains four times less color information than the original. <br><br>  The YCbCr color space is not only used in JPEG.  He was originally invented in 1938 for television programs.  Not everyone has a color TV, so the separation of color and brightness allowed everyone to receive the same signal, and TVs without color simply used only the brightness component. <br><br>  Therefore, removing one number from the editor completely destroys all the colors.  Components are stored as YYYY Cb Cr (in fact, not necessarily in this order - the storage order is specified in the file header).  Removing the first number will lead to the fact that the first Cb value will be perceived as Y, Cr as Cb, and in general there will be a domino effect that switches all colors of the picture. <br><br>  The JPEG specification does not obligate you to use YCbCr.  But in most files it is used because it gives better quality images after subsampling compared to RGB.  But you don't have to take my word for it.  See for yourself in the table below what the downsampling of each individual component will look like in both RGB and YCbCr. <br><br><img src="https://habrastorage.org/webt/9b/fl/ei/9bfleirkdnq8sdwiudks05bdz1o.png"><br>  (The interactive version is in the <a href="https://parametric.press/issue-01/unraveling-the-jpeg/">original</a> article). <br><br>  Removing blue is not as noticeable as red or green.  That's because of the six million cones in your eyes, about 64% are sensitive to red, 32% to green and 2% to blue. <br><br>  Subsampling of the Y component (lower left) is best seen.  Even a slight change is noticeable. <br><br>  Converting an image from RGB to YCbCr does not reduce the file size, but makes it easier to find less noticeable details that can be deleted.  Lossy compression occurs in the second stage.  It is based on the idea of ‚Äã‚Äãpresenting data in a more compressible form. <br><br><h2>  2. Discrete cosine transform and discretization </h2><br>  This level of compression for the most part determines the essence of JPEG.  After converting colors to YCbCr, the components are compressed separately, so we can then concentrate only on component Y. And this is how the bytes of component Y look after applying this level. <br><br><img src="https://habrastorage.org/webt/sr/c2/en/src2enhysp480z4qoycrgptdn5m.png"><br>  <i>(The interactive version is in the <a href="https://parametric.press/issue-01/unraveling-the-jpeg/">original</a> article).</i>  In the interactive version, clicking on a pixel scrolls the editor to the line that represents it.  Try removing numbers from the end or add a few zeros to a specific number. <br><br>  At first glance, it looks like a very bad compression.  There are 100,000 pixels in the image, and 102,400 numbers are required to indicate their brightness (Y-components) - this is worse than not compressing anything at all! <br><br>  However, note that most of these numbers are zero.  Moreover, all these zeros at the end of lines can be deleted without changing the image.  It remains about 26,000 numbers, and this is almost 4 times less! <br><br>  At this level is the secret of chess patterns.  Unlike other effects that we have seen, the appearance of these patterns is not a glitch.  They are the building blocks of the entire image.  Each line of the editor contains exactly 64 numbers, the coefficients of the discrete cosine transform (DCT), corresponding to the intensities of 64 unique patterns. <br><br>  These patterns are formed based on the cosine graph.  Here are some of them: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2cc/8da/dd7/2cc8dadd7ca3d6565753fdd8f14a4fcd.png"><br>  <i>8 of 64 factors</i> <br><br>  Below is an image showing all 64 patterns. <br><br><img src="https://habrastorage.org/webt/z3/8n/ri/z38nrihqi2zbdt2cznzqy3p1bh0.png"><br>  <i>(The interactive version is in the <a href="https://parametric.press/issue-01/unraveling-the-jpeg/">original</a> article).</i> <br><br>  These patterns have a special meaning because they form the basis of 8x8 images.  If you are unfamiliar with algebra, this means that any 8x8 image can be obtained from these 64 patterns.  DCT is the process of dividing images into 8x8 blocks and transforming each block into a combination of these 64 coefficients. <br><br>  The fact that any image can be made up of 64 certain patterns, it seems like magic.  However, this is the same as saying that any place on Earth can be described by two numbers - latitude and longitude [indicating hemispheres / approx.  trans.].  We often consider the surface of the Earth to be two-dimensional, therefore we need only two numbers.  The 8x8 image has 64 dimensions, so we need 64 numbers. <br><br>  It is not yet clear how this helps us in terms of compression.  If we need 64 numbers to represent an 8x8 image, why would this method be better than just storing 64 brightness components?  We do this for the same reason that we turned three RGB numbers into three YCbCr numbers: this allows us to remove unnoticeable details. <br><br>  It is difficult to see exactly which parts are removed at this stage, since JPEG applies DCT to 8x8 blocks.  However, no one forbids us to apply it to the whole picture.  Here is what DCT looks like for component Y as applied to the whole picture: <br><br><img src="https://habrastorage.org/webt/ab/sl/bt/abslbtgj10nk62g7ksdlx0lusck.png"><br><br>  From the end you can remove more than 60,000 numbers with almost no noticeable changes in the pictures. <br><br><img src="https://habrastorage.org/webt/we/mq/ma/wemqmatswqyazpgyxm12k-g7l-s.png"><br><br>  However, note that if we reset the first five numbers, the difference will be obvious. <br><br><img src="https://habrastorage.org/webt/m0/fj/tj/m0fjtjcfr_-6b50duzk3-zvl7gi.png"><br><br>  The numbers at the beginning denote low frequency variations in the image, and our eyes catch them best.  Numbers near the end indicate high frequency variations that are more difficult to notice.  To "see what is not visible to the eye," we can isolate these high-frequency details by resetting the first 5,000 numbers. <br><br><img src="https://habrastorage.org/webt/si/gj/w2/sigjw20pylfjmu0rzqjocl6oqv4.png"><br><br>  We see all areas of the image in which the largest change from pixel to pixel occurs.  The cat's eyes stand out, his mustache, a terry blanket and the shadows in the lower left corner.  You can go further by resetting the first 10,000 numbers: <br><br><img src="https://habrastorage.org/webt/eg/vi/9a/egvi9a_wkwv48xktp7jiyajnhuc.png"><br><br>  20,000: <br><br><img src="https://habrastorage.org/webt/y9/fr/ri/y9frrialb_94gnwdd-plq_hcyqc.png"><br><br>  40,000: <br><br><img src="https://habrastorage.org/webt/0d/ce/kr/0dcekrobg9_ir-hqnggr9fjlw4u.png"><br><br>  60,000: <br><br><img src="https://habrastorage.org/webt/uo/8f/qx/uo8fqxadj-snukbdf1dcjgvoux0.png"><br><br>  These high-frequency details are JPEG and removes during the compression phase.  Color conversion to DCT coefficients is not a loss.  Losses are generated at the discretization step, where the high frequency values ‚Äã‚Äãor close to zero are removed.  When you lower the quality of JPEG saving, the program increases the threshold for the number of values ‚Äã‚Äãto be deleted, which reduces the file size, but makes the picture more pixelated.  Therefore, the image in the first section, which was 57 times smaller, looked like that.  Each 8x8 block was represented by a much smaller number of DCT coefficients compared to a higher-quality version. <br><br>  You can make such a cool effect as a gradual streaming of images.  You can display a blurry image that becomes more and more detailed as you download more and more coefficients. <br><br>  Here, just for the sake of interest, what happens when you use only 24,000 numbers: <br><br><img src="https://habrastorage.org/webt/vn/sf/xr/vnsfxrqyogsnc4qx9pzsok--rno.png"><br><br>  Or just 5000: <br><br><img src="https://habrastorage.org/webt/oi/y3/u6/oiy3u6saz6kliguv_pm8iucdbqa.png"><br><br>  Very blurry, but as if recognizable! <br><br><h2>  3. Length, Delta, and Huffman Coding </h2><br>  So far, all the stages of compression have been going down.  The last stage, on the contrary, goes without loss.  It does not delete the information, but significantly reduces the file size. <br><br>  How can you compress something without discarding information?  Imagine how we would describe a simple black rectangle 700 x 437. <br><br>  JPEG uses 5,000 numbers for this, but much better results can be achieved.  Can you imagine a coding scheme that describes such an image in as few bytes as possible? <br><br>  The minimal scheme I could think of uses four: three to indicate color, and the fourth how many pixels have that color.  The idea of ‚Äã‚Äãrepresenting repetitive values ‚Äã‚Äãin such a compressed way is called run length coding.  It has no losses, since we can recover the coded data in its original form. <br><br>  The size of a JPEG file with a black rectangle is much more than 4 bytes - remember that at the DCT level, compression is applied to blocks of 8x8 pixels.  Therefore, at a minimum, we need one DCT coefficient for every 64 pixels.  We need one because instead of storing one DCT coefficient followed by 63 zeros, the coding of run lengths allows us to store one number and designate that ‚Äúall the others are zeros‚Äù. <br><br>  Delta encoding is a technique in which each byte contains a difference from some value, not an absolute value.  Therefore, editing certain bytes changes the color of all other pixels.  For example, instead of storing <br><br>  12 13 14 14 14 13 13 14 <br><br>  We could start with 12, and then simply designate how much to add or subtract to get the next number.  And this sequence in delta coding takes the form: <br><br>  12 1 1 0 0 -1 0 1 <br><br>  The converted data is not less than the original, but compressing it is already easier.  The use of delta coding before coding lengths of series can greatly help, while remaining lossless compression. <br><br>  Delta encoding is one of the few techniques used outside 8x8 blocks.  Of the 64 DCT coefficients, one is simply a constant wave function (solid color).  It represents the average brightness of each block for the brightness component, or the average blue for the Cb components, and so on.  The first value of each DCT block is called a DC value, and each DC value passes a delta encoding with respect to the previous ones.  Therefore, changing the brightness of the first block will affect all the blocks. <br><br>  The last mystery remains: how does the change in the singular completely spoil the whole picture?  So far, there were no such properties for compression levels.  The answer lies in the JPEG header.  The first 500 bytes contain metadata about the image ‚Äî width, height, and so on, and so far we have not worked with them. <br><br>  Without a header, it is almost impossible (well, or very difficult) to decode JPEG.  It will look like I'm trying to describe a picture for you, and start to invent words in order to convey my impression.  The description will probably be very succinct, because I can invent words with the very meaning I want to convey, but for everyone else they will not make sense. <br><br>  It sounds silly, but this is exactly what happens.  Each JPEG image is compressed with codes specific to it.  The code dictionary is stored in the header.  This technique is called the ‚ÄúHuffman code‚Äù, and the dictionary is the Huffman table.  In the header, the table is marked with two bytes - 255 and then 196. Each color component can have its own table. <br><br>  Changes to tables will radically affect any image.  A good example is to change on line 15 to 12. <br><br><img src="https://habrastorage.org/webt/mz/-c/xd/mz-cxdyzf2haxuj1_tojoatbl7s.png"><br><br>  This is because the tables indicate how to read individual bits.  So far we have only worked with binary numbers in decimal form.  But this hides from us the fact that if you want to store the number 1 in a byte, then it will look like 00000001, since each byte must have exactly eight bits, even if you only need one of them. <br><br>  This is potentially a big waste of space if you have a lot of small numbers.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Huffman code is a technique that allows us to weaken this requirement, according to which each number should occupy eight bits. This means that if you see two bytes: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">234 115 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That, depending on the Huffman table, it can be three numbers. To extract them, you first need to break them into separate bits: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11101010 01110011 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then we turn to the table to figure out how to group them. For example, it can be the first six bits, (111010), or 58 in the decimal system, followed by five bits (10011), or 19, and finally the last four bits (0011), or 3. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, it is very difficult to understand bytes at this stage of compression. Bytes do not represent what it seems. I will not go into the details of working with the table in this article, but </font></font><a href="https://www.impulseadventure.com/photo/jpeg-huffman-coding.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">materials</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on this issue on the network </font></font><a href="https://www.youtube.com/watch%3Fv%3DJsTptu56GM8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enough</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One of the interesting tricks that can be done, knowing this is to separate the header from the JPEG and store it separately. </font><font style="vertical-align: inherit;">In fact, it turns out that only you can read the file. </font><font style="vertical-align: inherit;">Facebook is doing this to shrink files even more. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What else can be done - quite a bit to change the Huffman table. </font><font style="vertical-align: inherit;">For others, it will look like a spoiled picture. </font><font style="vertical-align: inherit;">And only you will know the magic version of its correction. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To summarize: so what is needed for JPEG decoding? </font><font style="vertical-align: inherit;">It is necessary:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extract the Huffman table (s) from the header and decode the bits. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extract the discrete cosine transform coefficients for each color and brightness component for each 8x8 block by performing the inverse transforms of the run and delta length coding. </font></font></li><li>     ,        88. </li><li>   ,    (    ). </li><li>    YCbCr     RGB. </li><li>    ! </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serious work for easy viewing photos with a cat! </font><font style="vertical-align: inherit;">However, what I like about it is that the JPEG technology is human-centric. </font><font style="vertical-align: inherit;">It is based on the features of our perception, allowing us to achieve much better compression than conventional technologies. </font><font style="vertical-align: inherit;">And now, understanding how JPEG works, you can imagine how these technologies can be transferred to other areas. </font><font style="vertical-align: inherit;">For example, delta encoding in video can give a serious decrease in file size, since there are often whole areas that do not change from frame to frame (for example, the background). </font></font><br><br> <i><a href="https://github.com/ParametricPress/01-unraveling-the-jpeg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The code used in the article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is open, and contains instructions for replacing images with your own.</font></font></i> </div><p>Source: <a href="https://habr.com/ru/post/454944/">https://habr.com/ru/post/454944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454930/index.html">Garbage Collection in V8: How the New Orinoco GC Works</a></li>
<li><a href="../454936/index.html">Vivaldi: ad blocking should be user selectable</a></li>
<li><a href="../454938/index.html">Developing your own core for embedding into the FPGA processor system</a></li>
<li><a href="../45494/index.html">University tour Opera. Kiev</a></li>
<li><a href="../454940/index.html">Travel insurance: detailed instructions</a></li>
<li><a href="../454950/index.html">Work and life IT pros in Cyprus - the pros and cons</a></li>
<li><a href="../454958/index.html">An inside look: graduate school at EPFL. Part 4.1: daily life</a></li>
<li><a href="../454960/index.html">Microbiota How do medications affect intestinal bacteria?</a></li>
<li><a href="../454962/index.html">How are world IT companies protected from competitors in the person of former employees?</a></li>
<li><a href="../454966/index.html">Creating instant games on Unity in Google Play Instant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>