<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of a vector editor on JavaScript (complexity and ideas)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Background: 
 The name is a great experience in website development (about 15 years) and being a programmer, I really dislike routine work, I try to e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of a vector editor on JavaScript (complexity and ideas)</h1><div class="post__text post__text-html js-mediator-article"><h4>  Background: </h4><br>  The name is a great experience in website development (about 15 years) and being a programmer, I really dislike routine work, I try to either avoid it or optimize it in some way.  In other words, if at some point I need to fill the site with content (yes, I know, it‚Äôs not a <s>royal</s> business for a programmer to fill a site, but there are different cases), then I would prefer to spend a couple of hours writing the incoming data parser than 4 hours data manually.  And long ago, I was tormented by the problem of the lack of a convenient editor for creating image maps.  Of course, you can draw a map in Corel Draw or similar, upload to SVG and quickly convert it to the desired format, but I was interested for a long time in the possibility of creating a certain editor that allows you to quickly upload an image directly on the site, without loading third-party programs. on it the desired card.  For example, there is a certain image of a building on which you need to select the outline of the floor and attach some JavaScript-events to it or just a link, like this: <br><br><img src="https://habrastorage.org/files/22e/0f6/569/22e0f6569ec747f38e568c937edecd9e.jpg"><br><a name="habracut"></a><br><br>  Also, in addition to manually selecting the contour of the object, I would like to have a tool similar to the Magic Wand in Photoshop, so that I would poke the mouse and you would have a ready-made contour.  Despite the fact that for several years I‚Äôve come across various map editors (both on-line and off-line), I haven‚Äôt found a similar function in them.  Well, if not, we will write it ourselves. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I would like to immediately warn you, because as a result I found a customer for a commercial product, unfortunately there will be no full source code, but I will try to describe the ideas and difficulties encountered in the development in as much detail as possible, and I do not specialize in the development of graphics and interfaces. therefore, some ‚Äúrevelations‚Äù may seem ridiculous or even stupid, however: <br><br><h4>  Definition of editor functionality: </h4><br><ol><li>  Creating a contour manually, as well as being able to edit previously created contours; </li><li>  Although the HTML MAP - AREA - SHAPE tag supports several types of forms of the selected area, it was decided to stop only on creating complex contours using POLY; </li><li>  Actually, what was interesting to me, as a programmer, is the selection of an area with similar colors, with a single mouse click. </li></ol><br><h4>  CANVAS - what you need? </h4><br>  Since I already had experience with the CANVAS tag and presented its capabilities, it was decided to stop at it (as it turned out, this was a mistake, the development of the editor was slow for a decent amount of time). <br><br><h4>  Select contour traversal algorithm: </h4><br>  Having tried several variants of contour traversal algorithms, I finally chose the <a href="http://www.imageprocessingplace.com/downloads_V3/root_downloads/tutorials/contour_tracing_Abeer_George_Ghuneim/moore.html">Moor Neighborhood</a> .  In my opinion, this algorithm successfully combines the speed of work and sufficient ease of implementation. <br><br>  So: <br><br><img src="https://habrastorage.org/files/4d0/661/bf2/4d0661bf2e074dc49e4b85e835f5b3e6.jpg"><br>  <i>Test image for working with the contour</i> <br><br><img src="https://habrastorage.org/files/391/917/789/391917789db04b148b7f696ce0385c18.jpg"><br>  <i>Outline selection with straight sides</i> <br><br><img src="https://habrastorage.org/files/c48/113/f2c/c48113f2c09f45858ce7decdc60258af.jpg"><br>  <i>Curved contour selection</i> <br><br>  As you can see, the contour traversal algorithm does an excellent job and highlights everything that is needed, while we see that a relatively small contour requires almost 300 points for straight lines and for some reason less than 50 points if the contour is rotated around its axis. <br><br>  In principle, now this contour can be memorized and worked with it, but the large amount of data confuses even for a small contour. <br><br><h4>  Optimization of the finished circuit: </h4><br>  The following scheme of work with the contour was chosen: first we create a contour from points and delete unnecessary ones, with the exception of the nodal points (or points of change of direction).  On the one hand, double work occurs, on the other hand, this scheme simplifies debugging the mechanism for removing unnecessary points. <br><br><h4>  Selection of nodal points: </h4><br>  Surface solution: <br><ol><li>  Take a point, add it to an array of node points (not contour points); </li><li>  Sequentially we go around the point from the starting one, measuring the angular distance between the original and the current one, if the angular distance is more or less than some (determined experimentally), then this point is a new starting one, add it to the array \ nodal points; </li></ol><br>  This solution works, but here the calculation of the angular distance tormented the soul with the presence of "heavy" functions of working with angles.  Therefore, it was decided to look at the existing "bikes" and here is the forgotten solution from school mathematics: the <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BA%25D0%25B0%25D0%25BB%25D1%258F%25D1%2580%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B8%25D0%25B7%25D0%25B2%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">scalar product of vectors</a> . <br><br>  We take it as a basis - the algorithm works fine and much faster. <br><br>  See the result: <br><img src="https://habrastorage.org/files/a40/121/aad/a40121aadf784a47bca51d20e642ea2a.jpg"><br>  <i>13 points - quite satisfied.</i> <br><br><img src="https://habrastorage.org/files/afe/e38/60f/afee3860fdce49c5817e9e0aedd0783e.jpg"><br>  <i>61 points ?!</i>  <i>But why?!</i> <br><br>  But why: I somehow forgot that, in spite of the large resolutions of monitors, retina, etc., the line on the screen is in fact a broken set of points (after all, 20 years ago, I stuck my tongue out and mastered drawing lines using the Bresenham algorithm ...): <br><br><img src="https://habrastorage.org/files/4da/dcc/a3d/4dadcca3db89483ab0763fdb604a7d76.jpg"><br>  <i>Bold highlighted theoretical straight, and the difference beats in the eye.</i> <br><br>  The problem was temporarily solved by introducing a certain multiplier, which allowed proportionally increasing the distance between points (while preserving the angular distance), which allowed smoothing the difference between points and making the calculation more accurate, resulting in 23 points instead of 61, more than for straight lines, but for my purposes for now enough. <br><br><h4>  To summarize: </h4><br><img src="https://habrastorage.org/files/04e/70f/c30/04e70fc3024e4b42a130e53e9fa1015c.gif"><br><br>  The editor is ready, allows you to load an image, scale it, move it with a mouse, add new objects and edit existing ones, everything works on a strange mixture of SVG and Canvas. <br><br>  In the future, I plan to describe my torment with CANVAS and the translation of work with objects on SVG, about combining objects on the map and in the list, as well as about what all this was needed for. <br><br>  UPD: <br>  I used the <a href="http://en.wikipedia.org/wiki/Ramer-Douglas-Peucker_algorithm">Rahmer-Douglas-Pecker algorithm</a> to minimize the number of points, the result was much better, the nodal points are determined more accurately.  Thanks <a href="http://habrahabr.ru/users/levshino/" class="user_link">LevshinO</a> for the idea! <br><br>  UPD: <br>  The <a href="http://habrahabr.ru/post/254291/">second part of the</a> story about the creation of the editor is published, including with reference to the source code. </div><p>Source: <a href="https://habr.com/ru/post/233453/">https://habr.com/ru/post/233453/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233433/index.html">Sproutling: fitness tracker, electronic nanny and child safety system</a></li>
<li><a href="../233437/index.html">Life hacking: how to get rid of the obsessive desire of Facebook to transfer you to their instant messenger</a></li>
<li><a href="../233443/index.html">SVG, Iconfonts vs PNG</a></li>
<li><a href="../233447/index.html">Designing an online store: personal account, shopping cart, delivery, payment, mailing and more</a></li>
<li><a href="../233449/index.html">Pop-up Creator apologizes</a></li>
<li><a href="../233455/index.html">How to implement back-to-back testing. Yandex experience</a></li>
<li><a href="../233457/index.html">Tortilla - all TCP and DNS traffic from a virtual machine via TOR</a></li>
<li><a href="../233461/index.html">How did you start using [x] in the design of graphical interfaces</a></li>
<li><a href="../233463/index.html">My "Swallow"</a></li>
<li><a href="../233465/index.html">LED "smiley". Technology multiplexing method "Charlie"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>