<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exchange mailbox audit. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this and the next article, we will look at the specifics of auditing changes on Microsoft Exchange servers . Let's start with the mailbox audit, an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exchange mailbox audit. Part 1</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://www.netwrix.com/ru/exchange_server_auditing.html"><img src="https://habrastorage.org/getpro/habr/post_images/dc4/079/f35/dc4079f35770650e2f47e1c72509a0ec.png"></a> <br><br>  In this and the next article, we will look at the specifics of <a href="http://www.netwrix.com/ru/exchange_server_auditing.html">auditing changes on Microsoft Exchange servers</a> .  Let's start with the mailbox audit, and next time we continue with the post about auditing the actions of administrators. <br><br>  Mailbox auditing is one of the most important functions of Microsoft Exchange 2013. Mailboxes can contain various kinds of information ‚Äî confidential organization data, work documents, as well as personal data.  In many organizations, administrators do not include mailbox auditing on Exchange servers.  It is often necessary to conduct some kind of ‚Äúinvestigation‚Äù of users' actions, but if auditing is not included, then information in the event logs cannot be found. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The cases I‚Äôm talking about are fairly common:</b> <br><ol><li>  The mailbox was compromised and confidential information was leaked.  It is necessary to find out who had access to the box, and what actions took place. </li><li>  The organization has a mailbox, access to it is delegated to several employees (for example, during the head‚Äôs vacation time - his deputies).  It is necessary to understand - which of them deleted important messages. </li><li>  The organization has a shared mailbox (for example, support@domain.ru), many employees have access to it.  It is necessary to understand which of them sent unwanted messages on behalf of the general account. </li><li>  The organization has a standard for recording access to information resources, incl.  and mailboxes. </li></ol><br><br><a name="habracut"></a><br>  <b>There are three levels of Exchange mailbox auditing:</b> <br><ol><li>  AuditOwner - Information about operations performed by the box owner. </li><li>  AuditDelegate - Information on operations performed by third-party recipients / delegates in a separate box includes the following types of operations: Update, SoftDelete, HardDelete, SendAs, Create. </li><li>  AuditAdmin - Information about operations performed by administrators in a separate box includes the following types of operations: Update, Move, MoveToDeletedItems, SoftDelete, HardDelete, FolderBind, SendAs, SendOnBehalf, Create. </li></ol><br><br>  By default, mailbox auditing is turned off.  Once enabled, event audit logs are generated and stored in the <b>Recoverable Items&gt; Audits folder</b> .  Audit logs are always saved, even when the mailbox is moved to a new database on the same or another server. <br>  A command to check which audit levels are enabled for a single mailbox: <br><pre><code class="javascript hljs">Get-Mailbox Krishna.kumar | fl *audit*</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/1e1/096/d56/1e1096d5605272343944835d27d2a424.png"><br><br>  Mailbox auditing is enabled using the set-mailbox command with the AuditEnabled parameter set to $ true: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-Mailbox ‚ÄìIdentity Krishna.kumar ‚ÄìAuditEnabled $<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/72e/0c8/4c4/72e0c84c4613c37465be3a15a02ad778.png"><br><br>  Auditing on all mailboxes in an organization can be enabled using the following small PowerShell script: <br><br><pre> <code class="javascript hljs">$UserMailboxes = Get-Mailbox -Filter {(RecipientTypeDetails -eq <span class="hljs-string"><span class="hljs-string">'UserMailbox'</span></span>)} $UserMailboxes | <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-Mailbox -AuditEnabled $True</code> </pre><br><br>  Audit logs are kept by default for 90 days, this parameter can be changed using the set-mailbox command with the AuditLogAgeLimit parameter: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-mailbox ‚Äìidentity Krishna.Kumar ‚ÄìAuditlogAgelimit <span class="hljs-number"><span class="hljs-number">120</span></span></code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/dbc/e9d/3dd/dbce9d3ddae731eb333ed10f485b3bb1.png"><br><br>  Enabling the audit of the actions of the box owner can generate a large number of entries in the audit logs, so by default it is turned off.  The figure below shows the default values ‚Äã‚Äãfor all audit levels, i.e.  types of transactions that are tracked. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/471/fa1/44f/471fa144f5230c4eee7f15909b1e6ebe.png"><br>  We recommend that you include an audit of only those operations that need to be monitored as part of your ‚Äúinvestigations‚Äù or for compliance with policies and regulations.  Below we have the PowerShell command necessary to enable auditing of the HardDelete operation for the mailbox owner: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-Mailbox -Identity ‚ÄúKrishna.kumar‚Äù -AuditOwner HardDelete</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/322/879/615/3228796156094cb0ecf0ab33fec25083.png"><br><br>  <b>The following actions are logged in mailbox audit logs:</b> <br><ol><li>  Copying objects / messages to folders </li><li>  Sending or receiving messages </li><li>  Attempts to access folders </li><li>  All attempts to delete messages (in the folder "Deleted" or permanently) </li><li>  Moving messages from one folder to another or to the Deleted Items folder </li><li>  Sending messages on behalf of another user </li><li>  Modifying objects and their properties </li></ol><br><br>  Event audit logs are generated and stored in the mailbox in the <b>Recoverable Items&gt; Audits folder</b> ; they are hidden from the user's eyes.  After you enable auditing, you can search one or more mailboxes at the same time.  Search can be done using PowerShell or Exchange Admin Central (EAC). <br><br>  <b>Searching event logs using PowerShell, here are some examples:</b> <br><br>  1. The command allows you to search for connection attempts on behalf of ‚ÄúAdmin‚Äù and ‚ÄúDelegate‚Äù in all logs in the time interval in the user box of ‚ÄúKrishna.Kumar‚Äù <br><br><pre> <code class="javascript hljs">Search-MailboxAuditLog -Identity Krishna.Kumar -LogonTypes Admin,Delegate -StartDate <span class="hljs-number"><span class="hljs-number">4</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> -EndDate <span class="hljs-number"><span class="hljs-number">4</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> -ResultSize <span class="hljs-number"><span class="hljs-number">4000</span></span></code> </pre><br><br>  2. The command allows you to search for ‚ÄúSendAS‚Äù operations performed on behalf of ‚ÄúAdmin‚Äù and ‚ÄúDelegate‚Äù in user boxes of ‚ÄúKrishna.Kumar‚Äù and ‚ÄúRajesh.Kumar‚Äù <br><br><pre> <code class="javascript hljs">Search-MailboxAuditLog -Identity Krishna.kumar,rajesh.kumar -LogonTypes Admin,Delegate -ShowDetails -StartDate <span class="hljs-number"><span class="hljs-number">4</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2012</span></span> -EndDate <span class="hljs-number"><span class="hljs-number">4</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> | Where-<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span> {$_.Operation -eq ‚Äúsendas‚Äù}</code> </pre><br><br>  3. The command allows you to search for ‚ÄúHard Delete‚Äù operations performed on behalf of the owner in the user box of ‚ÄúKrishna.Kumar‚Äù <br><br><pre> <code class="javascript hljs">Search-MailboxAuditLog -Identity Krishna.kumar -LogonTypes Owner -ShowDetails -StartDate <span class="hljs-number"><span class="hljs-number">4</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> -EndDate <span class="hljs-number"><span class="hljs-number">3</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2012</span></span> | Where-<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span> {$_.Operation -eq ‚ÄúHardDelete‚Äù}</code> </pre><br><br>  <b>Search the event logs using the EAC (Exchange Admin Central):</b> <br><br><ol><li>  Open the EAC console, select Compliance Management&gt; Auditing, then click on the link <b>‚ÄúRun a non-owner mailbox access report‚Äù</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bbf/d74/93c/bbfd7493cb86e3bf557466495a71f2ba.png"></li><li>  Select the date interval and the mailbox in which you want to search and click the "Search" button <br><img src="https://habrastorage.org/getpro/habr/post_images/5eb/639/bf6/5eb639bf6ac87a97c081725d084aa823.png"></li></ol><br><br>  That, in essence, is all that is required for an administrator to investigate incidents or monitor user actions on Exchange servers. <br><br>  You can ask any questions (and express your wishes) in the comments or in other social networks: <a href="">facebook</a> , <a href="https://twitter.com/netwrix_ru">twitter</a> , <a href="http://vk.com/netwrix_ru">vkontakte</a> . </div><p>Source: <a href="https://habr.com/ru/post/231483/">https://habr.com/ru/post/231483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../231469/index.html">Running CDN for cloud storage</a></li>
<li><a href="../231471/index.html">A simple cloud backup for developers, and how we work on it in Yandex Tolstoy Startup Camp</a></li>
<li><a href="../231473/index.html">New in Support-Library</a></li>
<li><a href="../231477/index.html">Philips VISIQ: portable ultrasound scanner tablet</a></li>
<li><a href="../231481/index.html">According to NASA, Opportunity became the record for the mileage among all extraterrestrial spacecraft.</a></li>
<li><a href="../231485/index.html">The director of the film Suzy Q asked to post his picture on The Pirate Bay</a></li>
<li><a href="../231487/index.html">SPM Conf-4: complex is available</a></li>
<li><a href="../231489/index.html">Bitcoin check</a></li>
<li><a href="../231491/index.html">Protecting the L2 network with switches</a></li>
<li><a href="../231493/index.html">Nokia X, X + and XL received an update</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>