<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ready client module Google Pay</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comrades, I present a ready-made JavaScript module for making payments using Google Pay. The module assumes use in the modern development environment ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ready client module Google Pay</h1><div class="post__text post__text-html js-mediator-article">  Comrades, I present a ready-made JavaScript module for making payments using Google Pay.  The module assumes use in the modern development environment npm with export-import, however, those who want pure ES5, I think, will be able to redo it easily. <br><br>  <a href="https://github.com/botyaslonim/googlepayjs/">Link to module</a> .  The code has the necessary documentation and comments.  Here I will give some explanations. <br><br><img src="https://habrastorage.org/webt/bx/7v/w-/bx7vw-kabeksizoyqb5zeghotzu.png"><br><a name="habracut"></a><br>  I must say that the Google documentation for the payment button turned out to be not the easiest, the list of errors returned by the Google Pay API is also not the most comprehensive.  Therefore, unlike the work with ApplePay, Google Pay had to be a little different, before the module really worked. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The work consists of two stages: first we have to decide whether or not to show the button (not all browsers support Google Pay), and then perform the payment processing itself. <br><br>  <b>1. Button display</b> <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showGooglePayButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options, callbacks</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   const check = checkParams("showGooglePayButton", options, callbacks); if (!check) { return false; } else { options = check.options; } const paymentsClient = new google.payments.api.PaymentsClient({environment: options.environment}); //      ,   API callbacks.setPaymentClient(paymentsClient); const request = { apiVersion: 2, apiVersionMinor: 0, allowedPaymentMethods: [options.googleBaseCardPaymentMethod] }; paymentsClient.isReadyToPay(request) .then(function(response) { if (response.result) { callbacks.success(); return true; } else { console.log("    Google Pay  "); callbacks.fail(); } }) .catch(function(err) { console.log("showGooglePayButton ERROR"); callbacks.fail(); }); }</span></span></code> </pre> <br>  There is nothing difficult.  In options, we pass two parameters - googleBaseCardPaymentMethod and environment. <br><br>  <i>googleBaseCardPaymentMethod</i> is an object that lists payment types and parameters (more details <a href="https://developers.google.com/pay/api/web/reference/object">here</a> on the <i>allowed</i> search).  If it is not specified, we call the standard setter in the code, which returns a typical object to us: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> setGoogleBaseCardPaymentMethod = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"CARD"</span></span>, <span class="hljs-attr"><span class="hljs-attr">parameters</span></span>: { <span class="hljs-attr"><span class="hljs-attr">allowedAuthMethods</span></span>: [<span class="hljs-string"><span class="hljs-string">"PAN_ONLY"</span></span>, <span class="hljs-string"><span class="hljs-string">"CRYPTOGRAM_3DS"</span></span>], <span class="hljs-attr"><span class="hljs-attr">allowedCardNetworks</span></span>: [<span class="hljs-string"><span class="hljs-string">"AMEX"</span></span>, <span class="hljs-string"><span class="hljs-string">"DISCOVER"</span></span>, <span class="hljs-string"><span class="hljs-string">"JCB"</span></span>, <span class="hljs-string"><span class="hljs-string">"MASTERCARD"</span></span>, <span class="hljs-string"><span class="hljs-string">"VISA"</span></span>] } } };</code> </pre> <br>  <i>environment</i> is an environment, PRODUCTION or TEST <br><br>  On the callback call for success, we actually draw (or show the button that has already been drawn).  This is your choice.  Just remember that Google requires compliance with <a href="https://developers.google.com/pay/api/web/guides/brand-guidelines">its guidelines</a> . <br><br>  <b>2. Processing</b> <br><br>  To display the Google button, the Pay API of your browser created a <i>paymentClient</i> object, which now along with other parameters must be passed to the processing function.  Let's look at other parameters: <br><br>  <i>googleBaseCardPaymentMethod</i> - see above <br>  <i>googlePayPublicKey, merc_id, merc_name</i> - you must have a registered merchant to successfully work with Google Pay.  Its parameters, we get the back. <br><br>  In addition, we pass the success and fail callbacks, as well as data for making a payment (see below). <br><br>  So, to make a payment, we must take the previously created <i>paymentClient</i> object and call its <i>loadPaymentData</i> method with the <i>paymentDataRequest</i> object: <i>const paymentDataRequest = getGooglePaymentDataRequest ()</i> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getGooglePaymentDataRequest = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cardPaymentMethod = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign( {}, baseMethod, { <span class="hljs-attr"><span class="hljs-attr">tokenizationSpecification</span></span>: token } ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> paymentDataRequest = { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">apiVersionMinor</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">allowedPaymentMethods</span></span> : [cardPaymentMethod], <span class="hljs-comment"><span class="hljs-comment">/* for demo (enviroment TEST): merchantInfo : { merchantId: '12345678901234567890', merchantName: 'JOHN SMITH' }, */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* for prod (enviroment PRODUCTION): merchantInfo : { merchantId: options.merc_id, merchantName: options.merc_name }, */</span></span> merchantInfo : { <span class="hljs-attr"><span class="hljs-attr">merchantId</span></span>: options.merc_id, <span class="hljs-attr"><span class="hljs-attr">merchantName</span></span>: options.merc_name }, <span class="hljs-attr"><span class="hljs-attr">transactionInfo</span></span> : { <span class="hljs-attr"><span class="hljs-attr">currencyCode</span></span>: options.currency, <span class="hljs-attr"><span class="hljs-attr">totalPriceStatus</span></span>: <span class="hljs-string"><span class="hljs-string">'FINAL'</span></span>, <span class="hljs-attr"><span class="hljs-attr">totalPrice</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> + options.sum } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> paymentDataRequest; };</code> </pre> <br>  For the test environment, Google offers its merchantInfo object.  It should be used exactly with the <i>merchantId</i> , which is written in the example, <i>merchantName is</i> not essential. <br><br>  In addition, we need a <i>token</i> object: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> token = { <span class="hljs-comment"><span class="hljs-comment">/* for demo (enviroment TEST): parameters: { "protocolVersion": "ECv1", "publicKey": yourTestPublicKey } */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* for prod (enviroment PRODUCTION): parameters: { "protocolVersion": "ECv1", "publicKey": params.googlePayPublicKey } */</span></span> type: <span class="hljs-string"><span class="hljs-string">'DIRECT'</span></span>, <span class="hljs-attr"><span class="hljs-attr">parameters</span></span>: { <span class="hljs-string"><span class="hljs-string">"protocolVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"ECv1"</span></span>, <span class="hljs-string"><span class="hljs-string">"publicKey"</span></span>: options.googlePayPublicKey } };</code> </pre> <br>  ‚Üí Read more about parameters <a href="https://developers.google.com/pay/api/web/reference/object">here.</a> <br><br>  Then, when the object is formed, a request is sent to the Google server using the <i>loadPaymentData</i> method, a frame with saved maps is opened, and the frame is closed after the operation is completed: <br><br><pre> <code class="javascript hljs">paymentsClient.loadPaymentData(paymentDataRequest) .then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">paymentData</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> googleToken = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(paymentData.paymentMethodData.tokenizationData.token); <span class="hljs-comment"><span class="hljs-comment">// your own client-back ajax request here }</span></span></code> </pre><br>  After successfully completing the method (i.e. calling the saved cards and passing verification), we can make an AJAX request to our own back-up with the goal of making a payment using Google Pay.  In this request, we will need to pass the <i>googleToken</i> that came from Google, as well as the public key. <br><br>  Everything, our payment Google Pay after processing on a bek took place! </div><p>Source: <a href="https://habr.com/ru/post/433140/">https://habr.com/ru/post/433140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433128/index.html">What IT professionals play and do not play (summary 2018)</a></li>
<li><a href="../433130/index.html">May the force be with us: our own immunity against cancer</a></li>
<li><a href="../433132/index.html">"Calendar tester" for December. Try a different approach</a></li>
<li><a href="../433136/index.html">System.Transactions infrastructure in the .NET world</a></li>
<li><a href="../433138/index.html">Five principles of product design in Booking</a></li>
<li><a href="../433142/index.html">Timeless classics, or review of new attack vectors through Microsoft Office</a></li>
<li><a href="../433144/index.html">Released .NET Core 2.2. What's new? (1 of 3)</a></li>
<li><a href="../433146/index.html">[Competition] Top 25 game consoles (shake old)</a></li>
<li><a href="../433152/index.html">Transferring Zimbra from a single server to a multi-server infrastructure</a></li>
<li><a href="../433154/index.html">User experience in 5G NR networks expected in real conditions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>