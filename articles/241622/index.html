<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Finishing" Asterisk CDR Viewer for yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúI‚Äôm a professional because I‚Äôm not lazy about looking for information on google,‚Äù a colleague told me once. 

 And I was too lazy and began to ‚Äúfinis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Finishing" Asterisk CDR Viewer for yourself</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/261/16d/63e/26116d63ec434750861af5f180674927.png" alt="image"><br><br>  ‚ÄúI‚Äôm a professional because I‚Äôm not lazy about looking for information on google,‚Äù a colleague told me once. <br><br>  And I was too lazy and began to ‚Äúfinish‚Äù the CDR Viewer for myself, without even looking at <a href="http://habrahabr.ru/post/212815/">this</a> . <br>  And maybe not in a lazy business, it was just interesting ... in general, what came of it can be viewed under the cut :) <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Disputes about whether it is better to use as an office PBX - asterisk (with or without a web interface, although this is a separate topic for disputes) or some kind of Panasonic box, which has been unmeasured to the market - have not subsided yet, but the topic is not about that, for myself, I have long been determined.  I would like to share with the community my own way of giving the interface of viewing statistics an additional functional. <br><br>  As a ‚Äútest subject,‚Äù I used FreePBX Distro (FreePBX 2.11, Asterisk 11, CentOS 6.5), downloaded from <a href="">the</a> project‚Äôs <a href="">official website</a> .  The choice was dictated by the fact that the developers of FreePBX have already taken care of screwing the database to Asterisk and the structure of the storage of records in general suits me.  Although the procedure of ‚Äúscrewing‚Äù MySQL or some other database to Asterisk was described more than once or twice, which you can read about, for example, <a href="http://linux.mixed-spb.ru/asterisk/cdr-db-mysql-cdr_mysql.php">here</a> , in order to save time, I decided not to do it. <br><br>  The Asterisk CDR Viewer was taken as a basis (if you don‚Äôt need some super-wise reports, then you‚Äôll have some pretty useful statistics), you can download it <a href="https://code.google.com/p/asterisk-cdr-viewer/">here</a> . <br><br>  Installing the CDR Viewer does not seem to be a non-trivial task. <br><br>  Go to the directory we need, download the archive, extract the files from the archive: <br><br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /var/www wget https://asterisk-cdr-viewer.googlecode.com/files/asterisk-cdr-viewer-1.0.2.tgz tar -xzvf asterisk-cdr-viewer-1.0.2.tgz</code> </pre> <br><br>  We transfer the alias file to the folder with apache2: <br><pre> <code class="bash hljs">cp /var/www/html/asterisk-cdr-viewer/contrib/httpd/asterisk-cdr-viewer.conf /etc/apache2/conf.d/asterisk-cdr-viewer.conf</code> </pre><br><br>  Change the settings for connecting to the database for Asterisk-CDR-viewer <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /var/www/asterisk-cdr-viewer/include/ vim config.inc.php</code> </pre><br><br>  You need to change the parameters in accordance with the current configuration of your database: <br><br>  $ db_user = '[MySQL user]'; <br>  $ db_pass = '[MySQL password]'; <br>  $ db_name = '[Base name]'; <br><br>  We restart the web server: <br><br><pre> <code class="bash hljs">service apache2 restart</code> </pre><br><br>  Now in the browser typing [address of the asteridk server] / acdr / we get to the statistics page. <br><br>  The first thing I wanted to do was screw the authorization to view this very statistics, for this we use htpasswd. <br>  If not installed - <br><pre> <code class="bash hljs">aptitude install apache2-utils</code> </pre><br><br>  Go to / etc / apache2 and create a user / password for statistics: <br><pre> <code class="bash hljs">htpasswd -c passwordfile username</code> </pre><br><br>  Enter the password in the dialog that htpasswd offers and get the file ‚Äúpasswordfile‚Äù with the username ‚Äúusername‚Äù and the generated encrypted password. <br><br>  Next, in /etc/apache2/conf.d, we modify asterisk-cdr-viewer.conf, uncommenting the authorization lines, as a result we get: <br><br>  Alias ‚Äã‚Äã/ acdr / "/ var / www / asterisk-cdr-viewer /" <br><br>  &lt;Location "/ acdr /"&gt; <br>  &lt;------&gt; AuthName "Asterisk-CDR-Stat" <br>  &lt;------&gt; AuthType Basic <br>  &lt;------&gt; AuthUserFile / etc / apache2 / passwordfile <br>  &lt;------&gt; AuthGroupFile / dev / null <br>  &lt;------&gt; require valid-user <br><br><br>  Restart apache2 and at the entrance to the page we see the authorization window: <br><br><img src="https://habrastorage.org/files/f5d/ca8/ced/f5dca8ced7e5438984ccf2955b6b38eb.png" alt="image"><br><br>  The next thing that was done was listening to conversations from the web interface. <br><br>  1) To listen to calls, add two icons to the / var / www / asterisk-cdr-viewer / templates / images ( <a href="">play</a> and <a href="">stop</a> ) directory <br><br>  2) Add to /var/www/asterisk-cdr-viewer/templates/header.tpl.php declare js-function to optimize performance; <br><br><div class="spoiler">  <b class="spoiler_title">The result is:</b> <div class="spoiler_text"><br><pre> <code class="php hljs">&lt;head&gt; &lt;title&gt;Asterisk Call Detail Records&lt;/title&gt; &lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span> content=<span class="hljs-string"><span class="hljs-string">"application/xhtml+xml; charset=utf-8"</span></span> /&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> href=<span class="hljs-string"><span class="hljs-string">"style/screen.css"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/css"</span></span> media=<span class="hljs-string"><span class="hljs-string">"screen"</span></span> /&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"shortcut icon"</span></span> href=<span class="hljs-string"><span class="hljs-string">"templates/images/favicon.ico"</span></span> /&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>/&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">audioPreview</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e,cnc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uri = e.attributes.getNamedItem(<span class="hljs-string"><span class="hljs-string">'data-uri'</span></span>).value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> audioElement; <span class="hljs-comment"><span class="hljs-comment">// 1 if not exists audio control, then create it: if (!(audioElement = document.getElementById('au_preview'))) { audioElement = document.createElement('audio'); audioElement.id = 'au_preview'; audioElement.controls = true; audioElement.style.display = 'none'; document.body.appendChild(audioElement); } else { // 2 need to stop and hide if playing: var prevIcon = audioElement.parentNode.previousSibling; prevIcon.src = 'templates/images/play.png'; prevIcon.onclick = function(){ return audioPreview(prevIcon,false);}; } if (('undefined'===typeof cnc)||(!cnc)) { //1. to show e.nextSibling.appendChild(audioElement); audioElement.src = uri; audioElement.style.display = 'block'; audioElement.play(); e.onclick = function(){ return audioPreview(e,true); }; e.src = 'templates/images/stop.png'; } else { //2. to hide audioElement.pause(); audioElement.style.display = 'none'; e.onclick = function(){ return audioPreview(e,false); }; e.src = 'templates/images/play.png'; } }&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;table id="header"&gt; &lt;tr&gt; &lt;td id="header_logo" rowspan="2" align="left"&gt;&lt;a href="/" title="Home"&gt;&lt;img src="" alt="Asterisk CDR Viewer" /&gt;&lt;/a&gt;&lt;/td&gt; &lt;td id="header_title"&gt;Asterisk CDR Viewer&lt;/td&gt; &lt;td align='right'&gt; &lt;a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=XVUVZY5D922JJ&amp;lc=RU&amp;item_name=i%2eo%2e&amp;item_number=asterisk%2dcdr¬§cy_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted"&gt;&lt;img src="http://habrastorage.org/getpro/habr/post_images/92a/7cd/b91/92a7cdb914a8e942ca23d0ec49367cc3.gif" align="center"/&gt;&lt;/a&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td id="header_subtitle"&gt; &lt;/td&gt; &lt;td align='right'&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if ( strlen(getenv('REMOTE_USER')) ) { echo "&lt;a href='/acdr/index.php?action=logout'&gt;logout: ". getenv('REMOTE_USER') ."&lt;/a&gt;"; } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt;</span></span></code> </pre><br></div></div><br><br>  3) <div class="spoiler">  <b class="spoiler_title">Modify /var/www/asterisk-cdr-viewer/include/functions.inc.php, modifying the echo constructions: add a small piece of the necessary markup to the speaker icon</b> <div class="spoiler_text"><pre> <code class="php hljs">&lt;head&gt; &lt;title&gt;Asterisk Call Detail Records&lt;/title&gt; &lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span> content=<span class="hljs-string"><span class="hljs-string">"application/xhtml+xml; charset=utf-8"</span></span> /&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> href=<span class="hljs-string"><span class="hljs-string">"style/screen.css"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/css"</span></span> media=<span class="hljs-string"><span class="hljs-string">"screen"</span></span> /&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"shortcut icon"</span></span> href=<span class="hljs-string"><span class="hljs-string">"templates/images/favicon.ico"</span></span> /&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>/&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">audioPreview</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e,cnc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uri = e.attributes.getNamedItem(<span class="hljs-string"><span class="hljs-string">'data-uri'</span></span>).value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> audioElement; <span class="hljs-comment"><span class="hljs-comment">// 1 if not exists audio control, then create it: if (!(audioElement = document.getElementById('au_preview'))) { audioElement = document.createElement('audio'); audioElement.id = 'au_preview'; audioElement.controls = true; audioElement.style.display = 'none'; document.body.appendChild(audioElement); } else { // 2 need to stop and hide if playing: var prevIcon = audioElement.parentNode.previousSibling; prevIcon.src = 'templates/images/play.png'; prevIcon.onclick = function(){ return audioPreview(prevIcon,false);}; } if (('undefined'===typeof cnc)||(!cnc)) { //1. to show e.nextSibling.appendChild(audioElement); audioElement.src = uri; audioElement.style.display = 'block'; audioElement.play(); e.onclick = function(){ return audioPreview(e,true); }; e.src = 'templates/images/stop.png'; } else { //2. to hide audioElement.pause(); audioElement.style.display = 'none'; e.onclick = function(){ return audioPreview(e,false); }; e.src = 'templates/images/play.png'; } }&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;table id="header"&gt; &lt;tr&gt; &lt;td id="header_logo" rowspan="2" align="left"&gt;&lt;a href="/" title="Home"&gt;&lt;img src="" alt="Asterisk CDR Viewer" /&gt;&lt;/a&gt;&lt;/td&gt; &lt;td id="header_title"&gt;Asterisk CDR Viewer&lt;/td&gt; &lt;td align='right'&gt; &lt;a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=XVUVZY5D922JJ&amp;lc=RU&amp;item_name=i%2eo%2e&amp;item_number=asterisk%2dcdr¬§cy_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted"&gt;&lt;img src="" align="center"/&gt;&lt;/a&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td id="header_subtitle"&gt; &lt;/td&gt; &lt;td align='right'&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if ( strlen(getenv('REMOTE_USER')) ) { echo "&lt;a href='/acdr/index.php?action=logout'&gt;logout: ". getenv('REMOTE_USER') ."&lt;/a&gt;"; } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; root@sip:/var/www/asterisk-cdr-viewer/templates# root@sip:/var/www/asterisk-cdr-viewer/include# cat functions.inc.php </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> /* Recorded file */ function formatFiles($row) { global $system_monitor_dir, $system_fax_archive_dir, $system_audio_format, $system_arch_audio_format; /* File name formats, please specify: */ /* caller-called-timestamp.wav */ /* $recorded_file = $row['src'] .'-'. $row['dst'] .'-'. $row['call_timestamp'] */ /* ============================================================================ */ /* ends at the uniqueid.wav, for example: date-time-uniqueid.wav thanks to Beto Reyes */ /* $recorded_file = glob($system_monitor_dir . '/*' . $row['uniqueid'] . '.' . $system_audio_format); if (count($recorded_file)&gt;0) { $recorded_file = basename($recorded_file[0],".$system_audio_format"); } else { $recorded_file = $row['uniqueid']; } */ /* ============================================================================ */ /* This example for multi-directory archive without uniqueid, named by format: &lt;date&gt;/&lt;time&gt;_&lt;caller&gt;-&lt;destination&gt;.&lt;filetype&gt; example: (tree /var/spool/asterisk/monitor) |-- 2012.09.12 | |-- 10-37_4952704601-763245.ogg | `-- 10-43_106-79236522173.ogg `-- 2012.09.13 |-- 11-42_101-79016410692.ogg |-- 12-43_104-671554.ogg `-- 15-49_109-279710.ogg Added by BAXMAH (pcm@ritm.omsk.ru) */ /* $record_datetime = DateTime::createFromFormat('Ymd G:i:s', $row['calldate']); $recorded_file = date_format($record_datetime, 'Ymd/G-i') .'_'. $row['src'] .'-'. $row['dst']; */ /* ============================================================================ */ /* This is a multi-dir search script for filenames like "/var/spool/asterisk/monitor/dir1/dir2/dir3/*uniqueid*.*" Doesn't matter, WAV, MP3 or other file format, only UNIQID is required at the end of the filename ;--------------------------------------------------------------------------- example: (tree /var/spool/asterisk/monitor) |-- in | |-- 4951234567 | | `-- 20120101_234231_4956401234_to_74951234567_1307542950.0.wav | `-- 4997654321 | `-- 20120202_234231_4956401234_to_74997654321_1303542950.0.wav `-- out |-- msk | `-- 20120125_211231_4956401234_to_74951234567_1307542950.0.wav `-- region `-- 20120112_211231_4956405570_to_74952210533_1307542950.0.wav 6 directories, 4 files ;---------------------------------------------------------------------------- added by Dein admin@sadmin.ru */ //************ Get a list of subdirectories as array to search by glob function ************** if (!function_exists('get_dir_list')) { function get_dir_list($dir){ global $dirlist; $dirlist=array(); if (!function_exists('find_dirs_recursive')) { function find_dirs_recursive($sdir) { global $dirlist; foreach(glob($sdir) as $filename) { //echo $filename; if(is_dir($filename)) { $dirlist[]=$filename; find_dirs_recursive($filename."/*"); };//endif };//endforeach }; //endfunc };//endif exists find_dirs_recursive($dir."/*"); };//endfunc } //*************** Main function ************ if (!function_exists('find_record_by_uniqid')) { function find_record_by_uniqid($path,$uniqid){ global $dirlist; if (sizeof($dirlist) == 0 ){ get_dir_list($path); };//endif size==0 if (sizeof($dirlist) == 0 ) {return "SOME ERROR, dirlist is empty";}; $found = "NOTHING FOUND"; foreach ($dirlist as $curdir) { $res=glob($curdir."/*".$uniqid.".*"); if ($res) {$found=$res[0]; break;}; };//endforeach $res=str_replace($path,"",$found); //cut $path from full filename return $res; //to be compartable with func. formatFiles($row) };//endfunc } $recorded_file = find_record_by_uniqid($system_monitor_dir,$row['uniqueid']); /* ============================================================================ */ /* uniqueid.wav */ // $recorded_file = $row['filename']; /* ============================================================================ */ if (file_exists("$system_monitor_dir/$recorded_file.$system_audio_format")) { // insert here: echo " &lt;td class=\"record_col\"&gt;&lt;div class=\"record_ctrl\"&gt;&lt;a href=\"download.php?audio=$recorded_file.$system_audio_format\" title=\"Listen to call recording\"&gt;&lt;img src= recording\" /&gt;&lt;/a&gt;&lt;img class=\"record_preview_icon\" src= onclick=\"audioPreview(this,false);\"/&gt;&lt;div class=\"record_preview_lt\"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/td&gt;\n"; } elseif ( isset($system_arch_audio_format) and file_exists("$system_monitor_dir/$recorded_file.$system_audio_format.$system_arch_audio_format")) { echo " &lt;td class=\"record_col\"&gt;&lt;a href=\"download.php?arch=$recorded_file.$system_audio_format.$system_arch_audio_format\" title=\"Download archive\"&gt;&lt;img src= recording\" /&gt;&lt;/a&gt;&lt;/td&gt;\n"; } elseif (file_exists("$system_fax_archive_dir/$recorded_file.tif")) { echo " &lt;td class=\"record_col\"&gt;&lt;a href=\"download.php?fax=$recorded_file.tif\" title=\"View FAX image\"&gt;&lt;img src= image\" /&gt;&lt;/a&gt;&lt;/td&gt;\n"; } elseif (file_exists("$system_monitor_dir/$recorded_file")) { // insert here: echo " &lt;td class=\"record_col\"&gt;&lt;div class=\"record_ctrl\"&gt;&lt;a href=\"download.php?audio=$recorded_file\" title=\"Listen to call recording\"&gt;&lt;img src= recording\" /&gt;&lt;/a&gt;&lt;img class=\"record_preview_icon\" src= onclick=\"audioPreview(this,false);\"/&gt;&lt;div class=\"record_preview_lt\"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/td&gt;\n"; } else { echo " &lt;td class=\"record_col\"&gt;&lt;/td&gt;\n"; } } /* CDR Table Display Functions */ function formatCallDate($calldate,$uniqueid) { echo " &lt;td class=\"record_col\"&gt;&lt;abbr title=\"UniqueID: $uniqueid\"&gt;$calldate&lt;/abbr&gt;&lt;/td&gt;\n"; } function formatChannel($channel) { $trunk_name = preg_replace('/(.*)-[^-]+$/','$1',$channel); echo " &lt;td class=\"record_col\"&gt;&lt;abbr title=\"Channel: $channel\"&gt;$trunk_name&lt;/abbr&gt;&lt;/td&gt;\n"; } function formatClid($clid) { $clid_only = explode(' &lt;', $clid, 2); $clid = htmlspecialchars($clid_only[0]); echo " &lt;td class=\"record_col\"&gt;$clid&lt;/td&gt;\n"; } function formatSrc($src,$clid) { if (empty($src)) { echo " &lt;td class=\"record_col\"&gt;UNKNOWN&lt;/td&gt;\n"; } else { $src = htmlspecialchars($src); $clid = htmlspecialchars($clid); echo " &lt;td class=\"record_col\"&gt;&lt;abbr title=\"Caller*ID: $clid\"&gt;$src&lt;/abbr&gt;&lt;/td&gt;\n"; } } function formatApp($app, $lastdata) { echo " &lt;td class=\"record_col\"&gt;&lt;abbr title=\"Application: $app($lastdata)\"&gt;$app&lt;/abbr&gt;&lt;/td&gt;\n"; } function formatDst($dst, $dcontext) { global $rev_lookup_url; if (strlen($dst) == 11 and strlen($rev_lookup_url) &gt; 0 ) { $rev = str_replace('%n', $dst, $rev_lookup_url); echo " &lt;td class=\"record_col\"&gt;&lt;abbr title=\"Destination Context: $dcontext\"&gt;&lt;a href=\"$rev\" target=\"reverse\"&gt;$dst&lt;/a&gt;&lt;/abbr&gt;&lt;/td&gt;\n"; } else { echo " &lt;td class=\"record_col\"&gt;&lt;abbr title=\"Destination Context: $dcontext\"&gt;$dst&lt;/abbr&gt;&lt;/td&gt;\n"; } } function formatDisposition($disposition, $amaflags) { switch ($amaflags) { case 0: $amaflags = 'DOCUMENTATION'; break; case 1: $amaflags = 'IGNORE'; break; case 2: $amaflags = 'BILLING'; break; case 3: default: $amaflags = 'DEFAULT'; } echo " &lt;td class=\"record_col\"&gt;&lt;abbr title=\"AMA Flag: $amaflags\"&gt;$disposition&lt;/abbr&gt;&lt;/td&gt;\n"; } function formatDuration($duration, $billsec) { $duration = sprintf('%02d', intval($duration/60)).':'.sprintf('%02d', intval($duration%60)); $billduration = sprintf('%02d', intval($billsec/60)).':'.sprintf('%02d', intval($billsec%60)); echo " &lt;td class=\"record_col\"&gt;&lt;abbr title=\"Billing Duration: $billduration\"&gt;$duration&lt;/abbr&gt;&lt;/td&gt;\n"; } function formatUserField($userfield) { echo " &lt;td class=\"record_col\"&gt;$userfield&lt;/td&gt;\n"; } function formatAccountCode($accountcode) { echo " &lt;td class=\"record_col\"&gt;$accountcode&lt;/td&gt;\n"; } /* Asterisk RegExp parser */ function asteriskregexp2sqllike( $source_data, $user_num ) { $number = $user_num; if ( strlen($number) &lt; 1 ) { $number = $_REQUEST[$source_data]; } if ( '__' == substr($number,0,2) ) { $number = substr($number,1); } elseif ( '_' == substr($number,0,1) ) { $number_chars = preg_split('//', substr($number,1), -1, PREG_SPLIT_NO_EMPTY); $number = ''; foreach ($number_chars as $chr) { if ( $chr == 'X' ) { $number .= '[0-9]'; } elseif ( $chr == 'Z' ) { $number .= '[1-9]'; } elseif ( $chr == 'N' ) { $number .= '[2-9]'; } elseif ( $chr == '.' ) { $number .= '.+'; } elseif ( $chr == '!' ) { $_REQUEST[ $source_data .'_neg' ] = 'true'; } else { $number .= $chr; } } $_REQUEST[ $source_data .'_mod' ] = 'asterisk-regexp'; } return $number; } /* empty() wrapper. Thanks to Mikael Carlsson. */ function is_blank($value) { return empty($value) &amp;&amp; !is_numeric($value); } /* Money format thanks to Shiena Tadeo */ function formatMoney($number, $cents = 2) { // cents: 0=never, 1=if needed, 2=always global $callrate_currency; if (is_numeric($number)) { // a number if (!$number) { // zero $money = ($cents == 2 ? '0.00' : '0'); // output zero } else { // value if (floor($number) == $number) { // whole number $money = number_format($number, ($cents == 2 ? 2 : 0)); // format } else { // cents $money = number_format(round($number, 2), ($cents == 0 ? 0 : 2)); // format } // integer or decimal } // value echo "&lt;td class=\"chart_data\"&gt;$callrate_currency&lt;span&gt;$money&lt;/span&gt;&lt;/td&gt;\n"; } else { echo "&lt;td class=\"chart_data\"&gt; &lt;/td&gt;\n"; } } // formatMoney /* CallRate return callrate array [ areacode, rate, description, bill type, total_rate] */ function callrates($dst,$duration,$file) { global $callrate_csv_file, $callrate_cache; if ( strlen($file) == 0 ) { $file = $callrate_csv_file; if ( strlen($file) == 0 ) { return array('','','','',''); } } if ( ! array_key_exists( $file, $callrate_cache ) ) { $callrate_cache[$file] = array(); $fr = fopen($file, "r") or die("Can not open callrate file ($file)."); while(($fr_data = fgetcsv($fr, 1000, ",")) !== false) { $callrate_cache[$file]["$fr_data[0]"] = array( $fr_data[1], $fr_data[2], $fr_data[3] ); } fclose($fr); } for ( $i = strlen($dst); $i &gt; 0; $i-- ) { if ( array_key_exists( substr($dst,0,$i), $callrate_cache[$file] ) ) { $call_rate = 0; if ( $callrate_cache[$file][substr($dst,0,$i)][2] == 's' ) { // per second $call_rate = $duration * ($callrate_cache[$file][substr($dst,0,$i)][0] / 60); } elseif ( $callrate_cache[$file][substr($dst,0,$i)][2] == 'c' ) { // per call $call_rate = $callrate_cache[$file][substr($dst,0,$i)][0]; } elseif ( $callrate_cache[$file][substr($dst,0,$i)][2] == '1m+s' ) { // 1 minute + per second if ( $duration &lt; 60) { $call_rate = $callrate_cache[$file][substr($dst,0,$i)][0]; } else { $call_rate = $callrate_cache[$file][substr($dst,0,$i)][0] + ( ($duration-60) * ($callrate_cache[$file][substr($dst,0,$i)][0] / 60) ); } } else { //( $callrate_cache[substr($dst,0,$i)][2] == 'm' ) { // per minute $call_rate = intval($duration/60); if ( $duration%60 &gt; 0 ) { $call_rate++; } $call_rate = $call_rate*$callrate_cache[$file][substr($dst,0,$i)][0]; } return array(substr($dst,0,$i),$callrate_cache[$file][substr($dst,0,$i)][0],$callrate_cache[$file][substr($dst,0,$i)][1],$callrate_cache[$file][substr($dst,0,$i)][2],$call_rate); } } return array (0,0,'unknown','unknown',0); } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br></div></div><br><br>  four) <div class="spoiler">  <b class="spoiler_title">We supplement the style file /var/www/asterisk-cdr-viewer/style/screen.css</b> <div class="spoiler_text"><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* HTML tag styles */</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">cursor </span></span>: pointer; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">abbr</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[title]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">border-style </span></span>: none none dashed; <span class="hljs-attribute"><span class="hljs-attribute">border-width </span></span>: medium medium <span class="hljs-number"><span class="hljs-number">1px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-bottom-color </span></span>: <span class="hljs-number"><span class="hljs-number">#000000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">cursor </span></span>: help; <span class="hljs-attribute"><span class="hljs-attribute">white-space </span></span>: nowrap; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color </span></span>: <span class="hljs-number"><span class="hljs-number">#fff</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Fix for M$ IE &lt; 7 CSS hover */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">behavior </span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'style/csshover.htc'</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">color </span></span>: <span class="hljs-number"><span class="hljs-number">#000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font </span></span>: <span class="hljs-number"><span class="hljs-number">65%</span></span> Verdana, Arial, Helvetica, sans-serif; <span class="hljs-attribute"><span class="hljs-attribute">margin </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">border-width </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* ID styles */</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#header</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-image </span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'../templates/images/header_gradient.png'</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">background-repeat </span></span>: repeat-x; <span class="hljs-attribute"><span class="hljs-attribute">margin </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding-left </span></span>: <span class="hljs-number"><span class="hljs-number">5%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding-right </span></span>: <span class="hljs-number"><span class="hljs-number">10%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">position </span></span>: fixed; <span class="hljs-attribute"><span class="hljs-attribute">width </span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">z-index </span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#header_logo</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">105px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">121px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: top; } <span class="hljs-selector-id"><span class="hljs-selector-id">#header_title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#000000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: serif; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">32pt</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-variant</span></span>: small-caps; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">60px</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#header_subtitle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#68878a</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Verdana,Arial,<span class="hljs-string"><span class="hljs-string">'Bitstream Vera Sans'</span></span>,Helvetica,sans-serif; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">12pt</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">60px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding-left</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: top; } <span class="hljs-selector-id"><span class="hljs-selector-id">#main</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding-top </span></span>: <span class="hljs-number"><span class="hljs-number">115px</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#footer</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding </span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-width </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-align </span></span>: center; } <span class="hljs-comment"><span class="hljs-comment">/* Class styles */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.bar_calls</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color </span></span>: <span class="hljs-number"><span class="hljs-number">#aaf5d0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">float </span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">padding </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.bar_duration</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color </span></span>: <span class="hljs-number"><span class="hljs-number">#e5edf9</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">float </span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">padding </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.cdr</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-width </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">white-space </span></span>: nowrap; <span class="hljs-attribute"><span class="hljs-attribute">width </span></span>: <span class="hljs-number"><span class="hljs-number">96%</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.cdr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">th</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color </span></span>: <span class="hljs-number"><span class="hljs-number">#5ebeff</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-color </span></span>: <span class="hljs-number"><span class="hljs-number">#000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-width </span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-align </span></span>: center; } <span class="hljs-selector-class"><span class="hljs-selector-class">.cdr</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.center_col</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width </span></span>: <span class="hljs-number"><span class="hljs-number">78%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding </span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.cdr</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.end_col</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width </span></span>: <span class="hljs-number"><span class="hljs-number">11%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding </span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.cdr</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.chart_data</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding </span></span>: <span class="hljs-number"><span class="hljs-number">0px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-align </span></span>: right; } <span class="hljs-selector-class"><span class="hljs-selector-class">.cdr</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.img_col</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width </span></span>: <span class="hljs-number"><span class="hljs-number">16px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height </span></span>: <span class="hljs-number"><span class="hljs-number">16px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.form</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">legend</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.title</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.title</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#777</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">2em</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; } <span class="hljs-selector-class"><span class="hljs-selector-class">.record</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color </span></span>: <span class="hljs-number"><span class="hljs-number">#fff</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">empty-cells </span></span>: hide; } <span class="hljs-selector-class"><span class="hljs-selector-class">.record</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background </span></span>: <span class="hljs-number"><span class="hljs-number">#ffdca8</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color </span></span>: <span class="hljs-number"><span class="hljs-number">#000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">empty-cells </span></span>: hide; } <span class="hljs-selector-class"><span class="hljs-selector-class">.record_col</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-left </span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding-right </span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-width </span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.center</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">text-align </span></span>: center; } <span class="hljs-selector-class"><span class="hljs-selector-class">.right</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-right </span></span>: <span class="hljs-number"><span class="hljs-number">80px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-align </span></span>: right; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">9pt</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.record_ctrl</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>:relative } <span class="hljs-selector-class"><span class="hljs-selector-class">.record_preview_icon</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>:<span class="hljs-number"><span class="hljs-number">16px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>:<span class="hljs-number"><span class="hljs-number">16px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>:pointer; <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>:<span class="hljs-number"><span class="hljs-number">3px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.record_preview_lt</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>:absolute; <span class="hljs-attribute"><span class="hljs-attribute">top</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">left</span></span>:<span class="hljs-number"><span class="hljs-number">38px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>:<span class="hljs-number"><span class="hljs-number">99</span></span>; }</code> </pre><br></div></div><br><br>  five) <div class="spoiler">  <b class="spoiler_title">We supplement the file /var/www/asterisk-cdr-viewer/download.php (processing range requests for audio files)</b> <div class="spoiler_text"><br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'include/config.inc.php'</span></span>; header(<span class="hljs-string"><span class="hljs-string">'Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0'</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Pragma: no-cache'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">partial_download</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($range_header, $request_file, $mime)</span></span></span><span class="hljs-function"> </span></span>{ $file_size = filesize($request_file); <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($b, $range) = explode(<span class="hljs-string"><span class="hljs-string">'='</span></span>, $range_header); <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($first_range) = explode(<span class="hljs-string"><span class="hljs-string">','</span></span>, $range); <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($part_start,$part_end) = explode(<span class="hljs-string"><span class="hljs-string">'-'</span></span>, $first_range); $start = intval($part_start); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($part_end) $end = intval($part_end); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $end = $file_size - <span class="hljs-number"><span class="hljs-number">1</span></span>; $chunksize = ($end-$start)+<span class="hljs-number"><span class="hljs-number">1</span></span>; header(<span class="hljs-string"><span class="hljs-string">'HTTP/1.1 206 Partial Content'</span></span>); header(<span class="hljs-string"><span class="hljs-string">"Content-Type: $mime"</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Content-Transfer-Encoding: binary'</span></span>); header(<span class="hljs-string"><span class="hljs-string">"Content-Range: bytes $start-$end/$file_size"</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Content-Length: '</span></span>.$chunksize); <span class="hljs-comment"><span class="hljs-comment"># header("Content-Disposition: attachment; filename=\"$_REQUEST[audio]\""); $fp = fopen($request_file, 'r'); fseek($fp, $start, SEEK_SET); echo fread($fp, $chunksize); fclose($fp); } if (isset($_REQUEST['audio'])) { $extension = strtolower(substr(strrchr($_REQUEST['audio'],"."),1)); $ctype =''; switch( $extension ) { case "wav16": $ctype="audio/x-wav"; break; case "wav": $ctype="audio/x-wav"; break; case "ulaw": $ctype="audio/basic"; break; case "alaw": $ctype="audio/x-alaw-basic"; break; case "sln": $ctype="audio/x-wav"; break; case "gsm": $ctype="audio/x-gsm"; break; case "g729": $ctype="audio/x-g729"; break; default: $ctype="application/$system_audio_format"; break ; } header("Accept-Ranges: bytes"); if (!isset($_SERVER['HTTP_RANGE'])) { header("Content-Type: $ctype"); header('Content-Transfer-Encoding: binary'); header('Content-Length: '.filesize("$system_monitor_dir/$_REQUEST[audio]")); header("Content-Disposition: attachment; filename=\"$_REQUEST[audio]\""); readfile("$system_monitor_dir/$_REQUEST[audio]"); } else { partial_download($_SERVER['HTTP_RANGE'], "$system_monitor_dir/$_REQUEST[audio]", $ctype); } } elseif (isset($_REQUEST['fax'])) { header('Content-Type: image/tiff'); header('Content-Transfer-Encoding: binary'); header('Content-Length: '.filesize("$system_fax_archive_dir/$_REQUEST[fax]")); header("Content-Disposition: attachment; filename=\"$_REQUEST[fax]\""); readfile("$system_fax_archive_dir/$_REQUEST[fax]"); } elseif (isset($_REQUEST['csv'])) { header('Content-Type: text/csv'); header('Content-Transfer-Encoding: binary'); header('Content-Length: '.filesize("/tmp/$_REQUEST[csv]")); header("Content-Disposition: attachment; filename=\"$_REQUEST[csv]\""); readfile("$system_tmp_dir/$_REQUEST[csv]"); } elseif (isset($_REQUEST['arch'])) { header('Content-Type: application/x-download'); header('Content-Transfer-Encoding: binary'); header('Content-Length: '.filesize("$system_monitor_dir/$_REQUEST[arch]")); header("Content-Disposition: attachment; filename=\"$_REQUEST[arch]\""); readfile("$system_monitor_dir/$_REQUEST[arch]"); } exit(); ?&gt;</span></span></code> </pre><br><br></div></div><br><br>  As a result, we are able to listen to conversations in the web interface (you can scroll the scroll slider) <br><br><img src="https://habrastorage.org/files/18f/4d4/9f2/18f4d49f2ea2448d97d577581bbb17e0.png"><br><br>  I hope someone will come in handy :) </div><p>Source: <a href="https://habr.com/ru/post/241622/">https://habr.com/ru/post/241622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../241612/index.html">Video in 24 * 365 * 8 format: the history of video service of My World Mail.Ru</a></li>
<li><a href="../241614/index.html">Conference on AR Augmented Reality Technologies</a></li>
<li><a href="../241616/index.html">New features of Veeam Backup & Replication 8.0: improved replication</a></li>
<li><a href="../241618/index.html">25 ways to build a comprehensive snippet</a></li>
<li><a href="../241620/index.html">Thesis project or build Hexapod with your hands</a></li>
<li><a href="../241624/index.html">Moscow region under Probkoskom</a></li>
<li><a href="../241626/index.html">Our electronics: the top 10 developments of the company Promwad</a></li>
<li><a href="../241628/index.html">How much do you need to eat pizza to create a service for students</a></li>
<li><a href="../241630/index.html">Once again about the study and work of an IT person in Germany</a></li>
<li><a href="../241632/index.html">Inheritance of combinatorial parsers on Julia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>