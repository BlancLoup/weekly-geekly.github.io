<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cackle - indexing comments</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This topic will be useful and interesting to all those who use the Cackle widget and would like to implement indexing of comments in search engines. E...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cackle - indexing comments</h1><div class="post__text post__text-html js-mediator-article">  This topic will be useful and interesting to all those who use the <a href="http://cackle.me/">Cackle</a> widget and would like to implement indexing of comments in search engines.  Everything that will be described below is already implemented in the plugin for WordPress version 2.0 and higher.  If you do not use this CMS, then under the cat a detailed description of the process of synchronizing comments with examples in php. <br><a name="habracut"></a><br>  For indexing, comments should be located in your local database and drawn on html pages using your site, without using the Cackle widget.  In general, the synchronization process looks like this: <br><ul><li>  Need to create tables to store comments. </li><li>  Add a controller that will receive comments after a certain time interval </li><li>  Print comments from a local database to a page in a specific div. </li></ul><br><br><h4>  Creating a table </h4><br>  Everything is simple, you need a data structure that stores comments and we need parameters (example mysql): <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`comment`</span></span> ( <span class="hljs-string"><span class="hljs-string">`comment_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`post_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`url`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2000</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`parent`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`message`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`media`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`rating`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`user_agent`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`ip`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">39</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`author_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`author_email`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`author_www`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`author_avatar`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`author_provider`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`anonym_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`anonym_email`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`created`</span></span> DATETIME <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`comment_id`</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`common`</span></span> ( <span class="hljs-string"><span class="hljs-string">`common_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`common_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> )</code> </pre> <br>  Small remarks: <br><ul><li>  post_id - the identifier of the current post, in the simplest case, the url of the page </li><li>  media - media content, links to images (png, jpg, gif), video (youtube, vimeo, VKontakte, rutube), presentations (google, slideshare) </li><li>  status - 0 pending, 1 approved, 2 rejected, 3 spam, 4 deleted </li><li>  author_provider - social network (facebook, twitter, linkedin, ..) </li><li>  created - creation date </li><li>  common - a ‚Äúwaste‚Äù table for storing parameters </li></ul><br>  PS: For simplicity, I did not divide the table into entities - post, author, anonym, although for speed and normalization this would not be a bad thing to do. <br><br><h4>  Synchronize comments </h4><br>  You can get Cackle comments via the following RESTful API service: <br><pre> <code class="bash hljs">http://cackle.me/api/comment/list?siteApiKey={siteApiKey}&amp;accountApiKey={accountApiKey}&amp;id={id}</code> </pre><br>  Where <b>siteApiKey</b> (Site API Key) and <b>accountApiKey</b> (Account API Key) can be found in the administration panel, on the ‚ÄúWidget‚Äù tab, selecting WordPress from the bottom, as shown in the figures below: <br><img src="https://habrastorage.org/getpro/habr/post_images/537/9d4/70d/5379d470d0db764650d57892d3580be7.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/eb5/6ce/6c4/eb56ce6c484e013d59d5117b6f0b9616.png" alt="image"><br>  The optional <b>id</b> parameter serves as a cursor, that is, this query will return all id comments that are more than <b>id</b> in the query.  If the <b>id</b> parameter is missing, the first 100 comments will be transmitted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Synchronization should work according to the scheme: <br><ul><li>  Check if 5 minutes has passed since the last API call, if yes, then go ahead </li><li>  We take the maximum Cackle ID of the comment from the local database or 0 if there are no comments. </li><li>  Call the API with the keys and received Cackle ID </li><li>  We keep comments </li><li>  We get the current time and save it as the time of the last API call. </li></ul><br><br>  The interval between API calls is needed because of the established limit (1000 times per hour, to call any API request). <br>  Php code: <br>  First, we need to define all the constants for the operation of the scripts: connection to the database, crown time, keys to the api Cackle <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//Define db connection settings define('CACKLE_DB_LOCALHOST', "localhost"); define('CACKLE_DB_USER', "root"); define('CACKLE_DB_PASSWORD', ""); define('CACKLE_DB_NAME', "cackle-php" ); //Define timer define('CACKLE_TIMER', 60); //Define Cackle API define('ACCOUNT_API_KEY', ""); define('SITE_API_KEY', "");</span></span></code> </pre><br>  We need a function to implement the custom crown: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_is_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cron_time)</span></span></span></span>{ $sql=<span class="hljs-string"><span class="hljs-string">"select common_value from common where `common_name` = 'last_time'"</span></span>; $get_last_time = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db_connect($sql, <span class="hljs-string"><span class="hljs-string">"common_value"</span></span>); $now=time(); $establish_time_sql=<span class="hljs-string"><span class="hljs-string">"insert into `common` (`common_name`,`common_value`) values ('last_time',$now)"</span></span>; $delete_time_sql=<span class="hljs-string"><span class="hljs-string">"delete from `common` where `common_name` = 'last_time' and `common_value` &gt; 0;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($get_last_time==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db_connect($establish_time_sql); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> time(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($get_last_time + $cron_time &gt; $now){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($get_last_time + $cron_time &lt; $now){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db_connect($delete_time_sql); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db_connect($establish_time_sql); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cron_time; } } }</code> </pre><br>  The comment_sync function implements the request to api, and saves comments in the database. <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">comment_sync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($accountApiKey,$siteApiKey,$cackle_last_comment=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ $params = <span class="hljs-string"><span class="hljs-string">"accountApiKey=$accountApiKey&amp;siteApiKey=$siteApiKey&amp;id=$cackle_last_comment"</span></span>; $host=<span class="hljs-string"><span class="hljs-string">"cackle.me/api/comment/list?$params"</span></span>; $response = curl($host); $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cackle_json_decodes($response); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;push_comments($response); <span class="hljs-comment"><span class="hljs-comment">// for       insert_comment() }</span></span></code> </pre><br>  The insert_comment () function itself that stores comments. <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert_comm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($comment)</span></span></span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($comment[<span class="hljs-string"><span class="hljs-string">'parentId'</span></span>]) { $comment_parent_id = $comment[<span class="hljs-string"><span class="hljs-string">'parentId'</span></span>]; $sql = <span class="hljs-string"><span class="hljs-string">"select comment_id from comment where user_agent='Cackle:$comment_parent_id';"</span></span>; $get_parent_local_id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db_connect($sql, <span class="hljs-string"><span class="hljs-string">"comment_id"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    ,      comment_id    user_agent } $commentdata = array( 'url' =&gt; $url, 'author_name' =&gt; $author_name, 'author_email' =&gt; $author_email, 'author_www' =&gt; $author_www, 'author_avatar' =&gt; $author_avatar, 'author_provider' =&gt; $author_provider, 'anonym_name' =&gt; $author_anonym_name, 'anonym_email' =&gt; $anonym_email, 'rating' =&gt; $comment['rating'], 'created' =&gt; strftime("%Y-%m-%d %H:%M:%S", $comment['created']/1000), 'ip' =&gt; $comment['ip'], 'message' =&gt;$comment['message'], 'status' =&gt; $status, 'user_agent' =&gt; 'Cackle:' . $comment['id'], 'parent' =&gt; $get_parent_local_id ); //   $commentdata   'post_id' = &gt; $post_id,        url    $this-&gt;db_connect($this-&gt;insCreate("comment",$commentdata)); //    }</span></span></code> </pre><br>  A full working comment sync code is available <a href="https://github.com/bisanalytic/php-cackle-sync">here</a> . <br><br><h4>  Drawing comments on html </h4><br>  The final point - draw comments on your page, in the following form: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mc-container"</span></span></span><span class="hljs-tag">&gt;</span></span> [...         ...] <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> [...   Cackle ...] </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Php code: <br>  Get all comments for this page from the local database: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_local_comments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//getting all comments for special post_id from database. //$post_id = 1; $get_all_comments = $this-&gt;db_connect("select * from `comment` where `post_id` = $post_id;"); return $get_all_comments; }</span></span></code> </pre><br>  Create a template function to render a separate comment. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cackle_comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $comment)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;li id=<span class="hljs-string"><span class="hljs-string">"cackle-comment-&lt;?php echo $comment['comment_id']; ?&gt;"</span></span>&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"cackle-comment-header-&lt;?php echo $comment['comment_id']; ?&gt;"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cackle</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">header</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cite</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cackle</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cite</span></span></span><span class="hljs-class">-&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment_id</span></span></span><span class="hljs-class">']; ?&gt;"&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author_name</span></span></span><span class="hljs-class">']) : ?&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cackle</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">-&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment_id</span></span></span><span class="hljs-class">']; ?&gt;" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author_www</span></span></span><span class="hljs-class">']; ?&gt;" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_blank</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rel</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nofollow</span></span></span><span class="hljs-class">"&gt;&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author_name</span></span></span><span class="hljs-class">']; ?&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">else</span></span></span><span class="hljs-class"> : ?&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cackle</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">-&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment_id</span></span></span><span class="hljs-class">']; ?&gt;"&gt;&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">anonym_name</span></span></span><span class="hljs-class">']; ?&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">endif</span></span></span><span class="hljs-class">; ?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cite</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cackle</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class">-&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment_id</span></span></span><span class="hljs-class">']; ?&gt;" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cackle</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cackle</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">-&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment_id</span></span></span><span class="hljs-class">']; ?&gt;" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cackle</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">"&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comment</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">']; ?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">li</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> }</span></span></code> </pre><br>  Run through the list of comments <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">list_comments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $obj = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get_local_comments(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $comment) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cackle_comment($comment); } }</code> </pre><br>  Display html comments with the widget <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cackle_display_comments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;div id=<span class="hljs-string"><span class="hljs-string">"mc-container"</span></span>&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"mc-content"</span></span>&gt; &lt;ul id=<span class="hljs-string"><span class="hljs-string">"cackle-comments"</span></span>&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;list_comments(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/ul&gt; &lt;/div&gt; &lt;/div&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mcSite = <span class="hljs-string"><span class="hljs-string">'&lt;?php echo $api_id?&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mcChannel = <span class="hljs-string"><span class="hljs-string">'&lt;?php echo $post-&gt;ID?&gt;'</span></span>; document.getElementById(<span class="hljs-string"><span class="hljs-string">'mc-container'</span></span>).innerHTML = <span class="hljs-string"><span class="hljs-string">''</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mc = document.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>); mc.type = <span class="hljs-string"><span class="hljs-string">'text/javascript'</span></span>; mc.async = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; mc.src = <span class="hljs-string"><span class="hljs-string">'http://cackle.me/mc.widget-min.js'</span></span>; (document.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'head'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] || document.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'body'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]).appendChild(mc); })(); &lt;/script&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> }</code> </pre><br>  As can be seen from js, we clear mc-container so that the list of comments generated by us does not appear on the page. <br>  As a result, only the Cackle widget with comments will be visible on the page, and in the html code there will be a list for indexing by search engines. </div><p>Source: <a href="https://habr.com/ru/post/154293/">https://habr.com/ru/post/154293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154283/index.html">Thermoelectric charging for gadgets and for cooking</a></li>
<li><a href="../154285/index.html">Music Scape by Brian Eno for iPad</a></li>
<li><a href="../154287/index.html">Runetology (168): Shahar Weiser, founder of GetTaxi</a></li>
<li><a href="../154289/index.html">Mail for the domain. Top 10</a></li>
<li><a href="../154291/index.html">Be kind to programmers</a></li>
<li><a href="../154295/index.html">About voting systems</a></li>
<li><a href="../154297/index.html">International IT HR conference "find the answer!" # 6</a></li>
<li><a href="../154301/index.html">Critical bug in CoreGraphics on iOS</a></li>
<li><a href="../154305/index.html">Required resources for game designers</a></li>
<li><a href="../154307/index.html">How to treat computer games</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>