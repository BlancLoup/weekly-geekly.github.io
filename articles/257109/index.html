<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Attackers use Linux / Mumblehard to compromise servers, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Linux / Mumblehard malware family is a special attacker‚Äôs tool that compromised servers running various Linux and BSD modifications. The main purp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Attackers use Linux / Mumblehard to compromise servers, part 1</h1><div class="post__text post__text-html js-mediator-article">  The <b>Linux / Mumblehard</b> malware family is a special attacker‚Äôs tool that compromised servers running various Linux and BSD modifications.  The main purpose of this malware is to provide full access to the compromised system for intruders (backdoor) and send spam.  After gaining such access, attackers can run other malicious programs on the remote system.  Mumblehard also includes modules for organizing proxies and spam. <br><br><img src="https://habrastorage.org/files/a9c/fb5/1c7/a9cfb51c7139425a99cb63f41a676212.jpeg"><br><br>  The components of this malware are Perl scripts that are encrypted and packaged inside an executable ELF file.  In some cases, these scripts may contain another ELF executable file. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  ESET analysts were able to perform a <a href="http://en.wikipedia.org/wiki/DNS_sinkhole">sinkhole</a> operation to obtain statistics on infected systems, which allowed us to calculate their number and notify their owners.  Our analysis led us to the following key findings: <br><br><ul><li>  The <b>Linux / Mumblehard</b> malware modules are Perl scripts, they are located in the Mumblehard executable ELF files, which are written using assembler. </li><li>  Using the sinkhole, it was possible to identify 8,867 unique IP addresses of the infected systems over a seven-month period. </li><li>  The largest number of such unique IP addresses per day was 3.292. </li><li>  The malware has been active since at least 2009. </li><li>  Web servers dominated all infected computers. </li><li>  There is a close relationship between Mumblehard and Yellsoft.  The latter is a company that distributes software for mass mailing e-mails. </li></ul><br>  <b>Introduction</b> <br><br>  Our analysts encountered <b>Linux / Mumblehard</b> when a system administrator of one of the companies contacted our specialists to get advice on their server, which was blacklisted by the provider for sending spam.  On this server, we recorded a suspicious process and dumped its memory.  The process was a running Perl interpreter.  This process executed a malicious script.  We also found a suspicious ELF file in the / tmp directory.  During the analysis it became clear that this file belongs to <b>Linux / Mumblehard</b> . <br><br>  The attention of our analysts was attracted by the fact that the Perl malicious scripts themselves were located inside the executable ELF file, which is a rather unusual case of their storage.  Our investigation revealed that the group of cybercriminals behind this malware had close ties with an IT company called Yellsoft.  The first sample of the Mumblehard component responsible for sending spam was <a href="https://www.virustotal.com/ru/file/a5915c3060f5891242514b7899975393ef3d3cb87b33b6a767cffce4feac215f/analysis/">uploaded</a> to the VirusTotal service back in 2009. At the same time, Yellsoft has been working since 2004. It is not clear to us whether this company had connections with attackers from 2004 to 2009 . <br><br><img src="https://habrastorage.org/files/408/57a/7c2/40857a7c27c244bba0f25ae10ddae2ab.png"><br>  Fig.  Yellsoft homepage, how it looked in 2004 <br><br>  Using our special server and the list of systems that have been infected, we have established two main vectors for the distribution of this malware.  One such vector was the use of exploits by attackers for popular content management systems for Joomla and Wordpress sites.  Another vector was the distribution by the attackers of pirated backdoored versions of the DirectMailer program for Linux &amp; BSD.  This program is sold by Yellsoft for $ 240.  Pirated copies of the program specialize in installing the Mumblehard backdoor.  The backdoor allows attackers to install other malicious programs on a compromised server. <br><br>  <b>Malware Analysis</b> <br><br>  We analyzed two different malware components that were used by a group of intruders.  The first is a backdoor that will request commands from the C &amp; C server manager.  Command data contains URLs.  They must be downloaded and executed on a compromised server.  The second component is a spam component, the so-called.  spammer daemon.  Both components are written in Perl and obfuscated using the same packer, which is written in assembler and located in the ELF file.  Below is a diagram showing the connections between the Mumblehard components and their control servers. <br><br><img src="https://habrastorage.org/files/8c6/5a7/4af/8c65a74af74d499cbbad17b2d1ac6b47.png"><br>  Fig.  The interaction between the components of Mumblehard and their control servers. <br><br>  One of the first interesting features that we noticed is the Perl script wrapper located inside the ELF file.  It is written in assembler and consists of two hundred instructions.  This code itself calls the Linux system services by using the int 80h instruction.  The software functions of the packer are also deprived of the usual prologue responsible for servicing the stack. <br><br>  Using the int 80h system call gives the packer code one significant advantage, depriving it of any external dependencies on the OS libraries.  In addition, the packer itself can work normally on both Linux and BSD.  The system type is determined at the beginning of the malware code by system call number 13 with an argument of 0. For Linux, this corresponds to the API call of the <i>time</i> function <i>(NULL)</i> , and on BSD the <i>fchdir (stdin)</i> call.  In the case of BSD, a function call with this argument will fail and the return value will be a negative number, and in the case of Linux, the return value of the corresponding call will be positive, and it corresponds to the number of seconds since January 1, 1970. <br><br><img src="https://habrastorage.org/files/833/4fa/6f6/8334fa6f64504fc3b2c5b85aa6f55608.png"><br>  Fig.  Entry point to the executable ELF file (beginning of the packer code).  The service call with ID 13 (SYS_TIME) is visible. <br><br>  Next, the malicious code will call the <i>fork ()</i> function and start the Perl interpreter by calling <i>execve ("/ usr / bin / perl", ...)</i> .  The body of the script itself will be sent to the interpreter process via the STDIN channel.  Using the <i>dup2</i> system call, the parent process will be able to transfer the decrypted script to the interpreter process via the duplicated file descriptor. <br><br>  The backdoor itself performs simple work, it requests commands from the C &amp; C server manager and reports the results of their execution to it.  The backdoor does not start in the system as a service (daemon); instead, it uses the crontab task scheduler, which ensures that it runs every 15 minutes. <br><br><img src="https://habrastorage.org/files/d8e/6fb/6f9/d8e6fb6f94ea4ee69bb5c458e60d76b0.png"><br><br>  It also disguises itself as an httpd service. <br><br><img src="https://habrastorage.org/files/69a/10f/de5/69a10fde5aed4fadb360b569bb4cd8b3.png"><br><br>  At each launch, the backdoor polls all the C &amp; C servers in the list to receive commands.  In fact, it supports only one command with the identifier 0x10, which instructs the backdoor to download from the URL of the specified file and its subsequent execution in the system.  As a rule, the list of C &amp; C servers consists of ten addresses.  The list we discovered was identical for all the Linux / Mumblehard samples we observed.  We witnessed the activity of only one C &amp; C server with the IP address 194.54.81.163.  One of the servers with the domain behance.net in 2005 belonged to Adobe. <br><br><ul><li>  184.106.208.157 </li><li>  194.54.81.163 </li><li>  advseedpromoan.com </li><li>  50.28.24.79 </li><li>  67.221.183.105 </li><li>  seoratingonlyup.net </li><li>  advertise.com </li><li>  195.242.70.4 </li><li>  pratioupstudios.org </li><li>  behance.net </li></ul><br>  When the server with the address 194.54.81.163 contains a command to send, it can respond only in a fixed period of time. <br><br>  The backdoor generates its HTTP GET request for each C &amp; C server from the list.  The server responds with a command that is masked in the Set-Cookie field of the HTTP header.  Such a technique can be justified, since analyzing such a network packet, its analysis will not arouse suspicion. <br><br><img src="https://habrastorage.org/files/366/009/2d7/3660092d720741c4b1a3c8c591dd5e08.png"><br>  Fig.  Sample C &amp; C Server Response. <br><br>  The cookie parameter called PHPSESSID is encoded in hexadecimal.  Strings within the commands themselves are also encrypted using a special algorithm.  This algorithm is identical to the one used in the Perl script wrapper.  It can be assumed that the same group or person was behind the development of both parts of the malware code. <br><br><img src="https://habrastorage.org/files/222/ff1/9f5/222ff19f52ce412cbe1320a616f1b6a6.png"><br>  Fig.  The function of decrypting the data of the command received from the C &amp; C server. <br><br><img src="https://habrastorage.org/files/fae/fdd/f7f/faefddf7fba44bdaac2a48eda573ba1d.png"><br>  Fig.  The same decoding function in Perl. <br><br>  Once the string has been decrypted, the following information will be extracted from the cookie. <br><br><img src="https://habrastorage.org/files/2a0/c1e/17b/2a0c1e17bd0d42a3808c6ae1f28ac98b.png"><br>  Tab.  Parameter list inside PHPSESSID cookie. <br><br><img src="https://habrastorage.org/files/7cd/b42/d66/7cdb42d665f740e485edabb60ae61ef2.png"><br>  Tab.  Example of parameter values ‚Äã‚Äãinside PHPSESSID. <br><br>  When requesting a command from a C &amp; C server, the backdoor uses a hardcoded user agent string.  The line is listed below and corresponds to the one used by Mozilla Firefox 7.0.1 on Windows 7. <br><br><img src="https://habrastorage.org/files/a0f/b43/b84/a0fb43b84831470da767f302204ae824.png"><br><br>  After the file download to the URL and its execution are completed, the backdoor reports the status of the operation to each of the C &amp; C servers from which the command was received.  This information is masked inside the user agent string and has the following form. <br><br><img src="https://habrastorage.org/files/36c/a0d/126/36ca0d1267b842499a2c40abe9848e03.png"><br><br>  The following figure shows an example of the user agent string that the backdoor sends when a successful (HTTP 200 OK) operation (download-and-execute) with code 0x18 (24) is executed to execute a file of 56,013 bytes. <br><br><img src="https://habrastorage.org/files/68c/290/a51/68c290a51b44489792e8aa4fcf0ca1e5.png"></div><p>Source: <a href="https://habr.com/ru/post/257109/">https://habr.com/ru/post/257109/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257095/index.html">Happy birthday google</a></li>
<li><a href="../257097/index.html">7 things that every designer should know about the design of accessible sites</a></li>
<li><a href="../257101/index.html">Cyclomatic complexity: CSS logic</a></li>
<li><a href="../257105/index.html">Deploying Oracle Database 12c DBMS on Windows Server to InfoboxCloud Cloud</a></li>
<li><a href="../257107/index.html">Software renderer - 2: rasterization and attribute interpolation</a></li>
<li><a href="../257111/index.html">Effective work with text or how I reinvent the wheel.</a></li>
<li><a href="../257113/index.html">Writing a system of invitations (invitations) for your Meteor application</a></li>
<li><a href="../257115/index.html">Simple control of arduino via the Internet</a></li>
<li><a href="../257117/index.html">Lab penetration testing "Test lab v.7" is open</a></li>
<li><a href="../257119/index.html">Lectures of the Technosphere. Semester 2 Modern methods and tools for building information retrieval systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>