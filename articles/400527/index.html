<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recampling II. Comparison of the operation of digital and analog filters of high order in the sound path and answers to questions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Attention - this publication is a clarification of the first part of the article and the answer to the questions from its comments. To understand what...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recampling II. Comparison of the operation of digital and analog filters of high order in the sound path and answers to questions</h1><div class="post__text post__text-html js-mediator-article">  <i>Attention - this publication is a <b>clarification of the</b> <a href="https://geektimes.ru/post/284272/">first part of the article</a> and the answer to the questions from its comments.</i>  <i>To understand what it is about, you need to familiarize yourself with the <a href="https://geektimes.ru/post/284272/">previous one</a> <s>if you have not done this yet</s> .</i> <br><img src="https://habrastorage.org/files/bc8/0db/bea/bc80dbbeab3f498ebce0dfaac77cf367.png"><br>  Among the numerous comments to my last article were two very characteristic questions - from a group of people whom I can conditionally refer to the category of ‚Äúpractitioners‚Äù, and a person who, perhaps unwillingly, voiced a position close to many audiophiles. <br>  It became clear to me that not everyone understands the explanations based on the theory of the spectral decomposition of the signal and further manipulation of the harmonics.  Below, I made an attempt to highlight some of the questions from the previous article even more clearly. <br><br><h4>  So, under the cut, consider two topics: </h4><br>  <a href="https://habr.com/ru/post/400527/">Why digital filters in sound processing paths are not always evil</a> <br>  <a href="https://habr.com/ru/post/400527/">Why high-order analog filters are difficult to implement in serial devices</a> <br><br>  I will try to reveal both these noteworthy topics in as accessible a language as possible. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><a name="Example1"></a><br><h3>  <font color="#66a3be">Why digital filters in sound processing paths are not always evil</font> </h3><br><br>  Question one from <a href="https://geektimes.ru/users/freemind2000/" class="user_link">FreeMind2000</a> : <br><br><blockquote>  Enlighten not a specialist?  ;) <br><br>  The initial chain is: <br>  1) Live sound -&gt; ADC (16bit, 44.1 KHz) -&gt; CD <br>  2) CD -&gt; 16bit -&gt; Microcontroller -&gt; DAC (16bit, 44.1 KHz) -&gt; recovered sound <br><br>  After upgrade: <br>  2) CD -&gt; 16bit -&gt; Microcontroller + (A certain filter converts 16bit to 18, 44.1 KHz to 44.1 * 4) -&gt; DAC (18bit, 44.1 * 4 KHz) -&gt; restored sound <br><br>  Those.  in the upgrade we just: <br>  1. Put more expensive DAC (with increased sampling rate and bit depth) <br>  2. By inventing (interpolating) the missing samples on the CD time scale, the number of reproducible samples was increased. <br>  Right? <br><br>  Then, attention, question: <br>  1. Did we really improve the sound quality by adding samples that in the original (live sound) could be different from those that we invented (interpolated)?  After all, what we recorded at a frequency of 44.1 KHz was actually recorded by the microphone, and we did not know what was between the recorded samples. <br><br>  2. How far is our fantasy (I apologize, interpolation :) can get us?  Those.  theoretically, we can interpolate both 8bit sound and 4x ... <br><br>  3. And what kind of quality improvement are we talking about? <br>  For a person, the average frequency threshold of perceived sound is 20 kHz, we reproduce at a frequency of 44.1 kHz - does it make any sense to increase further? .. Increasing the fidelity of reproduction by 2 bits is the only thing that is relevant to real quality improvement, well, and does anyone know How many discharges can the human ear distinguish?  ;) </blockquote><br><br>  Yes, the Nyquist theorem is correct, but if even at two points it is possible to restore the frequency of a periodic signal, which is not the <s>least important</s> , then this does not mean that the DAC can do this successfully, especially without the use of filters!  This is all the more so for a complex signal, which is a superposition of a large number of harmonics, sometimes abruptly appearing and disappearing or changing tone. <br>  In order to gain insight into the essence of the problem, it is necessary to understand the following - having performed the act of digitizing the operation, we thereby irrevocably distorted the signal.  Even if you use the perfect microphone, amplifier and analog-to-digital converter. <br><br>  Let us, for clarity, move from theory to practice and depict the shape of the original signal in the background of the signal coming from the ideal DAC. <br><br><img src="https://habrastorage.org/files/97f/74a/015/97f74a0154104869b9c378086675d601.JPG"><br><br>  Let me remind you that the DAC or <s>in Russian DAC</s> at regular intervals extracts the digitized value and fixes it at its output.  As a result, we get a stepped signal.  In our figure, the minimum vertical and horizontal pitch is one square.  For the width of the steps corresponds to the frequency of digitization, and the vertical resolution is determined by the width of the ADC.  How the quality of digitized signals depends on it can be seen in the example of digitizing the second bit.  The real value lies almost in the middle between two valid integer values, which can be assigned to the ADC sample.  It chose the bottom one, and we got a very big mistake.  I hope everyone now understands why even in an ideal ADC, the low order cannot be considered meaningful. <br><br><img src="https://habrastorage.org/files/44f/688/47d/44f68847d01345499bbc0e35d9140905.jpg"><br><br>  Let's see what makes our chip from SONY.  She increased the sampling rate 4 times.  Moreover, it also added permissions vertically due to the fact that it increased the signal width from 16 to 18 bits.  Further, using the filter, the signal is approximated and three intermediate points are inserted, and their installation accuracy is higher both horizontally and vertically 4 times than before the transformations made.  Accurate placement of these points is the filter.  The higher his order, the more qualitatively he produces the approximation. <br>  However, after performing these operations, we still have a stepped structure, which is not depicted in the figure - instead of them I have depicted bullet points in the first three samples.  And here the simplest low-frequency filter of the second and third order comes in, which smoothes these steps.  The result is shown below: <br><br><img src="https://habrastorage.org/files/e72/3c5/00d/e723c500db4a4c12a27bb97e9729284a.jpg"><br><br>  Here the pencil curve is the original signal. <br>  The red curve is the signal at the output of a 16 bit DAC. <br>  The green part of the curve is what we got after the resampling operation and the subsequent application of the simplest filter. <br>  I hope that <a href="https://geektimes.ru/users/freemind2000/" class="user_link">FreeMind2000</a> and its supporters would agree that ‚Äúpure, undistorted, step sound from the DAC output‚Äù looks less like the original than that distorted by digital perversions? <br>  I note that the first left oscillation has the main harmonic somewhere in the region of 44/7 = 6 kilohertz, while it looks very distorted when digitized at a frequency of 44 KHz.  Can you imagine how much a signal with a frequency of 17 kilohertz will resemble the original? <br>  It is important to note here that, if desired, digital filters may not touch the reference points obtained from a 16-bit DAC - just place auxiliary ones between them, smoothing the curve at their discretion. <br>  For a number of reasons, this cannot be done using high-order analog filters instead of numbers.  Here, by the way, it's time to get to the question <s>or rather the statement</s> made by <a href="https://geektimes.ru/users/antonsor/" class="user_link">AntonSor</a> and ardently supported by <a href="https://geektimes.ru/users/dernuss/" class="user_link">dernuss</a> <br><br><a name="Example2"></a><br><h3>  <font color="#66a3be">Why high-order analog filters are difficult to implement in serial devices</font> </h3><br><br>  AntonSor comment <a href="https://geektimes.ru/users/antonsor/" class="user_link">text</a> : <br><blockquote>  In order to cut off everything that lies beyond the limits of the sound range (20 kHz) and get attenuation at 40 dB at 44 kHz, and with a smooth phase response, a 7-order filter is required, which is a Butterworth filter; these are three operational amplifiers and 10 5% resistors and capacitors per channel.  Yes, cumbersome, but not impossible.  Two quad type operational amplifier TL074.  In the amateur receiver direct conversion is more (in the phase shifter). </blockquote><br><br>  In order not to deal with all the holidays in an educational program, I only briefly mention that high-quality high-order filters cannot be built on general-purpose operational amplifiers, which include TI TL074 from TI. <br>  It is quite important that the analog filters of low frequencies of high orders generate serious phase distortions, especially in the region of the cutoff frequency.  I will also not prove this well-known truth with a succession of long formulas to our esteemed comrades, I‚Äôll just give you a picture from <a href="https://geektimes.ru/post/283338/">one of my previous articles</a> that shows how hard phase distortions deal with the waveform. <br><br><img src="https://habrastorage.org/files/a57/dac/e2d/a57dace2d3d14cd5b47c5533646381d3.png"><br><br>  And in conclusion, <s>at the request of the workers</s> , I‚Äôll dwell on the reason why, without precisely selected ratings of parts, high order filters will not give beautiful ideal calculated characteristics, as in the below normalized frequency dependence of signal attenuation on the Butterfort filter order in logarithmic coordinates. <br><br><img src="https://habrastorage.org/files/e63/196/1c9/e631961c95f54c6f898b651930d8717b.jpg"><br><br>  In order to build a filter that approaches this parameter to the digital one described in the previous article, it is necessary to use the eighth or tenth order. <br><br>  The following shows the transfer function of the ideal low-pass filter and Butterfort filters of various orders. <br><br><img src="https://habrastorage.org/files/635/fe5/35b/635fe535ba4f4c009cd38c1d8528556c.jpg"><br><br>  How are such filters usually built?  Very simply - a second-order low-pass filter is constructed, for example, according to the scheme given below ... <br><br><img src="https://habrastorage.org/files/fdf/1eb/5e5/fdf1eb5e5d5e4292b1f4a880c13ece64.png"><br><br>  Ok, let's look at the graph that shows how the parameters of the second-order Butterworth filter change. <s>Note that the horizontal scale</s> shows the <s>linear scale</s> of the variation in the ratings of the components in the feedback circuit. <br><br><img src="https://habrastorage.org/files/e62/124/7f5/e621247f59f349ee9f684aca78b43090.PNG"><br><br>  Now imagine a superposition of the transfer characteristics of several such links with different cutoff frequencies due to the spread of the components. <br><br><img src="https://habrastorage.org/files/7bb/35c/b23/7bb35cb23f07443f830c9363b1158f3f.jpg"><br><br>  It is not difficult to guess that we will not get as a result of the effect of increasing the filter slope depending on the order.  In addition, we will generate extra humps on the characteristic that will cause intermodulation distortion. <br>  In fact, the situation is even worse because the spread affects not only the cutoff frequency, but also the other parameters of each of the links.  The resulting filtered sound <s>performed by cancer, swan and pike</s> may be suitable for the dynamics of the output of the regenerative receiver, but trying to use it in a high-quality DAC will cause nothing but unhealthy laughter from potential buyers. <br><br><h3>  <font color="#66a3be">Instead of an afterword</font> </h3><br>  Instead of an afterword I publish a couple of pictures from the user <a href="https://geektimes.ru/users/zerg59/" class="user_link">zerg59</a> , who was not too lazy to model <blockquote>  Labview Audio Path with Signal Generator, ADC, DAC, and Resampler </blockquote><br><img src="https://habrastorage.org/files/656/014/9d6/6560149d65804c9bbb65d2567a8a0924.jpg"><br><br>  The signal at the output of the DAC with a frequency of 0.45 of the sampling rate.  Well viewed "zero beats" <br><img src="https://habrastorage.org/files/b19/86c/b8a/b1986cb8a77e40c2b1b59cfad0d847a1.jpg"><br><br>  Same signal, last resampling and tenth order digital filter <br><br>  PS <i>I could not refrain from using a fragment of the picture from the excellent commentary on the first part from the user <a href="https://geektimes.ru/users/refridgerator/" class="user_link">Refridgerator</a> in the <a href="https://geektimes.ru/users/refridgerator/" class="user_link">header.</a></i> </div><p>Source: <a href="https://habr.com/ru/post/400527/">https://habr.com/ru/post/400527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../400515/index.html">Blockchenizer: advantages of the blockchain for those who do not like cryptocurrency</a></li>
<li><a href="../400519/index.html">Modular 3D-printer "3D-Start" as a source of interest for 3D-cats</a></li>
<li><a href="../400521/index.html">Apple fixed a bug and accuses Consumer Reports of incorrect testing methodology.</a></li>
<li><a href="../400523/index.html">Why do physicists still use Fortran</a></li>
<li><a href="../400525/index.html">Developing a mnemonic number memorization system</a></li>
<li><a href="../400529/index.html">Vision correction equipment</a></li>
<li><a href="../400531/index.html">The State Duma Committee approved a bill on the regulation of audiovisual services.</a></li>
<li><a href="../400533/index.html">The main paradox of consciousness. Why does not it make sense to copy the brain or personality</a></li>
<li><a href="../400535/index.html">Google closed the project to create a global Internet coverage using drones</a></li>
<li><a href="../400537/index.html">A lawyer who has become a DuPont nightmare</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>