<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We turn the Windows Store application into a universal</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will talk about the possibility of expanding the Windows Store application to universal. As a result of the work, you will receive not only t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We turn the Windows Store application into a universal</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/772/3f3/5fc/7723f35fc60939b8763679a97ca6b29c.png"><br>  Today we will talk about the possibility of expanding the Windows Store application to universal.  As a result of the work, you will receive not only the Windows Store app, but also the Windows Phone 8.1 app, and with it, a <b>new audience of users</b> who can use your app <b>from various devices, paying for it once</b> and saving data and <b>status between devices</b> . <br><br>  This article describes the process of extending the Windows Store application to Windows Phone, typical problems and their solutions. <br><a name="habracut"></a><br><h5>  Introduction </h5><br>  The universal application from Microsoft is a technology for developing applications running on Windows 8.1, <b>regardless of the form factor of the device</b> : phone, tablet or PC. <br><br>  To create universal applications for Windows 8.1 and Windows Phone 8.1, you need <a href="http://windows.microsoft.com/ru-ru/windows/home">Windows 8.1</a> and <a href="http://www.visualstudio.com/ru-ru/downloads/download-visual-studio-vs">Visual Studio 2013</a> Update 2. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Starting the development of the project of the new type ‚ÄúUniversal apps‚Äù, let us pay attention to the templates with interface layouts, which, when selected, obtain the automatically generated solution from the following projects: <br><ul><li>  Windows 8.1 project; </li><li>  Windows Phone 8.1 project; </li><li>  The project containing the common code (Shared). </li></ul><br>  The overall source code <b>includes interface elements and API calls</b> , which significantly reduces the amount of source code for each of the applications.  Note that the appearance of the application for each of the platforms will be different, due to the behavior of some interface elements on different devices. <br><br>  Universal applications are supported for C ++, C # and JavaScript. <br><br>  Read more about the new features of universal applications previously written in this <a href="http://habrahabr.ru/company/microsoft/blog/218441/">article</a> . <br><br><h5>  An example of transition from a Windows Store application to a universal one. </h5><br>  Make the transition from a Windows 8.1 application to a universal one by adding a Windows Phone 8.1 project to the solution: <br><ol><li>  Under Windows Phone 8.1, an application explicitly means only WinRT XAML applications, excluding Silverlight 8.1.  Silverlight applications do not have extensibility to universal ones. </li><li>  Open the application project for Windows 8.1: <br><img src="https://habrastorage.org/getpro/habr/post_images/4fb/414/43c/4fb41443c0fe7af06850fa0765098db4.png"><br><br>  The main task of the demo application is to display images from a given directory on the device: <br><img src="https://habrastorage.org/getpro/habr/post_images/7a2/286/e2e/7a2286e2ee88e87bd72cc028a7506a5c.png"><br></li><li>  Add a Windows Phone 8.1 application to a Windows 8.1 application: <br><img src="https://habrastorage.org/getpro/habr/post_images/80a/f85/51e/80af8551e80a10a7587a0cf468a05966.png"></li></ol><br>  We get in the solution browser additionally a project for Windows Phone 8.1 and a project with common code: <br><img src="https://habrastorage.org/getpro/habr/post_images/62d/7ad/055/62d7ad055de77ee1d8449e1d23bd8b3b.png"><br><br>  Initially, the project with the common code is empty, so from the application for Windows 8.1 we copy the following elements: <br><ul><li>  Directories: ommon, Models, ViewModel <br><img src="https://habrastorage.org/getpro/habr/post_images/e07/ea1/cd6/e07ea1cd657c3ff8a00489607925b375.png"></li><li>  And files: ImageViewPage.xaml, MainPage.xaml <br><img src="https://habrastorage.org/getpro/habr/post_images/ba2/9f5/ded/ba29f5dede9fdb275b5a0c2d41a6945e.png"><br></li></ul><br>  Verify that all elements are copied correctly: <br><img src="https://habrastorage.org/getpro/habr/post_images/a7c/7ea/b18/a7c7eab187e11ce783faad5a3d8d170f.png"><br><br>  Remove from the project Windows 8.1, the elements that are duplicated in the overall project: <br><img src="https://habrastorage.org/getpro/habr/post_images/48b/725/8d6/48b7258d63414f1a4d692c961decccc0.png"><br><br>  Directories and files: <br><img src="https://habrastorage.org/getpro/habr/post_images/359/f66/c27/359f66c27ebb17f726bc9cf948bcf8de.png"><br><br>  From the Windows Phone 8.1 project, also remove the duplicate elements: <br><img src="https://habrastorage.org/getpro/habr/post_images/785/41f/968/78541f968f4a3ed3ab9f0645e580b68d.png"><br><br>  This needs to be done, because the main function of the project with the common code is to distribute the code located in it to both the Windows 8.1 and Windows Phone 8.1 projects.  Therefore, duplicate files are simply not needed in both projects. <br><br><h5>  Test how the application works under Windows Phone 8.1 </h5><br>  Install the Windows Phone 8.1 project as the starting one: <br><img src="https://habrastorage.org/getpro/habr/post_images/d96/fb6/d90/d96fb6d901a9948c05cc8a318d09d21b.png"><br><br>  Run in the emulator: <br><img src="https://habrastorage.org/getpro/habr/post_images/c55/6b8/744/c556b874473173c07b53ff0c9e680d6a.png"><br><br>  The application did not start correctly and we received the following errors: <br><img src="https://habrastorage.org/getpro/habr/post_images/13b/675/e33/13b675e33ddafb23f9d7ef56ea2cb1b3.png"><br><br>  Click "Break" and try to get rid of the problem. <br>  Open the MainPage.xaml file from the shared Shared project: <br><img src="https://habrastorage.org/getpro/habr/post_images/160/0e7/737/1600e7737cdef78638d8ea18a85b24bd.png"><br><br>  Note that for any XAML file from a common project, you can select the edit mode, where the active code for Windows 8.1 or Windows Phone 8.1 will be highlighted separately: <br><img src="https://habrastorage.org/getpro/habr/post_images/471/6ef/058/4716ef0585fcfbbd03b612e2e3939bdc.png"><br><br>  Compare two editing modes: <br><br>  <b>Windows 8.1</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/984/ce1/376/984ce1376756bc3e50b491709b46a48e.png"><br><br>  <b>Windows Phone 8.1</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/41d/aa0/20d/41daa020d9b71e1f58223054a2ccf5ed.png"><br><br>  We observe the DataContext element, not recognized by the compiler, which tells us that we forgot to add the same connections to the Windows Phone project in the App.xaml project as in the Windows 8.1 file in the App.xaml: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Application.Resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data:LibraryLoaderViewModel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LibraryImageSource"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Application.Resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now the application has started, but does not display the data: <br><img src="https://habrastorage.org/getpro/habr/post_images/7b6/d7a/69c/7b6d7a69c5b905b24d0449e2271b945d.png"><br><br>  The reason is that we have specified as the resource directory an image library that is used on PC devices. <br><br>  But for mobile devices, the resource store should be changed to the image store in the device‚Äôs photo album. <br><br>  Open the LibraryLoaderViewModel.xaml file: <br><img src="https://habrastorage.org/getpro/habr/post_images/b8c/390/f57/b8c390f57ab7466b7bb8e3b95cbb9f58.png"><br><br>  And change the function of the private async Task LoadImages () as follows: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadImages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> WINDOWS_APP var folder = Windows.Storage.KnownFolders.PicturesLibrary; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> WINDOWS_PHONE_APP var folder = Windows.Storage.KnownFolders.CameraRoll; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> var imageFiles = await folder.GetFilesAsync(); foreach (var imageFile in imageFiles) { var image = new ImageItem(imageFile, ImageLocation.CameraRoll); _libraryImages.Add(image); } await Window.Current.Dispatcher.RunAsync(CoreDispatcherPriority.Normal, () =&gt; { OnPropertyChanged("LibraryImages"); }); }</span></span></code> </pre><br>  We explain to the application which image repository should be accessed depending on the device.  For this we use the construction #if.  Thereby separating actions that are different for Windows 8.1 and Windows Phone 8.1 platforms: <br><br>  Windows = WINDOWS_APP <br>  Windows Phone = WINDOWS_PHONE_APP <br><br>  Configure access to the repository using the Capabilities property in the Package.appxmanifest for Windows Phone 8.1 project: <br><img src="https://habrastorage.org/getpro/habr/post_images/b78/2cb/212/b782cb212e6aabb94c969161856a6ee3.png"><br><br>  Everything works great.  You can check the result by connecting your own device and launching the application from it. <br><br>  Note that the mobile application designer does not correctly display the markup: <br><img src="https://habrastorage.org/getpro/habr/post_images/7e7/9ce/8d2/7e79ce8d2a954132af6d4ee0e5165176.png"><br><br>  We have the opportunity to check how the application looks on the screens of various sizes using the Device toolbar: <br><img src="https://habrastorage.org/getpro/habr/post_images/d4f/ed4/e7d/d4fed4e7d64f2288c553b4e3308ed128.png"><br><br>  Here we go through the screen size options: <br><img src="https://habrastorage.org/getpro/habr/post_images/d18/4b4/3ee/d184b43eea8c27405640a8b11fb38e6d.png"><br><br>  Adjust the correct display for each if necessary, for example, in the MainPage.xaml file, change the specified property Height = ‚Äú125‚Äù to Auto in the case of the size of 480x800: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{ThemeResource ApplicationPageBackgroundThemeBrush}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Auto*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"643*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Now the application is ready for use on any Windows 8.1 and Windows Phone 8.1 devices. <br><br><h5>  Other Distributable Code Support Scenarios </h5><br>  There are several options for storing and using common code for cross-platform Windows 8.1 and Windows Phone 8.1 applications: <br><ul><li>  The newest and easiest way is a <b>project with shared Shared code</b> inside the Universal app solution.  This approach is the easiest and supports any kind of distributed data: code, XAML files, images, XML / JSON, RESW.  Here the Visual State Manager tool already familiar to us is implemented, which allows you to see common and different code for platforms. </li><li>  <b>Portable Class Library</b> are libraries and WinRT components; </li><li>  One of the interesting features of the Portable Class Library is the ability to write a library in any of the languages, for example, C ++ or JavaScript, and use it in any application.  For example, you want to create a reusable library for different applications or in the case of cross-platform development for Windows, iOS and Android. </li><li>  <b>Adding links to files</b> with common code in the project.  For example, when you need to make a Windows Store application or a Windows Phone 8.1 (XAML) application from Silverlight. </li></ul><br><h5>  Conclusion </h5><br>  The process of expanding the Windows Store application to universal turned out to be simple, since the API for the phone and for the PC now <b>coincide by 90%</b> . <br><br>  When developing and porting, you should pay attention to <b>some differences between the platforms</b> , as was the case with the image repository, and <b>take into account various form factors and screen resolutions</b> for various devices. <br><br><h5>  useful links </h5><br>  <a href="http://habrahabr.ru/company/microsoft/blog/229727/">New Windows Phone 8.1.</a>  <a href="http://habrahabr.ru/company/microsoft/blog/229727/">What should an application developer do?</a> <br>  <a href="http://habrahabr.ru/company/microsoft/blog/230015/">Updating Windows Phone Silverlight 8.0 application to Windows Phone Silverlight 8.1</a> <br>  <a href="http://habrahabr.ru/company/microsoft/blog/229931/">Update Windows Phone 8.0 application to Windows Phone 8.1 (XAML)</a> <br>  <a href="http://www.microsoftvirtualacademy.com/">Microsoft Virtual Academy (MVA) Training Courses</a> <br>  <a href="http://aka.ms/getvsrus">Download free or trial Visual Studio 2013</a> <br>  <a href="http://aka.ms/wpstartrus">Become a Windows Phone Application Developer</a> <br>  <a href="http://1drv.ms/1nc66em">Download sample application from this article.</a> <br>  <a href="http://code.msdn.microsoft.com/windowsapps/Universal-Windows-app-cb3248c3">Download generic application code samples (c #, c ++, javascript)</a> </div><p>Source: <a href="https://habr.com/ru/post/230303/">https://habr.com/ru/post/230303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230291/index.html">Testing the layout of the news site with responsive design</a></li>
<li><a href="../230293/index.html">The dark side of Google Play</a></li>
<li><a href="../230295/index.html">The next generation Raspberry Pi will be released no earlier than 2017</a></li>
<li><a href="../230299/index.html">Self-made autonomous flying machine from Android smartphone</a></li>
<li><a href="../230301/index.html">Twoodo Experience: How to increase user activation from 2% to 30% in 10 steps</a></li>
<li><a href="../230305/index.html">Bracelet Phyode W / Me. Personal life analyzer</a></li>
<li><a href="../230307/index.html">The logical conclusion of the history of Nokia X</a></li>
<li><a href="../230309/index.html">About overconsumption in copyright</a></li>
<li><a href="../230311/index.html">7 reasons for the failure of your Internet project</a></li>
<li><a href="../230313/index.html">Shop-Script 5 Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>