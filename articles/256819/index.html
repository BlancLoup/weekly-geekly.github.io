<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interesting notes on C # and CLR</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Studying the C # programming language, I came across features of both the language and its execution environment, * some of which, I may say, are ‚Äúwid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interesting notes on C # and CLR</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/54a/658/21e/54a65821eb79429db9809318771dc029.png"><br><br>  Studying the C # programming language, I came across features of both the language and its execution environment, * some of which, I may say, are ‚Äúwidely known in narrow circles‚Äù.  Collecting those day after day in my piggy bank, that would ever repeat, which I honestly have never done before, I got the idea to share them. <br><br>  These notes will not make your code more beautiful, faster and more reliable, for this there is Steve McConnell.  But they will definitely contribute to your way of thinking and understanding what is happening. <br><a name="habracut"></a><br>  Some of the following will seem too simple, the other, on the contrary, difficult and unnecessary, but where without it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, we begin: <br><br><h4>  1) The location of objects and instances in dynamic memory </h4><br>  Objects contain static fields and all methods.  Instances contain only non-static fields.  This means that the methods are not duplicated in each instance, and the Flyweight pattern is used here. <br><br><h4>  2) Passing parameters to methods </h4><br>  The structure passes its copy to the method, the Class passes a copy of its reference.  But when we use the keyword REF, the structure passes a pointer to itself, and the class passes its original link. <br><pre><code class="cs hljs"> REF   . <span class="hljs-number"><span class="hljs-number">1</span></span>)   ,     . <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args </span></span></span><span class="hljs-function">)</span></span> { StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.Append(<span class="hljs-string"><span class="hljs-string">"Hello "</span></span>); AppendHello(sb); Console.WriteLine(sb.ToString()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppendHello</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">StringBuilder sb</span></span></span><span class="hljs-function">)</span></span> { sb.Append(<span class="hljs-string"><span class="hljs-string">" World!"</span></span>); sb = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-number"><span class="hljs-number">2</span></span>)   System.NullReferenceException          <span class="hljs-literal"><span class="hljs-literal">null</span></span>. <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args </span></span></span><span class="hljs-function">)</span></span> { StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.Append(<span class="hljs-string"><span class="hljs-string">"Hello "</span></span>); AppendHello(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> sb); Console.WriteLine(sb.ToString()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppendHello</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> StringBuilder sb</span></span></span><span class="hljs-function">)</span></span> { sb.Append(<span class="hljs-string"><span class="hljs-string">" World!"</span></span>); sb = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><br><h4>  3) Prepare code before execution </h4><br>  The CLR has a CER block that says JIT - ‚Äúprepare the code before execution, so that when it becomes necessary, everything will be at hand.‚Äù  To do this, we connect the namespaces System.Runtime.CompilerServices and RuntimeHelpers.PrepareConstrainedRegions. <br><br><h4>  4) Regular expressions </h4><br>  A regex can be created with the Compiled option ‚Äî this is the generation of an expression in the IL code.  It is much faster than usual, but the first launch will be slow. <br><br><h4>  5) Arrays </h4><br>  One-dimensional arrays in IL are represented by a vector, they are faster than multidimensional ones.  Arrays of one-dimensional arrays use vectors. <br><br><h4>  6) Collections </h4><br>  It is better to inherit custom collections from ICollection, the IEnumerable implementation is free.  But there is no index (very individual). <br><br><h4>  7) Extending methods </h4><br>  If the name of the extension method conflicts with the method name of the type, then the full name of the extension method can be used, and the type must be passed as an argument. <br><br><pre> <code class="cs hljs">StaticClass.ExtesionMethod( type );</code> </pre><br><h4>  8) LINQ </h4><br>  LINQ lazy loading (‚Äúlazy‚Äù loading) - select, where, take, skip etc. <br>  LINQ eager loading (queries are executed immediately) - count, average, min, max, ToList etc.  (But if the collection is infinite, then the request will never end.) <br><br><h4>  9) Sync block </h4><br>  Structural types and primitive (byte, int, long ...) do not have a synchronization block, which is present for objects in the managed heap along with the link.  Therefore, the Monitor. () Or Lock () construction will not work. <br><br><h4>  10) Interfaces </h4><br>  If in C #, the name of the interface in which this method is defined (IDisposable.Dispose) is specified before the method name, then you create an explicit implementation of the interface method (Explicit Interface Method Implementation, EIMI).  When explicitly implementing an interface method in C #, you cannot specify an access level (open or closed).  However, when the compiler creates metadata for a method, it assigns it a private access level (private), which prohibits any code from using an instance of the class by simply calling the interface method.  The only way to call the interface method is to access it via a variable of this interface type. <br><br>  You cannot do without EIMI (for example, when implementing two interface methods with the same names and signatures). <br><br><h4>  11) Not in C #, but IL supported </h4><br>  Static fields in interfaces, methods that differ only in the return value, and more. <br><br><h4>  12) Serialization </h4><br>  When serializing an object graph, some types may turn out to be serializable, and some may not.  For performance reasons, the formatting module does not check the possibility of this operation for all objects before serialization.  This means that a situation may arise when some objects will be serialized into the stream before the occurrence of the SerializationException exception.  As a result, corrupted data appears in the I / O stream.  This can be avoided, for example, by serializing objects first in the MemoryStream. <br><br>  In C #, within the types marked with the [Serializable] attribute, it is not necessary to define automatically implemented properties.  The fact is that the field names generated by the compiler may change after each subsequent compilation, which will make it impossible to deserialize type instances. <br><br><h4>  13) Constants </h4><br>  Constants are placed in the assembly metadata, so if there have been changes, you need to recompile all the assemblies that use it.  Since  DLL with a constant may not even load. <br>  It is better to use static readonly specifying values ‚Äã‚Äãin the constructor, it is constantly loaded in assemblies using it, and returns the current value. <br><br><h4>  14) Delegates </h4><br>  GetInvocationList - returns a chain of delegates, you can call any, catch exceptions, get all returned values, and not just the last. <br><br><h4>  15) String Comparison </h4><br>  In Microsoft Windows, uppercase string comparison is optimized.  * StringComparison.OrdinalIgnoreCase, in fact, translates Char to upper case.  ToUpperInvariant.  Use string.compare ().  Windows uses UTF-16 encoding by default. <br><br><h4>  16) Optimization for multiple rows </h4><br>  If in an application strings are often compared using a case-insensitive comparison method, or if a set of identical string objects is expected to appear in an application, then CLR-supported string interning should be used to improve performance. <br><br>  During initialization, the CLR creates an internal hash table, in which the keys are strings, and the values ‚Äã‚Äãare references to string objects in the managed heap. <br><br><h4>  17) Safe lines </h4><br>  When creating a SecureString object, its code allocates a block of unmanaged memory that contains an array of characters.  The garbage collector knows nothing about this unmanaged memory.  You need to clear this memory manually. <br><br><h4>  18) Security </h4><br>  Managed assemblies always use DEP and ASLR. <br><br><h4>  19) Designing methods </h4><br>  When declaring the type of method parameters, one should, if possible, specify ‚Äúminimal‚Äù types, preferring interfaces to base classes.  For example, when writing a method that works with a set of elements, it is best to declare a method parameter using the IEnumerable interface. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ManipulateItems&lt;T&gt;(IEnumerable&lt;T&gt; collection) { ... }</code> </pre><br>  At the same time, declaring the type of the object returned by the method, it is advisable to choose the strongest of the available options (trying not to be limited to a specific type).  For example, it is better to declare a method that returns a FileStream object, rather than a Stream. <br><br><h4>  20) Once again about car ownership </h4><br>  It is better not to use automatically implemented AIP properties (author's opinion, guess what). <br>  a) The default value can be set only in the constructor.  (Changed to Roslyn C # 6); <br>  b) The problem with serialization (clause 12); <br>  c) You can not put a breakpoint. <br><br><h4>  21) Configuration File </h4><br>  a) An external XML configuration file can be mapped to any .NET binary code.  This file is located in the same directory and has the same name with the word .CONFIG added at the end; <br>  b) If you provide a solution in binary form only, documenting comments can be compiled into an XML file when compiled, so in this situation you can provide users with an excellent set of hints.  To do this, you only need to place the resulting XML file in the same directory as the binary file, and Visual Studio .NET will automatically display comments in IntelliSense hints. <br><br><h4>  22) Exceptions </h4><br>  The CLR clears the starting point of the exception: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; }</code> </pre><br>  The CLR does not change the starting point of the exception: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; }</code> </pre><br>  You can create the FirstChanceException event of the AppDomain class and get exception information before the CLR starts looking for their handlers. <br><br>  Exceptions are slow;  transition to kernel mode. <br><br><h4>  23) IS and AS </h4><br>  IS - In this code, the CLR checks the object twice: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Person ) { Person p = (Person) obj; }</code> </pre><br>  AS - In this case, the CLR only checks the compatibility of obj with the Person type once: <br><br><pre> <code class="cs hljs">Person p1 = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Person; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( p1 != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) { ... }</code> </pre><br><h4>  24) Check whether there is enough memory before executing </h4><br>  Creating an instance of the MemoryFailPoint class checks whether there is enough memory before the start of an action or throws an exception.  However, keep in mind that physically the memory has not yet been allocated, and this class cannot guarantee that the algorithm will receive the necessary memory.  But using it will definitely help make the application more reliable. <br><br><h4>  25) Something about Null </h4><br>  To use a null compatible Int32 you can write: <br><br><pre> <code class="cs hljs">Nullable&lt;Int32&gt; x = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;  Int32? x = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre><br>  The union operator is null compatible values ‚Äã‚Äã- ??  (if the left operand is null, the operator goes to the following), consider two equivalent expressions: <br>  one) <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> temp = GetFileName(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fileName = ( temp != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) ? temp : <span class="hljs-string"><span class="hljs-string">"Untitled"</span></span>;</code> </pre><br>  2) <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fileName = GetFileName() ?? <span class="hljs-string"><span class="hljs-string">"Untitled"</span></span>;</code> </pre><br><br><h4>  26) Timers </h4><br>  The FCL library contains various timers: <br>  1) Timer in System.Threading - suitable for performing background tasks in a pool thread; <br>  2) Timer in System.Windows.Forms - the timer is associated with the calling thread, this prevents parallel invocation; <br>  3) DispatcherTimer in System.Windows.Threading.  - equivalent to the second, but for Silverlight and WPF applications; <br>  4) Timer in System.Timers.  - essentially a shell of the first, Jeffrey Richter advises against using it. <br><br><h4>  27) Type and typeof </h4><br>  To get an instance of Type for types, instead of the Type.GetType method, typeof is used.  If the type is known at compile time, the typeof operation immediately searches for methods instead of at runtime. <br><br><h4>  28) Using chip </h4><br>  To reduce the amount of code and make it clearer?  You can use a using directive like this: <br>  using DateTimeList = System.Collections.Generic.List &lt;System.DateTime&gt;; <br><br><h4>  29) Preprocessor Directives </h4><br>  a) #IF DEBUG and #ENDIF - used to specify code blocks that will be compiled only in DEBUG mode. <br>  b) #DEFINE XXX;  #IF (DEBUG &amp;&amp; XXX) - you can add the assembly number ‚ÄúXXX‚Äù to the condition. <br>  c)! DEBUG == RELEASE (just in case). <br>  d) #LINE 111 - in the error window will show the line 111. <br>  d) #LINE HIDDEN - hides the line from the debugger. <br>  e) #WARNING XXX;  #ERROR YYY - mean XXX - warning, YYY - error. <br><br><h4>  30) Any * anthony </h4><br>  Covariance - transformation in direct order, the keyword OUT. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] strings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] objects = strings; <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IMyEnumerator</span></span>&lt;<span class="hljs-title"><span class="hljs-title">out</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index </span></span></span><span class="hljs-function">)</span></span>; } T --&gt; R IOperation&lt;T&gt; --&gt; IOperation&lt;R&gt;</code> </pre><br>  Contravariance is a conversion in the reverse order, the keyword IN. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IMyCollection</span></span>&lt;<span class="hljs-title"><span class="hljs-title">in</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> T item </span></span></span><span class="hljs-function">)</span></span>; } R --&gt; T IOperation&lt;T&gt; --&gt; IOperation&lt;R&gt;</code> </pre><br>  Invariance - implicit type conversion is not allowed. <br><br>  By default, generic types are invariant.  Still generalized classes are called open, in runtime they are closed by specific types of ‚Äúint‚Äù, ‚Äústring‚Äù, for example.  And these are different types, the static fields in them will also be different. <br><br><h4>  31) Extension methods </h4><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StringBuilderExtensions</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Int32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IndexOf</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> StringBuilder sb, Char </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } }</code> </pre><br>  Allows you to define a static method that is invoked using the syntax of an instance method.  For example, you can define your own IndexOf method for StringBuilder.  First, the compiler will check the StringBuilder class or all its base classes for the presence of the IndexOf method with the necessary parameters, if it does not find one, it will look for any static class with a specific IndexOf method whose first parameter corresponds to the type of expression used in the method call. <br><br>  And this is the implementation of the Visitor pattern in .Net. <br><br><h4>  32) Execution Contexts </h4><br>  Each thread has a specific execution context.  It includes security parameters, host parameters, and logical call context data.  By default, the CLR automatically copies it, from the very first thread to all auxiliary ones.  This ensures the same security settings, but at the expense of performance.  To control this process, use the ExecutionContext class. <br><br><h4>  33) Volatile </h4><br>  JIT - the compiler guarantees that the access to the fields marked with the given keyword will occur in the mode of volatile reading or writing.  It prohibits the C # compiler and the JIT compiler from caching the contents of the field in the processor registers, which guarantees that with all read and write operations, manipulations will be performed directly with the memory. <br><br><h4>  34) Collection Classes for Parallel Stream Processing </h4><br>  ConcurrentQueue - processing elements by the FIFO algorithm; <br>  ConcurrentStack - processing elements using the LIFO algorithm; <br>  ConcurrentBag - unsorted set of elements, allowing duplication; <br>  ConcurrentDictionary &lt;TKey, TValue&gt; is an unsorted set of key-value pairs. <br><br><h4>  35) Streams </h4><br>  User Mode Constructs: <br>  a) Volatile structures - an atomic read or write operation. <br>  VolatileWrite, VolatileRead, MemoryBarrier. <br>  b) Interlocking constructions - an atomic read or write operation. <br>  System.Threading.Interlocked (interlocking) and System.Threading.SpinLock (locking with looping). <br>  Both constructions require the transfer of a reference (address in memory) to a variable (recalling structures). <br><br>  Kernel Mode Constructions: <br>  About 80 times slower than user-mode constructs, but they have a number of advantages described in MSDN (a lot of text). <br><br>  Class hierarchy: <br><br><pre> <code class="cs hljs">WaitHandle EventWaitHandle AutoResetEvent ManualResetEvent Semaphore Mutex</code> </pre><br><br><h4>  36) Class Fields </h4><br>  Do not explicitly initialize the fields; do this in the default constructor, and use it with the this () keyword to use constructors that take arguments.  This will allow the compiler to generate less IL code, since  Initialization occurs 1 time in any of the constructors (and not in all at once the same values, copies). <br><br><h4>  37) Run only one copy of the program </h4><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExist; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Semaphore ( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"MyAppUniqueString"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> IsExist ) ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( IsExist ) { <span class="hljs-comment"><span class="hljs-comment">/*    ,      . */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*         ,   ,      Main,      . */</span></span> } }}</code> </pre><br><br><h4>  38) Garbage Collection </h4><br>  The CLR has two modes: <br>  1) Workstation - the collector assumes that other applications do not use processor resources.  Modes - with parallel assembly and without it. <br>  2) Server - collector assumes that no third-party applications are running on the machine, all CPU resources are on the assembly!  Managed heap is disassembled into several sections - one per processor (with all the consequences, that is, one thread per heap). <br><br><h4>  39) Finalizer </h4><br>  It performs the function of the last desire of the object before deletion; it cannot last longer than 40 seconds, it is not worth playing with it.  Translates an object into at least 1 generation, since  not immediately removed. <br><br><h4>  40) Monitoring and control of the garbage collector at the facility </h4><br>  Call the static method Alloc of the GCHandle object, pass in a reference to the object and type GCHandleType in which: <br>  1) Weak monitoring, we find out that the object is no longer available, the finalizer could be executed. <br>  2) WeakTrackResurrection - monitoring, we find out that the object is no longer available, the finalizer was exactly executed (if available). <br>  3) Normal - control, forcing the object to remain in memory, the memory occupied by this object can be compressed. <br>  4) Pinned - control, forcing the object to remain in memory, the memory occupied by this object cannot be compressed (that is, moved). <br><br><h4>  41) CLR </h4><br>  The CLR is essentially a processor for MSIL commands.  While traditional processors use registers and stacks to execute all commands, the CLR uses only the stack. <br><br><h4>  42) Recursion </h4><br>  If you have ever seen an application that pauses another for a second and then disappears completely without any error message, it was almost certainly caused by endless recursion.  A stack overflow, as is known, cannot be intercepted and processed.  Why?  We read in books or blogs. <br><br><h4>  43) Windbg and SOS (Son of Strike) </h4><br>  How many domains are present in the process at once? <br>  - <i>3. System Domain, Shared Domain and Domain 1 (domain with the code of the current application).</i> <br><br>  How many heaps (generations) really? <br>  - <i>0, 1, 2 and Large Object Heap.</i> <i><br></i>  <i>Large Object Heap - for very large objects, not compressed by default, only through the configuration in the XML configuration file.</i> <br><br>  Another difference in the client and server garbage collection (in books is not all so detailed, perhaps inaccurate translation). <br>  - <i>Each HEAP has its own HEAP, each with its own 0, 1, 2 generations and a Large Object Heap.</i> <br><br>  Create an array larger than 2 GB on 64-bit platforms. <br>  - gcAllowVeryLargeObjects enabled = "true | false" <br><br>  What to do when there is free memory, but it is impossible to allocate a large continuous area for a new object? <br>  - <i>enable compact mode for Large Object Heap.</i>  <i>GCSettings.LargeObjectHeapCompactionMode;</i> <i><br></i>  <i>It is not recommended to use, it is very expensive to move large objects in memory.</i> <br><br>  How fast can I find flow loops (dead-locks) in runtime? <br>  -! Dlk <br><br>  Sources (not advertising): <br>  1) Jeffrey Richter, ‚ÄúCLR via C #‚Äù 3rd / 4th edition. <br>  2) Trey Nash, "C # 2010 Accelerated Professional Course." <br>  3) John Robbins, Debugging Applications for Microsoft .NET and Microsoft Windows. <br>  4) Alexander Shevchuk (MCTS, MCPD, MCT) and Oleg Kulygin (MCTS, MCPD, MCT) ITVDN resource (https://www.youtube.com/user/CBSmatmatTVTV/videos?shelf_id=4&amp;view=0&amp;sort=dd). <br>  5) Sergey Pugachev.  Microsoft Engineer (https://www.youtube.com/watch?v=XN8V9GURs6o) <br><br>  Hopefully, this list came to taste for both beginners and experienced C # programmers. <br><br>  Thanks for attention! <br><br>  * Updated, corrected errors, added some moments with examples. <br>  <i>If you find an error, please report it in a personal message.</i> </div><p>Source: <a href="https://habr.com/ru/post/256819/">https://habr.com/ru/post/256819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256809/index.html">HP Blade Workshop Video</a></li>
<li><a href="../256811/index.html">Dino Esposito will perform in St. Petersburg</a></li>
<li><a href="../256813/index.html">Vivaldi TP3 - we do the browser together</a></li>
<li><a href="../256815/index.html">BalanceBall. Self-balancing platform from A to Z</a></li>
<li><a href="../256817/index.html">Native Script. One code for all platforms</a></li>
<li><a href="../256821/index.html">How IQueryable and LINQ Data Providers Work</a></li>
<li><a href="../256823/index.html">Features of conceptual domain modeling</a></li>
<li><a href="../256825/index.html">What prepares us for C # 7 (Part 1. Tuples)</a></li>
<li><a href="../256827/index.html">Reverse engineering integer division by constant</a></li>
<li><a href="../256829/index.html">Features of the introduction of DLL and installation of hooks in Modern-applications Windows 8/10</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>