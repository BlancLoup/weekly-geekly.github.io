<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Himself gzip: compress scripts 20% better</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you look at the script compressed by Closure Compiler , om, YUI Compressor or something else, you can see endless rows of duplicate keys: .prototyp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Himself gzip: compress scripts 20% better</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f7d/1fa/5d8/f7d1fa5d8cd1d58188095e9e286cb45d.jpg" alt="Duplicate keys"><br><br>  If you look at the script compressed by <a href="http://code.google.com/closure/compiler">Closure Compiler</a> , om, <a href="http://developer.yahoo.com/yui/compressor">YUI Compressor</a> or something else, you can see endless rows of duplicate keys: <code>.prototype</code> , <code>.length</code> , <code>offsetParent</code> and so on.  Let's try to get rid of them using the example of the jQuery UI Sortable plugin.  I‚Äôll say right away that we don‚Äôt surpass gzip, but when it‚Äôs not at hand or impossible to use it (for example, at the <a href="http://10k.aneventapart.com/">10K Apart</a> competition), this compression technique can be very useful. <br><a name="habracut"></a><br>  Take the jquery.ui.sortable.js file version 1.8.2 as one of the most impressive in the jQuery UI bundle.  The source code weighs 38.5 KB, compressed by the Closure Compiler, 23.1 KB, in gzip, 5.71 KB.  In order not to clutter up the screens, we will choose some characteristic method and <em>imagine that this is a separate plugin</em> .  I liked <code>_mouseCapture()</code> : <br><blockquote><ol><li>  <font color="#008000">/ *!</font> </li><li>  <font color="#008000">* Source</font> </li><li>  <font color="#008000">* /</font> </li><li>  ( <font color="#0000ff">function</font> ($) { </li><li></li><li>  <font color="#0000ff">var</font> </li><li>  _mouseCapture = <font color="#0000ff">function</font> ( <font color="#0000ff">event</font> , overrideHandle) { </li><li></li><li>  <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .reverting) { </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .options.disabled || <font color="#0000ff">this</font> .options.type == <font color="#A31515">'static'</font> ) <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li></li><li>  <font color="#008000">// We have to refresh the items data once first</font> </li><li>  <font color="#0000ff">this</font> ._refreshItems ( <font color="#0000ff">event</font> ); </li><li></li><li>  <font color="#008000">// Find out if it‚Äôs clicked node (or one of its parents)</font> </li><li>  <font color="#0000ff">var</font> currentItem = <font color="#0000ff">null</font> , self = <font color="#0000ff">this</font> , nodes = $ ( <font color="#0000ff">event</font> .target) .parents (). each ( <font color="#0000ff">function</font> () { </li><li>  <font color="#0000ff">if</font> ($ .data ( <font color="#0000ff">this</font> , <font color="#A31515">'sortable-item'</font> ) == self) { </li><li>  currentItem = $ ( <font color="#0000ff">this</font> ); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li>  } </li><li>  }); </li><li>  <font color="#0000ff">if</font> ($ .data ( <font color="#0000ff">event</font> .target, <font color="#A31515">'sortable-item'</font> ) == self) currentItem = $ ( <font color="#0000ff">event</font> .target); </li><li></li><li>  <font color="#0000ff">if</font> (! currentItem) <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li>  <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .options.handle &amp;&amp;! overrideHandle) { </li><li>  <font color="#0000ff">var</font> validHandle = <font color="#0000ff">false</font> ; </li><li></li><li>  $ ( <font color="#0000ff">this</font> .options.handle, currentItem) .find ( <font color="#A31515">"*"</font> ) .andSelf (). each ( <font color="#0000ff">function</font> () { <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> == <font color="#0000ff">event</font> .target) validHandle = <font color="#0000ff">true</font> ;})); </li><li>  <font color="#0000ff">if</font> (! validHandle) <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">this</font> .currentItem = currentItem; </li><li>  <font color="#0000ff">this</font> ._removeCurrentsFromItems (); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li></li><li>  }; </li><li></li><li>  }) (jQuery); </li></ol></blockquote><br><br>  In order not to be confused, we will call it a test plug-in, and the entire Sortable - the original one.  The test plugin weighs exactly 1 KB, compressed 576 bytes, gzip 391 bytes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><font color="black"><font color="#008000">/*!</font> &lt;br&gt; <font color="#008000">*  </font> &lt;br&gt; <font color="#008000">*  , 576 </font> &lt;br&gt; <font color="#008000">*/</font> &lt;br&gt;( <font color="#0000ff">function</font> (d){ <font color="#0000ff">var</font> _mouseCapture= <font color="#0000ff">function</font> (a,b){ <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .reverting) <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .options.disabled|| <font color="#0000ff">this</font> .options.type== <font color="#A31515">"static"</font> ) <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <font color="#0000ff">this</font> ._refreshItems(a); <font color="#0000ff">var</font> c= <font color="#0000ff">null</font> ,e= <font color="#0000ff">this</font> ;d(a.target).parents().each( <font color="#0000ff">function</font> (){ <font color="#0000ff">if</font> (d.data( <font color="#0000ff">this</font> , <font color="#A31515">"sortable-item"</font> )==e){c=d( <font color="#0000ff">this</font> ); <font color="#0000ff">return</font> <font color="#0000ff">false</font> }}); <font color="#0000ff">if</font> (d.data(a.target, <font color="#A31515">"sortable-item"</font> )==e)c=d(a.target); <font color="#0000ff">if</font> (!c) <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .options.handle&amp;&amp;!b){ <font color="#0000ff">var</font> f= <font color="#0000ff">false</font> ;d( <font color="#0000ff">this</font> .options.handle,c).find( <font color="#A31515">"*"</font> ).andSelf().each( <font color="#0000ff">function</font> (){ <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> ==a.target)f= <font color="#0000ff">true</font> }); <font color="#0000ff">if</font> (!f) <font color="#0000ff">return</font> <font color="#0000ff">false</font> } <font color="#0000ff">this</font> .currentItem=c; <font color="#0000ff">this</font> ._removeCurrentsFromItems(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> }})(jQuery);</font></code> </blockquote> <br><br><h4>  <code>this</code> <strong>‚Üí</strong> <code>self</code> </h4><br>  First, let's get rid of the omnipresent and incompressible expression of <code>this</code> .  In our initial plugin, it is used as many as 587 times (which is 2.3 KB or 6% of the code).  Add a local variable <code>self</code> to the beginning of the function: <br><blockquote> <code><font color="black"><font color="#0000ff">var</font> &lt;br&gt;    self = <font color="#0000ff">this</font> ;&lt;br&gt;</font></code> </blockquote> <br>  Now we replace everywhere in the body of <code>this</code> function with <code>self</code> and look at the results of compression. <br>  It was: <br><blockquote> <code><font color="black"><font color="#0000ff">this</font> .currentItem=e; <font color="#0000ff">this</font> ._removeCurrentsFromItems();</font></code> </blockquote> <br>  It became: <br><blockquote> <code><font color="black">d.currentItem=e;d._removeCurrentsFromItems();</font></code> </blockquote> <br>  All test plugin: <br><blockquote> <code><font color="black"><font color="#008000">/*!</font> &lt;br&gt; <font color="#008000">*  this &gt; self</font> &lt;br&gt; <font color="#008000">* YUI Compressor, 552 </font> &lt;br&gt; <font color="#008000">*/</font> &lt;br&gt;( <font color="#0000ff">function</font> (b){ <font color="#0000ff">var</font> a= <font color="#0000ff">function</font> (f,g){ <font color="#0000ff">var</font> d= <font color="#0000ff">this</font> ; <font color="#0000ff">if</font> (d.reverting){ <font color="#0000ff">return</font> <font color="#0000ff">false</font> } <font color="#0000ff">if</font> (d.options.disabled||d.options.type== <font color="#A31515">"static"</font> ){ <font color="#0000ff">return</font> <font color="#0000ff">false</font> }d._refreshItems(f); <font color="#0000ff">var</font> e= <font color="#0000ff">null</font> ,c=b(f.target).parents().each( <font color="#0000ff">function</font> (){ <font color="#0000ff">if</font> (b.data( <font color="#0000ff">this</font> , <font color="#A31515">"sortable-item"</font> )==d){e=b( <font color="#0000ff">this</font> ); <font color="#0000ff">return</font> <font color="#0000ff">false</font> }}); <font color="#0000ff">if</font> (b.data(f.target, <font color="#A31515">"sortable-item"</font> )==d){e=b(f.target)} <font color="#0000ff">if</font> (!e){ <font color="#0000ff">return</font> <font color="#0000ff">false</font> } <font color="#0000ff">if</font> (d.options.handle&amp;&amp;!g){ <font color="#0000ff">var</font> h= <font color="#0000ff">false</font> ;b(d.options.handle,e).find( <font color="#A31515">"*"</font> ).andSelf().each( <font color="#0000ff">function</font> (){ <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> ==f.target){h= <font color="#0000ff">true</font> }}); <font color="#0000ff">if</font> (!h){ <font color="#0000ff">return</font> <font color="#0000ff">false</font> }}d.currentItem=e;d._removeCurrentsFromItems(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> }})(jQuery);</font></code> </blockquote> <br>  Not bad!  By the way, in this method in line 19 there was already exactly the same declaration <code>self = this</code> to transfer the context to the function being created, but for some reason it was not used for optimization.  Here we just brought this announcement to the beginning, and in another function one could add, the extra few characters will pay off if at least 4 <code>this</code> used in the function (and there are 70 of them). <br><br><h4>  Keys and strings </h4><br>  Now look carefully at the remaining code.  Repeated expressions of <code>options</code> , <code>target</code> , <code>data</code> , <code>"sortable-item"</code> and others are clearly visible.  Most of them are object property names or strings, some occur 50‚Äì60 times in the original plugin.  Compressors compress these elements (change names to shorter ones) only Closure Compiler is able in advanced mode, but here we see almost all the properties in their places.  Most likely, when compiling the library, an extensive list of externals, incompressible names was given.  There is a natural desire to correct this situation, because the method of optimization suggests the very syntax of the language.  Let's make frequently used keys local variables: <br><blockquote> <code><font color="black"><font color="#0000ff">var</font> &lt;br&gt;    a = {&lt;br&gt;        options: {&lt;br&gt;            visible: <font color="#0000ff">true</font> ,&lt;br&gt;            mess: <font color="#A31515">'hi'</font> &lt;br&gt;        }&lt;br&gt;    };</font></code> <br> <br>  one: <br> <code><code><font color="black"><font color="#0000ff">if</font> (a.options.visible) {&lt;br&gt;    alert(a.options.mess);&lt;br&gt;    a.options.visible = <font color="#0000ff">false</font> ;&lt;br&gt;}</font> <br> <br> 2: <br> <font color="#0000ff">var</font> &lt;br&gt;    o = <font color="#A31515">'options'</font> ,&lt;br&gt;    v = <font color="#A31515">'visible'</font> ;&lt;br&gt; <font color="#0000ff">if</font> (a[o][v]) {&lt;br&gt;    alert(a[o].mess);&lt;br&gt;    a[o][v] = <font color="#0000ff">false</font> ;&lt;br&gt;}</code></code> </blockquote> <br>  In the second version, we needed to write <code>visible</code> only once instead of two, and <code>options</code> once instead of three.  On the scale of a 40-kilobyte plug-in, and especially of the application, this gives a tangible gain in the amount of code (but not in clarity). <br><br>  You can write a small script in any language to determine the frequency of expressions in the code and automatically replace them with variables.  For example, in the following regular expression: <code>/((\')|(\")|\.)\b([a-z_][\w-]+\w)\b(?(2)\')(?(3)\")/i</code> .  For the original plug-in, 175 replacements were obtained, for the test one - 15: <br><blockquote><ol><li>  <font color="#008000">/ *!</font> </li><li>  <font color="#008000">* Replacing this&gt; self</font> </li><li>  <font color="#008000">* Replacing keys and strings</font> </li><li>  <font color="#008000">* /</font> </li><li>  ( <font color="#0000ff">function</font> ($) { </li><li></li><li>  <font color="#0000ff">var</font> </li><li>  _reverting = <font color="#A31515">'reverting'</font> , <font color="#008000">// 3</font> </li><li>  _options = <font color="#A31515">'options'</font> , <font color="#008000">// 51</font> </li><li>  _disabled = <font color="#A31515">'disabled'</font> , <font color="#008000">// 4</font> </li><li>  _type = <font color="#A31515">'type'</font> , <font color="#008000">// 2</font> </li><li>  _static = <font color="#A31515">'static'</font> , <font color="#008000">// 2</font> </li><li>  __refreshItems = <font color="#A31515">'_refreshItems'</font> , <font color="#008000">// 2</font> </li><li>  _target = <font color="#A31515">'target'</font> , <font color="#008000">// 4</font> </li><li>  _parents = <font color="#A31515">'parents'</font> , <font color="#008000">// 2</font> </li><li>  _each = <font color="#A31515">'each'</font> , <font color="#008000">// 5</font> </li><li>  _data = <font color="#A31515">'data'</font> , <font color="#008000">// 5</font> </li><li>  _sortable_item = <font color="#A31515">'sortable-item'</font> , <font color="#008000">// 6</font> </li><li>  _handle = <font color="#A31515">'handle'</font> , <font color="#008000">// 2</font> </li><li>  _find = <font color="#A31515">'find'</font> , <font color="#008000">// 2</font> </li><li>  _currentItem = <font color="#A31515">'currentItem'</font> , <font color="#008000">// 52</font> </li><li>  FALSE =! 1, <font color="#008000">// 30</font> </li><li>  TRUE =! 0, <font color="#008000">// 11</font> </li><li></li><li>  _mouseCapture = <font color="#0000ff">function</font> ( <font color="#0000ff">event</font> , overrideHandle) { </li><li>  <font color="#0000ff">var</font> </li><li>  self = <font color="#0000ff">this</font> ; </li><li></li><li>  <font color="#0000ff">if</font> (self [_reverting]) { </li><li>  <font color="#0000ff">return</font> FALSE; </li><li>  } </li><li></li><li>  <font color="#0000ff">if</font> (self [_options] [_ disabled] || self [_options] [_ type] == _static) <font color="#0000ff">return</font> FALSE; </li><li></li><li></li><li>  self [__ refreshItems] ( <font color="#0000ff">event</font> ); </li><li></li><li></li><li>  <font color="#0000ff">var</font> currentItem = <font color="#0000ff">null</font> , nodes = $ ( <font color="#0000ff">event</font> [_target]) [_ parents] () [_ each] ( <font color="#0000ff">function</font> () { </li><li>  <font color="#0000ff">if</font> ($ [_ data] ( <font color="#0000ff">this</font> , _sortable_item) == self) { </li><li>  currentItem = $ ( <font color="#0000ff">this</font> ); </li><li>  <font color="#0000ff">return</font> FALSE; </li><li>  } </li><li>  }); </li><li>  <font color="#0000ff">if</font> ($ [_ data] ( <font color="#0000ff">event</font> [_target], _sortable_item) == self) currentItem = $ ( <font color="#0000ff">event</font> [_target]); </li><li></li><li>  <font color="#0000ff">if</font> (! currentItem) <font color="#0000ff">return</font> FALSE; </li><li>  <font color="#0000ff">if</font> (self [_options] [_ handle] &amp;&amp;! overrideHandle) { </li><li>  <font color="#0000ff">var</font> validHandle = FALSE; </li><li></li><li>  $ (self [_options] [_ handle], currentItem) [_ find] ( <font color="#A31515">"*"</font> ) .andSelf () [_ each] ( <font color="#0000ff">function</font> () { <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> == <font color="#0000ff">event</font> [_target]) validHandle = TRUE;}); </li><li>  <font color="#0000ff">if</font> (! validHandle) <font color="#0000ff">return</font> FALSE; </li><li>  } </li><li></li><li>  self [_currentItem] = currentItem; </li><li>  self._removeCurrentsFromItems (); </li><li>  <font color="#0000ff">return</font> TRUE; </li><li></li><li>  }; </li><li></li><li>  }) (jQuery); </li></ol></blockquote><br><br>  Declaring variables is cumbersome, but you should not forget that it will be common for at least all methods of the original plug-in, in theory you can make a general declaration of names for the entire application.  The larger the ‚Äúfield of activity‚Äù, the more effective the name compression will work, since  each of them is indicated only once at the beginning of the module, and is subsequently replaced everywhere by its one- or two-letter representation.  Compressed test plugin looks great: <br><blockquote><ol><li>  <font color="#008000">/ *!</font> </li><li>  <font color="#008000">* Replacing this&gt; self</font> </li><li>  <font color="#008000">* Replacing keys and strings</font> </li><li>  <font color="#008000">* YUI Compressor, 395 B + JS beautifier</font> </li><li>  <font color="#008000">* /</font> </li><li>  ( <font color="#0000ff">function</font> (c) { </li><li>  <font color="#0000ff">var</font> b = <font color="#0000ff">function</font> (v, w) { </li><li>  <font color="#0000ff">var</font> t = <font color="#0000ff">this</font> ; </li><li>  <font color="#0000ff">if</font> (t [e]) { </li><li>  <font color="#0000ff">return</font> o </li><li>  } </li><li>  <font color="#0000ff">if</font> (t [m] [k] || t [m] [r] == f) { </li><li>  <font color="#0000ff">return</font> o </li><li>  } </li><li>  t [n] (v); </li><li>  <font color="#0000ff">var</font> u = <font color="#0000ff">null</font> , </li><li>  s = c (v [i]) [g] () [q] ( <font color="#0000ff">function</font> () { </li><li>  <font color="#0000ff">if</font> (c [l] ( <font color="#0000ff">this</font> , j) == t) { </li><li>  u = c ( <font color="#0000ff">this</font> ); </li><li>  <font color="#0000ff">return</font> o </li><li>  } </li><li>  }); </li><li>  <font color="#0000ff">if</font> (c [l] (v [i], j) == t) { </li><li>  u = c (v [i]) </li><li>  } </li><li>  <font color="#0000ff">if</font> (! u) { </li><li>  <font color="#0000ff">return</font> o </li><li>  } </li><li>  <font color="#0000ff">if</font> (t [m] [d] &amp;&amp;! w) { </li><li>  <font color="#0000ff">var</font> x = o; </li><li>  c (t [m] [d], u) [a] ( <font color="#A31515">"*"</font> ) .andSelf () [q] ( <font color="#0000ff">function</font> () { </li><li>  <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> == v [i]) { </li><li>  x = h </li><li>  } </li><li>  }); </li><li>  <font color="#0000ff">if</font> (! x) { </li><li>  <font color="#0000ff">return</font> o </li><li>  } </li><li>  } </li><li>  t [p] = u; </li><li>  t._removeCurrentsFromItems (); </li><li>  <font color="#0000ff">return</font> h </li><li>  } </li><li>  }) (jQuery); </li></ol></blockquote><br><br><h4>  <code>document</code> , <code>window</code> , etc. </h4><br>  These global objects are also compressed well if they are assigned to local variables.  In our test plug-in, <code>document</code> and <code>window</code> not used, so we <code>_mouseDrag()</code> temporarily turn to the neighboring <code>_mouseDrag()</code> method: <br><blockquote> <code><font color="black">( <font color="#0000ff">function</font> () {&lt;br&gt;&lt;br&gt; <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .pageY - $( <font color="#0000ff">document</font> ).scrollTop() &lt; o.scrollSensitivity)&lt;br&gt;        scrolled = $( <font color="#0000ff">document</font> ).scrollTop($( <font color="#0000ff">document</font> ).scrollTop() - o.scrollSpeed);&lt;br&gt; <font color="#0000ff">else</font> <font color="#0000ff">if</font> ($(window).height() - ( <font color="#0000ff">event</font> .pageY - $( <font color="#0000ff">document</font> ).scrollTop()) &lt; o.scrollSensitivity)&lt;br&gt;        scrolled = $( <font color="#0000ff">document</font> ).scrollTop($( <font color="#0000ff">document</font> ).scrollTop() + o.scrollSpeed);&lt;br&gt;    &lt;br&gt; <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .pageX - $( <font color="#0000ff">document</font> ).scrollLeft() &lt; o.scrollSensitivity)&lt;br&gt;        scrolled = $( <font color="#0000ff">document</font> ).scrollLeft($( <font color="#0000ff">document</font> ).scrollLeft() - o.scrollSpeed);&lt;br&gt; <font color="#0000ff">else</font> <font color="#0000ff">if</font> ($(window).width() - ( <font color="#0000ff">event</font> .pageX - $( <font color="#0000ff">document</font> ).scrollLeft()) &lt; o.scrollSensitivity)&lt;br&gt;        scrolled = $( <font color="#0000ff">document</font> ).scrollLeft($( <font color="#0000ff">document</font> ).scrollLeft() + o.scrollSpeed);&lt;br&gt;&lt;br&gt;})();</font></code> </blockquote> <br>  Such a picture is quite often observed in scripts.  Such code is compressed only due to the removal of spaces and unnecessary characters, since there are no local variables in it.  Now let's look at compression with replacements: <br><blockquote> <code><font color="black">( <font color="#0000ff">function</font> () {&lt;br&gt; <font color="#0000ff">var</font> g = <font color="#0000ff">document</font> ,&lt;br&gt;        f = window,&lt;br&gt;        e = <font color="#A31515">"scrollTop"</font> ,&lt;br&gt;        c = <font color="#A31515">"scrollLeft"</font> ,&lt;br&gt;        b = <font color="#A31515">"scrollSpeed"</font> ,&lt;br&gt;        d = <font color="#A31515">"scrollSensitivity"</font> ,&lt;br&gt;        h = <font color="#A31515">"pageY"</font> ,&lt;br&gt;        a = <font color="#A31515">"pageX"</font> ;&lt;br&gt;&lt;br&gt; <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> [h] - $(g)[e]() &lt; o[d]) {&lt;br&gt;        scrolled = $(g)[e]($(g)[e]() - o[b])&lt;br&gt;    } <font color="#0000ff">else</font> {&lt;br&gt; <font color="#0000ff">if</font> ($(f).height() - ( <font color="#0000ff">event</font> [h] - $(g)[e]()) &lt; o[d]) {&lt;br&gt;            scrolled = $(g)[e]($(g)[e]() + o[b])&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> [a] - $(g)[c]() &lt; o[d]) {&lt;br&gt;        scrolled = $(g)[c]($(g)[c]() - o[b])&lt;br&gt;    } <font color="#0000ff">else</font> {&lt;br&gt; <font color="#0000ff">if</font> ($(f).width() - ( <font color="#0000ff">event</font> [a] - $(g)[c]()) &lt; o[d]) {&lt;br&gt;            scrolled = $(g)[c]($(g)[c]() + o[b])&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;&lt;br&gt;})();</font></code> </blockquote> <br>  This is the ABC of the optimizer, but for some reason these simple techniques are used extremely rarely, even in large libraries, where they belong.  It is possible that if the developers came to certain agreements on the use of reduced variables at the project level, compressed jQuery could weigh not 70 KB, but, say, 50. <br><br>  In the previous example, it would be even better to create a variable with reference to the document object in a jQuery wrapper: <br><blockquote> <code><font color="black"><font color="#0000ff">var</font> &lt;br&gt;    doc = <font color="#0000ff">document</font> ,&lt;br&gt;    $doc = $(doc);</font></code> </blockquote> <br><br><h5>  Lyrical digression </h5><br>  Quite often (yes almost always) in a dynamically created function in jQuery, an element in a wrapper is required, and you have to do something like this: <br><blockquote> <code><font color="black">$( <font color="#A31515">'li'</font> ).each( <font color="#0000ff">function</font> (index, item) {&lt;br&gt; <font color="#0000ff">var</font> &lt;br&gt;        $item = $(item)&lt;br&gt; <font color="#008000">/* do something with $item */</font> &lt;br&gt;});</font></code> </blockquote> <br>  Such constructions are also found in the source code of the library.  And how much simpler it would be if a jQuery object with an element were immediately passed to the third optional parameter: <br><blockquote> <code><font color="black">$( <font color="#A31515">'li'</font> ).each( <font color="#0000ff">function</font> (index, item, $item) {&lt;br&gt; <font color="#008000">/* do something with $item */</font> &lt;br&gt;});</font></code> </blockquote> <br>  Beauty! <br><br><h4>  results </h4><br>  However, back to our test plugin.  After optimization, it began to weigh 395 bytes versus 576, we won 31.4%: <br><blockquote> <code><font color="black"><font color="#008000">/*!</font> &lt;br&gt; <font color="#008000">*  this &gt; self</font> &lt;br&gt; <font color="#008000">*    </font> &lt;br&gt; <font color="#008000">* YUI Compressor, 395 </font> &lt;br&gt; <font color="#008000">*/</font> &lt;br&gt;( <font color="#0000ff">function</font> (c){ <font color="#0000ff">var</font> b= <font color="#0000ff">function</font> (v,w){ <font color="#0000ff">var</font> t= <font color="#0000ff">this</font> ; <font color="#0000ff">if</font> (t[e]){ <font color="#0000ff">return</font> o} <font color="#0000ff">if</font> (t[m][k]||t[m][r]==f){ <font color="#0000ff">return</font> o}t[n](v); <font color="#0000ff">var</font> u= <font color="#0000ff">null</font> ,s=c(v[i])[g]()[q]( <font color="#0000ff">function</font> (){ <font color="#0000ff">if</font> (c[l]( <font color="#0000ff">this</font> ,j)==t){u=c( <font color="#0000ff">this</font> ); <font color="#0000ff">return</font> o}}); <font color="#0000ff">if</font> (c[l](v[i],j)==t){u=c(v[i])} <font color="#0000ff">if</font> (!u){ <font color="#0000ff">return</font> o} <font color="#0000ff">if</font> (t[m][d]&amp;&amp;!w){ <font color="#0000ff">var</font> x=o;c(t[m][d],u)[a]( <font color="#A31515">"*"</font> ).andSelf()[q]( <font color="#0000ff">function</font> (){ <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> ==v[i]){x=h}}); <font color="#0000ff">if</font> (!x){ <font color="#0000ff">return</font> o}}t[p]=u;t._removeCurrentsFromItems(); <font color="#0000ff">return</font> h}})(jQuery);</font></code> </blockquote> <br><br>  On the scale of the original plug-in, the picture, of course, is somewhat different, since variable declarations are added.  As a result of all the manipulations, the plug-in compressed form began to weigh 18 KB exactly, the gain amounted to 5.3 KB (21.5%).  But gzip, on the contrary, got 0.7 kb (13%), so it‚Äôs better to use this technique where gzp is unavailable for some reason.  A file compressed this way can also be given to older browsers like Safari 2, which do not support gzip. <br><br>  Source plugin size in bytes: <br><table><tbody><tr><td></td><td>  Source code </td><td>  this ‚Üí self </td><td>  Property caching </td></tr><tr><td>  Without compression </td><td>  39,495 </td><td>  40,241 </td><td>  41,148 </td></tr><tr><td>  YUI / CC </td><td>  23,656 </td><td>  22 185 </td><td>  18,496 </td></tr><tr><td>  gzip </td><td>  5 851 </td><td>  5,950 </td><td>  6,504 </td></tr></tbody></table><br>  <strong>Upd:</strong> added an example of compression of global objects. </div><p>Source: <a href="https://habr.com/ru/post/100828/">https://habr.com/ru/post/100828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../100821/index.html">Microblog about the use of English words</a></li>
<li><a href="../100822/index.html">WCG 2010 Belarus - Semifinal</a></li>
<li><a href="../100823/index.html">Microsoft Exchange Server 2010 SP1 protocol specifications published</a></li>
<li><a href="../100824/index.html">Eureka and euphoria: About scientists and their discoveries</a></li>
<li><a href="../100825/index.html">Bing Maps integrates with OpenStreetMap</a></li>
<li><a href="../100833/index.html">Microsoft Ribbon Release for WPF Released</a></li>
<li><a href="../100835/index.html">A few words about usability</a></li>
<li><a href="../100838/index.html">Healing Potion for IE5 + or IE7.js</a></li>
<li><a href="../100841/index.html">A week of free playing Heroes of Newerth</a></li>
<li><a href="../100842/index.html">2D rendering in SDL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>