<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hermitage - the solution to your problems with storing and processing images</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I'll be brief: in exchange for five minutes of your time, the department of PHP development company Live Tiping will tell you about its own mic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hermitage - the solution to your problems with storing and processing images</h1><div class="post__text post__text-html js-mediator-article">  Hello!  I'll be brief: in exchange for five minutes of your time, the department of PHP development company Live Tiping will tell you about its own microservice for storing and processing downloaded images.  It is called <a href="https://github.com/LiveTyping/hermitage-skeleton">Hermitage</a> .  His task is to present the image in different versions according to predefined parameters.  Hermitage will be useful in situations where you need a standalone and scalable server for storing images and manipulating them. <br><img src="https://habrastorage.org/files/0b0/9b4/28c/0b09b428ccec47db82399871d57f29c4.jpg" alt="hermitage"><br><a name="habracut"></a><br><h1>  What is good Hermitage compared to others </h1><br>  For example, take <a href="https://glide.thephpleague.com/">Glide</a> .  Besides the fact that he and similar services each time deals with the original image, processing it on the fly, he also accepts the manipulation parameters in each request to the image.  This not only loads the system, but also forces the client side to transfer parameters for the required version of the image each time. <br><br>  With Hermitage, the client receives a source that is not processed here and now, but its version.  To get the required version of the image, you should send only the version name with the request. <br><br>  When the server first receives a request for a version, it will manipulate the image according to the parameters it knows in advance, and on subsequent requests will return the finished image. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Images are stored on any storage convenient for you, be it AWS S3, Dropbox or FTP.  The <a href="https://flysystem.thephpleague.com/">FlySystem</a> library helps to abstract from one specific repository and connect any of them, while <a href="http://image.intervention.io/">Intervention Image is</a> used for image manipulations. <br><br><h1>  How Hermitage Works </h1><br>  In order to save your time, we made funny pictures about how it all works. <br><br>  <i>Saving image</i> <br><img src="https://habrastorage.org/files/1f0/2f6/3cf/1f02f63cfd49430187ff63de1748e504.jpg"><br><br>  <i>Image Request</i> <br><img src="https://habrastorage.org/files/268/b1f/5bd/268b1f5bd8e14266a9ed65f2a411785f.jpg"><br><br>  The image request by the client can proceed in two scenarios: when the image version is already in the cloud, and when it is not there. <br><br>  In the first case, the service gives the client a version of the image, receiving it directly from the cloud: <br><img src="https://habrastorage.org/files/041/958/4b7/0419584b788c4ad6810a55c00a11431d.jpg"><br><br>  And in the second, it performs the necessary manipulations on the image, saves it to the cloud and gives it to the client: <br><img src="https://habrastorage.org/files/c12/554/0d1/c125540d143f484e89722fb001a8fc6b.jpg"><br><br><h1>  API </h1><br>  Hermitage API is ugly simple and provides the basic functionality: save, delete and get the necessary version of the image. <br><br>  For security reasons, requests for saving and deleting an image require a signature that is unique to each request and based on the request URL, http method, current timestamp, and private key. <br><br>  You can get the image at the URL: <code>http://hermitage/{filename}:{version}</code> <br>  where <code>{filename}</code> is the file name, and <code>{version}</code> is the name of the requested version of the image specified in the configuration file of this application. <br><br>  More information on the API can be found <a href="https://github.com/LiveTyping/hermitage">here</a> . <br>  There is also a ready-made client for working with API in PHP: <a href="https://github.com/LiveTyping/hermitage-php-client">hermitage-php-client</a> and an <a href="https://github.com/LiveTyping/yii2-hermitage-client">adapter for the popular Yii2 framework</a> . <br><br><h1>  How to deploy Hermitage </h1><br>  Requirements: <br><br><ul><li>  PHP&gt; = 7.0 </li><li>  PHP APCU </li><li>  GD2 / ImageMagick </li></ul><br><h2>  Installation </h2><br>  Run the following Composer command: <br><br><pre> <code class="bash hljs">composer create-project livetyping/hermitage-skeleton hermitage</code> </pre><br><h2>  Configuration </h2><br>  Copy the file <code>.env.example</code> to <code>.env</code> <br><br><pre> <code class="bash hljs">cp .env.example .env</code> </pre><br>  The local <code>.env</code> file looks like this: <br><br><pre> <code class="bash hljs">AUTH_SECRET=changeme <span class="hljs-comment"><span class="hljs-comment">### # Adapter ## STORAGE_ADAPTER=local # AWS S3 #STORAGE_ADAPTER=s3 #STORAGE_S3_REGION= #STORAGE_S3_BUCKET= #STORAGE_S3_KEY= #STORAGE_S3_SECRET=</span></span></code> </pre><br>  Do not forget to generate a random row and set <code>AUTH_SECRET</code> . <br><br>  We register the necessary versions of images in the <code>config/versions.php</code> file: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * [ * '{version-name}' =&gt; [ * 'type' =&gt; '{manipulator-name}', * // manipulator options * ], * ] * * Default manipulators: * - resize {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@see</span></span></span><span class="hljs-comment"> \livetyping\hermitage\foundation\images\processor\manipulators\Resize} * - fit {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@see</span></span></span><span class="hljs-comment"> \livetyping\hermitage\foundation\images\processor\manipulators\Fit} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'mini'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'resize'</span></span>, <span class="hljs-string"><span class="hljs-string">'height'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'width'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">200</span></span>, ], <span class="hljs-string"><span class="hljs-string">'small'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'resize'</span></span>, <span class="hljs-string"><span class="hljs-string">'height'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-string"><span class="hljs-string">'width'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">400</span></span>, ], <span class="hljs-string"><span class="hljs-string">'thumb'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'fit'</span></span>, <span class="hljs-string"><span class="hljs-string">'height'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'width'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100</span></span>, ], ];</code> </pre><br>  At the end of all you have to do is configure the web server.  It will be nginx or Apache, you decide. <br><br><h1>  Links </h1><br><ul><li>  <a href="https://github.com/LiveTyping/hermitage-skeleton">Hermitage skeleton</a> </li><li>  <a href="https://github.com/LiveTyping/hermitage-php-client">PHP Client for Hermitage</a> </li><li>  <a href="https://github.com/LiveTyping/yii2-hermitage-client">Client Adapter for Yii2</a> </li></ul><br>  That's all.  If you like <a href="https://github.com/LiveTyping/hermitage">microservice</a> , we will be happy for your commits. <br>  Leave your comments and suggestions in the comments. </div><p>Source: <a href="https://habr.com/ru/post/310340/">https://habr.com/ru/post/310340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310330/index.html">Azure-IaaS-Digest number 10 (August-September)</a></li>
<li><a href="../310332/index.html">DetectNet: Deep Neural Network for Object Detection at DIGITS</a></li>
<li><a href="../310334/index.html">Introducing Apache Ignite: First Steps</a></li>
<li><a href="../310336/index.html">The main characteristics of a quality code</a></li>
<li><a href="../310338/index.html">About fundamental mistakes in the design of programming languages</a></li>
<li><a href="../310344/index.html">How I left InDesign for LaTeX</a></li>
<li><a href="../310346/index.html">Microsoft can integrate CFG into the Windows kernel</a></li>
<li><a href="../310348/index.html">The number of sent and received letters by day</a></li>
<li><a href="../310352/index.html">Badoo opens source code Live Streaming Daemon</a></li>
<li><a href="../310354/index.html">The art of design opponents in the game Zelda: A Link to the Past</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>