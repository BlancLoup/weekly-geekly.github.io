<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HTML minimization in Web Essentials 2013</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the most significant innovations for web developers in Visual Studio 2013 has become a new HTML editor. Unlike the old editor, which was a mixt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HTML minimization in Web Essentials 2013</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/da7/916/21f/da791621fe77e28009a633201c5bd642.png" width="565" height="100" alt="Web Essentials and WebMarkupMin logos"><br>  One of the most significant innovations for web developers in Visual Studio 2013 has become a new HTML editor.  Unlike the old editor, which was a mixture of managed and unmanaged code (and even used some components of FrontPage), the new editor was completely rewritten in managed code (the HTML editor from WebMatrix was used as the basis). <br><blockquote> It should be noted that for ASP.NET Web Forms (files with extensions <code>.aspx</code> , <code>.ascx</code> and <code>.master</code> ) the old editor is still used. </blockquote><br>  In addition to improved tools for working with HTML code, the new editor also supports the syntax of <a href="http://knockoutjs.com/">KnockoutJS</a> , <a href="http://angularjs.org/">AngularJS</a> and <a href="http://handlebarsjs.com/">Handlebars</a> views, and IntelliSense for special prefixes and META tags (Facebook, Twitter, Open Graph, Windows Phone, iOS, etc.). <br><br>  Unfortunately, not every new development in the world of web development can get into Visual Studio for the following reasons: <br><ol><li>  Many modern web technologies and libraries are open source projects (for example, the <a href="http://lesscss.org/">LESS</a> and <a href="http://coffeescript.org/">CoffeeScript</a> compilers, the <a href="http://www.jshint.com/">JSHint verifier</a> , etc.), and some of these projects have licenses that do not allow them to be included in commercial products. </li><li>  Now web technologies are developing so fast that their support by development tools may become irrelevant within one week.  Therefore, neither frequent releases of Visual Studio (now the period between releases has been reduced from two years to one year), nor periodic updates make it possible to keep Visual Studio in a completely up-to-date state. </li></ol><br>  In order to solve the above problems, Microsoft employee Mads Christensen created a VS-extension <a href="http://vswebessentials.com/">Web Essentials</a> .  The source code of Web Essentials is published on GitHub (2 versions are available: <a href="http://github.com/madskristensen/WebEssentials2012">2012</a> and <a href="http://github.com/madskristensen/WebEssentials2013">2013</a> ). <br><br>  The following are additional features of the HTML editor from Visual Studio 2013 that become available after installing Web Essentials 2013: <br><ol><li>  <a href="http://code.google.com/p/zen-coding/">Zen Coding</a> support (for more information on using Zen Coding in Web Essentials, see John Papa <a href="http://www.johnpapa.net/zen-coding-in-visual-studio-2012/">‚Äôs</a> article <a href="http://www.johnpapa.net/zen-coding-in-visual-studio-2012/">‚ÄúZen Coding in Visual Studio 2012‚Äù</a> ) and <a href="http://ru.wikipedia.org/wiki/Lorem_ipsum">Lorem Ipsum‚Äôs</a> ‚Äúfish‚Äù <a href="http://ru.wikipedia.org/wiki/Lorem_ipsum">text</a> generator (for example, if you type <code>lorem10</code> and press the <strong>TAB</strong> key, 10 words from Cicero's treatise ‚ÄúOn the limits of good and evil‚Äù will be inserted into the code). </li><li>  The <strong>Go To Definition</strong> command for the <code>&lt;a&gt;</code> , <code>&lt;style&gt;</code> and <code>&lt;script&gt;</code> . </li><li>  HTML minimization of the selected code snippet. </li><li>  Support for HTML regions (for example, <code>&lt;!--#region main--&gt; - ‚Ä¶ &lt;!--#endregion--&gt;</code> ). </li></ol><br>  Since HTML minimization in Web Essentials 2013 was implemented using the <a href="http://webmarkupmin.codeplex.com/">WebMarkupMin</a> library, the author of which I am, in this article we will look at this feature in more detail. <br><a name="habracut"></a><br> <a href="" title="Open full image"><img src="https://habrastorage.org/getpro/habr/post_images/a60/28d/849/a6028d8492aa5acb4fedde75344af49e.png" width="800" height="504"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>Fig.</strong>  <strong>1.</strong> A list of NuGet packages that are used in Web Essentials 2013. <br><br>  Minimizing a fragment of HTML code is in many ways similar to the similar functionality for JavaScript and CSS: first select the necessary code fragment (or the entire contents of the file), and then right-click and select the <strong>Web Essentials ‚ñ∫ Minify selection</strong> command in the pop-up menu that appears (Fig. 2). ). <br><br> <a href="" title="Open full image"><img src="https://habrastorage.org/getpro/habr/post_images/706/693/c82/706693c823d3409fc1a64607af134853.png" width="800" height="504"></a> <br><br>  <strong>Figure 2.</strong> A fragment of HTML-code to minimize. <br><br>  If the minimization was successful, then the minimized code will be visible in place of the selected fragment, and information about how much we were able to save by minimizing will be displayed in the status bar of Visual Studio (Fig. 3). <br><br> <a href="" title="Open full image"><img src="https://habrastorage.org/getpro/habr/post_images/af3/380/5c5/af33805c54337d2bb7dd0934abd580dc.png" width="800" height="504"></a> <br><br>  <strong>Fig.</strong>  <strong>3.</strong> A fragment of HTML-code after minimization. <br><br>  If errors occur during the minimization, the selected code fragment will not be minimized, and an error message will be displayed in the status bar. <br><br>  Now let's see what we have under the hood: <br><br>  <strong>Listing 1.</strong> <code>MenuItems/MinifyFile.cs</code> . <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EnvDTE; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EnvDTE80; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Ajax.Utilities; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel.Design; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> WebMarkupMin.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> WebMarkupMin.Core.Minifiers; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> WebMarkupMin.Core.Settings; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MadsKristensen.EditorExtensions</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MinifyFileMenu</span></span> { ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; _htmlExt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;() { <span class="hljs-string"><span class="hljs-string">".html"</span></span>, <span class="hljs-string"><span class="hljs-string">".htm"</span></span>, <span class="hljs-string"><span class="hljs-string">".aspx"</span></span>, <span class="hljs-string"><span class="hljs-string">".ascx"</span></span>, <span class="hljs-string"><span class="hljs-string">".master"</span></span>, <span class="hljs-string"><span class="hljs-string">".cshtml"</span></span>, <span class="hljs-string"><span class="hljs-string">".vbhtml"</span></span> }; ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MinifyString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> extension, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> content</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (extension == <span class="hljs-string"><span class="hljs-string">".css"</span></span>) { ‚Ä¶ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (extension == <span class="hljs-string"><span class="hljs-string">".js"</span></span>) { ‚Ä¶ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_htmlExt.Contains(extension.ToLowerInvariant())){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlMinificationSettings { RemoveOptionalEndTags = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, AttributeQuotesRemovalMode = HtmlAttributeQuotesRemovalMode.KeepQuotes }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> minifier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlMinifier(settings); MarkupMinificationResult result = minifier.Minify(content, generateStatistics: <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.Errors.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { EditorExtensionsPackage.DTE.StatusBar.Text = <span class="hljs-string"><span class="hljs-string">"Web Essentials: HTML minified by "</span></span> + result.Statistics.SavedInPercent + <span class="hljs-string"><span class="hljs-string">"%"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.MinifiedContent; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { EditorExtensionsPackage.DTE.StatusBar.Text = <span class="hljs-string"><span class="hljs-string">"Web Essentials: Cannot minify the current selection"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> content; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } ‚Ä¶ } }</code> </pre> <br>  From the code above, you can see that HTML minimization is performed using an instance of the <code>HtmlMinifier</code> class, which was created with secure settings (it is forbidden to remove quotes from attributes and delete optional end tags).  Since the JS and CSS minimizers are not explicitly transmitted through the <code>HtmlMinifier</code> class constructor, the minimizer based on <a href="http://www.crockford.com/javascript/jsmin.html">JSMin</a> Douglas Crockford will be used to minimize the embedded JS code, and the minimizer based on <a href="http://madskristensen.net/post/Efficient-stylesheet-minification-in-C.aspx">Efficient stylesheet minifier</a> Mads Christensen will be used for the embedded CSS code. <br><br>  And at the end of the article I will try to clarify some non-obvious points related to HTML minimization in Web Essentials: <br><ol><li>  Unlike JavaScript and CSS, it is not yet possible to minimize HTML files directly from <strong>Solution Explorer</strong> (only minimization is available through an HTML editor). </li><li>  The current version of WebMarkupMin cannot correctly handle constructions of the form <code>{{‚Ä¶}}</code> , which are commonly used in the views of Handlebars, <a href="http://mustache.github.io/">Mustache</a> , <a href="http://github.com/BorisMoore/jsrender">JsRender,</a> and <a href="http://twitter.github.io/hogan.js/">Hogan.js</a> .  Therefore, it is recommended to use HTML minimization, only for regular HTML files and KnockoutJS views. </li><li>  When minimizing the contents of the &lt;script&gt; and &lt;style&gt; tags, you need to select not only the content, but also the tags themselves. </li></ol><br>  For more information about WebMarkupMin, you can read in my article <a href="http://taritsyn.wordpress.com/2013/04/26/webmarkupmin-html-minifier-sovremennyj-html-minimizator-dlja-platformy-net/">"WebMarkupMin HTML Minifier - a modern HTML minimizer for the .NET platform</a> . <a href="http://taritsyn.wordpress.com/2013/04/26/webmarkupmin-html-minifier-sovremennyj-html-minimizator-dlja-platformy-net/">"</a> <br><br><h2>  Links </h2><br><ol><li>  The official site of the VS-extensions <a href="http://vswebessentials.com/">Web Essentials</a> </li><li>  Mads Christensen <a href="http://channel9.msdn.com/Events/Build/2013/3-503">'s</a> video report <a href="http://channel9.msdn.com/Events/Build/2013/3-503">"Visual Studio 2013 for Web Developers: Deep Dive"</a> from the // build / 2013 conference (held from June 26 to June 28, 2013) </li><li>  Mads Christensen <a href="http://www.asp.net/visual-studio/overview/2013/visual-studio-2013-web-editor-features-html-editor">'s</a> video report <a href="http://www.asp.net/visual-studio/overview/2013/visual-studio-2013-web-editor-features-html-editor">"Visual Studio 2013 Web Editor Features - HTML Editor"</a> </li><li>  Article Mads Christensen <a href="http://madskristensen.net/post/my-road-to-visual-studio-2013">"My road to Visual Studio 2013"</a> </li><li>  Article by Mads Christensen <a href="http://madskristensen.net/post/open-static-html-files-in-the-visual-studio-2013-designer">"Open static HTML files in the Visual Studio 2013 designer"</a> </li><li>  Application <a href="http://webessentials.uservoice.com/forums/140520-general/suggestions/4148941-add-option-to-minify-static-html-and-xml-files-by-">‚ÄúAdd option to minify static HTML and XML files by the WebMarkupMin‚Äù</a> on UserVoice website </li><li>  <a href="http://webmarkupmin.codeplex.com/">WebMarkupMin</a> project <a href="http://webmarkupmin.codeplex.com/">page</a> on CodePlex </li><li>  My article <a href="http://taritsyn.wordpress.com/2013/04/26/webmarkupmin-html-minifier-sovremennyj-html-minimizator-dlja-platformy-net/">"WebMarkupMin HTML Minifier - modern HTML minimizer for the .NET platform"</a> </li></ol><br>  <strong>UPD1:</strong> In the main text of the article, I did not tell about one interesting feature of the new HTML editor - de-minimization (thanks to Alexander Chernikov for <a href="https://habr.com/ru/post/199206/">his comment</a> ).  De-minimization (un-minification or beautification) is an inverse minimization operation that makes the code readable (by adding line breaks and indents).  To de-optimize a selected fragment or the entire document code, select the <strong>Un-minify</strong> command in the context menu of the HTML editor (Fig. 4). <br><br> <a href="" title="Open full image"><img src="https://habrastorage.org/getpro/habr/post_images/e81/818/15a/e8181815af19d66e8c31e9d7532eb528.png" width="800" height="504"></a> <br><br>  <strong>Figure 4.</strong> HTML code fragment before deminimization. <br><br> <a href="" title="Open full image"><img src="https://habrastorage.org/getpro/habr/post_images/cd3/1f7/d72/cd31f7d7247fbeac57dcf0c979cb55a9.png" width="800" height="504"></a> <br><br>  <strong>Fig.</strong>  <strong>5.</strong> A fragment of HTML-code after deminimization. <br><br>  It is also worth noting that HTML de-minimization, in contrast to minimization, is an opportunity for the studio, not Web Essentials. <br></div><p>Source: <a href="https://habr.com/ru/post/199206/">https://habr.com/ru/post/199206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../199196/index.html">High-performance SUN / ONCRPC server on Java NIO</a></li>
<li><a href="../199198/index.html">Kaspersky rebelled</a></li>
<li><a href="../199200/index.html">The path from idea to layout. Thinking about product concept</a></li>
<li><a href="../199202/index.html">Cooking NSA SELinux</a></li>
<li><a href="../199204/index.html">Site UploaderTalk turned out to be an anti-piracy trap</a></li>
<li><a href="../199210/index.html">Some interesting and useful things for a web developer (release 7)</a></li>
<li><a href="../199212/index.html">Interview with C # legend Eric Lippert</a></li>
<li><a href="../199218/index.html">IvBit Conference Report</a></li>
<li><a href="../199220/index.html">MicroXperts U400-06. Aluminum Ultrabook Review</a></li>
<li><a href="../199222/index.html">Where does hard drive space disappear in Mac OS X</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>