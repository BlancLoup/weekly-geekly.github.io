<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Blockchain on Go. Part 1: Prototype</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Content 


1. Blockchain on Go. Part 1: Prototype 
2. Blockchain on Go. Part 2: Proof-of-Work 
3. Blockchain on Go. Part 3: Permanent Memory and Comma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Blockchain on Go. Part 1: Prototype</h1><div class="post__text post__text-html js-mediator-article"><p>  Content </p><br><ol><li>  <strong>Blockchain on Go.</strong>  <strong>Part 1: Prototype</strong> </li><li>  <a href="https://habrahabr.ru/post/350804/">Blockchain on Go.</a>  <a href="https://habrahabr.ru/post/350804/">Part 2: Proof-of-Work</a> </li><li>  <a href="https://habrahabr.ru/post/351296/">Blockchain on Go.</a>  <a href="https://habrahabr.ru/post/351296/">Part 3: Permanent Memory and Command Line Interface</a> </li><li>  <a href="https://habrahabr.ru/post/351752/">Blockchain on Go.</a>  <a href="https://habrahabr.ru/post/351752/">Part 4: Transactions, Part 1</a> </li><li>  Blockchain on Go.  Part 5: Addresses </li><li>  Blockchain on Go.  Part 6: Transactions, Part 2 </li><li>  Blockchain on Go.  Part 7: Network </li></ol><br><p>  Blockchain is one of the most revolutionary technologies of the 21st century, which has not yet realized its full potential.  In essence, a blockchain is simply a distributed database.  What makes it unique?  This database is fully open and is stored for each participant in full or partial copy.  A new record is created only with the consent of all those who keep the database.  Because of this, there are such things as cryptocurrency and smart contracts. </p><br><p>  In this series of lessons we will create, based on the blockchain, a simplified cryptocurrency.  We use Go as the language. </p><a name="habracut"></a><br><h3 id="blok">  Block </h3><br><p>  Let's start with the "block" part of the "blockchain".  In the blockchain, blocks store useful information.  For example, in bitcoin, blocks store transactions, the essence of any cryptocurrency.  In addition to useful information, the block contains service information: version, creation date in the form of timestamp and the hash of the previous block.  In this article we will create a simplified block containing only essential information.  We describe it in the form of a go structure. </p><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Block <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Timestamp <span class="hljs-keyword"><span class="hljs-keyword">int64</span></span> Data []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> PrevBlockHash []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> Hash []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> }</code> </pre> <br><p>  <code>Timestamp</code> is the block creation time, <code>Data</code> is useful information contained in the block, <code>PrevBlockHash</code> stores the hash of the previous block, and finally, <code>Hash</code> contains the hash of the block.  In the bitcoin <code>Timestamp</code> specification, <code>PrevBlockHash</code> and <code>Hash</code> form a block header and form a separate structure from transactions (in our case, it is <code>Data</code> ).  We mixed them for simplicity. </p><br><p>  How is hashes calculated?  Calculation of hashes is one of the important features of the blockchain, thanks to him it is considered safe.  This is because the calculation of the hash is a rather complicated operation (this is why miners bought powerful video cards for bitcoin mining).  This was conceived on purpose, preventing change from the whole chain. </p><br><p>  We will discuss this in the next article, and now we will simply connect all the fields of the block and cache the result in SHA-256: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b *Block)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetHash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { timestamp := []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(strconv.FormatInt(b.Timestamp, <span class="hljs-number"><span class="hljs-number">10</span></span>)) headers := bytes.Join([][]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>{b.PrevBlockHash, b.Data, timestamp}, []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>{}) hash := sha256.Sum256(headers) b.Hash = hash[:] }</code> </pre> <br><p>  Next, create a ‚Äúconstructor‚Äù for our block. </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, prevBlockHash []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Block</span></span></span></span> { block := &amp;Block{time.Now().Unix(), []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(data), prevBlockHash, []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>{}} block.SetHash() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> block }</code> </pre> <br><p>  Block ready! </p><br><h3 id="blokcheyn">  Blockchain </h3><br><p>  Now let's write a blockchain.  In essence, a blockchain is a database of a certain structure: an ordered linked list.  This means that the blocks are stored in the order of insertion, with each block associated with the previous one.  This structure allows you to get the last block in the chain and effectively get the block by its hash. </p><br><p>  In Golang, this structure can be implemented using an array (array) and maps (map): an array will contain an ordered list of hashes (arrays are ordered in Go), and maps will store <code>hash -&gt; block</code> pairs (maps are not ordered).  But for our prototype, we will use only arrays because we do not need to get a block by its hash. </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Blockchain <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { blocks []*Block }</code> </pre> <br><p>  This is our first blockchain!  I never thought it was that easy :) </p><br><p>  Add the ability to add blocks to it. </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bc *Blockchain)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { prevBlock := bc.blocks[<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(bc.blocks)<span class="hljs-number"><span class="hljs-number">-1</span></span>] newBlock := NewBlock(data, prevBlock.Hash) bc.blocks = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>(bc.blocks, newBlock) }</code> </pre> <br><p>  To add the first block, we need an existing one, but our blockchain is empty!  Thus, we should have at least one block in any blockchain, which is called the <code>genesis</code> block.  We implement a method that creates such a block. </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewGenesisBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Block</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NewBlock(<span class="hljs-string"><span class="hljs-string">"Genesis Block"</span></span>, []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>{}) }</code> </pre> <br><p>  And now let's implement the function that creates the blockchain with the <code>genesis</code> block. </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewBlockchain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Blockchain</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;Blockchain{[]*Block{NewGenesisBlock()}} }</code> </pre> <br><p>  Let's check that the blockchain is working correctly. </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { bc := NewBlockchain() bc.AddBlock(<span class="hljs-string"><span class="hljs-string">"Send 1 BTC to Ivan"</span></span>) bc.AddBlock(<span class="hljs-string"><span class="hljs-string">"Send 2 more BTC to Ivan"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, block := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> bc.blocks { fmt.Printf(<span class="hljs-string"><span class="hljs-string">"Prev. hash: %x\n"</span></span>, block.PrevBlockHash) fmt.Printf(<span class="hljs-string"><span class="hljs-string">"Data: %s\n"</span></span>, block.Data) fmt.Printf(<span class="hljs-string"><span class="hljs-string">"Hash: %x\n"</span></span>, block.Hash) fmt.Println() } }</code> </pre> <br><p>  This code will output </p><br><pre> <code class="hljs bash">Prev. <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>: Data: Genesis Block Hash: aff955a50dc6cd2abfe81b8849eab15f99ed1dc333d38487024223b5fe0f1168 Prev. <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>: aff955a50dc6cd2abfe81b8849eab15f99ed1dc333d38487024223b5fe0f1168 Data: Send 1 BTC to Ivan Hash: d75ce22a840abb9b4e8fc3b60767c4ba3f46a0432d3ea15b71aef9fde6a314e1 Prev. <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>: d75ce22a840abb9b4e8fc3b60767c4ba3f46a0432d3ea15b71aef9fde6a314e1 Data: Send 2 more BTC to Ivan Hash: 561237522bb7fcfbccbc6fe0e98bbbde7427ffe01c6fb223f7562288ca2295d1</code> </pre> <br><p>  Our prototype works! </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  We have just built a very simple blockchain prototype: a simple array of blocks, each of which is associated with the previous one.  This blockchain is much more complicated.  Our blockchain adds new blocks very easily and quickly, but in a real blockchain, adding new blocks requires some work: performing complex calculations before getting the right to add blocks (this mechanism is called Prof-of-Work).  In addition, the blockchain is a distributed base that does not have a single decision-making center.  Thus, the new block must be confirmed and approved by other members of the network (this mechanism is called <code></code> ).  Well, actually we do not yet have the transactions themselves. </p><br><p>  All these properties will be covered in future articles. </p><br><h3 id="ssylki">  Links </h3><br><p>  <a href="https://github.com/Jeiwan/blockchain_go/tree/part_1">The source code for the article</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/348672/">https://habr.com/ru/post/348672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348662/index.html">Magical 90%. What are we talking about when we talk about performance?</a></li>
<li><a href="../348664/index.html">Animations in Android on the shelves (Part 3. "Low-level" animation)</a></li>
<li><a href="../348666/index.html">Work and life in Bulgaria - 3. Interviews, visa, working moments</a></li>
<li><a href="../348668/index.html">How to raise a project for PHP in Docker under Windows</a></li>
<li><a href="../348670/index.html">How to stop spending a lot of time shopping?</a></li>
<li><a href="../348674/index.html">When work is your second family</a></li>
<li><a href="../348676/index.html">Cluster of Puppets: Amazon ECS Experience with iFunny</a></li>
<li><a href="../348678/index.html">IT events digest for February and March</a></li>
<li><a href="../348680/index.html">Learning to intercept unprocessed messages or an example of how SObjectizer is cluttered with new features ...</a></li>
<li><a href="../348682/index.html">Deploy your Java environment with Ansible</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>