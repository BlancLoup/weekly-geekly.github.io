<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How GZIP compression works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the life of every man, a moment comes when traffic grows and a server dies, you need to think about optimization. The latest PHP digest ( No. 40 ) ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How GZIP compression works</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/636/905/8bd/6369058bdc9de21d6b32b79f82f5f9ae.png" alt="image" align="right">  In the life of every man, a moment comes when traffic grows and a <s>server dies,</s> you need to think about optimization.  The latest PHP digest ( <a href="http://habrahabr.ru/company/zfort/blog/220995/">No. 40</a> ) referred to the article ‚ÄúHow GZIP Compression Works‚Äù.  Based on <a href="http://w3techs.com/technologies/details/ce-gzipcompression/all/all">statistics</a> , 56% of websites use GZIP.  I hope this article will reveal to the reader the merits of this technology. <br><a name="habracut"></a><br><br>  <i>Errors are possible in the text (I did the proofreading several times, but still suddenly), so I apologize in advance and ask you to inform me about all the problems through personal messages if some part of the translation seems to be incorrect.</i> <br><br>  Even in the modern world, with a high-speed Internet connection and unlimited data storages, data compression is still relevant, especially for mobile devices and countries with a slow Internet connection.  This post describes a de facto lossless compression method for compressing textual data on websites: GZIP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Gzip compression </h4><br>  GZIP provides lossless compression, in other words, the original data can be fully restored when unpacking.  It is based on the DEFLATE algorithm, which uses a combination of the LZ77 algorithm and the Huffman algorithm. <br><br><h5>  LZ77 algorithm </h5><br>  The LZ77 algorithm replaces repeated data entries with ‚Äúlinks‚Äù.  <i>Those.</i>  <i>if in the available data some chain of elements occurs more than once, then all its subsequent entries are replaced by ‚Äúlinks‚Äù to its first instance.</i>  <i>The algorithm is perfectly reviewed by <a href="https://habrahabr.ru/users/horror_x/" class="user_link">horror_x</a> and is described <a href="http://habrahabr.ru/post/141827/">here</a></i> .  Each such link has two values: offset and length. <br><br>  Let's look at an example: <br><blockquote>  Original text: "ServerGrove, the PHP hosting company, provides hosting solutions for PHP projects" (81 bytes) <br>  LZ77: ‚ÄúServerGrove, the PHP hosting company, p &lt;3.32&gt; ides &lt;9.26&gt; solutions for &lt;5.52&gt; &lt;3.35&gt; jects‚Äù (73 bytes, assuming that each reference is 3 bytes) </blockquote><br><br>  As you can see, the words ‚Äúhosting‚Äù and ‚ÄúPHP‚Äù are repeated, so the second time the substring is found, it will be replaced with a link.  There are other coincidences, such as "er", but since  this is insignificant <i>(in this case, ‚Äúer‚Äù is missing in other words)</i> , the original text remains. <br><br><h5>  Huffman coding </h5><br>  Huffman coding is a variable length coding method that assigns shorter codes to more frequent ‚Äúcharacters‚Äù.  The problem with variable code length is usually that we need a way to find out when the code has ended and a new one started to decrypt it. <br><br>  Huffman coding solves this problem by creating a prefix code where no codeword is the prefix of another.  This can be better understood by example: <br><br><blockquote>  &gt; Original text: ServerGrove <br>  ASCII codification: "01010011 01100101 01110010 01110110 01100101 01110010 01000111 01110010 01101111 01110110 01100101" (88 bits) </blockquote><br>  ASCII is a fixed-length character encoding system, so the letter ‚Äúe‚Äù, which is repeated three times and is also the most frequently encountered letter in English, is the same size as the letter ‚ÄúG‚Äù, which appears only once.  Using this statistical information, Huffman can create the most optimized system. <br><br><blockquote>  Huffman: "1110 00 01 10 00 01 1111 01 110 10 00" (27 bits) </blockquote><br>  The Huffman method allows us to get shorter codes for ‚Äúe‚Äù, ‚Äúr‚Äù and ‚Äúv‚Äù, while ‚ÄúS‚Äù and ‚ÄúG‚Äù are longer.  The explanations of how to use the Huffman method are beyond the scope of this post, but if you are interested, I recommend you to read the excellent video on <a href="https://www.youtube.com/watch%3Fv%3DumTbivyJoiI">Computerphile</a> <i>(or an article on <a href="http://habrahabr.ru/post/144200/">Harbe</a> )</i> . <br><br>  DEFLATE as an algorithm used in GZIP compression is a combination of both of these algorithms. <br><br><h5>  Is gzip the best compression method? </h5><br>  The answer is no.  There are other methods that give higher compression rates, but there are several good reasons to use this. <br><br>  Firstly, even though GZIP is not the best compression method, it provides a good compromise between speed and compression ratio.  Compression and decompression of a GZIP occur quickly and the compression ratio is high. <br>  Secondly, it is not easy to implement a new global data compression method that everyone can use.  Browsers will need an update, which is now much easier due to auto-update.  However, browsers are not the only problem.  Chromium tried to add support for BZIP2, a better method based on the Burrows-Wheeler transformation, but had to be abandoned because  Some intermediate proxy servers distorted data because  could not recognize the bzip2 headers and tried to process gzip content.  A bug report is available <a href="https://code.google.com/p/chromium/issues/detail%3Fid%3D14801">here</a> . <br><br><h5>  Gzip + http </h5><br>  The process of obtaining compressed content between the client (browser) and the server is quite simple.  If the browser has support for GZIP / DEFLATE, it lets the server understand this through the ‚ÄúAccept-Encoding‚Äù header.  Then, the server can choose to send the content in compressed or original form. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/54e/e0a/728/54ee0a7284c53b8bd841551e189aad4d.png"></div><br><br><h5>  Implementation </h5><br>  The DEFLATE specification provides some freedom for developers to implement an algorithm using various approaches, as long as the resulting stream is compatible with the specification. <br><br><h6>  GNU GZIP </h6><br>  The GNU implementation is the most common and was designed to be a replacement for the archiving utility, free from proprietary algorithms.  To compress a file using the GNU GZIP utility: <br><blockquote>  $ gzip -c file.txt&gt; file.txt.gz </blockquote><br>  There are 9 compression levels, from ‚Äú1‚Äù (the fastest with the lowest compression ratio) to ‚Äú9‚Äù (the slowest with the best compression ratio).  By default, "6" is used.  If you need maximum compression at the expense of using more memory and time, use the "-9" (or "-best") flag: <br><blockquote>  $ gzip -9 -c file.txt&gt; file.txt.gz </blockquote><br><br><h6>  7-zip </h6><br>  7-zip implements the DELFATE algorithm differently and usually archives with <b>a</b> higher compression ratio.  To maximize file compression: <br><blockquote>  7z a -mx9 file.txt.gz file.txt </blockquote><br>  7-zip is also available for Windows and provides an implementation for other compression methods such as 7z, xz, bzip2, zip, and others. <br><br><h6>  Zopfli </h6><br>  Zopfli is ideal for one-time compression, for example in situations where a file is once compressed and reusable.  It is 100 times slower, but compression is 5% better than others.  <a href="http://habrahabr.ru/post/171181/">Habrapost</a> . <br><br><h5>  Enable GZIP </h5><br><h6>  Apache </h6><br>  The <a href="httpd.apache.org/docs/2.2/mod/mod_deflate.html">mod_deflate</a> module provides support for GZIP, so that the server‚Äôs response is compressed on the fly before it is transmitted to the client via the network.  To enable text file compression, you need to add .htaccess lines: <br><blockquote>  AddOutputFilterByType DEFLATE text / plain <br>  AddOutputFilterByType DEFLATE text / html <br>  AddOutputFilterByType DEFLATE text / xml <br>  AddOutputFilterByType DEFLATE text / css <br>  AddOutputFilterByType DEFLATE application / xml <br>  AddOutputFilterByType DEFLATE application / xhtml + xml <br>  AddOutputFilterByType DEFLATE application / rss + xml <br>  AddOutputFilterByType DEFLATE application / javascript <br>  AddOutputFilterByType DEFLATE application / x-javascript </blockquote><br><br>  There are several known bugs in some versions of browsers, for this reason it is recommended * to also add: <br><blockquote>  BrowserMatch ^ Mozilla / 4 gzip-only-text / html <br>  BrowserMatch ^ Mozilla / 4 \ .0 [678] no-gzip <br>  BrowserMatch \ bMSIE! No-gzip! Gzip-only-text / html <br>  Header append Vary User-Agent </blockquote>  <i>* this decision is currently no longer relevant, like the above browsers, so this information can be taken for informational purposes.</i> <br><br>  In addition, you can use pre-compressed files instead of compressing them every time.  This is especially useful for files that do not change with every request, such as CSS and JavaScript, which can be compressed using slow algorithms.  For this: <br><blockquote>  RewriteEngine On <br>  AddEncoding gzip .gz <br>  RewriteCond% {HTTP: Accept-encoding} gzip <br>  RewriteCond% {REQUEST_FILENAME} .gz -f <br>  RewriteRule ^ (. *) $ $ 1.gz [QSA, L] <br></blockquote><br>  This makes Apache understand that files with the .gz extension must be compressed (line 2), you need to check the availability of the browser accepting gzip (line 3), and if the compressed file exists (line 4), we add .gz for the requested file. <br><br><h6>  Nginx </h6><br>  The <a href="http_gzip_module.html">ngx_http_gzip_module</a> module allows you to compress files using GZIP on the fly, while the <a href="http_gzip_static_module.html">ngx_http_gzip_static_module</a> module allows you to send pre-compressed files with the ‚Äú.gz‚Äù extension instead of the usual ones. <br>  An example configuration looks like this: <br><blockquote>  gzip on; <br>  gzip_min_length 1000; <br>  gzip_types text / plain application / xml; </blockquote><br><br><h5>  Gzip + php </h5><br>  Although it is usually not recommended to compress data using PHP, since it is rather slow, it can be done using the <a href="http://www.php.net/manual/en/intro.zlib.php">zlib</a> module.  For example, we use the maximum compression on the jQuery.min library: <br><br><pre><code class="php hljs">$originalFile = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/jquery-1.11.0.min.js'</span></span>; $gzipFile = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/jquery-1.11.0.min.js.gz'</span></span>; $originalData = file_get_contents($originalFile); $gzipData = gzencode($originalData, <span class="hljs-number"><span class="hljs-number">9</span></span>); file_put_contents($gzipFile, $gzipData); var_dump(filesize($originalFile)); <span class="hljs-comment"><span class="hljs-comment">// int(96380) var_dump(filesize($gzipFile)); // int(33305)</span></span></code> </pre> <br><br><h5>  Instead of output (translator's note) </h5><br>  Despite the fact that itching to add the author‚Äôs own explanations of the algorithms, statistics and the results of comparison tests to the author‚Äôs article, the translation was carried out <i>practically</i> without interference from the translator.  <a href="http://blog.servergrove.com/2014/04/14/gzip-compression-works/">The article was translated</a> with the permission of the author and the ServerGrove portal. </div><p>Source: <a href="https://habr.com/ru/post/221849/">https://habr.com/ru/post/221849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../221837/index.html">Private solution of the general problem of electrostatics</a></li>
<li><a href="../221839/index.html">USB hardware module in ATXMega. HID Implementation Guide</a></li>
<li><a href="../221843/index.html">Safe dynamic update of DNS records in the Windows domain from Linux (GSS-TSIG)</a></li>
<li><a href="../221845/index.html">Design Conference "DESIGN LAB"</a></li>
<li><a href="../221847/index.html">Plywood monitor from an old laptop</a></li>
<li><a href="../221851/index.html">Lists with different item types and different data providers</a></li>
<li><a href="../221853/index.html">Automatic text category detection</a></li>
<li><a href="../221855/index.html">Serious games</a></li>
<li><a href="../221857/index.html">PKI (Public Key Infrastructure) using javascript? This is now possible using the PKIjs and ASN1js libraries.</a></li>
<li><a href="../221859/index.html">May 16, a seminar on sales of storage systems will start - ‚ÄúStorage technology and systems for SMB customers‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>