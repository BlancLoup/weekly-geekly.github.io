<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kama Sutra with Worksheet and Range objects in Excel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Doing search queries ‚Äúdelphi excel range‚Äù over and over again, I found tremendous poverty, stupidity and unprincipledness of the proposed examples of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kama Sutra with Worksheet and Range objects in Excel</h1><div class="post__text post__text-html js-mediator-article">  Doing search queries ‚Äúdelphi excel range‚Äù over and over again, I found tremendous poverty, stupidity and unprincipledness of the proposed examples of ready-made program code.  At best, we are talking about a couple-three operations of outputting to an arbitrary cell, all sorts of nuances such as formatting and access to Excel objects can be ... not something to forget.  The authors offer to transfer the code generated by recording the macro, taking into account the Delphi syntax, into the application code that prints the report.  Moreover, in most of the examples, late binding is used, which hides some of the most terrible moments of the transfer, but this code works far from identical to the code on VBA and far from all operations are processed properly.  As a result, we get unnecessarily cumbersome source code, compiled only under a certain version of Delphi / RAD Studio and working only with a certain version of the Office. <br><a name="habracut"></a><br>  Who has not encountered such a design, parsing other people's sources? <br><br><pre><code class="delphi hljs">Worksheet.Range[Worksheet.Cells[i, <span class="hljs-number"><span class="hljs-number">1</span></span>], Worksheet.Cells[i, MaxCols]].MergeCells := True; Worksheet.Range[Worksheet.Cells[i, <span class="hljs-number"><span class="hljs-number">1</span></span>], Worksheet.Cells[i, MaxCols]].HorizontalAlignment := xlCenter; Worksheet.Range[Worksheet.Cells[i, <span class="hljs-number"><span class="hljs-number">1</span></span>], Worksheet.Cells[i, MaxCols]].VerticalAlignment := xlCenter; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j := <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> MaxCols <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Worksheet.Cells[i + <span class="hljs-number"><span class="hljs-number">1</span></span>, j].Value := j;</code> </pre> <br>  In this case, in a certain cycle, line by line are combined and aligned in the center of the cell from column A to MaxCols and in the next line the numbers of the columns are printed.  And it seems like it works sometimes, and sometimes it does not work.  For me, for example, the cells are combined, and alignment causes an error.  And the cells are allocated strictly this way in any example.  And what if the wrong Worksheet gets into the Range parameters?  And what if we still have 100,500 operations to do with this range? <br><br>  Sometimes it is saved, of course, <b>with the</b> construction, but it is also not perfect.  Alignment in it still does not work.  And not in all languages ‚Äã‚Äãit is available.  The roots of evil lie in the matrix addressing of cells and in late binding.  Rewrite the code for early binding: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="delphi hljs">Worksheet.Range[Worksheet.Cells.Item[i, <span class="hljs-number"><span class="hljs-number">1</span></span>], Worksheet.Cells.Item[i, MaxCols]].MergeCells := True; Worksheet.Range[Worksheet.Cells.Item[i, <span class="hljs-number"><span class="hljs-number">1</span></span>], Worksheet.Cells.Item[i, MaxCols]].HorizontalAlignment := xlCenter; Worksheet.Range[Worksheet.Cells.Item[i, <span class="hljs-number"><span class="hljs-number">1</span></span>], Worksheet.Cells.Item[i, MaxCols]].VerticalAlignment := xlCenter; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j := <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> MaxCols <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Worksheet.Cells.Item[i + <span class="hljs-number"><span class="hljs-number">1</span></span>, j].Value[xlRangeValueDefault] := j;</code> </pre><br>  The nightmare continues.  Added ugly .Item.  However, the alignment worked.  Okay, let's not talk about sad things.  The real report building on Excel from Delphi opens when you get to know the Range object, or rather its Resize and Offset properties.  Our piece of code turns into a rather elegant: <br><br><pre> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">//   Range := Worksheet.Cells.Item[i, 1].Resize[1, MaxCols],    :( Range := Worksheet.Range[Worksheet.Cells.Item[i, 1], EmptyParam].Resize[1, MaxCols]; Range.MergeCells := True; Range.HorizontalAlignment := xlCenter; Range.VerticalAlignment := xlCenter; Range := Range.Resize[1, 1]; for j := 1 to MaxCols do Range.Offset[1, j - 1].Value2 := j;</span></span></code> </pre><br>  For those who want to experiment, I also suggest the option of auto-filling cells: <br><br><pre> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">//   for: Range := Range.Offset[1, 0].Resize[1, 1]; Range.Value2 := 1; Range.AutoFill(Range.Resize[1, MaxCols], xlFillSeries);</span></span></code> </pre><br>  Well, in order not to bother with wrapping Worksheet.Cells.Item in Worksheet.Range, you should consider creating a report template with named ranges.  This will also save on software code formatting.  But about it - next time. </div><p>Source: <a href="https://habr.com/ru/post/255057/">https://habr.com/ru/post/255057/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255047/index.html">We collect your own smartphone</a></li>
<li><a href="../255049/index.html">Life hacking: How to combine two different commands in the Slack messenger</a></li>
<li><a href="../255051/index.html">Search for images in Android using Flickr</a></li>
<li><a href="../255053/index.html">MOOC Video Studio</a></li>
<li><a href="../255055/index.html">How I decided to go to game dev</a></li>
<li><a href="../255061/index.html">The challenge of two old ladies who hit the road at dawn</a></li>
<li><a href="../255067/index.html">Class about deadlock classes</a></li>
<li><a href="../255069/index.html">Krovi: Big Data - as dream. 4th series. Brain revolution</a></li>
<li><a href="../255071/index.html">Again about reputation, or how not to become a mediator in spamming</a></li>
<li><a href="../255073/index.html">Analysis of the natural language: grammatical notation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>