<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Operation TaskMasters: how we exposed the cyber grouping, the attacking organizations of Russia and the CIS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Image: Unsplash 

 In the autumn of 2018, experts of PT Expert Security Center revealed the activity of a criminal gang, whose activities were aimed a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Operation TaskMasters: how we exposed the cyber grouping, the attacking organizations of Russia and the CIS</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habr.com/ru/company/pt/blog/451566/"><img src="https://habrastorage.org/webt/lz/hs/uj/lzhsujgy5_y3llxp6xwz38yycfe.png"></a> <br><br>  <i>Image: <a href="https://unsplash.com/photos/FCrYdP8gohg">Unsplash</a></i> <br><br>  In the autumn of 2018, experts of PT Expert Security Center revealed the activity of a criminal gang, whose activities were aimed at the theft of confidential documents and espionage.  Today we will talk about the progress of the investigation, as well as describe the main methods and tools used by the group. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Note</i> : The link provides a <a href="https://www.ptsecurity.com/ru-ru/research/analytics/operation-taskmasters-2019/">full</a> investigation <a href="https://www.ptsecurity.com/ru-ru/research/analytics/operation-taskmasters-2019/">report</a> .  It also provides indicators of compromise, which can be used to identify signs of attack. <a name="habracut"></a><br><br><h2>  Who is attacked by the group, and when it is discovered </h2><br>  The group was identified by experts of PT Expert Security Center in 2018.  The criminals used an unusual method of consolidation in the infrastructure, based on the creation of specific tasks (tasks) in the task scheduler - that's why PT ESC experts called TaskMasters grouping. <br><br>  Task Scheduler allows you to run OS commands and run software at a specific point in time specified in the task.  Moreover, the AtNow scheduler used by this grouping allows you to perform tasks not only locally, but also on remote computers on the network, and do this regardless of the time settings of these nodes.  In addition, this utility does not require installation.  These features simplify attack automation. <br><br>  Hackers hacked companies from different countries, with a significant number of victims in Russia and the CIS.  Most of the attacked companies can be attributed to industry.  In total, we are aware of the compromise of more than 30 organizations of various industries, including the energy and oil and gas sectors and government bodies. <br><br>  The main purpose of the group is the theft of confidential information.  Attackers are trying to gain a foothold in the corporate information system for a long time and get access to key servers of the company, workstations of the top management, and critical business systems. <br><br>  The earliest traces of the presence of groups in the infrastructure were dated 2010, and at that time the criminals were already in full control of some servers and workstations, which means penetration occurred much earlier. <br><br><h2>  Asian footprint </h2><br>  The code on the GitHub of the ASPXSpy2014 web shell, which was used during the attack, contains links to Chinese developers.  However, the version we found contains instead a link to google.com. <br><br><img src="https://habrastorage.org/webt/ag/oh/va/agohvad709ucmllwefycordfjhw.png"><br><br>  <i>ASPXSpy: public and attackable versions</i> <br><br>  In requests to web shells, IP addresses belonging to a hosting provider and a print shop in Eastern Europe were identified.  But the events of the proxy log of one of the attacked organizations reflected the moment when the attackers switched to the Chinese resident IP address 115.171.23.103, which most likely happened due to the disabling of the VPN software at the time of the attack. <br><br>  During the attack, the attackers used a copy of the WinRAR archiver, which was activated by a key that is widely used in forums where users communicate in Chinese. <br><br><img src="https://habrastorage.org/webt/5d/tg/eh/5dtgeh4xjibopstd7zh6altqxas.png"><br><br>  <i>Licensed version of WinRAR in software resources</i> <br><br><img src="https://habrastorage.org/webt/dc/qs/as/dcqsas2b1wfkqble9g_pntsvbcc.png"><br><br>  <i>WinRAR license key published on Chinese forums</i> <br><br>  In one of the tasks used domain Brengkolang.com, registered through the Chinese registrar.  Also, many utilities contain error messages and other debug information written in English with errors, which may indicate that it is not native to developers. <br><br><h2>  How do attackers </h2><br>  The overall attack vector is quite predictable.  After penetrating the local network, attackers investigate the infrastructure, exploit system vulnerabilities (for example, <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-0176">CVE-2017-0176</a> ), then upload to compromised nodes and unpack a set of utilities.  With this set, they search, copy and archive files of interest to them, and then send them to management servers. <br><br>  To move around the network, criminals execute system commands on remote nodes using the AtNow utility, which allows you to run software and execute commands after a specified time interval.  To manage the nodes use small backdoors, through which they connect to the control servers.  At the same time, there are backup channels in the form of web shells uploaded to external resources, for example, to the Exchange server. <br><br><img src="https://habrastorage.org/webt/_t/4n/wv/_t4nwviraqyi6_wd43biwwuovt8.png"><br><br>  <i>Attack pattern</i> <br><br>  The group uses the Dynamic DNS infrastructure for their domains.  Malefactors use the big set of utilities and tools for carrying out cyber attacks and actively apply the supply chain attack scheme. <br><br>  To scan the network and compromise systems, attackers use free software (including NBTScan, PWDump, Mimikatz).  In addition to third-party tools, applied and proprietary programs. <br><br>  The main TaskMasters grouping software, through which they controlled infected nodes, consists of two components: <br><br><ul><li>  RemShell Downloader - downloader, </li><li>  RemShell - software with the main set of functions. </li></ul><br>  Let us consider in more detail each of the components. <br><br><h2>  RemShell Downloader </h2><br>  This malware component is designed to deliver the main payload to the attacked system.  The general scheme of the boot loader is shown in the figure below. <br><br><img src="https://habrastorage.org/webt/wc/gq/q_/wcgqq_svfh88x9m3gxtf1qamhys.png"><br><br>  <i>RemShell bootloader operation scheme</i> <br><br>  The loader accesses the HTML page at the address pre-specified in its code, and reads the value of the Attribute attribute of the HTML tag: <br><br><img src="https://habrastorage.org/webt/of/ug/6c/ofug6cpcp-u6byrh-7ghxx7tf-a.png"><br><br>  <i>HTML sample file</i> <br><br>  Then the read value is decrypted, and depending on what was contained there, the loader either goes into standby mode (the Sleep command), or saves the PE file to disk and starts it.  The downloaded PE file is just the payload - the main RemShell trojan. <br><br><h2>  Trojan RemShell </h2><br>  RemShell, the main malware used by attackers to control infected sites, provides attackers with the following features: <br><br><ol><li>  Terminal for remote node management (cmd shell). </li><li>  Uploading files to a remote site. </li><li>  Uploading files from a remote site to the management server. </li></ol><br>  Trojan uses two control servers.  The first acts as an intermediary or proxy, which, upon the request of malware, provides the address of the main control server.  Also, a command can be received from the first controlling server for transferring malware to another controlling proxy server. <br><br><img src="https://habrastorage.org/webt/7r/pg/ll/7rpgll7b5bjlvyyljapucz_hsec.png"><br><br>  <i>Transition from the first managing server to the main</i> <br><br>  We found various variations of this malware.  In some, for example, there was no command to download files from the site to the management server - in such cases, the attackers used a proprietary utility to upload files.  In others, commands were added to get the list of processes running on the system and terminate the process by PID (process ID). <br>  Configuration data, such as the address of the controlling proxy server, the port, the user-agent, is encrypted using RC4 and given by constants in the malware code. <br><br>  The data sent between the control servers and the malware is encrypted using the RC4 algorithm and additionally encoded with Base64.  The key for RC4 is generated using a constant string by calculating the MD5 hash.  The result of executing commands received from the management server is sent as an HTTP request to a URL with a specific prefix of 1111. <br><br>  The malware also includes the Heartbeat mechanism, which at random intervals ‚Äúknocks out‚Äù with an HTTP request containing the result of the hostname command, at a given URL with a specific prefix of 0000. <br><br><img src="https://habrastorage.org/webt/ng/-j/f_/ng-jf_ivno95yki2nb0wced6ygo.png"><br><br>  <i>Heartbeat</i> <br><br><h2>  Managing Servers </h2><br>  The server part for managing malware on infected sites is represented by console ELF files.  The server management interface is designed as a shell and supports the commands shown in the figure below. <br><br><img src="https://habrastorage.org/webt/dm/zc/oy/dmzcoy-l6yk0yizsuueiksglsta.png"><br><br>  The server logs in detail all the commands sent to the remote host.  These log files are stored on the disk in encrypted form.  The RC4 algorithm is used to encrypt log files. <br><br>  We were able to analyze several instances of the server part of malware.  In one case, we found a mention of the developer AiMi, references to which we met in other tools group TaskMasters. <br><br><img src="https://habrastorage.org/webt/pv/ie/sv/pviesv3b2-pss7d6tyedpcrk1yg.png"><br><br>  <i>The mention of developers in the output of the script information</i> <br><br><h2>  Web shell 404-input-shell </h2><br>  The authorization window for accessing web shell functionality is disguised as a standard 404 IIS web server error page.  To access the command line and execute commands, you must enter a password.  The password field is hidden and displayed when you click the Back link. <br><br><img src="https://habrastorage.org/webt/q_/wv/x1/q_wvx1r71d3xebktyd7fpwl-th0.png"><br><br><pre><code class="bash hljs">Click the &lt;a href=<span class="hljs-string"><span class="hljs-string">"#"</span></span> ondblclick=<span class="hljs-string"><span class="hljs-string">"history_back()"</span></span>&gt;Back&lt;/a&gt; button to try another link.&lt;/li&gt;</code> </pre> <br>  For authorization, the attackers used the password 0p; / 9ol.  - they used the same password to encrypt archives.  The web shell code contains the MD5 hash of this password. <br><br><img src="https://habrastorage.org/webt/jg/ia/vg/jgiavgy650zj9gonqkmegfuekk8.png"><br><br>  In total, within the framework of the investigations, we discovered three modifications of this web shell.  They differ in functionality: one of them is used only for uploading files from the server, the other for uploading files to the server, the third for executing OS commands. <br><br><h2>  Conclusion </h2><br>  Our research shows that cybercriminals can pursue more than short-term financial goals.  Increasingly, they seek to gain access to data and seize control of information flows of organizations. <br><br>  Companies from various sectors of the economy can become victims of cyber espionage.  In order to understand how to defend against such attacks, you must use specialized tools.  Also at the investigation stage it is important to study in detail the tactics applied by the attackers.  It is rather difficult for organizations to solve this problem on their own, as this requires not only advanced tools, but also highly qualified information security specialists.  The implementation of recommendations received from security professionals will increase the level of infrastructure security and make it harder to break. </div><p>Source: <a href="https://habr.com/ru/post/451566/">https://habr.com/ru/post/451566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451536/index.html">The future is here: AI will control melee on American fighters</a></li>
<li><a href="../451538/index.html">Amazon Redshift Parallel Scaling Guide and Test Results</a></li>
<li><a href="../451544/index.html">Gathering of the system operators of the ‚ÄúMedium‚Äù network points in Moscow, on May 18 at 14:00 at the Patriarshie Prudy</a></li>
<li><a href="../451552/index.html">We build the network channels of sales of the gadget DO-RA</a></li>
<li><a href="../451562/index.html">How to escape from the sect?</a></li>
<li><a href="../45157/index.html">Is it appropriate to give a link to a competitor's website?</a></li>
<li><a href="../451574/index.html">We develop the utility on GraalVM</a></li>
<li><a href="../451576/index.html">The book "Our code. Craft, profession, art "</a></li>
<li><a href="../45158/index.html">Whether it is logical to advertise or link to a competitor on the site.</a></li>
<li><a href="../451580/index.html">MODX Digest # 5 (April 22 - May 13, 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>