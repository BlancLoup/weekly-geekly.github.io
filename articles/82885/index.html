<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>One firewall for IPv4 and IPv6 (iptables and ip6tables)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After IPv6 setup, the firewall setup task for the new protocol appears Below I offer my script that allows you to configure the firewall immediately f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>One firewall for IPv4 and IPv6 (iptables and ip6tables)</h1><div class="post__text post__text-html js-mediator-article">  After <a href="http://habrahabr.ru/blogs/sysadm/82397/">IPv6</a> setup, the firewall setup task for the new protocol appears  Below I offer my script that allows you to configure the firewall immediately for IPv4 and IPv6.  Although there are not so many common rules for both firewalls, it‚Äôs still more convenient for me to edit one common file than two different ones. <br><br><a name="habracut"></a><br>  We will consider the most common network with one Internet connection and one local network behind the firewall.  For a local network in IPv4, you need to do NAT, in IPv6 you need to route and filter packets. <br><br>  If you just have one computer, then removing all references to the local network will get a suitable firewall. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I do not cite any specific explanations, you just need to correct a few variables at the beginning and a few ‚Äútables‚Äù in the middle. <br><br><blockquote><code><font color="#0000ff">#!/bin/bash</font> &lt;br&gt; <br> <font color="#0000ff"># License: GPL3</font> &lt;br&gt; <br> <font color="#0000ff"># Author: Dmitri Gribenko &lt;gribozavr@gmail.com&gt;</font> &lt;br&gt; <br> &lt;br&gt; <br> <br> <font color="#008b8b">LAN_IF</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">eth0</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#008b8b">INET_IF</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">eth1</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#008b8b">INET_IP</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">192.0.2.123</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#008b8b">INET6_IF</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">he-ipv6</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <br> <font color="#0000ff"># for dynamic IPs:</font> &lt;br&gt; <br> <font color="#0000ff"># INET_IP=$(get_ip_ipv4 $INET_IF)</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#008b8b">LOOPBACK_IF</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">lo</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#008b8b">IPTABLES</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">/sbin/iptables</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#008b8b">IP6TABLES</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">/sbin/ip6tables</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <br> <font color="#0000ff">#IPTABLES="echo 4"</font> &lt;br&gt; <br> <font color="#0000ff">#IP6TABLES="echo 6"</font> &lt;br&gt; <br> <font color="#008b8b">IP</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">/sbin/ip</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># IPs that need to be NAT'ed to our $INET_IP.</font> &lt;br&gt; <br> <font color="#008b8b">NAT_IPV4</font> = <font color="#a52a2a"><b>'</b></font> &lt;br&gt; <br> <br> <font color="#ff00ff">192.168.1.3  pc1</font> &lt;br&gt; <br> <font color="#ff00ff">192.168.1.4  pc2</font> &lt;br&gt; <br> <font color="#ff00ff">192.168.1.5</font> &lt;br&gt; <br> <font color="#a52a2a"><b>'</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># Set to 0 to disable updating IPv4 or IPv6 firewall.</font> &lt;br&gt; <br> <font color="#008b8b">DO_IPV4</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">1</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <br> <font color="#008b8b">DO_IPV6</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">1</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#008b8b">function</font> <font color="#008b8b">get_ip_ipv4</font> &lt;br&gt; <br> <font color="#008b8b">{</font> &lt;br&gt; <br> <font color="#a020f0">$IP</font> addr show dev <font color="#a020f0">$1</font> primary <font color="#a52a2a"><b>|</b></font> <font color="#a52a2a"><b>sed</b></font> <font color="#6a5acd">-n</font> <font color="#6a5acd">-e</font> <font color="#a52a2a"><b>'</b></font> <font color="#ff00ff">/^\s*inet / s/^\s*inet \(.*\)\/.\{1,2\} .*$/\1/ p</font> <font color="#a52a2a"><b>'</b></font> &lt;br&gt; <br> <br> <font color="#008b8b">}</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#008b8b">ipt4()</font> &lt;br&gt; <br> <font color="#008b8b">{</font> &lt;br&gt; <br> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$DO_IPV4</font> <font color="#a52a2a"><b>"</b></font> <font color="#a52a2a"><b>=</b></font> <font color="#ff00ff">"1"</font> <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>&amp;&amp;</b></font> <font color="#a020f0">$IPTABLES</font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$@</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#008b8b">}</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#008b8b">ipt6()</font> &lt;br&gt; <br> <font color="#008b8b">{</font> &lt;br&gt; <br> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$DO_IPV6</font> <font color="#a52a2a"><b>"</b></font> <font color="#a52a2a"><b>=</b></font> <font color="#ff00ff">"1"</font> <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>&amp;&amp;</b></font> <font color="#a020f0">$IP6TABLES</font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$@</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#008b8b">}</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#008b8b">ipt46()</font> &lt;br&gt; <br> <br> <font color="#008b8b">{</font> &lt;br&gt; <br> ipt4 <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$@</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> ipt6 <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$@</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#008b8b">}</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">##############################################################################</font> &lt;br&gt; <br> <font color="#0000ff">################################ filter table ################################</font> &lt;br&gt; <br> <font color="#0000ff">##############################################################################</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-P</font> INPUT   ACCEPT&lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-P</font> OUTPUT  ACCEPT&lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-P</font> FORWARD ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-F</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-X</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#008b8b">FILTER_CHAINS46</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">bad_tcp inet_input inet_output inet_banned_input inet_banned_output inet_tcp_input inet_tcp_output inet_udp_input inet_udp_output</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>for</b></font> i <font color="#a52a2a"><b>in</b></font> <font color="#a020f0">$FILTER_CHAINS46</font> ; <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> <br> ipt46 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-N</b></font> <font color="#a020f0">$i</font> &lt;br&gt; <br> ipt46 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-F</b></font> <font color="#a020f0">$i</font> &lt;br&gt; <br> <font color="#a52a2a"><b>done</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#008b8b">FILTER_CHAINS4</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">inet_icmp_input inet_icmp_output</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <br> <font color="#a52a2a"><b>for</b></font> i <font color="#a52a2a"><b>in</b></font> <font color="#a020f0">$FILTER_CHAINS4</font> ; <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> ipt4 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-N</b></font> <font color="#a020f0">$i</font> &lt;br&gt; <br> ipt4 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-F</b></font> <font color="#a020f0">$i</font> &lt;br&gt; <br> <br> <font color="#a52a2a"><b>done</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#008b8b">FILTER_CHAINS6</font> = <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">inet_icmpv6_input inet_icmpv6_output inet_icmpv6_forward</font> <font color="#a52a2a"><b>"</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>for</b></font> i <font color="#a52a2a"><b>in</b></font> <font color="#a020f0">$FILTER_CHAINS6</font> ; <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> ipt6 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-N</b></font> <font color="#a020f0">$i</font> &lt;br&gt; <br> <br> ipt6 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-F</b></font> <font color="#a020f0">$i</font> &lt;br&gt; <br> <font color="#a52a2a"><b>done</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- INPUT</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># allow ipv6 in ipv4</font> &lt;br&gt; <br> <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> INPUT <font color="#6a5acd">-p</font> ipv6 <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> INPUT <font color="#6a5acd">-i</font> <font color="#a020f0">$LOOPBACK_IF</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> INPUT <font color="#6a5acd">-i</font> <font color="#a020f0">$LAN_IF</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> INPUT <font color="#6a5acd">-i</font> <font color="#a020f0">$INET_IF</font> <font color="#6a5acd">-j</font> inet_input&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> INPUT <font color="#6a5acd">-i</font> <font color="#a020f0">$INET6_IF</font> <font color="#6a5acd">-j</font> inet_input&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#ipt46 -t filter -A INPUT -m limit --limit 3/minute --limit-burst 3 -j LOG --log-level INFO --log-prefix "IPT INPUT packet died: "</font> &lt;br&gt; <br> <font color="#0000ff">#ipt46 -t filter -A INPUT -j LOG --log-level INFO --log-prefix "IPT INPUT packet died: "</font> &lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> INPUT <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- OUTPUT</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> OUTPUT <font color="#6a5acd">-o</font> <font color="#a020f0">$LOOPBACK_IF</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> OUTPUT <font color="#6a5acd">-o</font> <font color="#a020f0">$LAN_IF</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> OUTPUT <font color="#6a5acd">-o</font> <font color="#a020f0">$INET_IF</font> <font color="#6a5acd">-j</font> inet_output&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> OUTPUT <font color="#6a5acd">-o</font> <font color="#a020f0">$INET6_IF</font> <font color="#6a5acd">-j</font> inet_output&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#ipt46 -t filter -A OUTPUT -j LOG --log-level INFO --log-prefix "IPT OUTPUT: "</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> OUTPUT <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- bad_tcp</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> bad_tcp <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-m</font> state <font color="#6a5acd">--state</font> NEW ! <font color="#6a5acd">--syn</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> bad_tcp <font color="#6a5acd">-m</font> state <font color="#6a5acd">--state</font> INVALID <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> bad_tcp <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#0000ff">################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_input</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># filter out bad packets so they don't even reach other checks</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-j</font> inet_banned_input&lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-j</font> bad_tcp&lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-m</font> state <font color="#6a5acd">--state</font> ESTABLISHED,RELATED <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-j</font> inet_tcp_input&lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-p</font> udp <font color="#6a5acd">-j</font> inet_udp_input&lt;br&gt; <br> <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-p</font> icmp <font color="#6a5acd">-j</font> inet_icmp_input&lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-j</font> inet_icmpv6_input&lt;br&gt; <br> <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-p</font> igmp <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_input <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#0000ff">################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_output</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_output <font color="#6a5acd">-j</font> inet_banned_output&lt;br&gt; <br> &lt;br&gt; <br> <br> <font color="#0000ff"># allow established -- fast path</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_output <font color="#6a5acd">-m</font> state <font color="#6a5acd">--state</font> ESTABLISHED,RELATED <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_output <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-j</font> inet_tcp_output&lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_output <font color="#6a5acd">-p</font> udp <font color="#6a5acd">-j</font> inet_udp_output&lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_output <font color="#6a5acd">-p</font> icmp <font color="#6a5acd">-j</font> inet_icmp_output&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_output <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-j</font> inet_icmpv6_output&lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_output <font color="#6a5acd">-p</font> igmp <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_output <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_banned_input, inet_banned_output</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <br> <font color="#0000ff"># Drop packets from private, local and reserved addresses.</font> &lt;br&gt; <br> <font color="#0000ff"># You can add 10.0.0.0/8 if your ISP doesn't use it.</font> &lt;br&gt; <br> <font color="#0000ff"># You can also add 224.0.0.0/4 if you don't use multicast.</font> &lt;br&gt; <br> <font color="#a52a2a"><b>for</b></font> ip <font color="#a52a2a"><b>in</b></font> <font color="#ff00ff">172.16.0.0/12 192.168.0.0/16 127.0.0.0/8 240.0.0.0/5</font> ; <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> ipt4 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> inet_banned_input <font color="#a52a2a"><b>-s</b></font> <font color="#a020f0">$ip</font> <font color="#a52a2a"><b>-j</b></font> DROP&lt;br&gt; <br> <br> ipt4 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> inet_banned_output <font color="#a52a2a"><b>-d</b></font> <font color="#a020f0">$ip</font> <font color="#a52a2a"><b>-j</b></font> REJECT --reject-with icmp-admin-prohibited&lt;br&gt; <br> <font color="#a52a2a"><b>done</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a52a2a"><b>if</b></font> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>-e</b></font> /etc/firewall/inet_banned4 <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>then</b></font> &lt;br&gt; <br> <br> <font color="#a52a2a"><b>while</b></font> <font color="#a52a2a"><b>read</b></font> <font color="#a52a2a"><b>ext_ip</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>&nbsp;</b></font> <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> ipt4 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> inet_banned_input <font color="#a52a2a"><b>-s</b></font> <font color="#a020f0">$ext_ip</font> <font color="#a52a2a"><b>-j</b></font> DROP&lt;br&gt; <br> ipt4 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> inet_banned_output <font color="#a52a2a"><b>-d</b></font> <font color="#a020f0">$ext_ip</font> <font color="#a52a2a"><b>-j</b></font> REJECT --reject-with icmp-admin-prohibited&lt;br&gt; <br> <br> <font color="#a52a2a"><b>done</b></font> <font color="#a52a2a"><b>&lt;</b></font> /etc/firewall/inet_banned4&lt;br&gt; <br> <font color="#a52a2a"><b>fi</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a52a2a"><b>if</b></font> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>-e</b></font> /etc/firewall/inet_banned6 <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>then</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>while</b></font> <font color="#a52a2a"><b>read</b></font> <font color="#a52a2a"><b>ext_ip</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>&nbsp;</b></font> <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> <br> ipt6 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> inet_banned_input <font color="#a52a2a"><b>-s</b></font> <font color="#a020f0">$ext_ip</font> <font color="#a52a2a"><b>-j</b></font> DROP&lt;br&gt; <br> ipt6 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> inet_banned_output <font color="#a52a2a"><b>-d</b></font> <font color="#a020f0">$ext_ip</font> <font color="#a52a2a"><b>-j</b></font> REJECT --reject-with adm-prohibited&lt;br&gt; <br> <br> <font color="#a52a2a"><b>done</b></font> <font color="#a52a2a"><b>&lt;</b></font> /etc/firewall/inet_banned6&lt;br&gt; <br> <font color="#a52a2a"><b>fi</b></font> &lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_banned_input <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_banned_output <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_tcp_input</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a52a2a"><b>while</b></font> <font color="#a52a2a"><b>read</b></font> <font color="#a52a2a"><b>proto port comment</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>&nbsp;</b></font> <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>if</b></font> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>-n</b></font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$proto</font> <font color="#a52a2a"><b>"</b></font> <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>then</b></font> &lt;br&gt; <br> <br> <font color="#a020f0">$proto</font> <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> inet_tcp_input <font color="#a52a2a"><b>-p</b></font> tcp --dport <font color="#a020f0">$port</font> <font color="#a52a2a"><b>-j</b></font> ACCEPT&lt;br&gt; <br> <font color="#a52a2a"><b>fi</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>done</b></font> <font color="#a52a2a"><b>&lt;&lt;__EOF__</b></font> &lt;br&gt; <br> <font color="#ff00ff">ipt46 20          ftp-data</font> &lt;br&gt; <br> <br> <font color="#ff00ff">ipt46 21          ftp</font> &lt;br&gt; <br> <font color="#ff00ff">ipt46 12500:13000 ftp-data</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#ff00ff">ipt46 22          ssh</font> &lt;br&gt; <br> <font color="#a52a2a"><b>__EOF__</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># drop all MS stuff so that it won't clutter logs</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_tcp_input <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-m</font> multiport <font color="#6a5acd">--ports</font> <font color="#ff00ff">137</font> , <font color="#ff00ff">138</font> , <font color="#ff00ff">139</font> , <font color="#ff00ff">445</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_tcp_input <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_tcp_output</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <br> <font color="#0000ff"># drop all MS stuff so that it won't clutter logs</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_tcp_output <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-m</font> multiport <font color="#6a5acd">--ports</font> <font color="#ff00ff">137</font> , <font color="#ff00ff">138</font> , <font color="#ff00ff">139</font> , <font color="#ff00ff">445</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_tcp_output <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_udp_input</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <br> <font color="#0000ff"># iptv</font> &lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_udp_input <font color="#6a5acd">-p</font> udp <font color="#6a5acd">-d</font> <font color="#ff00ff">224.0.0.0/4</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># drop all MS stuff so that it won't clutter logs</font> &lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_udp_input <font color="#6a5acd">-p</font> udp <font color="#6a5acd">-m</font> multiport <font color="#6a5acd">--ports</font> <font color="#ff00ff">137</font> , <font color="#ff00ff">138</font> , <font color="#ff00ff">139</font> , <font color="#ff00ff">445</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#0000ff"># some unknown flood on my ISP's net</font> &lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_udp_input <font color="#6a5acd">-p</font> udp <font color="#6a5acd">--dport</font> <font color="#ff00ff">631</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_udp_input <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_udp_output</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># drop all MS stuff so that it won't clutter logs</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_udp_output <font color="#6a5acd">-p</font> udp <font color="#6a5acd">-m</font> multiport <font color="#6a5acd">--ports</font> <font color="#ff00ff">137</font> , <font color="#ff00ff">138</font> , <font color="#ff00ff">139</font> , <font color="#ff00ff">445</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_udp_output <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_icmp_input</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <br> <font color="#0000ff"># echo-reply should be handled by conntrack</font> &lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmp_input <font color="#6a5acd">-p</font> icmp <font color="#6a5acd">-m</font> icmp <font color="#6a5acd">--icmp-type</font> <font color="#a52a2a"><b>echo</b></font> <font color="#ff00ff">-request            -j ACCEPT</font> &lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmp_input <font color="#6a5acd">-p</font> icmp <font color="#6a5acd">-m</font> icmp <font color="#6a5acd">--icmp-type</font> <font color="#a52a2a"><b>time</b></font> -exceeded <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmp_input <font color="#6a5acd">-p</font> icmp <font color="#6a5acd">-m</font> icmp <font color="#6a5acd">--icmp-type</font> destination-unreachable <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmp_input <font color="#6a5acd">-p</font> icmp <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmp_input <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_icmp_output</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <br> ipt4 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmp_output <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_icmpv6_input</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># See RFC 4890.</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#0000ff"># echo-reply should be handled by conntrack</font> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#a52a2a"><b>echo</b></font> <font color="#ff00ff">-request            -j ACCEPT</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> destination-unreachable <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> packet-too-big <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#a52a2a"><b>time</b></font> -exceeded <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> parameter-problem <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> router-solicitation <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> router-advertisement <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> neighbour-solicitation <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> neighbour-advertisement <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> redirect <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">141</font> <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Inverse neighbour discovery solicitation</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">142</font> <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Inverse neighbour discovery advertisement</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-s</font> fe80::/ <font color="#ff00ff">10</font> <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">130</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Listener query</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-s</font> fe80::/ <font color="#ff00ff">10</font> <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">131</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Listener report</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-s</font> fe80::/ <font color="#ff00ff">10</font> <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">132</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Listener done</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-s</font> fe80::/ <font color="#ff00ff">10</font> <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">143</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Listener report v2</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">148</font> <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Certificate path solicitation</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">149</font> <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">255</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Certificate path advertisement</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-s</font> fe80::/ <font color="#ff00ff">10</font> <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">151</font> <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">1</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Multicast router advertisement</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-s</font> fe80::/ <font color="#ff00ff">10</font> <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">152</font> <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">1</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Multicast router solicitation</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-s</font> fe80::/ <font color="#ff00ff">10</font> <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#ff00ff">153</font> <font color="#6a5acd">-m</font> hl <font color="#6a5acd">--hl-eq</font> <font color="#ff00ff">1</font> <font color="#6a5acd">-j</font> ACCEPT <font color="#0000ff"># Multicast router termination</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_input <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_icmpv6_output</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_output <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- inet_icmpv6_forward</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_forward <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#a52a2a"><b>echo</b></font> <font color="#ff00ff">-request            -j ACCEPT</font> &lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_forward <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> destination-unreachable <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_forward <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> packet-too-big <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_forward <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> <font color="#a52a2a"><b>time</b></font> -exceeded <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_forward <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-m</font> icmp6 <font color="#6a5acd">--icmpv6-type</font> parameter-problem <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> inet_icmpv6_forward <font color="#6a5acd">-j</font> RETURN&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#################################</font> &lt;br&gt; <br> <font color="#0000ff">## filter -- FORWARD</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> &lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-i</font> <font color="#a020f0">$INET_IF</font> <font color="#6a5acd">-j</font> inet_banned_input&lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-o</font> <font color="#a020f0">$INET_IF</font> <font color="#6a5acd">-j</font> inet_banned_output&lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-j</font> bad_tcp&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff"># don't forward MS stuff</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-m</font> multiport <font color="#6a5acd">--ports</font> <font color="#ff00ff">137</font> , <font color="#ff00ff">138</font> , <font color="#ff00ff">139</font> , <font color="#ff00ff">445</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-p</font> udp <font color="#6a5acd">-m</font> multiport <font color="#6a5acd">--ports</font> <font color="#ff00ff">137</font> , <font color="#ff00ff">138</font> , <font color="#ff00ff">139</font> , <font color="#ff00ff">445</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-m</font> state <font color="#6a5acd">--state</font> ESTABLISHED,RELATED <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-p</font> icmpv6 <font color="#6a5acd">-j</font> inet_icmpv6_forward&lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#a52a2a"><b>while</b></font> <font color="#a52a2a"><b>read</b></font> <font color="#a52a2a"><b>proto port ip comment</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>&nbsp;</b></font> <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>if</b></font> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>-n</b></font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$proto</font> <font color="#a52a2a"><b>"</b></font> <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>then</b></font> &lt;br&gt; <br> ipt6 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> FORWARD <font color="#a52a2a"><b>-d</b></font> <font color="#a020f0">$ip</font> <font color="#a52a2a"><b>-p</b></font> <font color="#a020f0">$proto</font> --dport <font color="#a020f0">$port</font> <font color="#a52a2a"><b>-j</b></font> ACCEPT&lt;br&gt; <br> <br> <font color="#a52a2a"><b>fi</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>done</b></font> <font color="#a52a2a"><b>&lt;&lt;__EOF__</b></font> &lt;br&gt; <br> <font color="#ff00ff">tcp 22 ::/0 ssh</font> &lt;br&gt; <br> <font color="#ff00ff">tcp 80 2001:db8::1 http</font> &lt;br&gt; <br> <font color="#a52a2a"><b>__EOF__</b></font> &lt;br&gt; <br> &lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-i</font> <font color="#a020f0">$INET6_IF</font> <font color="#6a5acd">-p</font> tcp <font color="#6a5acd">-j</font> REJECT <font color="#6a5acd">--reject-with</font> tcp-reset&lt;br&gt; <br> <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-i</font> <font color="#a020f0">$INET6_IF</font> <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> ipt6 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-o</font> <font color="#a020f0">$INET6_IF</font> <font color="#6a5acd">-j</font> ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#a52a2a"><b>echo</b></font> <font color="#ff00ff">&nbsp;</font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$NAT_IPV4</font> <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">&nbsp;</font> | <font color="#a52a2a"><b>while</b></font> <font color="#a52a2a"><b>read</b></font> <font color="#a52a2a"><b>int_ip comment</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>&nbsp;</b></font> <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>if</b></font> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>-n</b></font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$int_ip</font> <font color="#a52a2a"><b>"</b></font> <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>then</b></font> &lt;br&gt; <br> <br> ipt4 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> FORWARD <font color="#a52a2a"><b>-s</b></font> <font color="#a020f0">$int_ip</font> <font color="#a52a2a"><b>-o</b></font> <font color="#a020f0">$INET_IF</font> <font color="#a52a2a"><b>-j</b></font> ACCEPT&lt;br&gt; <br> ipt4 <font color="#a52a2a"><b>-t</b></font> filter <font color="#a52a2a"><b>-A</b></font> FORWARD <font color="#a52a2a"><b>-d</b></font> <font color="#a020f0">$int_ip</font> <font color="#a52a2a"><b>-i</b></font> <font color="#a020f0">$INET_IF</font> <font color="#a52a2a"><b>-j</b></font> ACCEPT&lt;br&gt; <br> <br> <font color="#a52a2a"><b>fi</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>done</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#ipt46 -t filter -A FORWARD -j LOG --log-level INFO --log-prefix "IPT FORWARD packet died: "</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> filter <font color="#6a5acd">-A</font> FORWARD <font color="#6a5acd">-j</font> DROP&lt;br&gt; <br> &lt;br&gt; <br> <br> <font color="#0000ff">##############################################################################</font> &lt;br&gt; <br> <font color="#0000ff">################################ mangle table ################################</font> &lt;br&gt; <br> <font color="#0000ff">##############################################################################</font> &lt;br&gt; <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> mangle <font color="#6a5acd">-P</font> INPUT       ACCEPT&lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> mangle <font color="#6a5acd">-P</font> OUTPUT      ACCEPT&lt;br&gt; <br> <br> ipt46 <font color="#6a5acd">-t</font> mangle <font color="#6a5acd">-P</font> FORWARD     ACCEPT&lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> mangle <font color="#6a5acd">-P</font> PREROUTING  ACCEPT&lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> mangle <font color="#6a5acd">-P</font> POSTROUTING ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> mangle <font color="#6a5acd">-F</font> &lt;br&gt; <br> ipt46 <font color="#6a5acd">-t</font> mangle <font color="#6a5acd">-X</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">##############################################################################</font> &lt;br&gt; <br> <font color="#0000ff">################################## nat table #################################</font> &lt;br&gt; <br> <font color="#0000ff">##############################################################################</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> nat <font color="#6a5acd">-P</font> OUTPUT      ACCEPT&lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> nat <font color="#6a5acd">-P</font> PREROUTING  ACCEPT&lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> nat <font color="#6a5acd">-P</font> POSTROUTING ACCEPT&lt;br&gt; <br> <br> &lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> nat <font color="#6a5acd">-F</font> &lt;br&gt; <br> ipt4 <font color="#6a5acd">-t</font> nat <font color="#6a5acd">-X</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">####################################</font> &lt;br&gt; <br> <font color="#0000ff">## nat -- PREROUTING</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#0000ff"># Port forwarding</font> &lt;br&gt; <br> <font color="#a52a2a"><b>while</b></font> <font color="#a52a2a"><b>read</b></font> <font color="#a52a2a"><b>proto port int_ip comment</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>&nbsp;</b></font> <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>if</b></font> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>-n</b></font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$proto</font> <font color="#a52a2a"><b>"</b></font> <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>then</b></font> &lt;br&gt; <br> <br> ipt4 <font color="#a52a2a"><b>-t</b></font> nat <font color="#a52a2a"><b>-A</b></font> PREROUTING <font color="#a52a2a"><b>-i</b></font> <font color="#a020f0">$INET_IF</font> <font color="#a52a2a"><b>-p</b></font> <font color="#a020f0">$proto</font> --dport <font color="#a020f0">$port</font> <font color="#a52a2a"><b>-j</b></font> DNAT --to-destination <font color="#a020f0">$int_ip</font> : <font color="#a020f0">$port</font> &lt;br&gt; <br> <br> <font color="#a52a2a"><b>fi</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>done</b></font> <font color="#a52a2a"><b>&lt;&lt;__EOF__</b></font> &lt;br&gt; <br> <font color="#ff00ff">tcp 1234 192.168.1.3 something</font> &lt;br&gt; <br> <font color="#ff00ff">udp 5678 192.168.1.3 something else</font> &lt;br&gt; <br> <font color="#a52a2a"><b>__EOF__</b></font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">####################################</font> &lt;br&gt; <br> <font color="#0000ff">## nat -- POSTROUTING</font> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#a52a2a"><b>echo</b></font> <font color="#ff00ff">&nbsp;</font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$NAT_IPV4</font> <font color="#a52a2a"><b>"</b></font> <font color="#ff00ff">&nbsp;</font> | <font color="#a52a2a"><b>while</b></font> <font color="#a52a2a"><b>read</b></font> <font color="#a52a2a"><b>int_ip comment</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>&nbsp;</b></font> <font color="#a52a2a"><b>do</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>if</b></font> <font color="#a52a2a"><b>[</b></font> <font color="#a52a2a"><b>-n</b></font> <font color="#a52a2a"><b>"</b></font> <font color="#a020f0">$int_ip</font> <font color="#a52a2a"><b>"</b></font> <font color="#a52a2a"><b>]</b></font> <font color="#a52a2a"><b>;</b></font> <font color="#a52a2a"><b>then</b></font> &lt;br&gt; <br> <br> ipt4 <font color="#a52a2a"><b>-t</b></font> nat <font color="#a52a2a"><b>-A</b></font> POSTROUTING <font color="#a52a2a"><b>-s</b></font> <font color="#a020f0">$int_ip</font> <font color="#a52a2a"><b>-o</b></font> <font color="#a020f0">$INET_IF</font> <font color="#a52a2a"><b>-j</b></font> SNAT --to- <font color="#a52a2a"><b>source</b></font> <font color="#a020f0">$INET_IP</font> &lt;br&gt; <br> <font color="#a52a2a"><b>fi</b></font> &lt;br&gt; <br> <font color="#a52a2a"><b>done</b></font> &lt;br&gt; <br> <br> &lt;br&gt; <br> <font color="#a52a2a"><b>echo</b></font> <font color="#ff00ff">1</font> <font color="#a52a2a"><b>&gt;</b></font> /proc/sys/net/ipv4/ip_forward&lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">##</font> &lt;br&gt; <br> <font color="#0000ff">## __END__</font> &lt;br&gt; <br> <font color="#0000ff">#################################</font></code> </blockquote> <br><br>  Download: <a href="http://bin-login.name/rc.firewall.txt">bin-login.name/rc.firewall.txt</a> <br>  Here you can check how firewall works for TCP in IPv6: <a href="http://www.subnetonline.com/pages/ipv6-network-tools/online-ipv6-port-scanner.php">www.subnetonline.com/pages/ipv6-network-tools/online-ipv6-port-scanner.php</a> </div><p>Source: <a href="https://habr.com/ru/post/82885/">https://habr.com/ru/post/82885/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../82878/index.html">Application Verifier for a Programmer: Testing Windows Applications</a></li>
<li><a href="../82880/index.html">Amateurish robbery-3 or the same eggs, only in profile</a></li>
<li><a href="../82882/index.html">Junimotion - do it yourself robot</a></li>
<li><a href="../82883/index.html">Where does the rust on the chokes of ASUS motherboards come from?</a></li>
<li><a href="../82884/index.html">Where does the creative come from?</a></li>
<li><a href="../82886/index.html">Dollar rate European session overview</a></li>
<li><a href="../82887/index.html">"Amazing, incredible" - Apple reduced</a></li>
<li><a href="../82894/index.html">Unparalleled online newspaper graph. ads "AdNotice.net"</a></li>
<li><a href="../82903/index.html">Ethernet clocks always show the exact time</a></li>
<li><a href="../82906/index.html">Anchor navigation on jQuery (graceful degradation)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>