<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Threats of the past and future protocols</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As many of Qrator Labs blog readers probably already know, DDoS attacks can be targeted at different levels of the network. In particular, the malicio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Threats of the past and future protocols</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/qn/xa/qf/qnxaqfkk5kf4bnivvb1r2l7qmso.png"><br><br>  As many of Qrator Labs blog readers probably already know, DDoS attacks can be targeted at different levels of the network.  In particular, the malicious bot's presence of a large botnet allows him to carry out attacks on the L7 level (application / application) and try to mimic a normal user, while without it the attacker is forced to restrict himself to batch attacks (any, allowing you to fake the source address at one time or another ) to the lower levels of transit networks. <br><br>  Naturally, both for the first and for the second task, attackers usually seek to use some kind of already existing toolkit - exactly the same way as, for example, a website developer does not write it completely from scratch, but uses common frameworks like Joomla and Bootstrap.  For example, a popular framework for organizing attacks from the Internet of Things for a year and a half has <a href="https://github.com/jgamblin/Mirai-Source-Code/">been Mirai</a> , whose source code was laid out in open access by its authors in an attempt to shake the FBI back <a href="https://krebsonsecurity.com/2016/10/source-code-for-iot-botnet-mirai-released/">in October 2016</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And for packet attacks, such a popular framework is the <a href="https://www.kernel.org/doc/Documentation/networking/pktgen.txt">pktgen module</a> built into Linux.  He was built in there not for this, but for quite legitimate network testing and administration purposes, however, as Isaac Asimov wrote, ‚Äúan atomic blaster is a good weapon, but it can fire in both directions.‚Äù <br><a name="habracut"></a><br>  The peculiarity of pktgen is that it ‚Äúout of the box‚Äù can generate only UDP traffic.  For the purposes of network testing, this is enough, and the Linux kernel developers do not particularly want to simplify indiscriminate firing in both directions.  As a result, this (somewhat) simplified the fight against DDoS attacks, since a number of intruders even registered the correct ports in pktgen, but did not pay attention to the resulting <a href="https://en.wikipedia.org/wiki/IPv4">IP protocol values</a> , and a significant proportion of packet attacks targeted TCP services (for example, HTTPS using port 443 / TCP) UDP datagrams.  Such parasitic traffic used to be easily and cheaply discarded even on distant approaches (based on BGP Flowspec including), and it would never reach the ‚Äúlast mile‚Äù to the attacked resource. <br><br>  But everything changes when Google comes. <br><br>  Consider the specification developed from 2013 to replace TCP <a href="https://ru.wikipedia.org/wiki/QUIC">QUIC</a> protocol.  QUIC allows you to multiplex multiple data streams between two computers, working on top of the <a href="https://ru.wikipedia.org/wiki/UDP">UDP protocol</a> and contains encryption capabilities equivalent to <a href="https://ru.wikipedia.org/wiki/TLS">TLS</a> and <a href="https://ru.wikipedia.org/wiki/SSL">SSL</a> .  It has a lower connection delay and transmission than <a href="https://ru.wikipedia.org/wiki/TCP">TCP</a> .  It tolerates the loss of part of packets by aligning the boundaries of cryptographic blocks on the boundaries of packets.  The protocol has the possibility of error correction ( <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D1%258F%25D0%25BC%25D0%25B0%25D1%258F_%25D0%25BA%25D0%25BE%25D1%2580%25D1%2580%25D0%25B5%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F_%25D0%25BE%25D1%2588%25D0%25B8%25D0%25B1%25D0%25BE%25D0%25BA">FEC</a> ) at the packet level, but in practice it is disabled.  ‚í∏ Wikipedia <br><br>  Google over the past few years has developed a bundle of protocols designed to replace the old World Wide Web protocol stack.  QUIC works on top of the well-known UDP transport protocol, and at the moment we see isolated cases of QUIC integration into projects by individual ‚Äúenthusiasts‚Äù.  Google Chrome, like Google‚Äôs application servers, is already supported by QUIC, so the enthusiasm will be explained.  According to reviews of some telecom operators, the protocol, first released in 2013, already accounts <b>for a</b> larger share of their traffic than IPv6 introduced since the 90s. <br><br>  However, at the moment all attempts to implement QUIC are mostly user space-programs, and from the point of view of the kernel, not to mention all transit devices and Flowspec, this is ( <i>drum roll</i> ) UDP on port 443. <br><br>  On the one hand, this in some sense illustrates the vulnerability of the approach, when packet attacks are filtered on one equipment, and attacks on higher levels on the other (usually cumulatively much weaker).  It is clear that building such solutions is cheap and pleasant, but they essentially fix the historical situation on the World Wide Web, and the notion of a ‚Äúhistorical situation‚Äù regarding the industry, which is only 25 years old, sounds somewhat ridiculous.  Imagine that tomorrow the situation will change - say, a business will come and will require the implementation of the new-fashioned QUIC protocol, because Google promised to rank QUIC-enabled-sites in the list above - this has not happened yet, but it could well happen in 2020.  As a result of such an introduction, as in the old joke about the Kremlin plumbing, the entire system will need to be changed. <br><br><div class="spoiler">  <b class="spoiler_title">Two are in prison and talking</b> <div class="spoiler_text">  - Are you on a political or criminal article? <br>  - For political.  I'm a plumber.  Called to the Kremlin.  I looked around and said: ‚ÄúIt‚Äôs necessary to change the whole system!‚Äù <br></div></div><br>  On the other hand, the QUIC protocol is specifically reasonably developed - it, in particular, does not allow for the design, unlike many other UDP-based protocols such as DNS, amplification attacks, that is, it does not guarantee increased response traffic to requests from an unconfirmed source, as a result of the presence in the specification of a <i>handshake</i> (it is the same handshake or ‚Äúhandshake‚Äù). <br><br>  The main task of a handshake is to make it as simple and effective as possible that requests actually come from the IP address that is written in the source field of the IP packet.  This is necessary in order not to waste the limited processing power of the server and the network to communicate with many fake clients.  In addition, this allows you to get rid of using the server as an intermediate link in the amplification attack, when the server sends significantly more data to the victim‚Äôs address (fake in the source field) than the attacker needs to generate on behalf of the victim. <br><br>  Adam Langley and the company can serve as an example for all who are trying to create their own UDP-based protocols (hello, igrodely!).  In the current version of the QUIC draft draft, an <a href="https://quicwg.github.io/base-drafts/draft-ietf-quic-transport.html">entire section is</a> devoted to <a href="https://quicwg.github.io/base-drafts/draft-ietf-quic-transport.html">a</a> handshake.  In particular, the first QUIC connection packet cannot be less than 1200 bytes, since it is this size that the server can answer to a handshake.  A QUIC client, up to the time of establishing a connection (that is, until the moment when the authenticity of the client's IP address is confirmed) cannot force the server to send more response bytes or generate more packets than the client itself sends. <br><br>  Naturally, the handshake mechanism is a very convenient target for intruders.  The famous <a href="https://en.wikipedia.org/wiki/SYN_flood">SYN flood</a> attack, for example, is aimed specifically at the triple handshake mechanism in the TCP protocol.  Therefore, it is important that any handshake is designed in the most optimal way and implemented without significant algorithmic complexity, ideally - as close as possible to the hardware.  In TCP, for example, this was not originally the case - the effective SYN cookies were designed much later by the famous Daniel Bernstein and are based, in fact, on hacks, so that even outdated clients could work with this mechanism. <br><br>  It is ridiculous, but, as can be seen from the first part of the post, in fact, the QUIC protocol is the goal of the attackers even before their full release.  Therefore, when introducing QUIC into battle, it is crucially important to ensure that the QUIC handshake is implemented as efficiently as possible and close to the hardware.  Otherwise, those attacks that the kernel could cope with earlier (and Linux supports SYN cookies for a very long time) will have to be processed in some Nginx or, I suppose, IIS.  Needless to say that he is unlikely to cope with them. <br><br><hr><br>  Every year the network becomes more and more complicated.  This challenge has to be answered by everyone, especially the engineers who are involved in the development and implementation of new network protocols.  In the process of such implementation, you should first of all take into account security issues and solve them in advance, without waiting for the actual realization of the threat.  Note that effective support for the same QUIC at a level close to the hardware is still to be ensured. <br><br>  It will be very difficult to implement protection of a system designed on top of the QUIC protocol until all such issues are discovered, analyzed and solved.  The same goes for the rest of the newfangled things like HTTP / 2, DNS-over-TLS and even IPv6. <br><br>  In the future, we will see even more interesting examples of attacks on the protocols of the new generation.  We will certainly keep you informed. </div><p>Source: <a href="https://habr.com/ru/post/348414/">https://habr.com/ru/post/348414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348400/index.html">Conceptual sorting in C ++ 20</a></li>
<li><a href="../348402/index.html">Nemesida WAF: intellectual protection against brute-force attacks</a></li>
<li><a href="../348404/index.html">How zadolbat all colleagues: collect requirements for CRM</a></li>
<li><a href="../348406/index.html">The most dangerous word in software development</a></li>
<li><a href="../348410/index.html">The book "Reactive design patterns"</a></li>
<li><a href="../348416/index.html">The system bus PC transmits music in the middle frequencies</a></li>
<li><a href="../348418/index.html">Understand Bitcoin and the Future. Like what you know will be rethought forever</a></li>
<li><a href="../348420/index.html">Wi-Fi under the Neva: how we built a network in the deepest metro of the world</a></li>
<li><a href="../348422/index.html">Top 10 errors from 1000+ JavaScript projects and recommendations for eliminating them</a></li>
<li><a href="../348424/index.html">How JS works: web workers and five use cases</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>