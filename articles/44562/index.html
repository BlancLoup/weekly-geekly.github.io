<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up an Apple Slim keyboard for Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I recently celebrated my 23rd birthday and was gifted by my colleagues with a wonderful device. Apple Slim Aluminum Keyboard. 
 Yes Yes Yes. It is wit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up an Apple Slim keyboard for Linux</h1><div class="post__text post__text-html js-mediator-article">  I recently celebrated my 23rd birthday and was gifted by my colleagues with a wonderful device.  Apple Slim Aluminum Keyboard. <br>  Yes Yes Yes.  It is with a capital letter every word. <br>  In my humble opinion, the best keyboard for the developer is not found.  Especially for a Linux lover like me. <br>  The keyboard is comfortable, you will not say anything, I will not write about it anymore, and it has already been written everywhere.  However, not without problems. <br>  My favorite work computer with Gentoo completely refused to work with multimedia keys and other pleasures of the modern world.  A little googling, I discovered that I am not alone, and a huge number of people also suffer from this.  However, I did not find any clear and detailed instructions in Russian (and in English).  Especially for sufferers like me, this short manual is intended. <br>  Here in the comments ask for a picture of the keyboard: <br><img src="https://habrastorage.org/getpro/habr/post_images/1d8/a32/d63/1d8a32d63cd5b16e6a57306784180cc3.jpg" alt="image"><br>  And <a href="http://apple.com/keyboard/">here</a> you can read about it. <br><a name="habracut"></a><br>  I will make a reservation that we will perform all subsequent operations in the superuser mode.  And also, all the proposed keycodes work only for the Slim keyboard.  For the laptop keyboard will have to repeat everything yourself. <br><br><h2>  1. Compile the bucket. </h2><br>  The first thing that I had to do as a user of such a friendly distribution as Gentoo was to recompile the kernel, of course. <br>  Without this, the X server completely refuses to see the missing keys. <br>  I note that Ubuntu users will not have to do this as the developers have already done everything for them. <br>  I assume that the kernel sources you already have are / usr / src / linux <br>  We go there and make make menuconfig <br>  In the dialog that opens, we find: <br>  Device Drivers ‚Üí HID Devices <br>  And tick the box ‚ÄúEnable support for Apple laptop / aluminum USB special keys‚Äù. <br>  Next, as usual, make &amp;&amp; make modules_install &amp;&amp; make install <br>  If it is not compiled, we call our Linux neighbor, google forums, etc. in search of a solution to find out what is wrong and how to overcome this problem. <br><br><h2>  2. A bit of shamanism. </h2><br>  I note that after the kernel has been successfully installed, everything will practically work.  But, as is customary in the Linux world, not without a catch. <br>  Now, in order to press, for example, the F1 button, you must first hold down the non-working Fn key.  Believe me, that is very annoying and makes you think about suicide. <br>  To correct this disgrace, we do such a thing: <br> <code>echo 2 &gt; /sys/module/hid/parameters/pb_fnmode</code> <br>  In order for this change to be applied each time the system is booted, this command must be added to the end of the startup script. <br>  In different distributions it is in different places. <br>  Let me give you an example for Gentoo: <br>  / <code>etc/conf.d/local.start</code> <br>  and for Ubuntu: <br> <code>/etc/rc.local</code> <br> <br><h2>  3. And that's not all. </h2><br>  What do you think?  Left just a little bit. <br>  Unfortunately, the "E" button does not work, it is also "~".  And there are reverse apostrophes on it.  The necessary button in general. <br>  Also, the buttons in the top row do not work: Print Screen, Scrool Lock and Pause. <br>  Not so often I use them, but still not on their own from the fact that they do not work. <br>  Well, perhaps the most important drawback is that there is no Insert button, but there are F16-F19 which, as it were, have nowhere to go. <br>  We will deal with these problems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To change the keyboard layout, we will use two standard X utilities: xev and xmodmap.  Changes will not be made under the superuser, but under your system user, in your home directory. <br><br>  Run xev and try to press the keys. <br>  After clicking we read what falls out on the screen.  I clicked on the letter "e" and saw this: <br><br> <code>KeyRelease event, serial 34, synthetic NO, window 0x3c00001, <br> root 0x1a6, subw 0x0, time 31989750, (533,667), root:(538,692), <br> state 0x10, keycode 94 (keysym 0x3c, less), same_screen YES, <br> XLookupString gives 1 bytes: (3c) "&lt;" <br> XFilterEvent returns: False</code> <br> <br>  What does this tell us? <br>  The key with keycode 94 has been pressed. A typed character ‚Äú&lt;‚Äù is assigned to it.  What does not suit us. <br>  Run the xmodmap utility with the -pke keys <br>  The current keyboard layout will fall out on the screen. <br>  We are looking for the desired keycode: <br>  keycode 94 = bar bar brokenbar less slash <br>  Create a new file in the root directory with the name .Xmodmap. <br>  In it, we will form our new layout. <br>  Copy the line found above into this file and edit. <br>  In order to know what to replace ‚Äúless greater ...‚Äù you will have to read the entire output of xmodmap -pke and find what suits us. <br>  And here it is: <br> <code>keycode 49 = grave asciitilde Cyrillic_io Cyrillic_IO</code> <br>  Replace so what would happen: <br> <code>keycode 94 = grave asciitilde Cyrillic_io Cyrillic_IO</code> <br> <br>  For the test, run: xmodmap ~ / .Xmodmap <br>  And try to press.  Hooray?  Everything is working. <br><br>  In the same way we find the key codes for F13 - F15 and assign the necessary actions to them. <br>  I assigned this: <br> <code>keycode 191 = Print Sys_Req Print Sys_Req Print Sys_Req <br> keycode 192 = Scroll_Lock NoSymbol Scroll_Lock NoSymbol Scroll_Lock <br> keycode 193 = Pause Break Pause Break Pause Break</code> <br> <br>  Well, Insert hang on F16: <br> <code>keycode 194 = Insert NoSymbol Insert NoSymbol Insert</code> <br> <br>  As a result, I received such an .Xmodmap file: <br><br> <code>keycode 94 = grave asciitilde Cyrillic_io Cyrillic_IO <br> keycode 191 = Print Sys_Req Print Sys_Req Print Sys_Req <br> keycode 192 = Scroll_Lock NoSymbol Scroll_Lock NoSymbol Scroll_Lock <br> keycode 193 = Pause Break Pause Break Pause Break <br> keycode 194 = Insert NoSymbol Insert NoSymbol Insert</code> <br> <br>  I note that after this file appears in your home directory, nothing else needs to be done.  It will automatically apply after restarting the X server. <br><br><h2>  4. For maniacs </h2><br>  Some, accustomed to the arrangement of keys typical for ordinary keyboards: Ctrl |  Win |  Alt can't get used to the fact that on the Apple keyboard this layout is changed to: Ctrl |  Alt |  Cmd <br>  Cmd is the same as Win.  For linux, it looks like ‚ÄúMeta‚Äù or ‚ÄúSuper.‚Äù <br>  To do this, using the same xmodmap we came up with the following remapping: <br><br> <code>clear Mod4 <br> clear Mod1 <br> keycode 115=Alt_L <br> keycode 64=Super_L <br> add Mod4 = Super_L <br> add Mod1 = Alt_L</code> <br> <br><h2>  5. For dissenters. </h2><br>  Of course, the proposed scheme is not for everyone.  But guided by this instruction, everyone can customize their keyboard as he wants. <br>  And of course, the part of the instruction that is responsible for keying the keys can also help those who are not the happy owners of the Apple keyboard. <br>  For example, you can fine tune the multimedia keys on the keyboards on which they are present.  :) Or subtract the layout that doesn't suit you. <br><br>  ZY: During the experiments, it may happen that you can not press any button and want to return everything as it was. <br>  In order not to restart the X-server, you can use the following command: setxkbmap -model evdev -layout us, ru <br>  This will return the layout to working condition.  Instead of ‚Äúevdev‚Äù you should try to substitute your keyboard model.  You can spy on this name in advance with the command: cat /etc/X11/xorg.conf |  grep XkbModel or in the keyboard settings of your desktop manager. <br><br>  UPD: Added a picture of the keyboard. </div><p>Source: <a href="https://habr.com/ru/post/44562/">https://habr.com/ru/post/44562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445600/index.html">[Poll and evil] Hosting, be they wrong</a></li>
<li><a href="../445602/index.html">PHP Russia 2019: your own ‚Äústadium‚Äù for the first league language</a></li>
<li><a href="../445608/index.html">Game over: analysts report an increase in the number of DDoS attacks on the game segment</a></li>
<li><a href="../445612/index.html">Cluster storage for small web clusters based on drbd + ocfs2</a></li>
<li><a href="../445618/index.html">We write an operating system on Rust. Implementation of paging memory (new version)</a></li>
<li><a href="../445620/index.html">What does a UX writer do?</a></li>
<li><a href="../445622/index.html">New in Java 12: The Teeing Collector</a></li>
<li><a href="../445626/index.html">How deep is the rabbit hole? CLRium # 5: Garbage Collector</a></li>
<li><a href="../445632/index.html">From parser posters of the theater in Python to Telegram-bot. Part 2</a></li>
<li><a href="../445638/index.html">Blind internship at the Garage Museum of Contemporary Art</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>