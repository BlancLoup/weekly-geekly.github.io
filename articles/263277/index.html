<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Getting root access to ONT Sercomm RV6688 using contact closure</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once, the author wanted something new to replace the good, and he decided to connect to GPON from one well-known operator. And the magic box was put t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Getting root access to ONT Sercomm RV6688 using contact closure</h1><div class="post__text post__text-html js-mediator-article">  Once, the author wanted something new to replace the good, and he decided to connect to GPON from one well-known operator.  And the magic box was put to the author in the apartment, through which it was possible to make phone calls, go online and watch TV, and a real optical cable was brought into it.  And this box is called Sercomm RV6688 optical network terminal (ONT), it was made by order of this operator and painted with the corresponding logo. <br>  Works box.  But the author does not sit, and again he wanted something more, and he decided to sort out (how) all this magic inside the box is obtained and whether it can be finely controlled.  But what could be the magic without surprises. <br><a name="habracut"></a><br><h1>  A starting point </h1><br>  What was found on the topic on the Internet.  In addition to the well-known admin / admin user account with ‚Äúlower plinth‚Äù rights, technical forums managed to unearth a ‚Äúsecret‚Äù (I don‚Äôt list it here) account with extended support rights, which gives more degrees of freedom, but does not allow you to look deep into ONT operating system.  The ‚Äúholes‚Äù in the web-interface were also mentioned, through which it was possible to enhance the rights of users, but which were promptly eliminated in new firmware and therefore lost their relevance. <br><br><h1>  Own way </h1><br>  Experience with such equipment suggested that ONT somewhere there must be a port for service.  Usually, this is an RS-232 serial port, which (rarely) is brought out in a D-sub connector with voltage levels of 12V or is present on the board as a pin block with TTL levels of + 5V or + 3.3V, i.e.  pure UART without an additional microcircuit of conversion of voltage levels.  Often, this port, which in Linux is called the tty * device, is the Linux console (does anyone doubt that it is inside ONT Linux? :)) and the bootloader console Redboot, U-boot, Barebox, and others. Access to this console was provided by would be a wide field of action.  But I did not find the external connector. <br>  In general, I adhered to these assumptions when I began to unscrew the ONT.  For aesthetes, a few words about the security seal sticker.  The plastic case of the RV6688 can be ‚Äúcleverly‚Äù opened slightly, without breaking the seal.  If you slightly ‚Äústraighten‚Äù the bezel of the sealed screw with a bend, you can even remove the board, which was done. <br><br>  ONT fee: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/dc2/ba6/661/dc2ba66618eb4f20b9ee81bb74b806b3.png"></div><br>  A quick inspection of the board, after a look that was delayed for a few seconds on the optical module, revealed a likely candidate for that same service port.  A signature RX, TX, GND only strengthened this view.  A multimeter test showed that this is a UART with 3.5V levels. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Service port: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/9d0/975/23c/9d097523c27a4878994b19d8e2b939f6.png"></div><br>  I didn‚Äôt have a USB &lt;-&gt; UART (TTL) adapter at that moment, but there was an Arduino Mega 2560 board that acted as a signal converter.  Just in case, I filled it with an empty sketch that does not use the UART mega (which translates the inputs into a high-impedance state). <br><br>  Arduino Mega 2560 as USB &lt;-&gt; UART converter: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/1ef/5d9/1c6/1ef5d91c60744cb5bc0aefd033e6b1e8.png"></div><br>  Next, build a simple cable, connect to a PC, launch your favorite Tera Term terminal program.  And finally, the satisfaction of displaying the expected lines of the boot log with an invitation to interrupt the boot process for 1 second and enter the U-Boot bootloader environment.  At the end of the download, the Linux login prompt appears.  But none of the well-known ONT username / password pairs came up, so the next step in the research was to enter the U-Boot bootloader environment, which would enable you to manage the Linux boot process, including possibly allowing you to bypass the login invitation! <br><br>  Start Download Output: <br><pre><code class="bash hljs">BL LILAC STARTER VER-2.1.06.0-BL (Aug 26 2013 - 17:00:31) SOC ID: BL_23570 Init DDR3.... 128MB Attempt to boot from NAND... Try to load bootloader from boot bank 0 Bootloader Loaded to DRAM Cache enabled, start bootloader... .... Enter <span class="hljs-string"><span class="hljs-string">'Ctrl+C'</span></span> to stop autoboot: 0 ....</code> </pre> <br>  And here I‚Äôd have to relax and, drinking coffee, slowly browse through the U-Boot environment variables, but the ONT developers presented an interesting surprise. <br><br>  It turned out that the Ctrl + C combination does not work, and it is not possible to enter the U-Boot environment at this stage!  I tried many other and even random key combinations, changed the settings of the terminal program, connection speed.  To no avail.  I suspected that the sending of data from the PC (RX to ONT) was not working, but at the end of the boot procedure, when the Linux login prompt appeared, the keyboard input was already working.  In general, the work behind the keyboard could not give anything.  (I think there is a shortcut, but ...) <br><br>  He drank cold coffee and pissed off the situation.  Eureka was not long in coming.  At boot time, the processor diligently reads the flash-memory in accordance with the stages of this very boot.  Loads the bootloader and its parameters into memory before prompting to interrupt the boot and then reads the system kernel, etc.  after one second of waiting.  The idea was simple: at the moment when the countdown ticked on the screen, block the ability to read data from flash.  The interruption of the boot procedure will be triggered (read error), and a transition will be made to the U-boot console to correct the boot parameters (at least I thought so :)).  Of the possible implementation options, the following was chosen as the least time consuming and, in my opinion, moderately safe.  I decided to short out the legs of 43, 44 flash chips after starting the bootloader and thus block the correct reading of data at the time after a one-second delay.  This was done with a thin screwdriver.  It turned out at the third attempt, when I began to ‚Äúpoke‚Äù a screwdriver more confidently. <br><br>  Legs flush: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/245/6c8/389/2456c838940f40e687121d367495bf0c.png"></div><br>  This is what an attempt to download with interleaved flash data lines from the moment of the reverse report looks like this: <br><pre> <code class="bash hljs">Enter <span class="hljs-string"><span class="hljs-string">'Ctrl+C'</span></span> to stop autoboot: 0 UBI: mtd1 is detached from ubi0 Creating 1 MTD partitions on <span class="hljs-string"><span class="hljs-string">"nand0"</span></span>: 0x000000100000-0x000000200000 : <span class="hljs-string"><span class="hljs-string">"mtd=1"</span></span> UBI: attaching mtd1 to ubi0 UBI: empty MTD device detected UBI: create volume table (copy <span class="hljs-comment"><span class="hljs-comment">#1) UBI error: ubi_scan_get_free_peb: no eraseblocks found UBI error: ubi_init: cannot attach mtd1 UBI error: ubi_init: UBI error: cannot initialize UBI, error -28 UBI init error -28 ERROR: failed to select 'cfg' partition Creating 1 MTD partitions on "nand0": 0x000000100000-0x000000200000 : "mtd=1" UBI: attaching mtd1 to ubi0 UBI: empty MTD device detected UBI: create volume table (copy #1) UBI error: ubi_scan_get_free_peb: no eraseblocks found UBI error: ubi_init: cannot attach mtd1 UBI error: ubi_init: UBI error: cannot initialize UBI, error -28 UBI init error -28 ERROR: failed to select 'cfg' partition Creating 1 MTD partitions on "nand0": 0x000000100000-0x000000200000 : "mtd=1" UBI: attaching mtd1 to ubi0 UBI: empty MTD device detected UBI: create volume table (copy #1) UBI error: ubi_scan_get_free_peb: no eraseblocks found UBI error: ubi_init: cannot attach mtd1 UBI error: ubi_init: UBI error: cannot initialize UBI, error -28 UBI init error -28 ERROR: failed to select 'cfg' partition =&gt;</span></span></code> </pre><br>  As you can see, at the end there was a command line prompt U-boot.  Let's see what's inside (printenv): <br><pre> <code class="bash hljs">=&gt; printenv bootcmd=blboot baudrate=115200 consoledev=ttyS0 modetty0=115200n8 mtdids=nand0=nand mtdparts=mtdparts=nand:0x100000(starter),0x100000(cfg),0x200000(uboot0),0x200000(uboot1),0x100000(cal),0x400000(linux0),0x400000(linux1),0x2800000(rootfs0),0x2800000(rootfs1),0x800000(sc_config),0x100000(bbt) mem_reserve_low=tm=0x1400000 mc=0x400000 dsp=0x200000 EMACS_GRP_MODE=QSGMII EMAC=EMAC0 E4_MODE=NONE ethact=ETHMAC0 bootdelay=1 update_uboot=tftp a9d00000 u-boot.bin;blnp uboot;saveenv update_kernel=tftp a9d00000 uImage;blnp linux;saveenv update_rootfs=tftp a9d00000 rootfs.img;blnp rootfs;saveenv bootargs=ubi.mtd=0 ubi.mtd=11 root=ubi0_0 rw rootfstype=ubifs console=ttyS0,115200 xx=dd filesize=CEB800 fileaddr=A9D00000 gatewayip=192.168.1.254 netmask=255.255.255.0 ipaddr=172.21.17.188 serverip=172.21.17.155 boot_ver=1110 ethaddr=d4:21:22:xx:xx:xx memsize=128M stdin=serial stdout=serial stderr=serial partition=nand0,0 mtddevnum=0 mtddevname=starter Environment size: 946/262140 bytes =&gt;</code> </pre><br>  Now you can correct variables.  Increase the wait pause to 3 seconds and replace the Init process with the shell / bin / sh (Why do we need a login? No, we don‚Äôt need a login).  Those.  let's make a simplified single user download. <br><pre> <code class="bash hljs">Environment size: 946/262140 bytes =&gt; setenv bootdelay 3 =&gt; setenv bootargs ubi.mtd=0 ubi.mtd=11 root=ubi0_0 rw rootfstype=ubifs console=ttyS0,115200 single init=/bin/sh =&gt; saveenv =&gt; printenv ... bootargs=ubi.mtd=0 ubi.mtd=11 root=ubi0_0 rw rootfstype=ubifs console=ttyS0,115200 single init=/bin/sh ... Environment size: 966/262140 bytes =&gt;</code> </pre><br>  We will write the changes (saveenv) and run run bootcmd or simply distort the ONT power supply. <br>  Now we will wait for the ONT to be fully loaded without any manipulations with a screwdriver. <br>  Last lines of the boot log: <br><pre> <code class="hljs mel">UBIFS: <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">14450688</span></span> bytes (<span class="hljs-number"><span class="hljs-number">14112</span></span> KiB, <span class="hljs-number"><span class="hljs-number">13</span></span> MiB, <span class="hljs-number"><span class="hljs-number">112</span></span> LEBs) UBIFS: journal <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">2967552</span></span> bytes (<span class="hljs-number"><span class="hljs-number">2898</span></span> KiB, <span class="hljs-number"><span class="hljs-number">2</span></span> MiB, <span class="hljs-number"><span class="hljs-number">23</span></span> LEBs) UBIFS: media <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>: w4/r0 (latest is w4/r0) UBIFS: <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> compressor: zlib UBIFS: reserved <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root: <span class="hljs-number"><span class="hljs-number">0</span></span> bytes (<span class="hljs-number"><span class="hljs-number">0</span></span> KiB) Freeing unused kernel <span class="hljs-keyword"><span class="hljs-keyword">memory</span></span>: <span class="hljs-number"><span class="hljs-number">196</span></span>k freed BusyBox v1<span class="hljs-number"><span class="hljs-number">.15</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> () built-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> shell (ash) Enter <span class="hljs-string"><span class="hljs-string">'help'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a list of built-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> commands. /bin/sh: can<span class="hljs-string"><span class="hljs-string">'t access tty; job control turned off / # # whoami SuperUser</span></span></code> </pre><br>  Hooray, we are in rootfs. <br><br>  In conclusion, a recommendation on how to increase the rights for users connected via SSH. <br>  Those who worked with this ONT on SSH, saw that not quite traditional Linux shell was launched there, on ONT it is called CLI.  I found the configuration file / var / cli_pw, which contains information about CLI users (primarily SSH users) and has a syntax similar to / etc / passwd <br><br>  It does not make sense to add a user record directly to this file, since  each reboot / var / cli_pw is rewritten from a configuration stored in a different location.  Therefore, I used the autorun script / etc / rcS to add my user to / var / cli_pw.  With each reboot, this command is executed.  Add something to / etc / rcS: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">echo</span></span> <span class="hljs-string"><span class="hljs-string">'alex:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SERCOMM</span></span></span><span class="hljs-string">$/Yr1kjT7kcnd11coqAlgN1:0:0:root:/:/bin/sh'</span></span> &gt;&gt; /var/cli_pw</code> </pre><br>  Editor vi to help. <br>  Accordingly, the user alex will have full administrator rights when connecting via SSH to the ONT. <br>  Now you can return the U-Boot variables to their original values ‚Äã‚Äãand enjoy root access. </div><p>Source: <a href="https://habr.com/ru/post/263277/">https://habr.com/ru/post/263277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263267/index.html">Fault tolerance in MS SQL 2012 for 1C: Enterprise 8.2</a></li>
<li><a href="../263269/index.html">Automation of updating OpenVZ templates on Proxmox</a></li>
<li><a href="../263271/index.html">Comparison of voice assistants for the declared functions and characteristics (Lexi, Ubi, Ivee, Amazon Echo, Jibo, Cubic)</a></li>
<li><a href="../263273/index.html">SHARED.menu - search virtual hosting</a></li>
<li><a href="../263275/index.html">A holy place is never empty - Mirantis Unlocked Appliance</a></li>
<li><a href="../263281/index.html">Upgrading to a new version of HP Application Lifecycle Management (ALM)</a></li>
<li><a href="../263283/index.html">Second life of servers or a couple words about refurbished solutions</a></li>
<li><a href="../263285/index.html">VPS (KVM) in the Netherlands - E3-1230 (2 Cores) / 3.5GB DDR3 / 120GB SSD / 1Gbps 25TB until the end of the summer is completely FREE</a></li>
<li><a href="../263291/index.html">Automatic number image rotation for LPR systems</a></li>
<li><a href="../263293/index.html">Translation of the book "Kingpin". Chapter 34. DarkMarket</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>