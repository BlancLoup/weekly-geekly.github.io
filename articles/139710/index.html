<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google Thumbnail: Getting Thumbnails of Websites</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think everyone knows that in Google search, you can preview the site by opening its preview. 

 Today I will share with you one of the methods for o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google Thumbnail: Getting Thumbnails of Websites</h1><div class="post__text post__text-html js-mediator-article">  I think everyone knows that in Google search, you can preview the site by opening its preview. <br><img src="https://habrastorage.org/storage2/87e/ab8/cd3/87eab8cd344ae025e2384a9e50d03020.jpg"><br>  Today I will share with you one of the methods for obtaining this image. <br><a name="habracut"></a><br><br>  Not so long ago, I wrote one thing (I‚Äôm going to share with you soon) for myself, and I needed to get a preview of the site, anyone. <br><br>  There were several options: <br>  - write your own thumbnail generator, for myself I understand it as - the script should open the page, take a picture of it, and save the image, but you need the whole page with the javascript worked, as I understood you need to expand the server with additional modules and other things, this method does not suit me . <br>  - then a glance fell on ready-made solutions, offering various api resources for getting previews of sites, but being given to the will of an unknown resource doesn't even get freedom everywhere, it was decided to postpone, and later refuse, this approach <br>  - then wordpress came to the rescue, or rather mShots service (you can read it for example <a href="http://habrahabr.ru/blogs/wordpress/129998/">here</a> ), but the service in any case returns an image, which does not allow you to check for its absence (I can share my decision to check the absence of the image), and it also takes some time to create a preview, and the service does not notify about it, except for how it returns in any case the gif preloader. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the last method, it was decided to stop, and continue the search for a more stable method.  The search took place in Google Seach and it was difficult not to pay attention to the fact that it provides a screenshot of the site (as it turned out, he gets them from his cache), and then the thought came - ‚ÄúAnd why not?‚Äù <br>  So began the search for a way to get images from google. <br><br>  The first cases looked query: <br><br><img src="https://habrastorage.org/storage2/95e/7a2/db1/95e7a2db1496e7b00ba6a90527b4e7f5.jpg"><br><br>  As you can see nothing joyful, a bunch of incomprehensible parameters. <br>  I will not describe every parameter, I don‚Äôt know everything, I can only say that ‚Äúj‚Äù and ‚Äúb‚Äù can be safely removed, and ‚Äúa‚Äù is our unique three-digit hash, which, as it turned out, is embedded in the html page markup, from where and you can get it by parsing it. <br><br>  I decided to try this approach, the logic was as follows: <br>  - we carry out a search, we need to find a site in our task, so we search for the site: http: //domain.zone <br>  - the parsim received and find our hash and url <br>  - we form the necessary request and we receive required <br><br>  Everything seems to be logical, so I started to work. <br>  By the will of fate and lack of time, he postponed this work and forgot about it until tonight, <br>  and it reminded me of the resource <a href="http://goo.gl/">goo.gl</a> , or rather the new design, and new features, including the preview of the page to which we want to get a short url.  Yes, for those who do not know goo.gl provides an opportunity to get a short url. <br><br>  I decided to look for information on the request ‚Äúclients1.google.com/webpagethumbnail‚Äù, google seach refers to this address for taking screenshots of sites, and came across <a href="http://phpotdel.ru/2012/03/02/skript-zagruzki-skrinshotov-s-google.html">this</a> article, here I have already described the implemented method that I initially wanted to implement. <br><br>  A little upset, and at the same time glad that there is already ready for my bun, I returned with interest to goo.gl, look here at the sent requests, and what I see: <br><img src="https://habrastorage.org/storage2/738/db0/9da/738db09da5fda1f9ed34d58af7fb2716.jpg"><br><br>  There are no scary parameters here, there is a url api of our shortcut, and there are two parameters: <br>  - security_token - as I understood the optional parameter (correct me if I'm wrong) <br>  - url - and the address at which we want to get information <br><br>  Everything is very clear and understandable, there are no restrictions, we try to get what we want.  I wrote a small test script, on which I experimented, I got this: <br><pre><code class="php hljs">header(<span class="hljs-string"><span class="hljs-string">'Content-Type: text/html; charset=utf-8'</span></span>);<span class="hljs-comment"><span class="hljs-comment">//  define('URL_API', 'http://goo.gl/api/shorten');//        /* *         * * @param string $wab_page * url ,     * @param string $url * url   * @param boolean $header *        * * @return boolean or decode json *   true,  $header=TRUE   , *      decode json */ function http_request($wab_page, $url=URL_API, $header=FALSE) { $ch = curl_init();//  curl_setopt($ch, CURLOPT_HEADER, $header);///   curl_setopt($ch, CURLOPT_NOBODY, $header);///    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, TRUE);//   "Location: " curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);// curl   ,    if(!$header){//       ,    curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.7 (KHTML, like Gecko) Chrome/16.0.912.77 Safari/535.7');//  curl_setopt($ch, CURLOPT_POST, TRUE);//      POST curl_setopt($ch, CURLOPT_POSTFIELDS, 'url='.urlencode($wab_page).'&amp;security_token=');// ,      post }else{//   curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);// curl    } curl_setopt($ch, CURLOPT_URL, $url);//c ,    $response = curl_exec($ch);//  curl curl_close($ch);//  curl     if($header){//   ,  if(strpos($response, "200 OK")!==false)//  ,  200    return true;//   }else//  ,  return json_decode($response);// decode json    } $wab_page='http://bd.com.ua/';//     $request=http_request($wab_page);//    if($request){//   ,  $img=$request-&gt;preview_url;// url  $short_url=$request-&gt;short_url;//    if(http_request(null,$img,true)){//  ,   echo $wab_page.' - &lt;a href="'.$short_url.'"&gt;'.$short_url.'&lt;/a&gt;&lt;br/&gt;&lt;img src="'.$img.'"&gt;';//  }else{//   echo $wab_page.' - &lt;a href="'.$short_url.'"&gt;'.$short_url.'&lt;/a&gt;&lt;br/&gt;       ';//  } }else{ echo '  =('; }</span></span></code> </pre> <br><br>  Commented out all the code so that it would be clear what I'm doing here.  The file can be downloaded <a href="http://dl.dropbox.com/u/37043322/habr/screenshot/index.php">here</a> . <br><br>  I will briefly describe: <br>  - First of all, we make a request to the address api " <a href="http://goo.gl/api/shorten">goo.gl/api/shorten</a> ", in response we get a json line with information: "short_url", "long_url", "creation_time", "preview_url" <br>  - then I check the existence of the image (because, as I understand it, the path to the image is always returned), checking the headers for status 200 <br>  - if everything is good then we give the picture, not all are well informed about it <br><br>  What I like this approach more than anyone else: <br>  - I depend only on Google, it is unlikely to just close, or stop working as a third-party resource, on the other hand, it can cover up this possibility of getting previews (but in this case I have mShots) <br>  - This approach is faster and shorter in code than inquiries to a search engine and parse pages <br>  - And then I can still get a short address that is a positive addition for my task. <br><br>  Unfortunately, the test page did not, I'm afraid the hosting will not stand, if someone can suggest where you can place the page, I will gladly follow the advice. <br><br>  That's all, I hope many will be useful information, I guess where they will immediately find many applications. <br><br>  PS I‚Äôm waiting for any corrections and additions, I‚Äôm especially interested in how to improve my existing code, I apologize in advance for possible inaccuracies and especially spelling, the time of day is affected. </div><p>Source: <a href="https://habr.com/ru/post/139710/">https://habr.com/ru/post/139710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139704/index.html">Comparative test of programs that prevent attacks on ARP-table</a></li>
<li><a href="../139705/index.html">X server for Android</a></li>
<li><a href="../139706/index.html">Work with large Excel files</a></li>
<li><a href="../139707/index.html">Twitter has turned on SPDY support</a></li>
<li><a href="../139708/index.html">Sync vs Async on the example of Firebird</a></li>
<li><a href="../139711/index.html">Right to be forgotten</a></li>
<li><a href="../139713/index.html">How to search for programmers in the regions? We found an effective way. Sharing ...</a></li>
<li><a href="../139717/index.html">Android SDK: struggling with image memory size limits</a></li>
<li><a href="../139718/index.html">Prosto in Google Web Fonts</a></li>
<li><a href="../139719/index.html">Repository pattern in conjunction with Mongoose ODM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>