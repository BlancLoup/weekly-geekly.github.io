<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple game by means of PTK "Quint 7"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 

 We continue the theme of writing simple and amusing programs using the Russian development KVINT 7 . In previous posts it was shown how you ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple game by means of PTK "Quint 7"</h1><div class="post__text post__text-html js-mediator-article">  Hello. <br><br>  We continue the theme of writing simple and amusing programs using the Russian development <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25A2%25D0%259A_%25D0%259A%25D0%25B2%25D0%25B8%25D0%25BD%25D1%2582">KVINT 7</a> .  In previous posts it was shown how you can quickly and easily write a toy like a <a href="http://habrahabr.ru/post/205324/">snake</a> or a <a href="http://habrahabr.ru/post/218057/">sapper</a> .  But despite the fact that these are two completely different toys, from the point of view of programming at CFC (as a result of a dispute with one comrade, they came to the conclusion that this language is nevertheless closer to CFC than to FBD) it was actually the same program with minor cosmetic changes.  In this article, we will look at a new programming example by writing a simple BlackJack toy from scratch.  If you are interested in this topic, welcome under cat. <br><img src="https://habrastorage.org/files/af7/b1e/076/af7b1e07631c458dbdc67df761017d8a.png" width="513"><br><a name="habracut"></a><br><h3>  Formulation of the problem </h3><br>  The task is quite simple - to write with the help of the Quint 7 hardware and software complex the game of ‚ÄúBlackjack‚Äù.  But in the process of learning the rules of the game, it turned out that there are a huge amount of blackjack variations.  Starting from how many decks are used in the game and ending with all sorts of options such as "insurance against loss", "split cards", "double bet", etc.  etc.  Let's stop on the simplest option: <br><ul><li>  one deck </li><li>  without the possibility of doubling, insurance, splitting, etc. </li><li>  one player plays against a casino (in our case against PTK) </li></ul><br>  Of course, there are still a number of assumptions that will be explained along the way.  It should be noted that the remaining options are implemented extremely simply within five minutes by adding several additional checks to the original program. <br>  The task is set, now we can begin to implement.  And here, unlike the previous examples, we will start with the graphic part. <br><br><h3>  Making a graphical interface </h3><br>  First of all, we are looking for a background image on the Internet.  For example: <br><div class="spoiler">  <b class="spoiler_title">Background image</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0f4/eeb/31b/0f4eeb31b2614de9b50c157cc39dba0b.png"></div></div><br>  This wallpaper is perfect for us, because  it already has chips with face values ‚Äã‚Äãfor bets and a distribution button. <br>  Next we need maps.  Here the biggest problem arose, since  Immediately it was not possible to find pictures of a deck of cards that would fit in size and style.  As a result, I had to arm myself with paint and draw all the cards myself. <br>  It remains to insert several fields with numbers, buttons to start and end the game, buttons to ‚Äútake another card‚Äù and ‚Äústop‚Äù, as well as several pop-up pictures indicating the result of the game. <br>  Place it all on our background and get the following picture: <br><div class="spoiler">  <b class="spoiler_title">Full figure</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f41/7b2/e35/f417b2e3514048e0bad95c29791621f8.png"></div></div><br>  It looks like a jumble, where the elements are superimposed on each other and nothing is clear.  But we haven't done the animation yet.  When the program is ready, most of the elements will be invisible and appear only according to the specified condition. <br>  In addition, an attentive reader may notice an obvious error, which will lead to incorrect distribution in about 0.00001% of cases.  But for example, I decided to leave everything as it is. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  We write the program </h3><br>  So, the graphics are ready for us and it's time to revive it.  Let's start by understanding what should happen in our program. <br><br>  1. We need a random map generator.  Here we use the old proven method: <br><img src="https://habrastorage.org/files/030/17e/2ba/03017e2ba3eb463b9d6d23f874872216.png"><br>  There are two rapidly changing numbers that are ‚Äúrandom‚Äù when the player presses a button.  We divide them into each other, discard the whole part and the first 4 decimal places, and leave the entire tail that we translate into a scale of 1-52.  Next, we put a check indicating for which player the card was generated.  Thus, using a few simple algorithms, we got a good random number generator in a couple of minutes. <br><br>  2. Now make a macro for a set of cards by players.  Here the task is somewhat more complicated.  And as I showed in previous posts, the easiest way to solve it is to figure out what we still want from this macro. <br><br>  Inputs: <br><br>  - First, we need a team to add a card to the set.  So let's call it: "Add a card." <br>  - Next, we need the card itself, which we will add.  Create an appropriate input and name it ‚Äúmap‚Äù. <br>  - In addition, if you look at the random number generation macro, we see that it simply gives out a random integer in the range from 1 to 52. However, we agreed to make a single-decker Blackjack, and therefore the cards should not be repeated.  Thus, for analysis, we need to add two inputs: ‚ÄúOpen Player Cards‚Äù and ‚ÄúDealer's Open Cards‚Äù so that we can ‚Äúsee‚Äù which cards have already come out of the deck and generate a random number once again when the already opened card falls out.  And so on until one of the previously not drawn cards falls out. <br>  - Before each new distribution, you need to take all the cards from the players and put them in a deck.  Therefore, you need the input "Reset", which will reset all the player and dealer cards. <br>  - Last entry "Hide map".  As mentioned above, the rules of the game in Blackjack are great.  During the initial distribution, the dealer can take only one card, showing it to the player, or maybe two at once, one of which is open and the second is hidden and the dealer opens it only when the turn passes to him.  From the point of view of probability for the player, these two options are absolutely the same.  But for everything to be completely ‚Äúhonest‚Äù, the second option is used here (the dealer immediately takes two cards), and for this you need a sign that allows you to hide the second dealer card at the beginning of the hand. <br><br>  Outputs: <br><br>  - "Cards".  This exit shows the player and dealer cards. <br>  - "One more attempt".  If a random number generator has thrown out a card that has already been opened, then this feature is formed, which allows again to generate a random number. <br>  - "Card processing."  As mentioned above, the dealer immediately takes two cards, one of which he hides (in our case, this is code 54).  However, in reality, the card from the deck has already been taken and the player cannot take the same card.  Consequently, we will use the first ‚ÄúCard‚Äù output for displaying in the graphical interface, where the dealer‚Äôs second card is replaced with code 54. And the ‚ÄúCard‚Äù output is used for analyzing already dropped cards and scoring. <br><br>  The result is this macro: <br><img src="https://habrastorage.org/files/c25/a97/f42/c25a97f42aa344d5a295a4ecbb6e11b9.png"><br><div class="spoiler">  <b class="spoiler_title">Macro content and description of its work</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f94/ec1/e48/f94ec1e481884f229c51279a6dbe4402.png"><br>  Macro is extremely simple.  We take the entrance "Map" and compare with all the cards that are already in the hands of the players.  If it is new (on all comparisons, the &lt;&gt; check is performed) then on the algoblock ‚Äú24.  Slave1 "add its sequence number and write it in the appropriate memory cell.  If the check for uniqueness has not been completed, then we will trigger the trigger ‚Äú21.RS1‚Äù and begin to generate cards again until the check is completed.  The "reset" command clears all memory cells and the sequence number of the card being handed over.  With the command "Hide card" we substitute the second dealer card with code 54 (displayed in the graphical interface as a card shirt). </div></div><br><br>  3. Now that the cards have been dealt, it's time to count the points.  To do this, create a "Scoring" macro with the following inputs and outputs. <br><br>  Inputs: <br><br>  - "Cards".  Actually the set of cards, on the basis of which we must calculate the number of points. <br>  - "Hide map".  Dealer's closed card is replaced by zero points. <br><br>  Outputs: <br><br>  - "Points".  The number of points player and dealer.  Displayed in the GUI. <br>  - "Points processing."  The number of points along with the dealer's hidden card. <br>  - "Bust".  The logical sign that the player scored more than 21 points. <br><br>  The result is a macro: <br><img src="https://habrastorage.org/files/407/5f5/4f8/4075f54f88b348eca81a37440d3b2e2c.png"><br><div class="spoiler">  <b class="spoiler_title">Macro content and description of its work</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/6a6/3fb/8be/6a63fb8be9bf434c95139c0db749caa5.png"><br>  There is nothing complicated.  At the entrance is a map.  Next, the nested macro converts the card into points.  The points are summed up and checked for exceeding the threshold of 21. If there is an excess, then with a delay of 50 msec a sign of ‚Äúbrute force‚Äù is issued.  At the same time, the second card of the dealer, which is closed, equals zero points on the basis of the ‚ÄúHide card‚Äù feature.  The question is only a delay of 50 msec.  To clarify the situation, consider the nested macro ‚ÄúCard processing‚Äù which gives the corresponding number of points to the card. <br><img src="https://habrastorage.org/files/a8a/400/f75/a8a400f7519c4e449df64f8bea32bbc3.png"><br>  and more: <br><img src="https://habrastorage.org/files/91d/83d/746/91d83d746e024013b0e3e3507d2cfe62.png"><br>  We have 52 cards from deuce to ace of four different suits.  They are encoded as follows: 1 - a double of diamonds, 2 - a three of diamonds, ... 13 - an ace of diamonds, 14 - a two of spades, etc.  Hence the principle of scoring.  We divide the card code with a remainder by 13. The quotient will be equal to the suit, and the remainder will be the card.  It is easy to see that the code of the ace will always give zero in the balance.  Now convert the map to points.  If the remainder of the division lies in the range from 1 to 9, then the points that gives the map correspond to the remainder plus one, which is realized by means of algoblock ‚Äú7.  Compound1.  Cards Jack, Queen and Queen give 10 points.  But with an ace all smarter.  According to the rules of the game, an ace can give both 11 points and one point in the event that a bust is obtained with 11 points.  If you look at algoblocks 3-5 and 9-12, then you can see that initially the ace (the quotient from dividing the card code is not zero, and the remainder is zero) equates to 11 points, however, if the ‚Äúbrute force‚Äù signal arrives, the trigger ‚Äú 10.RS1 "and the ace is equal to 1 point already.  Since  the ‚Äúbrute force‚Äù signal comes through feedback with a delay of 10 msec, then to prevent the player from premature defeat (and the brunt happened just because of 11 ace points) we set the delay to 50 msec to have time to recalculate the points. <br></div></div><br><h3>  Final program </h3><br>  The basis of our program (macros, discussed above) is ready.  It remains to arrange them on the field and make a harness to control and display the results. <br><div class="spoiler">  <b class="spoiler_title">The final program.</b>  <b class="spoiler_title">Habrastorage.</b>  <b class="spoiler_title">The picture is very big.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/695/f4d/53d/695f4d53df004ed39f1310d143664d85.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">The final program.</b>  <b class="spoiler_title">Radikal.</b>  <b class="spoiler_title">The picture is very big.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/73a/26d/8c4/73a26d8c48292a70f91987d6f8b6acb4.png"></div></div><br>  A brief explanation of the final program. <br>  As the main control is used automatic unit "1.Ruchselektor1".  On command from the operator station, it forms a unit for 10 ms at the corresponding output.  The comments sign what bit that means. <br><br>  - To start the game on the first selector unit is set to the first exit.  At this command, the trigger "3.RS8" is cocked, which contains a sign that the game is in progress. <br>  - The unit at the second output of the selector resets all triggers, resets all counters and stored states and brings the program back to its original state. <br>  - The unit at the third exit of the selector starts the round.  In this case, the trigger "14.RS5" is cocked only if the trigger is triggered "Going the game" and at the same time made a bet.  After the platoon of this trigger, the formation of 4 pulses is triggered, according to which the player and the dealer are dealt two cards each. <br>  - The unit at the fourth exit generates an impulse, according to which another player is given a card. <br>  - The unit at the fifth exit cocks the trigger "31.RS10" and blocks the player from taking cards.  At the same time, the distribution of cards to the dealer is started.  There is made one amendment.  According to the rules of the casino, the dealer must stop as soon as he has scored 17 or more points, regardless of how many points the player has (this is even written on the background picture by the way).  But if the game is 1 to 1 then this rule does not make sense.  Therefore, an algorithm is implemented according to which the dealer draws cards as long as his points are less than the player‚Äôs.  Of course, if the player is busting, then the dealer does not take cards at all.  the round ends here. <br>  - The unit at the sixth exit resets the trigger round and the memorized cards.  Thus, the program is ready for a new distribution. <br><br>  Then the conditions of the end of the round are checked and if the player has won, then he is charged a number of chips equal to the bet, and the dealer accordingly takes as many chips.  If a player loses, his bet goes to the dealer.  With equality, everyone stays with his own. <br>  The accumulated amount of chips (and initially from the player and the dealer for 1000 chips) is compared with zero (algoblocks "98. Comparable 8" and "99. Comparable 9") and the corresponding trigger trigger victory or defeat in the game. <br><br>  That's all.  The program is ready.  Compile and load all this into the controller. <br><div class="spoiler">  <b class="spoiler_title">Program statistics</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/6f7/e69/190/6f7e6919037b4e2787e3750c872aeb63.png"></div></div><br>  We tie the graphical interface drawn at the very beginning to the signals in the program and can be played. <br><div class="spoiler">  <b class="spoiler_title">The initial state</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c92/a1f/908/c92a1f908e95475fb740c4e480d36376.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Started the game</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/89d/c5b/a9d/89dc5ba9d1fc4a9b94e86fbde1e73621.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Distribution</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/5e7/111/8b4/5e71118b489342239b2b178ff7fb33e4.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Losing distribution</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f37/269/bdf/f37269bdf2cc400cbe6d3bee6ac27386.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">And we win!</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/1e7/e7b/e94/1e7e7be94c554749948b32e3f153abe1.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Combine with work :)</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c9a/961/945/c9a961945d884f12938d403551468d46.png"></div></div><br><br><h3>  Brief conclusions </h3><br>  Unlike the previous examples, when the task contained several thousand algoblocks, this time it took only 600 pieces.  Moreover, as you can see, most algoblocks are inside macros. <br>  To accomplish this task it did not take long and tedious study of reference books or search for answers to questions on the Internet.  Everything is written with the help of the simplest algorithms such as "and", "or", "addition", "division", "trigger", etc., the principle of which is clear to the student. <br>  At the same time, the task was done in less than a day (the whole project took 3 days. Not complete, of course. Somewhere for 2-3 hours a day in total. And I spent the first two days to paint maps, paint, and other pictures in paint ) turned out not bulky and, if desired, it can be easily modified.  In the beginning I wrote that blackjack will be single-decked.  So - in five minutes you can remake the program for any number of decks.  It is enough to put a match counter in the macro when checking the card for uniqueness.  If there are 3 decks, then the same card may fall out three times and therefore the ‚Äúanother attempt‚Äù sign must be cocked when the card appeared for the fourth time. <br>  Other edits are also easy to make. <br>  We conclude the article with a phrase about how ‚Äúfun and easy to write programs on CFC‚Äù. <br><br>  Thanks to all who read to the end.  I hope it was interesting. <br><div class="spoiler">  <b class="spoiler_title">Ps.</b>  <b class="spoiler_title">The answer to the question about the error.</b> <div class="spoiler_text">  At the very beginning I wrote about an error (which I intentionally left), leading to an incorrect distribution.  So, the mistake is that there are only eight slots for cards.  In theory, a player may fall 4 deuces, 4 triples and aces in addition.  As a result, even eight cards will fail to score more than 21 points.  But since  there will be no card slots left, the player will have to press the ‚ÄúEnough‚Äù button and transfer the move to the dealer.  However, the chance of such a distribution is very, very small, so it was decided to leave this error for the question the most attentive. </div></div><br><br>  UPD.  I just noticed that on habrastorage the big picture is compressed and you can‚Äôt see it in normal resolution using the link provided (at least for me).  Perezalil picture on radikal. </div><p>Source: <a href="https://habr.com/ru/post/254665/">https://habr.com/ru/post/254665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254647/index.html">IT management and support - Fujitsu's job offer</a></li>
<li><a href="../254649/index.html">"Collect 3 hearts, 3 skulls and 3 swords in one shift", or how we made the game</a></li>
<li><a href="../254655/index.html">Sports watch with built-in cell phone do it yourself</a></li>
<li><a href="../254657/index.html">Video reports from the conference IT NonStop Voronezh 2015</a></li>
<li><a href="../254659/index.html">Using Xen functionality</a></li>
<li><a href="../254667/index.html">Theory and practice of migration of web systems to PostgreSQL</a></li>
<li><a href="../254671/index.html">Hard Drive Killers. Coercive headshot</a></li>
<li><a href="../254673/index.html">Softbank is going to connect talking robot Pepper to IBM Watson</a></li>
<li><a href="../254675/index.html">Code optimization with RequireJS: how it is done and why it is needed</a></li>
<li><a href="../254677/index.html">Unity 3d 4.6 (5) project Survival shooter game in Russian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>