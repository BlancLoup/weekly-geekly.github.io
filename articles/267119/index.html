<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practice IronScheme</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am sure that you will stop playing ‚Äúmeat‚Äù, because what I am about to tell you will seem very interesting to you, if only because you will not under...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practice IronScheme</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/b0a/343/d7a/b0a343d7a24d486c8045826eb28353ad.png"></div><br><blockquote>  I am sure that you will stop playing ‚Äúmeat‚Äù, because what I am about to tell you will seem very interesting to you, if only because you will not understand many special terms. <br>  Jaroslav Hasek </blockquote><br><br>  <a href="http://habrahabr.ru/company/tcsbank/blog/267015/">Part 1 Introduction to Scheme</a> <br>  <a href="http://habrahabr.ru/company/tcsbank/blog/267113/">Part 2 Groove in the Scheme</a> <br>  <a href="http://habrahabr.ru/company/tcsbank/blog/267119/">Part 3 Practicing IronScheme</a> <br><br><h2>  Practice </h2><br>  Now we will create several applications that are closer to real life than the examples from the previous article.  Philosophical issues and the basics of development, we discussed in previous articles, so this will consist mainly of code. <a name="habracut"></a>  I hope that the code will be easy to read, so I will not provide it with abundant comments. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, let's look at how you can access .net classes from IronScheme <br><br>  The program on IronScheme begins with the import of libraries: <br><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">import</span></span> (<span class="hljs-name"><span class="hljs-name">rnrs</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span>) )</code> </pre> <br>  To use functions for interacting with the CLR, you need to import the library (ironscheme clr): <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">import</span></span> (<span class="hljs-name"><span class="hljs-name">rnrs</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span> clr) )</code> </pre><br>  Now we have the following functions: <br>  <b>(clr-namespaces)</b> <br>  Returns all imported namespaces. <br><br>  <b>(clr-reference reference)</b> <br>  Connects an assembly to an application, for example (clr-reference System.Web). <br><br>  <b>(clr-using namespace)</b> <br>  Imports a namespace: (clr-using System.IO). <br><br>  <b>(clr-call type method instance arg ...)</b> <br>  Calls the object method. <br><br>  <b>(clr-cast type expr)</b> <br>  Brings the object to the specified type. <br><br>  <b>(clr-is type expr)</b> <br>  Checks if the object is of the specified type. <br><br>  <b>(clr-new type arg ...)</b> <br>  Creates an instance of the class and passes the arguments to the constructor. <br><br>  <b>(clr-new-array type size)</b> <br>  Creates an array with the specified type and size. <br><br>  <b>(clr-event-add! type event instance handler)</b> <br>  Adds an event handler. <br><br>  <b>(clr-event-remove! type event instance handler)</b> <br>  Removes an event handler. <br><br>  <b>(clr-field-get type field instance)</b> <br>  Get field value. <br><br>  <b>(clr-field-set! type field instance expr)</b> <br>  Assign a field value. <br><br>  <b>(clr-prop-get type property instance)</b> <br>  Returns the value of the property. <br><br>  <b>(clr-prop-set! type property instance expr)</b> <br>  Sets the value of the property. <br><br>  <b>(clr-static-call type method arg ...)</b> <br>  Call a static method. <br><br>  <b>(clr-static-event-add! type event handler)</b> <br>  Adds a handler for a static event. <br><br>  <b>(clr-static-event-remove! type event handler)</b> <br>  Removes a handler. <br><br>  <b>(clr-static-field-get type field)</b> <br>  Returns the value of a static field. <br><br>  <b>(clr-static-field-set! type field expr)</b> <br>  Sets the value to a static field. <br><br>  <b>(clr-static-prop-get type property)</b> <br>  Returns the value of a static property. <br><br>  <b>(clr-static-prop-set! type property expr)</b> <br>  Sets the value of a static property. <br><br><h2>  Hello, world 2.0 </h2><br>  Let's try?  Create a hello-world-clr.ss file with the contents: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">import</span></span> (<span class="hljs-name"><span class="hljs-name">rnrs</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span> clr) ) (<span class="hljs-name"><span class="hljs-name">clr-static-call</span></span> Console WriteLine <span class="hljs-string"><span class="hljs-string">"Hello, world"</span></span>)</code> </pre><br>  This example demonstrates calling the static WriteLine method of the System.Console class. <br><br><h2>  Just a timer </h2><br>  Now the example is more interesting, we start the timer. <br><br>  As usual, we first import the libraries: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">import</span></span> (<span class="hljs-name"><span class="hljs-name">rnrs</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span> clr) )</code> </pre><br>  Import the namespace: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">clr-using</span></span> System.Threading)</code> </pre><br>  For ease of use, we will write two clr call wrapper functions.  The first function creates an object of class Timer, the second changes the basic parameters of the timer: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">timer-new</span></span> handler) (<span class="hljs-name"><span class="hljs-name">clr-new</span></span> Timer handler) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">timer-change</span></span> timer due-time period) (<span class="hljs-name"><span class="hljs-name">clr-call</span></span> Timer Change timer (<span class="hljs-name"><span class="hljs-name">clr-cast</span></span> System.Int32 due-time) (<span class="hljs-name"><span class="hljs-name">clr-cast</span></span> System.Int32 period)) )</code> </pre><br><br>  Casting with clr calls is needed to bring views from the internal IronScheme to .Net types. <br><br>  Another useful function would be to block the main thread of the application so that the program does not end: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">console-block</span></span>) (<span class="hljs-name"><span class="hljs-name">clr-static-call</span></span> Console WriteLine <span class="hljs-string"><span class="hljs-string">"Press &lt;Enter&gt; to terminate"</span></span>) (<span class="hljs-name"><span class="hljs-name">clr-static-call</span></span> Console ReadLine) )</code> </pre><br>  To use a timer, you must first declare a handler function: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">time-handler</span></span> obj) <span class="hljs-comment"><span class="hljs-comment">;; some code )</span></span></code> </pre><br>  Then create a timer object: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> timer (<span class="hljs-name"><span class="hljs-name">timer-new</span></span> time-handler))</code> </pre><br>  And we start the timer specifying the period and delay: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">timer-change</span></span> timer delay period)</code> </pre><br>  Now all together, an example prints the number of operations to the console. <br><div class="spoiler">  <b class="spoiler_title">Full source example of using the timer</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">import</span></span> (<span class="hljs-name"><span class="hljs-name">rnrs</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span> clr) ) (<span class="hljs-name"><span class="hljs-name">clr-using</span></span> System.Threading) <span class="hljs-comment"><span class="hljs-comment">;; *************************************** (define (timer-new handler) (clr-new Timer handler) ) (define (timer-change timer due-time period) (clr-call Timer Change timer (clr-cast System.Int32 due-time) (clr-cast System.Int32 period)) ) (define (console-block) (clr-static-call Console WriteLine "Press &lt;Enter&gt; to terminate") (clr-static-call Console ReadLine) ) ;; *************************************** (define counter 0) (define period 1000) ;;ms (define (time-handler obj) (set! counter (+ counter 1)) (displayln counter) ) (define timer (timer-new time-handler)) (timer-change timer 0 period) (console-block)</span></span></code> </pre><br></div></div><br><br><h2>  We work with Oracle DB </h2><br>  I give an example of connecting and querying Orcale DBMS.  I believe that the reader can already figure it out himself, so I will not describe what is happening here and how.  Initially, the program declared functions for working with Oracle, then for the already familiar Timer.  Then a connection to the database is created and a request is made by timer, the result of the request is output to the console. <br>  The example is taken from a real application used for monitoring.  Naturally confidential code fragments are replaced by ‚Äú*****‚Äù, but they are not critical for understanding or using the example to develop your own programs. <br><br><div class="spoiler">  <b class="spoiler_title">Source code for an example of working with an Oracle database</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">import</span></span> (<span class="hljs-name"><span class="hljs-name">rnrs</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span> clr) ) <span class="hljs-comment"><span class="hljs-comment">;; **************** Oracle **************;; (clr-reference System.Data) (clr-reference System.Data.OracleClient) (clr-using System.Data.OracleClient) (define (ora-connection-new connection-string) (clr-new OracleConnection (clr-cast System.String connection-string)) ) (define (ora-connection-open connection) (clr-call OracleConnection Open (clr-cast OracleConnection connection)) ) (define (ora-connection-create connection-string) (define connection (ora-connection-new connection-string)) (ora-connection-open connection) connection ;; return ) (define (ora-command-new connection sql-string) (clr-new OracleCommand (clr-cast System.String sql-string) (clr-cast OracleConnection connection)) ) (define (ora-command-parameter-add command key value) (clr-call OracleParameterCollection Add (clr-prop-get OracleCommand Parameters command) (clr-cast System.String key) (clr-cast System.Object value) ) ) (define (ora-execute-reader command) (clr-call OracleCommand ExecuteReader (clr-cast OracleCommand command)) ) (define (ora-read reader) (clr-call OracleDataReader Read (clr-cast OracleDataReader reader)) ) (define (ora-get-value reader key) (clr-call OracleDataReader GetValue reader (clr-call OracleDataReader GetOrdinal reader key) ) ) (define (ora-get-string reader key) (clr-call Object ToString (ora-get-datetime reader key)) ) (define (ora-get-int32 reader key) (clr-call OracleDataReader GetInt32 reader (clr-call OracleDataReader GetOrdinal reader key) ) ) (define (ora-get-datetime reader key) (clr-call OracleDataReader GetDateTime reader (clr-call OracleDataReader GetOrdinal reader key) ) ) ;;***************************************;; ;; **************** Timer ***************;; (clr-using System.Threading) (define (timer-new handler) (clr-new Timer handler) ) (define (timer-change timer due-time period) (clr-call Timer Change timer (clr-cast System.Int32 due-time) (clr-cast System.Int32 period)) ) (define (console-block) (clr-static-call System.Console WriteLine "Press &lt;Enter&gt; to terminate") (clr-static-call System.Console ReadLine) ) ;;***************************************;; ;;######## GLOBAL #########;; (define connection-string "Data Source=*****;User ID=*****;Password=*****;") ;;#########################;; (define (complect-print reader) (import (srfi :13)) (let loop ((index 1)) (if (ora-read reader) (begin (display " (") (display (string-pad-right (number-&gt;string index) 5)) (display (string-pad-right (ora-get-value reader "*****") 15)) (display " ") (display (string-pad-right (ora-get-value reader "*****") 20)) (display " ") (display (ora-get-int32 reader "*****")) (display " ") (display (string-pad-right (ora-get-value reader "*****") 25)) (display " ") (display (ora-get-string reader "*****")) (displayln ")") (loop (+ index 1)) ) ) ) ) (define (complect-display connection status) (define sqlStr "select * from ***** where ***** = :complect_status") (define cmd (ora-command-new connection sqlStr)) (define reader '()) (ora-command-parameter-add cmd "complect_status" status) (set! reader (ora-execute-reader cmd)) (display "(complect-status ") (displayln status) (complect-print reader) (displayln ")") (clr-call OracleDataReader Close reader) ) (define (time-handler obj) (define connection (ora-connection-create connection-string)) (clr-static-call System.Console Clear) (displayln "\n;; ************************************************************************* ;;\n") (complect-display connection 1) (newline) (complect-display connection 2) (newline) (complect-display connection 3) (newline) (complect-display connection 4) (displayln "\n;; ************************************************************************* ;;\n") (clr-call OracleConnection Close connection) ) (define timer (timer-new time-handler)) (timer-change timer 0 3000) (console-block)</span></span></code> </pre><br></div></div><br><br><h2>  WindowsForms </h2><br>  And in conclusion I will give a simple example of a window application.  In this example, I did not bother with .NET call wrappers, since  I was important demonstration of the principle, the fact that it is possible.  Of course, if you wrap up calls, the size of the code will be reduced, due to reuse. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">import</span></span> (<span class="hljs-name"><span class="hljs-name">rnrs</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span>) (<span class="hljs-name"><span class="hljs-name">ironscheme</span></span> clr) ) (<span class="hljs-name"><span class="hljs-name">clr-reference</span></span> System.Windows.Forms) (<span class="hljs-name"><span class="hljs-name">clr-using</span></span> System.Windows.Forms) (<span class="hljs-name"><span class="hljs-name">define</span></span> main-form (<span class="hljs-name"><span class="hljs-name">clr-new</span></span> Form)) (<span class="hljs-name"><span class="hljs-name">clr-prop-set!</span></span> Form Text main-form <span class="hljs-string"><span class="hljs-string">"--== Hello, world ==--"</span></span>) (<span class="hljs-name"><span class="hljs-name">clr-prop-set!</span></span> Form Size main-form (<span class="hljs-name"><span class="hljs-name">clr-new</span></span> System.Drawing.Size <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">480</span></span>)) (<span class="hljs-name"><span class="hljs-name">define</span></span> lbl-message (<span class="hljs-name"><span class="hljs-name">clr-new</span></span> Label)) (<span class="hljs-name"><span class="hljs-name">clr-prop-set!</span></span> Label Text lbl-message <span class="hljs-string"><span class="hljs-string">"Message: \"Hello, Windows Forms(IronScheme) World!\""</span></span>) (<span class="hljs-name"><span class="hljs-name">clr-prop-set!</span></span> Label Size lbl-message (<span class="hljs-name"><span class="hljs-name">clr-new</span></span> System.Drawing.Size <span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>)) (<span class="hljs-name"><span class="hljs-name">clr-prop-set!</span></span> Label Location lbl-message (<span class="hljs-name"><span class="hljs-name">clr-new</span></span> System.Drawing.Point <span class="hljs-number"><span class="hljs-number">150</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span>)) (<span class="hljs-name"><span class="hljs-name">clr-call</span></span> Form+ControlCollection Add (<span class="hljs-name"><span class="hljs-name">clr-prop-get</span></span> Form Controls main-form) lbl-message) (<span class="hljs-name"><span class="hljs-name">clr-static-call</span></span> Application Run (<span class="hljs-name"><span class="hljs-name">clr-cast</span></span> Form main-form))</code> </pre><br><br><h2>  As a conclusion </h2><br>  In this article I tried to demonstrate that for Scheme nothing is impossible, at least executable over .NET.  This does not mean that you should drop the familiar C # and start coding on Scheme.  Of course, Scheme programming has certain advantages, it becomes clear as consciousness penetrates deeper into Lisp ideology.  But still, support from the C # studio with ReSharper everyone there, is left far behind Scheme as the main language for developing for .NET.  Of course, you can implement first-class support for Lisp over .NET, but obviously not many would need it otherwise they would have done it a long time ago.  However, Lisp and in particular Scheme can be extremely useful as an embedded language.  In such a role, it has certain advantages over other embedded languages.  With Lisp, you can implement readable and flexible configuration files, a console interface for managing an application, transferring data over a network, and more.  But more on this later in the following articles. </div><p>Source: <a href="https://habr.com/ru/post/267119/">https://habr.com/ru/post/267119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267109/index.html">In the Norwegian abandoned mine will build the largest data center in Europe</a></li>
<li><a href="../267111/index.html">BabylonJS. Lesson 2 - Basic Meshes</a></li>
<li><a href="../267113/index.html">Deepen in Scheme</a></li>
<li><a href="../267115/index.html">Back to basics</a></li>
<li><a href="../267117/index.html">Security Week 38: Attack on Cisco routers, bug in AirDrop, arrest of cryptobarg</a></li>
<li><a href="../267121/index.html">Links search - getting data about Portmone and Fidobank clients</a></li>
<li><a href="../267123/index.html">Histogram and box with a mustache on the fingers</a></li>
<li><a href="../267125/index.html">Hexagonal architecture</a></li>
<li><a href="../267127/index.html">Airbnb pricing algorithm secrets</a></li>
<li><a href="../267131/index.html">Application for pumping. How to speed up loading C # / XAML Windows Store apps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>