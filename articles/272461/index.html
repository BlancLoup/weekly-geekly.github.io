<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to split VPN traffic in MacOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="VPN  VPN (English Virtual Private Network - a virtual private network - a generic name for technologies that allow you to provide one or several netwo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to split VPN traffic in MacOS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c63/f41/423/c63f4142333a4fa5b6ebfc695297fcc9.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">VPN</b> <div class="spoiler_text">  VPN (English Virtual Private Network - a virtual private network - a generic name for technologies that allow you to provide one or several network connections (logical network) on top of another network (for example, the Internet) WikiPedia <br></div></div><br><br>  Suppose you are a developer and some of the resources (for example, a database) are located on a corporate network that is accessed via a VPN. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you look at all the available instructions on how to set up VPN on Mac OS, you will see that the authors tell you to checkbox ‚Äúsend all traffic through VPN‚Äù, which leads to the fact that (Captain Evidence) all traffic goes through VPN, which in turn imposes all restrictions on the corporate network (a ban on visiting individual resources, closed ports, etc.) or restrictions on the anonymization service (narrow channel, long ping, etc.). <br><br>  The question arises - is it possible to allow only certain traffic through a VPN, and let the rest of the (main) traffic go through a normal channel without restrictions. <br><br>  This is done quite simply. <br><br><a name="habracut"></a><br><br>  Briefly go through the configuration of the VPN connection. <br><br>  Click on the "apple" in the upper left corner of the screen and select "System Settings". <br><img src="https://habrastorage.org/files/ac3/885/161/ac38851613b1492a8d22f27776d05fd3.png"><br><br>  Choose "Network" <br><img src="https://habrastorage.org/files/a34/1a8/f94/a341a8f94b484d818fde05b9992f2bc9.png"><br><br>  Click on the "plus sign" in the list of network connections. <br><img src="https://habrastorage.org/files/629/373/cd8/629373cd878547aa811c6a92508133da.png"><br><br>  Choose "VPN" <br><img src="https://habrastorage.org/files/6a8/3e3/fc5/6a83e3fc52624316b1cea99f3b8b6ccb.png"><br><br>  VPN type (in my case, this is L2TP over IPSec) <br><img src="https://habrastorage.org/files/6ee/e5c/9b3/6eee5c9b373c48bf95503914216f8e2a.png"><br><br>  Fill in the connection parameters <br><img src="https://habrastorage.org/files/b53/046/629/b53046629f5e490b8fdb957cf3c508fc.png"><br><br>  Daws "Send all traffic through VPN" is <b>not set</b> <br><img src="https://habrastorage.org/files/88f/e32/be5/88fe32be51514efd93ab2f045912f220.png"><br><br>  Now we need to find out the interface through which VPN traffic is going. <br><br>  Run ifconfig without VPN connected <br><img src="https://habrastorage.org/files/91c/241/a34/91c241a348a34a22b2453aae29cb5833.png"><br><br>  Connecting VPN and running ifconfig again <br><img src="https://habrastorage.org/files/087/20d/47f/08720d47fe854ddaa638794fec608d6a.png"><br><br>  We see that the ppp0 interface appeared <br><br>  Now, by default, all traffic goes over a normal connection (not a VPN). <br><br>  Further, I need to connect to my server located at 192.168.0.20 via VPN.  For this we need to build a network route.  We use the regular unix-command route. <br><br><pre><code class="bash hljs">sudo /sbin/route add -host 192.168.0.20 -interface ppp0</code> </pre> <br><br>  Now all traffic goes through my normal connection, and traffic to the corporate server goes through VPN. <br><br>  For convenience, in the file ~ / .profile create aliases for the command to add routes <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> server-vpn-up=<span class="hljs-string"><span class="hljs-string">'sudo /sbin/route add -host 192.168.0.20 -interface ppp0'</span></span></code> </pre><br><br>  Now to raise the connection, you need to connect to the VPN and execute the server-vpn-up command. <br><br>  The alternative is to create the file / etc / ppp / ip-up, register in it [in my case] <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh /sbin/route add 192.168.0.0/24 -interface $1</span></span></code> </pre><br><br>  and grant execution rights <br><br><pre> <code class="bash hljs">sudo chmod +x /etc/ppp/ip-up</code> </pre><br><br>  After this, the route will be automatically registered after connecting to the VPN. <br><br>  What can meet pitfalls. <br><br>  1. There may be a conflict of IP addresses, if the internal and external networks use the same address space (maybe I use the wrong term, please correct in the comments).  Those.  You have both VPN and internal home network in 192.168.0 ... In my case, the solution was to reconfigure the home network to 10.0.1 ... <br><br>  2. When connecting a VPN, the corporate DNS 192.168.0.7 was automatically set.  And although all the traffic had to go, it seemed, not through a VPN, all the websites stopped opening.  This was decided by adding a Google-DNS DNS 8.8.8.8 and raising it to the very top. <br><br><img src="https://habrastorage.org/files/27f/f58/604/27ff586047504399b467bbc796e6f1c8.png"></div><p>Source: <a href="https://habr.com/ru/post/272461/">https://habr.com/ru/post/272461/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272449/index.html">Developed by Mithril. Practice, experience and pitfalls</a></li>
<li><a href="../272451/index.html">Creators of ransomware and fraudulent tech support sites are combined</a></li>
<li><a href="../272455/index.html">Presentation of the program settings in 1C. One of the methods</a></li>
<li><a href="../272457/index.html">Announced the start of acceptance of works at the symposium CTCrypt'2016</a></li>
<li><a href="../272459/index.html">Intro to rxjava</a></li>
<li><a href="../272467/index.html">Analysis of key performance indicators - Part 2, analysis of user, business and application metrics</a></li>
<li><a href="../272469/index.html">Translation: Instructions for conducting code review</a></li>
<li><a href="../272471/index.html">How to scale Ruby applications</a></li>
<li><a href="../272473/index.html">About system thinking</a></li>
<li><a href="../272475/index.html">Simple Computer Classroom Management System</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>