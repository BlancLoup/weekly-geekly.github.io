<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to determine the mobile operator and home region by phone number</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When we try to determine which operator a phone number belongs to, we usually look at its DEF code. For example, if the number starts at 916, then thi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to determine the mobile operator and home region by phone number</h1><div class="post__text post__text-html js-mediator-article">  When we try to determine which operator a phone number belongs to, we usually look at its DEF code.  For example, if the number starts at 916, then this is MTS, at 968 - Beeline, 926 - Megaphone (it all depends on your region).  But this method is very conditional and is completely inappropriate when accurate data is needed.  In reality, everything is more complicated: DEF codes are often divided among themselves by several operators, and it is not at all necessary that the desired number refers to the operators of the big four.  Finally, the number can be simply ported. <br><br>  In the article I will talk about how to reliably identify the mobile operator that serves it by phone number, as well as get additional, ‚Äúfree‚Äù information - the subscriber‚Äôs home region.  You can use this data as you please, from prefilling the address in the user profile and redirecting to the regional version of your service, to using this data in processing and statistics.  At the end of the article there will be a link to github with sources. <br><br>  At once I will make a reservation that the home region of the subscriber, by and large, is in no way connected with the current location of the user, i.e.  the designated region answers the question ‚ÄúWhere does the number come from?‚Äù and not ‚ÄúWhere is the user?‚Äù. <br><a name="habracut"></a><br><h2>  Data sources </h2><br><h3>  Rossvyaz </h3><br>  We receive our phone number when we enter into a service contract with a telecom operator.  In turn, the distribution of number ranges between telecom operators, as well as standardization and common control over telecommunication services, are carried out by the relevant state and international organizations.  In Russia, such an organization is the Federal Communications Agency (Rossvyaz). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, the most reliable source of information who serves the Russian phone number is Rossvyaz, and this is the open data that the agency publishes on its website: <a href="https://www.rossvyaz.ru/opendata/">www.rossvyaz.ru/opendata</a> .  The latest list of mobile number ranges is in CSV at the <a href="">link</a> .  Each line in the file looks like: <br><br> <code>DEF-,  ,  ,  ,  </code> <br> <br>  However, since 2013 it has been possible to transfer the number from the operator to the operator.  So, being guided only by the registries of Rossvyaz, one cannot unequivocally say that the number is serviced by a certain operator.  But this is quite possible to say about the region, because the number portability works only within the home region and transfer the number from MTS Novosibirsk to Tele2 St. Petersburg will not work in principle. <br><br>  Thus, if the task is to determine only the region of the user, then the RosSvyaz registries will be sufficient. <br><br><h3>  Transferred Numbers Database </h3><br>  If you need to accurately determine the operator, then you can not do without the database of the Transferred <abbr title="Central Research Institute of Communications">Numbers</abbr> , the operator of which is <abbr title="Central Research Institute of Communications">CRIS</abbr> .  The procedure for connecting to the database can be found on their website: <a href="https://zniis.ru/">zniis.ru</a> .  But, unfortunately, as far as I know, it is not easy to directly connect to them, but having received the connection, you cannot share the base with anyone. <br><br>  The structure of this database is extremely simple: these are three CSV files in which in the format ‚Äúnumber, operator name‚Äù are listed: <br><br><ul><li>  all transferred numbers for the current day (updated once a day); </li><li>  all transferred numbers in the last hour (updated once per hour); </li><li>  All numbers returned to the native operator back in the last hour (updated once an hour). </li></ul><br>  At the time of this writing, there are about 6 million entries in the BDPN. <br><br>  Summarizing: we have certain ranges of numbers that correspond to specific operators and regions (Rossvyaz), and a list of exception numbers from these ranges (BDPN), which applies only to the name of the operator. <br><br><h2>  How to identify subscribers </h2><br>  The most obvious solution to this problem: look at the word <i>"range"</i> and use the listed capacity literally.  Those.  To determine the number, we sort all operators by their ranges and look for an entry that belongs to the minimum range in which a specific number falls.  The complexity of this algorithm will be like that of a binary search, which is pretty good. <br><br>  But there is a more original and universal way of implementation, the complexity of which is a constant, regardless of the size of the data.  This method involves the use of number masks. <br><br><h3>  Number mask </h3><br>  The number mask is a string consisting of numbers and a special character with the value ‚Äúwildcard of a single character‚Äù (‚Äú?‚Äù), Which says that any digit can be in its place.  And after the question mark can only be a question mark. <br><br>  Thus, one of the Beeline ranges in Moscow <i>"79031000000 - 79031999999"</i> , in the form of a mask will be recorded as <i>"79031 ??????"</i> . <br><br>  It is very convenient to work with such masks, for example, to set them manually in the configuration.  In addition, the representation of ranges in the form of masks makes it possible to use more efficient storage methods and simple search algorithms. <br><br><h4>  Hash table </h4><br>  For example, one of these algorithms is storing mask-operator matches in a hash table (or any other key-value store).  The essence of the algorithm is as follows: all such masks are added to a hash table, where they are keys.  The values ‚Äã‚Äãin the table are operator objects with regions. <br><br>  The job search is most clearly explained by example.  Let's say we are looking for information by number: <i>7 (903) 100-1234</i> , and we have a mask <i>79031 ??????</i>  - Beeline, Moscow. <br><br>  First, we look for the key entry in the table exactly as the original number: <i>79031001234</i> . <br>  If not found, then change the last digit of the number to "?"  and look for the key <i>7903100123?</i>  . <br><br>  If you didn‚Äôt find anything again, then we change the last digit to "?"  and look for 790310012 ??, and so on. <br><br>  Finally we will do a search by key <i>79031 ??????</i>  and find that the number refers to the operator Beeline, Moscow. <br><br>  It can be seen that in this case the complexity of the algorithm is equal to the complexity of several takes from the hash table, which, when correctly implemented, is usually equal to a constant.  The complexity of searching in such a tree depends on the length of telephone numbers, which, according to the recommendation of ITU-T E.164, does not exceed 15 characters. <br><br>  The same algorithm can be applied to the ported numbers - they can simply be added to the same hash table. <br><br><h4>  Prefix tree </h4><br>  A much more efficient performance method is building a <a href="https://en.wikipedia.org/wiki/Trie">prefix tree</a> from masks, which will be based on the fact that numbers consist of numbers.  Each node of this tree can have up to 10 digital descendant nodes (0-9) and one wildcard node.  A wildcard node can only have wildcard descendants.  When adding a new mask to the tree, each character of the mask will consistently turn into a node.  Thus, in fact, we represent all of our masks in the form of a single tree. <br><table><tbody><tr><td>  For example, a tree consisting of masks: <br>  7913?  - Mno1 <br>  791 ??  - Mno3 <br>  7952 - Mno2 <br>  7953 - Mno3 <br>  795?  - Mno1 <br>  will look like in the picture (the listed masks in the tree go from left to right). <br></td><td><img src="https://habrastorage.org/web/c9a/6b4/1b2/c9a6b41b2806456db4d592b6cdf42891.png"><br></td></tr></tbody></table><br>  The search algorithm in the tree, I think, is already clear: we take in order each digit from the desired number and go down the tree successively from the root.  First of all we descend on digital nodes, if there are no digital nodes, then we see if there is a "?" - node.  If there is, then ultimately check the length of the mask, and if it matches the number, then the operator is found. <br><br><h2>  Conclusion </h2><br>  Depending on the restrictions, it is possible to combine these approaches and separate the storages of the ported numbers and masks of the Rossvyaz.  For example, from memory it is more profitable to use the hash-table approach for ported numbers, and it is always more profitable to use a mask tree for rossvyaz registries.  When searching, first look at the table, and if nothing is found in it, then look in the tree.  Separation of storage facilities is primarily convenient for auto-updating them, i.e.  if the BDPN has changed (and it changes constantly), then it is not necessary to reread the ranges of Rossvyaz. <br><br>  For maximum performance, you can store all information directly in RAM.  In my Java implementation, the Rossvyaz mask tree occupies no more than 20‚Äì30 MB, the hash table with the masks of the ported numbers: about 500‚Äì600 MB.  If the ported numbers are stored in a prefix tree, then due to the fact that tree nodes turn out to be very sparse, approximately 1.5 times more memory is required.  But on the other hand, it gives a significant performance gain. <br><br>  Thanks for attention! <br><br>  ‚Üí All source code is available on <a href="https://github.com/chukanov/mnp">github</a> . </div><p>Source: <a href="https://habr.com/ru/post/337338/">https://habr.com/ru/post/337338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337324/index.html">FullStack 2017 in London: details</a></li>
<li><a href="../337328/index.html">How we taught the Yandex.Taxi application to predict a destination</a></li>
<li><a href="../337330/index.html">What programming language to choose to work with data?</a></li>
<li><a href="../337334/index.html">How to name a brand: 5 options. Choose the best</a></li>
<li><a href="../337336/index.html">About choosing a name for the game</a></li>
<li><a href="../337340/index.html">The last countdown - Google has fun</a></li>
<li><a href="../337342/index.html">At the same place, at the same time: we are waiting for you at the new meeting of Android developers in the LC</a></li>
<li><a href="../337344/index.html">Critical analysis of old and synthesis of new knowledge will make Testing software science</a></li>
<li><a href="../337346/index.html">Waiting for 15 years. Nginx Application Server</a></li>
<li><a href="../337348/index.html">RustGo: Rust call from Go with almost zero overhead</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>