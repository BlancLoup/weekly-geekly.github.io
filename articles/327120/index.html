<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>slit - a new word in the world of PAGERS, or how to spend less time viewing logs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It just so happens that I regularly have to look through a lot of logs. One thing pleases, not so much as the people working with me who sometimes hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>slit - a new word in the world of PAGERS, or how to spend less time viewing logs</h1><div class="post__text post__text-html js-mediator-article">  It just so happens that I regularly have to look through a lot of logs.  One thing pleases, not so much as the people working with me who sometimes have this main job.  These logs do not lie in any centralized system, but are stored in s3 and we watch them downloading with redirection of the output to less. <br><br>  less is installed for everyone, everyone is used to working with it, they know about basic things, like searching back and forth, filtering by &amp;, go to the end (G) of a file, go to the beginning (g) and so on. <br><br>  And also, everyone has already come to terms with the fact that at any moment, when adding a filter, less can hang for an indefinite period, display along a line of 5 seconds, and so on.  Ultimately, especially when reading logs from stdin, you have to be careful.  The filter may or may not work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, at that moment, that I had a chance to walk through a couple of hundred log files for several days - it became obvious that the world needed to be changed for the better ... <br><br>  Under the cut demo (gif 2.2mb) and a bit of history. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Demo (2.2mb):</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/a64/704/82b/a6470482b6b04f548998b57df088ebb6.gif"><br></div></div><br>  The main claims for less were 3: <br><br>  1) The filter can fail at any time; <br>  2) The filter basically works rather slowly, especially with stdin, especially with logs&gt; 5MB; <br>  3) Cannot add multiple filters. <br><br>  Searching in the open spaces of the network - I realized that there is nothing.  There is one "log navigator" - but, not intuitive, a lot of excess, but what you need is very inconvenient. <br><br>  Starting to write his PAGER-a on Go - first of all he began to compare different approaches. <br><br>  The first was with a swoop, the idea that there is a lot of memory on the machines, you can simply load the entire file into memory, prepare it - and then quickly search for everything there. <br><br>  Everything turned out to be not so trivial, on a 50MB file, with its line-by-line splitting, recognition of control characters to separate text from color, memory allocation for the resulting data (separate color information, separate text for quick search in text) - it took longer than if just read everything, break, search, but not allocate memory for storage. <br><br>  When streaming, data moves from function to function in the stack, which is much faster. <br><br>  Ultimately, it came to the conclusion that memory is allocated only for storing the offset of each line, and the separation of text from colors and the transfer of ready-made suitable lines to the buffer occurs in streaming mode.  The buffer is always stored 2-3 windows in each direction, for fast navigation back and forth without additional readings.  If possible, the search is performed in this buffer, if this is not enough - even then the file is re-read from the desired position. <br><br>  It goes without saying that such an approach also means that you don‚Äôt have to wait at the beginning to upload the entire file. <br>  In principle, in the future I am thinking of adding a flag that will in any case keep the entire file in memory, but with stream processing.  But not sure what it needs :) <br><br>  In general, search, filtering, including multi-level, turned out much faster than in less and much more stable.  About 4 times a simple search, the difference in filtering reaches infinity, since less can just hang.  But even if not, then there is already an order of magnitude. <br><br><h3>  Speaking of killer features </h3><br>  <b>Multi-level filters</b> <br><br><ul><li>  &amp; - intersection with the previous sample.  Ie the same as in less, but with all the previous filters </li><li>  + Add matches to the selection </li><li>  - Exclude matches from the selection </li></ul><br>  The sequence of these filters will help to quickly leave on the screen what you need. <br><br>  Also, for more detailed study will actively help: <br><br><ul><li>  <b>U (shift + u)</b> - remove the last filter </li><li>  <b>=</b> - remove all filters </li><li>  <b>C (shift + c, Context)</b> - temporarily disable all filters, allows you to see everything that happened after this line, this line is considered the first on the screen </li></ul><br>  Another useful feature: <br><br>  Shift + K - Keep.  Allows you to specify the number of characters from the beginning of the line that will be displayed when the screen is horizontally shifted.  Thus, you can fix the time, commit hash, etc. <br>  You can either enter the number, or use the up-down arrows to adjust the number of fixed characters. <br><br>  - Mostly hotkeys follow less <br>  - Search-filters save stories between sessions.  There is no search for ctrl + r yet, this is in the plans. <br>  - Files (so far) can be viewed only one at a time or with stdin-a <br>  - If <b>slit is</b> started with output redirection - then the incoming stream will be simply redirected, without any logic, like cat and less <br>  - Actively tested on linux, osx, a bit on windows, not tested at all for freebsd. <br><br>  Collected under it collected, but there is nothing to check.  According to the idea should work <br><br>  The project at a very early stage, I personally have already replaced the PAGER in the system.  But perhaps someone lacks something that would seem obvious.  Do not be silent :) <br><br>  There are a number of plans: <br><br>  - Add switching case sensitivity.  Currently, only case-sensitive search; <br>  - Add search type switch (regex / plain / extended glob); <br>  - Add a menu of filters to review what is at the moment with selective deletion-disconnection; <br>  - Add support for multiple files.  To start with switching between them as in less; <br>  - CTRL + R history search; <br>  - Delete a substring from each line, to remove noise, without deleting the lines themselves; <br>  - Direct output to the terminal if the text is smaller than the screen (analog of the -F flag in less-e), perhaps with support for -F from the environment variable LESS. <br><br>  <b>What is in question:</b> <br>  - Read the entire stdin or not?  Personally, it helps me a lot, that he reads everything before I decided that I needed it.  But usually PAGERs do not. <br>  - not Sly opportunities to work with time, i.e. recognize timestamps and enable filtering by them.  I do not know if anyone in the logs <br><br>  <b>What is required to remain despite the addition of features:</b> <br>  - Collect no more than one line from the terminal <br>  - No more time should be spent on opening a file than in the case of less <br><br><h3>  And a little about Go </h3><br>  This is my second project on Go, the first was <a href="https://habrahabr.ru/post/314220/">here</a> . <br><br>  The absence of various functionalities, such as the notorious generics, sometimes the need to implement seemingly trivial things (atomic boolean) sometimes frustrates.  In python, I write a lot more, but every time I touch the go, I really enjoy the restrictions that have been imposed on me :) <br><br>  But most of all I am pleased with the ecosystem.  For some reason, it is often forgotten about her properly to mention, comparing or cursing the language.  Perhaps the language slows down the spelling, until the ‚Äúrun‚Äù button is pressed for the first time.  After it, the go quickly rushes forward. <br><br>  1) <b>go build / run / install --race</b> <br>  The application will run in race condition search mode, access data from different streams without synchronization.  It is actually very cool to help catch bugs that are quite difficult to catch.  And sometimes to understand that in vain I decided to go the easy way and pass the pointer, and not to add an additional level of communication between parts of the application through threads <br><br>  2) <b>net / http / pprof</b> - that's great.  Simple import, registration of the local port and when a deadlock occurs, you can go through the browser to the selected port and see all the information about goroutine-ah that are running now <br><br>  3) <b>Cross compilation</b> .  This is said of course more, but every time it never ceases to please.  That you do not need to dance with a tambourine, put additional dependencies - it just works <br><br>  4) <b>Goglang</b> , thank you, Jetbrains, for putting everything together, again, no need to dance with a tambourine, as well as in the case of Pycharm, I continue to work in a similar environment, with vim mode, auto import, auto go get, declaring methods and etc. <br><br>  Before the next choice of language, I compared how some other ascending languages ‚Äã‚Äãare doing and it became obvious that they still have room to grow ... <br><br>  And the main thing, where to take: <br><br>  If you have the Go environment set up, then the best thing to do is to build: <br><br><pre><code class="hljs swift">go <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> github.com/tigrawap/slit</code> </pre> <br>  If you prefer ready-made binaries, then from the <a href="https://github.com/tigrawap/slit/releases">releases page</a> . <br><br>  And the question to the studio, I would like to notify users about the fact that there is a newer version.  It is unpleasant if I make a release, I suddenly notice a mistake, after 5 minutes I release a new release, but he has already downloaded.  What are the options for an unobtrusive but understandable notification? <br><br>  So far, I think to climb into the network no earlier than once per hour and at startup, until some action is taken to display a message in the navigation bar.  Maybe there will be more elegant ideas. <br><br>  Also happy with the ideas that it is worth improving-add.  But I do not promise everything :) </div><p>Source: <a href="https://habr.com/ru/post/327120/">https://habr.com/ru/post/327120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327106/index.html">Managing the "power of thought": a resident accelerator at ITMO University</a></li>
<li><a href="../327108/index.html">Amp. What is it and what does it eat?</a></li>
<li><a href="../327110/index.html">Casting an arbitrary slice to the interface slice</a></li>
<li><a href="../327114/index.html">Dump ShadowBrokers: we understand the contents of the directory "swift"</a></li>
<li><a href="../327118/index.html">The winner of the first GameDev-hakaton DataArt was a team from Kiev</a></li>
<li><a href="../327124/index.html">Security Week 16: SWIFT under the hood, again in Magento a hole, give Honeypot to a friend</a></li>
<li><a href="../327126/index.html">How to get rid of smart employees in your company</a></li>
<li><a href="../327128/index.html">How to remotely debug via WinDbg not including Windows debug mode</a></li>
<li><a href="../327130/index.html">Legal withdrawal of funds from Upwork in the Russian Federation</a></li>
<li><a href="../327138/index.html">Difficulty on the border of chaos, or what is common between sex, neural networks, microservices and company organization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>