<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>XMPP and Jabber clients</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There was a need to use one Jabber account for multiple users. After reading the RFC I stumbled upon the priorities for resources in XMPP. That's what...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>XMPP and Jabber clients</h1><div class="post__text post__text-html js-mediator-article">  There was a need to use one Jabber account for multiple users.  After reading the RFC I stumbled upon the priorities for resources in XMPP.  That's what I need!  In practice, not everything turned out to be so rosy.  In my opinion, many popular customers <a name="habracut"></a>  do not properly support the protocol. <br><br>  The idea was that clients connect to the Jabber server from the same account but from different resources and with negative priority. <br>  The behavior of the server in this case is described in the <a href="http://www.xmpp.org/rfcs/rfc3921.html">XMPP IM RFC</a> : <br><blockquote><code>11.1. Inbound Stanzas 1.4.1: <br> For message stanzas, the server SHOULD deliver the stanza to the highest-priority available resource (if the resource did not provide a value for the &lt;priority/&gt; element, the server SHOULD consider it to have provided a value of zero). If two or more available resources have the same priority, the server MAY use some other rule (eg, most recent connect time, most recent activity time, or highest availability as determined by some hierarchy of &lt;show/&gt; values) to choose between them or MAY deliver the message to all such resources. However, the server MUST NOT deliver the stanza to an available resource with a negative priority; if the only available resource has a negative priority, the server SHOULD handle the message as if there were no available resources (defined below). In addition, the server MUST NOT rewrite the 'to' attribute (ie, it MUST leave it as &lt;user@domain&gt; rather than change it to &lt;user@domain/resource&gt;). <br></code> </blockquote><br>  That is, the message will be delivered to client@example.com/resource1 or to any other resource with the highest non-negative priority.  So far everything was fine with me and only pleased. <br><br>  Then in the same <a href="http://www.xmpp.org/rfcs/rfc3921.html">XMPP IM RFC</a> I read about how Jabber clients with resources should behave: <br><blockquote> <code>4.1. Specifying an Intended Recipient <br> An instant messaging client SHOULD specify an intended recipient for a message by providing the JID of an entity other than the sender in the 'to' attribute of the &lt;message/&gt; stanza. If the message is being sent in reply to a message previously received from an address of the form &lt;user@domain/resource&gt; (eg, within the context of a chat session), the value of the 'to' address SHOULD be of the form &lt;user@domain/resource&gt; rather than of the form &lt;user@domain&gt; unless the sender has knowledge (via presence) that the intended recipient's resource is no longer available. If the message is being sent outside the context of any existing chat session or received message, the value of the 'to' address SHOULD be of the form &lt;user@domain&gt; rather than of the form &lt;user@domain/resource&gt;.</code> <br> </blockquote><br>  As I understand it, if the chat is not started by this client, then he should send a response to the full JID (with the resource) in all cases except when the chat initializer through presence reported that this resource is unavailable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In practice, this is the case if both clients see each other.  In the case of unauthorized clients, the behavior is somewhat different ... Let's look at communication through Miranda between unauthorized users: <br><br>  I created a new user (client1@example.com) on my server and connected to it from Miranda: <br><img src="https://habrastorage.org/getpro/habr/post_images/d63/901/b86/d63901b8680fd794016c7b6446d5d8ec.jpg" alt=" Miranda" title="Miranda configuration"><br><img src="https://habrastorage.org/getpro/habr/post_images/c99/53d/cdb/c9953dcdb124a2b6f48c89ec8114c1ed.jpg" alt="Miranda" title="Miranda"><br>  After that, I sent this user (client1@example.com) 2 messages from client@example.com/resource1 and client@example.com/resource2 and was very surprised at their communication ... <br>  This is how Miranda showed me these messages: <br><img src="https://habrastorage.org/getpro/habr/post_images/68c/c3c/c88/68cc3cc88fcd9102c41f58b8f8ffb24f.jpg" alt="   " title="messages from different users"><br>  And after scanning their communication, I saw the following: <br><br><br><blockquote>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">message</font> <font color="#ff0000">type</font> <font color="#0000ff">= 'chat'</font> <font color="#ff0000">from</font> <font color="#0000ff">='client@example.com/resource1 '</font> <font color="#ff0000">to</font> <font color="#0000ff">='client1@example.com'</font> <font color="#ff0000">id</font> <font color="#0000ff">= 'uid12'</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> message with resource1 <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">thread</font> <font color="#0000ff">&gt;</font> uid11 <font color="#0000ff">&lt;/</font> <font color="#800000">thread</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">x</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">= 'jabber: x: event'</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">offline</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">delivered</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">displayed</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">composing</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">x</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">active</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">= 'http: //jabber.org/protocol/chatstates'</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">message</font> <font color="#0000ff">&gt;</font></font> </blockquote><br><br><blockquote>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">message</font> <font color="#ff0000">type</font> <font color="#0000ff">= 'chat'</font> <font color="#ff0000">from</font> <font color="#0000ff">='client@example.com/resource2 '</font> <font color="#ff0000">to</font> <font color="#0000ff">='client1@example.com'</font> <font color="#ff0000">id</font> <font color="#0000ff">= 'uid6'</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> message from resource2 <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">thread</font> <font color="#0000ff">&gt;</font> uid5 <font color="#0000ff">&lt;/</font> <font color="#800000">thread</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">x</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">= 'jabber: x: event'</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">offline</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">delivered</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">displayed</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">composing</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">x</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">active</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">= 'http: //jabber.org/protocol/chatstates'</font> <font color="#0000ff">/&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">message</font> <font color="#0000ff">&gt;</font></font> </blockquote><br>  And Miranda sent the answer like this: <br><br><blockquote>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">message</font> <font color="#ff0000">from</font> <font color="#0000ff">='client1@example.com/Miranda '</font> <font color="#ff0000">to</font> <font color="#0000ff">='client@example.com'</font> <font color="#ff0000">xml: lang</font> <font color="#0000ff">= 'en'</font> <font color="#ff0000">type</font> <font color="#0000ff">= 'chat'</font> <font color="#ff0000">id</font> <font color="#0000ff">= 'mir_12'</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> answer from miranda <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">message</font> <font color="#0000ff">&gt;</font></font> </blockquote><br>  None of the clients sent a presence tag to Miranda, and they shouldn‚Äôt because they are not authorized and do not inform each other about their presence.  From all this, I concluded that Miranda does not comply with the RFC.  If I am somewhere that is not right please inform. <br><br>  I also tested other clients: <br><ul><li>  <i>Miranda-im v0.7.8</i> - <i>discards</i> messages in one window and responds to JID without rusurs. </li><li>  <i>Pidgin 2.4.3</i> - the message drops in one window and responds to the JID without Rusource. </li><li>  <i>Gajim 0.11.4</i> - the message drops in one window and responds to the JID without Rusurs. </li><li>  <i>mcabber 0.9.5-1</i> - the message throws off in one window and responds to JID without rusurs. </li><li>  <i>Pandion 2.5</i> - the message drops in one window but responds to the Russes from which the last message was sent. </li><li>  <i>Exodus 0.10.0.0</i> - opens a new window for a new resource but the message puts in the first open window :) after 10 messages it goes crazy :) </li><li>  <i>psi 0.12</i> - Opens a new window for different resources.  Answers full JID! </li></ul><br>  Since Psi is cross-platform, I can dwell on the use of this client, but I would like to figure out who actually is a bug? <br></div><p>Source: <a href="https://habr.com/ru/post/38665/">https://habr.com/ru/post/38665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38654/index.html">For the joy of the Old Believer</a></li>
<li><a href="../38657/index.html">Yellowtail on iPhone</a></li>
<li><a href="../38661/index.html">Gorenje launches Made for iPod fridge</a></li>
<li><a href="../38663/index.html">"Where is it?"</a></li>
<li><a href="../38664/index.html">New security mechanisms in IE 8</a></li>
<li><a href="../38666/index.html">code</a></li>
<li><a href="../38668/index.html">Interesting observations of people ...</a></li>
<li><a href="../38672/index.html">HabraFx to take off</a></li>
<li><a href="../38673/index.html">Assessment in terms of SEO: Is the site ready for promotion?</a></li>
<li><a href="../38674/index.html">Cartoon Gypsy: Death in Moldavian ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>