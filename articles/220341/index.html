<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deploy Ratpack app on Heroku</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Deploying a simple Ratpack application to Heroku is much more complicated than it should be. After a lot of trial and error, I finally managed to get ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deploy Ratpack app on Heroku</h1><div class="post__text post__text-html js-mediator-article">  Deploying a simple <a href="http://www.ratpack.io/">Ratpack</a> application to Heroku is much more complicated than it should be.  After a lot of trial and error, I finally managed to get a working configuration for a successful deployment.  This article is a manual on how to deploy an application step by step.  In the next article I will explain how to use the Gradle plugin to simplify the process. <br><a name="habracut"></a><br><h5>  <b>Artifacts</b> </h5><br>  For successful deployment, certain artifacts must be presented in your Heroku project in order to successfully discover your application.  I recommend placing these files in a separate branch in your Git, because Heroku uses Git for deployment. <br>  First we need to create the following folder structure: <br>  bin <br>  Comp‚îÄ‚îÄ compile <br>  Detect‚îÄ‚îÄ detect <br>  And files with the following content: <br>  <b>bin / detect</b> <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash # bin/use &lt;build-dir&gt; if [ -f $1/src/ratpack/ratpack.groovy ]; then echo "Ratpack" &amp;&amp; exit 0 else echo "no" &amp;&amp; exit 1 fi</span></span></code> </pre> <br>  <b>bin / compile</b> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash # bin/compile &lt;build-dir&gt; &lt;cache-dir&gt; # fail fast set -e BIN_DIR=$(cd $(dirname $0); pwd) # absolute path # parse args BUILD_DIR=$1 CACHE_DIR=$2 #env variables JAVA_DIST="openjdk1.7.0_21" JDK7_URL="https://s3.amazonaws.com/heroku-jdk/${JAVA_DIST}.tar.gz" #create the cache dir if it doesn't exist mkdir -p $CACHE_DIR cd "$BUILD_DIR" #jdk7 if [ -d .jdk7 ]; then echo "-----&gt; .jdk7 folder found, moving along." else echo -n "-----&gt; .jdk7 folder not found! " if [[ -d "$CACHE_DIR/.jdk7" ]]; then echo -n "Copying jdk from cache to app... " cp -r "$CACHE_DIR/.jdk7" "$BUILD_DIR" echo "Done!" else echo -n "-----&gt; Installing ${JAVA_DIST} build (to .jdk7)....." mkdir "$BUILD_DIR/.jdk7" cd "$BUILD_DIR/.jdk7" curl --max-time 180 --location "$JDK7_URL" | tar xz cd "$BUILD_DIR" echo "Done!" fi fi cd $BUILD_DIR export JAVA_HOME="$BUILD_DIR/.jdk7" export PATH="$JAVA_HOME/bin:$PATH" echo "" echo "-----&gt; Building project with Gradle wrapper:" echo " ./gradlew clean installApp" export GRADLE_OPTS="-Dfile.encoding=UTF-8 -server -Xmx512m -XX:+UseCompressedOops" export GRADLE_USER_HOME="$CACHE_DIR/.gradle" ./gradlew clean installApp rm -rf "$CACHE_DIR/.jdk7" cp -r .jdk7 "$CACHE_DIR/.jdk7"</span></span></code> </pre><br><br>  Next we need a Procfile, leave it in the root directory of our Ratpack project. <br>  <b>Procfile</b> <br><pre> <code class="bash hljs">--- addons: config_vars: JAVA_OPTS: -Dfile.encoding=UTF-8 -server -Xmx512m -XX:+UseCompressedOops default_process_types: web: build/install/ratpack/bin/ratpack</code> </pre><br><br>  The <i>build / install / ratpack / bin / ratpack file</i> , as well as the <i>build / install / ratpack folder,</i> appear in the web process.  This file and folder will be named the root of your project.  It is possible (and necessary) to override this value for deployments in Heroku, since the name of the root project comes from the generated hash.  In order to fix this, we need to set the name of the project root to something known (in our case ratpack).  This can be configured in the settings file in the project root: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>settings.gradle</b> <br>  rootProject.name = 'ratpack' <br>  Now we need to set the <i>RATPACK_OPTS</i> environment <i>variable</i> pointing to the <i>$ PORT</i> variable provided to us during the deployment process.  It should be written in a script hidden in the depths of our project in the profile.d folder. <br><br>  <b>.profile.d / setenv.sh</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo "Setting environment varialbes..." export RATPACK_OPTS="-Dratpack.port=$PORT" export JAVA_HOME="${BUILD_DIR}/.jdk7"</span></span></code> </pre><br><br>  Now we have the following folder structure: <br>  Bin‚îÄ‚îÄ bin <br>  ‚îÇ ‚îú‚îÄ‚îÄ compile <br>  ‚îÇ ‚îî‚îÄ‚îÄ detect <br>  Pro‚îÄ‚îÄ Procfile <br>  ‚îú‚îÄ‚îÄ .profile.d <br>  ‚îî‚îÄ‚îÄ setenv.sh <br>  Settings‚îÄ‚îÄ settings.gradle <br><br><h5>  <b>Deployment process</b> </h5><br>  Now we need to create our new application on Heroku using the buildpack command.  This simple command transfers all the commands to the artifacts we created in our project.  The team also creates our application, like Cedar Stack based on Ubuntu 10.04 on Heroku. <br>  <i>heroku apps: create myapplication - buildpack <a href="">github.com/kr/heroku-buildpack-inline.git</a></i> <br><br>  Next, we switch to our new branch, which we created for deployment and commit all our artifacts there. <br><br><pre> <code class="bash hljs">git checkout -b deploy git add bin Procfile settings.gradle .profile.d git commit -m <span class="hljs-string"><span class="hljs-string">'Heroku deployment artifacts.'</span></span> git push heroku deploy:master</code> </pre><br><br>  Now we need to see our application successfully deployed: <br>  -----&gt; Fetching custom git buildpack ... done <br>  -----&gt; Ratpack app detected <br>  -----&gt; .jdk7 folder not found!  Copying jdk from cache to app ... Done! <br><br>  -----&gt; Building project with Gradle wrapper: <br>  ./gradlew clean installApp <br>  &lt;snip /&gt; <br>  -----&gt; Discovering process types <br>  Procfile declares types -&gt; JAVA_HOME, JAVA_OPTS, web <br><br>  -----&gt; Compiled slug size: 64.8MB <br>  -----&gt; Launching ... done, v38 <br>  <a href="http://myapplication.herokuapp.com/">myapplication.herokuapp.com</a> deployed to Heroku <br>  And we can look at the logs to confirm this: <br>  heroku logs --tail --num 100 --app myapplication <br><br>  In the next article I will explain how to do the same, using the Gradle plugin, which is proposed <a href="https://github.com/ratpack/ratpack/issues/83">here</a> .  The source can be found <a href="https://github.com/marcoVermeulen/heroku-buildpack-ratpack">here</a> .  The original article is <a href="http://www.wiredforcode.com/blog/2013/08/05/deploy-ratpack-on-heroku/">here</a> .  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/220341/">https://habr.com/ru/post/220341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220331/index.html">Demonstration of high-speed processing capabilities of IP packets, for example, a simple DDOS filter developed on the basis of the NETMAP framework</a></li>
<li><a href="../220333/index.html">Report on the passage of the first round of the Russian Code Cup</a></li>
<li><a href="../220335/index.html">Want to manage the product? What are all product managers silent</a></li>
<li><a href="../220337/index.html">Automation testing UI. From Coded UI to Cruciatus</a></li>
<li><a href="../220339/index.html">Ibm and red hat</a></li>
<li><a href="../220343/index.html">Duplex asynchronous data exchange for the web, mobile and desktop in one implementation</a></li>
<li><a href="../220351/index.html">Blogs are small media.</a></li>
<li><a href="../220353/index.html">iOS / PSW.SSLCredsThief.A for iOS c jailbreak</a></li>
<li><a href="../220355/index.html">A new biotechnology department has been created at DARPA</a></li>
<li><a href="../220357/index.html">Docsvision start - and continue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>