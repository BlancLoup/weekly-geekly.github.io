<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stepic.org in Telegram: how we developed the bot and what came of it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the winter of 2016, we in Stepic.org had the idea to make a personal assistant for our students, so we called Konstantin Charkin, a student of SPbA...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Stepic.org in Telegram: how we developed the bot and what came of it</h1><div class="post__text post__text-html js-mediator-article">  In the winter of 2016, we in Stepic.org had the idea to make a personal assistant for our students, so we called Konstantin Charkin, a student of SPbAU RAS, for an internship, which resulted in a Telegram bot.  Then it all went out of control and a set of stickers and channels for courses appeared ... But first things first! <br><br><img src="https://habrastorage.org/files/005/15f/44d/00515f44d2be4bebbbe3d20081e26e09.jpg"><br><a name="habracut"></a><br><h4>  Stepic bot </h4><br><h5>  <font color="#32CD32">Language and library selection</font> </h5><br>  Python was chosen as the programming language, since Stepic‚Äôs backend is written in Django and the easiest way to integrate the bot into the overall infrastructure is to write Django Application. <br>  Of the many <a href="https://github.com/eternnoir/pyTelegramBotAPI">wrapper</a> libraries over the Telegram API, the <a href="https://github.com/eternnoir/pyTelegramBotAPI">eternnoir / pyTelegramBotAPI</a> was chosen.  Among the options were three more: <a href="https://github.com/datamachine/twx.botapi">datamachine / twx.botapi</a> , <a href="https://github.com/nickoala/telepot">nickoala / telepot</a> , <a href="https://github.com/sourcesimian/txTelegramBot">sourcesimian / txTelegramBot</a> .  The choice was due to the fact that, firstly, it was actively supported, and secondly, according to it there is a <a href="https://kondra007.gitbooks.io/telegram-bot-lessons/content/index.html">good guide in Russian</a> for the smallest.  By the way, the author of this textbook has created a group in the VC, where he answers any questions related to Telegram bots, completely free of charge and fairly quickly. <br><br><h5>  <font color="#32CD32">Linking account</font> </h5><br>  In order for the bot to perform some useful actions, it is necessary to link the account on Stepic with the account in the Telegram.  For this, a mechanism called Deep Linking is used.  You can read about it either in <a href="https://core.telegram.org/bots">the Telegram API documentation</a> , or <a href="https://github.com/nickoala/telepot">here</a> (the second link is clearer :). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In our case, the mechanism is as follows: <br><ul><li>  In Stepic.org, each user is assigned a unique, randomly generated token. </li><li>  To link an account, the user must follow a unique link of the form telegram.me/&lt;bot_name&gt;?start=%token%, which is in his profile on the site.  Clicking on this link is equivalent to the fact that the bot received a start% token% message from the user. </li><li>  When a bot receives such a message, it looks in the database, searches for a user with such a token, if it finds it, it remembers that this user has a Telegram account from which this message came. </li></ul><br>  It is also worth considering that people take courses mainly from a PC, and use Telegram on mobile devices.  Therefore, asking them if they found a bot not through the site Stepic.org, to go there and click on this link is a bad idea, because  it is likely that they are not logged on this device, and the password has long been forgotten.  Therefore, there is a second option linking an account - via email.  A bot, if an unfamiliar user wrote to him, asks to enter his email, which was used during registration, and if such email is found, then a unique link is sent there, the user enters his email client, clicks on this link and everything is ready. <br><br><h5>  <font color="#32CD32">Useful actions</font> </h5><br>  After we have learned how to link an account, you need to decide what the bot itself will be able to do.  There were many ideas about this, but, for a start, it was decided to dwell on the functions: <br><ul><li>  On request, send a list of the nearest deadlines for the courses; </li><li>  Send notifications about new reviews, comments, upcoming deadlines, links to received certificates, etc.  All that now comes in the mail; </li><li>  Search courses; </li><li>  Organization of communication between students of courses. </li></ul><br><h5>  <font color="#32CD32">Design</font> </h5><br>  The simplest way to model the behavior of chat bots is a <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D0%25B5%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D0%25B2%25D1%2582%25D0%25BE%25D0%25BC%25D0%25B0%25D1%2582">finite state machine</a> . <br>  In this case, it looks like this: <br><br><img src="https://habrastorage.org/files/c72/d5d/7eb/c72d5d7ebf754b6e96fc999db1bac01e.png"><br><br>  Red states are states in which a bot expects some input from the user. <br>  I is the initial state in which the bot expects one of the following commands: <br><img src="https://habrastorage.org/files/113/8e5/02b/1138e502b65c4bbaa06b9aa06a2d27ec.png"><br>  II - is the choice of registration method (via website or email); <br>  III - waiting for the user to enter email; <br>  IV is the state in which the bot expects one of the following commands: <br><img src="https://habrastorage.org/files/746/e5b/486/746e5b4865f1498e80660349e39c1482.png"><br>  V is a search, the bot is waiting for an input request. <br><br>  Actually, the meaning of all commands is quite obvious, then a few examples of use. <br><br>  The communication between students is implemented in the simplest way - a chat is created for the course and, at the user's request, it receives a list of chat courses that are divided into 2 categories depending on whether the user is enrolled in the course. <br><br><img src="https://habrastorage.org/files/84d/297/3be/84d2973be2f9431da53bdaa2c5d523ba.gif" alt="image"><br><br>  Here, by the way, a new feature from botAPI 2.0 was used, namely the built-in keyboard and message editing.  It would be possible to display all the chats at once, but there can be quite a lot of chats on courses for which the user is not recorded, and if the user wants to see several screens, then let it do it consciously. <br><br>  Search courses: <br><br><img src="https://habrastorage.org/files/010/652/7d4/0106527d4bb1452c94cba48be392c9d7.gif" alt="image"><br><br>  Account deleting: <br><br><img src="https://habrastorage.org/files/129/f21/6fa/129f216fa82e478facf05e2674d46354.gif" alt="image"><br><br>  Choosing a registration method: <br><br><img src="https://habrastorage.org/files/7bb/bbb/27b/7bbbbb27bf654a3d8bf367ad15c4b794.gif" alt="image"><br><br>  An example of the output of the / deadlines command: <br><br><img src="https://habrastorage.org/files/754/a59/d5c/754a59d5c3364d4a9d24949738cb432f.png"><br><br><h4>  <font color="#32CD32">Stepic.org in Telegram:</font> </h4><br>  Bots can be found at: <a href="https://telegram.me/stepicbot">telegram.me/stepicbot</a> . <br><br>  Or you can immediately go to linking your account on Stepic.org with your Telegram account like this: <a href="https://stepic.org/telegram">stepic.org/telegram</a> . <br><br>  We will be happy to answer questions, constructive criticism is also welcome! <br><br>  And for a sweet set of Stepic-stickers: <a href="https://telegram.me/addstickers/Stepic">telegram.me/addstickers/Stepic</a> <br><br> <a href=""><img src="https://habrastorage.org/files/9c6/aea/980/9c6aea9808ed4ceea2b5d031be2a02ea.png"></a> </div><p>Source: <a href="https://habr.com/ru/post/303478/">https://habr.com/ru/post/303478/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303468/index.html">Experiments with Arduino 101</a></li>
<li><a href="../303470/index.html">The substandard world of open state finances</a></li>
<li><a href="../303472/index.html">Portrait of a participant of the ‚ÄúDarudar‚Äù - infographics poll</a></li>
<li><a href="../303474/index.html">Why do corporations work with startups? And why do startups work with large corporations?</a></li>
<li><a href="../303476/index.html">Writing a text game in Python / Ren'Py</a></li>
<li><a href="../303480/index.html">Project Tango from Google, or a new perception of the world?</a></li>
<li><a href="../303482/index.html">ComputerVision (Ruby & OpenCV)</a></li>
<li><a href="../303484/index.html">How we wrote helpdesk (part 3)</a></li>
<li><a href="../303486/index.html">Automation of software development: whether the "programmer" can turn into a "computer operator"</a></li>
<li><a href="../303488/index.html">Algorithm for computing the complex root of an arbitrary degree polynomial</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>