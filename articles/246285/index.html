<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing GWT MVP Architecture Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 

 In this article, I will review unit / integration testing in GWT using the GWT UI components and GXT and MVP (with Passive View) architec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing GWT MVP Architecture Applications</h1><div class="post__text post__text-html js-mediator-article">  Good day! <br><br>  In this article, I will review unit / integration testing in GWT using the GWT UI components and GXT and MVP (with Passive View) architectures to separate the logic and appearance of the application. <br>  GWT and GXT are not randomly highlighted here - Google has developed several frameworks that facilitate the support of the MVP pattern (more precisely, the more general, the separation of logic and presentation) in GWT.  These are Activity and Place for dividing application logic into modules, GWT Editor for automatic mapping of POJO objects to widget, UiBinding for declarative interface description. <br>  All this is also supported by the GXT UI framework.  T.ch.  essentially there won't be much difference in using the UI of the GWT or GXT components. <br><br>  As a result, we get an easily tested application without lifting a heavy GWT framework. <br><a name="habracut"></a><br><h4>  purpose </h4><br>  Just write tests on the GWT application with maximum functionality coverage.  Ideally, a simple writing of integration tests (integration tests would immediately cover all application layers with a minimum number of tests, thereby testing the interconnection of layers).  It is necessary, because  A lot of logic is on the client and I would also like to cover it to the maximum with simple, easy-to-run tests that can be quickly launched on the developer's machine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Used technologies and frameworks </h4><br>  1) <b>MVP</b> (Model View Presenter) with Passive View is the cornerstone in testing applications with UI.  In short, this is a pattern of separation of logic and display in which the View has a minimal role.  Due to this, View becomes simple and it will be more difficult to make mistakes in it.  And since it is difficult to test it (for this, the whole environment of the GWT will have to be raised), this will only be at hand - we will not test it. <br><br>  For details on MVP look here: <br>  MVP to GWT.  Official documentation: <a href="http://www.gwtproject.org/articles/mvp-architecture.html">www.gwtproject.org/articles/mvp-architecture.html</a> <br>  Passive View.  M. Fowler: <a href="http://martinfowler.com/eaaDev/PassiveScreen.html">martinfowler.com/eaaDev/PassiveScreen.html</a> <br>  MVP in GWT: <a href="http://www.javabeat.net/what-is-model-view-presenter-mvp-in-gwt-application/">www.javabeat.net/what-is-model-view-presenter-mvp-in-gwt-application</a> <br>  Various MV * patterns: <a href="http://outcoldman.com/ru/archive/2010/02/22/%25D0%25BF%25D0%25B0%25D1%2582%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D1%258B-mvc-mvp-%25D0%25B8-mvvm/">outcoldman.com/ru/archive/2010/02/22/patterns-mvc-mvp--mvvm</a> <br><br>  2) <b>DI</b> (Dependence Injection) - implementation for GWT - GIN, for testing without launching GWT - Guice.  All dependencies in Presenters instead of GWT.create () are defined using Inject annotation.  Those.  when using GWT RPC instead <br><pre><code class="java hljs">ServiceAsync serviceAsync = GWT.create(ServiceAsync.class);</code> </pre> <br>  write <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> ServiceAsync serviceAsync;</code> </pre><br>  It is also necessary when testing without completely raising the GWT environment - while dependencies that are not possible to create (for example, the implementation of the View) will be replaced with mocks.  Plus the use of GIN and Guice in a pair - they use some annotations to determine the DI (Inject, Provide), so the code does not need to be changed under a different DI framework and you don‚Äôt need to configure anything else - just correctly bind the dependencies. <br><br>  3) <b>Mocking</b> - emulation of objects.  It is necessary for replacement, at least View, for Presenters to work correctly.  As a framework for mocking, we use Mockito. <br><br>  4) <b>SyncProxy</b> - framework for executing GWT RPC requests from Java.  It is necessary for testing, to provide the ability to make GWT RPC calls without raising the GWT environment. <br>  SyncProxy <a href="https://code.google.com/p/gwt-syncproxy/">code.google.com/p/gwt-syncproxy</a> <br><br>  5) <b>Jetty</b> - servlet container.  Need to run a web application. <br><br>  6) <b>GWT Editor</b> - GWT framework that allows you to automatically map POJO objects to UI components.  It is necessary to unload the View from the mapping and thereby bring it closer to the Passive View. <br><br>  GWT Editor.  Official documentation: <a href="http://www.gwtproject.org/doc/latest/DevGuideUiEditors.html">www.gwtproject.org/doc/latest/DevGuideUiEditors.html</a> <br>  GWT Editor in GXT: <a href="http://docs.sencha.com/gxt/3.1.0-beta/data/Editors.html">docs.sencha.com/gxt/3.1.0-beta/data/Editors.html</a> <br><br>  7) <b>Activity and Place</b> - a framework from Google for a convenient history mechanism (the history of a page visit in the browser - back and forth buttons).  In principle, it is not required here, but makes it easy to implement support for browser history, t.ch.  also consider. <br><br>  Activity and Place.  Official documentation.  <a href="http://www.gwtproject.org/doc/latest/DevGuideMvpActivitiesAndPlaces.html">www.gwtproject.org/doc/latest/DevGuideMvpActivitiesAndPlaces.html</a> <br><br>  8) <b>UiBinder</b> - GWT mechanism for declarative description of UI.  In fact, GWT UI elements are defined as in html / jsp pages - with the help of tags.  It is also not necessary, but it allows you to unload the View, leaving only event handlers and a minimum of logic. <br><br>  UiBinder.  Official documentation: <a href="http://www.gwtproject.org/doc/latest/DevGuideUiBinder.html">www.gwtproject.org/doc/latest/DevGuideUiBinder.html</a> <br><br><h4>  Unused technologies </h4><br>  1) <b>Selenium</b> - tests written with the help of Selenium are difficult to maintain, write and run.  Although they allow for full integration testing, they need a separate person who will maintain them in working order and a separate machine on which they can be quickly started.  In small teams, if you can select and configure a server to run Selenium tests, then it is very difficult to find an individual to support them.  T.ch.  I don't consider it, although I used it successfully on other projects (with the QA engineer who wrote the tests). <br><br>  2) <b>GWTTestCase</b> - GWT JUnit runner, which allows you to raise the GWT environment in JUnit tests and emulate a browser using HtmlUnit.  Not used here, because  it runs for a long time (in fact, this is the launch of GWT in development mode), and due to the use of HtmlUnit, some JavaScript emulation may not work correctly.  In general, this is a half-hearted solution - on the one hand, the GWT is running, but the other is running a long time and will not work correctly in all cases.  T.ch.  I also did not use it, although for some cases it may come up. <br><br><h4>  Application Architecture and Highlights </h4><br>  Again, the main pattern facilitates testing in GWT - MVP with Passive View.  Its essence is to concentrate all the logic in the Presenter, to make the View as simple as possible (the simpler the code, the fewer errors it has, and since we will not cover View with tests, because it is difficult, this is very important).  At the same time, Presenter should not have a UI code - no use of UI elements, calls to GWT.create () (instead, dependency injection using DI is used) and everything that cannot be executed on the JVM.  All this is needed so that the Presenter code can be executed on the JVM without compiling it in JS or lifting GWTDevMode, which takes a long time. <br><br><h4>  Test Launch Stages </h4><br>  1) Raise Jetty with our app. <br>  2) Configure SyncProxy for our GWT RPC services. <br>  3) Using Guice, we define the implementations of the GWT RPC services, Presenters, and View interfaces (with the mock View). <br>  4) Extras.  in the case of using Activity and Place, configure ActivityMapper, ActivityManager, PlaceControler. <br>  5) Test Presenters and (if available) Activity and Place. <br><br><h4>  Sample application </h4><br>  As an example, I made an application for editing students and groups.  A student can belong to only one group.  In total there are 4 forms - a list of students, a list of groups, viewing / editing a student, viewing / editing a group. <br><br>  Sources are located here: <a href="">github.com/TimReset/example.gwt.gxt.test</a> <br>  The application is using maven.  In the project folder there is a repo folder in which SyncProxy is located (since it is not in maven) and annotation.jar from IDEA (since I use the NotNull and Nullable annotations from IDEA). <br><br>  As a base Presenter and View use the following: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    presenter'.   &lt;a href="http://www.gwtproject.org/articles/mvp-architecture.html"&gt; *   MVP  Google&lt;/a&gt;  &lt;a href="http://www.gwtproject.org/doc/latest/DevGuideMvpActivitiesAndPlaces.html"&gt; *   Activity  Place&lt;/a&gt;.         MVP.      , *  View     Presenter,       (,      *  View).   ,      callback'  View,      Presenter'  *  . * &lt;p/&gt; * &lt;p/&gt; * Use case  Presenter': * &lt;p/&gt; * Presenter'     -     Presenter'   *  EventBus,   Presenter'  (  inject).  , .. EventBus   *       Presenter'.  Presenter'     Activity. ({</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> * BaseActivity ). */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePresenter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePresenter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *  {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> View}  .         View.  * View Presenter     ,     .  ,      *   View,      View.   {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> View},   {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> IsWidget},  *     View   View. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> View. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-function"><span class="hljs-function">V </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWidget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *  View  Presenter'. , ..    {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> #setPresenter(BasePresenter)}  *     Presenter'   View   Presenter'  . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePresenter</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * View    Presenter,       View    Presenter'.  *    set ,     Inject, .. 1) GIN     - *  View   Presenter  Presenter   View.     -  * . 2) ,    View Presenter      , .. View     * Presenter,      View,  Presenter    View,    * . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> presenter   Presenter   View. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPresenter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull T presenter)</span></span></span></span>; } }</code> </pre><br><br>  The essence of the basic Presenter is to determine the main methods for working with Presenters and View: from Presenter, get the View.  The method is needed because  We do not work directly with the View (because the Presenter is responsible for the View state, and he himself must decide when he sends this View, in which state to give it), but only through the Presenter.  View has a method for installing Presenter.  The method is needed because  you can't make circular dependencies in GIN / Guice - a Presenter instance refers to View and View refers to Presenter. <br><br><h4>  UML Class Chart </h4><br><img src="https://habrastorage.org/files/7d8/ea8/824/7d8ea8824f044b278507c338c3e655a5.png"><br>  The diagram shows the relationship between the classes ‚Äî Presenter communicates with View and sends messages to the EventBus.  Activity communicates with Presenters (only one Presenter is shown in the diagram but there may be more) and works with EventBus - listens to messages from Presenters and other messages. <br><br>  The main nuances of interaction between objects: <br><br>  1) Messages from Presenter to Activity are transmitted via EventBus.  As an alternative, you can use callbacks that the Activity will install in the Presenter.  But this solution has one drawback - callbacks and you need to remember to erase, so that there are no resource leaks due to the fact that Presenter singleton and Activity is not.  Those.  Activity installed the Presenter callback.  They switched to a new Activity and did not install a callback (and the Presenter forgot to reset it) And then the link to the callback of the old Activity will hang, or worse, this callback will be called.  In the Activity and Place mechanism, the GWT when creating an Activity is passed to the ResettableEventBus, which is cleared when switching to a new Activity.  T.ch.  An activity can set how many event handlers you need without worrying about deleting them.  When you change Activity, these handlers will be automatically deleted.  And Presenter doesn't need to worry about the presence of callbacks - it simply sends messages to the EventBus. <br><br>  2) Messages from Activity to Presenter can be directly sent through the methods of the Presenter interface. <br><br>  3) Presenter with View interact through each other's interfaces.  It is necessary that when testing to replace the implementation of the View mock'om. <br><br>  4) Only Presenter knows about View - all others communicate only with Presenter.  Again, it is convenient when replacing View with mock and subsequent dependency tracking (when nobody knows about View and it is easy to change). <br><br><h4>  Test environment settings </h4><br>  Jetty is set up programmatically in the same way as in web.xml - i.e.  All that is written in web.xml is transferable to the method call in Jetty.  I did it this way, and did not explicitly specify web.xml because I could not use the relative path to web.xml, and I didn‚Äôt want to write tests focused on specific paths - I would have to change them every time.  T.ch.  if you manage to launch Jetty with a relative path to web.xml, it will be fine. <br><br>  To configure SyncProxy, we use a Map with a list of asynchronous GWT RPC services interfaces, their implementations (needed for easy launching of GWT RPC servlets in Jetty) and the paths to these servlets. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *  GWT RPC .  -  GWT RPC .  -      -  *   web.xml.     GWT RPC   Jetty     *  -        Jetty,     SyncProxy  *    Guice. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Class&lt;? extends BaseRemoteService&gt;, Pair&lt;Class&lt;?&gt;, String&gt;&gt; gwtRpcServlets = Collections .unmodifiableMap(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;Class&lt;? extends BaseRemoteService&gt;, Pair&lt;Class&lt;?&gt;, String&gt;&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = -<span class="hljs-number"><span class="hljs-number">2126682232601937926L</span></span>; { put(StudentsServiceImpl.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pair&lt;Class&lt;?&gt;, String&gt;(StudentsServiceAsync.class, <span class="hljs-string"><span class="hljs-string">"/GxtModule/students"</span></span>)); put(GroupsServiceImpl.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pair&lt;Class&lt;?&gt;, String&gt;(GroupsServiceAsync.class, <span class="hljs-string"><span class="hljs-string">"/GxtModule/groups"</span></span>)); } });</code> </pre><br><br>  Actually the mapping itself occurs in this cycle: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Map.Entry&lt;Class&lt;? extends BaseRemoteService&gt;, Pair&lt;Class&lt;?&gt;, String&gt;&gt; entry : gwtRpcServlets .entrySet()) { <span class="hljs-comment"><span class="hljs-comment">// Cookie   ,    SyncProxy   , .. http   . //      (waitForInvocation = true). ,      -       . gwtRpcAsyncInstances.put(entry.getValue().getA(), SyncProxy.newProxyInstance(entry.getValue().getA(), URL_TO_SERVER, entry.getValue().getB(), true)); }</span></span></code> </pre><br><br>  I draw your attention to the following points when using SyncProxy: <br><br>  1) Asynchronous interface instances are stored in Map gwtRpcAsyncInstances.  It is necessary that, in consequence, it is universal to get them when bind. <br><br>  2) A synchronous mechanism is used in asynchronous interfaces.  This means that when you call an asynchronous GWT RPC method, the next line of code will not be executed until the response from the server comes (i.e., the methods com.google.gwt.user.client.rpc.AsyncCallback # onFailure or com.google .gwt.user.client.rpc.AsyncCallback # onSuccess This makes writing tests very easy - in fact, the tests will be written in steps as synchronous and there will be no need to further process the waiting for the server to respond. <br><br>  3) It is necessary in the test package to create a copy of the com.google.gwt.user.server.rpc.impl.LegacySerializationPolicy class and override the com.google.gwt.user.server.rpc.impl.LegacySerializationPolicy # isInstantiable method to support the classes heirs are serializable.  T.ch.  The method code should end up with the following: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isInstantiable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;?&gt; clazz)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clazz.isPrimitive()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clazz.isArray()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isInstantiable(clazz.getComponentType()); } <span class="hljs-comment"><span class="hljs-comment">//   Serializable.class.isAssignableFrom(clazz) if (IsSerializable.class.isAssignableFrom(clazz) || Serializable.class.isAssignableFrom(clazz)) { return true; } return SerializabilityUtil.hasCustomFieldSerializer(clazz) != null; }</span></span></code> </pre><br><br>  This is necessary because  The default GWT RPC, if there is no file with the GWT Policy (file describing serializable types), uses the LegacySerializationPolicy to check whether the object can be serialized.  And in this class there is no support for the Serializable interface.  T.ch.  will have to add it manually.  It is this method override that is used (with a complete replacement of the class), since  GWT RPC directly creates an instance of this class and you cannot specify the GWT RPC for your Serializable Policy. <br><br>  And the final point of tuning is the definition of bind's in Guice.  To define Presenters, Map is also used with their Presenter class, Presenter implementation class and View classes of this Presenter. <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *  Presenter',    View.    . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Class&lt;? extends BasePresenter&gt;, Pair&lt;Class&lt;? extends BasePresenter&gt;, Class&lt;? extends BasePresenter.View&gt;&gt;&gt; presenters = Collections.unmodifiableMap(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;Class&lt;? extends BasePresenter&gt;, Pair&lt;Class&lt;? extends BasePresenter&gt;, Class&lt;? extends BasePresenter.View&gt;&gt;&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = <span class="hljs-number"><span class="hljs-number">3512350621073004110L</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T extends BasePresenter&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPresenter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; presenterInterface, Class&lt;? extends T&gt; implementPresenter, Class&lt;? extends BasePresenter.View&lt;T&gt;&gt; viewClass)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!presenterInterface.isInterface()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Should be interface "</span></span> + presenterInterface.getName()); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (implementPresenter.isInterface()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Should be class "</span></span> + implementPresenter.getName()); } put(presenterInterface, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pair&lt;Class&lt;? extends BasePresenter&gt;, Class&lt;? extends BasePresenter.View&gt;&gt;(implementPresenter, viewClass)); } { addPresenter(StudentPresenter.class, StudentPresenterImpl.class, StudentPresenter.View.class); addPresenter(StudentsListPresenter.class, StudentsListPresenterImpl.class, StudentsListPresenter.View.class); addPresenter(MainWindowPresenter.class, MainWindowPresenterImpl.class, MainWindowPresenter.View.class); } });</code> </pre><br><br>  Next, bind'im the GWT RPC asynchronous interface objects created by SyncProxy, Presenters, with the automatic creation of a mock for View, EventBus and, in our case, we raise objects for the Activity and Place to work.  I draw your attention to the fact that everything here is defined as a singleton.  For Presenters and View, this is not critical, but EventBus and classes associated with Activity and Place should be just that - because  they are used in many places and have links to each other. <br><br><pre> <code class="java hljs"> injector = Guice.createInjector(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AbstractModule() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     . for (Class gwtRpcAsyncClass : gwtRpcAsyncInstances.keySet()) { bind(gwtRpcAsyncClass).toInstance(getGwtRpc(gwtRpcAsyncClass)); } for (Map.Entry&lt;Class&lt;? extends BasePresenter&gt;, Pair&lt;Class&lt;? extends BasePresenter&gt;, Class&lt;? extends BasePresenter.View&gt;&gt;&gt; entry : presenters.entrySet()) { log.info("Bind View {}", entry.getValue().getB().getName()); bindMock(entry.getValue().getB()); log.info("Bind Presenter {} to implementation {} ", entry.getKey().getName(), entry.getValue().getA().getName()); bind(entry.getKey()).to((Class) entry.getValue().getA()).in(Singleton.class); } EventBus eventBus = new SimpleEventBus(); bind(EventBus.class).toInstance(eventBus); com.google.gwt.place.shared.PlaceController placeController = new com.google.gwt.place.shared.PlaceController( eventBus, new com.google.gwt.place.shared.PlaceController.Delegate() { //   Delegate, , .. Delegate    UI. }); bind(com.google.gwt.place.shared.PlaceController.class).toInstance(placeController); bind(ActivityMapper.class).to(ru.timreset.example.gxt.client.ActivityMapper.class).in(Singleton.class); bind(AcceptsOneWidget.class).to(ru.timreset.example.test.base.AcceptsOneWidget.class).in(Singleton.class); } /** *   mock        . * @param bindClass  mock . */ private void bindMock(Class bindClass) { Object bindObject = Mockito.mock(bindClass); bind(bindClass).toInstance(bindObject); } }); ActivityManager activityManager = new ActivityManager(getInstance(ActivityMapper.class), injector.getInstance( EventBus.class)); activityManager.setDisplay(getInstance(AcceptsOneWidget.class)); final PlaceHistoryHandler historyHandler = new PlaceHistoryHandler( new PlaceHistoryMapper(), new PlaceHistoryHandler.Historian() { //   Historian, , .. Historian    UI    . }); historyHandler.register(injector.getInstance(com.google.gwt.place.shared.PlaceController.class), injector.getInstance(EventBus.class), Place.NOWHERE); historyHandler.handleCurrentHistory();</span></span></code> </pre><br><br><h4>  Sample Presenter by StudentPresenter </h4><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Presenter    .   // . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentPresenter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePresenter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentPresenter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *   Presenter'  . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mode   Presenter'. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> studentId id . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> eventBus EventBus. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> onReady Callback       Presenter'. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull Mode mode, @Nullable Integer studentId, @NotNull EventBus eventBus, @NotNull Command onReady)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> student . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveStudent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Student student)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *    . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> true -  , false -  . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isEdit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *    . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onEditStudent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *    . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment">  . */</span></span> <span class="hljs-function"><span class="hljs-function">Mode </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *     . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> true -  , false -   . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isDirty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   Presenter'. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Mode { <span class="hljs-comment"><span class="hljs-comment">/** * . */</span></span> VIEW, <span class="hljs-comment"><span class="hljs-comment">/** * . */</span></span> EDIT, <span class="hljs-comment"><span class="hljs-comment">/** * . */</span></span> CREATE; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePresenter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentPresenter</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> student . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStudent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Student student)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *      . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> true -  , false -   . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isDirty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } }</code> </pre><br><br>  Here are the methods that must be implemented by View and Presenter. <br><br>  Messages from Presenter to View go through the StudentPresenter.View interface.  This is the usual MVP scheme.  Messages from View to Presenter go through the StudentPresenter interface.  In many MVP examples, they do not do this ‚Äî usually, in the View interface, methods for setting callbacks (eg setEditClick (Callback c)) and Presenter are done when the View is initialized, set the callback to it (eg view.setEditClick (new Callback () {/ * handler function * /})).  View should, in the implementation of methods for setting callbacks, make them retain at their place and at the right moment should call them.  I did not like this decision because there will be a lot of similar code for saving callbacks and in View there will be many fields with these callbacks.  And in Presenter there will be many anonymous classes with the code of these callbacks that are not read very well. <br><br>  That's why I chose the option when the View has a link to the Presenter interface and when it is necessary to transfer a message from View to the Presenter, the View simply calls the Presenter methods.  In this implementation, the minus of this solution is that the Presenter interface actually contains 2 types of methods - methods that are needed for interaction between the View and Presenter (in the example above, these are saveStudent, onEditStudent, getMode, isEdit) and are needed for Presenter to interact with the outside world (these are the init methods, isDirty).  To avoid this minus, you need to put the methods of View interaction with Presenter in a separate interface and View to transfer an instance of this interface.  In fact, this interface can be implemented by the same class as the StudentPresenter interface. <br><br><h5>  An example with an additional interface </h5><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentPresenter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePresenter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentPresenter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull Mode mode, @Nullable Integer studentId, @NotNull EventBus eventBus, @NotNull Command onReady)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isDirty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Mode { VIEW, EDIT, CREATE; } <span class="hljs-comment"><span class="hljs-comment">/** *     View  Presenter'. */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewPresenter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePresenter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewPresenter</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveStudent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Student student)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isEdit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onEditStudent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Mode </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePresenter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentPresenter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewPresenter</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStudent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Student student)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isDirty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } }</code> </pre><br><br>  In this case, Presenter consumers will see only the methods intended for them, and not the internal methods for interacting with the View. <br><br>   ,  C#      View  Presenter     event' ‚Äî      . <br><br><h4>   </h4><br>         <br><img src="https://habrastorage.org/files/c4d/7bf/ea5/c4d7bfea5e844efb9f50304d3fad2d8d.png"><br>   <br><br><img src="https://habrastorage.org/files/5f0/391/79b/5f039179bd814e92a3c2b1bf69552cff.png"><br>    <br><br>      : <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    Place  . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> newPlace  Place. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">goToWithAssert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Place newPlace)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/** * ,     Place. ! Place     {@link * Object#equals(Object)}.      . * * @param expectedWhere   (Place). */</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertWhere</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Place expectedWhere)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ,    View  Presenter'. ..  ,       * Presenter. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> presenter Presenter, View      . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertWhere</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BasePresenter presenter)</span></span></span></span>;</code> </pre><br><br>         ,     . <br><br>          .   Presenter'      .       ru.timreset.example.gxt.client.presenter.StudentPresenter <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listStudent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  Presenter  . MainWindowPresenter mainWindowPresenter = getInstance(MainWindowPresenter.class); //  Presenter  . StudentsListPresenter studentsListPresenter = getInstance(StudentsListPresenter.class); //     . mainWindowPresenter.goToStudentsList(); // ,   . assertWhere(studentsListPresenter); //   . studentsListPresenter.getStudents(new PagingLoadConfigBean(0, 999), new ru.timreset.example.gxt.client.AsyncCallback&lt;PagingLoadResult&lt;Student&gt;&gt;() { @Override public void onSuccess(PagingLoadResult&lt;Student&gt; result) { //,   . Assert.assertFalse(result.getData().isEmpty()); } }); }</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is a trivial example, but it already checks the work of the main menu and the list of students. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now consider the example more difficult - the creation of a student. When creating a student, we check the complete chain </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Click on the "List of students" in the menu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Click on "Create Student" in the list of students. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Fill in the fields in the student creation window. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Save the student. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Check that the saved student is in the list. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the same time, at each step, we check that the necessary forms and lists are displayed.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  Presenter  . MainWindowPresenter mainWindowPresenter = getInstance(MainWindowPresenter.class); //  Presenter  . StudentsListPresenter studentsListPresenter = getInstance(StudentsListPresenter.class); //  Presenter  . StudentPresenter studentPresenter = getInstance(StudentPresenter.class); // View  . StudentPresenter.View studentView = getInstance(StudentPresenter.View.class); //   mainWindowPresenter.goToStudentsList(); // ,   .   Place  View. assertWhere(StudentsListPlace.buildList()); assertWhere(studentsListPresenter); //    . studentsListPresenter.onCreateStudent(); //     . assertWhere(StudentPlace.buildCreate()); //      . assertWhere(studentPresenter); //     . Assert.assertEquals(StudentPresenter.Mode.CREATE, studentPresenter.getMode()); //   ArgumentCaptor&lt;Student&gt; studentArgumentCaptor = ArgumentCaptor.forClass(Student.class); Mockito.verify(studentView).setStudent(studentArgumentCaptor.capture()); //  . Student student = studentArgumentCaptor.getValue(); student.setName("TEST_NAME"); student.setSurname("TEST_SURNAME"); student.setPatronymic("TEST_PATRONYMIC"); student.setBirthday(new Date()); student.setStudentType(StudentType.ABSENTED); //  studentPresenter.saveStudent(student); //      . assertWhere(StudentsListPlace.buildList()); assertWhere(studentsListPresenter); //    ,      . studentsListPresenter.getStudents(new PagingLoadConfigBean(0, 999), new ru.timreset.example.gxt.client.AsyncCallback&lt;PagingLoadResult&lt;Student&gt;&gt;() { @Override public void onSuccess(PagingLoadResult&lt;Student&gt; result) { Collection&lt;Student&gt; coll = Collections2.filter(result.getData(), new Predicate&lt;Student&gt;() { @Override public boolean apply(Student input) { return "TEST_NAME".equals(input.getName()); } }); //,   . Assert.assertEquals(1, coll.size()); } }); }</span></span></code> </pre><br><br>            .     .    ¬´ ¬ª. ,     ¬´ ¬ª.      (,    View)    Place.      .  ,      . <br><br><br><h4>  Conclusion </h4><br> ,    ‚Äî   MVP         .    GWT Editor, UiBinder, Activity and Place.   .      .       ( ),           Presenter'           . <br><br><h5>        </h5><br>  Pros: <br> 1)         ¬´UI  ‚Äî    ‚Äî   ‚Äî   ¬ª. <br> 2)    (      ‚Äî       ). <br> 3)          UI .   <br><br>  Limitations: <br> 1)   UI . ,          ,        ,       click handler'         Presenter'.        View,    . <br> 2) MVP         ‚Äî        ,    overhead        MVP. <br><br>         ‚Äî      , ..       (  MVP)     (  ,      GWT ). <br><br><h4>   </h4><br> GWT Mockito <br> <a href="http://www.objectpartners.com/2013/11/07/testing-gwt-with-gwtmockito/">www.objectpartners.com/2013/11/07/testing-gwt-with-gwtmockito</a> <br><br> Unit and Integration Testing for GWT Applications <br> <a href="http://www.infoq.com/articles/gwt_unit_testing">www.infoq.com/articles/gwt_unit_testing</a> </div><p>Source: <a href="https://habr.com/ru/post/246285/">https://habr.com/ru/post/246285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246275/index.html">The best instant messenger for team work: Compare HipChat, Slack and Kato</a></li>
<li><a href="../246277/index.html">Assembling and installing Calamari monitoring system packages for CEPH 0.87 distributed storage on Ubuntu 04/14/1 (Trusty Tahr)</a></li>
<li><a href="../246279/index.html">Steam Stealer or Trojan stealing things on Steam. The history of the appearance and scheme of work</a></li>
<li><a href="../246281/index.html">Talk about VPNs? Types of VPN connections. VPN scaling</a></li>
<li><a href="../246283/index.html">Maintaining a "third-party" information resource. How and for what</a></li>
<li><a href="../246287/index.html">The last day of your discount is 89% on the annual program of Stratoplan</a></li>
<li><a href="../246289/index.html">Improving mobile project management</a></li>
<li><a href="../246293/index.html">6 games in 6 weeks - the third game</a></li>
<li><a href="../246297/index.html">History 6 years of installing drivers</a></li>
<li><a href="../246299/index.html">Monolith or brick?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>