<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Increase web application stack security (LAMP virtualization, step 1/6)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Configuring Apache / Lighttpd / Nginx Web Server Access to Network File System (NFS) Files 
 We continue to translate a series of lessons on virtualiz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Increase web application stack security (LAMP virtualization, step 1/6)</h1><div class="post__text post__text-html js-mediator-article"><h2>  Configuring Apache / Lighttpd / Nginx Web Server Access to Network File System (NFS) Files </h2><br>  <i>We continue to translate a series of lessons on virtualization and setting up a LAMP server from <a href="http://www.cyberciti.biz/">www.cyberciti.biz</a> and proceed to the first practical step - creating a network storage file</i> <br><br>  Creating NFSv4.0 (Network File System) shared network access storages in Linux and Unix OSs is not much different from creating other Apache / Lighttpd / Nginx shared network resources.  To do this, we make the following settings of our file server / VM <strong>vm05</strong> with the IP address <strong>192.168.1.14</strong> . <br><a name="habracut"></a><br><h3>  Linux NFS server: synchronous or asynchronous mode </h3><br>  You need to choose the most suitable mode for you NFS-server.  In the asynchronous mode ( <strong>a</strong> <strong>sync option</strong> ), responses to requests to the server occur without waiting for the end of the recording or changes in the disk files (if the recording occurs at the time of access).  The performance of this mode is higher, but it is achieved at the cost of data integrity and a rough reboot of the server (in case of system failure or other reasons) can lead to data loss or damage.  In the synchronous mode of operation ( <strong>sync</strong> <strong>option</strong> ), the response to a request to the server occurs only at the end of the recording.  We strongly recommend that you use this one ‚Äî the second synchronization mode with NFS caching enabled on the Apache / Lighttpd / Nginx local nodes, i.e.  servers <strong>vm</strong> <strong>01</strong> and <strong>vm</strong> <strong>02</strong> . <br><br><h3>  How to create a ‚Äúshared‚Äù network resource </h3><br>  To begin with, using the <a href="http://www.cyberciti.biz/faq/rhel-centos-fedora-linux-yum-command-howto/">yum-manager</a> , install the NFS server software packages: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum groupinstall "NFS file server"</span></span></code> </pre> <br>  or so ... <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install nfs-utils nfs4-acl-tools portmap</span></span></code> </pre><br>  ... and activate the installed services: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># chkconfig nfs on # chkconfig rpcbind on # chkconfig rpcidmapd on # chkconfig nfslock on</span></span></code> </pre><br><h3>  Create an NFS server user account. </h3><br>  We will use the Apache user credentials to share files with the NFS server.  The same accounts will be used on servers <strong>vm01</strong> , <strong>vm02</strong> , <strong>vm03</strong> and <strong>vm05</strong> .  To create a user account on the NFSv4 server, we will <a href="http://www.cyberciti.biz/faq/howto-add-new-linux-user-account/">use the <strong>useradd</strong> command</a> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">################################################################################## ### ,    CentOS/RHEL,     apache      ### ###  UID/GID 48,   apache   vm01  vm02         ### ###                                                           ### ################################################################################## # /usr/sbin/groupadd -g 48 apache # /usr/sbin/useradd -s /sbin/nologin -g 48 -u 48 -M -d /var/www apache # /usr/bin/passwd -l apache</span></span></code> </pre><br>  Do not install the Apache2 web server on the NFSv4 server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  /etc/idmapd.conf setting up nfs server </h4><br>  The NFSv4 ID service name daemon (rpc.idmapd) provides the kernel for the client and the NFSv4 server, linking the latter through queries and converting the ID into names, and the names into IDs.  To configure the daemon, edit the file /etc/idmapd.conf: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/idmapd.conf</span></span></code> </pre><br>  The following settings will be specified for the local NFSv4 domain.  The default DNS name of the host should be replaced with the domain name of your host. <br><br><pre> <code class="bash hljs">Domain = cyberciti.biz</code> </pre><br>  Also make sure that the mapping settings are written as follows: <br><br><pre> <code class="bash hljs">[Mapping] Nobody-User = nobody Nobody-Group = nobody</code> </pre><br>  Save and close the file. <br><br><h4>  File System Sharing </h4><br>  To create a network share <em>/ var / www / static</em> and <em>/ var / www / html</em> , perform the following steps.  <a href="http://www.cyberciti.biz/faq/linux-make-directory-command/">Use the <strong>mkdir</strong> command</a> to create the desired directory on the NFSv04 server: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir -p /exports/{static,html}</span></span></code> </pre><br>  <a href="http://www.cyberciti.biz/faq/how-to-mount-bind-partitions-filesystems-in-linux/">Link the directories created</a> with the <em>/ exports</em> directory: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mount --bind /var/www/html /exports/html # mount --bind /var/www/static /exports/static</span></span></code> </pre><br>  Edit the <a href="http://www.cyberciti.biz/faq/tag/etcfstab/"><em>/ etc / fstab file</em></a> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/fstab</span></span></code> </pre><br>  Adding to it the following entries: <br><pre> <code class="bash hljs">/var/www/html /exports/html none <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /var/www/static /exports/static none <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> </pre><br>  Save and close the file.  Now edit the <a href="http://www.cyberciti.biz/faq/centos-fedora-rhel-nfs-v4-configuration/"><em>/ etc / exports</em></a> file: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/exports</span></span></code> </pre><br>  Add the following parameters to it: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">################################# ###   vm01  vm02 ### ### by vivek Thu June 21,2012 ### ################################# ##   nfs, fsid=0  NFSv4 ## /exports  192.168.1.10(rw,fsid=0,no_subtree_check,async) 192.168.1.11(rw,fsid=0,no_subtree_check,async) ###  NFS   www.cyberciti.biz ### /exports/html  192.168.1.10(rw,no_subtree_check,async,nohide) 192.168.1.11(rw,no_subtree_check,async,nohide) #      ¬´-¬ª (ro).                   # #     ,    ¬´--¬ª (rw)# /exports/static 192.168.1.10(ro,no_subtree_check,async,nohide) 192.168.1.11(ro,no_subtree_check,async,nohide)</span></span></code> </pre><br>  Save and close the file.  Now you can <a href="http://www.cyberciti.biz/faq/how-do-i-start-and-stop-nfs-service/">start <strong>nfs</strong> and related services</a> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /sbin/service rpcbind start # /sbin/service rpcidmapd start # /sbin/service nfslock start # /sbin/service nfs start</span></span></code> </pre><br><h4>  Securing the NFSv04 server </h4><br>  You can <a href="http://www.cyberciti.biz/faq/centos-fedora-rhel-nfs-v4-configuration/">set up a firewall and configure TCPWrapper</a> using the script provided by the link.  Alternatively, <a href="http://www.cyberciti.biz/faq/centos-fedora-rhel-iptables-open-nfs-server-ports/">configure the <strong>iptables</strong> table using fixed ports</a> on the NFS server.  You can also use network view or network (mask) machines ( <strong>vm01</strong> , <strong>vm02</strong> ) on your network by lifting the NFS file system from this server.  Edit the <em>/ etc / sysconfig / iptables</em> file by adding the following parameters.  Make sure that these parameters are written before the LOG and DROP lines: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">##   nfsv4-                           ## -A INPUT -s 192.168.1.0/24 -m state --state NEW -p tcp --dport 2049 -j ACCEPT</span></span></code> </pre><br>  Save and close the file.  <a href="http://www.cyberciti.biz/faq/howto-start-iptables-under-rhel-centos-linux/">Restart the <strong>iptables</strong> service</a> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># service iptables restart</span></span></code> </pre><br><h4>  "Share" resources </h4><br>  Now you can upload static files in the <em>/ var / www / static</em> and php / html files in the <em>/ var / www / html</em> server directories.  Do not put Unix-sockets on the shared file system NFS.  If you use SELinux, you must configure the standard permissions and rights of the owner of the files with the SELinux security requirements, but you can (temporarily) disable SELinux to test the system.  For more details, see the <a href="http://cyberciti.biz/">cyberciti.biz</a> materials: <br><br><ol><li>  Temporary disabling of SELinux [ <a href="http://www.cyberciti.biz/faq/rhel-fedora-centos-linux-temporarily-switchoff-selinux/">eng</a> ] </li><li>  Disabling SELinux for Apache / httpd on Linux (not recommended) [ <a href="httpd-selinux-security-protection/">eng</a> ] </li></ol><br><br><h3>  Last note on NFS </h3><br><ul><li>  In the given configuration example, NFS is the ‚Äúpoint of failure‚Äù for the internal RAID of the disk array.  However, you can solve this problem by installing SAN devices or NAS storage.  High storage redundancy increase project cost. </li><li>  In addition, make sure that each virtual machine configured by us acts as either a client or a server, and not both. </li><li>  In order to avoid problems with maintenance and security, NFS should be deployed in the simplest configuration. </li></ul><br><br><ul><li>  <a href="http://habrahabr.ru/post/147864/">Prologue</a> </li><li>  <a href="http://habrahabr.ru/post/148004/">Step # 1: Setup / Installation: NFS File Server</a> </li><li>  <a href="http://habrahabr.ru/post/148077/">Step 2: Setup / Installation: MySQL Database Server</a> </li><li>  <a href="http://habrahabr.ru/post/148488/">Step 3: Configure / Install: Memcached Caching Server</a> </li><li>  <a href="http://habrahabr.ru/post/148489/">Step # 4: Setup / Installation: Apache + php5 web server application</a> </li><li>  <a href="http://habrahabr.ru/post/148490/">Step 5: Configure / Install: Lighttpd web server for static files</a> </li><li>  <a href="http://habrahabr.ru/post/148491/">Step 6: Setup / Installation: Nginx reverse (reverse) proxy server</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/148004/">https://habr.com/ru/post/148004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147999/index.html">"Toy" cartography or 3D cards do it yourself</a></li>
<li><a href="../148000/index.html">Edit-in-place on Bootstrap components</a></li>
<li><a href="../148001/index.html">Review of fresh materials, April-June 2012</a></li>
<li><a href="../148002/index.html">The ideal student, or what is silent in machine learning</a></li>
<li><a href="../148003/index.html">Completed the contest on VK messenger for Android</a></li>
<li><a href="../148009/index.html">Runetology (156): Sergei Bulaev, the creator of ‚ÄúBuy a loaf!‚Äù And ‚ÄúTiny Beach‚Äù</a></li>
<li><a href="../148010/index.html">The whole PHP in two lines</a></li>
<li><a href="../148011/index.html">Intel and The Code Project competition for Android games</a></li>
<li><a href="../148012/index.html">#SaveTheArctic by Anonymous, or data leak from Shell, Gazprom, Rosneft and BP Global</a></li>
<li><a href="../148013/index.html">J.Subbotnik in Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>