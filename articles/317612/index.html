<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exporting tabular data from applications written under .NET in C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 It all started with the fact that he began to write a simple program that was supposed to perform the functions of a telephone directory....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exporting tabular data from applications written under .NET in C #</h1><div class="post__text post__text-html js-mediator-article"><h3>  Prehistory </h3><br>  It all started with the fact that he began to write a simple program that was supposed to perform the functions of a telephone directory.  As the main component in which all data will be placed, I selected an object of the ListView class.  But any good program should be able to save all its data into a separate file, with its subsequent loading, to continue working with data. <br><br>  In order not to reinvent the wheel, I decided to save the data in an XML file.  This type of file is very convenient and popular with many developers, it is easy to work with it.  Its only drawback is weak data security.  It can be opened with any simple text editor, although you can use text encryption - this does not guarantee complete security for the information in the file. <br><br><h3>  How to export data? </h3><br><img src="https://habrastorage.org/files/f4e/65f/899/f4e65f8992904214bf356cc2b5672c61.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see from the screenshot, in the menu item "File" everything is already prepared for the export and import of our phone book, it remains to write the code itself. <br><br>  When writing this program, I have not yet had any practical experience with XML files in C # under the .NET platform.  Therefore, I began to look for material on the Internet.  But all my search results were not comforting.  All the results found gave a very rough and macaroni code that can be adapted to suit your needs.  However, it is still not practical.  This code is not easily possible to use in different projects. <br><br>  After that, I decided to delve into the very feature of working with XML files in C #. <br><a name="habracut"></a><br><h3>  Adaptive code </h3><br>  I turned my attention to the textbook on the C # language, written by Mikhail Flenov, " <b>Bible C #. 2nd edition</b> ".  In his book, the author often recommends and insists on the full use of classes.  And in the topic of working with XML-files, in order to export and import this one uses ‚Äúcorresponding‚Äù methods, which are the methods of the class of the object with which it works. <br><br>  This method is very good, provided that we personally write the class of the object with which we will work.  And what about when we use a ready-made class?  For example, the <b>ListView</b> or <b>Datagridview class</b> , we did not write them (personally), but many of us use them often. <br><br>  At this moment, I realized that I need to create my own class, which I can always use.  So I do not need (in the future) to spend all the time on describing various parameters.  You just need to override the class methods, or just make edits. <br><br><h3>  XML class </h3><br><div class="spoiler">  <b class="spoiler_title">XML class code</b> <div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Stroka</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> el1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> el2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> el3, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> el4</span></span></span><span class="hljs-function">)</span></span> { El1 = el1; El2 = el2; El3 = el3; El4 = el4; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> El1 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> El2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> El3 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> El4 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveToFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">XmlTextWriter xmlOut</span></span></span><span class="hljs-function">)</span></span> { xmlOut.WriteStartElement(<span class="hljs-string"><span class="hljs-string">""</span></span>); xmlOut.WriteAttributeString(<span class="hljs-string"><span class="hljs-string">"1"</span></span>, El1.ToString()); xmlOut.WriteAttributeString(<span class="hljs-string"><span class="hljs-string">"2"</span></span>, El2.ToString()); xmlOut.WriteAttributeString(<span class="hljs-string"><span class="hljs-string">"3"</span></span>, El3.ToString()); xmlOut.WriteAttributeString(<span class="hljs-string"><span class="hljs-string">"4"</span></span>, El4.ToString()); xmlOut.WriteEndElement(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">XmlTextReader xmlin</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { El1 = xmlin.GetAttribute(<span class="hljs-string"><span class="hljs-string">"1"</span></span>); El2 = xmlin.GetAttribute(<span class="hljs-string"><span class="hljs-string">"2"</span></span>); El3 = xmlin.GetAttribute(<span class="hljs-string"><span class="hljs-string">"3"</span></span>); El4 = xmlin.GetAttribute(<span class="hljs-string"><span class="hljs-string">"4"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception) { } } }</code> </pre> <br></div></div><br>  For this class to work, you need to connect two more assemblies: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Xml;</code> </pre> <br>  I decided to call the class " <b>Stroka</b> ", this is because we will loop through all the rows in our table.  Also note that in all parts of the code 4 elements are described.  This is intentional.  The number of elements must match our number of columns in the table. <br><br>  Since our class is ready, we can collapse it in our project, and no longer look into it. <br><br><h3>  Beautiful export (preservation) </h3><br>  Let's not rush to finish our work.  And we will write a few more lines of code that will allow us to invoke the save dialog box. <br><br><img src="https://habrastorage.org/files/ec1/424/54a/ec142454a2a04c29871416c12e3b2adf.jpg" alt="image"><br><br>  We can call this window like this: <br><br><div class="spoiler">  <b class="spoiler_title">Window call code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">private <span class="hljs-type"><span class="hljs-type">void</span></span> ToolStripMenuItem_Click(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, EventArgs e) { <span class="hljs-type"><span class="hljs-type">int</span></span> count = listView1.Items.Count; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { MessageBox.<span class="hljs-keyword"><span class="hljs-keyword">Show</span></span>(" .  ."); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filename == "") { SaveFileDialog fileDialog = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SaveFileDialog(); fileDialog.Title = ""; fileDialog.<span class="hljs-keyword"><span class="hljs-keyword">Filter</span></span> = "XML files|*.xml"; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fileDialog.ShowDialog() != DialogResult.OK) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; filename = fileDialog.FileName; Export(); } }</code> </pre> <br></div></div><br>  As you can see, this is already a method for exporting data to an XML file.  But nothing interesting happens here, only the window for export is called, and its path is written to the variable " <b>filename</b> ".  This is a regular string variable that is created at the beginning of the project. <br><br>  It looks like this: <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Drawing; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Forms; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">TestPhoneBook</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainWindow</span></span> : <span class="hljs-title"><span class="hljs-title">Form</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> filename = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); } ...</code> </pre> <br></div></div><br>  The export itself will be executed in the ‚ÄúExport ();‚Äù method. <br><br><h3>  The time of the method "Export ();" </h3><br><div class="spoiler">  <b class="spoiler_title">Export () method code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Export() { //      <span class="hljs-type"><span class="hljs-type">xml</span></span>- FileStream fs = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileStream(filename, FileMode.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>); XmlTextWriter xmlOut = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XmlTextWriter(fs, <span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.Unicode); xmlOut.Formatting = Formatting.Indented; //   xmlOut.WriteStartDocument(); xmlOut.WriteComment(" .  "); xmlOut.WriteComment(" :  "); //   xmlOut.WriteStartElement("PhoneBook"); xmlOut.WriteAttributeString("Version", "1.0.0"); //    <span class="hljs-type"><span class="hljs-type">int</span></span> count = listView1.Items.Count; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> t = <span class="hljs-number"><span class="hljs-number">0</span></span>; t &lt; count; t++) { ListViewItem item = listView1.Items[t]; Stroka stroka = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Stroka(); stroka.Main(item.SubItems[<span class="hljs-number"><span class="hljs-number">0</span></span>].Text, item.SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text, item.SubItems[<span class="hljs-number"><span class="hljs-number">2</span></span>].Text, item.SubItems[<span class="hljs-number"><span class="hljs-number">3</span></span>].Text); stroka.SaveToFile(xmlOut); } //     xmlOut.WriteEndElement(); xmlOut.WriteEndDocument(); //   xmlOut.<span class="hljs-keyword"><span class="hljs-keyword">Close</span></span>(); fs.<span class="hljs-keyword"><span class="hljs-keyword">Close</span></span>(); }</code> </pre> <br></div></div><br>  It is important to note that most of this code is ‚Äútemplate‚Äù, for many of our projects with this class, the only distinguishing feature will always be our ‚Äúloop through all elements‚Äù.  It will differ depending on which ‚Äútable‚Äù we will export the data from.  In this case, the data is taken from the object of the <b>ListView</b> class. <br><br>  Pay attention to the lines: <br><br><pre> <code class="hljs pgsql">Stroka stroka = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Stroka(); stroka.Main(item.SubItems[<span class="hljs-number"><span class="hljs-number">0</span></span>].Text, item.SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text, item.SubItems[<span class="hljs-number"><span class="hljs-number">2</span></span>].Text, item.SubItems[<span class="hljs-number"><span class="hljs-number">3</span></span>].Text);</code> </pre> <br>  We create an object of class (our) <b>Stroka</b> , and in its method <b>Main we</b> put the elements of the row (our 4 columns). <br><br><h3>  Export Completed </h3><br><img src="https://habrastorage.org/files/618/1c1/7d5/6181c17d5e79496fb8b8843e04f6c97b.jpg" alt="image"><br><br>  I opened the XML file with Notepad, and we can compare the file structure with our code. <br><br>  Our class also allows you to import data into our application.  We can also edit and do any other work with them as if the data were originally in the program. <br><br>  But more about that in another publication. </div><p>Source: <a href="https://habr.com/ru/post/317612/">https://habr.com/ru/post/317612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317588/index.html">The Tale of Lost Time</a></li>
<li><a href="../317596/index.html">Mitap TechTalks from EXANTE and HSE</a></li>
<li><a href="../317598/index.html">Add-on to Avito. Startup or architecture example</a></li>
<li><a href="../317602/index.html">Many to many link and upsert in Ecto 2.1</a></li>
<li><a href="../317610/index.html">Test task as a means of collecting ideas</a></li>
<li><a href="../317618/index.html">These companies are luring digital professionals from all the rest.</a></li>
<li><a href="../317620/index.html">DotNext - Moscow 2016. How it was</a></li>
<li><a href="../317622/index.html">Create your own ‚ÄúNeural Patterns‚Äù with the help of Deep Learning.</a></li>
<li><a href="../317624/index.html">OpenCV: setting a timeout to wait for a frame in the VideoCapture class</a></li>
<li><a href="../317626/index.html">Yandex used a neural network and learned how to predict precipitation to the nearest minute.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>