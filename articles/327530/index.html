<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bash scripts, part 7: sed and word processing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bash scripts: start 
 Bash scripts, part 2: loops 
 Bash scripts, part 3: command line options and keys 
 Bash scripts, part 4: input and output 
 Bas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bash scripts, part 7: sed and word processing</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <a href="https://habrahabr.ru/company/ruvds/blog/325522/">Bash scripts: start</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/325928/">Bash scripts, part 2: loops</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326328/">Bash scripts, part 3: command line options and keys</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326594/">Bash scripts, part 4: input and output</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326826/">Bash Scripts, Part 5: Signals, Background Tasks, Script Management</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327248/">Bash scripts, part 6: functions and library development</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327530/">Bash scripts, part 7: sed and word processing</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327754/">Bash scripts, part 8: awk data processing language</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327896/">Bash scripts, part 9: regular expressions</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/328346/">Bash scripts, part 10: practical examples</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/328436/">Bash scripts, part 11: expect and automate interactive utilities</a> </blockquote><br>  Last time we talked about functions in bash scripts, in particular, how to call them from the command line.  Our topic today is a very useful tool for processing string data - a Linux utility called sed.  It is often used to work with texts that look like log files, configuration files, and other files. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/327530/"><img src="https://habrastorage.org/files/803/892/bfe/803892bfe548499aa763df324d40fd01.png"></a> <br><a name="habracut"></a><br>  If you, in bash-scripts, somehow process the data, you will not interfere with the <a href="https://en.wikipedia.org/wiki/Sed">sed</a> and gawk tools.  Here we will focus on sed and on working with texts, as this is a very important step in our journey through the vast expanses of bash script development. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now we will analyze the basics of working with sed, as well as consider more than three dozen examples of using this tool. <br><br><h2>  <font color="#3AC1EF">Sed basics</font> </h2><br>  The sed utility is called a stream text editor.  In interactive text editors, like nano, they work with texts using the keyboard, editing files, adding, deleting, or changing texts.  Sed allows you to edit data streams based on the developer-defined rule sets.  Here is the scheme of calling this command: <br><br><pre><code class="hljs pgsql">$ sed <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> file</code> </pre> <br>  By default, sed applies the rules specified when invoked, expressed as a set of commands, to <code>STDIN</code> .  This allows data to be transmitted directly to sed. <br><br>  For example: <br><br><pre> <code class="hljs smalltalk"><span class="hljs-string"><span class="hljs-string">$ </span></span>echo <span class="hljs-comment"><span class="hljs-comment">"This is a test"</span></span> | sed <span class="hljs-string"><span class="hljs-string">'s/test/another test/'</span></span></code> </pre> <br>  That's what happens when you run this command. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/003/400/2d0/0034002d055addd8a4856665f77b4339.png"></div><br>  <i><font color="#999999">A simple example of calling sed</font></i> <br><br>  In this case, sed replaces the word ‚Äútest‚Äù in the line passed for processing with the words ‚Äúanother test‚Äù.  For the design of the rules for processing text enclosed in quotes, use forward slashes.  In our case, a command of the form <code>s/pattern1/pattern2/</code> .  The letter "s" is an abbreviation of the word "substitute", that is - we have a replacement team.  Sed, executing this command, will scan the transferred text and replace the fragments found in it (about which <code>pattern1</code> , <code>pattern2</code> talk below), corresponding to <code>pattern1</code> , with <code>pattern2</code> . <br><br>  The above is a primitive example of using sed, which is needed to get you up to speed.  In fact, sed can be used in much more complex word processing scenarios, for example, for working with files. <br><br>  Below is a file containing a fragment of text, and the results of its processing with such a command: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'s/test/another test'</span></span> ./myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/271/371/f182713713c516cf7dd12b56d8579c98.png"></div><br>  <i><font color="#999999">Text file and its processing results</font></i> <br><br>  This is the same approach that we used above, but now sed processes the text stored in the file.  At the same time, if the file is large enough, you can see that sed processes the data in chunks and displays what is processed on the screen, without waiting for the entire file to be processed. <br><br>  Sed does not change the data in the file being processed.  The editor reads the file, processes the read, and sends what came out in <code>STDOUT</code> .  In order to make sure that the source file has not changed, it is enough to open it after it has been transferred to sed.  If necessary, the sed output can be redirected to a file, it is possible to overwrite the old file.  If you are familiar with one of the previous <a href="https://habrahabr.ru/company/ruvds/blog/326594/">materials in</a> this series, where it comes to redirecting input and output streams, you may well be able to do this. <br><br><h2>  <font color="#3AC1EF">Executing command sets when calling sed</font> </h2><br>  To perform multiple actions on data, use the <code>-e</code> switch when invoking sed.  For example, here's how to organize the replacement of two pieces of text: <br><br><pre> <code class="hljs ruby">$ sed -e <span class="hljs-string"><span class="hljs-string">'s/This/That/; s/test/another test/'</span></span> ./myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abd/bac/90d/abdbac90d073f056788d64f50983f8a6.png"></div><br>  <i><font color="#999999">Using the -e switch when calling sed</font></i> <br><br>  Both commands are applied to each line of text from a file.  They should be separated by a semicolon, while there should be no space between the end of the command and the semicolon. <br>  To enter several text processing templates when you call sed, you can, after entering the first single quote, press Enter, and then enter each rule from a new line, without forgetting about the closing quote: <br><br><pre> <code class="hljs ruby">$ sed -e <span class="hljs-string"><span class="hljs-string">' &gt; s/This/That/ &gt; s/test/another test/'</span></span> ./myfile</code> </pre> <br>  That's what happens after the command presented in this form will be executed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c8/820/a20/3c8820a20ba2110e8564fd0c842c69a1.png"></div><br>  <i><font color="#999999">Another way to work with sed</font></i> <br><br><h2>  <font color="#3AC1EF">Reading commands from a file</font> </h2><br>  If there are many sed commands with which you need to process the text, it is usually best to pre-write them to a file.  To specify a sed file containing commands, use the <code>-f</code> : <br><br>  Here are the contents of the <code>mycommands</code> file: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">s</span></span>/This/That/ <span class="hljs-regexp"><span class="hljs-regexp">s/test/another test/</span></span></code> </pre> <br>  Call sed, passing the editor a file with commands and a file for processing: <br><br><pre> <code class="hljs ruby">$ sed -f mycommands myfile</code> </pre> <br>  The result of calling such a command is similar to that obtained in the previous examples. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/798/725/466/798725466a87616ce1a839d839b2ee4f.png"></div><br>  <i><font color="#999999">Using the command file when calling sed</font></i> <br><br><h2>  <font color="#3AC1EF">Replacement team flags</font> </h2><br>  Take a close look at the following example. <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'s/test/another test/'</span></span> myfile</code> </pre> <br>  This is what the file contains and what will be obtained after it is processed by sed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2b2/23b/bcf/2b223bbcf88ab80c8e9c41eec40f941b.png"></div><br>  <i><font color="#999999">Source file and its processing results</font></i> <br><br>  The replace command normally processes a file consisting of several lines, but only the first occurrences of the required text fragment in each line are replaced.  In order to replace all occurrences of a pattern, you need to use the appropriate flag. <br><br>  The scheme of the replacement command when using flags looks like this: <br><br><pre> <code class="hljs">s/pattern/replacement/flags</code> </pre> <br>  The execution of this command can be modified in several ways. <br><br><ul><li>  When transmitting the number, the sequence number of the occurrence of the pattern in the string is taken into account. <br></li><li>  The <code>g</code> flag indicates that you need to process all occurrences of the pattern that are in the string. <br></li><li>  The <code>p</code> flag indicates that the contents of the source string should be displayed. <br></li><li>  A <code>w file</code> flag tells the command to write text processing results to a file. <br></li></ul><br>  Consider using the first variant of the replacement command, indicating the position of the replaced occurrence of the desired fragment: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'s/test/another test/2'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a54/fe8/7f0/a54fe87f0fc9b8d27b06f63567f226c6.png"></div><br>  <i><font color="#999999">Calling a replacement command indicating the position of the fragment being replaced</font></i> <br><br>  Here we indicated the number 2 as the replacement flag. This led to the fact that only the second occurrence of the search pattern in each line was replaced.  Now let's test the global replacement flag - <code>g</code> : <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'s/test/another test/g'</span></span> myfile</code> </pre> <br>  As can be seen from the output, this command replaced all occurrences of the pattern in the text. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9e/655/342/b9e655342c3c79d46451f3f6009e4112.png"></div><br>  <i><font color="#999999">Global replacement</font></i> <br><br>  The replace command <code>p</code> flag allows you to output lines that match, and the <code>-n</code> specified when you call sed suppresses normal output: <br><br><pre> <code class="hljs ruby">$ sed -n <span class="hljs-string"><span class="hljs-string">'s/test/another test/p'</span></span> myfile</code> </pre> <br>  As a result, when you run sed in such a configuration, only lines (in our case, one line) are displayed on the screen in which the specified text fragment is found. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4af/7e8/8bb/4af7e88bb859d3ec2d13c8930dcbeb0a.png"></div><br>  <i><font color="#999999">Using the replace command flag p</font></i> <br><br>  We use the <code>w</code> flag, which allows you to save the text processing results to a file: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'s/test/another test/w output'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b65/95d/aff/b6595daff5c4d194dd9dc1788a275d22.png"></div><br>  <i><font color="#999999">Saving text processing results to a file</font></i> <br><br>  It is clearly seen that during the work of the command, the data is output to <a href="https://habrahabr.ru/company/ruvds/blog/326594/">STDOUT</a> , while the processed lines are written to the file whose name is specified after <code>w</code> . <br><br><h2>  <font color="#3AC1EF">Delimiter characters</font> </h2><br>  Imagine replacing <code>/bin/bash</code> with <code>/bin/csh</code> in the <code>/etc/passwd</code> .  The task is not so difficult: <br><br><pre> <code class="hljs tex"><span class="hljs-formula"><span class="hljs-formula">$ sed 's/</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">/</span></span></span></span></span><span class="hljs-formula">bin</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">/</span></span></span></span></span><span class="hljs-formula">bash/</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">/</span></span></span></span></span><span class="hljs-formula">bin</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">/</span></span></span></span></span><span class="hljs-formula">csh/' /etc/passwd</span></span></code> </pre> <br>  However, this does not look very good.  The thing is that since the forward slashes are used as separator characters, the same characters in the transmitted sed lines have to be escaped.  As a result, the readability of the command suffers. <br><br>  Fortunately, sed allows us to set the delimiter characters ourselves for use in the replace command.  The separator is the first character that will be encountered after <code>s</code> : <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'s!/bin/bash!/bin/csh!'</span></span> /etc/passwd</code> </pre> <br>  In this case, an exclamation point is used as a separator, as a result, the code is easier to read and it looks much tidier than before. <br><br><h2>  <font color="#3AC1EF">Select text fragments for processing</font> </h2><br>  So far, we have called sed to process the entire data stream passed to the editor.  In some cases, with the help of sed, it is necessary to process only some part of the text ‚Äî some specific line or group of lines.  To achieve this goal, you can use two approaches: <br><br><ul><li>  Set a limit on the number of lines to be processed. <br></li><li>  Specify the filter corresponding to the line to be processed. <br></li></ul><br>  Consider the first approach.  There are two possible options.  The first, discussed below, provides for the indication of the number of one line to be processed: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'2s/test/another test/'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de2/bc0/f0f/de2bc0f0ff9ed238085298bdde0e0b5e.png"></div><br>  <i><font color="#999999">Processing only one line whose number is set when you call sed</font></i> <br><br>  The second option is a range of lines: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'2,3s/test/another test/'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/782/882/bed/782882bed5d8f69312c9ba035fb84f2b.png"></div><br>  <i><font color="#999999">Row range processing</font></i> <br><br>  In addition, you can call the replace command so that the file is processed starting from a certain line to the end: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'2,$s/test/another test/'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64b/51f/ad4/64b51fad408d00d803f80fc8c6ec7859.png"></div><br>  <i><font color="#999999">File processing starting from the second line to the end</font></i> <br><br>  In order to process only the rows corresponding to the specified filter using the replace command, the command must be called as follows: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'/likegeeks/s/bash/csh/'</span></span> /etc/passwd</code> </pre> <br>  By analogy with what was considered above, the pattern is passed before the command name <code>s</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/51f/531/15d/51f53115d810706487f9affff1281994.png"></div><br>  <i><font color="#999999">Processing strings matching the filter</font></i> <br><br>  Here we used a very simple filter.  In order to fully reveal the possibilities of this approach, you can use regular expressions.  We will talk about them in one of the following materials in this series. <br><br><h2>  <font color="#3AC1EF">Delete rows</font> </h2><br>  The sed utility is not only suitable for replacing some character strings in strings with others.  With its help, namely, using the <code>d</code> command, you can delete lines from the text stream. <br><br>  The command call looks like this: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'3d'</span></span> myfile</code> </pre> <br>  We want the third line to be removed from the text.  Please note that this is not a file.  The file will remain unchanged, the deletion will only affect the output that will form sed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/05a/d70/3f7/05ad703f73023686c4c9ae7dad126252.png"></div><br>  <i><font color="#999999">Delete third row</font></i> <br><br>  If the <code>d</code> command does not specify the line number to be deleted, all the lines in the stream will be deleted. <br><br>  Here's how to apply the <code>d</code> command to a range of lines: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'2,3d'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/8ab/5be/0a58ab5be14c11121d761c7e8973dd1d.png"></div><br>  <i><font color="#999999">Delete row range</font></i> <br><br>  And here is how to delete lines starting from the given one - and to the end of the file: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'3,$d'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48c/e22/f12/48ce22f12b835645a7b53e138d5591c8.png"></div><br>  <i><font color="#999999">Delete lines to end of file</font></i> <br><br>  Lines can also be deleted by pattern: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'/test/d'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7e/ed5/e18/e7eed5e18cac4a22642ed4fce029615d.png"></div><br>  <i><font color="#999999">Delete rows by pattern</font></i> <br><br>  When you call <code>d</code> you can specify a couple of patterns - the lines will be deleted in which the pattern will be found, and the lines that are between them: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'/second/,/fourth/d'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/706/3df/7b0/7063df7b072328aa6c32bc4701c13a2a.png"></div><br>  <i><font color="#999999">Delete a range of rows using templates</font></i> <br><br><h2>  <font color="#3AC1EF">Insert text to stream</font> </h2><br>  With sed, you can insert data into a text stream using the <code>i</code> and <code>a</code> commands: <br><br><ul><li>  The <code>i</code> command adds a new line before the specified one. <br></li><li>  The <code>a</code> command adds a new line after the specified one. <br></li></ul><br>  Consider an example of using the <code>i</code> command: <br><br><pre> <code class="hljs bash">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Another test"</span></span> | sed <span class="hljs-string"><span class="hljs-string">'i\First test '</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be9/6cd/803/be96cd803c49925b9516b989f902b3de.png"></div><br>  <i><font color="#999999">Command i</font></i> <br><br>  Now take a look at the <code>a</code> command: <br><br><pre> <code class="hljs bash">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Another test"</span></span> | sed <span class="hljs-string"><span class="hljs-string">'a\First test '</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10d/8b8/b4f/10d8b8b4f5a0ce85030f0e5563db8127.png"></div><br>  <i><font color="#999999">Command a</font></i> <br><br>  As you can see, these commands add text before or after the data from the stream.  What if you need to add a line somewhere in the middle? <br><br>  Here we will be helped by the indication of the number of the reference line in the stream, or pattern.  Note that addressing strings as a range does not work here.  Call the <code>i</code> command, specifying the line number before which you need to insert a new line: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'2i\This is the inserted line.'</span></span> myfile</code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/094/6be/4ef/0946be4ef914bf39059fd01eb97bd948.png"></div><br>  <i><font color="#999999">The i command with the reference line number</font></i> <br><br>  Do the same with the <code>a</code> command: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'2a\This is the appended line.'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b80/0d3/eb1/b800d3eb18a27f331d8fc9b5b3f014c2.png"></div><br>  <i><font color="#999999">Command a with reference line number</font></i> <br><br>  Notice the difference between the <code>i</code> and <code>a</code> commands.  The first inserts a new line to the specified, the second - after. <br><br><h2>  <font color="#3AC1EF">Replacing strings</font> </h2><br>  The <code>c</code> command allows you to change the contents of a whole line of text in a data stream.  When calling it, you need to specify the line number, instead of which new data should be added to the stream: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'3c\This is a modified line.'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/463/88b/3e2/46388b3e27486dc3ec57e7286529563c.png"></div><br>  <i><font color="#999999">Replacing the entire string</font></i> <br><br>  If you use a template in the form of a plain text or a regular expression, all the lines matching the pattern will be replaced: <br><br><pre> <code class="hljs vhdl">$ sed '/This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>/c This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a changed <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-literal"><span class="hljs-literal">text</span></span>.' myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e9/f61/112/3e9f61112ede9cd01bc9258449a2bb76.png"></div><br>  <i><font color="#999999">Replacing strings by pattern</font></i> <br><br><h2>  <font color="#3AC1EF">Character replacement</font> </h2><br>  The <code>y</code> command works with individual characters, replacing them in accordance with the data passed to it when it is called: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'y/123/567/'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08f/6e3/fff/08f6e3fff71b4d8ff29eeb861f45f87e.png"></div><br>  <i><font color="#999999">Character replacement</font></i> <br><br>  Using this command, you need to take into account that it applies to the entire text flow, you cannot limit it to specific occurrences of characters. <br><br><h2>  <font color="#3AC1EF">Display line numbers</font> </h2><br>  If you call sed using the <code>=</code> command, the utility displays line numbers in the data stream: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'='</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cf/93d/c7d/8cf93dc7dbfff532d258cf84f92dd990.png"></div><br>  <i><font color="#999999">Display line numbers</font></i> <br><br>  The stream editor output line numbers in front of their contents. <br><br>  If you pass a pattern to this command and use the sed <code>-n</code> key, only line numbers matching the pattern will be output: <br><br><pre> <code class="hljs ruby">$ sed -n <span class="hljs-string"><span class="hljs-string">'/test/='</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cba/747/50f/cba74750fb26c13f9c91d5ebaa14c3bb.png"></div><br>  <i><font color="#999999">Display line numbers matching the pattern</font></i> <br><br><h2>  <font color="#3AC1EF">Reading data to insert from file</font> </h2><br>  Above, we looked at techniques for inserting data into a stream, indicating what needs to be inserted, right when you call sed.  As a data source, you can use the file.  To do this, use the <code>r</code> command, which allows you to insert data from the specified file into the stream.  When you call it, you can specify the line number after which you want to insert the contents of the file, or a template. <br><br>  Consider an example: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'3r newfile'</span></span> myfile</code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c79/cbf/3ad/c79cbf3adeabd2b1fd103ce59a8d27fe.png"></div><br>  <i><font color="#999999">Insert file into stream</font></i> <br><br>  Here the contents of the file <code>newfile</code> were inserted after the third line of the file <code>myfile</code> . <br><br>  Here's what happens if you apply a pattern when invoking the <code>r</code> command: <br><br><pre> <code class="hljs ruby">$ sed <span class="hljs-string"><span class="hljs-string">'/test/r newfile'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbd/bb8/b9d/cbdbb8b9db2f43d1f468db24ccf0647e.png"></div><br>  <i><font color="#999999">Using a template when calling the r command</font></i> <br><br>  The contents of the file will be inserted after each line corresponding to the pattern. <br><br><h2>  <font color="#3AC1EF">Example</font> </h2><br>  Imagine such a task.  There is a file in which there is a certain sequence of characters, in itself meaningless, which must be replaced with data taken from another file.  Namely, let it be the file <code>newfile</code> , in which the sequence of characters <code>DATA</code> plays the role of a <code>newfile</code> .  Data that needs to be substituted for <code>DATA</code> is stored in the <code>data</code> file. <br><br>  This task can be solved by using the <code>r</code> and <code>d</code> commands of the stream sed editor: <br><br><pre> <code class="hljs ruby">$ Sed <span class="hljs-string"><span class="hljs-string">'/DATA&gt;/ { r newfile d}'</span></span> myfile</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ac/362/4e5/5ac3624e55a40dad7ac8d542f35eb934.png"></div><br>  <i><font color="#999999">Replacing the placeholder with real data</font></i> <br><br>  As you can see, instead of the placeholder, <code>DATA</code> sed added two lines from the <code>data</code> file to the output stream. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Today we covered the basics of working with the sed streaming editor.  In fact, sed is a huge topic.  Its study can be compared with the study of a new programming language, but, having understood the basics, you can master sed at any level you need.  As a result, your ability to process texts with its help will be limited only by your imagination. <br><br>  That's all for today.  Next time, let's talk about the awk data processing language. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> <br><br>  Dear readers!  Do you use sed in your daily work?  If so, please share your experience. </div><p>Source: <a href="https://habr.com/ru/post/327530/">https://habr.com/ru/post/327530/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327520/index.html">UE4 for Unity developers</a></li>
<li><a href="../327522/index.html">Functional JavaScript programming with practical examples</a></li>
<li><a href="../327524/index.html">Troubleshooting using WinDbg, Sos and Sosex</a></li>
<li><a href="../327526/index.html">‚ÄúCubes‚Äù for stores: why hyper-convergence is really needed, and why it is not just a buzzword</a></li>
<li><a href="../327528/index.html">School data: is it possible to influence the election with the help of Big Data</a></li>
<li><a href="../327532/index.html">ITMO University Digest: business projects, initiatives and advice to entrepreneurs</a></li>
<li><a href="../327534/index.html">‚ÄúFriday format‚Äù: demotivation, or love [for work] cannot be bought for money</a></li>
<li><a href="../327536/index.html">What is a service mesh and why do I need it [for a cloud microservice application]?</a></li>
<li><a href="../327540/index.html">Apple Music: not trying to hide the pain</a></li>
<li><a href="../327542/index.html">Threats to the WPA2-Enterprise wireless corporate network and how to protect</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>