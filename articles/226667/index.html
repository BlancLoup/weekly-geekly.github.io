<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RaspberryPi + Pioneer System Remote</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article briefly describes the Pioneer System Remote (SR) bus, presents the scheme of connecting the RaspberryPi to the System Remote bus and the C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RaspberryPi + Pioneer System Remote</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/a65/b8c/1f8/a65b8c1f8ea6c042d1c458c02148d326.png">  The article briefly describes the Pioneer System Remote (SR) bus, presents the scheme of connecting the RaspberryPi to the System Remote bus and the CLI C program for the RaspberryPi, which controls the Pioneer M-10X amplifier via GPIO.  As a disclosure is given a way to use this program. <br><a name="habracut"></a><br><h2>  In a few words about Pioneer System Remote </h2><br>  Some Pioneer Corporation's home audio / video components can be connected to each other via a control bus called SR (an abbreviation for System Remote).  The purpose of this integration of individual components into a single system is, of course, the convenience of the consumer, because at the same time a whole row of devices can be controlled from a single remote control. <br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/dfd/9b8/0c6/dfd9b80c66f42954151c34d93fb1d8cc.png">  The connectors of this bus are designated as <i>CONTROL IN</i> and <i>CONTROL OUT</i> and are made in the form of mono jack mini jack 3.5mm.  Therefore, block connections on the SR bus can be made with conventional two-pin audio cables with mono mini plug 3.5mm plugs (TS-type connector, from Tip-Sleeve).  The devices are connected in series, in a daisy chain: the <i>CONTROL OUT</i> output of one component is connected to the <i>CONTROL IN</i> input of another.  The contact <i>Tip of the</i> connector carries the SR bus signal itself, but with the Contact contact the case is a bit more complicated.  On some components (for example, the M-10X amplifier) ‚Äã‚Äãhere is an honest "ground", and then everything is as it should be: <i>Tip</i> - signal, <i>Sleeve</i> - "earth".  But there are components (usually players) that use the <i>sleeve</i> pin of the SR bus connector to transmit a digital audio signal.  In this case, the ‚Äúground‚Äù is taken from the component case or from the ‚Äúground‚Äù of the analog audio connector.  In fact, if the "earths" of the components are connected in some way, then you can forget about the contact of the <i>Sleeve</i> of the SR bus connector. <br><br>  SR bus control codes are nothing more than demodulated remote control signals.  That is, the SR bus is simply a wired repeater of IR-cleared commands.  (In IR consoles, modulation of ~ 40 kHz carrier frequency control codes is used to, firstly, reduce the power consumption for transmission and increase the service life of the remote control batteries, and secondly, be able to keep up with signals from other remote controls).  When an IR command is received from the remote control, the active SR receiver transmits this command via the SR bus.  The command is seen by all devices connected to the bus.  Components manufactured by Pioneer Corporation can be equipped with one SR bus connector (input only or output only), or two with both input and output.  The input, <i>CONTROL IN</i> , is characterized by the presence of a command interpreter (special chip; for example, in an M-10X amplifier it is a PD5637A chip), which is responsible for decoding and executing commands by the device.  However, it should be noted that System Remote is a common bus, and control codes are relayed to both <i>CONTROL OUT</i> outputs and <i>CONTROL IN</i> inputs. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the simplest case, the control codes are two-byte, where the first byte is the device type, and the second byte is the actual command code for execution on this type of device.  Below for reference is a list of SR bus device types (first control command byte): <br><br><ul><li>  0x73 Projectors </li><li>  0xA1 Tape decks (Blu-ray Players) </li><li>  0xA2 CD Players </li><li>  0xA3 DVD Players </li><li>  0xA4 Tuners </li><li>  0xA5 Amplifiers (AV Receivers) </li><li>  0xA8 Laserdisc Players </li><li>  0xAB Video Recorders (DVD Recorders) </li><li>  0xAA Plasma Displays </li></ul><br>  Devices on the SR bus do not have dedicated addresses, the bus is not addressable.  Therefore, for example, if two CD players are connected to the bus, then many commands with a device type of 0xA2 will execute both players simultaneously.  There are many command codes, command sets depend on the type of device, year of release and even on the component model.  At one of the sites of Pioneer Corporation, in the Custom Install section, you can download device codes and control commands for some specific models via this <a href="http://www.pioneerelectronics.com/PUSA/Support/Home-Entertainment-Custom-Install">link</a> . <br><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/851/215/015/851215015cb272005df0cdfc9a5fdbc8.png"><br>  The protocol for transferring information via the System Remote bus is quite simple.  Each component on the <i>pin</i> of the bus connectors supports + 5V (TTL logic).  To send a frame of information, it is necessary in a certain sequence and with a certain duration to apply the potential of ‚Äúground‚Äù (0V) to the <i>Tip</i> contact of the SR bus.  Pioneer, like many Japanese manufacturers, uses a bit-width codification scheme in IR commands, when a logical zero is encoded with a pulse of 0.56 ms and then a pause of 0.56 ms, and the logical unit is encoded with a pulse of 0.56 ms and then pause 1.68ms. <br><br>  <b>Figure 1. Coding by bit duration.</b> <br><br>  The SR bus frame structure for double-byte commands is as follows: <br><br><ul><li>  frame header: a potential of 0V (pulse) is held on the bus for 9ms, then a potential of + 5V for 4.5ms (pause) </li><li>  8 bits: device type code </li><li>  8 bits: bitwise denial of device type code </li><li>  8 bits: command code </li><li>  8 bits: bitwise command code negation </li><li>  1 bit: stop bit </li></ul><br>  The figure below shows the waveform of the frame of the SR bus 0xA55A38C7, transmitting the power toggle command (command code 0x38) to the amplifier (device type code 0xA5): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/116/d3d/239/116d3d239ee6281244266fe288b0570b.png"></div><br>  <b>Figure 2. Frame 0xA55A38C7 of the System Remote bus.</b> <br><br><h2>  Amplifier Pioneer M-10X </h2><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/46f/319/6bb/46f3196bbe1d0906c4b2e909ddb49fbb.png">  This is a power amplifier, from the controls it has only two buttons: a mechanical Power button and an electronic Standby button.  Not much.  But, fortunately, it is also equipped with the <i>CONTROL IN</i> input of the System Remote bus and understands three commands: <ul><li>  power cycle (power toggle) 0xA538 </li><li>  turn on the power (power on) 0xA558 </li><li>  turn off the power (power off) 0xA5D8 </li></ul><br><br><h2>  Connecting the RaspberryPi to the Pioneer System Remote bus </h2><br>  The System Remote bus has TTL logic, the voltage varies from 0V to + 5V.  At the GPIO RaspberryPi, the voltage can vary in the range from 0V to + 3.3V, while overvoltage protection for these pins is not provided on the board.  Therefore, it is impossible to directly control the SR bus from the GPIO output; you must use a level converter. <br><br>  The circuit presented here is such a converter.  The base of transistor Q1 is connected via resistor R1 to pin P1-11 (GPIO17) RPi, the collector of transistor across resistor R2 connects to pin P1-02 (5V) RPi, and the emitter of transistor connects to pin P1-20 (GND) RPi.  By programmatically controlling the output of GPIO17 (base of transistor Q1), on the Tip contact of the terminal block J1 (collector of transistor Q1) we get the signal of the desired level for the control commands of the System Remote bus.  Resistor R1 is the base current limiter, and resistor R2 is the collector current limiter of the transistor.  When the base of the transistor is 0V (GPIO17 = 0), the transistor is closed and the + 5V potential is held at the emitter;  when on the base of the transistor + 3.3V (GPIO17 = 1), the transistor is open and the potential 0V is held at the emitter.  Therefore, strictly speaking, this circuit is a signal level inverter.  In <b>Figure 2</b> above, the oscillograms of the working circuit are shown: in the upper graph - the signal at the collector of the transistor (SR bus), in the lower graph - the signal at the base of the transistor (GPIO17 leg; the real range of this signal is from 0V to + 3.3V). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84d/164/041/84d16404175f5aa75ef1db38c37f1335.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2bf/2ac/5c2/2bf2ac5c2ac5c8a5dd90314f6b22c87e.png"><br><br>  To implement the scheme will need: <br><br><ul><li>  contact breadboard </li><li>  KT3102 transistor (Q1) </li><li>  1kOhm resistor (R1) </li><li>  10k ohm resistor (R2) </li><li>  terminal strip with 2.54 mm pitch, for installation in a breadboard (J1) </li><li>  3.5mm mini plug mono plug (TS type connector) </li><li>  wires </li></ul><br>  In order not to mess around with soldering the plug, you can take a ready mono cable with a 3.5mm mini plug instead, cut off the connector on one side, and connect the conductors to the J1 terminal box. <br><br>  Attention!  Be very careful with the RaspberryPi five-volt legs (P1-02 and P1-04), do not accidentally short-circuit these contacts with the other legs of the board, as this will damage it. <br><br><h2>  Pioneer M-10X Amplifier Power Control Software for RaspberryPi </h2><br>  The source code for the Raspbian platform is located at this <a href="https://gist.github.com/photon-m/2fcb9a5e619af93baad1">link</a> .  The code contains a <i>nice</i> call <i>(-19)</i> , so the program should be called by the root superuser.  To build the program you need to use the command: <br><br><pre><code class="bash hljs">gcc -o m10xptgl m10xptgl.c</code> </pre> <br>  After the build, you need to create two symbolic links with alternative names m10xpon and m10xpoff to the executable file: <br><br><pre> <code class="bash hljs">ln -s m10xptgl m10xpon ln -s m10xptgl m10xpoff</code> </pre><br>  The program generates on the GPIO17 pin a control command frame for the Pioneer M-10X amplifier.  The actual action of the program (generated frame) depends on the name under which the program is launched: <br><br><ul><li>  when starting with the name <i>m10xpon</i> , the amplifier turns on (exit from the standby state, frame 0xA55A58A7) </li><li>  when starting with the name <i>m10xpoff</i> , the amplifier is turned off (transition to the Standby state, frame 0xA55AD827) </li><li>  when starting with the name <i>m10xptgl</i> , the power supply state of the amplifier is switched (power toggle command, frame 0xA55A38C7) </li></ul><br>  As an optional argument, the program can specify an integer, in which case the frame will be repeated consecutively as many times as specified by the command line argument. <br><br>  In general, the project is simple, not more difficult than the educational project on LED blinking, only here we ‚Äúblink‚Äù the whole Pioneer amplifier. <br><br><h2>  Application </h2><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/29c/7ca/9a5/29c7ca9a531a027e6d00b7424ed8c9f8.png"><br>  The scheme and program described in the article are convenient to use, for example, with the <a href="https://github.com/abrasive/shairport">shairport</a> project, because in this case we get not only the AirPlay function on the old amplifier, but also the automatic on and off of the on demand amplifier. <br><br>  You can assemble a <i>shairport</i> project from source codes using a sequence of the following commands: <br><br><pre> <code class="bash hljs">apt-get install avahi-daemon mdns-scan libssl-dev libavahi-client-dev libasound2-dev apt-get install libao4 libao-dev apt-get install pulseaudio libpulse-dev <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /root/src; git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> --depth 1 https://github.com/abrasive/shairport.git shairport <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> shairport ./configure make</code> </pre><br>  And run like this: <br><br><pre> <code class="bash hljs">shairport -v --name=<span class="hljs-string"><span class="hljs-string">"M10X"</span></span> --on-start=<span class="hljs-string"><span class="hljs-string">"/usr/local/sbin/m10xpon 10"</span></span> --on-stop=<span class="hljs-string"><span class="hljs-string">"/usr/local/sbin/m10xpoff 10"</span></span></code> </pre><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/226667/">https://habr.com/ru/post/226667/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226657/index.html">Tesla coil from hozmag</a></li>
<li><a href="../226659/index.html">Our experience accelerating iOS apps</a></li>
<li><a href="../226661/index.html">How we deployed Huawei MicroDC</a></li>
<li><a href="../226663/index.html">Spring MVC - JavaConfig or project configuration without XML files</a></li>
<li><a href="../226665/index.html">Microsoft moves to proprietary processors</a></li>
<li><a href="../226669/index.html">Cross-platform file manager? This is reality</a></li>
<li><a href="../226673/index.html">"Eat your own dog food" or how we found the most important client</a></li>
<li><a href="../226675/index.html">Test Labs 2014. ONLINE conference for testers and test managers. June 28</a></li>
<li><a href="../226677/index.html">Probabilistic Models: Sampling</a></li>
<li><a href="../226679/index.html">Another way to intercept traffic through ARP Spoofing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>