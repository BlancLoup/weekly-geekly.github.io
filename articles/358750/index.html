<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of Veeam Backup & Replication and PureStorage</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we present the guest post from Ilia Karina. 
 Good afternoon, Habr! My name is Elijah Karin ( Iliya_karin ). I have been involved in all matters...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of Veeam Backup & Replication and PureStorage</h1><div class="post__text post__text-html js-mediator-article">  <i>Today we present the guest post from Ilia Karina.</i> <br><blockquote>  Good afternoon, Habr!  My name is Elijah Karin ( <a href="https://habr.com/users/iliya_karin/" class="user_link">Iliya_karin</a> ).  I have been involved in all matters of system administration in a large company for more than 7 years.  Thanks to colleagues from Veeam for the opportunity to tell here a little about my experience. </blockquote><br>  Recently, Veeam, together with PureStorage, released an integration plugin for Veeam Backup &amp; Replication 9.5 with PureStorage arrays.  And if you are a happy owner of a Veeam Backup &amp; Replication Enterprise Plus license, then there is no reason not to back up your infrastructure from snapshots of storage. <br><br>  However, since the solution is new, in Russia and the CIS countries there is no information in Russian about how to set up the infrastructure for working with backups from a lot of snapshots. <br>  In my article I will try to eliminate this gap. <br>  Let's get down to business. <br><br><img src="https://habrastorage.org/webt/ml/pt/fw/mlptfwwsgfag1mvcqgmr9uc_era.jpeg" alt="image"><br><a name="habracut"></a><br>  We have the following infrastructure: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  4 hosts with the Vmware vSphere ESXi 6.5 hypervisor </li><li>  1 vCenter </li><li>  1 virtual machine with Veeam Backup &amp; Replication, it is also a Veeam proxy server </li><li>  Separate subnet for iSCSI traffic, consisting of 2 separate 10G switches </li><li>  PureStorage m20 array </li></ul><br>  It is understood that the array itself is already connected to the iSCSI network, the network infrastructure is raised, where the vLAN you need are already configured, vSwitch, vKernel are registered on the hosts, everything works and thrives, but you want something else. <br><br><h2>  Plug-in installation </h2><br>  The first thing we need to download and install the desired plugin.  This can be done in your account on the site <a href="https://my.veeam.com/">my.veeam.com</a> , in the section <b>Downloads ‚Üí Product downloads</b> : <br><br><img src="https://habrastorage.org/webt/je/yr/z2/jeyrz2w8mvhng3rgdjqaqivhmwo.png"><br><br>  Go to the bottom of the page, where the <b>Pure Storage Plug-In for Veeam Backup &amp; Replication is located</b> . <br><br><img src="https://habrastorage.org/webt/dy/ut/8e/dyut8emmmcyaebfwn1bv1-zcxuk.png"><br><br>  Before starting the installation, close all windows of the Veeam console or restart the server.  There is nothing interesting in the installation of the plugin, in fact we press "further, further, further".  At the end of the installation will require a reboot. <br><br><h2>  VMware Hosts and Virtual Machines </h2><br>  In our example, on each host, vmk1 and vmk2 are created by means of which hosts communicate with the iSCSI network: <br><br><img src="https://habrastorage.org/webt/pl/v5/pi/plv5piaoqrwcihkgj3eeauwx5-c.png"><br><br>  In turn, they are used in vSwitch1: <br><br><img src="https://habrastorage.org/webt/ep/tp/07/eptp07tjnu0at9maa-tidfb36cq.png"><br><br>  To access the virtual machine with Veeam Backup &amp; Replication on the iSCSI network, we need to create a VM Network iSCSI (visible in the screenshot above). <br><br>  To do this in the <b>Virtual switches</b> toolbar: <br><br><ol><li>  Click on the icon <b>Add host networking</b> . </li><li>  In the opened window, select <b>Virtual Port Group for a Standard Switch</b> . </li><li>  Click <b>Next</b> . </li><li>  Choose our iSCSI vSwitch, in our example it is <i>vSwitch1</i> . </li><li>  Click <b>Next</b> . </li><li>  We set the name for our virtual network <i>VM Network iSCSI</i> . </li><li>  Click <b>Finish</b> . </li></ol><br><img src="https://habrastorage.org/webt/a6/lb/jm/a6lbjmwwalfyixvcsv8lxq9eirc.png"><br><br>  Now you need to add 2 network adapters to our virtual machine and assign them a newly created network. <br><br><ol><li>  Right click on the VM, select the <b>Edit</b> command. </li><li>  Next, select <b>New device ‚Üí network ‚Üí add</b> </li><li>  Choosing a VM Network iSCSI </li><li>  In the <b>Adapter type,</b> select VMXNET3, we still have 10G. </li><li>  Repeat steps 2-4 again. </li><li>  Click <b>OK</b> . </li></ol><br><img src="https://habrastorage.org/webt/e4/yq/nx/e4yqnxgqwwnyx9dndhou45xneh4.png"><br><br>  This completes the ESXi setup. <br><br><h2>  Set OC settings </h2><br>  Next, we need to configure the operating system on the machine where Veeam is installed. <br><br>  1. Go to <b>Control Panel \ Network and Internet \ Network Connections</b> <br>  2. Set the IP addresses from your iSCSI network for the two network cards we added. <br><br>  I also put in the settings of the network adapter Jumbo Frame 9000, but this is another tale in which you need to configure other network components (the same applies to vLAN, etc.). <br><br><img src="https://habrastorage.org/webt/ty/yg/gz/tyyggzicuj1szwjwvtb_dd3wy80.png"><br><br>  3. Using the Server Manager, install 2 components: MPIO and iSCSI Initiator. <br><br><ul><li>  The first is in <b>Server Roles ‚Üí File Services and iSCSI Services ‚Üí Server ‚Üí iSCSI Target Server</b> </li><li>  The second you will find on the tab <b>Components ‚Üí Multipath I / O</b> </li></ul><br><img src="https://habrastorage.org/webt/oh/ni/4k/ohni4k37omapnh0qcr_ytc3bijk.png"><br><br>  4. To add support for MPIO, open <b>Server Manager ‚Üí Tools ‚Üí MPIO</b> <br><br>  5. In the dialog box that opens, go to the <b>Multipath Device Discovery</b> tab and check the <b>Add support for iSCSI devices</b> checkbox, then a reboot is required. <br><br><img src="https://habrastorage.org/webt/xb/n0/pz/xbn0pzcqmajef8hu6akjwmmqy4y.png"><br><br>  6. Now you need to configure the iSCSI Initiator.  To do this, open <b>Server Manager ‚Üí Tools ‚Üí iSCSI Initiator</b> . <br><br>  7. In the window that opens, go to the <b>Discovery</b> tab, where we click the Discover Portal button ... <br><br>  8. In the <b>IP address or DNS name</b> field, specify the IP address of the target created on the storage system. <br><br>  9. Click the <b>Advanced</b> button. <br><br>  10. In the window that opens, you need to configure 2 values: <br><br><ul><li>  Local adapter - there are no special options here, choose Microsoft iSCSI initiator </li><li>  The IP address of the initiator - here you can make a mistake.  If you have 2 (and more) different switches for iSCSI that are not interconnected, then you should know which iSCSI target to which of the switches is physically connected to.  For our example, this can be found out indirectly using the ping command, first pinging all 4 (or more) IP addresses of the storage target, and then through another. </li><li>  I got the following match: </li><li>  Through 172.10.10.31 you can see the target 172.10.10.9 and 172.10.10.12 </li><li>  Through 172.10.10.32, the target sets are visible 172.10.10.10 and 172.10.10.11 </li><li>  Accordingly, in the IP address of the initiator field, specify the address of the network adapter through which the corresponding target is pinged. </li></ul><br>  11. Repeat steps 8 - 10 as many times as necessary to connect all the paths. <br><br><img src="https://habrastorage.org/webt/ay/hu/ep/ayhuep5o38mqfpwyac9uzvtzk50.png"><br><br><h2>  Getting Started Setting Up Veeam Backup &amp; Replication </h2><br><ol><li>  Open the main console Veeam Backup &amp; Replication. </li><li>  Go to the section <b>Storage Infrastructure ‚Üí Add storage ‚Üí Pure Storage</b> .  If you do not have this item, then something went wrong during the installation of the plugin. <br><br><img src="https://habrastorage.org/webt/ua/np/r5/uanpr5dxcj4ad-2lruoohqq2ee0.png"><br><br>  Follow the prompts of the program. </li><li>  Add our storage by IP address or DNS name (from the management network, or as it is called, the management network) and click <b>Next</b> . </li><li>  We provide accounting software to access the storage system. </li><li>  We select the protocol by which we will transmit iSCSI data, and leave the rest as is. </li><li>  Check the settings and click <b>Finish</b> . </li></ol><br><img src="https://habrastorage.org/webt/on/ch/k4/onchk4wa7mfyqwaezcr1hk4xf6q.png"><br><br>  As a result, you should see the storage icon on the <b>Storage Infrastructure</b> panel, revealing which you will see the LUNs created on it. <br><br><h2>  Making the final check </h2><br>  It remains to check whether the backup mode from the stack of snapshots for our jobs (jobs) is enabled in the Veeam console. <br><br>  This can be done by right-clicking on the task, then selecting the <b>Edit</b> ‚Üí <b>Storage ‚Üí Advanced</b> section. <br><br>  On the <b>Integration</b> tab ‚Üí select <b>Enable backup from storage snapshots</b> . <br><br><img src="https://habrastorage.org/webt/gi/hn/lp/gihnlpprsmnzhusqo1g-vnfzxo0.png"><br><br>  I hope you have succeeded.  Thank you all for your attention! <br><br><h2>  Additional materials: </h2><br><ul><li>  <a href="https://www.veeam.com/ru/purestorage-flasharray-solutions.html">Veeam PureStorage Solution Overview</a> </li><li>  <a href="https://blog.purestorage.com/pure-storage-plug-in-and-integrations-with-veeam/">PureStorage blog article</a> </li><li>  <a href="https://helpcenter.veeam.com/docs/backup/vsphere/usais_add.html%3Fver%3D95">Section in the Veeam User Guide (in English)</a> </li><li>  <a href="https://go.veeam.com/webinar-storage-integration-new-api-ru">Register for a webinar in Russian about supporting storages with the Integration API</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/358750/">https://habr.com/ru/post/358750/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358736/index.html">Natural Language Processing</a></li>
<li><a href="../358742/index.html">Angular: ngx-translate lifehacks. TranslateCompiler</a></li>
<li><a href="../358744/index.html">Marvin Minsky "The Emotion Machine": Chapter 4 "Consciousness"</a></li>
<li><a href="../358746/index.html">Developing your own visualization plugin for Grafana</a></li>
<li><a href="../358748/index.html">Codable Tips and Examples</a></li>
<li><a href="../358752/index.html">OpenVINO Toolkit - to look at the world with a clear look</a></li>
<li><a href="../358754/index.html">Logging hits (payload) Google Analytics to Google Sheets via Google Tag Manager</a></li>
<li><a href="../358758/index.html">Need more gold. How is marketing in GameDev-company?</a></li>
<li><a href="../358760/index.html">Sales using voice assistant Yandex: create skills for Alice</a></li>
<li><a href="../358762/index.html">Development of Clickhouse API for Rambler / Top-100</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>