<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vkontakte game - the story of one launch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. On Friday, we launched the race for the social network vKontakte - TurboGonki. You can play them here: http://vkontakte.ru/turboraces , and the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vkontakte game - the story of one launch</h1><div class="post__text post__text-html js-mediator-article">  Hello.  On Friday, we launched the race for the social network vKontakte - TurboGonki.  You can play them here: <a href="http://vkontakte.ru/turboraces">http://vkontakte.ru/turboraces</a> , and they look something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ad/118/3aa/0ad1183aab8c576fbeeba0725e2b17a0.jpg" alt="image" width="800"><br><br>  It is still a game in beta test mode, so you may feel hatred for the author of the topic, an irreconcilable desire to throw out your browser and even be sure that you will find some bugs, but you are welcome to contact us at light. <br><a name="habracut"></a><br><h5>  What is it written on? </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The client part is ActionScript, the implementation of physics is Box2D.  The server side that controls the race process is Qt, the menu, the store and other trivia is PHP (CodeIgniter), the database is MySQL. <br><br><h5>  How we started </h5><br><br>  The game was written for a long time.  Indecently long.  I am even ashamed to call these terms, so I will not.  Several developers changed, in my memory the project was frozen 2 times and the release date was postponed 3 times.  In the end, they decided to be released and launched last Thursday.  To be precise, on Friday, because  Day application hung on moderation. <br><br>  Users started to come to the game little by little, they started to create races and play and we realized that we were hit.  The number of bugs turned out to be 4 times higher than we expected and even those that couldn‚Äôt manifest at all got out - Murphy's law is in force.  The main thing was that it was possible to play, despite them (we fixed the critical ones, stabilized the game a little). <br><br>  After looking at it, we decided to run around a small number of users over the weekend (established thousands and a half during the first day), identify most of the problems, and since Monday fix them and in a week have already been actively promoting. <br><br>  But on Saturday, we decided to try to test ads on vKontakte.  The traffic crawled little by little, the experiments brought the cost of installing the application from 1.5 rubles to 0.4, which is just great, it seems to me, and then it was 11 pm and the traffic flowed like a river. <br><br>  What is the reason - hard to say, because  there was no time to analyze.  I pass on the sad experience to the next generations - NEVER run with social networking apps when Apache is on the server.  Hmm, in general, because  we did not expect a sharp influx of traffic, the server was with the usual default settings, there was even a shop spinning there.  Yes, 8 GB of RAM, 80 SSD and some 4-core processor, but all this did not help, because  hanged a web server.  We directly imagined how Apache sadly looks out of the window, sees a crowd of enraged pale faces, turns around and sadly throws a noose on a hook. <br><br>  Quickly deployed nginx, at least as a proxy in front of Apache - it helped, it got a little prettier.  In the morning I already understood that it was necessary for workers to clearly not install 2, and to increase the number of processes, but the default config also saved.  For a while. <br><br>  For the next hour traffic went tight, then slept.  As a result, I don‚Äôt remember how in the first hour, but when I went to bed at 5 am, having already decided to move to the clouds tomorrow, there were 7,000 users in the application. <br><br>  At 10 o'clock I was woken up by a call that the server had gone down again.  Having updated the page with the counter, I, to put it mildly, was surprised - there were already 14,000 users (x2 in 5 hours) and they were streaming further.  It turned out to be easier here - I just adjusted the nginx configs and the server boldly ran on.  Over the next 5 hours it was x2 again - at 3 pm we had 28 thousand users.  Further already let. <br><br><h5>  What does architecture look like now? </h5><br><br>  On Sunday we settled in the ‚ÄúOversan-Skalaksi‚Äù.  Why there?  Yes, I simply have no idea about other Russian clouds, and in the States or Europe I was confused by pings.  They put a load balancer and 2 servers behind it, it looks like this in the control panel: <br><br><img src="https://habrastorage.org/storage/habraeffect/3e/60/3e601a4bc91a80e1bc4d0e83d34f799e.jpg" alt="image"><br><br>  The base and the game server are not yet in the clouds, while on a more powerful dedicated server in another data center. <br><br>  On the balancer put HAProxy, which distributes the load between the servers behind it.  The config is almost default and lies here: <a href="http://pastebin.com/xZ7Prc3u">http://pastebin.com/xZ7Prc3u</a> , I saw it for the first time on Sunday, so there was no time to understand very deeply, if someone tells me how to do better, I will listen with pleasure. <br><br>  The web backends are nginx + php-cgi.  scaling by means of the Skalaxi panel is only still being understood, so it‚Äôs hard to say how it works) <br><br>  Thanks to everyone who read these 8 kilometers of the text, did not say ‚Äúfu, VKontakte‚Äù and did not put a minus :) <br><br>  I am pleased to hear comments, suggestions, recommendations, advice. <br><br>  Finally a screenshot of the game process at the request of the comments: <br><br><img src="https://habrastorage.org/storage/habraeffect/67/ef/67efe587898199a84b7430429200d706.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/120295/">https://habr.com/ru/post/120295/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120286/index.html">Alexey Navalny presented an Internet project to combat the pits on the roads</a></li>
<li><a href="../120289/index.html">Paradox - steel secure watch from iPod nano</a></li>
<li><a href="../120291/index.html">Droider Chart 54. Hit parade of Android applications</a></li>
<li><a href="../120293/index.html">Transition from HDD to SSD: Calculation of the increase in battery life of a new laptop</a></li>
<li><a href="../120294/index.html">Measure performance with DynamicObject</a></li>
<li><a href="../120298/index.html">64-bit OS in assembler</a></li>
<li><a href="../120299/index.html">Mapjumper - Chrome extension</a></li>
<li><a href="../120300/index.html">Twitter will launch its own photo hosting</a></li>
<li><a href="../120301/index.html">Jinni: Movie Search by Mood</a></li>
<li><a href="../120302/index.html">Tuning Canabalt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>