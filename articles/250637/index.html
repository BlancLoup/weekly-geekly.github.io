<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Details about the internal kitchen AngularJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The AngularJS framework has some interesting code solutions. Today we will look at two of them - how scopes and directives work. 

 The first thing ev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Details about the internal kitchen AngularJS</h1><div class="post__text post__text-html js-mediator-article">  The AngularJS framework has some interesting code solutions.  Today we will look at two of them - how scopes and directives work. <br><br>  The first thing everyone teaches about AngularJS is that directives must interact with the DOM.  And most of all a beginner is confused by the process of interaction between scopes, directives and controllers.  In this article, we will look at the details of how the scopes work and the life cycle of an Angular application. <br><br>  If in the next picture you do not understand something - this article is for you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/52a/3fa/5ec/52a3fa5ecd1df19ee05105e70068e231.png" alt="image"><br><br>  <i>(The article deals with AngularJS 1.3.0)</i> <br><a name="habracut"></a><br>  AngularJS uses scopes to abstract directive communication and DOM.  There are also areas of visibility at the controller level.  Scopes are simple JavaScript objects (plain old JavaScript objects, POJOs).  They add a bunch of "internal" properties, which are preceded by one or two $ characters.  Those with the $$ prefix do not need to be used in the code too often - usually their use indicates a misunderstanding of the application. <br><br><h5>  So what are these areas of visibility? </h5><br>  In AngularJS jargon, visibility does not mean what is meant by this in JS code.  Usually, a scope is understood to mean a block of code that contains a context, various variables, and so on.  For example: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eat</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">thing</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">' '</span></span> + thing); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nuts</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">peanut</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hazelnut = <span class="hljs-string"><span class="hljs-string">'hazelnut'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  function seeds () { var almond = 'almond'; //  eat(hazelnut); //      ! } //   . }</span></span></code> </pre> <br><br>  However, these are not the scopes that AngularJS is talking about. <br><br><h5>  Inheritance of scopes in AngularJS </h5><br>  The scope in AngularJS is also a context, but only in the understanding of AngularJS.  In AngularJS, a scope is associated with an element and all its child elements, and the element is not necessarily directly related to the scope.  Elements are assigned scopes in one of three ways. <br><br>  The first is if the scope is created at the element by the controller or directive. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'menuCtrl'</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  The second is if the element has no scope, it inherits it from the parent <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'menuCtrl'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'navigate()'</span></span></span><span class="hljs-tag">&gt;</span></span> !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- also &lt;nav&gt;'s scope --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  The third is if the element is not part of the ng-app, then it does not belong to any scope <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">main</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'PonyDeli'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'menuCtrl'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'navigate()'</span></span></span><span class="hljs-tag">&gt;</span></span> !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">main</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  To understand what area of ‚Äã‚Äãvisibility an element belongs to, go through the element tree from the inside to the outside, using three rules.  Does he create a new scope?  Then he is associated with it.  Does he have a parent?  We check the parent.  If it does not enter the ng-app, then no scope. <br><br>  Calling the internal properties of AngularJS scopes <br><br>  Let's go through some typical properties.  To do this, I will open Chrome and go to the application I'm working on.  Then I open the Developer tools to view the properties of the item.  Did you know that $ 0 gives <a href="https://developers.google.com/chrome-developer-tools/docs/commandline-api">access to the last</a> selected element in the Elements panel?  $ 1 - the previous selected item, etc.  $ 0 we will use most often. <br><br>  angular.element wraps each DOM element either in jQuery or in jqLite.  After that, you have access to the scope () function, which returns the scope of the element.  Combine this with $ 0 and get a frequently used command: <br><br><pre> <code class="javascript hljs">angular.element($<span class="hljs-number"><span class="hljs-number">0</span></span>).scope()</code> </pre><br><br>  Since jQuery is being used, $ ($ 0) .scope () will also work.  Now let's see what properties are available in a typical scope - those that are written starting from $. <br><br>  for (o in $ ($ 0) .scope ()) o [0] == '$' &amp;&amp; console.log (o) <br><br>  Studying the insides of the AngularJS scope <br><br>  I will list the properties that this command derived, grouped by functionality.  Let's start with the simple ones. <br><br><pre> <code class="javascript hljs"> $id    $root    $parent   ,  <span class="hljs-literal"><span class="hljs-literal">null</span></span>,  scope == scope.$root $$childHead     ,  <span class="hljs-literal"><span class="hljs-literal">null</span></span> $$childTail     ,  <span class="hljs-literal"><span class="hljs-literal">null</span></span> $$prevSibling       ,  <span class="hljs-literal"><span class="hljs-literal">null</span></span> $$nextSibling       ,  <span class="hljs-literal"><span class="hljs-literal">null</span></span></code> </pre><br><br>  Navigating with these properties is inconvenient.  $ Parent can sometimes come in handy, but there are always more convenient ways to access parent elements.  For example, using the events that we will look at in the next part of the list. <br><br>  Event Model in AngularJS Scope <br><br>  The following properties help define events and subscribe to them. <br><br><pre> <code class="javascript hljs"> $$listeners  ,     $on(evt, fn)   fn   evt $emit(evt, args)   evt,      ,        $parent,  $rootScope $broadcast(evt, args)   evt,      ,       </code> </pre><br><br>  At startup, event handlers receive the event object and any arguments passed to $ emit or $ broadcast.  How can events be used? <br><br>  The directive can use them to report an important event.  In the example, the event is triggered by pressing a button. <br><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'PonyDeli'</span></span>).directive(<span class="hljs-string"><span class="hljs-string">'food'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">scope</span></span>: { <span class="hljs-comment"><span class="hljs-comment">//        type: '=type' }, template: '&lt;button ng-click="eat()"&gt;   {{type}}!&lt;/button&gt;', link: function (scope, element, attrs) { scope.eat = function () { letThemHaveIt(); scope.$emit('food.order, scope.type, element); }; function letThemHaveIt () { //   UI } } }; });</span></span></code> </pre><br><br>  I set the namespace events.  This prevents the intersection of names, and helps to understand where events come from or what event you subscribe to.  Suppose you are interested in analytics and you want to track all food clicks through Mixpanel.  Instead of littering the controller or directive, you can make a separate directive to track clicks, which will be a separate thing in itself. <br><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'PonyDeli'</span></span>).directive(<span class="hljs-string"><span class="hljs-string">'foodTracker'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mixpanelService</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">link</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">scope, element, attrs</span></span></span><span class="hljs-function">) </span></span>{ scope.$on(<span class="hljs-string"><span class="hljs-string">'food.order, function (e, type) { mixpanelService.track('</span></span>food-eater<span class="hljs-string"><span class="hljs-string">', type); }); } }; });</span></span></code> </pre><br><br>  Service implementation is not important here - it would simply serve as a wrapper for the client API from Mixpanel.  HTML would look like the one below, and I would add another controller containing all the necessary types of food.  To complete the example, I‚Äôll add ng-repeat so that I can list my food without copying code.  Simply output them in a foodTypes cycle, which is available in the foodCtrl scope. <br><br><pre> <code class="javascript hljs">&lt;ul ng-app=<span class="hljs-string"><span class="hljs-string">'PonyDeli'</span></span> ng-controller=<span class="hljs-string"><span class="hljs-string">'foodCtrl'</span></span> food-tracker&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">food</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'type'</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'type in foodTypes'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/ul&gt; angular.module('PonyDeli').controller('foodCtrl', function ($scope) { $scope.foodTypes = ['', '', '']; });</span></span></code> </pre><br><br>  <a href="http://codepen.io/bevacqua/pen/qmBGd">See CodePen for a</a> working example. <br><br>  But do you need an event to which anything can connect?  Wouldn't it be enough service?  In this case, you can do so.  It can be argued that events are needed because you do not know in advance who else will subscribe to food.order, which means that the use of events is more far-sighted in terms of the development of the application.  You can also say that the food tracking directive is not needed because it does not interact with the DOM, but only waits for an event, so it can be replaced with a service. <br><br>  And these are true remarks, in this case.  But when other components need to communicate with food.order, the need for events will become clear.  In real life, events are most useful when you need to connect multiple scopes. <br><br>  Elements on the same level usually have difficulty communicating with each other, and they usually do so through their parent.  As a result, this translates into broadcasting from $ rootScope, which is listened to by all who need it: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'PonyDeli'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'foodCtrl'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">food-tracker</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">food</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'type'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'type in foodTypes'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'deliver()'</span></span></span><span class="hljs-tag">&gt;</span></span>   !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'deliveryCtrl'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'received'</span></span></span><span class="hljs-tag">&gt;</span></span>   ,   . <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'PonyDeli'</span></span>).controller(<span class="hljs-string"><span class="hljs-string">'foodCtrl'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$rootScope</span></span></span><span class="hljs-function">) </span></span>{ $scope.foodTypes = [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>]; $scope.deliver = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req</span></span></span><span class="hljs-function">) </span></span>{ $rootScope.$broadcast(<span class="hljs-string"><span class="hljs-string">'delivery.request'</span></span>, req); }; }); angular.module(<span class="hljs-string"><span class="hljs-string">'PonyDeli'</span></span>).controller(<span class="hljs-string"><span class="hljs-string">'deliveryCtrl'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope</span></span></span><span class="hljs-function">) </span></span>{ $scope.$on(<span class="hljs-string"><span class="hljs-string">'delivery.request'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, req</span></span></span><span class="hljs-function">) </span></span>{ $scope.received = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   }); });</span></span></code> </pre><br><br>  You can also <a href="http://codepen.io/bevacqua/pen/CzGla">watch the work on CodePen</a> . <br><br>  I would say that events should be used when you expect a view to change in response to an event, and services when views are not changing. <br><br>  If you have two components communicate through $ rootScope, then it is better to use $ rootScope. $ Emit and $ rootScope. $ On instead of $ broadcast.  Then the event is distributed only among $ rootScope. $$ listeners, and will not waste time on passing all the $ rootScope child nodes that do not have handlers for this event.  In the example, the service uses $ rootScope for events, not limited to a specific scope.  It provides a subscribe method for subscribing to listen for events. <br><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'PonyDeli'</span></span>).factory(<span class="hljs-string"><span class="hljs-string">"notificationService"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$rootScope</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notify</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ $rootScope.$emit(<span class="hljs-string"><span class="hljs-string">"notificationService.update"</span></span>, data); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listen</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fn</span></span></span><span class="hljs-function">) </span></span>{ $rootScope.$on(<span class="hljs-string"><span class="hljs-string">"notificationService.update"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, data</span></span></span><span class="hljs-function">) </span></span>{ fn(data); }); } <span class="hljs-comment"><span class="hljs-comment">// ,          function load () { setInterval(notify.bind(null, '- !'), 1000); } return { subscribe: listen, load: load }; });</span></span></code> </pre><br><br>  And this is also <a href="http://codepen.io/bevacqua/pen/HsBCa">on CodePen</a> . <br><br><h5>  Digest </h5><br>  AngularJS data binding works through a loop that <a href="http://stackoverflow.com/a/9693933/389745">tracks changes</a> and triggers events.  There are several methods in the $ digest loop.  First, it is scope. $ Digest, recursively digesting changes in the current scope and child areas. <br><br><pre> <code class="javascript hljs"> $digest()   $$phase    ‚Äì    [<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">'$apply'</span></span>, <span class="hljs-string"><span class="hljs-string">'$digest'</span></span>]</code> </pre><br><br>  Do not run the digest, if you are already in the digest phase - this will lead to unpredictable consequences.  What is said about the digest in the <a href="http://docs.angularjs.org/api/ng.%24rootScope.Scope">documentation</a> : <br><br><blockquote>  Runs all watchers in the current scope and its child areas.  Since the observer‚Äôs listener can change the model, $ digest () calls observers until their listeners stop executing.  This can lead to falling into an infinite loop.  Therefore, the function will throw out the error 'Maximum number of iterations reached', if their number exceeds 10. </blockquote><br><br>  Usually $ digest () is not called directly from controllers or directives.  It is necessary to call $ apply () (usually this is done from within directives), which itself will already cause $ digest (). <br><br>  So $ digest processes all observers, and then all those observers who are called by previous observers, until they cease to be executed.  Two questions remain: <br><br>  - who are the observers? <br>  - what causes $ digest? <br><br>  Perhaps you already know what ‚Äúobserver‚Äù is and used scope. $ Watch, and maybe even scope. $ WatchCollection.  The $$ watchers property contains all observers from the scope. <br><br><pre> <code class="javascript hljs"> $watch(watchExp, listener, objectEquality)      $watchCollection        $$watchers      </code> </pre><br><br>  Observers are the most important aspect of AngularJS, but their call needs to be initiated in order for the data binding to work properly.  Example: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'PonyDeli'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'foodCtrl'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'prop'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'dependency'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'PonyDeli'</span></span>).controller(<span class="hljs-string"><span class="hljs-string">'foodCtrl'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope</span></span></span><span class="hljs-function">) </span></span>{ $scope.prop = <span class="hljs-string"><span class="hljs-string">' '</span></span>; $scope.dependency = <span class="hljs-string"><span class="hljs-string">' !'</span></span>; $scope.$watch(<span class="hljs-string"><span class="hljs-string">'prop'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ $scope.dependency = <span class="hljs-string"><span class="hljs-string">'prop  "'</span></span> + value + <span class="hljs-string"><span class="hljs-string">'"!    '</span></span>; }); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $scope.prop = <span class="hljs-string"><span class="hljs-string">' '</span></span>; }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); });</code> </pre><br><br>  This means that we have an 'initial value', and we expect that the second line of HTML will change to 'prop contains ‚Äúa different value‚Äù!  oh wow, isn't it?  And one would expect the first line to change to a different value.  Why doesn't it change? <br><br>  Much of what you create in HTML creates an observer as a result.  In our case, each ng-bind directive creates an observer for the property.  It updates in HTML when prop and dependency change.  Therefore, there are three observers in our code ‚Äî one for each ng-bind, and one for the controller.  How does AngularJS know that the property has been updated after a timeout?  You can remind him of this by adding a digest call to the timer callback: <br><br><pre> <code class="javascript hljs">setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $scope.prop = <span class="hljs-string"><span class="hljs-string">' '</span></span>; $scope.$digest(); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre><br><br>  I saved two CodePen examples - one <a href="http://codepen.io/bevacqua/pen/lLbtI">without the $ digest</a> , and the second <a href="http://codepen.io/bevacqua/pen/vwDoz">with it</a> .  But a <a href="http://ponyfoo.com/articles/the-angular-way">better way</a> is to use the $ timeout <a href="">service</a> instead of setTimeout.  It allows error handling and performs $ apply (). <br><br><pre> <code class="javascript hljs">$timeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $scope.prop = <span class="hljs-string"><span class="hljs-string">' '</span></span>; }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre><br><br><pre> <code class="javascript hljs"> $apply(expr)    ,    $digest  $rootScope</code> </pre><br><br>  Now about the one who causes $ digest.  These functions are called by AngularJS itself at strategic locations in the code.  They can be called directly, or by calling $ apply ().  Most framework directives call these functions.  They call observers, and observers update the interface. <br><br>  Let's look at the list of properties associated with the $ digest loop that can be detected in scope. <br><br><pre> <code class="javascript hljs"> $<span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(expression, locals)      $evalAsync(expression)      $$asyncQueue   ,     digest $$postDigest(fn)  fn    digest $$postDigestQueue    $$postDigest(fn) </code> </pre><br><br>  Here are some more scope properties that deal with its life cycle and are commonly used for internal purposes.  But in some cases it may be necessary to create new scopes with $ new. <br><br><pre> <code class="javascript hljs"> $$isolateBindings     ( , { <span class="hljs-attr"><span class="hljs-attr">options</span></span>: <span class="hljs-string"><span class="hljs-string">'@megaOptions'</span></span> } $<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>(isolate)       ,      $destroy      .                $$destroyed     </code> </pre><br><br>  In the second part of the article, we will look at directives, isolated scopes, transclusions, anchored functions, compilers, directive controllers, and more. </div><p>Source: <a href="https://habr.com/ru/post/250637/">https://habr.com/ru/post/250637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250625/index.html">How does the brain work?</a></li>
<li><a href="../250627/index.html">Technical report on the activities of a criminal group engaged in targeted attacks - Anunak</a></li>
<li><a href="../250629/index.html">The second version of the glove to determine the position of the hand</a></li>
<li><a href="../250631/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 147 (February 9 - 15, 2015)</a></li>
<li><a href="../250633/index.html">Machine learning - 1. Correlation and regression. Example: site visitors conversion</a></li>
<li><a href="../250641/index.html">Solution: Adobe AIR does not find a connected iOS device from under Windows 7</a></li>
<li><a href="../250643/index.html">Without cuts. The second month of cashback service Kubyshka in Russia</a></li>
<li><a href="../250653/index.html">Setting up the IPAM service step by step</a></li>
<li><a href="../250657/index.html">DevCon Digest # 2. Immerse in ASP.NET</a></li>
<li><a href="../250659/index.html">Android application architecture ... The right way?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>