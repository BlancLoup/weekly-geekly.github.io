<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a game on Blend4Web. The beginnings of intelligence</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Even the most primitive game character should have at least some "brains". Fish a priori do not shine with intelligence, but something they still need...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a game on Blend4Web. The beginnings of intelligence</h1><div class="post__text post__text-html js-mediator-article">  Even the most primitive game character should have at least some "brains".  Fish a priori do not shine with intelligence, but something they still need to be able to do - move, ‚Äúwatch‚Äù, run away or attack.  They are not required to seek shelter or ‚Äúwrinkle the forehead‚Äù for a smart response phrase.  It looks simple, but is it easy to do? <br><br>  The conversation will be about the implementation of AI by JavaScript and Blend4Web.  The tasks set, the methods of their solution or the forced paths of a detour - all this is illustrated by the example of a live, game project. <br><a name="habracut"></a><br><h4>  Theoretical reasoning </h4><br>  I'll start with the entry.  The game being developed is a horizontal scroller where the main character moves in the same direction (from left to right).  As the hero serves the fish, resist the rest of the sea creatures.  And the player does not affect the hero, but only helps him in solving the existing problems.  Therefore, all the characters must have a little bit of reason to play was interesting.  However, not much is required of them.  I even note that the enemies are much smarter than the main character.  Actually, what to take with a simple goldfish!  This article is dedicated not to her, but to the humble and hungry inhabitants of the depths. <br><br>  How does life begin in the game?  Of course, with spawn!  It seems that it may be easier to create the necessary number of start markers in the editor in advance and generate enemies at these points.  However, at this stage, you can get poor replayability and a significant drop in performance.  Who is interested in replaying the level, knowing in advance that a shark will jump out from there, and a moray eel will crawl out from behind the stone.  It will help the generation of enemies in arbitrarily selected places (points).  And if you add a simple algorithm for selecting characters and their number in accordance with the terrain, it will become much more interesting. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Much more complicated is the case with performance.  In fact, the game is a continuously moving conveyor with a large number of active objects.  On one screen there can be several enemies, just passing fish, other elements interacting with the environment.  If you roughly imagine the length of a level, then the number of such objects can exceed hundreds.  The avalanche miscalculation of physics, animation, logic can result in serious brakes and one of the solutions is a temporary suspension of the activities of unnecessary objects. <br><br><img src="https://habrastorage.org/files/7d7/5e7/0f0/7d75e70f0265469f9d6126a0cdbd30c5.jpg"><br><br>  What is in the figure is my performance decision.  As you can see, the playing field is divided into zones.  At the start of the game, all objects are loaded into memory, scattered around the spawns and ‚Äúfrozen‚Äù.  Depending on the location of the main character, there is an activation of objects of a particular sector.  For example, in the figure, the main character is depicted in the zero zone.  The objects of compartments 2 and 3 are activated accordingly. Then the hero swims into sector 1 - the number four is connected, etc.  Activation of two zones at the same time, due to the need to give units time, at least for sailing from the places of generation.  So does the shutdown.  Here, however, a little smarter, because you need to consider that predators in a fit of excitement can cross the boundaries of their zone. <br><br>  Those circles that are visible in the figure are places for spawns.  In reality, they are located on the stage depending on the location, current tasks, etc.  At first there was an idea to use these coordinates as points for constructing the trajectory of objects, but later I abandoned it, letting the creatures float free.  Thereby, bringing even more surprises in the gameplay.  If we take into account that during spawn, not only places are randomly indicated, but also the initial rotation of the object, then the trajectory of movement becomes unpredictable. <br><br>  The main logic of character decisions is based on two events: the results of scanning the space in front of the object and the circular search.  The first option is used for more or less meaningful movement.  A beam released a certain distance in front of an object returns with some information.  Imagine that there is a rock ahead.  Depending on the distance to it, the character decides whether to swim further or turn.  Moreover, the rotation is performed until the front has a clear space. <br><br>  The second option is needed for more global action.  Thus, the main character is detected in the attention zone.  Accordingly, the character rushes to him in order to attack.  If he himself is in danger, then the enemy flees away in the opposite direction. <br><br>  This whole system of random movement looks very unstable.  Suppose a situation may arise that a unit moves in the direction opposite to the hero or, on the contrary, stubbornly overtakes it.  If he falls into the invisibility zone, then he will simply ‚Äúfreeze‚Äù until better times. <br><br>  As for aggressive characters, they can only attack within a certain time.  In the future, they ‚Äúlose‚Äù interest and swim in any direction. <br><br>  To summarize, the random generation of characters, their quantity and quality, the abandonment of rigid trajectories of movements, allows you to create a fairly unpredictable gameplay. <br><br><h4>  Practical approach </h4><br>  Theory is a good thing.  However, often in practice it turns out to be completely not so cloudless, and many seemingly correct decisions require significant adjustments.  Much depends on the functionality of the API engine and, of course, the professionalism of the programmer.  Alas, I can‚Äôt boast the last, so many thanks to those Blend4Web developers for listening to my sometimes strange questions and helping as much as possible. <br><br>  So, the used engine is Blend4Web, the programming language JavaScript, the target platform is the web.  This is not my first article on the creation of the game.  Check out previous materials if something is unclear (list in order of publication time): <br><br><ul><li>  <a href="http://habrahabr.ru/post/263453/">Creating a game on Blend4Web.</a>  <a href="http://habrahabr.ru/post/263453/">Scene and surroundings</a> </li><li>  <a href="http://habrahabr.ru/post/264115/">Creating a game on Blend4Web.</a>  <a href="http://habrahabr.ru/post/264115/">Programmer's path</a> </li><li>  <a href="http://habrahabr.ru/post/268937/">Character preparation for Blend4Web</a> </li></ul><br><br>  By tradition, for key objects in the scene I use separate handler scripts.  Therefore, the <i>game_fish.js</i> file was created for fish, and the global steel constants are stored in the <i>game_config.js</i> file. <br><br>  AI processing is carried out independently of the rest of the code and, in fact, requires only initialization - a request to generate objects.  There are several corresponding lines in the main game_app.js file: <br><pre><code class="javascript hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_fish = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"game_fish"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_game_config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"game_config"</span></span>); ... var number = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type_fish = m_game_config.FISH1; m_fish.new_fishes(number, type_fish); ...</code> </pre> <br>  With the help of <i>m_fish.new_fishes, a</i> request is made to create fish of a certain type ( <i>type_fish</i> variable) and the required number ( <i>number</i> ).  Actually, nothing more is required from game_app, so we are going to the topic of conversation. <br><br>  So, first a call is made to the function new_fishes, responsible for launching the mechanism for generating fish: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _type_fish; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _elapsed_sensor; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> APP_ASSETS_PATH = m_cfg.get_std_assets_path() + <span class="hljs-string"><span class="hljs-string">"waterhunter/"</span></span>; exports.new_fishes = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">number, type_fish</span></span></span><span class="hljs-function">) </span></span>{ _type_fish = type_fish; _elapsed_sensor = m_ctl.create_elapsed_sensor(); <span class="hljs-comment"><span class="hljs-comment">//load fish var i; for (i = 0; i &lt; number; i++) { m_data.load(APP_ASSETS_PATH +type_fish, fish_loaded_cb,null,true,true); } }</span></span></code> </pre><br>  The first three lines describe global variables, and then a simple loop is executed based on the required number of instances ( <i>number</i> ). <br><br>  The constant <i>APP_ASSETS_PATH</i> contains the path to game resources (json, media, etc.), which is used by the <i>m_data.load</i> function to load the fish model.  You can learn more about the intricacies of working with load from the <a href="http://habrahabr.ru/post/268937/">last lesson</a> .  I will add that the object is disabled after loading and becomes invisible. <br><br>  In general, for multiple identical objects, it is common practice to copy (instancing) an already loaded instance.  More recently, the corresponding functions have appeared in the Blend4Web API.  But they are limited to simple copying of geometry and do not allow working with a more complex model hierarchy.  This forces the use of the load function.  Although it is well placed to manage the boot process, it is rather slow.  For the sake of interest, I tried to load 50 copies of fish with it - I had to wait about 7 seconds, which is very bad for dynamically created objects. <br><br>  At this stage of development, this is not critical, because the generation of objects can be hidden under the load level splash.  But for a dynamic scene it is better to use a pool of objects. <br><br>  The following function <i>m_ctl.create_elapsed_sensor ()</i> looks very interesting.  With its help, a special sensor object is created that generates an event with a certain periodicity and is capable of producing the time between the render of the current frame and the previous one.  Simply put, it is useful for moving or rotating an object at the same speed, regardless of the power of the system.  But, to work with him, you must first ‚Äúsubscribe‚Äù to this event.  About this a little further. <br><br>  When the file upload is completed, the function <i>fish_loaded_cb is called</i> .  It is in it that further work continues. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fish_loaded_cb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data_id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    4 var spawn_number = Math.floor(Math.random() * (5 - 1)) + 1; //   - var spawn = m_scenes.get_object_by_name (m_game_config.SPAWN_FISH[spawn_number-1],0); //  spawn var spawn_coord = new Float32Array(3); spawn_coord = m_trans.get_translation (spawn, spawn_coord); //    var obj_fish = m_scenes.get_object_by_name ("fish", data_id); //    spawn m_trans.set_translation_v (obj_fish,spawn_coord); ...</span></span></code> </pre><br>  This bunch of lines only performs two actions, but very important ones.  The only marker that is available in the scene is selected at random.  Then the model is moved to its coordinates.  Thus, each subsequent instances of the fish will be scattered in different places.  It may happen that there will be several objects at one point.  Initially, the chosen variant of the cubic collider often led to the ‚Äúgluing‚Äù of intersecting models.  So I had to choose a spherical collider.  This solved my problem. <br><br>  So, in the line with <i>Math.random,</i> a random number from 1 to 4 is generated and stored in the <i>spawn_number</i> variable (in the test example, only 4 spawn objects).  The game_config.js file contains an array of spawn objects: <br><pre> <code class="javascript hljs">exports.SPAWN_FISH = [<span class="hljs-string"><span class="hljs-string">"spawn1"</span></span>,<span class="hljs-string"><span class="hljs-string">"spawn2"</span></span>,<span class="hljs-string"><span class="hljs-string">"spawn3"</span></span>,<span class="hljs-string"><span class="hljs-string">"spawn4"</span></span>];</code> </pre><br>  The function get_object_by_name searches the base scene for an object with the name stored in an array: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spawn = m_scenes.get_object_by_name (m_game_config.SPAWN_FISH[spawn_number<span class="hljs-number"><span class="hljs-number">-1</span></span>],<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  Now the model is loaded and moved to the location of the dislocation, it remains to make it visible and enable physics.  This is where the first surprise awaits. <br><br>  The engine API has <i>show_object (obj)</i> and <i>enable_simulation (obj)</i> functions.  They just activate the object specified in brackets.  In this case, the hierarchy is completely ignored.  This is due to the nature of character creation and customization (described in detail in the <a href="http://habrahabr.ru/post/268937/">previous article</a> ).  For example, the model hierarchy might look like this: <br><br><ul><li>  Root Collider Object (physical body) </li><li>  the model itself </li><li>  Empty helper objects </li><li>  child models with their own hierarchy </li></ul><br><br>  Any of these items can have physics or be rendered.  It is clear that the collider does not show anything.  Nevertheless, the decision is shifted to the user, what and how to include. <br><br>  It would be nice to add functions to the API that perform the same thing, only with the entire hierarchy at once.  Indicated the root object and got the result. <br><br>  Since this is not the case, then you have to go through all the objects and activate them in a loop: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        ID var objs = m_scenes.get_all_objects("ALL", data_id); for (var i = 0; i &lt; objs.length; i++) { var obj = objs[i]; //   mesh if (m_obj.is_mesh(obj)) m_scenes.show_object(obj); //     if (m_phy.has_physics(obj)) m_phy.enable_simulation(obj); } ...</span></span></code> </pre><br>  Now physics and visualization are included.  It remains to do the main thing - to add a little ‚Äúbrains‚Äù to the fish. <br><br>  I decided to do the following.  Make a template for storing local character data and create a working instance based on it.  Such a workpiece contains references to objects in the character hierarchy, its logical status (state), and even some temporary variables.  The data_id is the number of the loaded scene-model. <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// function template_fish (data_id) { this.root = m_scenes.get_object_by_name ("fish", data_id); this.body = m_scenes.get_object_by_name ("body", data_id); this.state = m_game_config.STATE_FISH_INI; ... }</span></span></code> </pre><br>  The object itself is created as follows: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clone_fish = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> template_fish(data_id);</code> </pre><br>  A little earlier, a sensor was created (the function <i>create_elapsed_sensor</i> ) generating cyclic events.  It is time to connect a new character to this sensor to create the main logic unit: <br><pre> <code class="javascript hljs">m_ctl.create_sensor_manifold(clone_fish, <span class="hljs-string"><span class="hljs-string">"FISH"</span></span>, m_ctl.CT_CONTINUOUS, [_elapsed_sensor], <span class="hljs-literal"><span class="hljs-literal">null</span></span>, fish_ai_cb); <span class="hljs-comment"><span class="hljs-comment">//      _fishes.push (clone_fish);</span></span></code> </pre><br>  Note that this set ( <i>sensor_manifold</i> ) calls the <i>fish_ai_cb</i> function when an event occurs.  It is in it that the main part of logic is concentrated.  Switching actions are performed in accordance with the local variable of the <i>state</i> object: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fish_ai_cb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">clone_fish</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> m_game_config.STATE_FISH_INI: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> m_game_config.STATE_FISH_MOVE: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> m_game_config.STATE_FISH_ROTATE: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ... default: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br>  For convenience, all possible values ‚Äã‚Äãof <i>state are</i> in the configuration file: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//State fish exports.STATE_FISH_INI = 0; exports.STATE_FISH_MOVE = 1; exports.STATE_FISH_ROTATE = 5; exports.STATE_FISH_WAIT = 3; ...</span></span></code> </pre><br>  Now consider the features of the implementation of the movement and the search path.  The movable object-fish is a spherical collider.  All other objects in the scene also have physical colliders.  This allows you to use a raycast to scan the space in front of the fish's nose.  If the beam is reflected from any object, then a logical decision is made. <br><br>  The beam is generated only when the fish moves forward.  In all other cases, this is not necessary. <br><br>  So, there is the following code enclosed in <i>case STATE_FISH_MOVE</i> : <br><pre> <code class="javascript hljs">‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">//   m_phy.set_character_move_dir(clone_fish.root,1, 0); ‚Ä¶ // ray test var to = new Float32Array(3); var trans = new Float32Array(3); m_trans.get_translation(clone_fish.root, trans); to = [0,0,1]; clone_fish.ray_id = m_phy.append_ray_test(clone_fish.root, trans, to, "ANY", ray_test_cb, true); ...</span></span></code> </pre><br>  In accordance with the purpose of the logical block, the object is moved here.  In general, Blend4Web offers two modules for this purpose: physics (using physics) and transform (the usual change of vectors).  Since I use colliders, as well as the raycast function, all the movement and rotation of objects need to be done only with the help of physics. <br><br>  The <i>set_character_move_dir (clone_fish.root, 1, 0)</i> function just moves an object in the specified direction (forward).  And this happens regardless of the main stream.  That is, having called this function once, you will receive an infinite movement (speed and other physics parameters are set in Blender. See the lesson ‚Äú <a href="http://habrahabr.ru/post/268937/">Preparing a Character for Blend4Web</a> ‚Äù). <br><br>  Further along the code is the raycast generation.  The <i>append_ray_test</i> function requires a number of parameters: <br><ul><li>  Reference to the object generating the beam. </li><li>  Starting position  Matches object coordinates. </li><li>  Direction vector.  Forward along the local axis with a length limit of one. </li><li>  Collider ID.  In this case, the response to all options. </li><li>  The name of the function that returns the result of the scan. </li><li>  Scanner operation mode (TRUE - single call, FALSE - endless scanning). </li></ul><br><br>  In accordance with the specified parameters, the following occurs.  The function ‚Äúsends‚Äù the beam in the specified direction ( <i>to</i> ).  When any object is <i>detected, ray_test_cb</i> is called.  After that, raycast stops working.  Note that <i>append_ray_test</i> also works in asynchronous mode. <br><br>  So, while the <i>state</i> = ‚Äúmove‚Äù mode is set, the fish moves forward and at the same time ‚Äúprobes‚Äù the space in front of the nose.  If an obstacle is detected, the movement stops, the status changes to ‚Äúrotate‚Äù and, accordingly, a reversal is performed. <br><br>  Practically this is solved with the use of crutches.  The problem was that the ray_test_cb <i>callback</i> does not return a reference to the object that called the raycast.  And after all, it is for him to change the state mode.  It is good that when creating a raycast, the identification number of the ‚Äúray‚Äù is created, which is then transmitted to the callback. <br><br>  I had to create a special variable <i>ray_id</i> for the object in order to store the id of the <i>append_ray_test</i> function.  By simply sorting through the <i>id_ray of</i> all the fish, the culprit is found and the state is set: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ray_test_cb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id, hit_fract, obj_hit</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; _fishes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_fishes[i].ray_id ==id) _fishes[i].state = m_game_config.STATE_FISH_ROTATE; } }</code> </pre><br>  The spread itself is performed as follows: <br><pre> <code class="javascript hljs">... var elapsed = m_ctl.get_sensor_value(clone_fish, <span class="hljs-string"><span class="hljs-string">"FISH"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); m_phy.character_rotation_inc(clone_fish.root, elapsed * <span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); ...</code> </pre><br>  Function <i>character_rotation_inc (obj, h_angle, v_angle)</i> <br>  rotates the object to the specified angle, where <i>h_angle</i> is the horizontal angle value, <i>v_angle</i> is the verticals.  And here, attention!  For the same rotational speed, regardless of the power of the computer, you must use the return time from the elapsed_sensor sensor (first line).  Multiply the value obtained by the desired angle of rotation. <br><br><h4>  The result of the work </h4><br>  I am developing this game, first of all, to explore the possibilities of Blend4Web.  By trial and error, the code is created, as well as the b4w‚Äôs incomprehensible or weak points. <br><br>  The most important thing that I lacked was debug-functions.  For example, the ability to create a line between two points.  This could be used to test raycast ray.  Or visualization of colliders.  And it is the physical body, not the primitive, that is created in Blender. <br><br>  It would be nice to create vector direction constants, such as Forward, Back, Left, Right.  The fact is that the coordinate axes of Blender and WebGL do not match.  Faster writing Vec3.Forward, rather than experimenting and looking for a suitable combination [0,0,1]. <br><br>  Random number generator.  Yes, you can write <i>Math.floor (Math.random () * (5 - 1)) + 1</i> , but it would be easier to take a ready-made function. <br><br>  Nevertheless, the code was written, the fish are swimming and even a little ‚Äúwiggling their brains‚Äù.  To be continued‚Ä¶ <br><br>  <b>Update</b> <br>  For some reason, the application is not loaded in firefox, although there are no problems with the browser on the local server, but the download scripts will definitely be able to download :) <br>  <a href="http://www.prandgames.com/share/waterhunter/waterhunter.html">Test scene</a> + <a href="">scripts</a> . </div><p>Source: <a href="https://habr.com/ru/post/269779/">https://habr.com/ru/post/269779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269769/index.html">Configuring a bunch of Apache Zeppelin + Oracle</a></li>
<li><a href="../269771/index.html">3 days before the increase in the cost of tickets for the conference of mobile developers MBLTdev</a></li>
<li><a href="../269773/index.html">November 7 in Moscow, Hackathon: ‚ÄúWhere does our money go? Civil technology analysis of government spending and government revenue. "</a></li>
<li><a href="../269775/index.html">Pirate metrics: how to create an email campaign based on the AARRR principle. Part 2</a></li>
<li><a href="../269777/index.html">How we searched for a bug in Yandex Search Balancer, and found it in Chromium</a></li>
<li><a href="../269783/index.html">DDoS analytics</a></li>
<li><a href="../269785/index.html">Ghost Methods in Ruby (translation)</a></li>
<li><a href="../269787/index.html">How to keep outdated programming language</a></li>
<li><a href="../269789/index.html">Once again about the seven main development methodologies</a></li>
<li><a href="../269791/index.html">Janusjs: concept of the system, where the client and server are conjoined twins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>