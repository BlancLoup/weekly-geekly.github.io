<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automated testing of a web application (MS Unit Testing Framework + Selenium WebDriver C #). Part 2.1: Selenium API wrapper - Browser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Hello again! I present to you the second part of the article on automated testing of web applications on Selenium and C #. And if the f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automated testing of a web application (MS Unit Testing Framework + Selenium WebDriver C #). Part 2.1: Selenium API wrapper - Browser</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9af/616/ceb/9af616ceb1d0813bbf7dd52ec7507e8a.png" alt="Selenium + C #"><br><h5>  Introduction </h5><br>  Hello again!  I present to you the second part of the article on automated testing of web applications on Selenium and C #.  And if the first part was from the category of "captain obvious", which caused the indignation of readers, then in this part there will be a lot of code.  And so, why write a wrapper over the Selenium API?  In my opinion, users may encounter the following problems: <br><ul><li>  The IWebDriver interface provides rather poor functionality in terms of browser management.  Therefore, all that we need will have to write </li><li>  The description of an element occurs simultaneously with its search, i.  at the time of defining the element, it must exist in the browser.  It is often solved by writing a getter for each element.  This is expensive and bad in terms of performance. </li><li>  ISearchContext.FindElements accepts only one parameter of type OpenQA.Selenium.By, i.e.  we cannot search for several properties at once.  Usually, an element is searched for by the first criterion, and then screening begins for the rest. </li><li>  The absence of many seemingly obvious methods and properties.  For example: Exist, SetText, Select, SetCheck, InnerHtml, etc.  Instead, we have to be content with Click, SendKeys and Text. </li><li>  A lot of problems on different browsers, for example, on Firefox and Chrome, the element is clicked, but on IE - not.  You have to write special cases, "crutches" </li><li>  Performance.  Yes, the drivers do not work fast.  IE is ahead of the rest of the planet as usual - the search can take seconds, sometimes tens of seconds </li></ul><br>  Well, a lot of problems - a lot of solutions.  I do not want and can not explain everything at once in this part.  A long post will be uninteresting, and while writing it enthusiasm drops sharply) Therefore, this part has the number 2.1, in it I will show my wrapper over the browser. <a name="habracut"></a><br><br><h5>  Links </h5><br>  <a href="http://habrahabr.ru/post/178321/">Part 1: Introduction</a> <br>  <a href="http://habrahabr.ru/post/180047/">Part 2.1: Selenium API wrapper - Browser</a> <br>  <a href="http://habrahabr.ru/post/180357/">Part 2.2: Selenium API wrapper - WebElement</a> <br>  <a href="http://habrahabr.ru/post/180705/">Part 3: WebPages - describing pages</a> <br>  <a href="http://habrahabr.ru/post/181558/">Part 4: Finally writing tests</a> <br>  <a href="https://autotests.codeplex.com/">Framework Publishing</a> <br><br><h5>  Go.  Wrapper implementation over the browser: Browser class </h5><br>  I really hope that the above code does not seem difficult to you. <br>  In the example, all IWebDriver-specific code is encapsulated, the pants are not protruding to the outside, i.e.  autotest developers will not have direct access to the driver.  As a consequence, there are methods in which the driver method with the same name is called. <br>  There are no comments in the code - this is a good tone, and as one intelligent person said: ‚ÄúComments in the code are like hair in soup.  Would you eat hair soup ?! ‚Äù <br>  I use Microsoft Code Contracts, do not be intimidated by the calls. <br>  It is also worth noting that jquery is connected in the product under test, and some actions will be performed using it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Browser class supports 3 browsers: <br><ul><li>  Firefox </li><li>  Chrome </li><li>  Internet Explorer </li></ul><br>  It‚Äôs a pity that there are no C # drivers for Opera :( <br><br>  Implemented a set of standard methods and properties like: <br><ul><li>  Start </li><li>  Quit </li><li>  Navigate </li><li>  NavigateBack </li><li>  Refresh </li><li>  WaitReadyState </li><li>  FindElements </li><li>  Selectedbrowser </li><li>  Url </li><li>  Title </li><li>  PageSource </li><li>  other </li></ul><br>  I think the names are quite obvious, so go ahead. <br><br>  Also implemented specific functions: <br><ul><li>  WaitAjax </li><li>  SwitchToFrame </li><li>  SwitchToPopupWindow </li><li>  AcceptAlert </li><li>  GetScreenshot + SaveScreenshot </li><li>  ResizeWindow </li><li>  ExecuteJavaScript </li><li>  DragAndDrop </li><li>  other </li></ul><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Autotests.Utilities</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Browsers { [Description(<span class="hljs-string"><span class="hljs-string">"Windows Internet Explorer"</span></span>)] InternetExplorer, [Description(<span class="hljs-string"><span class="hljs-string">"Mozilla Firefox"</span></span>)] Firefox, [Description(<span class="hljs-string"><span class="hljs-string">"Google Chrome"</span></span>)] Chrome } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Browser</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Public properties public static Browsers SelectedBrowser { get { return Settings.Default.Browser; } } public static Uri Url { get { WaitAjax(); return new Uri(WebDriver.Url); } } public static string Title { get { WaitAjax(); return string.Format("{0} - {1}", WebDriver.Title, EnumHelper.GetEnumDescription(SelectedBrowser)); } } public static string PageSource { get { WaitAjax(); return WebDriver.PageSource; } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Public methods public static void Start() { _webDriver = StartWebDriver(); } public static void Navigate(Uri url) { Contract.Requires(url != null); WebDriver.Navigate().GoToUrl(url); } public static void Quit() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (_webDriver == null) return; _webDriver.Quit(); _webDriver = null; } public static void WaitReadyState() { Contract.Assume(WebDriver != null); var ready = new Func&lt;bool&gt;(() =&gt; (bool)ExecuteJavaScript("return document.readyState == 'complete'")); Contract.Assert(Executor.SpinWait(ready, TimeSpan.FromSeconds(60), TimeSpan.FromMilliseconds(100))); } public static void WaitAjax() { Contract.Assume(WebDriver != null); var ready = new Func&lt;bool&gt;(() =&gt; (bool)ExecuteJavaScript("return (typeof($) === 'undefined') ? true : !$.active;")); Contract.Assert(Executor.SpinWait(ready, TimeSpan.FromSeconds(60), TimeSpan.FromMilliseconds(100))); } public static void SwitchToFrame(IWebElement inlineFrame) { WebDriver.SwitchTo().Frame(inlineFrame); } public static void SwitchToPopupWindow() { foreach (var handle in WebDriver.WindowHandles.Where(handle =&gt; handle != _mainWindowHandler)) // TODO: { WebDriver.SwitchTo().Window(handle); } } public static void SwitchToMainWindow() { WebDriver.SwitchTo().Window(_mainWindowHandler); } public static void SwitchToDefaultContent() { WebDriver.SwitchTo().DefaultContent(); } public static void AcceptAlert() { var accept = Executor.MakeTry(() =&gt; WebDriver.SwitchTo().Alert().Accept()); Executor.SpinWait(accept, TimeSpan.FromSeconds(5)); } public static IEnumerable&lt;IWebElement&gt; FindElements(By selector) { Contract.Assume(WebDriver != null); return WebDriver.FindElements(selector); } public static Screenshot GetScreenshot() { WaitReadyState(); return ((ITakesScreenshot)WebDriver).GetScreenshot(); } public static void SaveScreenshot(string path) { Contract.Requires(!string.IsNullOrEmpty(path)); GetScreenshot().SaveAsFile(path, ImageFormat.Jpeg); } public static void DragAndDrop(IWebElement source, IWebElement destination) { (new Actions(WebDriver)).DragAndDrop(source, destination).Build().Perform(); } public static void ResizeWindow(int width, int height) { ExecuteJavaScript(string.Format("window.resizeTo({0}, {1});", width, height)); } public static void NavigateBack() { WebDriver.Navigate().Back(); } public static void Refresh() { WebDriver.Navigate().Refresh(); } public static object ExecuteJavaScript(string javaScript, params object[] args) { var javaScriptExecutor = (IJavaScriptExecutor)WebDriver; return javaScriptExecutor.ExecuteScript(javaScript, args); } public static void KeyDown(string key) { new Actions(WebDriver).KeyDown(key); } public static void KeyUp(string key) { new Actions(WebDriver).KeyUp(key); } public static void AlertAccept() { Thread.Sleep(2000); WebDriver.SwitchTo().Alert().Accept(); WebDriver.SwitchTo().DefaultContent(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Private private static IWebDriver _webDriver; private static string _mainWindowHandler; private static IWebDriver WebDriver { get { return _webDriver ?? StartWebDriver(); } } private static IWebDriver StartWebDriver() { Contract.Ensures(Contract.Result&lt;IWebDriver&gt;() != null); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (_webDriver != null) return _webDriver; switch (SelectedBrowser) { case Browsers.InternetExplorer: _webDriver = StartInternetExplorer(); break; case Browsers.Firefox: _webDriver = StartFirefox(); break; case Browsers.Chrome: _webDriver = StartChrome(); break; default: throw new Exception(string.Format("Unknown browser selected: {0}.", SelectedBrowser)); } _webDriver.Manage().Window.Maximize(); _mainWindowHandler = _webDriver.CurrentWindowHandle; return WebDriver; } private static InternetExplorerDriver StartInternetExplorer() { var internetExplorerOptions = new InternetExplorerOptions { IntroduceInstabilityByIgnoringProtectedModeSettings = true, InitialBrowserUrl = "about:blank", EnableNativeEvents = true }; return new InternetExplorerDriver(Directory.GetCurrentDirectory(), internetExplorerOptions); } private static FirefoxDriver StartFirefox() { var firefoxProfile = new FirefoxProfile { AcceptUntrustedCertificates = true, EnableNativeEvents = true }; return new FirefoxDriver(firefoxProfile); } private static ChromeDriver StartChrome() { var chromeOptions = new ChromeOptions(); var defaultDataFolder = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + @"\..\Local\Google\Chrome\User Data\Default"; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (Directory.Exists(defaultDataFolder)) { Executor.Try(() =&gt; DirectoryExtension.ForceDelete(defaultDataFolder)); } return new ChromeDriver(Directory.GetCurrentDirectory(), chromeOptions); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre> <br>  Perhaps it is worth commenting that Settings.Default.Browser is a parameter that is set in the project properties, and Executor.SpinWait is some helper that waits until the condition is met with a timeout and returns true / false.  Also there are magic strings, I apologize) </div><p>Source: <a href="https://habr.com/ru/post/180047/">https://habr.com/ru/post/180047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180027/index.html">Calculation of arithmetic expressions in a text editor</a></li>
<li><a href="../180033/index.html">Google calls for a speedy transition to the VP9 codec</a></li>
<li><a href="../180037/index.html">Avast! removes calc.exe as a virus (2: 0)</a></li>
<li><a href="../180041/index.html">Mobile marketing and application design on AppClub {build, monetize} # 6 Kyiv</a></li>
<li><a href="../180043/index.html">The case of the maloksky safe</a></li>
<li><a href="../180049/index.html">Rambler distributes the search for Yandex through trojans on torrents</a></li>
<li><a href="../180051/index.html">A Chinese kidnapped from a family found his home 23 years later, thanks to a service for searching kidnapped people and Google Maps</a></li>
<li><a href="../180057/index.html">HackDay # 27 in St. Petersburg</a></li>
<li><a href="../180059/index.html">Concept of new mail from TIMEWEB!</a></li>
<li><a href="../180063/index.html">Camouflage against CCTV</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>