<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backdoor and Buhtrap encoder distributed using Yandex.Direct</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To target a cyber attack on accountants, you can use the working documents that they are looking for online. Something like this has been done in the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backdoor and Buhtrap encoder distributed using Yandex.Direct</h1><div class="post__text post__text-html js-mediator-article">  To target a cyber attack on accountants, you can use the working documents that they are looking for online.  Something like this has been done in the past few months by a cybergroup distributing the well-known <a href="https://habr.com/ru/company/eset/blog/255325/">Buhtrap</a> and <a href="https://habr.com/ru/company/eset/blog/322364/">RTM</a> <a href="https://habr.com/ru/company/eset/blog/255325/">backdoors</a> , as well as encryptors and cryptocurrency theft software.  Most goals are located in Russia.  The attack is implemented by placing malicious ads on Yandex.Direct.  Potential victims went to the site where they were offered to download a malicious file disguised as a document template.  Yandex has removed malicious ads after our warning. <br><br>  Buhtrap source code has been networked in the past, so anyone can use it.  We do not have information regarding the availability of the RTM code. <br><br>  In the post we will describe how the attackers distributed malware using Yandex.Direct and hosted it on GitHub.  Complete the post technical analysis of Malvari. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/y3/h0/ly/y3h0lyhh0aq4jl6dwpvaia-vf2q.png"><br><br><a name="habracut"></a><h2>  Buhtrap and RTM are back in business </h2><br><h4>  Propagation mechanism and sacrifice </h4><br>  The various payloads delivered to victims are united by a common distribution mechanism.  All malicious files created by the attackers were located in two different GitHub repositories. <br><br>  Usually in the repository there was one downloaded malicious file that changed frequently.  Since you can see the history of changes in the repository on GitHub, we see which malware was distributed during a certain period.  To convince the victim to download the malicious file, the site blanki-shabloni24 [.] Ru was used, shown in the figure above. <br><br>  The design of the site and all the names of malicious files are kept in a single concept - forms, templates, contracts, samples, etc. If we consider that Buhtrap and RTM software had already been used in attacks on accountants in the past, we assumed the same strategy in the new campaign.  The only question is how the victim got to the site of the attackers. <br><br><h4>  Infection </h4><br>  At least a few potential victims on this site were attracted by malicious ads.  The following is an example URL: <br><br> <code>https://blanki-shabloni24.ru/?utm_source=yandex&amp;utm_medium=banner&amp;utm_campaign=cid|{blanki_rsya}|context&amp;utm_content=gid|3590756360|aid|6683792549|15114654950_&amp;utm_term=  &amp;pm_source=bb.f2.kz&amp;pm_block=none&amp;pm_position=0&amp;yclid=1029648968001296456</code> <br> <br>  As you can see from the link, the banner was posted on the legitimate accounting forum bb.f2 [.] Kz.  It is important to note that banners appeared on different sites, all had the same campaign id (blanki_rsya), and the majority belonged to accounting or legal aid services.  The URL shows that the potential victim used the request to ‚Äúdownload the account form‚Äù, which reinforces our hypothesis about targeted attacks.  Listed below are the sites where banners and related search queries appeared. <br><br><ul><li>  Download account form - bb.f2 [.] kz </li><li>  sample contract - Ipopen [.] en </li><li>  Complaint Sample - 77metrov [.] en </li><li>  contract form - blank-dogovor-kupli-prodazhi [.] en </li><li>  judicial petition sample - zen.yandex [.] en </li><li>  sample complaint - yurday [.] en </li><li>  sample contract forms - Regforum [.] en </li><li>  contract form - assistentus [.] en </li><li>  sample apartment contract - napravah [.] com </li><li>  samples of legal contracts - avito [.] en </li></ul><br>  The blanki-shabloni24 [.] Ru site may have been set up to pass a simple visual assessment.  As a rule, advertising leading to a professional-looking site with a link to GitHub does not look like something obviously bad.  In addition, the attackers laid out malicious files in the repository only for a limited period, probably for the duration of the campaign.  Most of the repository on GitHub was an empty zip archive or a clean exe file.  Thus, the attackers could distribute advertising through Yandex.Direct on sites that were most likely visited by accountants who came for specific search queries. <br><br>  Next, consider the various payloads distributed in this way. <br><br><h2>  Payload analysis </h2><br><h4>  Chronology of the spread </h4><br>  The malicious campaign began in late October 2018 and is active at the time of writing the post.  Since the entire repository was publicly available on GitHub, we compiled the exact chronology of the distribution of six different malware families (see figure below).  We added a line showing the moment when the banner link was detected, according to ESET telemetry, for comparison with the git history.  As you can see, this correlates well with the availability of the payload on GitHub.  The discrepancy at the end of February can be explained by the lack of a part of the change history, since the repository was deleted from GitHub before we could get it completely. <br><br><img src="https://habrastorage.org/webt/sa/ua/1i/saua1i6vupxtv2pa-tvwawje8em.png"><br>  <i>Figure 1. Chronology of Malvari distribution.</i> <br><br><h4>  Certificates for code signing </h4><br>  The campaign used a lot of certificates.  Some have signed more than one malware family, which additionally indicates that different samples belong to the same campaign.  Despite the availability of the private key, operators did not sign binary files systematically and did not use the key for all samples.  At the end of February 2019, attackers began to create invalid signatures using a certificate belonging to Google, to which they do not have a private key. <br><br>  All certificates that are involved in the campaign and the families of Malvaris that they sign are listed in the table below. <br><br><img src="https://habrastorage.org/webt/wg/q_/-8/wgq_-807r6mtilzeam28lhbbrvi.png"><br><br>  We also used these code signing certificates to communicate with other malware families.  For most certificates, we didn‚Äôt find samples that would not be distributed through the GitHub repository.  However, the TOV ‚ÄúMARIYA‚Äù certificate was used to sign Malvari owned by the Wauchos <a href="https://www.welivesecurity.com/2018/01/04/wauchos-now-headed-extinction/">botnet</a> , adware and miners.  It is unlikely that this malware is associated with this campaign.  Most likely, the certificate was purchased in darknet. <br><br><h4>  Win32 / Filecoder.Buhtrap </h4><br>  The first component that caught our attention was the first discovered Win32 / Filecoder.Buhtrap.  This is a Delphi binary file that is sometimes packaged.  It was mainly distributed in February ‚Äì March 2019.  It behaves as it should be for an extortionist program - it searches for local drives and network folders and encrypts detected files.  To compromise, he does not need an Internet connection, since he does not contact the server to send encryption keys.  Instead, he adds a ‚Äútoken‚Äù at the end of the redemption message, and offers to use email or Bitmessage to communicate with operators. <br><br>  To encrypt as many important resources as possible, Filecoder.Buhtrap runs a stream designed to shut down key software that may have open file handlers with valuable information that may interfere with encryption.  Target processes are mainly database management systems (DBMS).  In addition, Filecoder.Buhtrap deletes log files and backups to make data recovery difficult.  To do this, run the batch script below. <br><br> <code>bcdedit /set {default} bootstatuspolicy ignoreallfailures <br> bcdedit /set {default} recoveryenabled no <br> wbadmin delete catalog -quiet <br> wbadmin delete systemstatebackup <br> wbadmin delete systemstatebackup -keepversions:0 <br> wbadmin delete backup <br> wmic shadowcopy delete <br> vssadmin delete shadows /all /quiet <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f <br> reg add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" <br> attrib "%userprofile%\documents\Default.rdp" -s -h <br> del "%userprofile%\documents\Default.rdp" <br> wevtutil.exe clear-log Application <br> wevtutil.exe clear-log Security <br> wevtutil.exe clear-log System <br> sc config eventlog start=disabled</code> <br> <br>  Filecoder.Buhtrap uses the legitimate online IP Logger service, created to collect information about site visitors.  This is intended to track the victims of the encoder, for which the command line is responsible: <br><br> <code>mshta.exe "javascript:document.write('');"</code> <br> <br>  Files for encryption are selected in case of discrepancy in the three exception lists.  First, files with the following extensions are not encrypted: .com, .cmd, .cpl, .dll, .exe, .hta, .lnk, .msc, .msi, .msp, .pif, .scr, .sys and .bat  Secondly, all files for which the full path contains directory lines from the list below are excluded. <br><br> <code>\.{ED7BA470-8E54-465E-825C-99712043E01C}\ <br> \tor browser\ <br> \opera\ <br> \opera software\ <br> \mozilla\ <br> \mozilla firefox\ <br> \internet explorer\ <br> \google\chrome\ <br> \google\ <br> \boot\ <br> \application data\ <br> \apple computer\safari\ <br> \appdata\ <br> \all users\ <br> :\windows\ <br> :\system volume information\ <br> :\nvidia\ <br> :\intel\</code> <br> <br>  Thirdly, certain file names are also excluded from encryption, among them the file name of the message requesting redemption.  The list is presented below.  Obviously, all these exceptions are designed to preserve the ability to start the machine, but with its minimum usability. <br><br> <code>boot.ini <br> bootfont.bin <br> bootsect.bak <br> desktop.ini <br> iconcache.db <br> ntdetect.com <br> ntldr <br> ntuser.dat <br> ntuser.dat.log <br> ntuser.ini <br> thumbs.db <br> winupas.exe <br> your files are now encrypted.txt <br> windows update assistant.lnk <br> master.exe <br> unlock.exe <br> unlocker.exe</code> <br> <br><h4>  File Encryption Scheme </h4><br>  Once launched, malware generates a pair of 512-bit RSA keys.  The private exponent (d) and the module (n) are then encrypted with a hard-coded 2048-bit public key (public exponent and module), packed with zlib and encoded in base64.  The code responsible for this is shown in Figure 2. <br><br><img src="https://habrastorage.org/webt/c_/p_/g9/c_p_g9rfnoggxyffe9jedxgibrk.png"><br>  <i>Figure 2. The result of decompiling Hex-Rays of the process of generating a 512-bit RSA key pair.</i> <br><br>  Below is an example of a plain text with a generated private key, which is a token attached to a redemption message. <br><br> <code>DF9228F4F3CA93314B7EE4BEFC440030665D5A2318111CC3FE91A43D781E3F91BD2F6383E4A0B4F503916D75C9C576D5C2F2F073ADD4B237F7A2B3BF129AE2F399197ECC0DD002D5E60C20CE3780AB9D1FE61A47D9735036907E3F0CF8BE09E3E7646F8388AAC75FF6A4F60E7F4C2F697BF6E47B2DBCDEC156EAD854CADE53A239</code> <br> <br>  The attacker's public key is shown below. <br><br> <code>e = 0x72F750D7A93C2C88BFC87AD4FC0BF4CB45E3C55701FA03D3E75162EB5A97FDA7ACF8871B220A33BEDA546815A9AD9AA0C2F375686F5009C657BB3DF35145126C71E3C2EADF14201C8331699FD0592C957698916FA9FEA8F0B120E4296193AD7F3F3531206608E2A8F997307EE7D14A9326B77F1B34C4F1469B51665757AFD38E88F758B9EA1B95406E72B69172A7253F1DFAA0FA02B53A2CC3A7F0D708D1A8CAA30D954C1FEAB10AD089EFB041DD016DCAAE05847B550861E5CACC6A59B112277B60AC0E4E5D0EA89A5127E93C2182F77FDA16356F4EF5B7B4010BCCE1B1331FCABFFD808D7DAA86EA71DFD36D7E701BD0050235BD4D3F20A97AAEF301E785005 <br> n = 0x212ED167BAC2AEFF7C3FA76064B56240C5530A63AB098C9B9FA2DE18AF9F4E1962B467ABE2302C818860F9215E922FC2E0E28C0946A0FC746557722EBB35DF432481AC7D5DDF69468AF1E952465E61DDD06CDB3D924345A8833A7BC7D5D9B005585FE95856F5C44EA917306415B767B684CC85E7359C23231C1DCBBE714711C08848BEB06BD287781AEB53D94B7983EC9FC338D4320129EA4F568C410317895860D5A85438B2DA6BB3BAAE9D9CE65BCEA6760291D74035775F28DF4E6AB1A748F78C68AB07EA166A7309090202BB3F8FBFC19E44AC0B4D3D0A37C8AA5FA90221DA7DB178F89233E532FF90B55122B53AB821E1A3DB0F02524429DEB294B3A4EDD</code> <br> <br>  Files are encrypted using AES-128-CBC with a 256-bit key.  For each file to be encrypted, a new key and a new initialization vector are generated.  Key information is added to the end of the file to be encrypted.  Consider the format of the encrypted file. <br>  The encrypted files have the following header: <br><br><img src="https://habrastorage.org/webt/lo/-e/7m/lo-e7mo1l2ta7ie0n2rlz0ybirs.png"><br><br>  The source file data with the addition of the magic value VEGA is encrypted up to the first 0x5000 bytes.  All decryption information is attached to a file with the following structure: <br><br><img src="https://habrastorage.org/webt/iw/hy/az/iwhyaz2vw5c45i6vk0s4hs_sadq.png"><br><br>  - The file size marker contains a label indicating whether the file is larger than 0x5000 bytes <br>  - AES key blob = ZlibCompress (RSAEncrypt (AES key + IV, public key of the generated RSA key pair)) <br>  - RSA key blob = ZlibCompress (RSAEncrypt (generated RSA private key, RSA hardcoded public key)) <br><br><h4>  Win32 / ClipBanker </h4><br>  Win32 / ClipBanker - a component that intermittently distributed from late October to early December 2018.  His role is to track the contents of the clipboard, he is looking for addresses of cryptocurrency wallets.  Having determined the address of the target wallet, ClipBanker replaces it with the address allegedly belonging to the operators.  The samples that we studied were neither packaged nor obfuscated.  The only mechanism used to disguise behavior is string encryption.  Addresses of operators' wallets are encrypted using RC4.  Target cryptocurrencies - Bitcoin, Bitcoin cash, Dogecoin, Ethereum and Ripple. <br><br>  During the period when the malware was spreading to the attacker's wallets, a small amount was sent to the PTS, which puts the campaign‚Äôs success in doubt.  In addition, there is no reason to assume that these transactions were generally associated with ClipBanker. <br><br><h4>  Win32 / RTM </h4><br>  The Win32 / RTM component was distributed for several days at the beginning of March 2019.  RTM is a Delphi Trojan Banker aimed at online banking systems.  In 2017, ESET researchers published a <a href="https://www.welivesecurity.com/wp-content/uploads/2017/02/Read-The-Manual.pdf">detailed analysis of</a> this program, the description is still relevant.  In January 2019, Palo Alto Networks also released <a href="https://unit42.paloaltonetworks.com/russian-language-malspam-pushing-redaman-banking-malware/">an RTM blog post</a> . <br><br><h4>  Buhtrap loader </h4><br>  For some time, a bootloader was available on GitHub, unlike the previous Buhtrap tools.  It accesses <code>https://94.100.18[.]67/RSS.php?&lt;some_id&gt;</code> for the next step and loads it directly into memory.  Two behaviors of the second stage code can be distinguished.  In the first URL, RSS.php passed the Buhtrap backdoor directly - this backdoor is very similar to the one that is available after the source code is leaked. <br><br>  Interestingly, we see several Buhtrap backdoor campaigns, and are presumably driven by different operators.  In this case, the main difference is that the backdoor is loaded directly into memory and does not use the usual scheme with the DLL deployment process, which we described <a href="https://habr.com/ru/company/eset/blog/255325/">earlier</a> .  In addition, the operators changed the RC4 key used to encrypt network traffic to the C &amp; C server.  In most of the campaigns we saw, operators did not care about changing this key. <br><br>  The second, more complex behavior - the RSS.php URL was transmitted by another downloader.  It implemented some obfuscation, such as rebuilding a dynamic import table.  The purpose of the bootloader is to contact the C &amp; C server <a href="https://msiofficeupd/">msiofficeupd</a> [.] Com / api / F27F84EDA4D13B15 / 2, send logs and wait for a response.  It processes the response as a blob, loads it into memory and executes it.  The payload we saw while running this loader was the same Buhtrap backdoor, but perhaps there are other components. <br><br><h4>  Android / Spy.Banker </h4><br>  Interestingly, a component for Android was found in the GitHub repository.  It was in the main branch for only one day - November 1, 2018.  In addition to posting on GitHub, ESET telemetry finds no evidence of the spread of this malware. <br><br>  The component was hosted as the Android Application Package (APK).  He is very obfuscated.  Malicious behavior is hidden in an encrypted JAR located in APK.  It is encrypted on RC4 using this key: <br><br> <code>key = [ <br> 0x87, 0xd6, 0x2e, 0x66, 0xc5, 0x8a, 0x26, 0x00, 0x72, 0x86, 0x72, 0x6f, <br> 0x0c, 0xc1, 0xdb, 0xcb, 0x14, 0xd2, 0xa8, 0x19, 0xeb, 0x85, 0x68, 0xe1, <br> 0x2f, 0xad, 0xbe, 0xe3, 0xb9, 0x60, 0x9b, 0xb9, 0xf4, 0xa0, 0xa2, 0x8b, 0x96 <br> ]</code> <br> <br>  The same key and algorithm are used to encrypt strings.  JAR is located in <code>APK_ROOT + image/files</code> .  The first 4 bytes of the file contain the length of the encrypted JAR, which begins immediately after the length field. <br><br>  After decrypting the file, we discovered that it was Anubis, a previously <a href="https://news.sophos.com/en-us/2018/08/14/anubis-is-back-are-you-prepared/">documented</a> banker for Android.  Malicious software has the following functions: <br><br><ul><li>  microphone recording </li><li>  taking screenshots </li><li>  getting GPS coordinates </li><li>  keylogger </li><li>  device data encryption and ransom requirements </li><li>  spamming </li></ul><br>  Interestingly, the banker used Twitter as a backup communication channel to get another C &amp; C server.  The sample we analyzed used the @JohnesTrader account, but at the time of the analysis it was already blocked. <br><br>  Banker lists target applications on an Android device.  It has become longer than the list obtained during the Sophos research.  There are a lot of banking applications in the list, programs for online shopping, such as Amazon and eBay, cryptocurrency services. <br><br><h4>  MSIL / ClipBanker.IH </h4><br>  The last component that was distributed as part of this campaign is the .NET Windows executable file that appeared in March 2019.  Most of the versions studied were packaged by ConfuserEx v1.0.0.  Like ClipBanker, this component uses the clipboard.  His goal is a wide range of cryptocurrencies, as well as offers on Steam.  In addition, he uses the IP Logger service to steal a Bitcoin private WIF key. <br><br>  Protection mechanisms <br>  In addition to the advantages provided by ConfuserEx in the form of counteracting debugging, dumping and interfering with work, the component has the ability to detect anti-virus products and virtual machines. <br><br>  To check the launch in the virtual machine, malware uses the WMI command line (WMIC) built into Windows to request information about the BIOS, namely: <br><br> <code>wmic bios</code> <br> <br>  Then the program parses the output of the command and searches for keywords: VBOX, VirtualBox, XEN, qemu, bochs, VM. <br><br>  To detect anti-virus products, malware sends a Windows Management Instrumentation (WMI) request to the Windows Security Center using the <code>ManagementObjectSearcher</code> API as shown below.  After decoding from base64, the call looks like this: <br><br> <code>ManagementObjectSearcher('root\\SecurityCenter2', 'SELECT * FROM AntivirusProduct')</code> <br> <br><img src="https://habrastorage.org/webt/wb/xv/tv/wbxvtvcwmxo9w45kjramkqmcy-s.png"><br>  <i>Figure 3. The process of determining antivirus products.</i> <br><br>  In addition, the malware checks to see if <a href="https://ccw.e-paths.com/">CryptoClipWatcher</a> is <a href="https://ccw.e-paths.com/">running</a> , the anti-clipboard protection tool, and, if it is running, suspends all threads of this process, thereby turning off the protection. <br><br><h4>  Persistence </h4><br>  The malware version we studied copies itself to <code>%APPDATA%\google\updater.exe</code> and sets the ‚Äúhidden‚Äù attribute for the google directory.  Then it changes the value of <code>Software\Microsoft\Windows NT\CurrentVersion\Winlogon\shell</code> in the Windows registry and adds the path <code>updater.exe</code> .  So the malware will run on every user login. <br><br><h4>  Malicious behavior </h4><br>  Like ClipBanker, the malware monitors the contents of the clipboard and searches for the addresses of cryptocurrency wallets, and upon detecting it, replaces it with one of the operator‚Äôs addresses.  Below is a list of target addresses based on that found in the code. <br><br> <code>BTC_P2PKH, BTC_P2SH, BTC_BECH32, BCH_P2PKH_CashAddr, BTC_GOLD, LTC_P2PKH, LTC_BECH32, LTC_P2SH_M, ETH_ERC20, XMR, DCR, XRP, DOGE, DASH, ZEC_T_ADDR, ZEC_Z_ADDR, STELLAR, NEO, ADA, IOTA, NANO_1, NANO_3, BANANO_1, BANANO_3, STRATIS, NIOBIO, LISK, QTUM, WMZ, WMX, WME, VERTCOIN, TRON, TEZOS, QIWI_ID, YANDEX_ID, NAMECOIN, B58_PRIVATEKEY, STEAM_URL</code> <br> <br>  For each type of address there is a corresponding regular expression.  The STEAM_URL value is used to attack the Steam system, as can be seen from the regular expression, which is used to determine in the buffer: <br><br> <code>\b(https:\/\/|http:\/\/|)steamcommunity\.com\/tradeoffer\/new\/\?partner=[0-9]+&amp;token=[a-zA-Z0-9]+\b</code> <br> <br><h4>  Exfiltration channel </h4><br>  In addition to replacing the addresses in the buffer, the malware is aimed at closed Bitcoin WIF keys, Bitcoin Core and Electrum Bitcoin wallets.  The program uses plogger.org as an exfiltration channel for obtaining a WIF private key.  To do this, operators add the private key data to the HTTP User-Agent header, as shown below. <br><br><img src="https://habrastorage.org/webt/fz/xc/us/fzxcusdwmjnv8irew2lhlnlg7ss.png"><br>  <i>Figure 4. IP Logger Console with displayed data.</i> <br><br>  Operators did not use iplogger.org for exfiltration of wallets.  They probably resorted to another method due to the 255-character limit in the <code>User-Agent</code> field displayed in the IP Logger web interface.  In the samples we studied, another server for outputting data was stored in the <code>DiscordWebHook</code> environment <code>DiscordWebHook</code> .  Surprisingly, this environment variable is not assigned anywhere in the code.  This suggests that the malware is still under development, and the variable is assigned to the test machine of the operator. <br><br>  There is another sign that the program is in development.  The binary file includes two URLs iplogger.org, and a request is sent to both of them when exfiltering the data.  In a request to one of these URLs, the value in the Referer field is preceded by ‚ÄúDEV /‚Äù.  We also found a version that was not packaged with ConfuserEx, the recipient for this URL is called DevFeedbackUrl.  Based on the name of the environment variable, we believe that operators are planning to use the legitimate service Discord and its web-based interception system to steal cryptocurrency wallets. <br><br><h2>  Conclusion </h2><br>  This campaign is an example of the use of legitimate advertising services in cyber attacks.  The scheme is aimed at Russian organizations, but we would not be surprised to see such an attack using non-Russian services.  To avoid compromise, users must be confident in the reputation of the source of downloaded software. <br><br>  A full list of compromise indicators and MITER ATT &amp; CK attributes is available <a href="https://www.welivesecurity.com/2019/04/30/buhtrap-backdoor-ransomware-advertising-platform/">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/450126/">https://habr.com/ru/post/450126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450114/index.html">That we implemented in EWM thanks to your advice</a></li>
<li><a href="../450116/index.html">Operating Systems: Three Easy Pieces. Part 5: Planning: Multi-Level Feedback Queue (translation)</a></li>
<li><a href="../450118/index.html">Stream the screen to multiple devices over the network</a></li>
<li><a href="../450122/index.html">Startup Digest: Genetics (January - March 2019)</a></li>
<li><a href="../450124/index.html">Set up the Strava heatmap layer in OsmAnd</a></li>
<li><a href="../450128/index.html">Using Minolta AF optics (Sony A-mount) on modern mirrorless Sony cameras</a></li>
<li><a href="../45013/index.html">In garbage. In garbage? In garbage!</a></li>
<li><a href="../450130/index.html">Do teams survive after hackathon?</a></li>
<li><a href="../450132/index.html">Unable to explain monad</a></li>
<li><a href="../450134/index.html">The second life of the ring and brooches: how to quickly recreate jewelry using 3D technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>