<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>For all the answer! Consumer Driven Contracts through the eyes of a developer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we‚Äôll tell you about the problems that Consumer Driven Contracts solve, show how to use this using the example of Pact with Node.js a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>For all the answer! Consumer Driven Contracts through the eyes of a developer</h1><div class="post__text post__text-html js-mediator-article">  In this article, we‚Äôll tell you about the problems that Consumer Driven Contracts solve, show how to use this using the example of Pact with Node.js and Spring Boot.  And tell you about the limitations of this approach. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gu/vg/za/guvgzadja02vflw5bi8mgh_wbbo.png"></div><br><h2>  Problematics </h2><br>  When testing products, scenario tests are often used in which the integration of various system components on a dedicated environment is checked.  Such tests on live services give the most reliable results (not counting tests in battle).  But at the same time, they are among the most expensive. <br><a name="habracut"></a><br><ul><li>  It is often erroneously considered that the integration environment should not be fault tolerant.  SLA, guarantees for such environments are rarely spoken, but if it is not available, teams either have to delay releases, or hope for the best and go into battle without tests.  Although everyone knows that <a href="https://landing.google.com/sre/sre-book/chapters/introduction/">hope is not a strategy</a> .  And modern infrastructure technologies only complicate the work with integration environments. </li><li>  <b>Separate pain - work with test data</b> .  Many scenarios require a certain state of the system, fixture.  How close should they be to combat data?  How to bring them to the current state before the test and cleaned after completion? </li><li> <b>Tests are too unstable</b> .  And not only because of the infrastructure that we mentioned in the first paragraph.  The test may fall because the neighboring team has launched its checks, which broke the expected state of the system!  Many false negative checks, flaky tests end their lives in <code>@Ignored</code> .  Also, different parts of the integration can be supported by different teams.  They rolled out a new release candidate with errors - they broke all consumers.  Someone solves this problem with selected test circuits.  But at the cost of multiplying the cost of support. </li><li>  <b>Such tests take a lot of time</b> .  Even taking into account automation, the results can be expected for hours. </li><li>  And on top of that, if the test has really fairly dropped, it is far from always possible to immediately find the cause of the problem.  It can be hidden deep behind the layers of integrations.  Or it may be the result of an unexpected combination of states of multiple components of the system. </li></ul><br>  Stable tests in the integration environment require serious input from QA, dev, and even ops.  No wonder they are at the very top of the <a href="https://martinfowler.com/bliki/TestPyramid.html">test pyramid</a> .  Such tests are useful, but the economy of resources does not allow them to check everything.  The main source of their value is the environment. <br><br>  Below, for the same pyramid, there are other tests in which we exchange credibility for smaller support headaches - by means of isolation checks.  The granular, the smaller the scale of verification, the less dependent on the external environment.  At the very bottom of the pyramid are unit tests.  We check individual functions, classes, we operate not so much with business semantics, as with constructions of a concrete implementation.  These tests give quick feedback. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But as soon as we descend down the pyramid, we have to replace the environment with something.  There are stubs - as whole services, and individual entities of the programming language.  It is through stubs that we can test components in isolation.  But they also reduce the reliability of checks.  How to make sure that the stub gives the correct data?  How to ensure its quality? <br><br>  <b>The solution can be comprehensive documentation</b> that describes various scenarios and possible states of the system components.  But any formulations still leave freedom of interpretation.  Therefore, good documentation is a living artifact that is constantly being improved as the team understands the problem area.  How then to ensure compliance of stubs of documentation? <br><br>  On many projects, you can observe the situation when the same guys who were developing the artifact under test write stubs.  For example, mobile application developers make stubs for their tests themselves.  As a result, programmers can understand the documentation in their own way (which is completely normal), do the stub with the wrong expected behavior, write the code (with green tests) in accordance with it, and in real integration errors occur. <br><br>  Moreover, the documentation usually moves downstream - clients use service specs (while the service client may be another service).  It does not express <strong>how</strong> consumers use data, what data is generally needed, what assumptions they make for this data.  The consequence of such ignorance is the <a href="http://www.hyrumslaw.com/">law of Hyrum</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ek/bh/ho/ekbhhofe0ox95w50drdg8tybsbi.png" width="300"></div><br><br>  Hiram Wright has long been developing public sharing tools inside Google and observed how the slightest changes can cause damage to clients who used the implicit (undocumented) features of his libraries.  This hidden connectivity complicates the evolution of the API. <br><br>  These problems can be solved to some extent by using Consumer Driven Contracts.  Like any approach and tool, it has a field of applicability and cost, which we also consider.  Implementations of this approach have reached a sufficient level of maturity to try on their projects. <br><br><h2>  What is a CDC? </h2><br>  Three key elements: <br><br><ul><li>  <b>Contract</b>  Described using some DSL, implementation dependent.  It contains the description of the API in the form of interaction scenarios: if a certain request arrives, the client should receive a definite answer. </li><li>  <b>Customer tests</b> .  And they use a stub, which is automatically formed from the contract. </li><li>  <b>Tests for API</b> .  They are also generated from the contract. </li></ul><br>  Thus, the contract is executable.  And the main feature of the approach is that the requirements for the behavior of the API go <b>upstream</b> , from client to server. <br><br>  The contract focuses on the behavior that is <strong>really</strong> important to the consumer.  Makes explicit its assumptions regarding the API. <br><br>  The main task of the CDC is to bring together an understanding of the behavior of the API by its developers and the developers of its clients.  This approach is well combined with BDD, at <a href="https://habr.com/ru/company/tinkoff/blog/449424/">meetings of three amigos,</a> you can throw blanks for a contract.  Ultimately, this contract also serves to improve communications;  sharing a common understanding of the problem area and implementing solutions within and between teams. <br><br><h2>  Pact </h2><br>  Consider the use of CDC on the example of Pact, one of its implementation.  Suppose we make a web application for conference participants.  In the next iteration, the team develops a display of the schedule of speeches - so far without any stories like voting or notes, only the output of a grid of reports.  Sample sources are <a href="https://github.com/Nasyalnik/pact-example">here</a> . <br><br>  At the meeting of <s>three and</s> four amigo there are product, tester, backend and mobile application developers.  They pronounce that <br><br><ul><li>  The UI will display a list with the text: Report title + Speakers + Date and time. </li><li>  For this, the backend must return data as in the example below. </li></ul><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"talks"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"      "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"speakers"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-05-27T12:00:00+03:00"</span></span> } ] }</code> </pre> <br>  After that, the frontend developer goes to write client code (backend for frontend).  He sets up a library for working with a pact contract in the project: <br><br><pre> <code class="bash hljs">yarn add --dev @pact-foundation/pact</code> </pre> <br>  And he begins to write a test.  It configures the local server stubs, which will simulate the work of the service with the schedule of reports: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> provider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pact({ <span class="hljs-comment"><span class="hljs-comment">//      consumer: "schedule-consumer", provider: "schedule-producer", // ,     port: pactServerPort, //  pact     log: path.resolve(process.cwd(), "logs", "pact.log"), // ,     dir: path.resolve(process.cwd(), "pacts"), logLevel: "WARN", //  DSL  spec: 2 });</span></span></code> </pre> <br>  The contract is a JSON file that describes scenarios of client interaction with the service.  But it is not necessary to describe it manually, since it is formed from the settings of the stub in the code.  The developer before the test describes the following behavior. <br><br><pre> <code class="javascript hljs">provider.setup().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> provider .addInteraction({ <span class="hljs-attr"><span class="hljs-attr">uponReceiving</span></span>: <span class="hljs-string"><span class="hljs-string">"a request for schedule"</span></span>, <span class="hljs-attr"><span class="hljs-attr">withRequest</span></span>: { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">"/schedule"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">willRespondWith</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json;charset=UTF-8"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: { <span class="hljs-attr"><span class="hljs-attr">talks</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"      "</span></span>, <span class="hljs-attr"><span class="hljs-attr">speakers</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">time</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-05-27T12:00:00+03:00"</span></span> } ] } } }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> done()) );</code> </pre> <br>  Here in the example we specified a specific expected request to the service, but pact-js also supports <a href="https://github.com/pact-foundation/pact-js">several ways to determine matches</a> . <br><br>  Finally, the programmer writes a test of the part of the code that uses this stub.  In the following example, we will call it directly for simplicity. <br><br><pre> <code class="javascript hljs">it(<span class="hljs-string"><span class="hljs-string">"fetches schedule"</span></span>, done =&gt; { fetch(<span class="hljs-string"><span class="hljs-string">`http://localhost:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pactServerPort}</span></span></span><span class="hljs-string">/schedule`</span></span>) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> response.json()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">json</span></span></span><span class="hljs-function"> =&gt;</span></span> expect(json).toStrictEqual({ <span class="hljs-attr"><span class="hljs-attr">talks</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"      "</span></span>, <span class="hljs-attr"><span class="hljs-attr">speakers</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">time</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-05-27T12:00:00+03:00"</span></span> } ] })) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> done()); });</code> </pre> <br>  In a real project, this can be either a quick unit test of a separate response interpretation function, or a slow UI test for displaying the data received from the service. <br><br>  During the test run, pact checks that the stub received the query specified in the tests.  The discrepancies can be viewed as diff in the pact.log file. <br><br><pre> <code class="plaintext hljs">E, [2019-05-21T01:01:55.810194 #78394] ERROR -- : Diff with interaction: "a request for schedule" Diff -------------------------------------- Key: - is expected + is actual Matching keys and values are not shown { "headers": { - "Accept": "application/json" + "Accept": "*/*" } } Description of differences -------------------------------------- * Expected "application/json" but got "*/*" at $.headers.Accept</code> </pre> <br><br>  If the test is successful, then the contract is formed in JSON format.  It describes the expected behavior of the API. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"consumer"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"schedule-consumer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"provider"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"schedule-producer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"interactions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"a request for schedule"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/schedule"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"headers"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Accept"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"headers"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json;charset=UTF-8"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"talks"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"      "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"speakers"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-05-27T12:00:00+03:00"</span></span> } ] }}} ], <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"pactSpecification"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0.0"</span></span> } } }</code> </pre> <br>  He gives this contract to the backend developer.  Let's say the API will be on Spring Boot.  Pact has a <a href="https://github.com/DiUS/pact-jvm/tree/master/pact-jvm-provider-spring">pact-jvm-provider-spring</a> library that can work with MockMVC.  But we will look at Spring Cloud Contract, which implements the CDC in the Spring ecosystem.  It uses its own contract format, but also has an extension point for connecting converters from other formats.  Its native contract format is supported only by the Spring Cloud Contract itself - unlike Pact, which has libraries for JVM, Ruby, JS, Go, Python, etc. <br><br>  Suppose in our example the backend developer uses Gradle to build the service.  It connects the following dependencies: <br><br><pre> <code class="plaintext hljs">buildscript { // ... dependencies { classpath "org.springframework.cloud:spring-cloud-contract-pact:2.1.1.RELEASE" } } plugins { id "org.springframework.cloud.contract" version "2.1.1.RELEASE" // ... } // ... dependencies { // ... testImplementation 'org.springframework.cloud:spring-cloud-starter-contract-verifier' }</code> </pre> <br>  And puts the pact contract received from the floender into the <code>src/test/resources/contracts</code> directory. <br><br>  From it, the default plugin spring-cloud-contract reads contracts.  When building, the gradle-task of generateContractTests is executed, which generates the following test in the build / generated-test-sources directory. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractVerifierTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractsBaseTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate_aggregator_client_aggregator_service</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// given: MockMvcRequestSpecification request = given() .header("Accept", "application/json"); // when: ResponseOptions response = given().spec(request) .get("/scheduler"); // then: assertThat(response.statusCode()).isEqualTo(200); assertThat(response.header("Content-Type")).isEqualTo("application/json;charset=UTF-8"); // and: DocumentContext parsedJson = JsonPath.parse(response.getBody().asString()); assertThatJson(parsedJson).array("['talks']").array("['speakers']").contains("['name']").isEqualTo( /*...*/ ); assertThatJson(parsedJson).array("['talks']").contains("['time']").isEqualTo( /*...*/ ); assertThatJson(parsedJson).array("['talks']").contains("['title']").isEqualTo( /*...*/ ); } }</span></span></code> </pre> <br><br>  When you run this test, we will see an error: <br><br><pre> <code class="plaintext hljs">java.lang.IllegalStateException: You haven't configured a MockMVC instance. You can do this statically</code> </pre> <br>  Since we can use different tools for testing, we need to tell the plugin which one we have configured.  This is done through a base class that tests generated from contracts will inherit. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractsBaseTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ScheduleController scheduleController = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScheduleController(); <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RestAssuredMockMvc.standaloneSetup(scheduleController); } }</code> </pre> <br><br>  In order for this base class to be used when generating, you need to tune the spring-cloud-contract gradle-plugin. <br><br><pre> <code class="plaintext hljs">contracts { baseClassForTests = 'ru.example.schedule.ContractsBaseTest' }</code> </pre> <br><br>  Now we have generated such a test: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractVerifierTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractsBaseTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate_aggregator_client_aggregator_service</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... } }</span></span></code> </pre> <br>  The test runs successfully, but ends with a validation error ‚Äî the developer has not yet written the implementation of the service.  But he can now do it, relying on the contract.  He can make sure that he is able to process the client‚Äôs request and return the expected response. <br><br>  The developer of the service knows through the contract what he needs to do, what behavior to implement. <br><br>  Pact can be integrated deeper into the development process.  You can deploy Pact-broker, which aggregates such contracts, supports their versioning and can show a dependency graph. <br><br><img src="https://habrastorage.org/webt/dq/pd/v0/dqpdv0c4qk89kboewjxrafys1iq.png"><br><br>  Downloading the newly generated contract to the broker can be done with a CI step when building the client.  And in the server code specify the dynamic loading of the contract by URL.  Spring Cloud Contract it also supports. <br><br><h2>  Applicability CDC </h2><br>  What are the limitations of Consumer Driven Contracts? <br><br>  You <b>have to pay</b> for using this approach <b>with additional tools</b> like pact.  Contracts themselves are an additional artifact, another abstraction that needs to be carefully maintained, consciously applied engineering practices to it. <br><br>  <b>They do not replace e2e tests</b> , since the stubs still remain stubs - models of the real components of the system, which may slightly, but do not correspond to reality.  Through them do not check the complex scenarios. <br><br>  Also, <b>CDCs do not replace API functional tests</b> .  They are more expensive to maintain than Plain Old Unit Tests.  Pact developers recommend using the following heuristics - if you remove the contract and it does not cause errors or misinterpretation by the client, it means that it is not needed.  For example, it is not necessary to describe absolutely all API error codes through a contract if the client processes them in the same way.  In other words, the contract describes for the service <strong>only what is important to his client</strong> .  Not more, but not less. <br><br>  Too many contracts also complicate the evolution of the API.  <b>Each additional contract is a reason for red tests</b> .  It is necessary to design the CDC so that each fail test carries a useful semantic load that outweighs the cost of supporting it.  For example, if the contract fix the minimum length of a text field, which is indifferent to the consumer (he uses the <a href="https://www.martinfowler.com/bliki/TolerantReader.html">Toleran Reader</a> technique), then each change in this minimum value will break the contract and the nerves of others.  This check needs to be transferred to the level of the API itself and implemented depending on the source of the restrictions. <br><br><h2>  Conclusion </h2><br>  CDC improves product quality by explicitly describing integration behavior.  It helps customer and service developers to achieve a common understanding, allows you to talk through code.  But it does this at the cost of adding tools, introducing new abstractions and additional actions of team members. <br><br>  At the same time, CDC tools and frameworks are being actively developed and have already reached maturity for testing on your projects.  Test :) <br><br><blockquote>  At the <a href="http://qualityconf.ru/2019">QualityConf</a> conference on May 27-28, Andrei Markelov <a href="https://ritfest.ru/2019/abstracts/5167">will talk</a> about testing equipment for the sale, and Arthur Khineltsev <a href="https://ritfest.ru/2019/abstracts/5167">will tell you</a> about <a href="https://ritfest.ru/2019/abstracts/5284">monitoring a</a> heavily loaded front end when the price of even a small mistake is tens of thousands of sad users. <br><br>  Come chat for quality! </blockquote></div><p>Source: <a href="https://habr.com/ru/post/452960/">https://habr.com/ru/post/452960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452944/index.html">What will be the ‚ÄúDialogue‚Äù of linguists and data analyst</a></li>
<li><a href="../452946/index.html">Rereading Lou Greenzaw "The philosophy of programming Windows 95 / NT"</a></li>
<li><a href="../452954/index.html">Build time, network speed and routing: how we improved our mesh network and a little about neural networks</a></li>
<li><a href="../452958/index.html">JMAP - open protocol will replace IMAP when exchanging emails</a></li>
<li><a href="../45296/index.html">Reset Styles Using CSS Reset</a></li>
<li><a href="../452962/index.html">The main cause of accidents in data centers - laying between the computer and the chair</a></li>
<li><a href="../452966/index.html">The mindfulness myth: a ‚Äúneurocentric‚Äù view of meditation</a></li>
<li><a href="../452974/index.html">Asynchronous programming (full course)</a></li>
<li><a href="../452980/index.html">ARM CBD-N - Day X will come soon, who did not prepare himself to blame</a></li>
<li><a href="../452982/index.html">Easy integration of MS Project and Redmine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>