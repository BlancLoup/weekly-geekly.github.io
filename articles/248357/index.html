<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PLC100 + LabVIEW + joystick</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once on my desktop there was a usb-joystick and a PLC (programmable logic controller) of the firm ARIES-PLC100, while the LabVIEW environment was runn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PLC100 + LabVIEW + joystick</h1><div class="post__text post__text-html js-mediator-article">  Once on my desktop there was a usb-joystick and a PLC (programmable logic controller) of the firm ARIES-PLC100, while the LabVIEW environment was running on the computer.  I thought that all this - at least for fun - can be combined by organizing the control of the PLC (its outputs) using the joystick buttons (later I decided to use not just buttons, but their combinations - DOWN, FORWARD, Y, for example). <br><a name="habracut"></a><br>  So, how it all works.  LabVIEW processes the joystick keystroke and transmits the keystroke information to the PLC100 (in this case, via the serial port);  PLC100, in accordance with the program loaded into it, reacts to certain key combinations by turning on / off its outputs. <br><br><img src="https://habrastorage.org/files/579/920/8b7/5799208b79ce41c8b8dfe9f20598a12c.jpg" alt="image"><br><br><h4>  LabVIEW part </h4><br>  The program that handles the pressing of the joystick buttons and transmits information about them to the PLC100, in general, looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/69e/704/5b9/69e7045b98114a29ac276a41f6d3d1b9.jpg" alt="image"><br><br>  Now in more detail. <br>  1 - Initialize the joystick.  You can find it in the Function Palette in the Connectivity-&gt; Input Device Control section.  If one joystick is connected to the computer, as in my case, it is recommended to equate the Device Index parameter to 0. <br>  2 - Receive data from the input device.  The data on the buttons and axes directions (cross) is stored in clusters, which with the help of the Unbundle function must be broken down into elements in order to process them in the future.  The ‚Äúbutton‚Äù cluster 3 (in the figure it is already broken into elements) consists of boolean elements;  when the button is pressed, the corresponding cluster element is set to TRUE.  With the ‚Äúaxial‚Äù cluster 4, the situation is slightly different: it consists of integer elements, and when the UP key is pressed, the first element of the cluster, X axis, takes the value -32768, the DOWN key corresponds to 32767. With the second element of the cluster, Y axis ‚Äî approximately also: BACK = -32768, FORWARD = 32767. <br>  5 - Forming a string.  The Format Into String function forms (or returns) a string from elements of different data types.  In my case, these are Boolean elements and there are only 8 of them, so the output will be a string of 8 characters.  An explanation is required here: if no button is pressed, the line has the form "00000000";  if, for example, the button 1 is pressed, the line will be such ‚Äú1000000‚Äù, if the button is 2, then such ‚Äú01000000‚Äù, etc.  Depending on the value of this string, a specific number will be written to the serial port, which will already process the PLC100.  By the way, the ‚Äúformat string‚Äù parameter of the Format Into String function is set to ‚Äú% d% d% d% d% d% d% d% d‚Äù to convert the input boolean FALSE and TRUE to zeros and ones and eventually get a string like for example, ‚Äú10,000,000‚Äù, not ‚ÄúTRUEFALSEFALSEFALSE ...‚Äù.  Like this.  Can it be easier?  It is possible, but at another time. <br>  6 - Configuring and opening the serial port.  I left all the default settings, adding only the control to select the port number.  To work with a COM port, NI-VISA must be installed (here <a href="http://www.ni.com/download/ni-visa-5.4.1/4626/en/">www.ni.com/download/ni-visa-5.4.1/4626/en</a> ). <br>  7 - Case structure.  Depending on the value of the string formed by the Format Into String function, it writes a number to the serial port (11, for example, corresponds to button 1, 12 to button 2, etc.).  This number is previously converted by the Number To Decimal String function - figure 8 in the figure (without this block, for some unknown reason, PLC100 read some kind of gibberish from the port). <br><br><h4>  PLC program </h4><br>  A little about the ports of the PLC100.  As many as three connectors can work as a COM port: these are Debug-232 on the front panel, RS-232 and RS-485 below.  When opening the port, you will need to specify its number: for Debug-232 it is 4, for RS-232 - 1, for RS-485 - 0. I used RS-485, connecting the PLC to the computer via a cheap Chinese RS-485 adapter -&gt; USB (on the photo), respectively, in the program as the port number is 0. <br><br><img src="https://habrastorage.org/files/5ea/657/a3a/5ea657a3a4aa4ffbbf97127be5c7f368.jpg"><br><br>  PLC100 is programmed in the Codesys 2.3 environment.  In addition, you need the so-called target - something like a file with a description of the configuration of the programmable device.  To initialize and open the port, I used the ComService.lib library (the library and an example of it can be downloaded here <a href="http://www.owen.ru/forum/showthread.php%3Ft%3D551%26page%3D6">www.owen.ru/forum/showthread.php?t=551&amp;page=6</a> ).  I combined the configuration and opening of the port in one functional block - see the figure below. <br><br><img src="https://habrastorage.org/files/951/e24/b3c/951e24b3cdd642459bc0a05872235734.jpg"><br><br>  You can see that the 'set' object is declared as COMSETTINGS.  This is an instance of the COMSETTINGS structure containing the port settings;  it is already declared in the ComService library (to be exact, in the SysComLib library, which is part of the ComService).  The settings are fairly standard, just turn to set. Port = 0 - this is RS-485, which was mentioned above. <br><br>  The COM_SERVICE function block has two parameters: the first is the name of the COMSETTINGS structure, the second is the type of operation, where 0 corresponds to the setting and opening. <br><br>  Next, using the SysComRead function, included in the SysLibCom library, we read the data from the port.  DwHandle is the port number (RS-485 in this case), dwBufferAddress is a pointer to the variable where the data will be read, dwBytesToRead is the number of bytes read (in my case it is 2), dwTimeout is the time in ms, after which the function must complete;  if you put too little, the function simply does not read anything. <br><br><img src="https://habrastorage.org/files/90f/fa8/c6f/90ffa8c6f6a5433bae4c7f96152fb9f6.jpg"><br><br>  Next comes the conversion of the string read from the port into an integer and the comparison of this number: if it is, for example, 10, then no button is pressed, if 11, then X is pressed, etc. <br><br>  To process the key combinations, I programmed 6 function blocks - 3 to switch on the first three relay outputs of the PLC (I think three outputs will be enough for the beginning) and 3 to turn them off;  Four combinations of 3 keys and two of 4.  Inside these blocks look like this: <br><br><img src="https://habrastorage.org/files/005/436/3ec/0054363ecb13453cba383e6b8b6b7415.jpg"><br><br>  i1, i2, i3 are the first, second and third buttons of the combination, respectively.  The functional block for a four-button combination is not much different, and getting it from a three-button is a matter of technique, so I omit its content. <br>  It should be added that for each functional block I announced my own copies of the R_TRIG, TON and TOF blocks, because all three outputs would react to one combination.  But for the units on and off the same output, I left them the same. <br><br>  As a result, the program I looked like (I miss the place with the opening of the port): <br><br><img src="https://habrastorage.org/files/1bf/b11/1be/1bfb111be4204e928cf83a5fae291e61.jpg"><br><br>  The video shows how the LEDs light up on the PLC, indicating that the output is active.  For clarity, I would like as a load to connect to the outputs at least a light bulb or starter, but at the time of recording video at hand there was only a computer cooler. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/92sghYFbIAY%3Ffeature%3Doembed&amp;xid=25657,15700022,15700186,15700191,15700253&amp;usg=ALkJrhiFihgx0nYixJ1Tv72EWGvlm4FgZw" frameborder="0" allowfullscreen=""></iframe><br><br>  I must say that the whole system (I say ‚Äúsystem‚Äù, because I don‚Äôt know exactly where the ‚Äújam‚Äù was) to the quick clicks, reacted rather reluctantly, if at all;  unhurried clicks (like in the video) improve the situation a little, but sometimes the reaction to them was absent.  But the PLC100 also has an Ethernet connector.  So next time I will try to make at least a small improvement by linking the PLC to LabVIEW via an OPC server via Ethernet. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/248357/">https://habr.com/ru/post/248357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248341/index.html">Kevin Hale: The Subtleties of User Experience (Part 2)</a></li>
<li><a href="../248343/index.html">PCI DSS Virtualization Guide. Part 3</a></li>
<li><a href="../248345/index.html">How to sell Fortune 500 to the state and other terrible organizations</a></li>
<li><a href="../248351/index.html">Not all antiviruses are equally useful: Sergey Gordeychik and Vladimir Kropotov webinar</a></li>
<li><a href="../248353/index.html">Incremental backup on the fly using Quick Backup - a new feature of Veeam Backup & Replication v8</a></li>
<li><a href="../248359/index.html">Once again about Hyper-Threading</a></li>
<li><a href="../248369/index.html">LinkMeUp. Issue number 23. Compass-EOS - the first router with optical switching within the board</a></li>
<li><a href="../248371/index.html">Unity3D - crossfade, the basics of working with sound (lesson)</a></li>
<li><a href="../248373/index.html">Android launchers. Three developer mistakes</a></li>
<li><a href="../248377/index.html">Handling custom gestures for Leap Motion. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>