<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My version of .htaccess</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In one of the previous thematic posts about .htaccess for noobs, I wanted to offer my version with different treatments and prohibitions, well, a cert...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My version of .htaccess</h1><div class="post__text post__text-html js-mediator-article">  In one of the previous <a href="http://habrahabr.ru/post/140693/">thematic posts</a> about .htaccess for noobs, I wanted to offer my version with different treatments and prohibitions, well, a certain structuring logic, but since karma was in the red, I am posting now. <br><br>  To your attention, I look at the rules for processing URLs with explanations and comments "why so?". <br><br><h4>  First logic </h4><br>  I will explain the logic first: <br>  1) All pages have .html endings. <br>  2) all languages ‚Äã‚Äãfor pages have the form pagename.en.html or pagename.html for the default language.  No one, of course, forbids having links where the language first comes as / en / <br>  3) there is only one ‚Äúinput‚Äù script in docroot. <br>  4) Allow requests to other scripts only in docroot <br>  5) Agreement on the definition of endings in url: <br>  # site.com/ <br>  # site.com/index -&gt; site.com/ <br>  # site.com -&gt; site.com/ <br>  # site.com/file/ -&gt; site.com/file.html <br>  # site.com/file -&gt; site.com/file.html <br>  # site.com/dir/file -&gt; site.com/dir/file.html <br>  # site.com/dir/file/ -&gt; site.com/dir/file.html <br>  But it can be changed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  .Htaccess structure </h4><br>  Now let's move on to the .htaccess structure itself.  I also note that it will only work for Apaches versions 2.x and later. <br><br>  First, the complete code: <br><pre><code class="hljs mel">DirectoryIndex index index.html DirectorySlash off Options -Indexes -MultiViews # Rules # site.com/ # site.com/index -&gt; site.com # site.com -&gt; site.com/ # site.com/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>/ -&gt; site.com/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>.html # site.com/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> -&gt; site.com/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>.html # site.com/dir/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> -&gt;site.com/dir/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>.html # site.com/dir/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>/ -&gt; site.com/dir/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>.html # no ending slashes RewriteEngine On RewriteBase / RewriteCond %{REQUEST_URI} \.(css|jpg|gif|png|zip|rar|doc|xls|js|tif|tiff|docx|xlsx|ico)$|test\.php$ RewriteRule ^(.*)$ $1 [L,QSA] # nothing to <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> subrequests RewriteCond %{ENV:NS} !=<span class="hljs-number"><span class="hljs-number">1</span></span> RewriteCond %{IS_SUBREQ} =true RewriteRule (.*) $1 [L,QSA] #<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> NS=<span class="hljs-number"><span class="hljs-number">0</span></span>? RewriteCond %{REQUEST_URI} ^/index$ [OR] RewriteCond %{REQUEST_URI} ^/index[.]+(\w+)$ RewriteRule . / [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L] # remove trailing slashes # <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> want external redirect use correct external redir [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L] or [R=<span class="hljs-number"><span class="hljs-number">301</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> correct internal or simple redir [L] RewriteCond %{REQUEST_URI} !^/$ RewriteCond %{REQUEST_URI} (.*)/$ RewriteRule . %1.html [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L,E=NS:<span class="hljs-number"><span class="hljs-number">1</span></span>,QSA] # <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> whants .html endings RewriteCond %{REQUEST_URI} !^(.+)\.(html|php)$ RewriteRule . %{REQUEST_URI}.html [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L] # fix multidots <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> endings (missed language) index..html instead of index.en.html RewriteCond %{REQUEST_URI} ^(.+)\.\.+(\w+)$ RewriteRule . %1.%2 [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L] # otherways #RewriteCond %{REQUEST_URI} (.+)\.(html|php)$ # RewriteRule . %1 [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L] # any php filename <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root dir # this makes secure loses RewriteCond %{REQUEST_URI} ^[\w\-.]+$ RewriteCond %{REQUEST_FILENAME} (.*)\.(html|php)$ RewriteCond %1.php -s [OR] RewriteCond %1.html -s RewriteRule . %1.%2 [L,QSA] RewriteRule (.*) entry.php?URI=$1 [L,QSA] #</code> </pre> <br><br><h4>  Debriefing </h4><br>  Now, we will analyze line by line. <br><br><pre> <code class="hljs pgsql">DirectoryIndex <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html DirectorySlash <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> -Indexes -MultiViews</code> </pre> <br>  Immediately an important point: the automatic substitution of the slash to the end is turned off and MultiViews is turned off (it will not work with it). <br><br><pre> <code class="hljs ruby">RewriteEngine On RewriteBase / RewriteCond <span class="hljs-string"><span class="hljs-string">%{REQUEST_URI}</span></span> \.(css<span class="hljs-params"><span class="hljs-params">|jpg|</span></span>gif<span class="hljs-params"><span class="hljs-params">|png|</span></span>zip<span class="hljs-params"><span class="hljs-params">|rar|</span></span>doc<span class="hljs-params"><span class="hljs-params">|xls|</span></span>js<span class="hljs-params"><span class="hljs-params">|tif|</span></span>tiff<span class="hljs-params"><span class="hljs-params">|docx|</span></span>xlsx<span class="hljs-params"><span class="hljs-params">|ico)$|</span></span>test\.php$ RewriteRule ^(.*)$ $1 [L,QSA]</code> </pre> <br><br>  The third line checks for static files - we skip them without changing the request.  Perhaps it would be worthwhile to check for the presence of a file, but let's leave this case to the 404 mechanism. The last <code>|test\.php$</code> is made for various test files, but in the production this case should be removed. <br><br><pre> <code class="hljs pgsql"># <span class="hljs-keyword"><span class="hljs-keyword">nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> subrequests RewriteCond %{ENV:NS} !=<span class="hljs-number"><span class="hljs-number">1</span></span> RewriteCond %{IS_SUBREQ} =<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> RewriteRule (.*) <span class="hljs-meta"><span class="hljs-meta">$1</span></span> [L,QSA] #<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> NS=<span class="hljs-number"><span class="hljs-number">0</span></span>?</code> </pre> <br>  The most important part is because the extensions are being converted (hereinafter referred to as code), the script will always go to the subquery and may go to an infinite loop.  To prevent this from happening, we catch the beginning of the subqueries and send the current request to the URL to the already corrected ‚Äúinput‚Äù script.  This can be viewed by turning on rewrite_log in Apache. <br><br><pre> <code class="hljs pgsql">RewriteCond %{REQUEST_URI} ^/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>$ [<span class="hljs-keyword"><span class="hljs-keyword">OR</span></span>] RewriteCond %{REQUEST_URI} ^/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>[.]+(\w+)$ RewriteRule . / [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L]</code> </pre> <br>  All attempts to get to `/ index 'or` index.html' will be redirected to the URL `/ '. <br><br><pre> <code class="hljs pgsql"># remove <span class="hljs-keyword"><span class="hljs-keyword">trailing</span></span> slashes # <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> want <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> redirect use correct <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> redir [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L] <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> [R=<span class="hljs-number"><span class="hljs-number">301</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> correct <span class="hljs-type"><span class="hljs-type">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> simple redir [L] RewriteCond %{REQUEST_URI} !^/$ RewriteCond %{REQUEST_URI} (.*)/$ RewriteRule . %<span class="hljs-number"><span class="hljs-number">1.</span></span>html [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L,E=NS:<span class="hljs-number"><span class="hljs-number">1</span></span>,QSA]</code> </pre> <br>  Solves one of the parts of the ‚Äúagreement‚Äù: removes the trailing `/ 'from referring to the pages.  The rules are described in paragraph (5) at the beginning.  The comment says that if we want to use external redirect (changing the url in the browser string), then use <code>[R=301,L]</code> , if internal (change the url in the browser string), then <code>[R=301]</code> or <code>[L]</code> <br><br><pre> <code class="hljs mel"># <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> whants .html endings RewriteCond %{REQUEST_URI} !^(.+)\.(html|php)$ RewriteRule . %{REQUEST_URI}.html [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L]</code> </pre> <br>  Decides another part of the "agreement" that all requests for pages must have the ending .html.  Small manipulations can do the opposite. <br><br><pre> <code class="hljs pgsql"># fix multidots <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> endings (missed <span class="hljs-keyword"><span class="hljs-keyword">language</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>..html <span class="hljs-keyword"><span class="hljs-keyword">instead</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.en.html RewriteCond %{REQUEST_URI} ^(.+)\.\.+(\w+)$ RewriteRule . %<span class="hljs-number"><span class="hljs-number">1.</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span> [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L]</code> </pre> <br>  Solves the problem of missing language in the query string by redirecting to the page with the default language. <br><br><pre> <code class="hljs mel"># any php filename <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root dir # this makes secure loses RewriteCond %{REQUEST_URI} ^[\w\-.]+$ RewriteCond %{REQUEST_FILENAME} (.*)\.(html|php)$ RewriteCond %1.php -s [OR] RewriteCond %1.html -s RewriteRule . %1.%2 [L,QSA]</code> </pre> <br>  Solves part of the agreement number 4 - allows requests to other php / html files in the% DOCUMENT_ROOT% folder of the site. <br><br><pre> <code class="hljs apache"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span></span></span> (.*) entry.php?URI=<span class="hljs-number"><span class="hljs-number">$1</span></span><span class="hljs-meta"><span class="hljs-meta"> [L,QSA]</span></span></code> </pre> <br>  If everything is as it should, then send a request to the "input" script. <br><br><h4>  miscellanea </h4><br>  As for the Apache flags: QSA is used everywhere (to complete the query string) - you can not forget about this, so as not to lose the parameters.  <code>E=NS:1</code> sets the environment variable NS to 1 ‚Äî needed to define a subquery (the subquery created by the transformation rules by ‚Äúagreement‚Äù, and not by any other subquery). </div><p>Source: <a href="https://habr.com/ru/post/141424/">https://habr.com/ru/post/141424/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141418/index.html">We invite you to the webinar on April 7: Website as a tool for business</a></li>
<li><a href="../141419/index.html">JavaFX Scene Builder Developer Preview</a></li>
<li><a href="../141420/index.html">Lenovo laptops: what is expected in 2012?</a></li>
<li><a href="../141421/index.html">Doctor Web discovered a botnet from over 550,000 Macs</a></li>
<li><a href="../141422/index.html">Project Glass - Future points from Google or "feel like a terminator"</a></li>
<li><a href="../141425/index.html">Forget everything you knew about banners</a></li>
<li><a href="../141426/index.html">Go for IT. Part one</a></li>
<li><a href="../141427/index.html">I'm Feeling Lucky in Standard Browser Search</a></li>
<li><a href="../141430/index.html">Version 4.0 - Creative Commons License Draft Ready for Public Comment</a></li>
<li><a href="../141431/index.html">The accident on the cellular network Vodafone in the Netherlands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>