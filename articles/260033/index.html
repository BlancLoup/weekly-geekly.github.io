<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Is it true that Go is faster than Ruby?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The last few years I have been creating games for social networks. As a back-end, I use a bunch of Ruby + Sinatra + Redis. Redis is used as the only d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Is it true that Go is faster than Ruby?</h1><div class="post__text post__text-html js-mediator-article">  The last few years I have been creating games for social networks.  As a back-end, I use a bunch of Ruby + Sinatra + Redis.  Redis is used as the only database.  The performance of one Redis database is often not enough, so a cluster of several databases is used.  More details about how the solution was created as a cluster of Redis databases can be found in <a href="http://habrahabr.ru/post/214131/">this article</a> . <br><br>  Recently, the Go programming language is of great interest to me - too many buns its use is promised to the programmer.  It would be desirable to write back-end for new games on it, but the existing and debugged code base on Ruby prevents it. <br><br>  Therefore, I decided to move in small iterations and started by rewriting the microservices used in Go games. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  All microservices have a connection to the Redis databases.  Usually 8 Redis bases are used, where the game stores data. <br><br>  The string with the part of the query to Redis is converted using SHA-1 to a hexadecimal number.  Then the remainder of dividing this number by 8 is found. And depending on it, the data is written / read from the required database. <br><br>  The original ruby ‚Äã‚Äãversion, which I decided to rewrite to Go. <br><pre><code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">node0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer(<span class="hljs-string"><span class="hljs-string">'0x'</span></span>+Digest::SHA1.hexdigest(text))%<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br>  Unfortunately or fortunately, this approach to the forehead on Go did not work.  The resulting hexadecimal string was too large a number.  This number could not fit into int64 type. <br><br>  How to solve a problem? <br><br>  We have 8 bases and a hexadecimal number, from which we must take the remainder of the division by 8. <br><br>  Answer. <br><br>  <b>The first thing that comes to mind.</b>  We only need to know the last character of the hexadecimal number in order to calculate the remainder of dividing the whole number by 8. <br><br>  We can easily rewrite the solution in ruby ‚Äã‚Äãwith this in mind: <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">node1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span></span> s = Digest::SHA1.hexdigest(text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer(<span class="hljs-string"><span class="hljs-string">'0x'</span></span>+s[s.size-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) % <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  The same, but on Go: <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">node1</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int64</span></span></span></span> { h := sha1.New() h.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(text)) sha1_hash := hex.EncodeToString(h.Sum(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) sha1_hash_len := <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(sha1_hash) last := sha1_hash[sha1_hash_len<span class="hljs-number"><span class="hljs-number">-1</span></span>:sha1_hash_len] value, _ := strconv.ParseInt(last, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-comment"><span class="hljs-comment">//int64 return value % 8 }</span></span></code> </pre><br><br>  <b>The second thing that turned out to be successful</b> <br><br>  In the process of writing the code presented above, it turned out that during the execution of SHA-1, Go represents a number as a set of decimal numbers, and then leads them to a hexadecimal view.  Since we need the remainder of the division, we can simply take the last decimal number instead of the hexadecimal last character and save on conversions from one number system to another. <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">node2</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int64</span></span></span></span> { h := sha1.New() h.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(text)) mas := h.Sum(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-comment"><span class="hljs-comment">// "hello world" -&gt; [42 174 108 53 201 79 207 180 21 219 233 95 64 139 156 233 30 232 70 237] return int64(mas[len(mas)-1]) % 8 //    .    .       8 }</span></span></code> </pre><br><br>  This trick allowed even faster to calculate what is needed.  But Ruby failed to do this trick.  Therefore, it is more correct to compare the performance of node1 from Ruby and node1 from Go. <br><br>  <b>And so what is the speed of all presented?</b> <br><br>  How I decided to test: <br><br>  Calculate which database to put the data related to each of the million users. <br><br>  On Ruby: <br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>..<span class="hljs-number"><span class="hljs-number">1000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> node1(<span class="hljs-string"><span class="hljs-string">"user:"</span></span>+i.to_s) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  and go: <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">1000000</span></span>; i++ { node1(<span class="hljs-string"><span class="hljs-string">"user:"</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(i)) }</code> </pre><br><br>  The full code can be viewed on <a href="https://github.com/dfer/rubyvsgo">github</a> . <br><br>  For the purity of the experiment, I ran each script 10 times, and below are the average values. <br><br>  The code runs on Ruby versions 1.8.7 and 2.1.3.  Go version was 1.4.2 <br><br>  Values ‚Äã‚Äãin seconds.  Less is better. <br><br>  Ruby 1.8.7 <br>  node0 - 22.32 <br>  node1 - 17.24 <br>  node11 - 16.81 <br><br>  Ruby 2.1.3 <br>  node0 - 15.46 <br>  node1 - 11.15 <br>  node11 - 11.05 <br><br>  Go 1.4.2 <br>  node1 - 6.15 <br>  node2 - 4.36 <br><br>  <b>Why are these old versions of Ruby?</b> <br><br>  I started creating the code for many projects 4-5 years ago.  As far as possible, I transferred it to new versions of Ruby.  In particular, on 2.1.3.  I agree that on the latest version of Ruby 2.2.2 the results may be better, but obviously not twice. <br><br>  <b>findings</b> <br><br><ul><li>  1. Go 1.4.2 faster than old Ruby versions 3 times.  And faster than modern versions 2 times. </li><li>  2. Ruby optimized well from version 1.8.7 to 2.1.3.  Speed ‚Äã‚Äãincrease by 25-30%. </li><li>  3. Ruby, you were a true friend and colleague, we went through a lot together, but ... I met Go.  Now I'm with him on the way. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/260033/">https://habr.com/ru/post/260033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260023/index.html">Application Migration - Code Examples</a></li>
<li><a href="../260025/index.html">Fun starts or C ++ and STL: who is faster?</a></li>
<li><a href="../260027/index.html">Passing Stored Arguments to a Function</a></li>
<li><a href="../260029/index.html">Detector of UI locks in WPF with notification</a></li>
<li><a href="../260031/index.html">Windows and Mac OS Integration with Acronis Access Connect</a></li>
<li><a href="../260045/index.html">Material Design and Search by the example of a reference application</a></li>
<li><a href="../260047/index.html">Interesting notes on C # and CLR (v2.0)</a></li>
<li><a href="../260049/index.html">One of the features of PHP related to methods and functions</a></li>
<li><a href="../260053/index.html">How to bind Docker containers without forcing the application to read environment variables</a></li>
<li><a href="../260061/index.html">Development of modular C / C ++ applications using annotations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>