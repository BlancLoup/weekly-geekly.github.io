<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programmable Wi-Fi night light bulb on ESP8266</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is nothing unusual in controlling LEDs with a microcontroller. Even as strange as ESP8266. However, I wanted to make a finished product. Somethi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programmable Wi-Fi night light bulb on ESP8266</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e99/61e/f14/e9961ef14c0155379b00dbd48b2b1dc5.jpg" alt="image"><br><br>  There is nothing unusual in controlling LEDs with a microcontroller.  Even as strange as ESP8266.  However, I wanted to make a finished product.  Something that would not be like a spider from wires and radio components. <br><br>  I note that I am a novice radio amateur, so I probably did something not very good.  I would be glad if someone tells you what is wrong and why it should be done differently. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are a number of features associated with the ESP8622 controller, with transistors, with powerful RGB LEDs, with 3D printing in general and modeling in particular, and programming all this happiness.  This is a review article, where I will briefly show you what happened and how, and if you want, I will reveal more detailed topics requested in separate articles. <br><a name="habracut"></a><br>  The ESP module is very voracious.  When it starts, it takes up to 300 mA, which makes it impossible to power it, for example, from the Arduino.  He needs his power source.  Moreover, the power supply at 3.3V.  This is problem.  The world is full of kopek power sources at 5V, but three-volt bulky and expensive.  Fortunately, there is such a thing as a voltage regulator AMS1117-3.3. <br><br><h4>  Nutrition </h4><br>  I took the base of the bulb, the Chinese five-watt USB charging, the voltage regulator with a smoothing capacitor, the Schottky diode (just in case) and got: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab8/877/431/ab8877431c120b934c19154f3e68d789.jpg" alt="image"><br><br>  At 3.3 it is not very similar, but this is because there is a pair of capacitors.  However, under load everything is fine. <br><br><h4>  Controller </h4><br>  My favorite is ESP-07, with the ability to connect an external antenna and a metal screen-heatsink. <br>  Firmware: <a href="https://github.com/nodemcu/nodemcu-firmware">nodemcu</a> , primarily because there is support for PWM (PWM) and the ability to change the code on the fly. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/779/693/d26/779693d26fa735712b9baf7785dbace3.jpg" alt="image"><br><br><h4>  Assembled circuit </h4><br>  Then, I fixed a three-watt RGB-LED on top, connected BC547 transistors ( <a href="http://habrahabr.ru/post/133136/">common emitter circuit</a> ) to it, plugged the power supply and board with an electrical tape and sealed it with double-sided tape.  On the other side of the board, I attached the microcontroller, put the power on, added resistance to each channel of the LED, and connected it to 5 volts. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a1a/06b/220/a1a06b2203ad730651f0053e19d4c1e0.jpg" alt="image"><br><br><h4>  Housing </h4><br>  The final choice is a cylindrical body with a hole in the bottom under the base, grooves for the board and a notch on top for fixing the decoration.  A little <a href="http://tinkercad.com/">tinkercad</a> , two hours of printing and the result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d64/aeb/076/d64aeb0760b1cea15354b5016ad4d4f2.jpg" alt="image"><br><br><h4>  Final product </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/7d7/89f/313/7d789f31339b708ca88b9151868256ff.jpg" alt="image"><br><br><h4>  Check </h4><br>  Some JS, some LUA, some Perl and ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd7/30e/e9f/fd730ee9f77abeaf760d2d7293420564.jpg" alt="image"><br><br><h4>  How it works </h4><br>  When turned on, the light bulb connects to the home network and requests a file with a lua script from the home server.  If it works, it saves and runs.  If it did not work, it launches the previous saved one.  Usually the inclusion takes about 2-3 seconds. <br><br><h4>  Underwater rocks </h4><br>  Where do without them? <br><br>  First, you cannot use a transistor connection circuit with a common collector.  ESP is a surprisingly tenacious thing, albeit a very capricious one.  He begins to brutally warm up from five volts, but after he cools down - he returns to normal. <br><br>  Secondly, you cannot use GPIO0, because at the start it turns out to be shorted to ground and ESP enters the firmware mode.  And you cannot use GPIO2, because if it is at the start "on the ground", then the Wi-Fi module does not start.  GPIO15 is also better not to touch.  My choice: 4,5,12. <br><br>  Thirdly, you need to set the maximum speed for data exchange, otherwise, when you receive data, the program PWM starts flickering noticeably. <br><br>  Fourthly, ABS plastic is flammable, it must be taken into account, remembering the Chinese power supply. <br><br>  Fifth, in the next version you need to make the cylinder narrower at the base, cutting the board.  Because not all cartridges allow to twist a lamp with such a wide base.  In addition - it was possible to save a centimeter of height. <br><br><h4>  Incorrigible improvements </h4><br>  I plan to add a midi-squeaker for all kinds of holidays, an application for Android, in order to choose a color not in the browser, an automatic mode in which the lamp would receive the weather forecast and choose its color depending on the result and, probably, the next option should be collected by etching the board.  Interesting suggestions are welcome. </div><p>Source: <a href="https://habr.com/ru/post/257779/">https://habr.com/ru/post/257779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257763/index.html">Generating a QR code in the format of a machine embroidery file Tajima DST</a></li>
<li><a href="../257767/index.html">Referrer spam in google analytics and how to deal with it</a></li>
<li><a href="../257769/index.html">Online voting is one step closer thanks to a breakthrough in security technology</a></li>
<li><a href="../257771/index.html">Airbnb-flavored Aviasales</a></li>
<li><a href="../257775/index.html">Abstractions without overhead: types in Rust</a></li>
<li><a href="../257781/index.html">Vector replacement to sprites - we implant SVG in CSS</a></li>
<li><a href="../257783/index.html">IBM Introduces New Cyber ‚Äã‚ÄãAttack Solution</a></li>
<li><a href="../257787/index.html">Configuring a Pfsense based gateway. Part 1</a></li>
<li><a href="../257789/index.html">But about Sphinx 3.0</a></li>
<li><a href="../257791/index.html">Cisco Company Development History: 1984-2000</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>