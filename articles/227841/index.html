<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Framework-independent controllers. Finishing touches</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Thank! And let me explain. 

 First of all, thanks to everyone who read the previous parts . Many interesting comments have been written, and I realiz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Framework-independent controllers. Finishing touches</h1><div class="post__text post__text-html js-mediator-article">  Thank!  And let me explain. <br><br>  First of all, thanks to everyone who read the <a href="http://habrahabr.ru/post/227781/">previous</a> <a href="http://habrahabr.ru/post/227787/">parts</a> .  Many interesting comments have been written, and I realized that I must explain why I actually write all this?  Why do I need to separate the controllers from the framework?  Most likely, this will not have to think, because <br><br><blockquote>  The chances that the controllers will have to be transferred to another framework are close to zero.  (Rafael Doms) </blockquote><br><a name="habracut"></a><br>  Well said, and I agree with that.  You do not need to do this, because nobody usually changes frameworks.  Although it is possible that someone will want to use your code in the application on another framework.  But: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  If you have a ‚Äúthin‚Äù controller, in which everything depends on the service layer, then it will be elementary to rewrite it to another framework (Rafael Doms) </blockquote><br><br>  Indeed, there should be almost no code in the controllers, only calls to services, receiving data from them and returning any response.  They can even be rewritten to another framework not needed.  And if you are not going to distribute your code, then again there is no point in separating controllers from the framework. <br><br>  But when you do this, you will become a little happier.  Not only your controllers will become more independent, you as an developer will also become independent.  No longer need to rely on helper functions, annotations, or magic: you can do everything yourself.  I really like the following quote, because it accurately describes my impressions: <br><br><blockquote>  Now, writing a new controller brings more benefits than before, and because of this, I think more about the essence of the code (Kevin Bond) </blockquote><br><br>  And this is why I am writing this series of posts.  They give developers a better understanding of what is actually happening inside the framework, and how it helps them.  Developers are becoming more confident, more independent.  They cease to be "symphony developers", they become more skillful developers in a general sense.  This series of articles is an excellent exercise in identifying dependencies.  Agreements in the controllers, by the way, are also dependencies: let them be hidden from our eyes, but we have the opportunity to train our "radar of connections". <br><br><h5>  Twig Templates </h5><br><br>  Let's take the last few steps to the framework-independent controllers.  In the previous section, we removed all the annotations and used configuration files instead.  We also implemented several dependencies that allowed us to obtain data from the database and render the template.  But the template name still contained the name of the bundle as a namespace: <br><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClientController</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detailsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Client $client)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;templating-&gt;render( <span class="hljs-string"><span class="hljs-string">'@MatthiasClientBundle/Resources/views/Client/Details.html.twig'</span></span>, ... ) ); } }</code> </pre> <br>  Since we decided to make this controller work in applications where there are no bundles, we will have to choose a more general name, for example, <code>MatthiasClient</code> .  Now you need to register this name as a namespace for Twig templates.  To do this, call the method <code>Twig_Loader_Filesystem::addPath('///', '')</code> For <code>Twig_Loader_Filesystem::addPath('///', '')</code> .  What is good is that in an application on symfony 2 this can be done by specifying the <code>twig.paths</code> configuration <code>twig.paths</code> : <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#  config.yml: twig: paths: "%kernel.root_dir%/../src/Matthias/Client/View": "MatthiasClient"</span></span></code> </pre><br><br>  When you add this path in <code>config.yml</code> , the code in the controller can be changed like this: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;templating-&gt;render( <span class="hljs-string"><span class="hljs-string">'@MatthiasClient/Client/Details.html.twig'</span></span>, ... ) );</code> </pre><br><br><h5>  Better yet: preconnect configuration </h5><br><br>  We got a not very elegant solution, because you need to edit the config when you first connect <code>MatthiasClientBundle</code> to the project.  There is a better option: you can programmatically add values ‚Äã‚Äãto the configuration from the extension class of your bundle.  The extension must implement <code>PrependExtensionInterface</code> and provide an array of values ‚Äã‚Äãthat must be added before the basic values ‚Äã‚Äãin <code>config.yml</code> : <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">DependencyInjection</span></span>\<span class="hljs-title"><span class="hljs-title">Extension</span></span>\<span class="hljs-title"><span class="hljs-title">PrependExtensionInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MatthiasClientExtension</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Extension</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PrependExtensionInterface</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerBuilder $container)</span></span></span><span class="hljs-function"> </span></span>{ $container-&gt;prependExtensionConfig( <span class="hljs-string"><span class="hljs-string">'twig'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'paths'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'%kernel.root_dir%/../src/Matthias/Client/View'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MatthiasClient'</span></span> ) ) ); } }</code> </pre><br><br>  Now you can remove the extra line from <code>config.yml</code> , because now this value is added automatically. <br><br><h5>  Getting rid of HttpFoundation dependency <br></h5><br>  The previous article raised doubts among some readers: <br><br><blockquote>  And now the controller clearly depends on Doctrine and HttpFoundation!  In the version with annotations this was not!  (Jerry Vandermazen) </blockquote><br><br>  In my opinion, depend on Doctrine is not so bad.  This is just a library I liked (like Twig).  Unbinding from ORM / ODM is also an interesting thing, and quite realizable, but it is still outside of this series of posts. <br><br>  But Jerry is right: removing annotations, we add dependency on the <code>Request</code> and <code>Response</code> classes from the HttpFoundation component.  However, unlike him, I believe that this is already a good step towards unlinking from the framework, since more and more other frameworks besides Symfony support HttpFoundation as a layer of abstraction for HTTP. <br><br>  However, we can take another step and stop depending on HttpFoundation.  We need to get rid of the <code>Request</code> and <code>Response</code> objects.  Let's change the controller like this: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detailsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ $client = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;clientRepository-&gt;find($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!($client <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Client)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">404</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;templating-&gt;render( <span class="hljs-string"><span class="hljs-string">'@MatthiasClient/Client/Details.html.twig'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'client'</span></span> =&gt; $client) ), <span class="hljs-number"><span class="hljs-number">200</span></span> ); }</code> </pre><br><br>  Not a single class from HttpFoundation is now mentioned here!  Now you can add a controller wrapper that would connect our controller with this component: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpFoundation</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpFoundation</span></span>\<span class="hljs-title"><span class="hljs-title">Response</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpKernel</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">NotFoundHttpException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SymfonyClientController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $clientController; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClientController $clientController)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;clientController = $clientController; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detailsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function"> </span></span>{ $result = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;clientController-&gt;detailsAction($request-&gt;attributes-&gt;get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($content, $status) = $result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($status === <span class="hljs-number"><span class="hljs-number">404</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotFoundHttpException($content); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response($content, $status); } }</code> </pre><br><br>  Yes, the code becomes somewhat more difficult to understand.  So I do not recommend you do that.  But still I would like to show you that this is indeed possible. <br><br><h5>  Get rid of the "action" -methods </h5><br><br>  The last topic for discussion: action controllers.  The de facto standard is that the associated actions are packaged into one controller class.  For example, all client actions must be in the <code>ClientController</code> class.  That is, it has methods like <code>newAction</code> , <code>editAction</code> , etc.  And if you use dependency injection in the constructor, then it is quite possible that some of them will not even be used in some actions. <br><br>  The solution to this problem is actually very simple, and significantly simplifies the perception of the controller code.  It also makes it easier to search for controllers.  Just need to group actions a little differently.  By and large, each of the actions is allocated in a separate class, and the directory in which such an action controller finds itself becomes a link, here's an example: <code>Controller\Client\New</code> , <code>Controller\Client\Edit</code> , and so on.  Each of these classes will have one public method called when the controller is executed.  Let's call it <code>__invoke</code> : <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Matthias</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Details</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//          } public function __invoke(Client $client) { ... }</span></span></code> </pre><br><br>  I first learned about this technique in the book of Paul Jones Modernizing Legacy Applications in PHP.  I have applied it several times already, and I must say that in some cases it has become much more pleasant to work with controllers! <br><br><h5>  Conclusion </h5><br>  Well, I gave you a few ideas the next time you create another controller.  I also hope that you are now better acquainted with the framework itself.  And I hope that your mind is free :) </div><p>Source: <a href="https://habr.com/ru/post/227841/">https://habr.com/ru/post/227841/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227821/index.html">Tizen Developer Summit Russia Conference in Moscow July 10, 2014</a></li>
<li><a href="../227823/index.html">Registration with Google Wallet Merchant is open to Belarus and Kazakhstan.</a></li>
<li><a href="../227827/index.html">Creating audio plug-ins, part 12</a></li>
<li><a href="../227835/index.html">Programming "for the soul"</a></li>
<li><a href="../227837/index.html">The future of the ECM systems market: a view from Europe</a></li>
<li><a href="../227843/index.html">Everything you know about conversion optimization is not true.</a></li>
<li><a href="../227845/index.html">Experimental video post: two excavators, drones and railgun</a></li>
<li><a href="../227847/index.html">Moto 360: smart and beautiful watch from Motorola</a></li>
<li><a href="../227849/index.html">ELibrary Record Manager</a></li>
<li><a href="../227853/index.html">Develop mobile javascript MVC applications with Framework7, RequireJS and Handlebars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>