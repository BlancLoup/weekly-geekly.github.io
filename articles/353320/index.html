<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vulnerability found in Vesta CP hosting control panel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In some of our previous articles we have already talked about the free Vesta CP control panel. This morning we received disturbing information - there...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vulnerability found in Vesta CP hosting control panel</h1><div class="post__text post__text-html js-mediator-article">  In some of our previous articles we <a href="https://habrahabr.ru/company/ua-hosting/blog/274029/">have already talked</a> about the free Vesta CP control panel.  This morning we received disturbing information - there is a critical vulnerability in the panel that allows attackers to access the server and launch DDoS attacks from it or send spam, which often leads to traffic overspending.  Details known at the moment, as well as tips on protecting a clean and cleaning a hacked server, under the cat. <br><br><img src="https://habrastorage.org/webt/a4/oi/wq/a4oiwqc2m9w9s0htpwsv69f6nba.png"><br><a name="habracut"></a><br>  The first notifications about possible vulnerabilities in Vesta 0.9.8-19 appeared on April 7 in both the English and Russian branches of the <a href="https://forum.vestacp.com/">forum panel</a> .  All symptoms were similar: a sharp increase in traffic and a parasitic load on the server.  And according to the statements of people serving many client servers, they only had one thing in common - Vesta CP. <br><br>  Soon, preventive measures were followed by individual providers - blocking the standard port of Vesta (8083) at the network level of the provider, disabling the guilty.  In the meantime, the panel developers themselves tried to link the hacks with their product.  And you can not say that successfully. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      According to the developers themselves, they were unable to reliably establish and reproduce the vector of attack, but they released a hotfix covering some of the gaps that could have caused it.  Namely, they corrected the authorization and made the password check more stringent.  So far, no information has been received on the successful hacking of the updated Vesta 0.9.8-20, but the fact that the developers could not reliably establish the attack vector itself keeps users in a certain amount of tension.  Below we provide some recommendations from the network to prevent hacking and to combat the consequences. <br><br><h3>  What to do if your server has not been hacked yet? </h3><br>  Most of the recommendations below apply not only to servers with Vesta CP, but also to any other Linux server. <br><br><ul><li>  First of all, update the panel by running the command: <br><br><pre><code class="bash hljs">v-update-sys-vesta-all</code> </pre> </li><li>  Change in <u><i>/usr/local/vesta/nginx/conf/nginx.conf the</i></u> standard port 8083 to another one of your choice. </li><li>  Use a non-standard SSH port.  Use the key entry if possible. <br>  It is also advisable to disable root login from the world. </li><li>  Download and run <a href="https://www.rfxn.com/projects/linux-environment-security/">Linux Environment Security</a> . </li><li>  Download and install <a href="https://www.rfxn.com/projects/linux-malware-detect/">Linux malware detect</a> .  After installation, run the primary system analysis for existing problems: <u><i>maldet -a /</i></u> (and analyze the report).  If everything is in order, start monitoring: <u><i>maldet</i></u> - <u><i>monitor /</i></u> .  Be sure to include your email to receive reports in <u><i>/usr/local/maldet.conf</i></u> . </li><li>  Another very useful tool to install is <a href="https://configserver.com/cp/csf.html">Config Server Firewall</a> .  Carefully read the configuration file and be sure to turn on tracking changes to directories and files. </li><li>  If you are not expecting users, customers or visitors from China - block it all at the firewall level. </li><li>  Install an application to monitor traffic.  For example, <a href="https://www.ntop.org/products/traffic-analysis/ntop/">ntopng</a> . </li></ul><br><h3>  And if you have already hacked? </h3><br>  <s>Spots</s> The consequences of this attack are eliminated rather uneasy, therefore, if you have such an opportunity, we advise you to <s>use Vanish</s> to merge backups (we <a href="https://habrahabr.ru/company/ua-hosting/blog/213983/">reminded</a> you of the need to do them <a href="https://habrahabr.ru/company/ua-hosting/blog/239223/">more than once</a> ) and reinstall the server.  The difficulty lies in the fact that Trojan.DDoS_XOR-1 (also known as Chinese Chicken Multiplatform DoS botnets Trojan), which infected most of the compromised machines, is very self-repairing, and certain tambourine dances are needed to remove it (described below).  Another difficulty is the banal server overload by parasitic processes, which will significantly complicate your work with the server outside of the rescue mode (which may not exist in principle if you use VPS). <br><br>  If it‚Äôs not possible to just reinstall everything, try the following. <br><br><ol><li>  Check for symptoms of infection with Trojan.DDoS_XOR.  It appears in the output <u><i>top</i></u> as a file with a random name of the form H8wuaqwiu, S01wefiouh8, etc.  or as a system command, sometimes not even assuming a long execution: ls, ifconfig, pwd, ping, awk, telnet ... <br><br>  The second symptom is the presence of the <i>.sh</i> file in the hourly crown folder.  You can check with the <u><i>command ls -la /etc/cron.hourly/</i></u> .  The file is often called <i>gcc.sh</i> , <i>cron.sh</i> , but other names are possible. </li><li>  See the contents of the .sh file.  For example, <u><i>using the cat /etc/cron.hourly/gcc.sh</i></u> command.  The file has approximately the following content: <br><blockquote>  #! / bin / sh <br>  PATH = / bin: / sbin: / usr / bin: / usr / sbin: / usr / local / bin: / usr / local / sbin: / usr / X11R6 / bin <br>  for i in `cat / proc / net / dev |  grep: |  awk -F: {'print $ 1'} `;  do ifconfig $ i up &amp; done <br>  cp /lib/libudev.so /lib/libudev.so.6 <br>  /lib/libudev.so.6 </blockquote></li><li>  Get in there?  Do not rush to fuss, Trojan recovers its files faster than you can delete them all.  But it will try to use the same file names, so the lock should help: <br><br><pre> <code class="bash hljs">chmod 0 /etc/cron.hourly/gcc.sh; chattr +ia /etc/cron.hourly/gcc.sh; chattr + i /etc/crontab</code> </pre> </li><li>  And the process of completely killing is also useless, it is recommended to stop it first, <br>  so that the trojan does not try to restart it.  In the output of the top command, find the process that caused the suspicion (for example, S01wefiouh8) and execute: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -STOP 16621</code> </pre> </li><li>  Locate executables and block them.  To search, use the command find <u><i>/ etc -name '* S01wefiouh8 *'</i></u> .  For found files, execute <u><i>chmod 0 / name / file;</i></u>  <u><i>chattr + ia / name / file</i></u> . </li><li>  Remove the executable files found in / usr / bin (with <u><i>ls -lt / usr / bin | head</i></u> you can search for others that are suspicious): <br><br><pre> <code class="bash hljs">rm -f /usr/bin/S01wefiouh8</code> </pre> </li><li>  Now you can finish the stopped process: <br><br><pre> <code class="bash hljs">pkill mtyxkeaofa</code> </pre> </li><li>  Finally, remove the body of the virus: <br><br><pre> <code class="bash hljs">rm -f /lib/libudev*.so</code> </pre> </li></ol><br>  If you are a hoster or a sysadmin, and you need to leave proof for a client, you can leave the rest of the files unchecked.  If not, delete all other frozen files.  Also, if you are unable to identify malicious files yourself, use ClamAV or RKHunter and see their report. <br><br>  If you have additional information about this problem, write in the comments.  Subscribe to our channel and this topic, we will also monitor developments and publish important updates in this article. <br><br>  Thank you for staying with us.  Do you like our articles?  Want to see more interesting materials?  Support us by placing an order or recommending to friends, <b>30% discount for Habr users on a unique analogue of the entry-level servers that we invented for you:</b> <a href="https://habrahabr.ru/company/ua-hosting/blog/347386/">The whole truth about VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps from $ 20 or how to share the server?</a>  (Options are available with RAID1 and RAID10, up to 24 cores and up to 40GB DDR4). <br><br>  <b>Dell R730xd 2 times cheaper?</b>  Only we have <b><a href="https://ua-hosting.company/serversnl">2 x Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 TV from $ 249</a> in the Netherlands and the USA!</b>  Read about <a href="https://habrahabr.ru/company/ua-hosting/blog/329618/">How to build an infrastructure building.</a>  <a href="https://habrahabr.ru/company/ua-hosting/blog/329618/">class c using servers Dell R730xd E5-2650 v4 worth 9000 euros for a penny?</a> </div><p>Source: <a href="https://habr.com/ru/post/353320/">https://habr.com/ru/post/353320/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353310/index.html">IT courses: what remains behind the scenes</a></li>
<li><a href="../353312/index.html">TDD wrong?</a></li>
<li><a href="../353314/index.html">SOC for intermediate. We understand what we are protecting, or how to make an inventory of infrastructure</a></li>
<li><a href="../353316/index.html">How to set up various notifications about problems with the site</a></li>
<li><a href="../353318/index.html">State space in problems of designing optimal control systems</a></li>
<li><a href="../353322/index.html">Visualizing Process Connections in Linux</a></li>
<li><a href="../353324/index.html">How is information security operational management center (SOC-center) built today?</a></li>
<li><a href="../353328/index.html">How to use getDerivedStateFromProps in React 16.3 (py subtitles)</a></li>
<li><a href="../353332/index.html">Own validations of fields for Rules in one class</a></li>
<li><a href="../353334/index.html">How to use the geodata analysis to predict the number of emergency calls in different parts of the city?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>