<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>uRPF (anti-spoofing protection data plane)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear community. 

 In preparation for the SECURE exam (642-637), I would like to talk about the technology of uRPF (Unicast Reverse Pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>uRPF (anti-spoofing protection data plane)</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear community. <br><br>  In preparation for the SECURE exam (642-637), I would like to talk about the technology of uRPF (Unicast Reverse Path Forwarding). <br><br>  This technology is an antispoofing tool at the third level of the OSI model, and is used as one of the technologies for protecting the data plane.  More precisely, it allows you to deal with the fake IP address of the sender in the packets that come to the interfaces of the router.  After all, an attacker may use an IP address that is ‚Äústolen from another network‚Äù in the sent packets, or an incorrect IP address from the ranges allocated for specific use, for example, 127.0.0.0/8. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/2ed/93e/e76/2ed93ee76cfaed49b20801d91b84dbb4.jpg"><br><a name="habracut"></a><br>  When introducing integrated anti-spoofing protection, it is recommended to use: <br><ul><li>  IP Source Guard - this technology allows sending packets only from the IP address that was issued to the device connected to the switch port via DHCP. </li><li>  It is also recommended to disable routing from the source on devices using the ‚Äúno ip source-route‚Äù command. </li><li>  At the access and distribution levels use ACLs that will filter spoofed packets. </li><li>  The uRPF technology is recommended for use at access and distribution levels. </li></ul><br><br>  Now in more detail about the uRPF technology.  By enabling uRPF on the interface, it will automatically verify the IP address of the sender of the packet with the data from the CEF FIB.  It follows that the use of CEF is mandatory.  At the same time, we rely on the fact that RIB and FIB contain only correct routing information. <br><br>  There are two types of uRPF: loose and strict. <br><br>  If the packet arrives on the interface with the configured Loose uRPF, then a check will be made whether there is an entry in the FIB about such a network whose member is the IP address of the sender of the packet.  If there is no such record, the packet will be deleted, otherwise the packet will be redirected in accordance with the FIB. <br>  If a packet arrives on an interface with strict uRPF configured, then the sender's IP address will be checked again, and if the interface on which the packet came did not match the entry in the FIB (for example, the sender is actually behind another interface), then the packet will be deleted.  Otherwise, it will be redirected according to the entry in the FIB. <br><br>  Configuration example, general topology information: <br><img src="https://habrastorage.org/storage2/a77/840/0a6/a778400a6803208efa86547d008ae4b6.png"><br><img src="https://habrastorage.org/storage2/163/ed0/acd/163ed0acd596a0f4c6ef8a15c4446c1f.png"><br><img src="https://habrastorage.org/storage2/684/505/364/684505364e4279bf994d082b62a1d71a.png"><br><br>  First you need to make sure that CEF is turned on, or you can enable it using the ‚Äú <b>ip cef</b> ‚Äù command. <br><img src="https://habrastorage.org/storage2/7d0/d88/d74/7d0d88d74946b0cf991f131ba10cd0c7.png"><br><br>  Primary configuration: <br><img src="https://habrastorage.org/storage2/cc4/cbb/88c/cc4cbb88c40349dd4344a88f27e4fdb9.png"><br><br>  " <b>Ip verify unicast source reachable-via rx allow-default allow-self-ping</b> ", the main part of the command " <b>ip verify unicast source reachable-via rx</b> " includes strict uRPF on the routed port, that is, the packet that came to Fa0 / 0 will now be it is checked if the network which owns the IP address of the sender really is in the FIB and it is really available through the interface to which the packet came, then it will be redirected, otherwise it will be deleted.  The <b>allow-default</b> argument specifies that a default route is available through this interface.  This means that the packets entering this interface can have any IP address of the sender except those networks that are accessible via FIB through other interfaces.  The argument ‚Äú <b>allow-self-ping</b> ‚Äù allows to ping this interface from the same router.  And the final argument may be the ACL number which the ‚Äúpermit‚Äù rules will allow to make an exception for some addresses and / or to log blocked packets. <br>  The ‚Äú <b>ip verify unicast source reachable-via any</b> ‚Äù command enables the uRPF interface to have a loose mode.  In this mode, any packet whose sender‚Äôs network information is in the FIB will be skipped.  In this mode, the ‚Äú <b>allow-default</b> ‚Äù argument is not used, since it will allow forwarding any packets through the interface. <br><br>  An example of logging packets blocked by uRPF using ACLs: <br><img src="https://habrastorage.org/storage2/bca/f22/232/bcaf222320ca28437e08f3c69864d9b2.png"><br><br>  uRPF and asymmetric routing <br><br>  Since in real topologies routes on routers are not symmetrical, that is, a specific router sending a packet to a specific network through a specific port (based on the FIB) can receive a reply packet through a completely different interface.  In this situation, strict uRPF will block such packages. <br>  This problem can be solved in two ways.  Firstly, you can use loose uRPF, secondly, using the same ACL that we used for logging, you can use it to exclude checking certain IP address ranges in strict uRPF (of course, only for those ranges that include asymmetric routes). <br><br>  An example of setting up uRPF notifications: <br><img src="https://habrastorage.org/storage2/e18/2cf/76d/e182cf76ddd521e26a91e76fa097a5f7.png"><br><br>  URPF notifications can be sent using snmp protocol.  ‚Äú <b>Ip verify drop-rate compute window</b> seconds‚Äù defines the period during which the uRPF drop rate is calculated, ie only after this time period has elapsed, we will know the drop rate. <br>  ‚Äú <b>Ip verify drop-rate compute interval</b> seconds‚Äù defines the time interval between the processes of calculating the uRPF drop rate. <br>  The ‚Äú <b>ip verify drop-rate notify hold-down</b> seconds‚Äù command determines the minimum time between sending uRPF drop rate notifications. <br>  ‚Äú <b>Ip verify unicast notification threshold</b> packets-per-second‚Äù specifies the threshold value of packets per second that determines when to send a notification about exceeding drop rates. <br>  ‚Äú <b>Snmp trap ip verify drop-rate</b> ‚Äù ‚Äîthe last command forces the router to send notifications when the drop rate is exceeded via the snmp protocol and not just to the syslog subsystem. <br><br>  If you want to see the statistics of dropped packets on the interface, you can use the " <b>show ip interface</b> iface_name" command: <br><img src="https://habrastorage.org/storage2/0de/147/602/0de147602bf0e219782d1456908889db.png"><br><br>  I would also like to emphasize that ISR routers support both uRPF and uRPF notifications since IOS 12.4 (20) T. </div><p>Source: <a href="https://habr.com/ru/post/152287/">https://habr.com/ru/post/152287/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152275/index.html">IT Compote # 24 Programming and Technology Podcast</a></li>
<li><a href="../152277/index.html">Do you use Pinterest or Pinme for personal or business purposes?</a></li>
<li><a href="../152279/index.html">Android - Continuous Integration. Part 2</a></li>
<li><a href="../152283/index.html">Position changes in the App Store: in fact, everything still depends on downloads</a></li>
<li><a href="../152285/index.html">Auto-update program through MSSQL server</a></li>
<li><a href="../152289/index.html">ObjectScript - a new programming language</a></li>
<li><a href="../152291/index.html">Installing SilkJS on Centos 6</a></li>
<li><a href="../152297/index.html">The pitfalls of creating a mini Contact Center on Asterisk</a></li>
<li><a href="../152299/index.html">Multichannel software PWM to AVR</a></li>
<li><a href="../152301/index.html">Sergey Brin: You can buy a car with robotic control in five years</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>