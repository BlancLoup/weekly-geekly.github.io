<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Phemto and the Pattern Dependency Injection. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continued, beginning in Part 1 

 Phemto installation 
 Phemto is distributed with a simple tarball, so just unpack it ... 


 tar -zxf phemto_0.1_alp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Phemto and the Pattern Dependency Injection. Part 2</h1><div class="post__text post__text-html js-mediator-article">  Continued, beginning in <a href="http://habrahabr.ru/blogs/php/64061/">Part 1</a> <br><a name="habracut"></a><br><h2>  Phemto installation </h2><br>  Phemto is distributed with a simple tarball, so just unpack it ... <br><pre>  tar -zxf phemto_0.1_alpha6.tar.gz </pre><br>  It is enough to use require_once () to include the <em>phemto.php</em> file <em>.</em> <br><br>  The only Phemto dependency is the mechanism of PHP reflection. <br><br><h2>  Phemto in your program </h2><br>  Phemto is best used in the main script or class application or framework. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First you write classes as usual ... <br><br><br><blockquote>  <font color="#000000">class</font> Permissions <font color="#009900">{</font> <font color="#339933">...</font> <font color="#009900">}</font> <br><br>  <font color="#000000">class</font> Authentication <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#000088">$ permissions</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#339933">...</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">class</font> MyPage implements Page <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#000088">$ authentication</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#339933">...</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> </blockquote><br><br>  Conventional <em>Page Controller</em> Architecture  We can easily make a unit test for the <em>Page</em> , since its dependency on <em>Authentication</em> is passed to the constructor.  We can use test version simulation and concentrate on logic. <br><br>  Now we will write a file with a chain configuration, let's call it ‚Äúwiring.php‚Äù.  It contains all the necessary settings for our application ... <br><br><br><blockquote>  <font color="#b1b100">require_once</font> <font color="#009900">(</font> <font color="#0000ff">'phemto / phemto.php'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">forVariable</font> <font color="#009900">(</font> <font color="#0000ff">'authentication'</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#0000ff">'Authentication'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">whenCreating</font> <font color="#009900">(</font> <font color="#0000ff">'Authentication'</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">forVariable</font> <font color="#009900">(</font> <font color="#0000ff">'permissions'</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#000000">new</font> Sessionable <font color="#009900">(</font> <font color="#0000ff">'Permissions'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">return</font> <font color="#000088">$ injector</font> <font color="#339933">;</font> </blockquote><br><br>  Here we tell our injector that if it sees the <em>$ authentication</em> argument, then we need to create an instance of <em>Authentication</em> .  The object for the <em>$ permissions</em> argument has a different life cycle.  <em>Sessionable</em> says that if possible, you need to take an object from the session, otherwise create it and save it in the session so that the object will be created only once. <br><br>  Our main script instead of <em>new is</em> now using calls from the <em>Phemto</em> factories ... <br><br><br><blockquote>  <font color="#b1b100">require_once</font> <font color="#009900">(</font> <font color="#0000ff">'lib / my_page.php'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#b1b100">include</font> <font color="#009900">(</font> <font color="#0000ff">'wiring.php'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ page</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Page'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000000">?&gt;</font> <br>  <font color="#339933">&lt;</font> html <font color="#339933">&gt; ... &lt;/</font> html <font color="#339933">&gt;</font> </blockquote><br><br>  Thus, our code is so isolated from the main script that we can add and remove dependencies between classes without interfering with the main script. <br><br>  Framework authors usually have a different purpose.  Most likely they already have a central point for creating pages, and the main work is to adapt the components of third-party developers. <br><br>  Suppose we want to write an implementation of <em>Authentication</em> based on the framework interface ... <br><br><br><blockquote>  <font color="#000000">interface</font> Authentication <font color="#009900">{</font> <font color="#339933">...</font> <font color="#009900">}</font> <br><br>  <font color="#000000">class</font> InternalFrontControllerActionChainThingy <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> Authentication <font color="#000088">$ authentication</font> <font color="#339933">,</font> <font color="#339933">...</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#339933">...</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> </blockquote><br><br>  Our component will use a common database connection with the framework, and we also want to take a third-party caching component. <br><br><br><blockquote>  <font color="#b1b100">require_once</font> <font color="#009900">(</font> <font color="#0000ff">'cache.php'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000000">class</font> OurAuthentication implements Authentication <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> Database <font color="#000088">$ database</font> <font color="#339933">,</font> DatabaseCache <font color="#000088">$ cache</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#339933">...</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> </blockquote><br><br>  For a factory-based framework, this alignment is close to a nightmare, because the framework does not know how to create a cache component, and where to put it.  To force us to transfer the framework and the factory is not an option, since the framework will still have to issue and put a caching component somewhere.  If the framework uses <em>Dependency Injection</em> , then the task is reduced only to setting up the chain. <br><br>  The chain can be changed directly using a custom file ... <br><br><br><blockquote>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#b1b100">include</font> <font color="#009900">(</font> <font color="#0000ff">'framework / wiring.php'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#0000ff">'OurAuthenticator'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">return</font> <font color="#000088">$ injector</font> <font color="#339933">;</font> </blockquote><br><br>  However, most likely, the framework will place the DI tool in its registration system ... <br><br><br><blockquote>  <font color="#000000">class</font> FrameworkRegistration <font color="#009900">{</font> <br>  <font color="#339933">...</font> <br>  static <font color="#000000">function</font> register <font color="#009900">(</font> <font color="#000088">$ class</font> <font color="#339933">,</font> <font color="#000088">$ dependencies</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">injector</font> <font color="#339933">-&gt;</font> <font color="#004000">whenCreating</font> <font color="#009900">(</font> <font color="#0000ff">'Controller'</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#000088">$ class</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">foreach</font> <font color="#009900">(</font> dependencies <font color="#b1b100">as</font> <font color="#000088">$ dependency</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">injector</font> <font color="#339933">-&gt;</font> <font color="#004000">whenCreating</font> <font color="#009900">(</font> <font color="#0000ff">'Controller'</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">whenCreating</font> <font color="#009900">(</font> <font color="#000088">$ class</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#000088">$ dependency</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> </blockquote><br><br><br>  And then we can make such a call ... <br><br><br><blockquote>  FrameworkRegistration <font color="#339933">::</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'OurAuthentication'</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'DatabaseCache'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br><h2>  Phemto Chain Syntax </h2><br>  The simplest case of creating a Phemto object is through the class name ... <br><br><br><blockquote>  <font color="#000000">class</font> Porsche911 <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  Among the registered classes will be found suitable. <br><br>  If only one class can satisfy the condition, then it is this class that will create the object.  <em>Phemto</em> in this matter is smart enough and understands abstract classes and interfaces ... <br><br><br><blockquote>  abstract <font color="#000000">class</font> car <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">class</font> Porsche911 <font color="#000000">extends</font> Car <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Car'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  Here <em>$ car</em> is an instance of the <em>Porsche911</em> class.  Also‚Ä¶ <br><br><br><blockquote>  <font color="#000000">interface</font> Transport <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">class</font> Porsche911 implements Transport <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Transport'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  An object of the <em>Porsche911</em> class will be created <em>again</em> , as the only possible option. <br><br>  If there is ambiguity, then <em>Phemto</em> will throw an exception.  The ambiguity can be resolved by adding more information to the chain ... <br><br><br><blockquote>  <font color="#000000">interface</font> Transport <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">class</font> Porsche911 implements Transport <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">class</font> RouteMaster implements Transport <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Transport'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  This is convenient and when you need to override the standard implementation, while the standard class is registered in the system. <br><br>  <em>Phemto</em> has two methods for automatically creating parameters.  The first is with the help of the type ... <br><br><br><blockquote>  <font color="#000000">interface</font> Engine <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000000">class</font> Porsche911 <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> Engine <font color="#000088">$ engine</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">class</font> Flat6 implements Engine <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  This is equivalent to the <em>new Porsche911 (new Flat6 ())</em> .  This method is convenient for framework authors, who only need to specify interface names. <br><br>  Please note - we did not have to change the main code, even though we changed the constructor signature. <br><br>  Another way - <em>Phemto</em> can create a parameter by the name of the argument ... <br><br><br><blockquote>  <font color="#000000">class</font> Porsche911 <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#000088">$ engine</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">interface</font> Engine <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">class</font> Flat6 implements Engine <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">forVariable</font> <font color="#009900">(</font> <font color="#0000ff">'engine'</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#0000ff">'Engine'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  Again, for <em>$ car</em> we create an object of class <em>new Porsche911 (new Flat6 ())</em> .  Here we used the name of the <em>$ engine</em> argument to calculate the interface.  And further Phemto could apply the rules of automation. <br><br>  Sometimes it is still necessary to pass parameters to the constructor.  The easiest way to do this is to add them to the <em>create</em> method ... <br><br><blockquote>  <font color="#000000">class</font> Porsche911 <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#000088">$ fluffy_dice</font> <font color="#339933">,</font> <font color="#000088">$ nodding_dog</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#339933">,</font> <font color="#009900">true</font> <font color="#339933">,</font> <font color="#009900">false</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  These parameters will take their place in the constructor, in this case we get a <em>new Porsche911 (true, false)</em> . <br><br>  Unnamed parameters can be the cause of errors when the code becomes more complicated, so that you can use the parameters with the names ... <br><br><br><blockquote>  <font color="#000000">class</font> Porsche911 <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#000088">$ fluffy_dice</font> <font color="#339933">,</font> <font color="#000088">$ nodding_dog</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">fill</font> <font color="#009900">(</font> <font color="#0000ff">'fluffy_dice'</font> <font color="#339933">,</font> <font color="#0000ff">'nodding_dog'</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">with</font> <font color="#009900">(</font> <font color="#009900">true</font> <font color="#339933">,</font> <font color="#009900">false</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#339933">,</font> <font color="#009900">true</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  These parameters can also be used with dependencies. <br><br>  <em>Phemto</em> can call and methods other than the constructor ... <br><br><br><blockquote>  <font color="#000000">interface</font> Seat <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">interface</font> SportsCar <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000000">class</font> Porsche911 implements SportsCar <font color="#009900">{</font> <br>  <font color="#000000">function</font> fitDriversSeat <font color="#009900">(</font> Seat <font color="#000088">$ seat</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">class</font> BucketSeat implements Seat <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">forType</font> <font color="#009900">(</font> <font color="#0000ff">'SportsCar'</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">call</font> <font color="#009900">(</font> <font color="#0000ff">'fitDriversSeat'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  This code is similar to ... <br><br><blockquote>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000000">new</font> Porsche911 <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">-&gt;</font> <font color="#004000">fitDriversSeat</font> <font color="#009900">(</font> <font color="#000000">new</font> BucketSeat <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  Such a call to methods other than the constructor is called <em>setter injection</em> . <br><br>  It is not always necessary to create the same object.  Sometimes the choice has to be determined by the context ... <br><br><br><blockquote>  <font color="#000000">interface</font> Seat <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000000">class</font> Car <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> Seat <font color="#000088">$ seat</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#000000">class</font> FordEscort <font color="#000000">extends</font> Car <font color="#339933">;</font> <br>  <font color="#000000">class</font> Porsche911 <font color="#000000">extends</font> Car <font color="#339933">;</font> <br><br>  <font color="#000000">class</font> StandardSeat implements Seat <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">class</font> BucketSeat implements Seat <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#0000ff">'StandardSeat'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">whenCreating</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#0000ff">'BucketSeat'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  You can be sure that by default <em>$ seat</em> will be an object of the <em>StandardSeat</em> class, but <em>BucketSeat</em> will be used for the <em>Porsche911</em> . <br><br>  The <em>whenCreating ()</em> method will create a new nested version of <em>Phemto</em> , so that the context affects all previous settings in the chain, i.e. <br><br><br><blockquote>  <font color="#000000">class</font> Car <font color="#009900">{</font> <br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#000088">$ seat</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#000000">class</font> FordEscort <font color="#000000">extends</font> Car <font color="#339933">;</font> <br>  <font color="#000000">class</font> Porsche911 <font color="#000000">extends</font> Car <font color="#339933">;</font> <br><br>  <font color="#000000">class</font> StandardSeat <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">class</font> BucketSeat <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#0000ff">'StandardSeat'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">whenCreating</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">forVariable</font> <font color="#009900">(</font> <font color="#0000ff">'seat'</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#0000ff">'BucketSeat'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  The life cycle of objects created using <em>Phemto</em> can be monitored. <br><br>  <em>Phemto</em> has built-in classes: <em>Factory</em> (by default), which always creates a new instance of an object, <em>Reused</em> which gives references to the same instance, and <em>Sessionable</em> , which stores an instance of an object in the PHP <em>$ _SESSION</em> system variable.  They all inherit from the base abstract class <em>Lifecycle</em> .  Developers can extend these classes ... <br><br>  Here we will create a single instance of the <em>Porsche911</em> object and will distribute links. <br><br><br><blockquote>  <font color="#000000">class</font> Porsche911 <font color="#009900">{</font> <font color="#009900">}</font> <br><br>  <font color="#000088">$ injector</font> <font color="#339933">=</font> <font color="#000000">new</font> Phemto <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">willUse</font> <font color="#009900">(</font> <font color="#000000">new</font> Reused <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ same_car</font> <font color="#339933">=</font> <font color="#000088">$ injector</font> <font color="#339933">-&gt;</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#0000ff">'Porsche911'</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  <em>$ car</em> and <em>$ same_car</em> will refer to the same object.  In the end, Porsche cars are quite expensive. <br><br>  Links and additional information <br><ul><li>  Phemto page at <a href="http://sourceforge.net/projects/phemto/">SourceForge</a> . </li><li>  Martin Fowler article <a href="http://martinfowler.com/articles/injection.html">description of DI</a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/64078/">https://habr.com/ru/post/64078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../64068/index.html">Experimenting the creation of a trend of memory</a></li>
<li><a href="../64072/index.html">"Unkillable" Nokia 3720 Classic</a></li>
<li><a href="../64073/index.html">Configure EoMPLS on Cisco routers</a></li>
<li><a href="../64074/index.html">Habraeffect Protection</a></li>
<li><a href="../64076/index.html">Development of Internet marketing players</a></li>
<li><a href="../64080/index.html">Generation of 3D models from photographs</a></li>
<li><a href="../64081/index.html">"Easter eggs" in the programs and on the websites - your attitude?</a></li>
<li><a href="../64082/index.html">Silverlight 3 officially released in Russia</a></li>
<li><a href="../64084/index.html">Remaking the CD Collection application</a></li>
<li><a href="../64085/index.html">Javascript event coordinates IE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>