<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How-to: We write trade robots on TradeScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The topic of creating mechanical trading systems or simply exchange robots is of interest in Habr√©. We often cover the theoretical aspects of algorith...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How-to: We write trade robots on TradeScript</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/itinvest/blog/214601/"><img src="https://habrastorage.org/getpro/habr/post_images/3de/1b4/854/3de1b4854837957cffba492efac5e1e8.jpg" alt="image"></a> <br><br>  The topic of <a href="http://habrahabr.ru/company/itinvest/blog/212335/">creating mechanical trading systems</a> or simply exchange robots is of interest in Habr√©.  We often cover the <a href="http://habrahabr.ru/post/207000/">theoretical aspects of</a> algorithmic trading, but not so often talk about its practical component.  Therefore, in today's topic will be considered real examples of various robots created using the scripting language TradeScript. <a name="habracut"></a><br><br><h4>  Introduction </h4><br>  To begin, pay attention to the tools that will be described in this text.  So, TradeSript is a vector programming language created by the American company <a href="http://www.modulusfe.com/">Modulus Financial Engineering</a> specifically to create trading robots.  This language is included in the technology package, which was licensed (OEM) by our company to create a SmartX trading terminal (for more information on its creation, see <a href="http://habrahabr.ru/company/itinvest/blog/213825/">this topic</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main advantage of TradeScript is the simplicity of the syntax, which, nevertheless, allows you to describe trading strategies of any complexity.  As a result, you can use it to create robots with virtually no programming experience.  If there is such an experience, then you can master the language in literally half an hour. <br><br>  The language engine runs on the terminal side and connects as a plug-in extension to SmartX.  In addition to the possibility of actually writing scripts, there is also the possibility of testing them in two modes: on real data and on historical data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/39a/f1d/53c/39af1d53ca3c46868ba76bf69e26433d.png" alt="image"><br><br>  There are many built-in functions (primitives) in TradeScript that make it easier to write scripts.  For example, the TREND primitive looks like this: <br><br> <code>TREND(CLOSE, 30) = UP</code> <br> <br>  This function will return True if there is an uptrend - calculated over the last 30 days at the closing prices of trading sessions. <br><br>  Due to the fact that TradeScript is a vector language, it is really convenient for describing trading strategies.  Each operation here is applied immediately to the whole set of values ‚Äã‚Äã(vector or field).  This allows you to think and operate with categories of data aggregates, without the need to use cycles or individual scalar operations. <br><br>  For example, to calculate a simple moving average of the ‚Äúmedian‚Äù stock price for <br>  the last 30 periods with the help of a common programming language like BASIC, <br>  but write something like: <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> symbol <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> bar = <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> max Average = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> n = bar - <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> bar median = (CLOSE + OPEN) / <span class="hljs-number"><span class="hljs-number">2</span></span> Average = Average + median <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> MedianAverages(bar) = Average / <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> bar   TradeScriptTM <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> symbol</code> </pre><br>  That is, to describe the simplest action, you need to ‚Äúspend‚Äù 9-10 lines of code.  With the help of a vector language, it is possible to cope with the construction of the form: <br><br> <code>SET MedianAverage = SimpleMovingAverage((CLOSE + OPEN) / 2, 30)</code> <br> <br>  In general, if MTS can be expressed by mathematical formulas or can be programmed in any procedural programming language, for example, C ++, VB or Java, you can be sure that this MTS can also be programmed using TradeScript. <br><br>  And now we proceed directly to writing robots. <br><br><h4>  Go </h4><br>  Very often, traders to determine the moment that is most suitable for opening or closing positions, resort to technical analysis.  This method involves searching patterns on charts using various technical indicators.  Most of the existing indicators (moving averages, oscillators, indices, functions of ranges and linear regression, etc.) are embedded in the TradeSript in the form of primitives, which simplifies their use when writing trading robots. <br><br>  In general, a robot or a mechanical trading system (MTS) is a set of rules that define entry and exit points for a particular security or financial instrument (futures, etc.).  Usually MTSs include one or several indicators, for example, a <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BA%25D0%25BE%25D0%25BB%25D1%258C%25D0%25B7%25D1%258F%25D1%2589%25D0%25B0%25D1%258F_%25D1%2581%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BD%25D1%258F%25D1%258F">moving average</a> crossover system (Moving Average Crossover) will buy if the short moving average crosses the long moving average bottom-up, and sell if the intersection goes in the opposite direction. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c3/f16/d57/1c3f16d5782b7b3e1fbcc630ff4d451f.png" alt="image"><br><br>  Sliding averages come in different lengths and types (we will make a separate post for technical analysis indicators), on which the number of signals generated by the trading system depends.  Shorter moving averages (MA - Moveing ‚Äã‚ÄãAverage) generate more signals as they intersect more often.  Accordingly, the number of ‚Äúfalse‚Äù signals in their case is much higher, so it is necessary to find a balance between false signals and lost profit. <br><br>  One solution to this problem may be to use some kind of second indicator to filter the input / output signals.  In particular, a parabolic system (Parabolic SAR) is often used to exit.  In the script below, 20/60 EMA is used for entry, and a parabolic system is used for exit. <br><br><pre> <code class="actionscript hljs">Buy Signals # <span class="hljs-number"><span class="hljs-number">20</span></span>- EMA  - <span class="hljs-number"><span class="hljs-number">60</span></span>- EMA CROSSOVER(EMA(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>), EMA(CLOSE, <span class="hljs-number"><span class="hljs-number">60</span></span>)) Sell Signals # <span class="hljs-number"><span class="hljs-number">20</span></span>- EMA    <span class="hljs-number"><span class="hljs-number">60</span></span>- EMA CROSSOVER(EMA(CLOSE, <span class="hljs-number"><span class="hljs-number">60</span></span>), EMA(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>)) Exit Long #    - Parabolic SAR CROSSOVER(CLOSE, PSAR(CLOSE, <span class="hljs-number"><span class="hljs-number">0.02</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>)) Exit Short #      Parabolic SAR CROSSOVER(PSAR(CLOSE, <span class="hljs-number"><span class="hljs-number">0.02</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>), CLOSE)</code> </pre><br>  Another situation that can be described by the script is the price gap (gap).  This is the name of the situation when on the new day the stock starts to trade above the high of the previous day - this may be after an unexpected release of positive news, reports, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b28/6e9/9a4/b286e99a40abb53399f9c7a273d40561.png" alt="image"><br><br>  At such times, often at the opening of the market, many purchase orders are submitted, with the result that the stock can be overvalued.  This is often followed by a downward price adjustment - the trading system described below takes into account the fact that the reversal moment usually occurs during the first hour of trading.  That is, if the gap is not ‚Äúclosed‚Äù during the first hour, then it can be assumed that the purchase is more likely to continue. <br><br>  Our script returns stocks that had a gap of at least 2% and closed close to <br>  maximum.  The strategy the next day may be buying after the first hour of <br>  gov if the stock remains strong.  Stop loss should be set at the low of the day.  The conservative profit target can be ¬Ω gap - 1% in our case. <br><br><pre> <code class="javascript hljs">Buy Signals #      <span class="hljs-number"><span class="hljs-number">2</span></span>%      LOW &gt; REF(HIGH,<span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">1.02</span></span> AND VOLUME &gt; SMA(VOLUME, <span class="hljs-number"><span class="hljs-number">5</span></span>) * <span class="hljs-number"><span class="hljs-number">2</span></span> Sell Signals #      <span class="hljs-number"><span class="hljs-number">2</span></span>%      HIGH &lt; REF(LOW,<span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">0.98</span></span> AND VOLUME &gt; SMA(VOLUME, <span class="hljs-number"><span class="hljs-number">5</span></span>) * <span class="hljs-number"><span class="hljs-number">2</span></span> Exit Long     ¬Ω   ,   -. Exit Short     ¬Ω   ,   -</code> </pre><br>  The following script is based on the use of the Bollinger Bands indicator - these are time series shifted from the moving average up and down by a certain number of standard deviations.  These bands form the boundaries of price fluctuations.  Bollinger Bands expand or contract depending on market volatility. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2f/b52/924/a2fb5292408913657e54595f682836eb.png" alt="image"><br><br>  Prices usually remain inside the Bollinger Bands.  One strategy is to <br>  buying or selling after prices are tapped, the boundaries unfold. <br>  A movement that began at one lane usually tends to continue until <br>  another lane. <br><br>  Another strategy is to buy or sell, if the price breaks <br>  strip line.  In this case, the market usually continues its movement in this direction. <br>  certain time. <br><br>  The strategy described in the following example is a combination of these two systems: a purchase occurs if the previous bar has touched the lower band, and the current bar is within the range (i.e., between the bars).  Also, the system will buy if the maximum of the current bar exceeds the upper band by a certain percentage.  Sale is carried out according to the opposite rules. <br><br><pre> <code class="javascript hljs">Buy Signals # ,       ,    SET Bottom = BBB(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, EXPONENTIAL) SET Top = BBT(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, EXPONENTIAL) ((REF(CLOSE, <span class="hljs-number"><span class="hljs-number">1</span></span>) &lt; REF(Bottom, <span class="hljs-number"><span class="hljs-number">1</span></span>)) AND CLOSE &gt; Bottom) OR #  ,        <span class="hljs-number"><span class="hljs-number">2</span></span>% CLOSE &gt; Top * <span class="hljs-number"><span class="hljs-number">1.02</span></span> Sell Signals # ,       ,    SET Bottom = BBB(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, EXPONENTIAL) SET Top = BBT(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, EXPONENTIAL) ((REF(CLOSE, <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt; REF(Top, <span class="hljs-number"><span class="hljs-number">1</span></span>)) AND CLOSE &lt; Top) OR #  ,        <span class="hljs-number"><span class="hljs-number">2</span></span>% CLOSE &lt; Bottom * <span class="hljs-number"><span class="hljs-number">0.98</span></span></code> </pre><br>  The following script is called the MACD Momentum System, and it uses the EMA and the TREND function to identify the market price, and the MACD indicator is used to determine the market moment. <br><br><img src="http://i.imgur.com/izTB0fY.png" alt="image"><br><br>  The MACD indicator reflects the change in the balance of power between the bulls (rising traders) and medveys (respectively, they play short). <br><br>  If the trend of the MACD indicator is upward, it says that bulls prevail in the market, if the trend is downward, this indicates the predominance of bears.  This is known as the market moment. <br><br>  This system buys if both inertia (EMA trend) and moment (MACD) go in the direction <br>  rising prices.  The system sells if the opposite is the case.  The exit signal occurs when the trend of inertia and moment changes to the opposite <br>  ny. <br><br><pre> <code class="javascript hljs">Buy Signals # ,        TREND(EMA(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-number"><span class="hljs-number">15</span></span>) = UP AND TREND(MACD(<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, SIMPLE), <span class="hljs-number"><span class="hljs-number">5</span></span>) = UP Sell Signals # ,        TREND(EMA(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-number"><span class="hljs-number">15</span></span>) = DOWN AND TREND(MACD(<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, SIMPLE), <span class="hljs-number"><span class="hljs-number">5</span></span>) = DOWN Exit Long Signal # ,         TREND(EMA(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-number"><span class="hljs-number">15</span></span>) = DOWN OR TREND(MACD(<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, SIMPLE), <span class="hljs-number"><span class="hljs-number">5</span></span>) = DOWN Exit Short Signal # ,         TREND(EMA(CLOSE, <span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-number"><span class="hljs-number">15</span></span>) = UP OR TREND(MACD(<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, SIMPLE), <span class="hljs-number"><span class="hljs-number">5</span></span>) = UP</code> </pre><br>  That's all for today.  Examples of other possible MTS on TradeScript, as well as a more detailed description of the language itself, can be found in a <a href="http://www.itinvest.ru/editorfiles/File/smartx/TradeScript.pdf">special guide</a> .  Thank you for your attention, we will be happy to answer questions in the comments. <br><br>  PS You can <a href="http://www.itinvest.ru/demo/">test the</a> operation of the described trading systems by downloading the SmartX terminal <a href="http://www.itinvest.ru/software/comp/smartx/">here</a> , and then connecting to our <a href="http://www.itinvest.ru/demo/">test loop</a> - a risk-free trading system with virtual money.  In the framework of the <a href="http://www.itinvest.ru/trader-liga2/group/test/">Test League of Traders,</a> you can compare your results in virtual trading with the achievements of other investors. <br><br>  PPS In order to popularize algorithmic trading, IT Invest, together with MFD-Infocentre and the Moscow Exchange, is holding an Algorithmus 2014 competition, during which asset managers will compete with each other.  You can follow the competition <a href="http://mfd.ru/tradingsignals/contests/3">here</a> , detailed rules are located <a href="http://mfd.ru/static/content/contentblock/89/Algoritmus2014.pdf">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/214601/">https://habr.com/ru/post/214601/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214591/index.html">JSDuck - documentation generator</a></li>
<li><a href="../214593/index.html">Self-propelled garden robots</a></li>
<li><a href="../214595/index.html">Fujitsu Webinar Fujitsu ServerView Suite Software</a></li>
<li><a href="../214597/index.html">HP Converged System Converged Platforms for Virtualization</a></li>
<li><a href="../214599/index.html">NetBeans: maintaining current versions of files from a remote server via ssh</a></li>
<li><a href="../214605/index.html">Globex GU5011B Review - MediaTek MT6582 quad-core solution</a></li>
<li><a href="../214607/index.html">How to send push notifications from your Rails application</a></li>
<li><a href="../214609/index.html">Stable Opera 20</a></li>
<li><a href="../214611/index.html">Digest of news of the Windows Azure platform, February 2014</a></li>
<li><a href="../214613/index.html">Control roboruku using leap motion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>