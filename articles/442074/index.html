<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stylish waterfall from RiME in the game engine: make the water flow</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the second (and last) part of the waterfall creation guide in Unity or UE4 after being inspired by the RiME game. In the first, we dealt with ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Stylish waterfall from RiME in the game engine: make the water flow</h1><div class="post__text post__text-html js-mediator-article"> This is the second (and last) part of the waterfall creation guide in Unity or UE4 after being inspired by the RiME game.  In the <a href="https://habr.com/ru/company/pixonic/blog/434620/">first, we</a> dealt with the tools, chose the development environment and created a circle shader on the water.  Why did you start with this?  It's simple: it uses most of the methods that are now needed when creating a waterfall.  But here there are also hints.  We will not pull - let's under the cat. <br><br><img src="https://habrastorage.org/webt/qr/mn/w2/qrmnw2qdz0twpkledjq7krzgvpe.gif"><br><a name="habracut"></a><br>  Let's start with the obvious - take the usual Panner and mesh.  You may be surprised: why so many polygons?  Like in <a href="https://simonschreibt.de/gat/stylized-vfx-in-rime/">Simon's waterfall</a> , I use vertex displacement to displace model vertices in 3D space through a shader.  And to make it look beautiful, we need additional peaks.  For optimization, you can create LOD meshes (Level Of Detail) with fewer polygons, and force Unity to switch to lower resolution models. <br><br><img src="https://habrastorage.org/webt/yw/pz/cf/ywpzcfxo4ezux9s55szmqtmk3my.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      UV suture is located at the back.  Even if the waterfall has no visible seams of texture, it is still better to hedge and place the UV seams in the least visible places for the player. <br><br>  As in the case of mesh circles on the water, UV-scan should be with the least number of seams on the model when using tiling textures.  One side of the UV shell is tied to 0 in the direction of U, and the other to 1. Remember that the width of the UV shell must fit into the integer value of the U-space (for example, tiling 1, 2 or 3).  If we hitch 1.2 times in the direction of U, then a seam will appear at the junction.  And we need a seamless tiling texture. <br><br><img src="https://habrastorage.org/webt/fe/gf/wi/fegfwibej9wk6dhs734bvctsa3a.jpeg"><br><br>  This is how a normal map looks tiled 3 times in a U-direction.  Notice how the right side of the 3D image ideally falls in 1 in the U-direction.  Setting the tiling to 3 in the U direction means that the texture repeats 3 times between 0 and 1 in the U direction (the image below shows the UV space from 0 to 1). <br><br><img src="https://habrastorage.org/webt/2x/z2/s5/2xz2s5csjdsxlfsay62vvrmggnq.png"><br><br>  For example, here is the same texture tiled 2.2 times - a seam appeared immediately.  For many, this is obvious, but it is important to understand why and how you should place your UV-scan in certain scenarios.  We work with panning tiling textures, and besides, we do not need stitches, so we need to adapt the UV scan. <br><br><img src="https://habrastorage.org/webt/bd/kk/md/bdkkmd5spr83l7ux538khbbrmhe.jpeg"><br><br>  To make the picture more complete, look at the gif, where I move the UV map.  In one, the width of the UV shell is exactly 1 (perfectly hidden), the other is trimmed so that the seam is visible.  Since we only use tiling textures, the UV map does not have to be between 0 and 1. <br><br><img src="https://habrastorage.org/webt/36/ig/0t/36ig0twz0bd8ln0c5b-suk7ud7g.gif"><br><br>  At the waterfall (as with circles on the water) I also distorted the UV-map.  Therefore, when using Panner, the texture moves faster or slower at certain points in the mesh.  Additional polygons in this case make the transition between distorted areas less noticeable.  Try turning on soft selection for UV curvature - this is how smooth transitions are made. <br><br><img src="https://habrastorage.org/webt/nb/u_/6r/nbu_6ry4rio5yhgndqrhelxif6a.gif"><br><br>  Notice how the texture is more stretched on the bend of the waterfall - this effect can be adjusted in different ways.  Always imagine switching from UV to 3D.  The closer the vertices of UV are to each other, the faster the texture will move along these UVs in 3D space when using Panner.  If you move the UV vertices farther apart, the texture will appear more often on this area of ‚Äã‚Äãthe mesh and move more slowly in 3D space when using Panner.  Experiment until you get the desired effect. <br><br><img src="https://habrastorage.org/webt/gz/-w/mz/gz-wmzgewq48wkyvg7djsce4mti.gif"><br>  <i>Note: This is a new material.</i>  <i>Create a new material and apply a new shader on it (see <a href="https://habr.com/ru/company/pixonic/blog/434620/">part 1</a> ).</i> <br><br>  We again use one texture with multiple options for Panner speed / direction, as well as UV tiling (flip one of them, giving a negative U value).  Add them on top of each other to get a more casual effect.  And use their output to add many other settings: opacity, color variation and vertex displacement. <br><br><img src="https://habrastorage.org/webt/qc/ks/dy/qcksdynqdbihlyfhrx0pqbw6ihq.gif"><br><br>  I also used scrolling normal maps.  Only one, because it moves so fast with two Panner for variation, that in this case there will be no difference.  Multiply it with a blue value of 1 (255 is indicated on the gif, this is when each channel has 256 steps, from 0 to 255), and also red and green values ‚Äã‚Äãequal to 60 (or a value of 0.23 if you use the scale from 0 to 1).  As a result, a too-saturated normal map became smoother and calmer.  To return more intense normals, keep the R and G values ‚Äã‚Äãthe same and increase them.  So you get a little more customization inside the shader itself. <br><br><img src="https://habrastorage.org/webt/lx/i7/ch/lxi7chekbzb8xyvxpdqkmgmucaa.gif"><br><br>  We set up a mesh, UV, and other components that will be needed to make the waterfall work.  Let's analyze a few things on this gif: <br><br><img src="https://habrastorage.org/webt/qa/pz/zf/qapzzf8nruvfjb_pe9nzaoknb6s.gif"><br><br>  On it, the flow of water scrolls through the 3D mesh and is torn down.  It can be seen that the type of transparent cut-out rendering is used here - the waterfall is completely opaque or completely transparent.  Water changes color when it approaches the ground, and looks less smooth on white areas.  Vertex displacement, about which we spoke earlier, is also noticeable.  All these factors give the waterfall a more vibrant and natural look.  Now more - let's start with color. <br><br>  I use <a href="http://wiki.amplify.pt/index.php%3Ftitle%3DUnity_Products:Amplify_Shader_Editor/Lerp">Lerp</a> (linear interpolation) with two colors and a scrolling black and white texture, which was made at the beginning, as alpha (input signal).  This texture basically serves as a mask to choose between showing blue or white.  And Add connects to the vertex color node (node ‚Äã‚Äãwith vertex colors). <br><br><img src="https://habrastorage.org/webt/bk/zj/mi/bkzjmiql_sfs8k92wnkp9c_lc2a.gif"><br><br>  The following shows the vertex colors used.  They work like vertex colors from the first part ‚Äî that is, as a gradient.  Colors are needed to make sure water gets whiter to the bottom of the waterfall.  As we add vertex colors over the existing color (the whitest point is vertex color = 1), we can easily exceed the value 1. If this happens, we will get too bright and oversaturated results.  Therefore, at the end there is a Clamp so that the maximum values ‚Äã‚Äãdo not exceed 1 (for a Clamp, the minimum = 0, and the maximum = 1).  Using white and blue colors ensures that when water is ‚Äúbroken‚Äù, it will be in the white (foamed) area of ‚Äã‚Äãthe mesh and get a white border around transparent areas.  The lighter the vertex color, the more vertices stick out.  Thus, the end of the waterfall, which is brighter in vertex color, moves more chaotically.  The bend of the waterfall is also a bit lighter - hence its speed. <br><br><img src="https://habrastorage.org/webt/bf/r1/id/bfr1id-0wluszfm7d50vil-4ste.jpeg"><br><br>  Next, I made two additional meshes inside the main waterfall - so that a sense of volume appeared.  The other two meshes are modified versions of the main mesh, with the same UV.  They are slightly offset and modified so that the material looks different on all three meshes.  This method does not take performance, but it helps a lot. <br><br><img src="https://habrastorage.org/webt/qr/mn/w2/qrmnw2qdz0twpkledjq7krzgvpe.gif"><br><br>  Additionally, we connect the <a href="http://wiki.amplify.pt/index.php%3Ftitle%3DUnity_Products:Amplify_Shader_Editor/Fresnel">fresnel</a> in the emission channel to create a fake light that passes through the water.  Fresnel makes a pixel as light as the normal vector on the surface of a 3D object is deflected from the camera and as dark as the normal vector is directed into the camera (perpendicular to the camera). <br><br>  If you look at an angle, the waterfall becomes more ‚Äúthin‚Äù - here fresnel comes in handy to show more fake light in these zones.  In this case, it is impossible for the waterfall to glow - to reduce the effect, I used min node.  Fresnel is often used with water shaders to change color depending on the viewing angle.  Connecting 0 (black) to emission will not do anything, and connecting 1 (white) will make it an un-lit shader, which will look completely lit from all sides (even if it is in the shade). <br><br><img src="https://habrastorage.org/webt/jj/jj/bh/jjjjbh3vc-8g3wycbgbvuwvcogg.gif"><br><br>  To make it smooth, I flip vertex color using one minus node.  If you scroll a little higher, you will see that the vertex color is light below and dark above.  Turning them over (so that it becomes light above and dark below), you can make the lower part of the waterfall less smooth compared to the top.  Darker values ‚Äã‚Äãare less smooth surface, and lighter values ‚Äã‚Äã- smoother. <br><br><img src="https://habrastorage.org/webt/1_/ac/bb/1_acbbb2nxklhzl-xtbnhkrz55c.jpeg"><br><br>  Vertex displacement or vertex offset is an important thing to realize this effect.  By shifting the peaks, the waterfall looks less static and therefore more alive. <br><br>  This is a waterfall without vertex displacement: <br><br><img src="https://habrastorage.org/webt/mz/7p/ki/mz7pkiho3saqawgcua8jrzmiq8e.gif"><br><br>  But with vertex displacement: <br><br><img src="https://habrastorage.org/webt/8d/ln/of/8dlnofaiqpdtrw3gk8gxbjvp4he.gif"><br><br>  By moving the peaks based on our scrolling black and white texture, the waterfall becomes smoother.  If you send the value 0.5 to the vertex offset output of the main node, nothing will happen.  Try to keep gray with a value of 0.5 as the standard vertex value.  Anything lower than 0.5 will move in a negative direction, and anything higher than 0.5 will move in a positive direction. <br><br>  So how do we know in which direction the vertices will move?  What is up and down? <br><br>  In our case, we want to move the vertices away from the surface of the mesh.  A negative direction will mean that the vertex moves ‚Äúinwards‚Äù relative to the direction of the vertex normal on the surface, and the positive direction will move ‚Äúoutwards‚Äù.  For just such a vertex motion, we can use vertex normals.  Each vertex, even if it is just one ‚Äúpoint‚Äù in 3D space, has a direction assigned to it - vertex normal.  It is used to calculate how the surface of the mesh should be shaded.  In this example, I made a ball and asked in Maya the display of vertex normals (display&gt; polygons&gt; vertex normals).  Each vertex has a direction, which by default indicates the distance from the surface.  You can also edit any vertex normal and change its direction, but now the current suits us.  Now you can use it in the shader and specify in which direction to move the vertices. <br><br><img src="https://habrastorage.org/webt/0m/ul/hb/0mulhbplxjfi_s6p0ndvgfn8f1a.jpeg"><br><br>  Vertex normal node displays RGB values ‚Äã‚Äãthat are based on the normal direction of the vertices of the mesh.  In shaders and with normals in general, RGB values ‚Äã‚Äãare used to express the 3D-object XYZ coordinates in 2D space.  In order for our black and white Panner in the shader to move along the surface of a 3D object, we can use the RGB vertex normal values.  I added vertex color to the vertices so that the bottom of the mesh becomes more convex.  As well as several nodes to control the amount of displacement (this is normal if your values ‚Äã‚Äãare below 0 or above 1). <br><br><img src="https://habrastorage.org/webt/ut/lo/9i/utlo9ijazwjcvglbpmv4_r6j3-s.gif"><br><br>  For the demonstration I will give a sphere with vertex normal node, applied directly to the albedo (color) output of the main node. <br><br><img src="https://habrastorage.org/webt/cf/br/yj/cfbryjdr3a3aynhjsz9qnpr4zoy.jpeg"><br><br>  The output of the RGB (XYZ) vertex normal node is based on the vertex normals of the mesh, which gives us this result. <br><br>  Here is the complete node structure.  It shows where and how everything connects. <br><br><img src="https://habrastorage.org/webt/w1/ss/ur/w1ssurjvayfyef_kfho-x_whtk8.jpeg"><br><br>  I hope you have learned something new for yourself.  My goal was to provide a sufficient amount of knowledge and starting points for creating such a waterfall on my own.  To do such things, it is not necessary to know everything - enough basic things.  Of course, I didn‚Äôt just open Amplify and create this effect in one fell swoop - there were other attempts that didn‚Äôt work. <br><br>  Some more useful links on the topic: <br><br><ul><li>  <a href="https://www.youtube.com/watch%3Fv%3DYPy2hytwDLM%26t%3D1825s">Report by Julian Love</a> , who worked on Diablo as a VFX artist.  Speech is mainly about skills in effects, but many of the things shown are applicable to other types of realtime VFX. </li><li>  <a href="http://blog.littlechicken.nl/creating-a-textureless-pure3d-look-as-seen-in-oberons-court/">Blog Little Chicken Game Company</a> .  He is dedicated to creating game art without textures and interesting techniques to create a beautiful environment. </li><li>  My mastermind Simon Trumpler has many other interesting things on the site.  One of my favorites is the page with the so-called <a href="https://simonschreibt.de/game-art-tricks/">Game Art Tricks</a> . </li><li>  <a href="https://www.youtube.com/channel/UCEklP9iLcpExB8vp_fWQseg/videos">YouTube channel with videos about shaders</a> .  My favorites are those in which they recreate specific effects from games (in Unity). </li></ul></div><p>Source: <a href="https://habr.com/ru/post/442074/">https://habr.com/ru/post/442074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442062/index.html">Update stereotypes: how emodzhi help reproduce scenarios of non-verbal communication online</a></li>
<li><a href="../442064/index.html">Software degradation</a></li>
<li><a href="../442068/index.html">On the introduction of digital technologies in business, Russia ranked 3rd from the end</a></li>
<li><a href="../442070/index.html">Companies have finally attended to the development of IoT devices and their security.</a></li>
<li><a href="../442072/index.html">RxJava2 + Retrofit 2. Modify the adapter to handle the absence of the Internet on Android</a></li>
<li><a href="../442076/index.html">VKontakte has released an instant messenger for PC, very similar to Telegram</a></li>
<li><a href="../442078/index.html">Working with the Jira API with Python</a></li>
<li><a href="../442080/index.html">Micrometer Connection for Java Web Application</a></li>
<li><a href="../442082/index.html">How to simplify the study of Oracle database: "gentleman's set of" scripts</a></li>
<li><a href="../442084/index.html">Antiquities: a twenty year old camera on diskettes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>