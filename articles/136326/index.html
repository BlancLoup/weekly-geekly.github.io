<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Talking machine from the old cell phone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. Probably every person has old cell phones lying around. The battery died, the screen was scratched, just tired. 

 In some cases, such an ‚Äúo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Talking machine from the old cell phone</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr.  Probably every person has old cell phones lying around.  The battery died, the screen was scratched, just tired. <br><br>  In some cases, such an ‚Äúold‚Äù phone is a rather advanced device. <a name="habracut"></a><br>  For example the former daughter of the SonyEricsson Z310i - java, bluetooth, camera, gprs.  Why not use it to fulfill your old childhood dream - a radio-controlled machine with a camera on board?  And here several circumstances came together: a phone was lying around, a broken machine from somewhere without a remote control took shape, a younger son grew up, <a href="http://habrahabr.ru/blogs/controllers/122030/">an article</a> came to Habr√©, a website was found on the Internet. <br><br><h4>  So, the algorithm: </h4><br><ul><li>  user P presses buttons on T1 cell phone </li><li>  T1 transmits commands via bluetooth </li><li>  the machine carries on itself a T2 cell phone, which receives them and transmits them via the audio channel (wired hands-free) to the microcontroller <br></li><li>  MK, in turn, recognizes the commands and controls the engines, light bulbs and all the rest. </li><li>  T2 shoots what is happening on camera and transmits it back to T1, </li><li>  T1 transmits the resulting image via optical communication. </li><li>  ???? </li><li>  P rejoices </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Tools and materials </h4><br>  An order went to one of the stores, and after a while I became the owner of the STM32L-DISCOVERY debugging board, a mock-up board, an L293D engine driver, and any split-wire trivia. <br>  As a first step, the broken suspension of the machine was sealed, the engines checked, their consumption measured.  Documentation for a board, a processor and L293D is found on the Internet. <br>  IAR was selected as IDE. <br><br><h4>  Actions by hands </h4><br>  Naturally, all the stages of MK programming were completed - to blink, write something of your own on the LCD, to buzz.  A tester, a children's electronic designer, and an old oscilloscope were very helpful for debugging peripherals. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/13d/2fd/f18/13d2fdf18e2fb6aaa54d0f1635768a9e.jpg" alt="image"><br>  In general, writing code on the mic consists mostly of tasting and combining standard examples. <br>  The next stage is to prepare a board, solder the driver of the engine and try real control.  Along the edges of the MK board, almost all of his legs are pulled out onto fairly long pins with a standard pitch of 2.5 mm, and up and down.  To connect on weight, PBS-6 connectors were used.  The finished device on the typewriter itself is a piece of a mock-up board with the same connectors, i.e., a self-made shieldboard.  And here the driver of the engine is connected, and we already blink an incandescent bulb from the designer.  Now we solder the power to the connector under the GND and EXT_5V legs.  It is very successful that the power and control legs stand diagonally - the boards stick well together on just two connectors.  Solder the battery pack, the wires to the motors (it's funny that they can be confused - reprogramming the controller is easier than unraveling the wiring).  A small program - and now the blind and deaf machine goes back and forth, and performs a turn in 12 receptions. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/kU92g9XKJ3M%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhdN5HM3ewaGyQ6xPTJwS6cueu3Jg" frameborder="0" allowfullscreen=""></iframe><br><h4>  Command </h4><br>  After a brief googling and thoughtful looks in the oscilloscope, the simplest decision was made - the commands are encoded with sinusoidal signals of different frequencies.  From the side of the phone, the frequencies are generated by playing the WAV stream 8bit, mono, 8kHz sampling.  The sampling frequency dividers were selected as command frequencies, i.e.  160, 200, 250 ... 2000 Hz.  Thus, at this stage, we have 9 teams, of which 7 are used for movement (forward, backward, forward-left, backward-right ... stop). <br>  To measure the frequency on the side of the MC, a timer, interrupt and comparator are used.  The negative input of the comparator is switched to the internal reference voltage of 0.3 V (Vref / 4), the comparator output is set to trigger an interrupt when the leading edge of the pulse passes.  The 16-bit timer counts 8 MHz frequency pulses.  At the time of the interruption, the timer counter value is read and compared with the previous count.  In case of detection of 5 approximately identical impulses in a row, the team is considered to be accepted.  In order for the machine to stop in the event of exit from the reception area, the telephone-console periodically transmits zero bytes in between the commands.  If the phone receiver does not receive any commands for about 200 ms, the motors are turned off. <br><br><h4>  And on this joyful note, problems begin. </h4><br>  It turned out that the selected phone does not support bluetooth from under java.  another half-dead phone, the SonyEricsson C702, is so overwhelmed with the Achh in the upper frequencies that the commands are not recognized.  The third phone - my main Samsung B2100 - has an incredible number of bugs in java, which is almost impossible to work with.  The camera on the C702 manages to produce some incredible size photos, which are then long and tediously transmitted via bluetooth. <br>  In addition to all this, when debugging the sound reproduction scheme, I unsuccessfully poked the oscilloscope probe into the board.  The cheerful light and a trickle of smoke made me say goodbye to the MK board, but it turned out that everything was not so bad.  I just burned the diode in the power supply circuit of the programmer and one of the outputs of the MK.  Now, for firmware and debugging of the program, it is necessary to connect not only USB, but also battery power, and the burned out output had to be re-soldered to a free working pin. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/41e/5fd/6b5/41e5fd6b537de4b57475a5f49056f60a.png" alt="image"><br><br>  As a result, adjustments were made to the initial idea - the voltage in the sound path is compared with the ground, and the photos taken from the camera are clamped in JPEG 100 * 160 pixels before transmission. <br><br><h4>  Sound path, lead and lights </h4><br>  The presence of a DAC controller and a fairly large amount of flash memory (128kb) suggested that you can teach the machine to speak.  To do this, we wrote down 2 wave files with the little boy and added them to the program.  I had to record sounds on my wife‚Äôs netbook with Windows XP, because  standard means of seven can not record a WAV file in PCM 8bit.  (by the way, tell the program to simplify the conversion of sound files).  To enhance the sound, a K174un24 chip is used, the sound is output to 2 8 ohm 1W speakers. <br><br>  <a href="http://sourceforge.net/projects/bluetoothcar/">Project Page at SourceForge</a> <br><br>  As a final touch, finger batteries were replaced with a 6V 4.7Ah lead battery.  In parallel, the main engine was soldered white LEDs as headlights.  The machine has acquired "patsansky" xenon, the mass and dynamics of this jeep, the drawdown of the suspension and the roar of the engine. <br><br><h4>  And the project is over. </h4><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/uEYASZO3sCs%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhvndJsODyKD5LQfhgGipq4pGYgAw" frameborder="0" allowfullscreen=""></iframe><br>  The machine can move around by a team, takes pictures and speaks in an inhuman voice.  This project was my first step into the world of artisanal robotics, which brought me together with wonderful people and re-taught me how to hold a soldering iron in my hands.  However, the continuation of this project will not be, because the initial idea itself is not very justified. <br><br><h5>  Platform j2me demonstrated all its inherent wretchedness. </h5><br>  Despite the seemingly unified and branched api, the preponderance of bugs and shortcomings in implementations does not allow to use all the inherent capabilities.  The security system always requests access to phone resources.  On the control panel, you can put up with it, but on a typewriter - it interferes terribly.  Processing and transferring even small images takes an insane time - about 5 seconds.  Talking about the transfer of video or images in any real time does not make sense. <br><br><h5>  Iron </h5><br>  The L293D chip is very convenient to use, but, unfortunately, it is made on bipolar transistors, and at a supply voltage of 5-6V, half of the battery energy is spent on heating the global space.  Well, inexpensive machine from the supermarket is not a good mechanical platform. <br><br>  Realizing all this, I decided to stop the development of the project, and the first step was followed by the second one - Wi-Fi, cameras and more advanced electronics. </div><p>Source: <a href="https://habr.com/ru/post/136326/">https://habr.com/ru/post/136326/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136319/index.html">We disassemble iPhone Core Data Recipes. Part 1</a></li>
<li><a href="../136321/index.html">Biosensors, or the Sixth Sense</a></li>
<li><a href="../136322/index.html">Competition for developers of Windows Phone 7</a></li>
<li><a href="../136323/index.html">5 basic anti-patterns of system administration</a></li>
<li><a href="../136324/index.html">RAW vs DNG</a></li>
<li><a href="../136328/index.html">Training course. Working with concurrency with the Entity Framework in an ASP.NET MVC application</a></li>
<li><a href="../136329/index.html">Organization of document circulation at the exchange of distant work</a></li>
<li><a href="../136330/index.html">I would go to U.M.N.IK. and ...</a></li>
<li><a href="../136331/index.html">Internet 2.0 Concepts</a></li>
<li><a href="../136333/index.html">Samsung's Smart Window</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>