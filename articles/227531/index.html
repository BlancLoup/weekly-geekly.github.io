<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ElasticSearch - mapping and search without surprises</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article will look at how and why to use mapping. Do I need it at all and in what cases. I will give examples of its installation, as well as try t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ElasticSearch - mapping and search without surprises</h1><div class="post__text post__text-html js-mediator-article">  The article will look at how and why to use mapping.  Do I need it at all and in what cases.  I will give examples of its installation, as well as try to share some useful tricks that can help you to improve the search on your site. <br><br>  Anyone who is interested in a modern search engine ElasticSearch, please under the cat. <br><a name="habracut"></a><br><br>  <i>In the <a href="http://habrahabr.ru/company/smartprogress/blog/227131/">last</a> general vote, this topic was selected.</i>  <i>In this article I will post a vote again, please participate.</i>  <i>I will try to write the most complete cycle of articles on ES, if it will be interesting to the public.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Why do you need mapping? </h4><br>  Mapping is similar to table definition in sql databases.  We explicitly specify the type of each field and additional parameters, such as analyzer, default value, source, and so on.  More details below. <br><br>  We can specify mapping when creating an index, thereby determining for one query for all types in the index. <br><pre><code class="bash hljs">curl -XPOST <span class="hljs-string"><span class="hljs-string">'http://localhost:9200/test'</span></span> -d <span class="hljs-string"><span class="hljs-string">'{ "settings" : { "number_of_shards" : 1 }, "mappings" : { "type1" : { "_source" : { "enabled" : false }, "properties" : { "field1" : { "type" : "string", "index" : "not_analyzed" } } } } }'</span></span></code> </pre> <br><br>  We can also specify mapping directly for a certain type in the index: <br><pre> <code class="bash hljs">$ curl -XPUT <span class="hljs-string"><span class="hljs-string">'http://localhost:9200/twitter/tweet/_mapping'</span></span> -d <span class="hljs-string"><span class="hljs-string">'{ "tweet" : { "properties" : { "message" : {"type" : "string", "store" : true } } } }'</span></span></code> </pre><br><br>  And we can specify mapping for several indices at once: <br><pre> <code class="bash hljs">$ curl -XPUT <span class="hljs-string"><span class="hljs-string">'http://localhost:9200/kimchy,elasticsearch/tweet/_mapping'</span></span> -d <span class="hljs-string"><span class="hljs-string">'{ ... }'</span></span></code> </pre><br><br><h4>  Is it necessary? </h4><br>  ES does not require explicit definition of data types in the document.  In most simple cases, it determines the data type correctly. <br>  So why then should it be determined? <br>  Well, firstly, it is useful for the purity of the code and the confidence that is currently stored in the index. <br>  An important feature of the mapping is the fine tuning of data and their processing, because  we can specify whether to analyze the field, whether to store the source.  Let's look at most of the possibilities by example. <br><br><h4>  Base data types </h4><br>  I think everyone already guessed what was going on.  There are 7 basic types: <b>string, integer / long, float / double, boolean, null</b> <br><br>  Example: <br><pre> <code class="bash hljs">$ curl -XPUT <span class="hljs-string"><span class="hljs-string">'http://localhost:9200/twitter/tweet/_mapping'</span></span> -d <span class="hljs-string"><span class="hljs-string">'{ "tweet" : { "_source" : {"enabled" : false}, "properties" : { "user" : {"type" : "string", "index" : "not_analyzed"}, "message" : {"type" : "string", "null_value" : "na", "store": true}, "postDate" : {"type" : "date"}, "priority" : {"type" : "integer"}, "rank" : {"type" : "float", "index_name" : "rating"} } } }'</span></span></code> </pre><br><br>  Here we have specified additional parameters: <br><ol><li>  <code>"_source" : {"enabled" : false}</code> - Thus, we indicated that it is not necessary to store the source data for this type.  When it may need?  For example, you have a very heavy document with a bunch of information that you only need to index, but you do not need to display in the answer </li><li>  <code>"store": true</code> for the message field indicates that this source field must be stored in the index </li><li>  <code>"index" : "not_analyzed"</code> - here we indicated that this field should not be analyzed, i.e.  should be stored as is.  <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/analysis-analyzers.html">What are analyzers</a> </li><li>  <code>"null_value" : "na"</code> - default value for the field </li><li>  <code>"index_name" : "rating"</code> - here we specified the alias for the field.  Now we can refer to it as a "rank" and to "rating" </li></ol><br><br>  <b>Note:</b> By default, _source = true and the entire document is stored in the index in its original state and returned upon request.  And it works faster than storing separate fields in the index, provided that your document is not huge.  Then storing only the required fields can give a profit.  Therefore, I do not recommend touching this field for no good reason. <br><br><h5>  Types of array / object / nested </h5><br>  We can specify not only the type of array for the field, but also specify the type for each field inside the array, here is an example: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#source { "tweet" : { "message" : "some arrays in this tweet...", "lists" : [ { "name" : "prog_list", "description" : "programming list" }, { "name" : "cool_list", "description" : "cool stuff list" } ] } } #mapping { "tweet" : { "properties" : { "message" : {"type" : "string"}, "lists" : { "properties" : { "name" : {"type" : "string"}, "description" : {"type" : "string"} } } } } }</span></span></code> </pre><br>  For objects, everything is the same, except that it can be dynamic (by default it is). <br>  Those.  You can add a new field to an object at any time and it will be added without errors. <br>  You can disable it like this: <code>"dynamic" : false</code> .  You can read more <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-object-type.html">here</a> . <br><br><h6>  Nested type </h6><br>  Essentially, we define a document within a document.  Why do you need it?  A great example from the documentation: <br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"obj1"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"blue"</span></span>, <span class="hljs-string"><span class="hljs-string">"count"</span></span> : 4 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"green"</span></span>, <span class="hljs-string"><span class="hljs-string">"count"</span></span> : 6 } ] }</code> </pre><br><br>  If we search for <code>name = blue &amp;&amp; count&gt;5</code> then this document will be found to avoid such a scenario, you should use the nested type. <br>  Example: <br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"type1"</span></span> : { <span class="hljs-string"><span class="hljs-string">"properties"</span></span> : { <span class="hljs-string"><span class="hljs-string">"obj1"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"nested"</span></span>, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span>: <span class="hljs-string"><span class="hljs-string">"not_analyzed"</span></span>}, <span class="hljs-string"><span class="hljs-string">"count"</span></span> : {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span>} } } } } }</code> </pre><br><br>  It is not necessary to specify properties for the elements of the object, ES will do this automatically. <br>  To search for a nested type, use <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-nested-query.html">nested query</a> or <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-nested-filter.html">nested filter</a> . <br><br><h4>  Multi-fields </h4><br>  Starting with <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/_multi_fields.html">version 1.0,</a> this fine parameter has been added to all base types (except nested and object). <br>  What is he doing?  This parameter allows you to specify different mapping settings for one field. <br>  Why it may be necessary?  for example, you have a field by which you want to search and group.  If you disable the analyzer, the search will not work to its fullest, and if enabled, then we will be grouped not by raw data, but by processed data.  For example, St. Petersburg after the analyzer will be "St." and "Petersburg" (perhaps a slightly different way, but for example it will come down).  If we group by this field, we will not get what we wanted. <br><br>  Example: <br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"title"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"fields"</span></span>: { <span class="hljs-string"><span class="hljs-string">"raw"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span>: <span class="hljs-string"><span class="hljs-string">"not_analyzed"</span></span> } } }</code> </pre><br>  Now we can refer to the "title" for the search and to the "raw" for grouping and any other types of sorting. <br><br><h5>  The remaining types </h5><br>  ES supports 4 more data types: <br><ol><li>  <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-ip-type.html">ip type</a> - ip storage in the form of numbers </li><li>  <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-geo-point-type.html">geo point type</a> - storing coordinates (conveniently when searching for nearest objects to a specific coordinate) </li><li>  <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-geo-shape-type.html">geo point type</a> - a rather specific type for storing certain polygons. </li><li>  <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-attachment-type.html">attachment type</a> - Storing files in a base64-encoded database.  Usually used in conjunction with its own analyzer.  (Although as for me, the pleasure is dubious) </li></ol><br>  I did not consider these types in detail, because  they are quite specific or do not fundamentally differ from the ones discussed above (for example, IP). <br><br>  I hope that I was able to lucidly talk about the main functions of the mapping in ES.  If you have questions, I will be glad to answer. <br><br>  Other articles on ES: <br>  <a href="http://habrahabr.ru/company/smartprogress/blog/227131/">ElasticSearch - data aggregation</a> <br>  <a href="http://habrahabr.ru/company/smartprogress/blog/226749/">ElasticSearch and search vice versa.</a>  <a href="http://habrahabr.ru/company/smartprogress/blog/226749/">Percolate API</a> <br><br> <a href="https://smartprogress.do/"><img src="https://habrastorage.org/getpro/habr/post_images/52b/7d4/88b/52b7d488b26969ab5e60319395742893.jpg" align="left"></a> <br>  - Achievements of goals </div><p>Source: <a href="https://habr.com/ru/post/227531/">https://habr.com/ru/post/227531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227519/index.html">Simple implementation of a user support tool in the SaaS Quickme service</a></li>
<li><a href="../227521/index.html">For beginners about stdafx.h</a></li>
<li><a href="../227523/index.html">Human rights activists demand to deprive Iran of the Internet</a></li>
<li><a href="../227527/index.html">Tail wind energy</a></li>
<li><a href="../227529/index.html">Why Vase drowned, and C ++ still afloat</a></li>
<li><a href="../227533/index.html">Database backup - is it there?</a></li>
<li><a href="../227537/index.html">‚ÄúFrost-bitten‚Äù computer and useful ‚ÄúHryuker‚Äù: what will surprise NeoQUEST-2014</a></li>
<li><a href="../227539/index.html">How to prepare for the PMP exam for an experienced project manager</a></li>
<li><a href="../227541/index.html">Android JNI + Intelij Idea + Gradle. Full process automation</a></li>
<li><a href="../227543/index.html">Addon for generating materials Cycles Blender</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>