<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make online logging from scratch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Described below is a weekend design. A couple of evenings were spent from idea to implementation. The description presents the necessary minimum for t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make online logging from scratch</h1><div class="post__text post__text-html js-mediator-article">  Described below is a weekend design.  A couple of evenings were spent from idea to implementation.  The description presents the necessary minimum for the implementation of the information collection system, with access to the latter online. <br><img src="https://habrastorage.org/getpro/habr/post_images/a3c/b34/f12/a3cb34f127beaf020107c82c243c0956.png" alt="image"><br><a name="habracut"></a><br>  Already in the process of writing this note, an article appeared: <a href="http://habrahabr.ru/post/245285/">Wintering cacti with online temperature control</a> .  In the beginning I was frightened that they were ahead, however, although the task being solved in both cases is close, the implementation is radically different. <br>  The architecture of the resulting system is shown in the diagram: <br><img src="https://habrastorage.org/getpro/habr/post_images/905/c44/527/905c445270f7a5e4fb36bed26e0755ea.png" alt="image"><br>  As you can see, the client part is fully implemented in the microcontroller.  The system is easily scaled and configured for any needs. <br><br><h3>  Device </h3><br>  The basis of the client is the Keil MCB2300 board, which has been idle for a long time.  The board is built on the LPC2368 microcontroller, it is quite old (at the moment it is more reasonable to use LPC1768 instead of it), but it is stuffed with everything necessary.  There is an Ethernet interface on the board, which in this case is a ‚Äúwindow to the world‚Äù.  As a data source, BMP085, which I have known for a long time, is used as a data source; it is connected via the I <sup>2</sup> C interface. <br><img src="https://habrastorage.org/getpro/habr/post_images/f4f/ba4/e0b/f4fba4e0bf47317acde160b0edee949e.jpg" alt="image"><br>  Software for testing the server and verifying the operation of HTTP requests was written within the Win32 application: <br><img src="https://habrastorage.org/getpro/habr/post_images/e86/a10/743/e86a107437b57bb9eaabfdf43d87092c.png" alt="image"><br>  In the future, the same logic passed into the microcontroller.  Currently, the request is addressed to a specific IP address, but it is better to use a DNS client, since  theoretically, the hosting operator can transfer the site within its address space.  You can also add an NTP client to send data to the server immediately with a time stamp. <br>  This project is my first trial of working with TCP / IP protocol on a microcontroller.  The basis is an example of EasyWeb, which is offered for many boards with Ethernet as a starter.  The main cycle of the program turned out to be crooked, however, I don't want to comb it, because  the necessary functionality has already been implemented, but I want to try to transfer this application to the uIP stack, because by its internal structure I like it more. <br>  The main cycle of the program: <br><ol><li>  We read data from the sensor. </li><li>  Open the connection. </li><li>  Sends an HTTP GET request to the server. </li><li>  If 10 seconds have passed, and the protocol of communication with the server has not passed, we break the connection on timeout. </li><li>  We are waiting for 1-5 minutes.  This wait sets the data retention interval. </li></ol>  And here is the look of the whole device: <br><img src="https://habrastorage.org/files/b3e/585/1dd/b3e5851ddc764b5eb270d4fe221afdf4.jpg"><br><br><h3>  Server </h3><br>  The server part is deployed on a regular hosting.  The main requirement for it: support for PHP.  Data is saved as CSV files.  The scripts are as simple as possible, the functionality is divided into 2 files: <br><ul><li>  <b>add.php</b> - script to add data to the log file.  Gets the file parameter with the file name to be written and the data parameter with the data to be written.  The first column of the script adds the timestamp.  There is also a clear function that allows you to clear the log file. </li><li>  <b>get.php</b> - display data from the log file.  Gets the only file parameter with the file name. </li></ul><br>  All data is transmitted to the server as part of GET requests: <br><pre>  GET http: //server/add.php? File = temp &amp; data = 23.4; 99809 HTTP / 1.0 \ r \ n \ r \ n </pre><br>  But the contents of the CSV file: <br><pre>  1418069433; 23.4; 99809
 1418069443; 23.4; 99811
 1418069453; 23.4; 99818
 1418069464; 23.4; 99801 </pre><br>  Each line contains a time stamp, temperature and pressure in Pascals. <br><h4>  Graphic output </h4><br>  To make it look beautiful, other forms of data display can be organized on the server.  As a library of charts / graphs tried to use <a href="http://www.highcharts.com/">Highcharts</a> .  With him you can make here such a design: <br><img src="https://habrastorage.org/getpro/habr/post_images/a3c/b34/f12/a3cb34f127beaf020107c82c243c0956.png" alt="image"><br>  This is not a live schedule, it is a screenshot of its view.  In a live view of the schedule you can see the links: <strike><a href="http://igorkov.org/stat1">Temperature</a> and <a href="http://igorkov.org/stat1">Pressure</a></strike> . <br>  <b>UPD:</b> Combined both graphs on one page: <a href="http://igorkov.org/stat1">Temperature / Pressure</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Files </h3><ul><li>  <a href="http://igorkov.org/zip/">Firmware sources for MCB2300 card</a> </li><li>  <a href="http://igorkov.org/zip/">Demonstration of working with logs</a> </li><li>  <a href="http://igorkov.org/zip/">Chart plugin</a> </li><li>  <a href="http://igorkov.org/zip/">Win32 application</a> </li></ul><br><h3>  Links </h3><ul><li>  <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php">Generating HTTP requests - Anton Kalmykov (Antonio)</a> </li><li>  <a href="http://www.binarytides.com/dns-query-code-in-c-with-winsock/">DNS Query Code in C with winsock</a> </li><li>  <a href="https://tools.ietf.org/html/rfc958">RFC958 - NTP Protocol Description</a> </li><li>  <a href="https://tools.ietf.org/html/rfc826">RFC826 - ARP Protocol Description</a> </li><li>  <a href="http://www.highcharts.com/">Highcharts library for building charts</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/245411/">https://habr.com/ru/post/245411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245397/index.html">Bank statements and PHP is just</a></li>
<li><a href="../245401/index.html">How we tried to implement Yandex.Kassa</a></li>
<li><a href="../245403/index.html">Hacker's guide to neural networks. Schemes of real values. Schemes with several logical elements</a></li>
<li><a href="../245405/index.html">How to use the GamePad in the browser and in Windows applications on HTML and JavaScript?</a></li>
<li><a href="../245407/index.html">HackDay for Superheroes, tha last call</a></li>
<li><a href="../245415/index.html">6 ways: how to add security for Rest service in Java</a></li>
<li><a href="../245419/index.html">From the experience of translating style guides</a></li>
<li><a href="../245421/index.html">Experience creating a home Wi-Fi router. general review</a></li>
<li><a href="../245425/index.html">Use MSP430-Launchpad as a programmer</a></li>
<li><a href="../245427/index.html">How best service attracts customers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>