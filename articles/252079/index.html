<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DuoCode: we translate C # in JavaScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is a programming language called C #. And there are so many developers who like it very much. And then there is a programming language called Ja...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DuoCode: we translate C # in JavaScript</h1><div class="post__text post__text-html js-mediator-article">  There is a programming language called C #.  And there are so many developers who like it very much.  And then there is a programming language called JavaScript.  Somehow it happened that not all C # developers like it.  Now imagine the situation: there is an avid C # developer.  He loves C # very much, he writes all the projects on it.  But fate decreed that he needed to write a client web application.  You know, such that the user does not need to download and install anything for himself, so that he can simply open any browser in any operating system on any device - and the application is already there.  And here our lyrical hero has a problem: it seems that JavaScript is perfect for this task, but for some reason you don‚Äôt really want to write on it.  Fortunately, in the modern world there are many languages ‚Äã‚Äãthat are translated into JavaScript (all sorts of <a href="http://www.typescriptlang.org/">TypeScript</a> , <a href="http://coffeescript.org/">CoffeScript</a> and thousands of others).  But our developer turned out to be very stubborn: he stubbornly does not want to change his beloved C # with "enemy" technologies. <br><br>  Fortunately for him, the happy future is almost here.  There is a project called <a href="http://duoco.de/">DuoCode</a> .  He can translate C # code in JavaScript.  While he is in beta, but he is already doing quite well: the innovations are supported C # 6.0, Generic types, Reflection, structures and LINQ, and you can debug final JavaScript on the original C #.  Let's take a closer look at what a product is. <br><br><img src="https://habrastorage.org/files/cf4/b40/d9e/cf4b40d9ed2c41ad93667444b809ecfb.png"><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Hello DuoCode </h3>  To understand what is happening is easiest with examples.  Let's start with the classic * Hello world *.  So, we have a wonderful C # code: <br><br><pre><code class="hljs pgsql">// Original C# code <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> DuoCode.Dom; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> static DuoCode.Dom.<span class="hljs-keyword"><span class="hljs-keyword">Global</span></span>; // C# <span class="hljs-number"><span class="hljs-number">6.0</span></span> <span class="hljs-string"><span class="hljs-string">'using static'</span></span> syntax namespace HelloDuoCode { static <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Program { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Greeter { private readonly HTMLElement element; private readonly HTMLElement span; private <span class="hljs-type"><span class="hljs-type">int</span></span> timerToken; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Greeter(HTMLElement el) { element = el; span = document.createElement("span"); element.appendChild(span); Tick(); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>() { timerToken = <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.setInterval((Action)Tick, <span class="hljs-number"><span class="hljs-number">500</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Stop() { <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.clearTimeout(timerToken); } private <span class="hljs-type"><span class="hljs-type">void</span></span> Tick() { span.innerHTML = string.Format("The time is: {0}", DateTime.Now); } } static <span class="hljs-type"><span class="hljs-type">void</span></span> Run() { <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Console.WriteLine("Hello DuoCode"); var el = document.getElementById("content"); var greeter = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Greeter(el); greeter.<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>(); } } }</code> </pre> <br>  With a slight movement of the hand, it turns into JavaScript: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// JavaScript code generated by DuoCode var HelloDuoCode = this.HelloDuoCode || {}; var $d = DuoCode.Runtime; HelloDuoCode.Program = $d.declare("HelloDuoCode.Program", System.Object, 0, $asm, function($t, $p) { $t.Run = function Program_Run() { System.Console.WriteLine$10("Hello DuoCode"); var el = document.getElementById("content"); var greeter = new HelloDuoCode.Program.Greeter.ctor(el); greeter.Start(); }; }); HelloDuoCode.Program.Greeter = $d.declare("Greeter", System.Object, 0, HelloDuoCode.Program, function($t, $p) { $t.$ator = function() { this.element = null; this.span = null; this.timerToken = 0; }; $t.ctor = function Greeter(el) { $t.$baseType.ctor.call(this); this.element = el; this.span = document.createElement("span"); this.element.appendChild(this.span); this.Tick(); }; $t.ctor.prototype = $p; $p.Start = function Greeter_Start() { this.timerToken = window.setInterval($d.delegate(this.Tick, this), 500); }; $p.Stop = function Greeter_Stop() { window.clearTimeout(this.timerToken); }; $p.Tick = function Greeter_Tick() { this.span.innerHTML = String.Format("The time is: {0}", $d.array(System.Object, [System.DateTime().get_Now()])); // try to put a breakpoint here }; });</span></span></code> </pre><br>  It looks like this: <br><br><img src="https://habrastorage.org/files/0f8/5a6/434/0f85a64345374ceeafa520fe5d0d634f.png"><br><br>  I'll tell you what you should pay attention to: <ul><li>  Syntax <code>using static</code> from C # 6.0 is supported. </li><li>  You can easily work with the console, which is displayed at the bottom of your application. </li><li>  Can work with DOM elements </li><li>  Timer works </li></ul>  Even this simple example is already pleasing.  But such an application is not so difficult to write on JavaScript itself.  Let's look at the examples more interesting. <br><br><h3>  Tic tac toe </h3>  The distribution includes an example of writing a great HTML game written in pure C #: <br><br><img src="https://habrastorage.org/files/ba7/c0b/e13/ba7c0be13b3940aeb3926fb1d7e8c86f.png"><br><br>  The game code includes <code>enum</code> s and indexers: <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> enum Player { <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>, X = <span class="hljs-number"><span class="hljs-number">1</span></span>, O = <span class="hljs-number"><span class="hljs-number">-1</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> sealed <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Board { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static Player Other(Player player) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Player)(-(<span class="hljs-type"><span class="hljs-type">int</span></span>)player); } private readonly Player[] Squares; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> readonly <span class="hljs-type"><span class="hljs-type">int</span></span> Count; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Player this[<span class="hljs-type"><span class="hljs-type">int</span></span> position] { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Squares[position]; } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Board() // empty board { //Squares = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Player[<span class="hljs-number"><span class="hljs-number">9</span></span>]; Squares = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Player[] { Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span> }; } private Board(Board board, Player player, <span class="hljs-type"><span class="hljs-type">int</span></span> position) : this() { <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Copy</span></span>(board.Squares, Squares, <span class="hljs-number"><span class="hljs-number">9</span></span>); Squares[position] = player; Count = board.Count + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Count == <span class="hljs-number"><span class="hljs-number">9</span></span>; } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Board <span class="hljs-keyword"><span class="hljs-keyword">Move</span></span>(Player player, <span class="hljs-type"><span class="hljs-type">int</span></span> position) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || position &gt;= <span class="hljs-number"><span class="hljs-number">9</span></span> || Squares[position] != Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>("Illegal move"); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Board(this, player, position); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Player GetWinner() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Count &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>; Player result; <span class="hljs-type"><span class="hljs-type">bool</span></span> winning = IsWinning(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result) || IsWinning(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result) || IsWinning(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result) || IsWinning(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result) || IsWinning(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result) || IsWinning(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result) || IsWinning(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result) || IsWinning(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } private <span class="hljs-type"><span class="hljs-type">bool</span></span> IsWinning(<span class="hljs-type"><span class="hljs-type">int</span></span> p0, <span class="hljs-type"><span class="hljs-type">int</span></span> p1, <span class="hljs-type"><span class="hljs-type">int</span></span> p2, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Player player) { <span class="hljs-type"><span class="hljs-type">int</span></span> count = (<span class="hljs-type"><span class="hljs-type">int</span></span>)Squares[p0] + (<span class="hljs-type"><span class="hljs-type">int</span></span>)Squares[p1] + (<span class="hljs-type"><span class="hljs-type">int</span></span>)Squares[p2]; player = count == <span class="hljs-number"><span class="hljs-number">3</span></span> ? Player.X : count == <span class="hljs-number"><span class="hljs-number">-3</span></span> ? Player.O : Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> player != Player.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>; } }</code> </pre><br>  Notice how you manage to manage with DOM elements: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">9</span></span>; i++) { Dom.HTMLInputElement checkbox = GetCheckbox(i); checkbox.checked_ = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; checkbox.indeterminate = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; checkbox.disabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; checkbox.onclick = OnClick; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random().Next(<span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) ComputerPlay(); UpdateStatus(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">dynamic</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Dom.MouseEvent e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> position = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.Parse(((Dom.HTMLInputElement)e.target).id[<span class="hljs-number"><span class="hljs-number">1</span></span>].ToString()); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { board = board.Move(Player.X, position); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { Dom.Global.window.alert(<span class="hljs-string"><span class="hljs-string">"Illegal move"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } Dom.HTMLInputElement checkbox = GetCheckbox(position); checkbox.disabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; checkbox.checked_ = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!board.Full) ComputerPlay(); UpdateStatus(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Dom.<span class="hljs-function"><span class="hljs-function">HTMLInputElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCheckbox</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name = <span class="hljs-string"><span class="hljs-string">"a"</span></span> + index.ToString(); Dom.HTMLInputElement checkbox = Dom.Global.document.getElementById(name).As&lt;Dom.HTMLInputElement&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> checkbox; }</code> </pre><br><h3>  Webgl </h3>  Want to work with WebGL?  No problems!  Take the C # code: <br><br><pre> <code class="hljs javascript">using DuoCode.Dom; using System; namespace WebGL { using GL = WebGLRenderingContext; internal <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Utils</span></span></span><span class="hljs-class"> </span></span>{ public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> WebGLRenderingContext CreateWebGL(HTMLCanvasElement canvas) { WebGLRenderingContext result = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; string[] names = { <span class="hljs-string"><span class="hljs-string">"webgl"</span></span>, <span class="hljs-string"><span class="hljs-string">"experimental-webgl"</span></span>, <span class="hljs-string"><span class="hljs-string">"webkit-3d"</span></span>, <span class="hljs-string"><span class="hljs-string">"moz-webgl"</span></span> }; foreach (string name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> names) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = canvas.getContext(name); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> WebGLShader CreateShaderFromScriptElement(WebGLRenderingContext gl, string scriptId) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shaderScript = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HTMLScriptElement</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Global</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">document</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getElementById</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">scriptId</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderScript == </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">) </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">throw</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"unknown script element "</span></span></span></span><span class="hljs-function"><span class="hljs-params"> + scriptId</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderSource</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderScript</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">; // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Now</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">figure</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">out</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">what</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">of</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shader</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">script</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">we</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">have</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">based</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">on</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">its</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MIME</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">int</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderType</span></span></span><span class="hljs-function"> = (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderScript.type == </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"x-shader/x-fragment"</span></span></span></span></span><span class="hljs-function">) ? </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GL</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FRAGMENT_SHADER</span></span></span><span class="hljs-function"> : (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderScript.type == </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"x-shader/x-vertex"</span></span></span></span></span><span class="hljs-function">) ? </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GL</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VERTEX_SHADER</span></span></span><span class="hljs-function"> : 0; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderType == </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">throw</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"unknown shader type"</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebGLShader</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shader</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">createShader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderType</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderSource</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shader, shaderSource</span></span></span><span class="hljs-function">); // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Compile</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">the</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shader</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">program</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">compileShader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shader</span></span></span><span class="hljs-function">); // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">See</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">compiled</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">successfully</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">!gl.getShaderParameter(shader, GL.COMPILE_STATUS</span></span></span><span class="hljs-function">)) { // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Something</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">went</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">wrong</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">during</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">compilation</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">the</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">var</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">errorInfo</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getShaderInfoLog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shader</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">deleteShader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shader</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">throw</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"error compiling shader '"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> + shader + </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"': "</span></span></span></span><span class="hljs-function"><span class="hljs-params"> + errorInfo</span></span></span><span class="hljs-function">); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shader</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">static</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebGLProgram</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CreateShaderProgram</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebGLRenderingContext gl, WebGLShader fragmentShader, WebGLShader vertexShader</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">var</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderProgram</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">createProgram</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attachShader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderProgram, vertexShader</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attachShader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderProgram, fragmentShader</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">linkProgram</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderProgram</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">linkStatus</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getProgramParameter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderProgram, GL.LINK_STATUS</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">!linkStatus</span></span></span><span class="hljs-function">) </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">throw</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"failed to link shader"</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shaderProgram</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">static</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebGLTexture</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LoadTexture</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebGLRenderingContext gl, string resourceName</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">var</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">createTexture</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">var</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">imageElement</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Properties</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Resources</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">duocode</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Image</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">imageElement</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">onload</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Func</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Event</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dynamic</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e</span></span></span><span class="hljs-function">) =&gt;</span></span> { UploadTexture(gl, result, imageElement); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> UploadTexture(WebGLRenderingContext gl, WebGLTexture texture, HTMLImageElement imageElement) { gl.pixelStorei(GL.UNPACK_FLIP_Y_WEBGL, GL.ONE); gl.bindTexture(GL.TEXTURE_2D, texture); gl.texImage2D(GL.TEXTURE_2D, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL.RGBA, GL.RGBA, GL.UNSIGNED_BYTE, imageElement); gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MAG_FILTER, GL.LINEAR); gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MIN_FILTER, GL.LINEAR_MIPMAP_NEAREST); gl.generateMipmap(GL.TEXTURE_2D); gl.bindTexture(GL.TEXTURE_2D, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); } public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> float DegToRad(float degrees) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (float)(degrees * System.Math.PI / <span class="hljs-number"><span class="hljs-number">180</span></span>); } } }</code> </pre><br>  And we apply DuoCode magic to it: <br><br><pre> <code class="javascript hljs">WebGL.Utils = $d.declare(<span class="hljs-string"><span class="hljs-string">"WebGL.Utils"</span></span>, System.Object, <span class="hljs-number"><span class="hljs-number">0</span></span>, $asm, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$t, $p</span></span></span><span class="hljs-function">) </span></span>{ $t.CreateWebGL = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Utils_CreateWebGL</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> names = $d.array(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, [<span class="hljs-string"><span class="hljs-string">"webgl"</span></span>, <span class="hljs-string"><span class="hljs-string">"experimental-webgl"</span></span>, <span class="hljs-string"><span class="hljs-string">"webkit-3d"</span></span>, <span class="hljs-string"><span class="hljs-string">"moz-webgl"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $i = <span class="hljs-number"><span class="hljs-number">0</span></span>, $length = names.length; $i != $length; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = names[$i]; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = canvas.getContext(name); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> ($e) {} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }; $t.CreateShaderFromScriptElement = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Utils_CreateShaderFromScriptElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gl, scriptId</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shaderScript = $d.cast(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(scriptId), HTMLScriptElement); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (shaderScript == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Exception.ctor$<span class="hljs-number"><span class="hljs-number">1</span></span>(<span class="hljs-string"><span class="hljs-string">"unknown script element "</span></span> + scriptId); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shaderSource = shaderScript.text; <span class="hljs-comment"><span class="hljs-comment">// Now figure out what type of shader script we have, based on its MIME type var shaderType = (shaderScript.type == "x-shader/x-fragment") ? 35632 /* WebGLRenderingContext.FRAGMENT_SHADER */ : (shaderScript.type == "x-shader/x-vertex") ? 35633 /* WebGLRenderingContext.VERTEX_SHADER */ : 0; if (shaderType == 0) throw new System.Exception.ctor$1("unknown shader type"); var shader = gl.createShader(shaderType); gl.shaderSource(shader, shaderSource); // Compile the shader program gl.compileShader(shader); // See if it compiled successfully if (!gl.getShaderParameter(shader, 35713 /* WebGLRenderingContext.COMPILE_STATUS */)) { // Something went wrong during compilation; get the error var errorInfo = gl.getShaderInfoLog(shader); gl.deleteShader(shader); throw new System.Exception.ctor$1("error compiling shader '" + $d.toString(shader) + "': " + errorInfo); } return shader; }; $t.CreateShaderProgram = function Utils_CreateShaderProgram(gl, fragmentShader, vertexShader) { var shaderProgram = gl.createProgram(); gl.attachShader(shaderProgram, vertexShader); gl.attachShader(shaderProgram, fragmentShader); gl.linkProgram(shaderProgram); var linkStatus = gl.getProgramParameter(shaderProgram, 35714 /* WebGLRenderingContext.LINK_STATUS */); if (!linkStatus) throw new System.Exception.ctor$1("failed to link shader"); return shaderProgram; }; $t.LoadTexture = function Utils_LoadTexture(gl, resourceName) { var result = gl.createTexture(); var imageElement = WebGL.Properties.Resources().get_duocode().Image; imageElement.onload = $d.delegate(function(e) { WebGL.Utils.UploadTexture(gl, result, imageElement); return true; }, this); return result; }; $t.UploadTexture = function Utils_UploadTexture(gl, texture, imageElement) { gl.pixelStorei(37440 /* WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL */, 1 /* WebGLRenderingContext.ONE */); gl.bindTexture(3553 /* WebGLRenderingContext.TEXTURE_2D */, texture); gl.texImage2D(3553 /* WebGLRenderingContext.TEXTURE_2D */, 0, 6408 /* WebGLRenderingContext.RGBA */, 6408 /* WebGLRenderingContext.RGBA */, 5121 /* WebGLRenderingContext.UNSIGNED_BYTE */, imageElement); gl.texParameteri(3553 /* WebGLRenderingContext.TEXTURE_2D */, 10240 /* WebGLRenderingContext.TEXTURE_MAG_FILTER */, 9729 /* WebGLRenderingContext.LINEAR */); gl.texParameteri(3553 /* WebGLRenderingContext.TEXTURE_2D */, 10241 /* WebGLRenderingContext.TEXTURE_MIN_FILTER */, 9985 /* WebGLRenderingContext.LINEAR_MIPMAP_NEAREST */); gl.generateMipmap(3553 /* WebGLRenderingContext.TEXTURE_2D */); gl.bindTexture(3553 /* WebGLRenderingContext.TEXTURE_2D */, null); }; $t.DegToRad = function Utils_DegToRad(degrees) { return (degrees * 3.14159265358979 /* Math.PI */ / 180); }; });</span></span></code> </pre><br>  You can independently poke a <a href="http://duoco.de/samples/webgl/index">demo</a> on the official site.  It looks like this: <br><br><img src="//habrastorage.org/files/278/8bd/179/2788bd179edc439aa810cd25bedfa4ff.png"><br><br><h3>  Raytracer </h3>  And this is not the limit!  One example includes the full-fledged RayTracer (with vector math, color and lighting, camera and surfaces ‚Äî all on pure C #): <br><br><img src="//habrastorage.org/files/bb3/6e5/268/bb36e526874c43bba572a79966ed43e7.png"><br><br><h3>  Debugging </h3>  It sounds incredible, but you can debug this miracle directly in the browser.  C # sources include: <br><br><img src="//habrastorage.org/files/dc7/0d5/825/dc70d5825959491c9b38860fcc416556.png"><br><br>  Currently, debugging is possible in VS 2015, IE, Chrome and Firefox. <br><br><h3>  A couple more examples </h3>  When broadcasting from C # to JavaScript, one of the most sensitive issues is structures.  Today, DuoCode only supports immutable structures, but for a good project this should be enough (as we know, mutable structures should be avoided). <br><br>  C #: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Point { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Point Zero = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> X; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { X = x; Y = y; } }</code> </pre><br>  Javascript: <br><br><pre> <code class="javascript hljs">HelloDuoCode.Program.Point = $d.declare(<span class="hljs-string"><span class="hljs-string">"Point"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">62</span></span>, HelloDuoCode.Program, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$t, $p</span></span></span><span class="hljs-function">) </span></span>{ $t.cctor = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $t.Zero = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloDuoCode.Program.Point.ctor$<span class="hljs-number"><span class="hljs-number">1</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }; $t.ctor = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.X = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Y = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; $t.ctor.prototype = $p; $t.ctor$<span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.X = x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Y = y; }; $t.ctor$<span class="hljs-number"><span class="hljs-number">1.</span></span>prototype = $p; });</code> </pre><br>  Personally, I am particularly pleased that there is full LINQ support: <br><br>  C #: <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static IEnumerable&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt; Foo() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Enumerable.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(x =&gt; x % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(x =&gt; x * <span class="hljs-number"><span class="hljs-number">3</span></span>); }</code> </pre><br>  Javascript: <br><br><pre> <code class="hljs php">$t.Foo = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Program_Foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> System.Linq.Enumerable.Select(System.Int32, System.Int32, System.Linq.Enumerable.Where(System.Int32, System.Linq.Enumerable.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), $d.delegate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>; }, this)), $d.delegate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x * <span class="hljs-number"><span class="hljs-number">3</span></span>; }, this)); };</code> </pre><br>  Small pleasures like <code>Generic</code> , <code>params</code> , <code>nullable</code> , method overloading, defaults are also included: <br><br>  C #: <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> :</span></span> IComparable&lt;T&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">? x, T y, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"value"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ System.Console.WriteLine((x ?? <span class="hljs-number"><span class="hljs-number">-1</span></span>) + y.ToString() + z); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, params object[] args)</span></span></span><span class="hljs-function"> </span></span>{ } } <span class="hljs-comment"><span class="hljs-comment">// Main new Foo&lt;int&gt;().Bar(null, 2);</span></span></code> </pre><br>  Javascript: <br><br><pre> <code class="javascript hljs">HelloDuoCode.Program.Foo$<span class="hljs-number"><span class="hljs-number">1</span></span> = $d.declare(<span class="hljs-string"><span class="hljs-string">"Foo`1"</span></span>, System.Object, <span class="hljs-number"><span class="hljs-number">256</span></span>, HelloDuoCode.Program, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$t, $p, T</span></span></span><span class="hljs-function">) </span></span>{ $t.ctor = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo$1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $t.$baseType.ctor.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }; $t.ctor.prototype = $p; $p.Bar$<span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo$1_Bar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y, z</span></span></span><span class="hljs-function">) </span></span>{ System.Console.WriteLine$<span class="hljs-number"><span class="hljs-number">10</span></span>($d.toString(($d.ncl(x, <span class="hljs-number"><span class="hljs-number">-1</span></span>))) + y.ToString() + z); }; $p.Bar = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo$1_Bar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">z, args</span></span></span><span class="hljs-function">) </span></span>{}; }, [$d.declareTP(<span class="hljs-string"><span class="hljs-string">"T"</span></span>)]); <span class="hljs-comment"><span class="hljs-comment">// Main new (HelloDuoCode.Program.Foo$1(System.Int32).ctor)().Bar$1(null, 2, "value");</span></span></code> </pre><br><h3>  Conclusion </h3>  Let me remind you that DuoCode is still in beta state, but today the list of features pleasantly pleases the eye: <br><br><img src="//habrastorage.org/files/e1f/3fb/f47/e1f3fbf472084f0296fb150f07518e2a.png"><br><br>  Development goes fast enough, there are constantly updates with new features.  Let's hope that we are literally a few steps away from that bright future, when you can write really complex client web applications in C #, using the full power of the language and related development tools. </div><p>Source: <a href="https://habr.com/ru/post/252079/">https://habr.com/ru/post/252079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252067/index.html">Writing a search plugin for Elasticsearch</a></li>
<li><a href="../252069/index.html">Testing flash storage. EMC XtremIO</a></li>
<li><a href="../252073/index.html">11 cool sites for iOS developers</a></li>
<li><a href="../252075/index.html">An interesting and at the same time simple slider on pure CSS3</a></li>
<li><a href="../252077/index.html">Discrete structures: matan for IT professionals</a></li>
<li><a href="../252083/index.html">GoogleFit API - start and see the result</a></li>
<li><a href="../252085/index.html">Course young fighter. Practical course on Cisco Packet Tracer</a></li>
<li><a href="../252091/index.html">Internet security: are users ready to counter cyber threats?</a></li>
<li><a href="../252095/index.html">The vulnerability of the "thumb": I hack your finger on the photo</a></li>
<li><a href="../252099/index.html">?.: when properties in C # can be null</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>