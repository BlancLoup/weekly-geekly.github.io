<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Specter and Meltdown</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everything is as always, we hear a ringing, but we do not know where he is. 
 The network has another drain of information about two vulnerabilities i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Specter and Meltdown</h1><div class="post__text post__text-html js-mediator-article"><h2>  Everything is as always, we hear a ringing, but we do not know where he is. </h2><br>  The network has another drain of information about two vulnerabilities in the hardware of modern processors.  Actually the vulnerability was open for public discussion one, but two methods of its operation were disclosed, under the names Specter and Meltdown. <br>  For specialists, this equipment problem has been known for a long time, it was "quietly" operated and everyone was happy ... <br><a name="habracut"></a><br>  For some unknown reason, it was decided to exaggerate the hype, and in an amateurish way, those who issued official press releases ( <a href="https://spectreattack.com/spectre.pdf">spectre.pdf</a> and <a href="https://meltdownattack.com/meltdown.pdf">meltdown.pdf</a> ) clearly had <a href="https://spectreattack.com/spectre.pdf">little</a> idea how it all worked and where the problem was. <br><br>  And the suppliers of the initial information did not bother to explain the problem in detail, apparently they gave a working exploit and a short description for amateurs ... <br><br>  Homebrew commentators and assembler experts began to intelligently explain how it all works. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here, for example, <a href="https://habrahabr.ru/post/346078/">an article</a> with a bunch of comments.  Especially touches it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ec/a3e/f02/0eca3ef027cb971ba18fe6f750820c32.png" alt="image"><br><br>  The ‚Äúnaive Chukchi guy‚Äù does not understand why the 1000h shift, and indeed how it all works, simply translates in his own words the same illiterate text of the original press release. <br><br>  We'll have to explain. <br><br><h3>  Real location of vulnerability in hardware </h3><br>  The vulnerability is located here, it is highlighted with a red circle: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/046/776/f98/046776f98cc7288adc790798b838df75.png" alt="image"><br><br>  The problem is in the TLB block, which is used in paging addressing of RAM.  It is an associative buffer storing pairs of values ‚Äã‚Äãof the virtual-physical address used by the application in RAM.  This is not a data cache .... <br><br>  Here is how Intel‚Äôs documentation describes it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba8/956/ec5/ba8956ec5f7da1c72f961df84da2edc1.png" alt="image"><br><br>  The TLB block is needed in order to shorten the time for accessing the OP by eliminating the procedure for translating memory addresses.  Such a broadcast is made only once for the entire page (just 4K in size in the case of modern OS).  All other program calls to memory in this page are already being forced, using the stored value in this buffer.  These blocks are in all modern processors, because of this, they are all susceptible to the vulnerabilities called Specter and Meltdown. <br><br>  And by the way, speculative execution of commands is not the only way to exploit these vulnerabilities, you can use the mechanism of forward data loading from the OP. <br><br>  The TLB block does not have a program (firmware) control, like a normal cache.  It is impossible to delete a record from it, or to force / make / modify any record. <br><br>  <b>This is a hardware vulnerability, all address translation produced is stored in this associative buffer.</b> <br><br>  Accordingly, the speculative operation carried out will also be left in the TLB block following in the form of a record; you only need to detect and identify this record.  And this is already a ‚Äúmatter of technology‚Äù, the technology has long been known and used, it is called ‚ÄúStudy of the state of the equipment by the method of temporary ringing‚Äù.  Do not look for this name on the Internet, the method was known in very narrow circles of completely non-public experts. <br><br>  <b>But now everyone will know him ...</b> <br><br>  The only possibility of programmatic influence on the TLB block is a complete reset of all its values ‚Äã‚Äã(well, here I‚Äôm a little cunning only for ease of understanding).  All patches for Specter and Meltdown vulnerabilities proposed by software makers do this by resetting the CR3 register in the GP exception exception handler. <br><br>  After resetting the TLB, the processor has to re-execute the translation of all used virtual memory pages, and this reduces system performance. <br><br><h3>  How all this is exploited in reality </h3><br>  The first thing you need to do in the program is to create a buffer of 2 megabytes in size, and you cannot write / read to this buffer before the attack and it should be located on the border of the 4K block.  This size is fundamental, exactly 256 pages of 4K should be placed in the buffer (specificity of paging addressing). <br><br>  Then execute commands like: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e66/55c/e3d/e6655ce3dea453864710e00ed3a8bc5d.png" alt="image"><br><br>  In the program after the command Mov al, [OS kernel address];  an interrupt will occur and the value of the al register will not change (will remain zero). <br><br>  But in the TLB buffer, due to a forward request for performing the operation, the computed correspondence between the virtual address and the physical address [ebx + eax] will be stored. <br>  It is impossible to reset this particular record, as it is done in a regular Kesh, in a TLB block, and it will remain ... <br><br>  Accordingly, if we know the address of a 4K page in a 2M buffer, stored in a TLB block, we will also know the value read from the OS kernel into the register al. <br>  This is already a matter of technology, ‚Äúlet's call‚Äù the TLB block.  To do this, you need to read all its 4K pages once, exactly 256 of them, we will perform 256 read operations (one for each 4K block).  At the same time, we will measure the time of the read operation.  The page that will be read faster than the rest, and will have a number in the 2M buffer corresponding to the read byte value from the OS kernel. <br><br>  This will happen because the TLB buffer for this page has already calculated the correspondence between the virtual and physical addresses, and for all other pages this operation has not yet been performed. <br><br>  In the ‚Äúringing‚Äù of course not everything is so simple, there are many nuances, but it is quite possible. <br>  Did, we know ... <br><br>  That's all. </div><p>Source: <a href="https://habr.com/ru/post/346164/">https://habr.com/ru/post/346164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346148/index.html">Configure Azure Application Insights for diagnosing software with microservice architecture</a></li>
<li><a href="../346152/index.html">The head of Intel suspected of selling the company's shares at $ 24 million due to the vulnerability of processors</a></li>
<li><a href="../346154/index.html">Simplify ReactJS Components with RxJs</a></li>
<li><a href="../346160/index.html">Open Source Cisco Cybersecurity Projects</a></li>
<li><a href="../346162/index.html">Do observers affect usability testing results?</a></li>
<li><a href="../346166/index.html">Choosing a reliable database in a high load project</a></li>
<li><a href="../346168/index.html">Top 10 universities in Europe to study IT</a></li>
<li><a href="../346170/index.html">Divide users by role in FeathersJs</a></li>
<li><a href="../346172/index.html">Moving to Japan</a></li>
<li><a href="../346174/index.html">Analyzing local functions in C # 7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>