<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ingredients of IoT Fast Food Delicacies: Intel Edison + Intel XDK + JavaScript + Grove Kit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How fast can you create a device for the Internet of Things (IoT), which is controlled through a browser, receives and transmits information, given th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ingredients of IoT Fast Food Delicacies: Intel Edison + Intel XDK + JavaScript + Grove Kit</h1><div class="post__text post__text-html js-mediator-article">  How fast can you create a device for the Internet of Things (IoT), which is controlled through a browser, receives and transmits information, given that you have never worked with microcontrollers, but only engaged in high-level JavaScript programming? <br><br><img src="https://habrastorage.org/files/575/615/523/575615523a324654b747b497eda5c2ac.jpg"><br><br>  For example, such a device as in the photo.  It has an LCD screen and a dial gauge on the servo.  Nearby is a phone with a running browser that is connected to the web server on the device.  When you click the arrows in the browser, the pointer is rotated to the right, left or set to the neutral position.  After setting the value, it is passed back to the browser and is shown as the Value value.  Additionally, in the browser, you can set a text string, which after pressing the ‚ÄúSet text‚Äù button is displayed on the LCD screen.  All interaction takes place over Wi-Fi.  How long do you think it will take to develop? <br><a name="habracut"></a><br>  If you think about it, you have a lot to do.  Write code in C / C ++, which runs on the device and interacts with the sensors, raise the web server, implement the backend, the front end, and put it all together.  In fact, everything is much simpler.  And I dare say that an hour is enough for everything about everything.  Why?  Yes, because there are ready-made solutions that can be combined and, thus, quickly make a prototype.  We'll take the Intel Edison board, the Intel XDK IoT Edition development environment, the Grove Kit sensor set, and just one programming language ‚Äî JavaScript.  Yes, no C / C ++.  It's simple, right out of the box. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will talk about everything in order, starting from the very beginning, so that even an unprepared developer is not lost.  Well, in the end we will look at the example described at the beginning. <br><br><h2>  <font color="#0071c5">Grove Starter Kit Plus - Intel IoT Edition Gen2</font> </h2><br><img src="https://habrastorage.org/files/c6d/664/773/c6d66477308b44f386773228104aa722.jpg"><br><br>  <a href="http://www.seeedstudio.com/depot/intel-iot-c-143/">The Grove Starter Kit</a> is a great thing.  I know that some programmers are afraid to work with radio electronics.  There are all kinds of wires, connections, soldering, radio components ... But this kit allows you to simplify the work.  All sensors are connected universally using standard connectors, which, if they so desire, cannot be connected incorrectly.  All connectors on the expansion card are signed.  It is enough to connect the necessary wires to the sensors and you can focus on the software part of the device. <br><br>  The kit includes: <br><br><ul><li>  Expansion card, with connectors for standard connection of all sensors. </li><li>  Light-emitting diode. </li><li>  Buzzer. </li><li>  Relay. </li><li>  The button is normal. </li><li>  Touch button. </li><li>  Rotation sensor </li><li>  Thermometer. </li><li>  Microphone. </li><li>  Light sensor. </li><li>  Servo. </li><li>  LCD screen. </li><li>  Wires with connectors. </li><li>  USB connectors. </li><li>  Connector for battery type Krone. </li></ul><br>  Of course, you can buy sensors and connect them yourself.  Yes, it will be cheaper, but here all the connectors are standard, all the wires are already in stock.  Even I, who are not frightened by soldering, are much more pleasant to simply plug in connectors and think not about where the wiring is, but about the program itself.  Moreover, I had a situation on the <a href="http://habrahabr.ru/post/255447/">hackathon</a> , when I quickly connected the sensors before the demonstration, I messed up the wires, supplying power to the sensor output.  Fortunately, nothing burned. <br><br><h2>  <font color="#0071c5">Intel XDK IoT Edition Development Environment</font> </h2><br><img src="https://habrastorage.org/files/21f/9d0/9cc/21f9d09cc0d948cfb43070be69df690d.png"><br><br>  <a href="https://software.intel.com/en-us/html5/xdk-iot">The Intel XDK development environment</a> allows you to create a JavaScript application on Node.js and run them on the Intel Edison and Intel Galileo boards.  This allows those developers who have previously written in JavaScript mainly for the web to try their hand at something new.  The advantage is that if earlier, in order to write for a microcontroller, you had to know C / C ++, now everything becomes much easier.  You just write your program on your favorite JavaScript, and it works. <br><br>  It is possible that an application written in JavaScript will be inferior in speed to the same, but in C ++.  But the fact is that the code is easier to write, yes, and the hardware is powerful now.  The advantage of the Intel XDK is also in the fact that downloading and launching the application onto the board with all the associated libraries and files is done by pressing a couple of buttons. <br><br>  Again I will give an example from the hakaton.  One of the teams told that they had long suffered from the implementation of their project.  We tried to make it work on both Python and C ++.  But just by going to JavaScript, everything turned out right away. <br><br><h2>  <font color="#0071c5">The difficulties that were in developing</font> </h2><br>  Sometimes the XDK could not connect to Edison.  In this case, the board worked on the serial port (emulation via USB).  The check showed that the WiFi on the board was not working.  It turned out that in my version of the board firmware there was a bug.  When you work with the D7 connector, Wi-Fi starts to work poorly.  After that, it is very problematic to make the board work normally.  Since the program starts automatically when the board is restarted.  I decided to only connect to USB with serial port emulation.  Having connected, I fixed the program so that it did not address D7 and restarted the board. <br><br><div class="spoiler">  <b class="spoiler_title">Here is a description of the problem.</b> <div class="spoiler_text">  <a href="">https://github.com/intel-iot-devkit/mraa/blob/master/docs/edison.md</a> - Arduino pin 7 can sometimes negatively impact the WiFi capability, if using WiFi avoid using this pin. <br>  The problem is fixed in the latest release: <br>  <a href="http://download.intel.com/support/edison/sb/edison_rn_332032009.pdf">http://download.intel.com/support/edison/sb/edison_rn_332032009.pdf</a> <br>  Resolved issues: <br>  EDISON-2356 Setting Arduino pin 7 to output causes Wi-Fi connection to become flaky. </div></div><br><h2>  <font color="#0071c5">Connection board</font> </h2><br>  I assume that you have already connected the Intel Edison board to a computer via USB or WiFi.  If not, then there are several ways.  You can enable serial port emulation via USB, this is an extreme microUSB connector.  You can enable USB network interface emulation, this is the middle microUSB connector.  You can use wifi.  Power can be connected via USB or using a power supply. <br><br><ul><li>  <a href="https://software.intel.com/en-us/connecting-your-intel-edison-board-using-wifi">Connecting your Intel Edison board using Wi-Fi</a> </li><li>  <a href="https://software.intel.com/en-us/connecting-to-intel-edison-board-using-ethernet-over-usb">Connecting to your Intel Edison board using Ethernet over USB</a> </li><li>  <a href="https://software.intel.com/ru-ru/setting-up-serial-terminal-on-system-with-windows">Setting up a serial terminal on a system with Windows</a> </li><li>  <a href="https://software.intel.com/ru-ru/setting-up-serial-terminal-on-system-with-mac-os-x">Setting up a serial terminal with Mac * OS X</a> </li><li>  <a href="https://software.intel.com/ru-ru/setting-up-serial-terminal-on-system-with-linux">Setting up a serial terminal on a system with Linux</a> </li></ul><br><h2>  <font color="#0071c5">MRAA Library</font> </h2><br>  To simplify the work with sensors from JavaScript there are special libraries.  One of them is MRAA.  It provides a fairly low level of work with the board. <br><br>  <a href="http://iotdk.intel.com/docs/master/mraa/index.html">http://iotdk.intel.com/docs/master/mraa/index.html</a> - MRAA Documentation <br><br>  Its main task is to set up a pin for input or output, output a zero or one, read the value of a digital or analog signal from a contact.  Can configure the pin to work in PWM (PWM) mode and set its parameters.  This is enough to blink the LED, read the state of the button, get the temperature value from the sensor, turn on the servo. <br>  Here, for example, the program to enable the on-board LED: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myOnboardLed = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mraa.Gpio(<span class="hljs-number"><span class="hljs-number">13</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   13-  myOnboardLed.dir(mraa.DIR_OUT); //     myOnboardLed.write(1); //      </span></span></code> </pre> <br>  But if you need to manage something more complicated, for example, an LCD screen, then this is not enough. <br><br><h2>  <font color="#0071c5">UPM library</font> </h2><br>  The next library is UPM.  It provides a higher level of work. <br><br>  <a href="http://iotdk.intel.com/docs/master/upm/node/">http://iotdk.intel.com/docs/master/upm/node/</a> - UPM documentation for Node.JS <br><br>  The library implements algorithms for controlling complex devices, such as screens, servomotors, etc. Otherwise, this would have to be done independently.  We will use it to control the LCD screen on the I2C serial bus. <br><br>  An example of a program that displays text on an LCD screen: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsUpmI2cLcd = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (<span class="hljs-string"><span class="hljs-string">'jsupm_i2clcd'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lcd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> jsUpmI2cLcd.Jhd1313m1(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0x62</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>); lcd.write(<span class="hljs-string"><span class="hljs-string">'Hello Edison!'</span></span>);</code> </pre> <br><h2>  <font color="#0071c5">Job Node.JS</font> </h2><br>  When you create an application in Intel XDK on a computer, you upload it to the board (the Upload button).  It will be placed in a folder, but will not run.  The project is located on the board in the /home/root/.node_app_slot folder. This link is configured from the root / node_app_slot <br><br>  The application sent to the board can be launched in two ways.  Or directly from the development environment with the Run button.  Or manually in the console on the board, for this you need to go to the / node_app_slot folder and execute the command <br><br><pre> <code class="bash hljs">node main.js</code> </pre> <br>  If you restart the Edison board, the application starts automatically.  To prevent this from happening, you can either remove the start of the daemon from the autorun, or remove or rename the main.js file, which is easier. <br><br>  Now we will look at all the sensors that come with the Grove Starter Kit Plus (Intel IoT Edition) in groups by connection type. <br><br><h2>  <font color="#0071c5">LED, buzzer, relay</font> </h2><br><img src="https://habrastorage.org/files/baa/fff/63b/baafff63bf9341b38369bc7233951378.jpg"><br><br>  All these devices are connected to a digital output.  You can use D2-D8.  When the unit is fed, they turn on, turn off at zero. <br><br><h3>  <font color="#0071c5">Light-emitting diode</font> </h3><br>  Included are three LEDs - red, blue and green.  Choose any.  The LED device is polar, so it is important to connect it correctly.  It is necessary to insert the LED so that the long leg (anode) is in the slot marked with ‚Äú+‚Äù.  But if you connect wrong, it just will not shine. <br><br><img src="https://habrastorage.org/files/6cd/6e5/f04/6cd6e5f04e664e04b8948f9b5584dcf6.jpg"><br><br>  Connect it to D2 and blink. <br><br><img src="https://habrastorage.org/files/91b/501/61b/91b50161bc60462e863efe70edfea7cb.JPG"><br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*jslint node:true, vars:true, bitwise:true, unparam:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*jshint unused:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">//   mraa var mraa = require('mraa'); //  D2     var myOnboardLed = new mraa.Gpio(2); //    myOnboardLed.dir(mraa.DIR_OUT); var ledState = true; //   //      100  setInterval(periodicActivity,100); function periodicActivity() { myOnboardLed.write(ledState?1:0); //     ledState = !ledState; //     }</span></span></code> </pre> </div></div><br><h3>  <font color="#0071c5">Buzzer</font> </h3><br>  Buzzer or squeaker.  When voltage is applied, it starts beeping at the same frequency.  Connects to a digital output.  You can use the code as for with the LED. <br><br><h3>  <font color="#0071c5">Relay</font> </h3><br>  A relay is a switch that is controlled by a signal.  When a unit is applied, the switch closes the contacts; when applying a zero, it opens.  It can be used to control devices that are rated for voltages greater than 5V and currents greater than 0.5A and therefore are connected to an external power source.  For example, you can turn on the desk lamp.  The relay that comes with Grove has options of 10A x 250V.  It is 2.5 kW.  But this is the ultimate power.  I think the kettle should not be included in this way.  <font color="red">And if you switch the device with a supply voltage of 220 V, be careful, firstly, the voltage itself is dangerous to health, and secondly, if it gets onto the board, then it will most likely burn.</font> <br><br><h2>  <font color="#0071c5">PWM and LED brightness control</font> </h2><br>  And what if we want to produce an analog signal of the intermediate level, and not just zero and one?  Or how to turn on the LED at half brightness, if it has only two states?  This can be achieved using PWM - Pulse Width Modulation (PWM - Pulse-width modulation).  When used, the signal periodically changes from 1 to 0. <br><img src="https://habrastorage.org/files/af0/7ba/083/af07ba08386942ffba426180a1ce1f06.png"><br>  This happens every frame.  When the time of both levels is the same, then on average we get a value of 0.5.  Suppose the unit was 25% of the time, then the signal is the same, 0.25 of the maximum.  If we control the LED like this and the frame is chosen small enough, then due to the inertia of our vision we will see this average brightness value. <br><br>  Part of the digital connectors on the board can work in PWM mode, on the shield it is D3, D5, D6.  (On the Edison board itself, they are labeled with a "~"). <br><br>  To enable PWM you need to set several parameters.  The first is the repetition period of the signal, i.e. the frame size.  The second parameter is the time during which there will be one.  It can be set either as a factor of 0-1, or as a time value in ms. <br><br>  Here is an example in which the LED will flash, gradually changing its brightness. <br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*jslint node:true, vars:true, bitwise:true, unparam:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*jshint unused:true */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"mraa"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pwm3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mraa.Pwm(<span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">2000</span></span>; pwm3.enable(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); pwm3.period_us(frameSize); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> step = <span class="hljs-number"><span class="hljs-number">0.04</span></span>; setInterval(proc, <span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ value += step; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( value &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { value = <span class="hljs-number"><span class="hljs-number">0</span></span>; step = -step; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( value &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) { value = <span class="hljs-number"><span class="hljs-number">1</span></span>; step = -step; } pwm3.write(value); }</code> </pre> </div></div><br><h2>  <font color="#0071c5">The button is normal and touch</font> </h2><br><img src="https://habrastorage.org/files/d51/6d9/dfb/d516d9dfb00f4e229302aac78d0ed956.jpg"><br><br>  The buttons are connected to the digital inputs D2-D8.  Give the unit if they clicked.  The difference from each other is that the touch button is a capacitive sensor and therefore triggers from a light touch and works even through a layer of paper. <br><br>  Create an application that will display the state of the button. <br>  Connect the button to the D8: <br><br><img src="https://habrastorage.org/files/a37/56d/bf0/a3756dbf0bfc401187464c09cd83aa0c.JPG"><br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*jslint node:true, vars:true, bitwise:true, unparam:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*jshint unused:true */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    D8 var myButton = new mraa.Gpio(8); //    myButton.dir(mraa.DIR_IN); //    getButton(); //  20    function getButton() { var b = myButton.read(); console.log('button='+b); setTimeout(getButton,20); }</span></span></code> </pre> </div></div><br>  If, after launching, you press a button, you will see something similar. <br><br><img src="https://habrastorage.org/files/683/c4c/166/683c4c16676c4f408d32acb94e7c667a.png"><br><br><h2>  <font color="#0071c5">Rotation sensor, thermometer, microphone, light sensor</font> </h2><br><img src="https://habrastorage.org/files/430/6db/fbd/4306dbfbd192465e859f0b161582424f.jpg"><br><br>  All these sensors produce an analog signal of different levels depending on the external influence on them.  Connect to analog inputs A0-A3.  The signal value is 0-1023. <br><br><h3>  <font color="#0071c5">Rotation sensor</font> </h3><br>  Returns the angle at which it is rotated.  Values ‚Äã‚Äãrange from 0-1023. <br>  Connect it to A0. <br><br><img src="https://habrastorage.org/files/63b/a12/9ec/63ba129ec16644e8963d78226461266e.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*jslint node:true, vars:true, bitwise:true, unparam:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*jshint unused:true */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//require mraa //   A0 var myRotary = new mraa.Aio(0); getRotary(); function getRotary() { var b = myRotary.read(); console.log('rotary='+b); setTimeout(getRotary,20); }</span></span></code> </pre> </div></div><br>  When you start the program and rotate the knob, you will see something like this. <br><br><img src="https://habrastorage.org/files/e19/58a/7ab/e1958a7abe174e64a4fb530c7629554e.png"><br><br><h3>  <font color="#0071c5">temperature sensor</font> </h3><br>  As you can guess, it returns the temperature value.  But it is not enough just to count the value, since this will be the relative resistance of the thermistor.  To convert to degrees, it is better to use the UPM library.  So, let's connect the sensor to A0. <br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*jslint node:true, vars:true, bitwise:true, unparam:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*jshint unused:true */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> groveSensor = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jsupm_grove'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   A0 var temp = new groveSensor.GroveTemp(0); setInterval(getTemp,100); function getTemp() { var celsius = temp.value(); console.log('temp='+celsius); }</span></span></code> </pre> </div></div><br>  The library function returns only an integer value.  If you need a more accurate value, you can use the following code, which uses the value directly from the sensor. <br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*jslint node:true, vars:true, bitwise:true, unparam:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*jshint unused:true */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//require mraa var temp = new mraa.Aio(0); setInterval(getTemp,100); function getTemp() { var sens = temp.read(); var celsius = convertTemp(sens); console.log('temp='+celsius); } function convertTemp(sensorValue) { var resistance=(1023-sensorValue)*10000/sensorValue; //  var temperature=1/(Math.log(resistance/10000)/3975+1/298.15)-273.15;//convert by datasheet ; return temperature; }</span></span></code> </pre> </div></div><br><h3>  <font color="#0071c5">Microphone</font> </h3><br>  The microphone produces a sound level.  Connect to A1.  Values, as usual for an analog input, are in the range from 0 to 1023. <br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*jslint node:true, vars:true, bitwise:true, unparam:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*jshint unused:true */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myMic = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mraa.Aio(<span class="hljs-number"><span class="hljs-number">1</span></span>); getLevel(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lev = myMic.read(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'level='</span></span>+lev); setTimeout(getLevel,<span class="hljs-number"><span class="hljs-number">20</span></span>); }</code> </pre> </div></div><br><h2>  <font color="#0071c5">Servo</font> </h2><br><img src="https://habrastorage.org/files/2d5/0da/230/2d50da2301ef4896ae8cb99e858b6334.jpg"><br><br>  A more interesting thing is the servo drive, this is a motor that turns at a given angle (0-180 degrees) and tries to maintain this position. <br><br>  To set the angle, it is necessary to apply a pulse of a certain duration (duty cycle).  Such impulses must come constantly, usually 50 times per second (20 ms).  But the period of arrival is not so important, the duration is important.  It can be from 500 Œºs to 2000 Œºs.  With a minimum pulse value, an angle of 0 degrees is established, with a maximum of 180 degrees. <br><img src="https://habrastorage.org/files/3b6/6c1/7b2/3b66c17b2d38427bae3c9082ce90caca.png"><br>  For different servo drives, the pulse widths may vary.  They can be selected experimentally.  <b>But you have to be careful.</b>  <b>If the duration value is outside the allowable range, then the servomotor starts to knock and heats up very much.</b>  <b>Immediately disconnect it from the connector!</b>  When working properly, it should turn to a given angle, stop and shut up, while remaining cold. <br><br>  We will use a digital output that can output a PWM signal.  These are pins D3, D5, D6. <br><br>  It should be noted that due to the fact that PWM can only accept 256 values ‚Äã‚Äãas an input and it‚Äôs impossible to use all the values ‚Äã‚Äãfor filling, but only a small part, it turns out that the servo does not have many fixed angles, I got about 20. <br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     var frameSize = 20000; //    D3 var pwm3 = new mraa.Pwm(3); pwm3.enable(true); pwm3.period_us(frameSize); //      var minServoTime = 420; //      var maxServoTime = 2000; //   0-1 var value = 0.5;//    , 90  //    var servoVal = Math.floor(minServoTime + (maxServoTime - minServoTime) * (1-value)); pwm3.pulsewidth_us(servoVal);</span></span></code> </pre></div></div><br><h2>  <font color="#0071c5">LCD screen</font> </h2><br><img src="https://habrastorage.org/files/121/440/fd5/121440fd51214c67a43cc42f15c2ea0a.jpg"><br><br>  The screen is more complex than the LED, so it connects to a special I2C serial bus. <br><br>  The screen can display text in 2 lines of 16 characters each.  There are RGB lights.  The documentation says that it supports English and Japanese, and there is the ability to add a certain number of its characters. <br><br>  Since the devices are connected to the I2C bus in parallel, all the connectors on the board are equivalent, and the screen can be inserted into any of them. <br><br><img src="https://habrastorage.org/files/b8a/6d0/fcb/b8a6d0fcb7d64301b9193d5d7c52873a.jpg"><br><br>  We use the UPM library. <br><br>  <a href="http://iotdk.intel.com/docs/master/upm/node/classes/jhd1313m1.html">http://iotdk.intel.com/docs/master/upm/node/classes/jhd1313m1.html</a> - work with this screen. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsUpmI2cLcd = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (<span class="hljs-string"><span class="hljs-string">'jsupm_i2clcd'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lcd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> jsUpmI2cLcd.Jhd1313m1(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0x62</span></span>); lcd.setColor(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">53</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-string"><span class="hljs-string">'Hello Edison!'</span></span>);</code> </pre> <br><br><h2>  <font color="#0071c5">Putting it all together</font> </h2><br>  So we looked at all the devices that are in the Grove Starter Kit Plus.  Let's try to collect something more interesting that simultaneously uses several modules. <br><br>  We will have a rotation sensor (A0), during rotation of which the servo (D3) will turn to the appropriate angle.  The found pulse width of the PWM to rotate at this angle will be displayed on the LCD screen (I2C). <br><br><img src="https://habrastorage.org/files/f37/195/73b/f3719573b2ba48bc98bd8b68740e4912.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*jslint node:true, vars:true, bitwise:true, unparam:true */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*jshint unused:true */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsUpmI2cLcd = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (<span class="hljs-string"><span class="hljs-string">'jsupm_i2clcd'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lcd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> jsUpmI2cLcd.Jhd1313m1(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0x62</span></span>); lcd.setColor(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">53</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myRotary = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mraa.Aio(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pwm3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mraa.Pwm(<span class="hljs-number"><span class="hljs-number">3</span></span>); pwm3.enable(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">20000</span></span>; pwm3.period_us(frameSize); setInterval(proc, <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     var maxRotary = 1023; var valueRate = value / maxRotary ; //    var minServoTime = 420; var maxServoTime = 2000; var servoVal = Math.floor(minServoTime + (maxServoTime - minServoTime)*valueRate); //     pwm3.pulsewidth_us(servoVal); //     lcd.setCursor(0,0); lcd.write('Time=' + servoVal + ' us '); }</span></span></code> </pre> </div></div><br><h2>  <font color="#0071c5">Creating a web server</font> </h2><br>  Since we are considering developing for IoT (Internet of Things), we need to make it possible to work with the device via the Internet.  The following example creates a web server that displays the current temperature on a temperature sensor.  The server listens to port 1337 and responds to the request to the site root.  The temperature sensor is connected to A0.  If your card has an address of 192.168.0.105, then in the browser indicate 192.168.0.105:1337. <br><br><div class="spoiler">  <b class="spoiler_title">Source code main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> groveSensor = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jsupm_grove'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> groveSensor.GroveTemp(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastSetVal = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>)(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).Server(app); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"url"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> numCalls = <span class="hljs-number"><span class="hljs-number">0</span></span>; app.get(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-string"><span class="hljs-string">'use strict'</span></span>; res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>}); res.write(<span class="hljs-string"><span class="hljs-string">'Intel Edison Sensor temperature '</span></span> + temp.value() + <span class="hljs-string"><span class="hljs-string">'&lt;sup&gt;o&lt;/sup&gt;C'</span></span>); res.end(); }); http.listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-string"><span class="hljs-string">'use strict'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'listening on *:1337'</span></span>); });</code> </pre> </div></div><br>  Work example: <br><br><img src="https://habrastorage.org/files/cc0/1d1/70f/cc01d170fe564f569d15496d886f915a.png"><br><br><h2>  <font color="#0071c5">Dessert - browser control</font> </h2><br><img src="https://habrastorage.org/files/575/615/523/575615523a324654b747b497eda5c2ac.jpg"><br><br>  So, promised at the very beginning.  Create a device controlled via a browser with an arrow on the servo and a screen.  And with each turn command from the client, it will return the actual set value in JSON format, since no turn occurs in the extreme positions.  And as a small bonus, you can send text to the connected LCD screen. <br><br>  The program consists of two parts.  One of them is on the Edison device.  This is a web server, main.js file.  It responds to requests from the client, servicing the servo and screen.  Uses the library express and http. <br><br>  The second part is on the client in the browser.  It receives commands from the user and sends them to the server.  Receives data from a web server in JSON format and displays it.  Uses jQuery library. <br><br>  This application will be a little more complicated.  In the project, create a public folder, put static content in it.  In our case, these are three images for the buttons - rotate_ccw.png, rotate_cw.png, rotate_center.png, html-file index.html, which is displayed in the client‚Äôs browser and the jquery-1.11.3.min.js library (It will need to be downloaded from official website <a href="https://jquery.com/download/">jquery.com/download</a> ) <br><br><img src="https://habrastorage.org/files/081/00f/dbd/08100fdbd7664579b89871a4c26821c6.png"><br><br>  On the client, the script monitors clicking on the images of arrows and when such an event occurs, sends a request to the server at the corresponding address / right, / left, / center and waits to receive JSON data with information about the position of the arrow.  When you click on the "Set text" button, the text from the input field is sent to the server. <br><br><div class="spoiler">  <b class="spoiler_title">Contents of the index.html file</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Rotation<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jquery-1.11.3.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">showVal</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">val</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"#val"</span></span></span><span class="javascript">).text(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Value='</span></span></span><span class="javascript">+val); } </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">left</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $.getJSON( </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"/left"</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params"> data </span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ showVal(data[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'value'</span></span></span><span class="javascript">]); } ) ; } </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">right</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $.getJSON( </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"/right"</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params"> data </span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ showVal(data[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'value'</span></span></span><span class="javascript">]); } ); } </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">center</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $.getJSON( </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"/center"</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params"> data </span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ showVal(data[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'value'</span></span></span><span class="javascript">]); } ); } </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">setText</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $.get(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"/text/"</span></span></span><span class="javascript">+$(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"#text"</span></span></span><span class="javascript">).val()); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"left();"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rotate_ccw.png"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center();"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rotate_center.png"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"right();"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rotate_cw.png"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"val"</span></span></span><span class="hljs-tag">&gt;</span></span>Value=0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"data"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Set text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"setText();"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br>  On the board, the screen is connected to I2C.  Servo connects to D3.  The server listens to port 1337.  The application is waiting for the appeal to / right.  With such a request, if possible, it is rotated to the right and a JSON response is sent with information about the position of the arrow.  An appeal to / left and / center is handled similarly.  If you type / text / abcdef, the string abcdef will be displayed on the LCD screen.  Work with the servo and the screen was discussed earlier. <br><br><div class="spoiler">  <b class="spoiler_title">Main.js content</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mraa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mraa'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//----- PWM ----- var value = 0.5; var step = 0.05; var frameSize = 20000; var pwm3 = new mraa.Pwm(3); pwm3.enable(true); pwm3.period_us(frameSize); setTime(value); //---------- LCD ---------- var jsUpmI2cLcd = require ('jsupm_i2clcd'); var lcd = new jsUpmI2cLcd.Jhd1313m1(0, 0x3E, 0x62); var express = require('express'); var http = require('http'); var app = express(); //     app.use(express.static(__dirname + '/public')); //   app.get('/left', function (req, res) { value = fitValue(value-step); setServoValue(res,value); }); //   app.get('/right', function (req, res) { value = fitValue(value+step); setServoValue(res,value); }); //    app.get('/center', function (req, res) { value = 0.5; setServoValue(res,value); }); //    LCD app.get('/text/:text', function (req, res) { var text = req.params.text; var t = text.toString().substring(0, 16); var vs = t + ' '.substring(0,16-t.length); lcd.setCursor(0,0); lcd.write(vs); console.log('value='+vs+'='); res.writeHead(200, {"Content-Type": "text/html"}); res.end(); }); //   http.createServer(app).listen(1337); //      JSON function setServoValue(res,v) { res.writeHead(200, {"Content-Type": "text/json"}); var text = '{"value":"'+value.toFixed(2)+'"}'; res.write(text); console.log(text); setTime(value); res.end(); } //     function setTime(valueRate) { var minServoTime = 420; var maxServoTime = 2000; var servoVal = Math.floor(minServoTime + (maxServoTime - minServoTime)*(1-valueRate)); pwm3.pulsewidth_us(servoVal); } //   function fitValue(v) { if( v &gt; 1 ) { v = 1; } if( v &lt; 0 ) { v = 0; } return v; }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Package.json Contents</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"PWM"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"main.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"engines"</span></span>: { <span class="hljs-string"><span class="hljs-string">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=0.10.0"</span></span> }, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"express"</span></span> : <span class="hljs-string"><span class="hljs-string">"latest"</span></span>, <span class="hljs-string"><span class="hljs-string">"http"</span></span> : <span class="hljs-string"><span class="hljs-string">"latest"</span></span> } }</code> </pre> </div></div><br>  Image rotate_ccw.png <br><img src="https://habrastorage.org/files/38e/e82/d1d/38ee82d1de9f4329a5deeedec5477267.png"><br><br>  Image rotate_cw.png <br><img src="https://habrastorage.org/files/072/edf/56e/072edf56e71b4d8fbc3ea66d130f23d2.png"><br><br>  Image rotate_center.png <br><img src="https://habrastorage.org/files/4db/f21/4f5/4dbf214f56cd49f3ac66ed037342faf1.png"><br><br>  That's all.  We start and check. <br><br><h3>  <font color="#0071c5">Demons Node.JS</font> </h3><br>  A few words about how demons work on the Intel Edison board. <br>  The system is running the xdk-daemon daemon.  If you stop it with the command: <br><br><pre> <code class="bash hljs">systemctl stop xdk-daemon</code> </pre> <br>  then the running Node.JS application will stop.  You can restart it with the command: <br><br><pre> <code class="bash hljs">systemctl start xdk-daemon</code> </pre> <br>  or restart: <br><br><pre> <code class="bash hljs">systemctl restart xdk-daemon</code> </pre> <br>  The program can be edited directly on the board (vi), just do not forget to restart it after the change.  Either way: <br><br><pre> <code class="bash hljs">systemctl restart xdk-daemon</code> </pre> <br>  Or, if the program was launched in the console via the command: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /node_app_slot node main.js</code> </pre> <br>  then you can stop it through &lt;Ctrl&gt; + &lt;C&gt; <br><br><h3>  <font color="#0071c5">Useful</font> </h3><br>  <b><font color="#0071c5">¬ª</font></b> <a href="http://habrahabr.ru/company/intel/blog/258157/">Play audio on Intel Edison via Bluetooth using the Advanced Audio Distribution Profile (A2DP)</a> <br>  <a href="http://habrahabr.ru/company/intel/blog/258159/">Installing OpenCV 3.0.0-rc1 (using IPP and TBB) on Intel Edison Yocto.</a>  <a href="http://habrahabr.ru/company/intel/blog/258159/">USB camera in OpenCV</a> <br>  <b><font color="#0071c5">¬ª</font></b> <a href="http://habrahabr.ru/company/intel/blog/258163/">Use the Intel Edison board to change the color of the Orbotix Sphero ball when new tweets appear</a> <br>  <b><font color="#0071c5">¬ª</font></b> <a href="http://habrahabr.ru/company/intel/blog/252919/">Connect to Intel Edison via Android with Bluetooth LE (BLE)</a> </div><p>Source: <a href="https://habr.com/ru/post/260259/">https://habr.com/ru/post/260259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260239/index.html">Haskell Code Generator</a></li>
<li><a href="../260249/index.html">Programmers and Depression</a></li>
<li><a href="../260253/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ164 (June 8 - 14, 2015)</a></li>
<li><a href="../260255/index.html">"Big battalions" in continuous time (battle simulation)</a></li>
<li><a href="../260257/index.html">PHP Digest 64 - interesting news, materials and tools (June 1 - 14, 2015)</a></li>
<li><a href="../260269/index.html">Antivirus Self-Defense</a></li>
<li><a href="../260271/index.html">Salad "Microsoft Guide for SymbolTable with a delicate aftertaste Antlr4"</a></li>
<li><a href="../260273/index.html">Challenge the tradition of hi-fi. Digital potentiometers in detail. Part two</a></li>
<li><a href="../260275/index.html">How we made the best release tracker tracker</a></li>
<li><a href="../260277/index.html">That the site did not fall: an economical method</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>