<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wireless communications "smart home". Part two, practical</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After writing a couple of big posts about ‚Äúradioed‚Äù smart home, there were quite a few people who wanted to get code that would help deal with this to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wireless communications "smart home". Part two, practical</h1><div class="post__text post__text-html js-mediator-article">  After writing a <a href="http://habrahabr.ru/post/171613/">couple of</a> <a href="http://habrahabr.ru/post/195884/">big</a> posts about ‚Äúradioed‚Äù smart home, there were quite a few people who wanted to get code that would help deal with this topic in more detail. <br>  For some reason I didn‚Äôt want to post my original version of the code - I prepared a ‚Äúlightweight‚Äù version that would explain my main ideas. <br><img src="https://habrastorage.org/getpro/habr/post_images/026/dec/bb6/026decbb6bfe1e77ef7698a15e1ae211.jpg"><br>  In order to make the post the most spectacular and useful, today we are implementing a home mini-system (clock, calendar, weather, monitoring battery charge levels in sensors, etc.) consisting of one ‚Äúmain‚Äù module (with a large LED matrix in as an indicator), two autonomous sensors (will measure the temperature) and a time synchronization module via NTP. <br><a name="habracut"></a><br>  First, a brief talk about the components of the project: <br><img src="https://habrastorage.org/getpro/habr/post_images/df5/bfd/78c/df5bfd78c1c3cb0904eb55842b086566.jpg"><br><h5>  Shield MaTrix </h5><br>  Expansion card for Arduino Mega (there <a href="http://toster.ru/q/48336">will be a</a> separate post about the process of its creation, but a little later).  This extension allows you to control the output of information on four 8x8 bicolor LED arrays, forming a single 32x8 field (the resolution is small, but the inscriptions are quite large). <br><img src="https://habrastorage.org/getpro/habr/post_images/f89/bb7/bb5/f89bb7bb5dd4b9d9cd541193f0b4b61c.jpg"><br>  Additionally, the board has: <br><ul><li>  Integrated clock module (RTC) - based on DS1307 with backup battery (CR1220 or CR1226) </li><li>  Interface for connecting the RF module nRF24L01 + </li><li>  Clock button (for example, to turn off the alarm sound) </li><li>  38 kHz IR receiver (for remote control) </li><li>  Wiring for connecting an RGB LED with a common cathode or anode (the choice is made by jumper) </li><li>  Light sensor (for example, to automatically adjust the brightness) </li><li>  Piezo emitter "squeaker" </li><li>  I2C interface </li><li>  xBee interface </li><li>  Interface to connect Arduino-shildov. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/c36/b9e/4aa/c36b9e4aae233b38bf7872f4f450b9f4.jpg"><br>  The module was developed "from what was" and made as simple as possible for users.  The display unit is built on well-known shift registers (74HD595D - LED control "in columns") and a demultiplexer (74HD138D - control "rows").  Naturally, dynamic display is used. <br><br>  In order to make it even easier to use - a <a href="https://github.com/stepanovalex/MaTrix">library</a> was written with basic primitives (‚Äúdisplay a line‚Äù, ‚Äúcreeping line‚Äù, brightness adjustment, there are several effects). <br><img src="https://habrastorage.org/getpro/habr/post_images/698/1fc/804/6981fc80425f0dd84064a16f7bc7e3ae.jpg"><br>  The shield itself does not contain an MK, you need to connect an ‚ÄúArduino Mega‚Äù or a compatible clone to it (I used <a href="http://devicter.ru/goods/Freaduino-Mega-ATMega-2560">one</a> ). <br><br>  Shield MaTrix scheme is available <a href="">by reference</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Sensor node </h5><br>  This is an arduino-compatible module built on the Atmega328 base, powered by one CR2032 lithium battery, having an on-board temperature sensor (MCP9700), a button, an LED, and three connectors for connecting possible extensions (sensors, etc.). <br><img src="https://habrastorage.org/getpro/habr/post_images/0f0/cd6/3ed/0f0cd63ed4fabbc586d53707b78b1402.jpg"><br>  From the sensor features: <br><ul><li>  Board size - 3x4 cm. </li><li>  Two nRF24L01 + power options: the module is powered continuously or taken from one of the digital pins (the choice is made by a jumper). </li><li>  Programming <a href="http://devicter.ru/goods/USBtinyISP-Arduino-bootloader-programmer">via ISP</a> or <a href="http://devicter.ru/goods/Foca-v2-1-FT232RL">FT232 based programmer</a> (or similar) from the Arduino environment. </li><li>  There is a voltage divider (for measuring the supply voltage) </li><li>  Two digital pins are output to the ‚ÄúDigital‚Äù connector (power is also present in the connector). </li><li>  Two analog pins - to the ‚ÄúAnalog‚Äù connector (there is also power). </li><li>  The I2C bus is a separate corresponding connector (also with power). </li><li>  MK clocking is possible both with the help of a 16 MHz quartz resonator installed on the board, and with the help of the built-in oscillator (this is, of course, not a ‚Äútrick‚Äù of a particular module, but simply the capabilities of atmega328). </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/8b9/d52/b83/8b9d52b83db8d45a14c2259456d0e720.jpg"><br>  About the development of this module, too, I will write an article, if there is interest among readers. <br><br>  In our case, to save the battery, we will use the MK with clocking from the internal oscillator at a frequency of 8 MHz and ‚Äúask‚Äù the MK to continue operating at reduced voltage (from 1.8V).  To do this, in the boards.txt file, add the following lines: <br><pre><code class="cpp hljs">s328o8.name=Sensor328 (int8MHz, <span class="hljs-number"><span class="hljs-number">1.8</span></span>V)

s328o8.upload.protocol=arduino
s328o8.upload.maximum_size=<span class="hljs-number"><span class="hljs-number">30720</span></span>
s328o8.upload.speed=<span class="hljs-number"><span class="hljs-number">19200</span></span>

s328o8.bootloader.low_fuses=<span class="hljs-number"><span class="hljs-number">0xe2</span></span>
s328o8.bootloader.high_fuses=<span class="hljs-number"><span class="hljs-number">0xda</span></span>
s328o8.bootloader.extended_fuses=<span class="hljs-number"><span class="hljs-number">0x06</span></span>
s328o8.bootloader.path=atmega

s328o8.bootloader.file=ATmegaBOOT_168_atmega328_pro_8MHz.hex

s328o8.bootloader.unlock_bits=<span class="hljs-number"><span class="hljs-number">0x3F</span></span>
s328o8.bootloader.lock_bits=<span class="hljs-number"><span class="hljs-number">0x0F</span></span>

s328o8.build.mcu=atmega328p
s328o8.build.f_cpu=<span class="hljs-number"><span class="hljs-number">8000000L</span></span>
s328o8.build.core=arduino
s328o8.build.variant=standard
</code></pre><br>
<br>
<b>UPD:</b>          2.4.     1.8       1.    :<br>
<br>
<pre><code class="cpp hljs">s328o1.name=Sensor328p (int1MHz, <span class="hljs-number"><span class="hljs-number">1.8</span></span>V)

s328o1.upload.protocol=arduino
s328o1.upload.maximum_size=<span class="hljs-number"><span class="hljs-number">30720</span></span>
s328o1.upload.speed=<span class="hljs-number"><span class="hljs-number">19200</span></span>

s328o1.bootloader.low_fuses=<span class="hljs-number"><span class="hljs-number">0x62</span></span>
s328o1.bootloader.high_fuses=<span class="hljs-number"><span class="hljs-number">0xda</span></span>
s328o1.bootloader.extended_fuses=<span class="hljs-number"><span class="hljs-number">0x06</span></span>
s328o1.bootloader.path=atmega

s328o1.bootloader.file=ATmegaBOOT_168_atmega328_pro_8MHz.hex

s328o1.bootloader.unlock_bits=<span class="hljs-number"><span class="hljs-number">0x3F</span></span>
s328o1.bootloader.lock_bits=<span class="hljs-number"><span class="hljs-number">0x0F</span></span>

s328o1.build.mcu=atmega328p
s328o1.build.f_cpu=<span class="hljs-number"><span class="hljs-number">1000000L</span></span>
s328o1.build.core=arduino
s328o1.build.variant=standard
</code></pre><br>
<br>
     ‚Äî  ,     . ,     Arduino     .        avrdude    ( avrdude GUI ‚Äî   ).<br>
<br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"> ,            ¬´   Sensor Node (SN)     ¬ª ‚Äî   . <br>
 :<br>
<ul>
<li> ¬´¬ª ,      </li>
<li>    8   </li>
<li>SN ¬´¬ª 1   8 ,     ,     (     ‚Äî   ,    ¬´¬ª)</li>
</ul><br>
   (   20 )      2.83.<br>
<img src="https://habrastorage.org/getpro/habr/post_images/28c/633/412/28c6334125ba99dcbcb1d76ebf1ae8be.jpg"><br>
 ,  ,     ,  ,    4     ,  <i></i>     , , ,   .<br>
</div></div><br>
   <a href=""> </a>.<br>
<br>
<h5>iBoard</h5><br>
     <a href="http://habrahabr.ru/post/171613/"></a>.    : 328, LAN   Wiznet W5100,   nrf24l01+, SD,     .<br>
      (    ) ‚Äî      .<br>
<br>
<h5>nRF24l01+</h5><br>
 RF-,   2.4.          .<br>
        <a href="https://github.com/maniacbug/RF24/">RF24</a> (   <a href="https://github.com/andykarpov/iBoardRF24">iBoardRF24</a>).<br>
<br>
<h4> </h4><br>
 ,     :<br>
<ul>
<li>  ,  , .</li>
<li>      ( ¬´¬ª  ¬´ ¬ª).</li>
<li>      .</li>
<li>   (        ).</li>
<li>   NTP-   /  .</li>
</ul><br>
     (       ),  - ,    ,         .<br>
<br>
      :<br>
<ol>
<li><b>Shield MaTrix</b>:       (iBoard ‚Äî   ¬´ /¬ª),  ,      ,    (  ),   ¬´¬ª    .</li>
<li><b>Sensor Node</b>:     ,           .     ,      (  ¬´¬ª ).</li>
<li><b>iBoard</b>:     DHCP,    NTP-,      ,   /      .</li>
</ol><br>
<br>
   , ,    . <br>
<blockquote>         .</blockquote><br>
<br>
<h4></h4><br>
       nRF24l01+ ‚Äî      ,     (  )   <a href=""></a>.<br>
<br>
    ,  ¬´ ¬ª    32  . <br>
  ‚Äî   ,     ¬´¬ª   .<br>
   :<br>
<pre><code class="hljs cpp"><span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class">{</span></span>         
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SensorID;        <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ParamID;         <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ParamValue;    <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Comment[<span class="hljs-number"><span class="hljs-number">16</span></span>];    <span class="hljs-comment"><span class="hljs-comment">// </span></span>
}
Message;</code></pre><br>
<br>
,   32     .<br>
<br>
     (SensorID): Shield MaTrix ‚Äî 100, Sensor Node 1 (SN1 ‚Äî ¬´¬ª) ‚Äî 200, SN2 (¬´¬ª) ‚Äî 300, iBoard ‚Äî 900.<br>
<br>
   ,        ‚Äî    ,      .<br>
<br>
      ,     ¬´¬ª   ,    ( , ¬´¬ª      2  ‚Äî        (    ‚Äî         )).<br>
<br>
  ,    ¬´¬ª    :<br>
<pre><code class="hljs cpp"><span class="hljs-comment"><span class="hljs-comment">///     </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class">{</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Value;         <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Note[<span class="hljs-number"><span class="hljs-number">16</span></span>];       <span class="hljs-comment"><span class="hljs-comment">// </span></span>
} 
Parameter;</code></pre><br>
<br>
   (Value)    float ( ,     ( ,       ) ‚Äî  ). <br>
 Note    ¬´ ¬ª (  ¬´TempIN, C¬ª ‚Äî   ). <br>
<br>
,    (Parameter)  ¬´¬ª     (Message).<br>
<br>
   . <br>
<br>
 SN1  SN2.     :<br>
<ol>
<li>  setup() ‚Äî </li>
<li>   loop():<ul>
<li>  </li>
<li>,    ¬´¬ª</li>
<li>   ‚Äî        </li>
<li> RF-</li>
<li>        </li>
<li> </li>
<li></li>
</ul></li>
</ol><br>
        (    8 ),     (  ) 8  ‚Äî   ,   ,         8- .       4 ,  , ,    30    ,      .<br>
   ‚Äî      RF- ( powerDown()  ).<br>
<br>
,        ‚Ä¶<br>
<br>
, ¬´¬ª     :<br>
<pre><code class="hljs objectivec">
Parameter MySensors[NumSensors+<span class="hljs-number"><span class="hljs-number">1</span></span>] = {    <span class="hljs-comment"><span class="hljs-comment">//   (  )</span></span>
  NumSensors, <span class="hljs-string"><span class="hljs-string">"SN1 (in)"</span></span>,            <span class="hljs-comment"><span class="hljs-comment">//   ""        </span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"TempIN, C"</span></span>,                        <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"VCC, V"</span></span>,                           <span class="hljs-comment"><span class="hljs-comment">//   (   )</span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"BATT"</span></span>                              <span class="hljs-comment"><span class="hljs-comment">//  ,     (0 -  "", 1 - "")</span></span>
};

Message sensor; 
</code></pre><br>
<br>
 ¬´¬ª:<br>
<pre><code class="hljs objectivec">
Parameter MySensors[NumSensors+<span class="hljs-number"><span class="hljs-number">1</span></span>] = {    <span class="hljs-comment"><span class="hljs-comment">//   (  )</span></span>
  NumSensors, <span class="hljs-string"><span class="hljs-string">"SN1 (in&amp;out)"</span></span>,        <span class="hljs-comment"><span class="hljs-comment">//   ""        </span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"TempIN, C"</span></span>,                        <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"VCC, V"</span></span>,                           <span class="hljs-comment"><span class="hljs-comment">//   (   )</span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"BATT"</span></span>,                             <span class="hljs-comment"><span class="hljs-comment">//  ,     (0 -  "", 1 - "")</span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"TempOUT, C"</span></span>                        <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
};

Message sensor;
</code></pre><br>
<br>
¬´¬ª         (TempIN),       (TempOUT),         . <br>
<br>
       ¬´¬ª  ¬´¬ª .  ¬´¬ª    ()      MCP9700 (    ¬´  ¬ª      ‚Äî           ,     .<br>
<br>
  ‚Äî   ,    MCP9700     .     (  ‚Äî , , ).             .  (   )       ¬´Analog¬ª).<br>
<img src="https://habrastorage.org/getpro/habr/post_images/865/96e/5cc/86596e5cc276fe7819b43cf35398c2a4.jpg"><br>
     .<br>
<br>
 ,         MCP9700    , ,       .<br>
<br>
    ,    (        SN  ,       328). <br>
     (    ,  , <a href="http://blog.unlimite.net/%3Fp%3D224"></a>). <br>
        :<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readVcc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-comment"><span class="hljs-comment">// Read 1.1V reference against AVcc</span></span>
  <span class="hljs-comment"><span class="hljs-comment">// set the reference to Vcc and the measurement to the internal 1.1V reference</span></span>
  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(__AVR_ATmega32U4__) || defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__)</span></span>
    ADMUX = _BV(REFS0) | _BV(MUX4) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1);
  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> defined (__AVR_ATtiny24__) || defined(__AVR_ATtiny44__) || defined(__AVR_ATtiny84__)</span></span>
    ADMUX = _BV(MUX5) | _BV(MUX0);
  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> defined (__AVR_ATtiny25__) || defined(__AVR_ATtiny45__) || defined(__AVR_ATtiny85__)</span></span>
    ADMUX = _BV(MUX3) | _BV(MUX2);
  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span></span>
    ADMUX = _BV(REFS0) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1);
  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta">  </span></span>

  delay(<span class="hljs-number"><span class="hljs-number">75</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Wait for Vref to settle</span></span>
  ADCSRA |= _BV(ADSC); <span class="hljs-comment"><span class="hljs-comment">// Start conversion</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (bit_is_set(ADCSRA,ADSC)); <span class="hljs-comment"><span class="hljs-comment">// measuring</span></span>

  <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> low  = ADCL; <span class="hljs-comment"><span class="hljs-comment">// must read ADCL first - it then locks ADCH  </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> high = ADCH; <span class="hljs-comment"><span class="hljs-comment">// unlocks both</span></span>

  <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> result = (high&lt;&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>) | low;

  result = <span class="hljs-number"><span class="hljs-number">1125300L</span></span> / result; <span class="hljs-comment"><span class="hljs-comment">// Calculate Vcc (in mV); 1125300 = 1.1*1023*1000</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; <span class="hljs-comment"><span class="hljs-comment">// Vcc in millivolts</span></span>
}
</code></pre><br>
<br>
      .<br>
<br>
       ,    SN1 ‚Äî 200:<br>
<pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{
  <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
  <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  MySensors[<span class="hljs-number"><span class="hljs-number">2</span></span>].Value = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) readVcc())/<span class="hljs-number"><span class="hljs-number">1000.0</span></span>;
  
  <span class="hljs-comment"><span class="hljs-comment">//    (  3)</span></span>
  MySensors[<span class="hljs-number"><span class="hljs-number">1</span></span>].Value = (((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)analogRead(A3) * MySensors[<span class="hljs-number"><span class="hljs-number">2</span></span>].Value / <span class="hljs-number"><span class="hljs-number">1024.0</span></span>) - <span class="hljs-number"><span class="hljs-number">0.5</span></span>)/<span class="hljs-number"><span class="hljs-number">0.01</span></span>;
  
  <span class="hljs-comment"><span class="hljs-comment">//    2.4 -  "" (1)</span></span>
  <span class="hljs-comment"><span class="hljs-comment">//   - " " (0)</span></span>
  MySensors[<span class="hljs-number"><span class="hljs-number">3</span></span>].Value = (MySensors[<span class="hljs-number"><span class="hljs-number">2</span></span>].Value &gt; <span class="hljs-number"><span class="hljs-number">2.4</span></span>) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; 
  
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;
}
</code></pre><br>
<br>
       SN2 (¬´¬ª ‚Äî 300):<br>
<pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{
  <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
  <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  MySensors[<span class="hljs-number"><span class="hljs-number">2</span></span>].Value = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) readVcc())/<span class="hljs-number"><span class="hljs-number">1000.0</span></span>;
  
  <span class="hljs-comment"><span class="hljs-comment">//    (  3)</span></span>
  MySensors[<span class="hljs-number"><span class="hljs-number">1</span></span>].Value = (((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)analogRead(A3) * MySensors[<span class="hljs-number"><span class="hljs-number">2</span></span>].Value / <span class="hljs-number"><span class="hljs-number">1024.0</span></span>) - <span class="hljs-number"><span class="hljs-number">0.5</span></span>)/<span class="hljs-number"><span class="hljs-number">0.01</span></span>;
  
  <span class="hljs-comment"><span class="hljs-comment">//    2.4 -  "" (1)</span></span>
  <span class="hljs-comment"><span class="hljs-comment">//   - " " (0)</span></span>
  MySensors[<span class="hljs-number"><span class="hljs-number">3</span></span>].Value = (MySensors[<span class="hljs-number"><span class="hljs-number">2</span></span>].Value &gt; <span class="hljs-number"><span class="hljs-number">2.4</span></span>) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; 
  
  <span class="hljs-comment"><span class="hljs-comment">//    (  1   "Analog")</span></span>
  MySensors[<span class="hljs-number"><span class="hljs-number">4</span></span>].Value = (((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)analogRead(A1) * MySensors[<span class="hljs-number"><span class="hljs-number">2</span></span>].Value / <span class="hljs-number"><span class="hljs-number">1024.0</span></span>) - <span class="hljs-number"><span class="hljs-number">0.5</span></span>)/<span class="hljs-number"><span class="hljs-number">0.01</span></span>;
  
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;
}
</code></pre><br>
<br>
,     ,     ¬´¬ª .<br>
<br>
 - ,     (       4     )      ‚Äî ¬´¬ª (mode = 1)  ¬´¬ª (mode = 2). <br>
 ¬´¬ª ,      8          .<br>
 ¬´¬ª    ,      4  (   ). <br>
¬´¬ª          10  (..  10   ¬´¬ª  ‚Äî   ).    ,      ,        .<br>
<br>
,  ¬´¬ª  .<br>
<br>
  -   ¬´ /¬ª (  iBoard). <br>
   /    ‚Äî   <a href="https://www.google.ru/search%3Fq%3Darduino%2Bntp%2Bwiznet"></a>. <br>
<br>
  ,      .<br>
   ¬´¬ª  -    /    float. <br>
<br>
   :      ¬´yymm.dd¬ª,   ‚Äî ¬´hhmm.ss¬ª.           float. <br>
<br>
,     ,   ¬´ /¬ª:<br>
<pre><code class="cpp hljs">Parameter MySensors[NumSensors+<span class="hljs-number"><span class="hljs-number">1</span></span>] = {    <span class="hljs-comment"><span class="hljs-comment">//   (  )</span></span>
  NumSensors, <span class="hljs-string"><span class="hljs-string">"iBoard NTP"</span></span>,              <span class="hljs-comment"><span class="hljs-comment">//   ""        </span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Date (yymm.dd)"</span></span>,                   <span class="hljs-comment"><span class="hljs-comment">// </span></span>
  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Time (hhmm.ss)"</span></span>                    <span class="hljs-comment"><span class="hljs-comment">// </span></span>
};

Message sensor; 
</code></pre><br>
<br>
     /      ,         (, , ,  ‚Äî ,    10   ,       (    )).<br>
<br>
     ‚Äî     ,      (        ):<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TimeOffset 4  </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   - GMT +4 ()</span></span></span></span>
</code></pre><br>
<br>
,   iBoard     SN,    ‚Äî       RF24 (iBoard       ¬´¬ª  ). <br>
<br>
 , ,   ‚Äî    (¬´ ‚Äî  ‚Äî  ‚Äî ¬ª),   ¬´¬ª ‚Äî   Shield MaTrix ‚Äî     ,         .<br>
<br>
 ¬´¬ª:         ,      ¬´¬ª (    ¬´¬ª  ),    ,    ,   Shield MaTrix. <br>
<img src="http://habrastorage.org/storage3/06d/56f/9cd/06d56f9cd2bf3b89edbd500f61dbabc6.jpg"><br>
  :   ,   ,    ‚Äî   ¬´¬ª.      [0,¬´¬ª] ‚Äî   map(...),     ¬´¬ª ( 20  255,     ). <br>
<br>
       ¬´¬ª     :<br>
<ol>
<li> ( digit6x8future,  )</li>
<li>  ( font6x8,  )</li>
<li> ( font6x8,   (+)</li>
<li>  (  ,  ).          .</li>
<li>   (  ,  ).</li>
</ol><br>
   -     ,   ¬´  ¬ª ( ) ‚Äî     ‚Äî    ( , ), : ¬´  (CR2032)   !¬ª    ,     .<br>
<br>
<h4></h4><br>
,    :<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/H-r2AenAzTg%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhiLmA-ShPFlvMWJNZnlSMSt5XVOSg" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h4> ?</h4><br>
<ol>
<li>        ¬´¬ª ( ,  MaTrix   ¬´  ¬ª).</li>
<li>   SN     (,   ..).</li>
<li>  SN    (  ¬´¬ª       ).</li>
<li>        ¬´¬ª    ¬´¬ª ,    ¬´ ¬ª     .</li>
<li>      ( ,      iBoard:    ,   ¬´¬ª      SD- (,  iBoard    microSD)    -  ,    "<a href="http://narodmon.ru/"> </a>"  -   ,         ).</li>
<li>        (,     MaTrix (300 -&gt; 100)  -    - ).</li>
</ol><br>
 ,   .<br>
<br>
<h5> </h5><br>
<ul>
<li><a href="">  </a></li>
<li> :<br>
<ul>
<li><a href="https://github.com/maniacbug/RF24/">RF24</a></li>
<li><a href="https://github.com/andykarpov/iBoardRF24">iBoardRF24</a></li>
<li><a href="https://github.com/stepanovalex/MaTrix">MaTrix</a></li>
</ul><br>
</li>
</ul><br>
 :<br>
<ul>
<li><a href="http://devicter.ru/goods/Shield-MaTrix">Shield MaTrix</a></li>
<li><a href="http://devicter.ru/goods/Sensor-Node">Sensor Node</a></li>
<li><a href="http://devicter.ru/goods/Iteaduino-Iboard">iBoard</a></li>
<li><a href="http://devicter.ru/goods/modul-2-4g-nrf24l01">nRF24l01+</a></li>
</ul><br>
<br>
P.S. ,    ,         (    ‚Äî      ).</div><p>Source: <a href="https://habr.com/ru/post/202898/">https://habr.com/ru/post/202898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202884/index.html">Overcoming the hidden dangers of KVO in Objective C</a></li>
<li><a href="../202888/index.html">Asteroids javascript implementation</a></li>
<li><a href="../202890/index.html">PHP creator Rasmus Lerdorf - about anarchy and democracy in language development, PHP 5.6 and complaining programmers</a></li>
<li><a href="../202894/index.html">Galileo is the first Arduino-compatible microcomputer on the Intel platform. Now Available!</a></li>
<li><a href="../202896/index.html">Continuous Integration in Selectle</a></li>
<li><a href="../202900/index.html">KUB-BS - controller ‚Äúfor growth‚Äù for monitoring container-type objects, including Cellular base stations</a></li>
<li><a href="../202904/index.html">Budget VDS for training and development</a></li>
<li><a href="../202906/index.html">Livejack blackjack</a></li>
<li><a href="../202908/index.html">Automatic spell checker, model Noisy Channel</a></li>
<li><a href="../202910/index.html">Automatic testing of iOS applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>