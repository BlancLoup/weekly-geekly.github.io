<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gradle: Tasks Are Code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous topic, I tried to briefly describe what Gradle is and on what ideas it is built. The concept of Source Sets and the functionality asso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gradle: Tasks Are Code</h1><div class="post__text post__text-html js-mediator-article"> In the <a href="http://habrahabr.ru/blogs/java/107085/">previous topic,</a> I tried to briefly describe what Gradle is and on what ideas it is built.  The concept of Source Sets and the functionality associated with it were also highlighted. <br><br>  Now I would like to talk about what Gradle hooked me personally.  It's about how to work with tasks.  The task in Gradle is a close analogue of Ant Target.  And, so as not to be confused in terms, the task (or task) hereinafter will always mean the Gradle Task.  If we are talking about an entity from Ant, this will be indicated explicitly: Ant task. <br><br>  So, tasks in Gradle are created using a special dsl (domain specific language) based on Groovy.  And the possibilities that this dsl provides, in my opinion, are almost limitless compared to ant or maven. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Let's start with the traditional ‚ÄúHello World‚Äù programmers.  Suppose we have an empty <code>build.gradle</code> file.  We write: <br><br><pre> <code class="scala hljs">task hello &lt;&lt; { println <span class="hljs-symbol"><span class="hljs-symbol">'Hello</span></span> world!' }</code> </pre><br>  Run <br><br> <code>&gt;gradle -q hello <br> Hello world! <br></code> <br>  Bingo!  But not impressive.  Let's try something else: <br><pre> <code class="scala hljs">task upper &lt;&lt; { <span class="hljs-type"><span class="hljs-type">String</span></span> someString = <span class="hljs-symbol"><span class="hljs-symbol">'mY_nAm</span></span>E' println <span class="hljs-string"><span class="hljs-string">"Original: "</span></span> + someString println <span class="hljs-string"><span class="hljs-string">"Upper case: "</span></span> + someString.toUpperCase() <span class="hljs-number"><span class="hljs-number">4.</span></span>times { print <span class="hljs-string"><span class="hljs-string">"$it "</span></span> } }</code> </pre><br>  Run <br><br> <code>&gt;gradle -q upper <br> Original: mY_nAmE <br> Upper case: MY_NAME <br> 0 1 2 3 <br></code> <br>  That is, <i>an arbitrary Groovy code</i> may be inside the task definition.  And the tasks themselves are a full-fledged Groovy object.  And this means that they have properties and methods that allow them to be managed.  For example, adding new actions. <br><br>  Let's look at a more interesting example. <br><br>  Suppose we have a small java project.  Here is its build.gradle: <br><br><pre> <code class="scala hljs">apply plugin: <span class="hljs-symbol"><span class="hljs-symbol">'jav</span></span>a' version = <span class="hljs-symbol"><span class="hljs-symbol">'1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>' repositories { mavenCentral() } dependencies { compile group: <span class="hljs-symbol"><span class="hljs-symbol">'commons</span></span>-collections', name: <span class="hljs-symbol"><span class="hljs-symbol">'commons</span></span>-collections', version: <span class="hljs-symbol"><span class="hljs-symbol">'3</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>' testCompile group: <span class="hljs-symbol"><span class="hljs-symbol">'juni</span></span>t', name: <span class="hljs-symbol"><span class="hljs-symbol">'juni</span></span>t', version: <span class="hljs-symbol"><span class="hljs-symbol">'4</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span>' }</code> </pre> <br>  and directory structure <br><br><pre> / projectAlpha
     / src
         / test
         / main
             / java
                 / my
                     / own
                         / code
                     / spring
                         / db
                         / plugin
                         / auth
</pre><br><br>  Nothing complicated: version, Maven Central repository, two dependencies to compile, several packages.  When running a command <br><br> <code>&gt;gradle build</code> <br> <br>  The <code>projectAlpha/build/libs</code> directory will <code>projectAlpha-1.0.jar</code> .  All in full accordance with the agreements.  Maven would do the same. <br><br>  But over time, the requirements, as we know, change.  Let's change the requirements in the example.  Suppose we needed to assemble the Spring-related code into separate archives, assemble a separate jar with the classes of the unit-tests, and another jar with the source codes.  In Gradle, this is solved as follows: <br><br><pre> <code class="scala hljs">task sourcesJar(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Jar</span></span>) { appendix = <span class="hljs-symbol"><span class="hljs-symbol">'source</span></span>s' from sourceSets.main.allJava } task testJar(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Jar</span></span>) { appendix = <span class="hljs-symbol"><span class="hljs-symbol">'tes</span></span>t' from sourceSets.test.classes } jar { exclude <span class="hljs-symbol"><span class="hljs-symbol">'my</span></span>/spring<span class="hljs-comment"><span class="hljs-comment">/**' } task springDbJar(type: Jar) { appendix = 'spring-db' from sourceSets.main.classes include 'my/spring/db/**' } task springAuthJar(type: Jar) { appendix = 'spring-auth' from sourceSets.main.classes include 'my/spring/auth/**' } task springPluginJar(type: Jar) { appendix = 'spring-plugin' from sourceSets.main.classes include 'my/spring/plugin/**' }</span></span></code> </pre><br>  Run <br> <code>&gt;gradle assemble</code> <br> <br>  And we see: <br> <code>projectAlpha&gt;dir /b build\libs <br> projectAlpha-1.0.jar <br> projectAlpha-sources-1.0.jar <br> projectAlpha-spring-auth-1.0.jar <br> projectAlpha-spring-db-1.0.jar <br> projectAlpha-spring-plugin-1.0.jar <br> projectAlpha-test-1.0.jar</code> <br> <br>  What happened: <br><ul><li>  We defined two new tasks with the Jar type: <code>sourcesJar</code> and <code>testJar</code> .  To describe the contents of the archive are already familiar to you source sets.  Another attribute is <code>appendix</code> , which, as you might guess, will be included in the archive name after the version. </li><li>  We changed the default <code>jar</code> task (it is defined in the plugin) so that the main archive does not get classes from certain packages. </li><li>  We identified 3 more tasks for assembling three separate archives with modules for Spring. When I called the <code>assemble</code> task, the assembly system selected all the tasks forming the archives (Zip, Jar ..) and performed them.  Pre-processing dependencies on source sets and compiling the necessary classes, as in the previous article. </li></ul><br>  I wonder how to do this in Maven? <br><br>  But life does not stand still, and our demands continue to change.  One fine morning, the Spring Foundation demanded to add to the manifesto of each jar that is related to Spring and published on Habr√©, the demo attribute with the value habr.ru.  It sounds weird, but we still need to implement them.  Add: <br><br><pre> <code class="scala hljs">tasks.withType(<span class="hljs-type"><span class="hljs-type">Jar</span></span>).matching { task -&gt; task.archiveName.contains(<span class="hljs-symbol"><span class="hljs-symbol">'sprin</span></span>g') }.allObjects { task -&gt; task.manifest { attributes demo: <span class="hljs-symbol"><span class="hljs-symbol">'habr</span></span>.ru' } }</code> </pre><br>  Run: <br><br> <code>projectAlpha&gt;gradle assemble <br> :compileJava UP-TO-DATE <br> :processResources UP-TO-DATE <br> :classes UP-TO-DATE <br> :jar UP-TO-DATE <br> :sourcesJar UP-TO-DATE <br> :springAuthJar <br> :springDbJar <br> :springPluginJar <br> :compileTestJava UP-TO-DATE <br> :processTestResources UP-TO-DATE <br> :testClasses UP-TO-DATE <br> :testJar UP-TO-DATE <br> :assemble <br></code> <br><br>  Note that many tasks have been marked UP-TO-DATE.  This is another highlight of Gradle - incremental build.  But about her another time.  Now, if you don‚Äôt be lazy and look at the contents of the manifest archives, then you can find the necessary line in Spring-related files. <br><br> <code>Manifest-Version: 1.0 <br> demo: habr.ru <br></code> <br>  Bingo! <br><br>  But the requirements of the Spring Foundation continue to change.  And now you need to put his checksum next to each jar :) License purity is a serious matter, and we have to comply.  Unfortunately, Gradle does not have built-in support for the MD5 calculation operation.  But it is in Ant.  So let's get it and use it.  Let's change the last fragment as follows: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allSpringJars</span></span></span><span class="hljs-function"> </span></span>= tasks.withType(<span class="hljs-type"><span class="hljs-type">Jar</span></span>).matching { task -&gt; task.archiveName.contains(<span class="hljs-symbol"><span class="hljs-symbol">'sprin</span></span>g') } allSpringJars.allObjects { task -&gt; configure(task) { manifest { attributes demo: <span class="hljs-symbol"><span class="hljs-symbol">'habr</span></span>.ru' } doLast { ant.checksum(file: archivePath, todir: archivePath.parentFile) } } } task springJars(dependsOn: allSpringJars)</code> </pre> <br><br>  And this time we will collect only the unfortunate spring-related archives: <br><br> <code>projectAlpha&gt;gradle clean springJars <br> :clean <br> :compileJava <br> :processResources UP-TO-DATE <br> :classes <br> :springAuthJar <br> :springDbJar <br> :springPluginJar <br> :springJars <br> <br> BUILD SUCCESSFUL <br> <br> Total time: 5.015 secs</code> <br> <br>  Let's see what happened. <br> <code>c:\Work\Gradle\tasksAreCode\projectAlpha&gt;dir /b build\libs <br> projectAlpha-spring-auth-1.0.jar <br> projectAlpha-spring-auth-1.0.jar.MD5 <br> projectAlpha-spring-db-1.0.jar <br> projectAlpha-spring-db-1.0.jar.MD5 <br> projectAlpha-spring-plugin-1.0.jar <br> projectAlpha-spring-plugin-1.0.jar.MD5</code> <br> <br>  Completing the task required minimal effort. <br>  Perhaps the requirements used in the example seem artificial and a little naive, but the tasks that have to be solved in reality are surprisingly diverse. <br><br>  In this article, we were able to adapt to changing requirements with a small amount of Groovy code and perform several tasks that would be difficult to cope with using Ant or Maven.  Using a flexible programming language instead of xml gives you a free hand and allows you to decide for yourself how you want to accomplish your task. <br><br>  To be continued. </div><p>Source: <a href="https://habr.com/ru/post/107558/">https://habr.com/ru/post/107558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107551/index.html">Silverlight, HTML5 and opaque Microsoft development strategy</a></li>
<li><a href="../107552/index.html">Beware, tlds open</a></li>
<li><a href="../107554/index.html">From Commodore to iPad</a></li>
<li><a href="../107556/index.html">Overtime? Now you have two problems!</a></li>
<li><a href="../107557/index.html">Began accepting applications in the Mac App Store</a></li>
<li><a href="../107560/index.html">Which lineup in the store is faster?</a></li>
<li><a href="../107563/index.html">The interaction of links and their isolation. Part 1</a></li>
<li><a href="../107564/index.html">Goozzy.com - a year later</a></li>
<li><a href="../107565/index.html">Oldschool 1-bit ZX-Spectrum chiptune on the domestic RISC-microcontroller</a></li>
<li><a href="../107566/index.html">"Now if ..." or services that we lack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>