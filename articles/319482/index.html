<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP.NET Core: Creating Server Services for Mobile Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We present the second part of a series of articles devoted to the development on ASP.NET Core. In this tutorial, you will learn how to create server s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP.NET Core: Creating Server Services for Mobile Applications</h1><div class="post__text post__text-html js-mediator-article"><p>  We present the second part of a <a href="https://habrahabr.ru/search/%3Fq%3D%255Bmsaspnetcore%255D%26target_type%3Dposts">series of articles</a> devoted to the development on ASP.NET Core.  In this tutorial, you will learn how to create server services using ASP.NET Core MVC to support mobile applications. </p><br><img src="https://habrastorage.org/files/e5d/477/65f/e5d47765f45a4f3dbc9f15cb60620f69.jpg"><a name="habracut"></a><br><p><br></p><br><h1 id="vtoroy-cikl-statey-po-aspnet-core">  The second cycle of articles on ASP.NET Core </h1><br><ol><li>  <a href="https://habrahabr.ru/company/microsoft/blog/319482/">Creating server services for mobile applications.</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/324312/">ASP.NET Core Application Development with dotnet watch</a> . </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/325872/">Creating ASP.NET Web API Reference Pages with Swagger</a> . </li><li>  Open web interface for .NET (OWIN). </li><li>  Choosing the right .NET development environment on the server. </li></ol><br><p>  The first cycle of articles can be found <a href="https://habrahabr.ru/company/microsoft/blog/310996/">here</a> . </p><br><h1 id="obrazec-mobilnogo-prilozheniya">  Sample Mobile Application </h1><br><p>  Mobile applications can easily exchange data with ASP.NET Core server services.  <a href="https://github.com/aspnet/Docs/tree/master/aspnetcore/mobile/native-mobile-backend/sample">Here</a> you can download sample code for server services. </p><br><p>  This material uses the <a href="https://developer.xamarin.com/guides/xamarin-forms/web-services/consuming/rest/">Xamarin Forms ToDoRest</a> application as a client.  It includes separate clients for Android, iOS and Windows devices.  From the link above you will find a guide that will help you create the application (and install the necessary free Xamarin tools), and you can also download a sample Xamarin solution.  It includes the project of two ASP.NET web API services, which will be replaced by an ASP.NET Core application from this article (no changes are needed from the client). </p><br><img src="https://habrastorage.org/files/e14/1dd/fe4/e141ddfe4bf44b7a8b22633c762eb31a.png"><br><p><br></p><br><h2 id="funkcii">  Functions </h2><br><p>  The ToDoRest application supports listing, adding, deleting, and updating To-Do items.  Each element is endowed with its own identifier, name, notes, and a property that indicates whether the element is executed. </p><br><p>  In the basic representation of the elements, as shown above, there is the name of each element, and the presence of a flag indicates whether it has been executed. </p><br><p>  Tap the + icon to open a dialog box for adding items: </p><br><img src="https://habrastorage.org/files/5b2/5c3/2f8/5b25c32f88864c3d8ae259e102c5ad84.png"><br><p><br>  Tap an item in the main list to open a dialog box to edit the name, notes and execution status, or to delete an item: </p><br><img src="https://habrastorage.org/files/758/082/028/758082028ebb4f77b6234cd564bf9010.png"><br><p><br>  This sample defaults to using the services hosted at <a href="https://developer.xamarin.com/">developer.xamarin.com</a> , and allows you to read only.  To test it yourself with the ASP.NET Core application that will be created in the next section and will work on your computer, you need to update the <code>RestUrl</code> constant.  Go to the <code>ToDoREST</code> project and open the <em>Constants.cs</em> file.  Replace <code>RestUrl</code> with the IP address of your computer (this should not be localhost or 127.0.0.1, since the address is used from the device emulator, not from your PC).  Also add the port number (5000).  To ensure that the services work on the device, do not forget to turn off the firewall that blocks access to this port. </p><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ URL of REST service (Xamarin ReadOnly Service) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/public static string RestUrl = "http:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/developer.xamarin.com:8081/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/todoitems{0}"; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ use your machine's IP address public static string RestUrl = "http:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/192.168.1.207:5000/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/todoitems/</span></span>{<span class="hljs-number"><span class="hljs-number">0</span></span>}<span class="hljs-string"><span class="hljs-string">";</span></span></code> </pre> <br><h1 id="sozdanie-proekta-aspnet-core">  Creating an ASP.NET Core Project </h1><br><p>  Create a new ASP.NET Core web application in Visual Studio.  Select a web API template and disable authentication.  Name the project <em>ToDoApi</em> . </p><br><img src="https://habrastorage.org/files/091/dd7/083/091dd7083ed44dd793c701cd9b8ee456.png"><br><p><br>  The application must respond to all requests on port 5000. Add to <em>Program.cs</em> <code>.UseUrls("http://*:5000")</code> to get the following result: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebHostBuilder() .UseKestrel() .UseUrls(<span class="hljs-string"><span class="hljs-string">"http://*:5000"</span></span>) .UseContentRoot(Directory.GetCurrentDirectory()) .UseIISIntegration() .UseStartup&lt;Startup&gt;() .Build();</code> </pre> <br><p>  Note: Be sure to start the application directly, and not through IIS Express, which by default ignores non-local requests.  Run <code>dotnet run</code> from the command line, or select the application name from the Debug Target drop-down menu on the Visual Studio toolbar. </p><br><p>  Add a model class to represent the To-Do elements.  Mark the required fields using the <code>[Required]</code> attribute: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel.DataAnnotations; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ToDoApi.Models</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ToDoItem</span></span> { [Required] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Notes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Done { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre> <br><p>  API methods need a data processing method.  Use the same <code>IToDoRepository</code> interface as in the Xamarin sample: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ToDoApi.Models; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ToDoApi.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IToDoRepository</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoesItemExist</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; IEnumerable&lt;ToDoItem&gt; All { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-function">ToDoItem </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Find</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Insert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ToDoItem item</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ToDoItem item</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; } }</code> </pre> <br><p>  In this example, the implementation uses a private collection of elements: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ToDoApi.Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ToDoApi.Models; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ToDoApi.Services</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ToDoRepository</span></span> : <span class="hljs-title"><span class="hljs-title">IToDoRepository</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;ToDoItem&gt; _toDoList; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoRepository</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeData(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;ToDoItem&gt; All { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _toDoList; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoesItemExist</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _toDoList.Any(item =&gt; item.ID == id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ToDoItem </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Find</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _toDoList.FirstOrDefault(item =&gt; item.ID == id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Insert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ToDoItem item</span></span></span><span class="hljs-function">)</span></span> { _toDoList.Add(item); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ToDoItem item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> todoItem = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Find(item.ID); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = _toDoList.IndexOf(todoItem); _toDoList.RemoveAt(index); _toDoList.Insert(index, item); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { _toDoList.Remove(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Find(id)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _toDoList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ToDoItem&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> todoItem1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ToDoItem { ID = <span class="hljs-string"><span class="hljs-string">"6bb8a868-dba1-4f1a-93b7-24ebce87e243"</span></span>, Name = <span class="hljs-string"><span class="hljs-string">"Learn app development"</span></span>, Notes = <span class="hljs-string"><span class="hljs-string">"Attend Xamarin University"</span></span>, Done = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> todoItem2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ToDoItem { ID = <span class="hljs-string"><span class="hljs-string">"b94afb54-a1cb-4313-8af3-b7511551b33b"</span></span>, Name = <span class="hljs-string"><span class="hljs-string">"Develop apps"</span></span>, Notes = <span class="hljs-string"><span class="hljs-string">"Use Xamarin Studio/Visual Studio"</span></span>, Done = <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> todoItem3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ToDoItem { ID = <span class="hljs-string"><span class="hljs-string">"ecfa6f80-3671-4911-aabe-63cc442c1ecf"</span></span>, Name = <span class="hljs-string"><span class="hljs-string">"Publish apps"</span></span>, Notes = <span class="hljs-string"><span class="hljs-string">"All app stores"</span></span>, Done = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }; _toDoList.Add(todoItem1); _toDoList.Add(todoItem2); _toDoList.Add(todoItem3); } } }</code> </pre> <br><p>  Set up the implementation in <em>Startup.cs</em> : </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Add framework services. services.AddMvc(); services.AddSingleton&lt;IToDoRepository,ToDoRepository&gt;(); }</span></span></code> </pre> <br><p>  Now you can proceed to create <em>ToDoItemsController</em> . </p><br><p>  Learn more about creating web APIs in the article <a href="https://habrahabr.ru/company/microsoft/blog/312878/">‚ÄúCreating the first web API using ASP.NET Core MVC and Visual Studio‚Äù</a> . </p><br><h1 id="sozdanie-kontrollera">  Creating a controller </h1><br><p>  Add a new <em>ToDoItemsController</em> controller to the project.  It must inherit the properties from Microsoft.AspNetCore.Mvc.Controller.  Add the <code>Route</code> attribute to indicate that the controller will process requests that are made to the paths and begin with <code>api/todoitems</code> .  The <code>[controller]</code> token in the route is replaced with the controller name (without the Controller suffix);  This is especially useful for global routes.  Read more about <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/routing">routing</a> . </p><br><p>  The controller requires the <code>IToDoRepository;</code> parameter <code>IToDoRepository;</code>  request an instance of this type through the controller constructor.  In the runtime environment, this instance will be provided thanks to support for the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">dependency injection</a> platform. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Http; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ToDoApi.Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ToDoApi.Models; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ToDoApi.Controllers</span></span> { [Route(<span class="hljs-string"><span class="hljs-string">"api/[controller]"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ToDoItemsController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IToDoRepository _toDoRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoItemsController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IToDoRepository toDoRepository</span></span></span><span class="hljs-function">)</span></span> { _toDoRepository = toDoRepository; }</code> </pre> <br><p>  This API supports four HTTP verbs for create, read, update, and delete (CRUD) operations at the data source.  The simplest operation is Read, which corresponds to the HTTP Get request. </p><br><h2 id="chtenie-elementov">  Reading elements </h2><br><p>  To request a list of items, issue a GET request to the <code>List</code> method.  The <code>[HttpGet]</code> attribute in the <code>List</code> method indicates that this action should only process GET requests.  The route for this action is the route specified on the controller.  You do not need to use the name of the action as part of the route.  You just need to make sure that each action has a unique and unambiguous route.  Routing attributes to create specific routes can be applied at the level of both the controller and the method. </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">HttpGet</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">List</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ok(_toDoRepository.All); }</code> </pre> <br><p>  The <code>List</code> method <code>List</code> 200 OK response code and a list of all ToDo elements serialized as JSON. </p><br><p>  You can test the new API method with a number of tools, such as <a href="https://www.getpostman.com/docs/">Postman</a> , as shown below: </p><br><img src="https://habrastorage.org/files/976/040/820/97604082013c4a3ea18805bc1f9b9491.png"><br><h2 id="sozdanie-elementov">  Creating items </h2><br><p>  By convention, the creation of new data elements is mapped to an HTTP POST command.  The attribute <code>[HttpPost];</code> applied to the <code>Create</code> method <code>[HttpPost];</code>  in addition, the method takes a parameter ID and an instance of <code>ToDoItem</code> .  Command attributes such as <code>[HttpPost]</code> can accept a route string (in this example, <code>{id}</code> ).  The result will be the same as adding the <code>[Route]</code> attribute to the action.  Since the <code>item</code> argument will be passed in the POST body, this parameter is decorated with the <code>[FromBody]</code> attribute. </p><br><p>  Inside the method, it is checked whether the element was correctly composed and whether it existed previously in the data warehouse;  if there are no errors, it is added using the repository.  <code>ModelState.IsValid</code> performs <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/validation">model validation</a> ;  this should be done in every API method that accepts user input. </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">HttpPost(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{id}"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, [FromBody]ToDoItem item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !ModelState.IsValid) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BadRequest(ErrorCode.TodoItemNameAndNotesRequired.ToString()); } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> itemExists = _toDoRepository.DoesItemExist(item.ID); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemExists) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StatusCode(StatusCodes.Status409Conflict, ErrorCode.TodoItemIDInUse.ToString()); } _toDoRepository.Insert(item); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BadRequest(ErrorCode.CouldNotCreateItem.ToString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ok(item); }</code> </pre> <br><p>  The sample uses an enumeration of error codes transmitted to the mobile client. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorCode</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-type"><span class="hljs-type">TodoItemNameAndNotesRequired</span></span>, <span class="hljs-type"><span class="hljs-type">TodoItemIDInUse</span></span>, <span class="hljs-type"><span class="hljs-type">RecordNotFound</span></span>, <span class="hljs-type"><span class="hljs-type">CouldNotCreateItem</span></span>, <span class="hljs-type"><span class="hljs-type">CouldNotUpdateItem</span></span>, <span class="hljs-type"><span class="hljs-type">CouldNotDeleteItem</span></span> }</code> </pre> <br><p>  To check the addition of new items, use Postman: select the POST command, which provides a new object in JSON format in the request body.  Also add a request header that specifies the <code>Content-Type</code> for <code>application/json</code> . </p><br><img src="https://habrastorage.org/files/cd9/532/6bc/cd95326bc5c7444bbc9c9cb944dacc2c.png"><br><p><br>  In the response, the method returns the newly created element. </p><br><h2 id="obnovlenie-elementov">  Update items </h2><br><p>  You can change entries using HTTP PUT requests.  In addition, the <code>Edit</code> method is almost identical to <code>Create</code> .  Remember that if the record is not found, the <code>Edit</code> action will <code>NotFound</code> response (404). </p><br><pre> <code class="hljs kotlin">[HttpPut(<span class="hljs-string"><span class="hljs-string">"{id}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IActionResult Edit(string id, [FromBody] ToDoItem item) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !ModelState.IsValid) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BadRequest(ErrorCode.TodoItemNameAndNotesRequired.ToString()); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> existingItem = _toDoRepository.Find(id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (existingItem == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NotFound(ErrorCode.RecordNotFound.ToString()); } _toDoRepository.Update(item); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BadRequest(ErrorCode.CouldNotUpdateItem.ToString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NoContent(); }</code> </pre> <br><p>  To test Postman, change the command to PUT and add the ID of the record being updated to the URL.  Specify the data of the object being updated in the request body. </p><br><img src="https://habrastorage.org/files/d05/b34/7a8/d05b347a85e948ddae55844339ba7523.png"><br><p><br>  If successful, the method <code>NoContent</code> (204) response, thereby ensuring consistency with the existing API. </p><br><h2 id="udalenie-elementov">  Deleting items </h2><br><p>  To delete entries, you need to make DELETE requests to the service and pass the ID of the item to be deleted.  After these updates, requests for non-existing elements will receive <code>NotFound</code> responses, and a successful request will receive a <code>NotFound</code> answer (204). </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">HttpDelete(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{id}"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = _toDoRepository.Find(id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NotFound(ErrorCode.RecordNotFound.ToString()); } _toDoRepository.Delete(id); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BadRequest(ErrorCode.CouldNotDeleteItem.ToString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NoContent(); }</code> </pre> <br><p>  Remember that when testing the delete function, you do not need to add anything to the request body. </p><br><img src="https://habrastorage.org/files/a4f/74a/02e/a4f74a02e9bc4749bbbe34befd1a289c.png"><br><p><br></p><br><h1 id="rasprostranennye-soglasheniya-veb-api">  Common Web API Conventions </h1><br><p>  When developing server services for an application, we recommend creating a series of logical agreements or policies to resolve emerging issues.  For example, in the services described above, requests for specific records that were not found received the <code>NotFound</code> response, not <code>BadRequest</code> .  Similarly, the commands executed to the address of this service and transmitted in model types always checked <code>ModelState.IsValid</code> and issued <code>BadRequest</code> for invalid model types. </p><br><p>  When you define a common policy for your API, you can encapsulate in the filter.  In this <a href="https://msdn.microsoft.com/en-us/magazine/mt767699.aspx">article,</a> you can learn how to encapsulate common API policies in ASP.NET Core MVC applications. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/319482/">https://habr.com/ru/post/319482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319472/index.html">Pure javascript. Introduction</a></li>
<li><a href="../319474/index.html">C ++ 17 auto output changes during curly initialization</a></li>
<li><a href="../319476/index.html">Pure javascript. Variables</a></li>
<li><a href="../319478/index.html">No, being a game designer is no easier than a producer.</a></li>
<li><a href="../319480/index.html">Pure javascript. Functions</a></li>
<li><a href="../319484/index.html">DOCSIS 3.1 - How to achieve maximum throughput</a></li>
<li><a href="../319486/index.html">Subscription form: how to effectively collect the address database</a></li>
<li><a href="../319490/index.html">Dijkstra's algorithm and development through testing</a></li>
<li><a href="../319492/index.html">A simple and terrifying story about encryption</a></li>
<li><a href="../319496/index.html">100th edition of Digest MBLTdev - fresh for iOS developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>