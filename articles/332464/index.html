<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Color segmentation for dummies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is designed for beginners who are just beginning to master the methods of image processing. I myself often encounter a lack of light exam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Color segmentation for dummies</h1><div class="post__text post__text-html js-mediator-article">  This article is designed for beginners who are just beginning to master the methods of image processing.  I myself often encounter a lack of light examples, especially in Russian, so I hope this material will be useful. <br><br>  Somehow the next task arose before me.  I had a lot of pictures of bell peppers and it was necessary to separate the plant from the background.  Using this task as an example, I will show one of the most primitive ways how this can be done with openCV 2.4. <br><br>  The essence of the task: to paint over white all that is not a plant. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/94e/ef8/3e6/94eef83e662742cd8f0ea64559d39bab.png"><br>  <i>Original photo (left) and what should happen (right).</i> <br><a name="habracut"></a><br>  First, download the image: <br><br><pre><code class="cpp hljs">Mat src = imread(<span class="hljs-string"><span class="hljs-string">"1.jpg"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// </span></span></code> </pre> <br>  By default, a color image is stored in opencv in the BGR palette.  Determining the color in BGR is not very convenient, so for a start we will convert the image to HSV format. <br><blockquote>  HSV (or HSB) means Hue, Saturation, Value (Brightness), where: <br>  Hue - color tone, i.e.  color shade. <br><br>  Saturation - saturation.  The higher this parameter, the ‚Äúcleaner‚Äù the color will be, and the lower, the closer it will be to gray. <br><br>  Value (Brightness) - the value (brightness) of the color.  The higher the value, the brighter the color will be (but not whiter).  And the lower, the darker (0% - black) </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/ce2/916/667/ce29166676166eb7712af8a821ba4c5d.png" alt="image"><br><br>  Since we will search for a plant precisely by color, we are most interested in the tone. <br><br>  Transform the image into the HSV palette and split it into three components Hue Saturation Value, respectively. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   HSV Mat hsv = Mat(src.cols, src.rows, 8, 3); // vector&lt;Mat&gt; splitedHsv = vector&lt;Mat&gt;(); cvtColor(src, hsv, CV_BGR2HSV); split(hsv, splitedHsv);</span></span></code> </pre> <br>  Let's set the range of tone values.  In OpenCV, green is in the range from 34 to 72. The peppers in the photos are not completely green.  Therefore, the range of 21 to 110 was chosen by experience. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GREEN_MIN = <span class="hljs-number"><span class="hljs-number">21</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GREEN_MAX = <span class="hljs-number"><span class="hljs-number">110</span></span>;</code> </pre><br>  Next, run over our image.  For each pixel we get all three components.  We will not use the intensity, but in order to make it clearer and not skip the indices I will leave it.  If the tone does not fit into the specified range or the brightness is too low, then this is the background, so paint everything in white. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; hsv.cols; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; hsv.rows; x++) { <span class="hljs-comment"><span class="hljs-comment">//  HSV-  int H = static_cast&lt;int&gt;(splitedHsv[0].at&lt;uchar&gt;(x, y)); //  int S = static_cast&lt;int&gt;(splitedHsv[1].at&lt;uchar&gt;(x, y)); //  int V = static_cast&lt;int&gt;(splitedHsv[2].at&lt;uchar&gt;(x, y)); //  //          ,    if ((V &lt; 20) || (H &lt; GREEN_MIN) || (H &gt; GREEN_MAX)) { src.at&lt;Vec3b&gt;(x, y)[0] = 255; src.at&lt;Vec3b&gt;(x, y)[1] = 255; src.at&lt;Vec3b&gt;(x, y)[2] = 255; } } }</span></span></code> </pre><br>  As a result, we get the following image: <br><br><img src="https://habrastorage.org/web/57f/3b8/0fd/57f3b80fd5e04156a52b99522d3bcce2.png"><br><br>  In general, the background retired, but there were incomprehensible noises in the left corner. <br><br>  One of the ways to remove small, incoherent particles is morphological image processing. <br><br><blockquote>  Dilation (morphological expansion) - a convolution of an image or a selected image area with some kernel.  The kernel can have any shape and size.  In this case, the only leading position in the kernel is allocated, which is combined with the current pixel in the calculation of convolution.  In many cases, a square or a circle with a leading position in the center is chosen as the core.  The kernel can be viewed as a pattern or mask.  The use of dilatation is reduced to a pattern passing through the entire image and the application of the local maximum search operator to the image pixel intensities covered by the template.  Such an operation causes the growth of bright areas in the image.  In the figure, pixels are marked in gray, which will be white as a result of the use of dilatation. <br><br>  Erosion (morphological contraction) is the reverse operation.  The effect of erosion is similar to dilatation, the only difference is that the local minimum search operator is used; the pixels that turn black as a result of erosion are grayed out. </blockquote><br>  You can read more about this case <a href="http://www.intuit.ru/studies/courses/10621/1105/lecture/17989%3Fpage%3D4">here</a> .  Let's apply morphological operations to our pictures.  We take an ellipse as a structural element. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> an = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     . Mat element = getStructuringElement(MORPH_ELLIPSE, Size(an * 2 + 1, an * 2 + 1), Point(an, an)); dilate(src, tmp, element); erode(tmp, tmp, element);</span></span></code> </pre> <br><img src="https://habrastorage.org/web/0b3/852/157/0b38521570954d32883ad0197f629de8.png"><br>  <i>The result of morphological processing.</i> <br><br>  Most of the noise was removed, but the image itself was blurred, and this is not exactly what we wanted.  Therefore, we will use the converted image as a mask to remove unwanted noise. <br><br><pre> <code class="cpp hljs">Mat grayscaleMat; cvtColor(tmp, grayscaleMat, CV_BGR2GRAY); <span class="hljs-comment"><span class="hljs-comment">//   Mat mask(grayscaleMat.size(), grayscaleMat.type()); Mat out(src.size(), src.type()); threshold(grayscaleMat, mask, 200, 255, THRESH_BINARY_INV); //       out = Scalar::all(255); //     src.copyTo(out, mask);</span></span></code> </pre> <br><img src="https://habrastorage.org/web/dce/c67/9ef/dcec679eff2e462ba83460d8966e2a90.png"><br>  <i>Left mask, the right result of applying the mask.</i> <br><br>  This way you can primitively select an object from the background. <br><br>  ‚Üí <a href="https://bitbucket.org/snippets/greenroach/XqM4zx/">Full sample code</a> <br><br>  UPD: fixed broken link. </div><p>Source: <a href="https://habr.com/ru/post/332464/">https://habr.com/ru/post/332464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332450/index.html">Moby / Docker in production. Failure history</a></li>
<li><a href="../332456/index.html">Running AMP applications on Cyclone V SoC</a></li>
<li><a href="../332458/index.html">Broadcast HPE Digitize: talk about our new products and solutions</a></li>
<li><a href="../332460/index.html">Why do I need your permanent collections? They are slow</a></li>
<li><a href="../332462/index.html">What if throwing all the excess out of the database into a distributed cache is our experience using Hazelcast</a></li>
<li><a href="../332466/index.html">The market of detection and recognition systems: Emotions and "emotional calculations"</a></li>
<li><a href="../332468/index.html">How to pass an interview in a dream company? Tips from timlidov IT companies</a></li>
<li><a href="../332470/index.html">It's about time: a secure corporate instant messenger from a Russian integrator will be shown in Digital October</a></li>
<li><a href="../332472/index.html">Analysis of the backdoor group TeleBots</a></li>
<li><a href="../332474/index.html">Backup scripts to the Google Cloud Platform (GCP) cloud in five minutes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>