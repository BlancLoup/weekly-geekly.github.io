<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learning Derby 0.6, example # 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This lesson, the continuation of a series of lessons on derbyjs, is a reactive full-stack framework. Read previous lessons required ( first , second )...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learning Derby 0.6, example # 3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/718/b83/0aa/718b830aa547633b81a902ada15ff70a.png" align="left"><br>  This lesson, the continuation of a series of lessons on <a href="http://derbyjs.com/">derbyjs,</a> is a reactive full-stack framework.  Read previous lessons required ( <a href="http://habrahabr.ru/post/221027/">first</a> , <a href="http://habrahabr.ru/post/221703/">second</a> ). <br><br>  This lesson will consist of two parts: the first is an overview of the server part of the derby application, and the second is the use of the <code>derby-auth</code> module (wrappers over <code>passportjs</code> ) for registration / authorization in a derby application using social networks as well. <br><a name="habracut"></a><br><h4>  Part 1 - server code derby applications </h4><br><h5>  Training </h5><br>  In the previous examples, in order to facilitate the perception of information, we used <code>derby-starter</code> as the server part.  This module hid from us the details of the server settings.  Let me remind you that on the server, a derby application is built on top of the standard expressjs application, in particular, the database is set up there, the express middlware we need is connected.  For our example today, it is necessary to deal more deeply with the server part - we will not use <code>derby-starter</code> . <br><br>  If someone is not familiar with <code>expressjs</code> or doesn‚Äôt know <code>nodejs</code> badly, <code>nodejs</code> advise Ilya Kantor‚Äôs excellent <a href="http://learn.javascript.ru/nodejs-screencast">course</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Basic application </h5><br>  As a base for our example today, you need to copy my <a href=""><code>derby-boilerplate</code></a> .  In fact, this is a minimal application, similar to what we had in the first example, but the server part is no longer in <code>derby-starter</code> , but in the project itself (the last 4th express is also used here, and <code>redis</code> is not used at <code>redis</code> - now it is possible without it).  Copy the command: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/derbyparty/derby-boilerplate.git</code> </pre><br><br>  Let's explore the structure of the project - it is already quite militant in contrast to what was in the previous examples: <br><br><pre> <code class="bash hljs">src/ app/ server/ styles/ views/ index.js</code> </pre><br>  In the <code>app</code> folder will be our derby app.  Schematically, the ‚Äúanalogue‚Äù of the <code>derby-starter</code> will be located in the server folder (I really took the <code>derby-starter</code> , copied it there and slightly combed it), we will analyze its contents in more detail. <br><br>  In <code>styles</code> and <code>views</code> folders - styles and templates, respectively.  The index.js file is similar to what it was in the previous examples - a few lines that run the whole thing. <br><br><h5>  Server part of a derby application </h5><br>  First of all, I once again draw your attention to the fact that the derby runs on top of the <code>expressjs</code> application, so if you do not know what it is, what <code>express-middleware</code> , how they work, how express sessions work, routing - here you need to stop and eliminate deficiencies in knowledge. <br><br>  Let's see what is in the server folder: <br><pre> <code class="bash hljs">error/ index.js server.js</code> </pre><br>  In <code>error</code> daddy, I brought an error handler, I will not here.  I can only say that it is <code>expressjs-middlware</code> , which is triggered when there is no handler for the dialed <code>url</code> , or errors occurred during the operation of the application.  If you want to sort it out yourself. <br><br>  The main purpose of the <code>index.js</code> file is to pick up <code>express</code> (which is configured in the <code>server.js</code> file) and raise the server on the specified port in the settings: <br><div class="spoiler">  <b class="spoiler_title">Source code (practically unchanged from derby-starter)</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> derby = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'derby'</span></span>); exports.run = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app, options, cb</span></span></span><span class="hljs-function">) </span></span>{ options = options || {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> port = options.port || process.env.PORT || <span class="hljs-number"><span class="hljs-number">3000</span></span>; derby.run(createServer); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> app === <span class="hljs-string"><span class="hljs-string">'string'</span></span>) app = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(app); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> expressApp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./server.js'</span></span>).setup(app, options); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> server = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).createServer(expressApp); server.listen(port, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'%d listening. Go to: http://localhost:%d/'</span></span>, process.pid, port); cb &amp;&amp; cb(err); }); } }</code> </pre><br></div></div><br>  Next is the most interesting, setting expressjs, with added <code>derby</code> .  Parsing this moment is the key to understanding how the derby works. <br><br>  I use the 4th express, it has several differences from the 3rd.  The main thing is that the standard middlware is now missing from the <code>express</code> distribution and must be installed separately. <br><br>  That‚Äôs how it would look like this file without a derby: <br><br><div class="spoiler">  <b class="spoiler_title">The server.js code, if we were doing a regular expressjs application:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  4-   middleware     //        var session = require('express-session'); //      var MongoStore = require('connect-mongo')(session); //   -      , //    var midError = require('./error'); var MongoClient = require('mongodb').MongoClient; exports.setup = function setup(app, options) { var mongoUrl = process.env.MONGO_URL || process.env.MONGOHQ_URL || 'mongodb://localhost:27017/derby-app'; //     MongoClient.connect(mongoUrl); var expressApp = express() if (options &amp;&amp; options.static) { expressApp.use(require('serve-static')(options.static)); } expressApp.use(require('cookie-parser')()); expressApp.use(session({ secret: process.env.SESSION_SECRET || 'YOUR SECRET HERE', store: new MongoStore({url: mongoUrl}) })); //         -      //    -  404  expressApp.all('*', function(req, res, next) { next('404: ' + req.url); }); //   expressApp.use(midError()); return expressApp; }</span></span></code> </pre><br></div></div><br>  In a nutshell, I remind you how it works.  First, the modules are connected, then the most important is the connection of express <code>middleware</code> (via <code>expressApp.use</code> ).  In essence, these <code>middlware</code> are simple functions that will be in the same order as registered, called for each request that arrives at the server.  Each of these <code>middleware</code> can either respond to the request by completing the processing chain (the control will not be transferred to the remaining middlware), or perform some intermediate actions with the request (for example, parsing <code>cookies</code> , determine the session, <code>cookies</code> etc.) and transfer control down the chain.  The order of connecting <code>middlware</code> very important - it is in this sequence that the functions will be called for each request. <br><br>  And this is what a derby version looks like - commented server.js code with a derby <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// 4-  var express = require('express'); //  4-   middleware     //        var session = require('express-session'); //      var MongoStore = require('connect-mongo')(session); //   -      , //    var midError = require('./error'); var derby = require('derby'); // BrowserChannel -  socket.io   - ,  // ,        // liveDbMongo -     -     var racerBrowserChannel = require('racer-browserchannel'); var liveDbMongo = require('livedb-mongo'); //     browserify derby.use(require('racer-bundle')); exports.setup = function setup(app, options) { var mongoUrl = process.env.MONGO_URL || process.env.MONGOHQ_URL || 'mongodb://localhost:27017/derby-app'; //     (      redis) var store = derby.createStore({ db: liveDbMongo(mongoUrl + '?auto_reconnect', {safe: true}) }); var expressApp = express() //     "" // (..     /derby/...) expressApp.use(app.scripts(store)); if (options &amp;&amp; options.static) { expressApp.use(require('serve-static')(options.static)); } //       browserchannel, //   middleware,    // (browserchannel   longpooling - ..   //    /channel) expressApp.use(racerBrowserChannel(store)); //  req   getModel,   // express-       // . createUserId expressApp.use(store.modelMiddleware()); expressApp.use(require('cookie-parser')()); expressApp.use(session({ secret: process.env.SESSION_SECRET || 'YOUR SECRET HERE', store: new MongoStore({url: mongoUrl}) })); expressApp.use(createUserId); //    -, //   ,      //   expressApp.use(app.router()); //         -     //  //    -  404  expressApp.all('*', function(req, res, next) { next('404: ' + req.url); }); //   expressApp.use(midError()); return expressApp; } //  id-     , //    id  -   function createUserId(req, res, next) { var model = req.getModel(); var userId = req.session.userId; if (!userId) userId = req.session.userId = model.id(); model.set('_session.userId', userId); next(); }</span></span></code> </pre><br><br>  Take some time to figure it all out.  In essence, the main thing here is that <code>browserify</code> is used - it is needed in order to give the client a so-called ‚Äúbundle‚Äù to the client - a data block containing all <code>javascript</code> derby application files, as well as templates (css scripts will not be contained here) .  It is necessary to understand that with the usual request of any page of the site by the client - a bundle is not immediately sent to the browser, it would be too costly.  A rendered page with styles and with some initial data has already been presented.  This is logical because speed is very important here.  Then this page itself loads the ‚Äúbundle‚Äù - a request is made to the address "/ derby /: bandle-name". <br><br>  I have already said that several ‚Äúderby applications‚Äù can correspond to one server part of a derby - in fact, each of them will have its own bundle.  This is logical.  So, for example, we can separate the client part of the site from the admin panel - in order not to transmit extra data to everyone.  If so, you will need to register: <br><br><pre> <code class="javascript hljs"> expressApp.use(clientApp.scripts(store)); expressApp.use(adminApp.scripts(store));</code> </pre><br><br>  The same applies to the processing of routes.  If we don't have 2 derby apps, we‚Äôll get instead: <br><br><pre> <code class="javascript hljs"> expressApp.use(app.router());</code> </pre><br><br>  connection of two application routers: <br><br><pre> <code class="javascript hljs"> expressApp.use(clientApp.router()); expressApp.use(adminApp.router());</code> </pre><br><br>  Well, and you should also understand that, apart from handlers of ‚Äúderby applications‚Äù routes, we can easily add our <code>expressjs</code> handlers, organizing any RESTFull API we need, as they say, with blackjack and young ladies.  This all works due to the fact that the client router of derby applications, not finding the right handler in their application, simply sends a request to the server for processing. <br><br>  The next important point is to connect the <code>browserchannel</code> - this is Google's analog <code>socket.io</code> .  In essence, this is a transport, thanks to which our application will synchronize data with the server in real time.  Under the hood is the fact that at some point the client browser browsernel script is added to the bundle, as well as processing requests from this module (it is based on longpooling - therefore, processing is required, in this case at the <code>/channel</code> address) <br><br>  Yes, I would like to note that in my example of the basic derby setting, <code>redis</code> is not used.  The derby update has recently been released, and now, <code>redis</code> not mandatory (it is still needed if we do horizontal scaling ‚Äî that is, to increase performance, run several derby servers at once). <br><br>  So, at the moment you need to understand that this structure allows you to add anything to your application very flexibly.  Whether it‚Äôs some <code>expressjs-middlware</code> , derby plugins, individual derby applications, express handlers - whatever.  All this will be easy to live together. <br><br>  So, well, the last point to which you need to pay attention, especially in light of the question of authorization - the session.  As you may have noticed, sessions in the derby are used quite by themselves <code>express</code> new ones.  That is, everything happens according to the classical scheme: a cookie is used for identification (which will be stored in the client‚Äôs browser), the sessions themselves are stored in <code>mongodb</code> in the <code>sessions</code> collection. <br><br>  If you look at the <code>createUserId</code> function: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createUserId</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> model = req.getModel(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userId = req.session.userId; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!userId) userId = req.session.userId = model.id(); model.set(<span class="hljs-string"><span class="hljs-string">'_session.userId'</span></span>, userId); next(); }</code> </pre><br>  It can be seen that userId is extracted from the session in it, but if it is absent, the id is generated randomly ( <code>model.id()</code> ) and written to the model along the path <code>_session.userId</code> (this data will be serialized and transmitted to the client) and into the session itself . <br><br>  Imagine several query options: <br><br><ol><li>  The user has visited the site for the first time and requested the main page - a new cookie will be formed on the server, a new session (with a new random <code>userId</code> ) - the main page will be displayed in the browser and if we look at the model on the client, then on the way '_session.userId' - We will see our newly formed ID.  Now wandering through the pages of our application (there will be no requests to the server) - the client always has his Id, and if he makes any requests to the server, we will always be able to recognize him by the session. </li><li>  The user has not registered and logged in a week.  Cook has survived - the same <code>userId</code> - everything is fine. </li><li>  The user logged in from another browser - the same as in paragraph 1 </li></ol><br>  Suppose how we would develop the registration / authorization (from the point of view of the server).  Suppose in the browser the client entered the registration data - then they should go to the server, where we would create an entry in the users collection, even no longer need to invent an id, it already exists. <br><br>  When authorization is more difficult, a client going to the site will receive a random id, then go to the login page - enter the login / password, transfer it all to the server, then the server will understand who it is and should change the userId in the session and in <code>_session.userId</code> . <br><br>  What would we store there in this collection.  Most likely: username, email, passwordHash, may be some kind of statistical data.  If our site would be authorization (registration) through the social.  networks, the social network keys would be stored here.  Still, of course, custom settings - they would also be nice to store here. <br><br>  Naturally, we would like that no one could see a part of this collection on the client.  Now there is no problem.  Recently, so-called projections appeared in the derby (the ability to subscribe to a collection, not to subscribe to the entire document, but only to certain of its fields), but a couple of weeks ago it was impossible, and the <code>derby-auth</code> module, which we will consider, is still can not.  It uses the division of user data into 2 parts: the first is the <code>auths</code> collection (here only private data), the second <code>users</code> are open public data.  So <code>derby-auth</code> <br><br><h4>  Part 2 - authorization in derby-application (module derby-auth) </h4><br><h5>  A little bit about derby-auth </h5><br>  At the moment there are 2 packages - authorization for the derby.  This is <code>derby-auth</code> and <code>derby-passport</code> .  Both of them are wrappers over <code>passportjs</code> , (one of them, in my opinion, fork the other).  Actual versions of both that and that are intended for use with the fifth version of the derby (remember the 6th is still in alpha), have not yet been updated for the 6th, but this does not prevent us from using <code>derby-auth</code> in all our projects on 6-ke (not available only html form templates, but we have them all the same custom). <br><br>  My choice in favor of <code>derby-auth</code> just because I worked with him. <br><br>  Another limitation that I have already mentioned is that the user data in both of these projects is divided into two parts.  Public data should be stored in the <code>users</code> collection, and closed in <code>auths</code> .  Recently, an opportunity has appeared in the derby to make ‚Äúprojections‚Äù ‚Äîthat is, to subscribe only to certain collection fields ‚Äî I think when these modules are updated to the 6th version of the derby, the restriction will go away. <br><br>  <b>update</b> <br>  A few days after writing this article, Vladimir Makhaev (@vmakhaev) developed an awesome <a href="http://github.com/vmakhaev/derby-login">derby-login</a> authorization module based on derby-auth.  It is under 0.6, supports projections, it has ready-made components for registering, logging in, changing the password - in short, only use it. <br><br>  By the way, do not forget to thank Vladimir, at least with an asterisk on the <a href="http://github.com/vmakhaev/derby-login">githaba</a> .  Very useful thing he did. <br><br><h5>  A bit about passportjs </h5><br><br>  <a href="http://passportjs.org/"><code>PassportJS</code></a> is the <code>middleware</code> for authorization under <code>node.js</code>  This is an abstracting module that allows your application to use both regular login and password authorization and authorization through almost <a href="http://passportjs.org/guide/providers/">any</a> service that supports Oauth, Oauth 2, etc.  authorization  Authorization methods are called strategies here.  For example, login / password authorization is called <code>LocalStrategy</code> (‚Äúlocal authorization strategy‚Äù), while GitHub authorization is <code>GithubStrategy</code> .  Each strategy is put into a separate module, so connecting the whole thing to a node.js application will look something like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> passport = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> LocalStrategy = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport-local'</span></span>).Strategy; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GithubStrategy = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport-github'</span></span>).Strategy;</code> </pre><br><br>  Here it should be noted features of the use of authorization strategies through social networks.  If someone else does not know, then before our application can use such authorization, you need to register it (application) in the social.  network and get two parameters, usually this <code>appId</code> (or <code>clientId</code> is a unique id-schnick of our application in this social network) and Secret (a secret key that nobody can say, it will be used to enable our application to confirm that we are us).  When registering, you will also need to enter the so-called <code>redirectURL</code> - that is, the url-address, where social.  the network will redirect the client browser after authorization.  In my example it will be: <a href="http://localhost/">localhost</a> : 3000 / auth / github / callback - but more on that later. <br><br>  In the example application, I will use authorization through <code>github</code> , registration of the application there is very simple (for other providers it is not more difficult).  First of all, you need to have a regular user account, an application is easily created in its settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e60/c78/5ad/e60c785ad9902fc060978e8fda6835f9.png"><br>  Don't tell my secret to anyone. <br><br><h5>  We connect derby-auth to our application </h5><br>  So, first of all, we <code>derby-auth</code> directly from the git-repository, for some reason, they have the master version under the previous <code>derby</code> : <br><br>  npm install git: //github.com/cray0000/derby-auth#0.5 -S <br><br>  <code>Derby-auth</code> automatically puts <code>passport</code> and <code>passport-local</code> , it remains to install <code>passport-github</code> : <br><br><pre> <code class="bash hljs">npm install passport-github -S</code> </pre><br><br>  Now go to the settings.  We will do everything in accordance with the instructions - <a href="">https://github.com/lefnire/derby-auth/tree/0.5</a> .  Most of the connection actions are performed on the server, that is, we need src / server / server.js. <br><br><h6>  Step 1 </h6><br>  We connect derby-auth itself, and set up strategies (of course in a normal application, the settings should be taken from the config file or environment variables) <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//  derby-auth var auth = require('derby-auth'); var strategies = { github: { strategy: require("passport-github").Strategy, conf: { clientID: 'eeb00e8fa12f5119e5e9', clientSecret: '61631bdef37fce808334c83f1336320846647115' } } }</span></span></code> </pre><br>  It is clear that if there were more strategies, they would all be listed here: <br><br><h6>  Step 2 </h6><br>  Set options: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">passport</span></span>: { <span class="hljs-attr"><span class="hljs-attr">failureRedirect</span></span>: <span class="hljs-string"><span class="hljs-string">'/login'</span></span>, <span class="hljs-attr"><span class="hljs-attr">successRedirect</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">site</span></span>: { <span class="hljs-attr"><span class="hljs-attr">domain</span></span>: <span class="hljs-string"><span class="hljs-string">'http://localhost:3000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Derby-auth example'</span></span>, <span class="hljs-attr"><span class="hljs-attr">email</span></span>: <span class="hljs-string"><span class="hljs-string">'admin@mysite.com'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">smtp</span></span>: { <span class="hljs-attr"><span class="hljs-attr">service</span></span>: <span class="hljs-string"><span class="hljs-string">'Gmail'</span></span>, <span class="hljs-attr"><span class="hljs-attr">user</span></span>: <span class="hljs-string"><span class="hljs-string">'zag2art@gmail.com'</span></span>, <span class="hljs-attr"><span class="hljs-attr">pass</span></span>: <span class="hljs-string"><span class="hljs-string">'blahblahblah'</span></span> } }</code> </pre><br>  In principle, everything is clear from the names: <code>failureRedirect</code> , <code>successRedirect</code> - url-address where the client will be redirected in case of not successful / successful authorization, respectively.  Site information is needed to be sent to a strategy (for example, social networks can use it if the corresponding fields were not filled in when registering the application).  The mail settings are needed in order for the ‚Äúforgotten password‚Äù feature to work - reset it and send me a new one for soap. <br><br><h6>  Step 3 </h6><br>  Initializing the repository <br><br><pre> <code class="javascript hljs"> auth.store(store, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, strategies);</code> </pre><br><br>  At this step, <code>derby-auth</code> adds data access control, the user will not be able to get other people's records from the auths collection ‚Äî he will only see his account.  The second parameter is currently not used. <br><br><h6>  Step 4 </h6><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let us make sure that middleware for storing sessions is connected to the express and </font></font><code>body-parser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(we do not have it yet - we will install </font></font><code>npm i body-parser -S</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and connect it):</font></font><br><br><pre> <code class="javascript hljs"> expressApp.use(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'cookie-parser'</span></span>)()); expressApp.use(session({ <span class="hljs-attr"><span class="hljs-attr">secret</span></span>: process.env.SESSION_SECRET || <span class="hljs-string"><span class="hljs-string">'YOUR SECRET HERE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">store</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MongoStore({<span class="hljs-attr"><span class="hljs-attr">url</span></span>: mongoUrl}) })); expressApp.use(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'body-parser'</span></span>)()) <span class="hljs-comment"><span class="hljs-comment">//  method-override , //    ,  PUT   //   expressApp.use(require('method-override')())</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well and the last - we connect </font></font><code>derby-auth middeware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the heap of all about it </font><font style="vertical-align: inherit;">is connected </font><font style="vertical-align: inherit;">here further:</font></font><br><br><pre> <code class="javascript hljs">expressApp.use(auth.middleware(strategies, options));</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's see what is happening here. </font><font style="vertical-align: inherit;">If this is middleware, it is logical to assume that some controllers are registered here that </font></font><code>expressjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process requests to specific url. </font><font style="vertical-align: inherit;">So it is - here is a summary of the controllers:</font></font><br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Route </font></font></th><th>  Method </th><th>  Options </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Purpose </font></font></th></tr><tr><td>  / login </td><td> <code>post</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> username password </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Login to the system by login and password </font></font></td></tr><tr><td>  / register </td><td> <code>post</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> username, email, password </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Serves for user registration by login and password </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / auth /: provider </font></font></td><td> <code>get</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> absent </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Passing here we will be redirected to the authorization page of the corresponding social. </font></font> network. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Example path: / auth / github </font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / auth /: provider / callback </font></font></td><td> <code>get</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> absent </font></font></td><td>  .      ‚Äî derby-auth       failureRedirect  successRedirect url. <br>  : /auth/github/callback ‚Äî  url   ,          .  network. <br></td></tr><tr><td> /logout </td><td> <code>get</code> </td> <td>  </td><td>     ¬´¬ª       '/' </td></tr><tr><td> /password-reset </td><td> <code>post</code> </td> <td>  email </td><td>   email     (   AJAX) </td></tr><tr><td> /password-change </td><td> <code>post</code> </td> <td> uid, oldPassword, newPassword </td><td>     (   AJAX) </td></tr></tbody></table><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is one more (optional) step in the manual - connecting components (html and authorization / registration form styles, etc.), but these components are written under Derby 0.5 and have not yet been updated. </font><font style="vertical-align: inherit;">In my example, I follow the simplest implementation of forms to demonstrate the basic principles of work. </font><font style="vertical-align: inherit;">But first you need to discuss another point.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What we will see in the model on the client </font></font></h5><br><br> <code>Derby-auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It sends certain data to the client, which allows you to find out whether the user has logged in, his id, as well as supporting information describing problems with logging and registration: </font></font><br><table><tbody><tr><th>  Let be </th><th>  Description </th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> _session.loggedIn </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Boolean variable - authorized / not authorized user </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> _session.userId </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User ID </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> _session.flash.error </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array of strings - auxiliary error messages (various authorization / registration errors) </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auth. {userId} .local </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Local Registration Information </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auth. {userId}. {provider} </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Registration data through the corresponding social. </font></font> network </td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All this is available in the templates and will be used by us to determine the status of authorization. </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sample application </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, of course, if the visual components of the </font></font><code>derby-auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">would fit the 6th version of the derby, the application would be written in two accounts, without them more difficult. </font><font style="vertical-align: inherit;">To simplify development, we connect </font></font><code>bootstrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for this we enter in src / app / index.js</font></font><br><pre> <code class="javascript hljs">app.use(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'d-bootstrap'</span></span>));</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> having done </font></font><br><pre> <code class="javascript hljs">npm i d-bootstrap -S</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The third bootstrap is installed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the application, I will make 2 pages: the first, under the address "/" with the authorization status, so that we can see if the user has logged into his account, as well as the credentials, the second, at the address / login, directly with the authorization registration logs, so that to experiment. Also, before rendering each of these two pages, I will pull up user credentials from the collection </font></font><code>auths</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I think the derby application file </font></font><code>src/app/index.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does not require special comments, the only thing that we did not discuss is the controller "*", but this is the standard thing for the express:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> derby = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'derby'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = derby.createApp(<span class="hljs-string"><span class="hljs-string">'auth'</span></span>, __filename); global.app = app; app.use(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'d-bootstrap'</span></span>)); app.loadViews (__dirname+<span class="hljs-string"><span class="hljs-string">'/../../views'</span></span>); app.loadStyles(__dirname+<span class="hljs-string"><span class="hljs-string">'/../../styles'</span></span>); app.get(<span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page, model, params, next</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = <span class="hljs-string"><span class="hljs-string">'auths.'</span></span> + model.get(<span class="hljs-string"><span class="hljs-string">'_session.userId'</span></span>); model.subscribe(user, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ model.ref(<span class="hljs-string"><span class="hljs-string">'_page.user'</span></span>, user); next(); }); }); app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page, model</span></span></span><span class="hljs-function">)</span></span>{ page.render(<span class="hljs-string"><span class="hljs-string">'home'</span></span>); }); app.get(<span class="hljs-string"><span class="hljs-string">'/login'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page, model</span></span></span><span class="hljs-function">)</span></span>{ page.render(<span class="hljs-string"><span class="hljs-string">'login'</span></span>); });</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let‚Äôs do this according to the templates - we will do it </font></font><code>layout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the menu in the file </font></font><code>index.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>home.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>login.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will put </font><font style="vertical-align: inherit;">in the files </font><font style="vertical-align: inherit;">, respectively, a page with information about the user‚Äôs status (entered / not entered, whether the github account is linked), and a page with authorization / registration.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, index.html</font></font></b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">import:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./home"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">import:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./login"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Title:</span></span></span><span class="hljs-tag">&gt;</span></span> Derby-auth example <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Body:</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"navbar navbar-inverse"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"navigation"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"navbar-header"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"navbar-brand"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span>Derby-auth Example<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"collapse navbar-collapse"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav navbar-nav"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav-link"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav-link"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/login"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> {{if _session.flash.error}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> {{each _session.flash.error as #error}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert alert-warning"</span></span></span><span class="hljs-tag">&gt;</span></span>{{#error}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> {{/}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> {{/}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{$render.ns}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nav-link:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">element</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav-link"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{if $render.url === @href}}active{{/}}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{@href}}"</span></span></span><span class="hljs-tag">&gt;</span></span>{{@content}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This menu and in general most of the markup here are purely auxiliary and are not specifically related to authorization as such (well, except for the alert). </font><font style="vertical-align: inherit;">The only thing that can cause questions here is:</font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{$render.ns}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instead of this line, the derby will insert the content either </font></font><code>home.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, or </font></font><code>login.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, depending on what we have registered in the controller: </font></font><code>page.render('home')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or The </font></font><code>page.render('login')</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page with auxiliary information </font></font><code>home.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">index:</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> {{if _session.loggedIn}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> :<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> {{if _page.user.local}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> : <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>{{_page.user.local.username}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {{else}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {{/}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>GitHub:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> {{if _page.user.github}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> : <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>{{_page.user.github.username}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {{else}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {{/}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-danger"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/logout"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> {{else}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/login"</span></span></span><span class="hljs-tag">&gt;</span></span>/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> {{/}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pay attention to the ‚ÄúExit‚Äù button - the controller is used here. </font></font><code>GET /logout  derby-auth</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will not bother </font><font style="vertical-align: inherit;">too </font><font style="vertical-align: inherit;">much and take the login form along with the styles straight from the bootstrap site, there is an excellent example of ‚Äúsign in‚Äù </font></font><a href="http://getbootstrap.com/examples/signin/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://getbootstrap.com/examples/signin/</font></font></a> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Styles are stupidly copied from the bootstrap example - file slyles / index.styl</font></font></b> <div class="spoiler_text"><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">max-width</span></span>: <span class="hljs-number"><span class="hljs-number">330px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } <span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin-heading</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.checkbox</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.checkbox</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: normal; } <span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.form-control</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: relative; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: auto; <span class="hljs-attribute"><span class="hljs-attribute">-webkit-box-sizing</span></span>: border-box; <span class="hljs-attribute"><span class="hljs-attribute">-moz-box-sizing</span></span>: border-box; <span class="hljs-attribute"><span class="hljs-attribute">box-sizing</span></span>: border-box; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">16px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.form-control</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type="email"]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: -<span class="hljs-number"><span class="hljs-number">1px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-bottom-right-radius</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-bottom-left-radius</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.form-signin</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type="password"]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-top-left-radius</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-top-right-radius</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The login.html file with authorization and registration: </font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">index:</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"signin"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"signup"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">signin:</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-signin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/login'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'post'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-signin-heading"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofocus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-lg btn-primary btn-block"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-lg btn-danger btn-block"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/auth/github"</span></span></span><span class="hljs-tag">&gt;</span></span> GitHub<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">signup:</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-signin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/register'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'post'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-signin-heading"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofocus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-lg btn-primary btn-block"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you start everything, it will look something like this: </font></font><br><img src="https://habrastorage.org/getpro/habr/post_images/62b/0c8/1fd/62b0c81fdd92f13f6a77a10b2608a008.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I changed the Bootstap form a bit, based on our derby-auth controllers. What we pay attention to in the registration form: this is the post form leading to the action / login - derby-auth will process, the username and password field names are all from our table. Logging in via GitHub - get request to / auth / github - also from there. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registration form. The same thing - post to / register, fields: username, email, password.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We start the application: npm start - we look at the status - ‚Äúthe user is not logged in‚Äù, we register, we see - ‚Äúthe user is in the system‚Äù. We can get - / logout. Until we come out, we have the opportunity to link a github account to the current account, for this you need to click ‚Äúlog in via github‚Äù, we will be redirected to the github, log in there, confirm everything and go back to the site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Derby-auth also allows, without registering through a local strategy, to register on the site through social accounts.</font></font> networks.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I prefer the technique used in the Habr√©, when only a registered user can link social accounts to his account. nets, but for this derby-auth need a little tweak. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Play around with what you got. View available data using the developer console (enter app.model.get () in the console). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I apologize that we didn‚Äôt implement the remaining chips in the example </font></font><code>derby-auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(resetting and changing the password) - this lesson came out pretty big because of the need to explain the server part of the derby. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We also implemented simplified forms, the point here is that in a full-fledged application, these blocks will be put into separate components, and we have not studied them yet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The final version on </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I ask those who at least tried something myself, unsubscribe in the comments and tell you what happened. </font><font style="vertical-align: inherit;">You can not write comments on the brave - write on the </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Interestingly, it‚Äôs not for nothing that I write.</font></font><br><br>  <b>PS</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you do not want to skip the following articles on derbyjs, subscribe to updates in my profile: </font></font><a href="http://habrahabr.ru/users/zag2art/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zag2art</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">I do it myself - on the Habr√© there is no possibility to add a specific (very interesting) hub to the tracker in order not to miss anything.</font></font><br><br>  <b>Pps</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, the derby 0.6 alpha 7 is already out - the final release is getting closer and closer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you like derbyjs, don‚Äôt take the trouble to put an asterisk on </font></font><a href="https://github.com/codeparty/derby/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a> </div><p>Source: <a href="https://habr.com/ru/post/222399/">https://habr.com/ru/post/222399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222383/index.html">Useful materials for mobile developer # 52 (May 5-11)</a></li>
<li><a href="../222385/index.html">Lenovo ThinkServer TS140 - server available to everyone</a></li>
<li><a href="../222391/index.html">Google continues to destroy RSS</a></li>
<li><a href="../222395/index.html">Dream for Single Stage To Orbit</a></li>
<li><a href="../222397/index.html">Find invalid objects</a></li>
<li><a href="../222401/index.html">How to create and earn money on SaaS (Part 7 / why isn‚Äôt SaaS sold?)</a></li>
<li><a href="../222403/index.html">Python-digest # 26. News, interesting projects, articles and interviews [May 4, 2014 - May 11, 2014]</a></li>
<li><a href="../222405/index.html">Cellebrite Touch - teleport for phone</a></li>
<li><a href="../222407/index.html">GPS Navigator in the flashlight</a></li>
<li><a href="../222411/index.html">Python Webmoney API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>