<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do-it-yourself XML gateway</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you had to work with payment systems, registration services and other resources that implement remote interaction with the central server, you prob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do-it-yourself XML gateway</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img11.imageshack.us/img11/6648/xmls.gif" align="right">  If you had to work with payment systems, registration services and other resources that implement remote interaction with the central server, you probably came across the concept of ‚Äúgateway‚Äù.  This is a service that is designed to conduct operations on a central server by exchanging electronic messages between the central server (the server of the system having a gateway) and the software of a certain client. <br><br>  Perhaps the ideal gateway should be able to receive and transmit data in XML format, if only because it is a standardized, self-documenting format, support for which is implemented in all modern programming languages ‚Äã‚Äã(and even at the hardware level).  In addition, XML supports Unicode encodings of UTF-8, UTF-16, and even UTF-32.  In brief, but with examples, I will talk about the principles of creating simple XML gateways.  Sending requests, simplicity and, at the same time, diversity for the sake of consider the example of POST / GET methods. <br><br><a name="habracut"></a>  To begin, consider the concept of interaction.  You are the server that will receive requests, process them and give the requested information to the client in a typed format. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://img139.imageshack.us/img139/4114/20090728130430.gif" alt="image"><br><br>  I suggest, for clarity, to consider the following example: you have a certain database of information materials on your server that you are ready to provide for a monthly fee.  The material is divided into categories, there is a database of partners which contains information on which categories each partner has access to. <br><br>  In order for a partner to receive material only within its access, we need to clearly identify it.  Otherwise, he or any other savvy will be able to ‚Äúpull‚Äù out of you more of what he should be, and this is fraught with a tarnished reputation and financial losses, because  we have a commercial project. <br><br>  The identification problem can be solved by giving the partners unique access keys that will be generated with reference to the IP address of the server making the request to the gateway. <br><br>  For example, there is the company Shishkin Les, which paid for lifelong access to materials from categories 1, 2, 5 and 9. The company's server is located under the director‚Äôs bed, but the static IP address and we know it is 12.34.56.78.  Now we need to generate a unique access key for this partner, which can be done something like this: <br><blockquote><ol><li> <code><font color="black">&lt;?php define( <font color="#A31515">'SECRET_WORD'</font> , <font color="#A31515">'LsXUS~J'</font> ); function getUniqueKey($ip, $access) { <font color="#0000ff">return</font> substr(md5($ip . SECRET_WORD . $access), 5, 20); } ?&gt;</font></code> </li> <li></li><li> <code><font color="black">&lt;?php define( <font color="#A31515">'SECRET_WORD'</font> , <font color="#A31515">'LsXUS~J'</font> ); function getUniqueKey($ip, $access) { <font color="#0000ff">return</font> substr(md5($ip . SECRET_WORD . $access), 5, 20); } ?&gt;</font></code> </li> <li></li><li> <code><font color="black">&lt;?php define( <font color="#A31515">'SECRET_WORD'</font> , <font color="#A31515">'LsXUS~J'</font> ); function getUniqueKey($ip, $access) { <font color="#0000ff">return</font> substr(md5($ip . SECRET_WORD . $access), 5, 20); } ?&gt;</font></code> </li> <li></li><li> <code><font color="black">&lt;?php define( <font color="#A31515">'SECRET_WORD'</font> , <font color="#A31515">'LsXUS~J'</font> ); function getUniqueKey($ip, $access) { <font color="#0000ff">return</font> substr(md5($ip . SECRET_WORD . $access), 5, 20); } ?&gt;</font></code> </li> <li></li><li> <code><font color="black">&lt;?php define( <font color="#A31515">'SECRET_WORD'</font> , <font color="#A31515">'LsXUS~J'</font> ); function getUniqueKey($ip, $access) { <font color="#0000ff">return</font> substr(md5($ip . SECRET_WORD . $access), 5, 20); } ?&gt;</font></code> </li> <li></li><li> <code><font color="black">&lt;?php define( <font color="#A31515">'SECRET_WORD'</font> , <font color="#A31515">'LsXUS~J'</font> ); function getUniqueKey($ip, $access) { <font color="#0000ff">return</font> substr(md5($ip . SECRET_WORD . $access), 5, 20); } ?&gt;</font></code> </li> </ol></blockquote><br>  Pay attention to the constant "SECRET_WORD", which is constant regardless of other conditions.  The getUniqueKey () function takes as parameters the IP address of the server ($ ip = '12 .34.56.78 ') and the string of the collapsed ID categories to which the partner has access ($ access =' ‚Äã‚Äã1259 ').  Further, md5-hash is generated from all these parameters, which is truncated to a 15-character string (starting, in our example, from the 5th character of the hash).  This is our unique key that is generated for each partner.  We will check the correctness of the key with each request from the client. <br><br>  As discussed earlier, the client can make a request to the server using the POST / GET methods, passing the necessary parameters to them.  Consider an example of such a query: <br><blockquote> <code><a href="http://mysite.com/gateway.php%3Fid%3D1%26type%3Dlist%26token%3D8381ad87b37986ac7bb6"></a> mysite.com/gateway.php?id=1&amp;type=list&amp;token=8381ad87b37986ac7bb6</code> </blockquote> <br>  So, we make a request to the gateway and pass it only 3 parameters: <br><ul><li>  id = 1, personal client ID in your system </li><li>  type = list, this is a parameter invented for me that tells the server exactly what and in what form the client wants to get from it </li><li>  token = 8381ad87b37986ac7bb6, a unique client key that it sends to the server during each transaction for authentication </li></ul><br>  The gateway (gateway.php) can only verify the authenticity of the connection and respond to the client's request.  By the way, it is necessary to answer in any case, even if the key is incorrect or a sampling / response error has occurred - the client is still obliged to receive an answer. <br><br>  Consider the key verification function when requesting the gateway: <br><blockquote><ol><li>  &lt;? php </li><li></li><li>  function checkValidation ($ clientID, $ clientToken) { </li><li></li><li>  <font color="#008000">// client IP address</font> </li><li>  $ clientRemoteAddr = (getenv ( <font color="#A31515">'HTTP_X_FORWARDED_FOR'</font> ))?  getenv ( <font color="#A31515">'HTTP_X_FORWARDED_FOR'</font> ): getenv ( <font color="#A31515">'REMOTE_ADDR'</font> ); </li><li></li><li>  <font color="#008000">// Client access level to categories</font> </li><li>  <font color="#008000">// Actually there should be a sample</font> </li><li>  <font color="#008000">// client access rights by its $ clientID</font> </li><li>  $ clientAccessLevel = <font color="#A31515">'1259'</font> ; </li><li></li><li>  <font color="#008000">// The correct key</font> </li><li>  $ checkToken = getUniqueKey ($ clientRemoteAddr, $ clientAccessLevel); </li><li></li><li>  <font color="#008000">// Comparison of verification and keys received from the client</font> </li><li>  <font color="#0000ff">return</font> ($ clientToken == $ checkToken); </li><li></li><li>  } </li><li></li><li>  ?&gt; </li></ol></blockquote><br>  Thus, if the checkValidation () function returns true, then connection authentication is passed.  Now you can begin to form and prepare a response. <br><br>  In our example, the answer should contain a certain sample of information from different categories, suppose that such a sample contains the following set of fields: <br><ul><li>  element_id - the identifier of each specific entry is unique </li><li>  category_id - identifier of the rubric to which the entry belongs (I remind you that in our example the client has access to the rubrics 1, 2, 5 and 9) </li><li>  title - the title of the element </li><li>  text - the contents of the entry </li><li>  time - the date and time of the publication of the record (choose the date format yourself) </li></ul><br>  The structure of the answer in this case would be something like this: <br><blockquote><ol><li>  <font color="#0000ff">&lt;?</font>  <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">= "1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">= "utf-8"</font> ?  <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">response</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">error-code</font> <font color="#0000ff">&gt;</font> 0 <font color="#0000ff">&lt;/</font> <font color="#800000">error-code</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">content</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">element_id</font> <font color="#0000ff">&gt;</font> 1 <font color="#0000ff">&lt;/</font> <font color="#800000">element_id</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">category_id</font> <font color="#0000ff">&gt;</font> 5 <font color="#0000ff">&lt;/</font> <font color="#800000">category_id</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> Title 1 <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">text</font> <font color="#0000ff">&gt;</font> Text element number 1, about all garbage <font color="#0000ff">&lt;/</font> <font color="#800000">text</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">time</font> <font color="#0000ff">&gt;</font> 1248770309 <font color="#0000ff">&lt;/</font> <font color="#800000">time</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">element_id</font> <font color="#0000ff">&gt;</font> 2 <font color="#0000ff">&lt;/</font> <font color="#800000">element_id</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">category_id</font> <font color="#0000ff">&gt;</font> 9 <font color="#0000ff">&lt;/</font> <font color="#800000">category_id</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> Title 2 <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">text</font> <font color="#0000ff">&gt;</font> Text element number 2, about all garbage <font color="#0000ff">&lt;/</font> <font color="#800000">text</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">time</font> <font color="#0000ff">&gt;</font> 1248770319 <font color="#0000ff">&lt;/</font> <font color="#800000">time</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">content</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">response</font> <font color="#0000ff">&gt;</font> </li></ol></blockquote><br>  The ‚Äúerror-code‚Äù attribute in case of successful operation should be equal to zero, which literally says to the client ‚Äúeverything is fine, below what you asked for‚Äù.  If any error has occurred, then the error code is transmitted in this attribute (the ‚Äúcontent‚Äù attribute and its entire content will not be in this case). <br><br>  Suppose our error handler knows the following possible problems: <br><ul><li>  Error 100 - key verification error (token is not true) </li><li>  Error 101 - Client ID not passed. </li><li>  Error 102 - the unique key of the client is not transferred </li><li>  Error 201 - the requested information was not found in the database </li><li>  Error 202 - an error occurred while selecting the requested information. </li></ul><br><br>  Well, and so on.  The answer with the error will be: <br><blockquote><ol><li>  <font color="#0000ff">&lt;?</font>  <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">= "1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">= "utf-8"</font> ?  <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">response</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">error-code</font> <font color="#0000ff">&gt;</font> 102 <font color="#0000ff">&lt;/</font> <font color="#800000">error-code</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">response</font> <font color="#0000ff">&gt;</font> </li></ol></blockquote><br>  The last thing left to consider is the formation of such an answer.  There may be a lot of implementations, like all of the above, but I will offer such a simple option: <br><blockquote><ol><li>  &lt;? php </li><li></li><li>  function sendResponse ($ code, $ content = <font color="#A31515">''</font> ) { </li><li></li><li>  <font color="#008000">// Create attribute</font> </li><li>  function getNode ($ key, $ <font color="#0000ff">value</font> ) { </li><li>  <font color="#0000ff">if</font> ($ <font color="#0000ff">value</font> ! = <font color="#A31515">''</font> ) { </li><li>  <font color="#0000ff">return</font> <font color="#A31515">'&lt;'</font> .  $ key.  <font color="#A31515">'&gt;'</font> .  $ <font color="#0000ff">value</font> .  <font color="#A31515">'&lt;/'</font> .  $ key.  <font color="#A31515">'&gt;'</font> ; </li><li>  } </li><li>  } </li><li></li><li>  <font color="#008000">// Additional fields</font> </li><li>  $ items = <font color="#A31515">''</font> ; </li><li></li><li>  <font color="#008000">// If $ content is not empty and is an array</font> </li><li>  <font color="#0000ff">if</font> (! empty ($ content) &amp;&amp; is_array ($ content)) { </li><li>  <font color="#0000ff">foreach</font> ($ content <font color="#0000ff">as</font> $ key =&gt; $ <font color="#0000ff">value</font> ) { </li><li>  $ items. = <font color="#A31515">'&lt;user&gt;'</font> ; </li><li>  <font color="#0000ff">if</font> (is_array ($ <font color="#0000ff">value</font> )) { </li><li>  <font color="#0000ff">foreach</font> ($ <font color="#0000ff">value</font> <font color="#0000ff">as</font> $ skey =&gt; $ svalue) { </li><li>  $ items. = getNode ($ skey, $ svalue); </li><li>  } </li><li>  } <font color="#0000ff">else</font> { </li><li>  $ items. = getNode ($ key, $ <font color="#0000ff">value</font> ); </li><li>  } </li><li>  $ items. = <font color="#A31515">'&lt;/ user&gt;'</font> ; </li><li>  } </li><li>  } </li><li></li><li>  <font color="#008000">// Generate and send a response</font> </li><li>  print <font color="#A31515">'&lt;response&gt; &lt;error-code&gt;'</font> .  $ code.  <font color="#A31515">'&lt;/ error-code&gt;'</font> .  $ items.  <font color="#A31515">'&lt;/ response&gt;'</font> ; </li><li>  exit (); </li><li></li><li>  } </li><li></li><li>  ?&gt; </li></ol></blockquote><br>  Hope this short article was interesting.  The proposed implementation, with some modifications, is quite suitable for use on small resources.  With a lot of traffic, the results of the issue must be cached, but this, I hope, everyone knows so well. <br><br>  Criticism, additions, other implementations in the comments are welcome :-) </div><p>Source: <a href="https://habr.com/ru/post/65570/">https://habr.com/ru/post/65570/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../65564/index.html">10 tricks of the best freelancers</a></li>
<li><a href="../65565/index.html">Configuring Apache + PHP + MsSQL + Oracle on Mac OS X Leopard</a></li>
<li><a href="../65566/index.html">Started receiving programs in the Windows Mobile Marketplace</a></li>
<li><a href="../65567/index.html">Ban Skype? And you!</a></li>
<li><a href="../65568/index.html">New demo version of the game Hammerfight</a></li>
<li><a href="../65571/index.html">Easy Video Cutter - simple video trimmer</a></li>
<li><a href="../65572/index.html">Psi 0.13</a></li>
<li><a href="../65573/index.html">Transfer hosters to php 5.3, statistics</a></li>
<li><a href="../65575/index.html">And again about robots.txt for WordPress (cheat sheet for beginners)</a></li>
<li><a href="../65577/index.html">The first video multiplayer Modern Warfare 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>