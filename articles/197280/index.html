<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing games in C ++, Part 2/3 - State-based programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Writing games in C ++, Part 1/3 - Writing a mini-framework 
 Writing games in C ++, Part 3/3 - Classics of the genre 

 Hello, Habrahabr! 

 Congratul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing games in C ++, Part 2/3 - State-based programming</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/post/197278/">Writing games in C ++, Part 1/3 - Writing a mini-framework</a> <br>  <a href="http://habrahabr.ru/post/197288/">Writing games in C ++, Part 3/3 - Classics of the genre</a> <br><br>  Hello, Habrahabr! <br><br>  Congratulations if you read the first lesson!  He is big enough.  I promise that there will be less code, and more results :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What is this part about? </h4><br><ul><li>  We will try to comprehend state-based programming, through which new levels and menus are made very easy </li></ul><br><br>  In the next post will be natural games :) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b91/bf0/12d/b91bf012d3d3e115dd59f3839dce507c.png"><br><br><a name="habracut"></a><br><h4>  2.1.  States </h4><br>  Now it would be nice to understand what the game actually consists of. <br><br>  Suppose we have a game where there are a lot of menus, levels and other ‚Äústates‚Äù.  How can you interact with them?  It is clear that the code type: <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(state) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> State::MENU: <span class="hljs-comment"><span class="hljs-comment">// 100  case State::SETTINGS: // 200  case State::LEVEL1: //   } }</span></span></code> </pre> <br>  Causes a cruel failure in terms of convenience. <br><br>  How about each state to make its heir from some class with the name, say, Screen, and use it in the Game? <br><br>  Create Screen.h <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> SCREEN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SCREEN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Project.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Game.h"</span></span></span><span class="hljs-meta"> class Game; class Screen { protected: Game* game; public: void SetController(Game* game); virtual void Start(); virtual void Update(); virtual void Destroy(); }; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br>  This class has an instance of Game, from where the heirs take pointers to Graphics and Input. <br>  Its virtual functions for successors: <br><ul><li>  Start - a call every time you start (destination state) </li><li>  Update - call each cycle </li><li>  Destroy - a call to destroy (the end of the program or the appointment of another state) </li></ul><br><br>  Screen.cpp <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Screen.h"</span></span></span><span class="hljs-meta"> void Screen::SetController(Game* game) { this-&gt;game = game; } void Screen::Start() { } void Screen::Update() { } void Screen::Destroy() { }</span></span></code> </pre><br><br>  Update Game.h and Game.cpp <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _GAME_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _GAME_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Project.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Graphics.h"</span></span></span><span class="hljs-meta"> class Graphics; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Input.h"</span></span></span><span class="hljs-meta"> class Input; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Screen.h"</span></span></span><span class="hljs-meta"> class Screen; class Game { private: bool run; Graphics* graphics; Input* input; Screen* screen; public: Game(); int Execute(Screen* startscreen, int width, int height); Graphics* GetGraphics(); Input* GetInput(); Screen* GetScreen(); void SetScreen(Screen* screen); void Exit(); }; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br>  The Screen object is included in the Game class and the Execute function is changed, where we transfer the object of our successor Screen from main.cpp. <br><br>  Game.cpp <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Game.h"</span></span></span><span class="hljs-meta"> Game::Game() { run = true; } int Game::Execute(Screen* startscreen, int width, int height) { graphics = new Graphics(width,height); input = new Input(); screen = startscreen; screen-&gt;SetController(this); this-&gt;screen-&gt;Start(); while(run) { input-&gt;Update(); screen-&gt;Update(); } screen-&gt;Destroy(); delete graphics; delete input; delete screen; SDL_Quit(); return 0; } Graphics* Game::GetGraphics() { return graphics; } Input* Game::GetInput() { return input; } Screen* Game::GetScreen() { return screen; } void Game::SetScreen(Screen* screen) { this-&gt;screen-&gt;Destroy(); delete this-&gt;screen; this-&gt;screen = screen; this-&gt;screen-&gt;SetController(this); this-&gt;screen-&gt;Start(); } void Game::Exit() { run = false; }</span></span></code> </pre><br>  The Execute method undergoes important changes - it processes the current state. <br>  SetScreen sets a new state by resetting the old one. <br>  GetScreen, in my opinion, is almost useless - except to reload the level in this way <br><pre> <code class="cpp hljs">SetScreen(GetScreen());</code> </pre><br>  But stupidity re-upload all resources.  In general, decide for yourself :) <br><br><h4>  2.2.  Compile!  Compile! </h4><br>  Play around? <br>  Open the main.cpp file and change it to the following state: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Project.h"</span></span></span><span class="hljs-meta"> class MyScreen : public Screen { public: void Start() { MessageBox(0,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, HabraHabr!"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Message"</span></span></span><span class="hljs-meta">,MB_OK); } }; int WINAPI WinMain(HINSTANCE,HINSTANCE,LPSTR,int) { Game game; return game.Execute(new MyScreen(),500,350); }</span></span></code> </pre><br>  All he does is display a standard Windows message. <br><br>  Attentive user will pay attention to the fact that the window is not closed by clicking on the red cross, and the title of the window, too, would not hurt to remove.  No problem - take work: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Project.h"</span></span></span><span class="hljs-meta"> class MyScreen : public Screen { private: Input* input; public: void Start() { input = game-&gt;GetInput(); SDL_WM_SetCaption(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, HabraHabr!"</span></span></span><span class="hljs-meta">,0); MessageBox(0,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, HabraHabr!"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Message"</span></span></span><span class="hljs-meta">,MB_OK); } void Update() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(input-&gt;IsKeyDown(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'w'</span></span></span><span class="hljs-meta">) || input-&gt;IsExit()) game-&gt;Exit(); } }; int WINAPI WinMain(HINSTANCE,HINSTANCE,LPSTR,int) { Game game; return game.Execute(new MyScreen(),500,350); }</span></span></code> </pre><br>  We do not want to work with a black window, let's draw something? <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Project.h"</span></span></span><span class="hljs-meta"> class MyScreen : public Screen { private: Input* input; Graphics* graphics; Image* test; public: void Start() { input = game-&gt;GetInput(); graphics = game-&gt;GetGraphics(); SDL_WM_SetCaption(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, HabraHabr!"</span></span></span><span class="hljs-meta">,0); test = graphics-&gt;NewImage(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"habr.bmp"</span></span></span><span class="hljs-meta">); } void Update() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(input-&gt;IsExit()) game-&gt;Exit(); graphics-&gt;DrawImage(test,0,0); graphics-&gt;Flip(); } }; int WINAPI WinMain(HINSTANCE,HINSTANCE,LPSTR,int) { Game game; return game.Execute(new MyScreen(),300,225); }</span></span></code> </pre><img src="https://habrastorage.org/getpro/habr/post_images/b91/bf0/12d/b91bf012d3d3e115dd59f3839dce507c.png"><br><br>  A programmer who is more knowledgeable in terms of performance will immediately realize that it is pointless to draw pictures every cycle if they do not change their location.  Indeed - lines <br><pre> <code class="cpp hljs"> graphics-&gt;DrawImage(test,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); graphics-&gt;Flip();</code> </pre><br>  It is necessary to move from Update () to the end of Start () <br><br><h4>  2.3.  Results </h4><br>  I hope you were impressed and learned a lot. :) <br>  Then go to the third lesson without a doubt. <br><br>  For all questions, please contact the PM, and if you are not lucky enough to be registered in the Habr√©, write to me at izarizar@mail.ru <br><br></div><p>Source: <a href="https://habr.com/ru/post/197280/">https://habr.com/ru/post/197280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197266/index.html">The file to be committed before leaving work</a></li>
<li><a href="../197268/index.html">In space, discovered a strange lonely planet without a star</a></li>
<li><a href="../197270/index.html">IStruct - evolution continues</a></li>
<li><a href="../197276/index.html">Industrial programming, or a couple of words about the process control system</a></li>
<li><a href="../197278/index.html">Writing games in C ++, Part 1/3 - Writing a mini-framework</a></li>
<li><a href="../197284/index.html">Google and NASA have teamed up to create a quantum computer.</a></li>
<li><a href="../197286/index.html">New Nimbus Screen Capture with the possibility of sharing</a></li>
<li><a href="../197296/index.html">Meteor + JQuery-UI Sortable + Animation + Todos</a></li>
<li><a href="../197298/index.html">Create the first application on NancyFX</a></li>
<li><a href="../197300/index.html">Using Lua and C ++ to process and store data</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>