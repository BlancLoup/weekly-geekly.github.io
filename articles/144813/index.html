<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VK notifer on java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I happened to work on a project, the customer of which maintained feedback exclusively through the social network Vkontakte. Since I am not a ver...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VK notifer on java</h1><div class="post__text post__text-html js-mediator-article">  Once I happened to work on a project, the customer of which maintained feedback exclusively through the social network Vkontakte.  Since I am not a very active user of this social network, there was a problem in terms of the speed of receiving messages sent to me.  It so happened that I pulled the lower back and spent a couple of days on the bed.  So how to do lying down, and with a sore back, nothing special, then I decided to kill several problems with a swoop: <br><ul><li>  Brighten up the time of your rehabilitation </li><li>  Solve the problem with the delivery of messages </li><li>  Try yourself in writing programs in java </li></ul><br>  Results of the resulting java therapy under the cut. <br><a name="habracut"></a><br>  I would like to start by saying that I have never programmed java, so I do not pretend to the genius of my application. <br>  Pooh, settling down and pushing the exercises closer, I began my first application in this wonderful language. <br>  The first thing I decided to do was to build a ‚Äúskeleton‚Äù for my notifer.  All I needed was a simple tray menu that would show pop-up messages. <br><br><pre><code class="hljs pgsql">//   PopupMenu popup = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PopupMenu(); //   MenuItem exitItem = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MenuItem(""); //    exitItem.addActionListener(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ActionListener(){ <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> actionPerformed(ActionEvent e) { <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); } }); //    popup.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(exitItem); SystemTray systemTray = SystemTray.getSystemTray(); Image image = Toolkit.getDefaultToolkit().getImage("vk_icon.png"); TrayIcon trayIcon = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> TrayIcon(image,"VKNotifer",popup); trayIcon.setImageAutoSize(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); //    systemTray.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(trayIcon); //  trayIcon.displayMessage("VKNotifer", "",TrayIcon.MessageType.<span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>);</code> </pre> <br>  Now the main task is to get a list of current messages.  For this purpose, I used the provided api Vkontakte.  The main information on api can be found <a href="http://vk.com/developers.php">here</a> . <br>  The first thing you need to do in order to be able to use api is <a href="http://vk.com/editapp%3Fact%3Dcreate">to create a Vkontakte application</a> , after which you will receive your application id needed to get the token. <br>  The second action to access api is to get the token itself.  To do this, you need to go through the following steps in your application: <br><ol><li>  Authorization </li><li>  Confirmation of Requested Requirements </li><li>  Directly getting token </li></ol><br>  After that, thanks to the received token, you can execute api methods.  The authorization process is described <a href="http://vk.com/developers.php%3Fid%3D-1_37230422%26s%3D1">here.</a> <br>  For these purposes, I created the VKapi class, which will have two methods: Get token and get a list of messages. <br>  Method one - getting a token: <br><pre> <code class="java hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultHttpClient(); <span class="hljs-comment"><span class="hljs-comment">//    HttpPost post = new HttpPost("http://oauth.vk.com/authorize?" + "client_id="+client_id+ "&amp;scope="+scope+ "&amp;redirect_uri="+redirect_uri+ "&amp;display="+display+ "&amp;response_type="+response_type); HttpResponse response; response = httpClient.execute(post); post.abort(); //  String HeaderLocation = response.getFirstHeader("location").getValue(); URI RedirectUri = new URI(HeaderLocation); //          //ip_h  to_h String ip_h= RedirectUri.getQuery().split("&amp;")[2].split("=")[1]; String to_h=RedirectUri.getQuery().split("&amp;")[4].split("=")[1]; //    post = new HttpPost("https://login.vk.com/?act=login&amp;soft=1"+ "&amp;q=1"+ "&amp;ip_h="+ip_h+ "&amp;from_host=oauth.vk.com"+ "&amp;to="+to_h+ "&amp;expire=0"+ "&amp;email="+email+ "&amp;pass="+pass); response = httpClient.execute(post); post.abort(); //       HeaderLocation = response.getFirstHeader("location").getValue(); post = new HttpPost(HeaderLocation); //    response = httpClient.execute(post); post.abort(); //       HeaderLocation = response.getFirstHeader("location").getValue(); //    post = new HttpPost(HeaderLocation); response = httpClient.execute(post); post.abort(); //       HeaderLocation = response.getFirstHeader("location").getValue(); //     access_token = HeaderLocation.split("#")[1].split("&amp;")[0].split("=")[1];</span></span></code> </pre><br>  For getting the list of messages, api Vkontakte has the method <a href="http://vk.com/developers.php%3Foid%3D-1%26p%3Dmessages.get">messages.get</a> <br>  Method two - getting a list of messages: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   String url = "https://api.vk.com/method/"+ "messages.get"+ "?out=0"+ "&amp;access_token="+access_token ; String line = ""; try { URL url2 = new URL(url); BufferedReader reader = new BufferedReader(new InputStreamReader(url2.openStream())); line = reader.readLine(); reader.close(); } catch (MalformedURLException e) { // ... } catch (IOException e) { // ... } return line;</span></span></code> </pre><br>  Class fully: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKapi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String client_id = <span class="hljs-string"><span class="hljs-string">"2971510"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String scope = <span class="hljs-string"><span class="hljs-string">"messages"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String redirect_uri = <span class="hljs-string"><span class="hljs-string">"http://oauth.vk.com/blank.html"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String display = <span class="hljs-string"><span class="hljs-string">"popup"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String response_type = <span class="hljs-string"><span class="hljs-string">"token"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String access_token; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String email = <span class="hljs-string"><span class="hljs-string">"******"</span></span>;<span class="hljs-comment"><span class="hljs-comment">//    email private String pass = "******";//     public void setConnection() throws IOException, URISyntaxException { //    token'a } public String getNewMessage() throws ClientProtocolException, IOException, NoSuchAlgorithmException, URISyntaxException { //      } }</span></span></code> </pre><br>  All that is left is to create an instance of the class, get a token and in the infinite loop get lists of messages.  If the newly received list is different from the previous one, then we display a notification about the new message. <br>  The result is: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, URISyntaxException, AWTException, InterruptedException, NoSuchAlgorithmException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   PopupMenu popup = new PopupMenu(); //   MenuItem exitItem = new MenuItem(""); //    exitItem.addActionListener(new ActionListener(){ public void actionPerformed(ActionEvent e) { System.exit(0); } }); //    popup.add(exitItem); SystemTray systemTray = SystemTray.getSystemTray(); //  Image image = Toolkit.getDefaultToolkit().getImage("vk_icon.png"); TrayIcon trayIcon = new TrayIcon(image,"VKNotifer",popup); trayIcon.setImageAutoSize(true); //    systemTray.add(trayIcon); trayIcon.displayMessage("VKNotifer", "  ",TrayIcon.MessageType.INFO); //    VKapi vkAPI = new VKapi(); //  vkAPI.setConnection(); trayIcon.displayMessage("VKNotifer", " ",TrayIcon.MessageType.INFO); //  String oldMessage = vkAPI.getNewMessage(); String newMessage; int i = 0; for (;;){ //        3  Thread.sleep(3000); //    if (i == 15000){ //   45 000  (   ,     ) vkAPI.setConnection(); //   Thread.sleep(3000); //        i = 0; } //  newMessage = vkAPI.getNewMessage(); if (!newMessage.equals(oldMessage)) { oldMessage = newMessage; trayIcon.displayMessage("VKNotifer", "  ",TrayIcon.MessageType.INFO); Tools.playDrum(Drum.d53_Ride_Bell, 127,0); } i++; } }</span></span></code> </pre><br>  In addition to the pop-up window, an audible alert is also used. <br><pre> <code class="java hljs">Tools.playDrum(Drum.d53_Ride_Bell, <span class="hljs-number"><span class="hljs-number">127</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  To do this, use the library from <a href="http://habrahabr.ru/post/127840/">this topic.</a> <br><br>  I know that this is not an ideal performance, but the most important thing is that it completely solved my problems.  Thanks for attention. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/144813/">https://habr.com/ru/post/144813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144804/index.html">Twig. IPhone Multifunction Cable</a></li>
<li><a href="../144808/index.html">Seminar "Bitrix High School" - as it were, presentations, video</a></li>
<li><a href="../144809/index.html">Small robots copy the shape of objects.</a></li>
<li><a href="../144810/index.html">SLR camera simulator</a></li>
<li><a href="../144811/index.html">IPMI vulnerability in shell v. 1.00 allowing to reboot the server</a></li>
<li><a href="../144815/index.html">Hacked Bitcoinica site did not have backups</a></li>
<li><a href="../144816/index.html">Facebook buys Opera?</a></li>
<li><a href="../144817/index.html">Easy way or 0 Step Checkout in Magento</a></li>
<li><a href="../144819/index.html">Viruses with a radical. Again!</a></li>
<li><a href="../144820/index.html">Taxes in the USA. Part 1. Introduction, income tax, federal tax, state tax, Social Security taxes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>