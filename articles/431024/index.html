<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>All snapshots go to heaven</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now we all use banking applications. It is convenient, fast and, as it seems to us, safe. Banks even entered additional pin-codes so that even if you ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>All snapshots go to heaven</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/vq/xy/vn/vqxyvndjirfg6a4wgmmkmo57pho.jpeg" alt="image alt" align="left">  Now we all use banking applications.  It is convenient, fast and, as it seems to us, safe.  Banks even entered additional pin-codes so that even if you lose your phone or if it falls into the hands of a stranger, your funds and confidential data are protected.  And this is so cool!  Banks care about our security! <br><br>  But, unfortunately, if you open the same banking application in the task manager, then you will see the entire contents of its screen (for example, information on the account, bank card, chat, in which you discussed something with a bank employee).  You can check it on your banking applications.  I studied all the most famous - and they all do not hide sensitive information when you are in the background. <br><br>  For an example, I scribbled abstract jars on abstract pages.  And now I‚Äôll immediately ask you a question: you are going to transfer money to your mom / girlfriend / dog, you are already on the transfer page and left the application to copy the code from the sms (if you are banned from accessing the banking application), or see what any information.  But when you again decide to return to your banking application, which screen will you select? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  As we can see, in front of you are two absolutely identical screens and in a hurry you can and not notice it.  You will click on the latest application, go to it, enter the data and voila, your money is transferred.  And where are they transferred?  To whom? <br><br>  And it's not just that abstract bank, I looked at several of the most popular banks and they all suffer from such a problem. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/se/bk/h4/sebkh4mqq6rzrrrpm2q-kmsz62o.jpeg" alt="image alt"></div><br>  Interesting, but on the iOS side, the content of the screen in the task manager is hidden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/n_/8k/pvn_8kfmmaod9tagt8z3knmlaku.jpeg" alt="image alt"></div><br>  And there is an explanation.  But about this a little later, now we are talking about Android.  So, why hide the contents of the screen if the user exits the application? <br><br><h3>  Let's first understand how the screen manager works in general (Recents screen) </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/iz/6u/2z/iz6u2znbgtm1fmznzyo4emmg4na.jpeg" alt="image alt"></div><br>  On this screen we see a list of our previously open applications.  We are even shown the place where we stopped our interaction with a specific application.  But the fact is that we see not the application itself, we see the snapshot that is done before exiting the application. <br><br><h4>  What actually happens (briefly): </h4><br><ul><li>  The application is in the background </li><li>  The window manager places the application snapshot in a GraphicBuffer </li><li>  GraphicBuffer is sent to SystemUI via Binder to preview the application. </li></ul><br>  So what we see here is not the contents of the application, but only the snapshot made at the last moment before the transition of a particular application to the background. <br><br>  But, as you guessed, everything is not so simple, you can access these snapshots and, for example, also show the user in the Recents screen another application disguised as a bank, which Trojans use.  The user returns to the banking application, enters all the requested details, the money is transferred, but not at all where we would like. <br><br>  Or you can simply send these pictures, for example, to China, where the harsh Chinese are collecting information about everything and everyone.  Methods for using the obtained screenshots can be thought out endlessly. <br><br>  For the most part, of course, bother with hiding confidential data is necessary for banking applications or applications that contain any critical information that is not intended for others' eyes. <br><br>  To prohibit making snapshots, or they can be cleared only within a specific application.  And the <a href="https://source.android.com/devices/tech/perf/task-snapshots">documentation</a> says that only device manufacturers can modify the class, which is responsible for the mechanism for receiving and storing snapshots. <br><br><h3>  How to prevent the system from doing snapshots </h3><br>  There are several ways, however, unfortunately, not all of them are optimistic enough.  If you want to use any of them in your application, make sure that everything will work well on all devices. <br><br>  You can set a parameter for activity: <br><br><pre><code class="xml hljs">android:excludeFromRecents = "true"</code> </pre> <br>  However, this method will break the logic of user interaction with the application, since the application will not be shown at all in the Recents Screen. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(android.os.Build.VERSION.SDK_INT &gt;= android.os.Build.VERSION_CODES.HONEYCOMB) { getWindow().setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE); } setContentView()</code> </pre> <br>  This method does not violate the interaction logic, but the system begins to treat the contents of the application screen as protected, not allowing snapshots to be taken.  Below is an example of how it will look in Recents Screen. <br><br>  In addition, there is a way to track onPause ().  But here you have to constantly keep the prepared view in the View.GONE state so that when the application goes into the background you can make the View.VISIBLE.  But it will also not work very reliably, since, unfortunately, it is impossible to control the time of snapshot removal. <br><br>  By the way, but the cart was able, well, who would doubt :) On the screenshot is a secret chat, in this case FLAG_SECURE is used. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hr/br/hj/hrbrhj5wxj3gjyhxolgtt_qs5kc.jpeg" alt="image alt"></div><br>  So why are banks hiding the contents of the application on the iOS platform, which is now considered safer (which is a misconception), and left as is for the Android platform?  Most likely, they just do not like how the application will look in the Recents Screen.  That is just a white canvas.  In iOS, the implementation allows you to do beautifully.  As a result, we receive damage to security for the sake of beauty.  Perhaps you do not care if your money is where you would like, and data confidentiality is unshakable.  But are you ready to pay? .. <br><br>  So, in order not to end on such a pessimistic note, let us raise the question: can it be done beautifully for Android?  In fact, I have already figured out a way, but first you need to test it. <br><br>  If you are interested in this topic, I can describe how it all works from the inside.  How can I get snapshots, how the android system works, about the vulnerabilities of mobile applications. <br><br>  I decided to make myself a call and write something useful on a regular basis.  I will publish sketches in my <a href="https://t.me/paradisecurity">@paradisecurity</a> channel in telegrams, and then collect in full-fledged posts.  Bye bye everyone. <cut text=""></cut></div><p>Source: <a href="https://habr.com/ru/post/431024/">https://habr.com/ru/post/431024/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431014/index.html">Flexbox. Technology infographics</a></li>
<li><a href="../431016/index.html">US is asking partners to abandon the use of Huawei equipment</a></li>
<li><a href="../431018/index.html">Are you implementing a CRM system? Take off the rose-colored glasses</a></li>
<li><a href="../431020/index.html">Rome Club Report 2018, Chapter 1.7, Unsustainable Population Growth and Urbanization</a></li>
<li><a href="../431022/index.html">To be or not to be ... Whether to use www on your domain?</a></li>
<li><a href="../431026/index.html">Google, Microsoft and Qualcomm port Chrome to Windows 10 ARM</a></li>
<li><a href="../431028/index.html">How have bikes changed over the past 25 years</a></li>
<li><a href="../431030/index.html">New evidence demonstrates the existence of two types of infinite curves.</a></li>
<li><a href="../431034/index.html">Digital events in Moscow from November 26 to December 2</a></li>
<li><a href="../431036/index.html">"The whole world - analysis" or "Analyze it"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>