<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Teamviewer analogue from VNC, SSH and superglue</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The teamviewer is good for everyone, only for commercial purposes it‚Äôs not free, which you don‚Äôt get tired of reminding ... And in general, it‚Äôs not g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Teamviewer analogue from VNC, SSH and superglue</h1><div class="post__text post__text-html js-mediator-article">  The teamviewer is good for everyone, only for commercial purposes it‚Äôs not free, which you don‚Äôt get tired of reminding ... And in general, it‚Äôs not good to violate the license. <br><br>  But the convenience of launching quick support is impressive - the client launches a small program, dictates tsiferki by phone and voila, we see his desktop.  No VPN, no port forwarding and other pre-settings.  Is it convenient? <br><br>  VNC is quite suitable as a free analogue, with a call-back connection is quite acceptable, but only when there are many clients and the computer to which more than one problem clings too (although more solvable).  I personally like the idea of ‚Äã‚Äãteamviewer more.  And if you like, why not make your implementation ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Immediately make a reservation, the proposed solution, not even a solution at all, the implementation of the idea was made ‚Äúto try,‚Äù but it proved its efficiency, and improvements and convenience can be completed in the course of time. <br><br>  So, we take winvnc (tightvnc) as a basis, fasten a reverse SSH tunnel to it, and define the client, for example, by the port number.  We will need: <br>  OpenSSH server (on Linux, for example), web-server (with php in my case). <br>  The client will use its own winvnc (I took from the tightvnc-portable kit) and the console client SSH plink from the Putty package. <br><br>  In the alpha version of our remote support client, there will not be anything superfluous (and there will not be much more than that too), and TZ.  for the server it will look something like this: <br><br><ul><li>  On the server, there must be a certain user without rights, without the right to log in to the system, but with the ability to raise reverse tunnels.  Straight tunnels should also be limited. </li><li>  The server somehow has to inform the client about the tunnel, the address, the free port from a certain range. </li></ul><br><br>  For client: <br>  When started, the client should request from the server information about the tunnel. <br>  Run winvnc with predefined settings <br>  Raise the SSH tunnel with the obtained settings. <br><br>  Let's start: <br><br>  I will not go into the issues of running apache2 + php + OpenSSH, suppose that all this already exists. <br>  Add a vnc user: <br><br><pre><code class="hljs ruby">$ sudo useradd -M -s /bin/<span class="hljs-literal"><span class="hljs-literal">false</span></span> vnc</code> </pre> <br>  It is necessary to redefine the shell by default, otherwise someone smart can log in to the server. <br><br>  Assign a password: <br><pre> <code class="hljs ruby">$ sudo passwd vnc</code> </pre> <br>  Any password, it will still lie somewhere in the clear. <br><br>  In sshd_config (/ etc / ssh / sshd_config), we allow opening ports on all network interfaces by adding the option: <br><pre> <code class="hljs coffeescript">GatewayPorts=<span class="hljs-literal"><span class="hljs-literal">yes</span></span></code> </pre> <br><br>  Without it, the tunnel will open at the address 127.0.0.1 (from the server) and without additional shamanism it cannot be used remotely.  It remains to restart OpenSSH <br><br> <code>$ sudo service ssh restart</code> <br> <br>  It was thought up to transfer the settings to the client in the form of a cmd script that will launch a plink and notify the client about the magic dial that you need to report.  This will be done by a PHP script (or what will be convenient) of the form: <br><br><pre> <code class="hljs bash">&lt;?php <span class="hljs-variable"><span class="hljs-variable">$server</span></span> = <span class="hljs-string"><span class="hljs-string">'mysshserver.com'</span></span>; //  OpenSSH  <span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'vnc'</span></span>; //    <span class="hljs-variable"><span class="hljs-variable">$password</span></span>= <span class="hljs-string"><span class="hljs-string">'123'</span></span>; //     <span class="hljs-variable"><span class="hljs-variable">$ssh_port</span></span>=22; //    SSH <span class="hljs-variable"><span class="hljs-variable">$vnc_port</span></span>=11111; //     VNC- <span class="hljs-variable"><span class="hljs-variable">$port_start</span></span> = 40000; //   <span class="hljs-variable"><span class="hljs-variable">$port_end</span></span> = 50000; <span class="hljs-variable"><span class="hljs-variable">$ports</span></span> = NULL; //   <span class="hljs-variable"><span class="hljs-variable">$r</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>(<span class="hljs-string"><span class="hljs-string">"netstat -lnt4 | tail -n +3 | awk 'BEGIN{FS=\"[: ]+\"}{print </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$5</span></span></span><span class="hljs-string">;}' | sort -n"</span></span>, <span class="hljs-variable"><span class="hljs-variable">$ports</span></span>); //     <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-variable"><span class="hljs-variable">$port</span></span> = rand(<span class="hljs-variable"><span class="hljs-variable">$port_start</span></span>, <span class="hljs-variable"><span class="hljs-variable">$port_end</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!in_array(<span class="hljs-variable"><span class="hljs-variable">$port</span></span>, <span class="hljs-variable"><span class="hljs-variable">$ports</span></span>)) <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (1); // cmd- header(<span class="hljs-string"><span class="hljs-string">"Content-type: text/plain;"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"@echo off\r\n"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"title Port number is: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$port</span></span></span><span class="hljs-string">\r\n"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"start /MIN cscript mb.vbs \"Port number is: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$port</span></span></span><span class="hljs-string">\"\r\n"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"plink.exe -N -R </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$port</span></span></span><span class="hljs-string">:localhost:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$vnc_port</span></span></span><span class="hljs-string"> -P </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ssh_port</span></span></span><span class="hljs-string"> -pw </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$password</span></span></span><span class="hljs-string"> -l </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string"> -batch </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$server</span></span></span><span class="hljs-string"> \r\n"</span></span> ?&gt;</code> </pre> <br><br>  And add permissions for the firewall: <br><pre> <code class="hljs 1c"><span class="hljs-meta"><span class="hljs-meta">#    iptables -A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT #    vnc itpables -A OUTPUT -m owner --uid-owner `id -u vnc` -j REJECT #     40000-50000 itpables -A INPUT -p tcp --dport 40000:50000 -j ACCEPT   ( </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">-,  SSH, HTTP -, </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> ): itpables -P INPUT DROP itpables -A INPUT -p tcp ‚Äîdport 22 -j ACCEPT itpables -A INPUT -p tcp ‚Äîdport 80 -j ACCEPT</span></span></code> </pre><br><br>  Now we are going to build the package for the client.  It will include: <br>  winvnc (again, I took from the package <a href="http://www.tightvnc.com/portable/">tightVNC portable</a> ) and the necessary libraries <br>  putty <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">plink</a> <br>  <a href="http://gnuwin32.sourceforge.net/packages/wget.htm">wget for windows</a> (binaries and dependencies) <br>  reg-files settings for winvnc and settings for plink.  The latter really wants an approved SSH key in the registry and there is no way to add it interactively. <br><br>  To get the cherished pieces of the registry, run Putty to cling to our SSH server, accept the key and export the registry: <br><br><pre> <code class="hljs tex">reg export HKEY_CURRENT_USER<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Software</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SimonTatham</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PuTTY</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SshHostKeys</span></span></span></span> keys.reg</code> </pre> <br><br>  We do the same with the winvnc settings: we run on a benchtop computer, <br>  in the settings we set: <br><ol><li>  Password or empty, to taste, on the Server tab, </li><li>  in the same place we set the port number I put 11111 (used in only PHP-script). </li><li>  On the Administration tab, we allow loopback connections, in the case of an empty password, we allow them to be used. </li><li>  Well, turn off the HTTP server, in our case it is not used. </li></ol><br>  Apply, close and export: <br><pre> <code class="hljs tex">reg export HKEY_CURRENT_USER<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Software</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ORL</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WinVNC</span></span></span></span>3 winvnc.reg</code> </pre> <br><br>  Add a vb script that will display a message box with the specified text: <br>  mb.vbs: <br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objArgs = WScript.Arguments messageText = objArgs(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">MsgBox</span></span> messageText</code> </pre> <br><br>  And the most important script that will connect everything: <br>  runme.cmd: <br><br><pre> <code class="hljs sql">winvnc.exe -<span class="hljs-keyword"><span class="hljs-keyword">kill</span></span> reg <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> host-key.reg reg <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> winvnc.reg <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> winvnc.exe -run wget <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://mysshserver.com/script.php -O tunnel.cmd &amp;&amp; tunnel.cmd winvnc.exe -<span class="hljs-keyword"><span class="hljs-keyword">kill</span></span></code> </pre> <br><br>  winvnc is broken in it (is it suddenly already working?), <br>  import the registry pieces, <br>  run winvnc <br>  Download the script and if downloaded - run it. <br><br>  It remains to add all of the above in one folder and pack it into the SFX archive, with the launch of this script after unpacking: for WinRAR SFX, something like this: <br><pre> <code class="hljs dos">Silent=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Path</span></span>=<span class="hljs-variable"><span class="hljs-variable">%TEMP%</span></span>\support SavePath Setup=<span class="hljs-variable"><span class="hljs-variable">%TEMP%</span></span>\support\runme.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span></code> </pre> <br><br>  and you can give to the client.  At startup, the archive will be quietly and quietly unpacked, the runme.cmd script will run, which will configure winvnc, plink, download the tunnel startup script, launch it and notify the client of the port number. <br>  As in the case of teamviewer, the client reports it, and you can connect (already to our SSH server, with the specified port number) <br><br>  As a result, we have: <br><ul><li>  Client can sit behind NAT </li><li>  VNC Viewer can also be behind NAT </li><li>  The only thing needed to connect to the client is the port number that the client dictates. </li></ul><br><br>  Now for future plans: <br><ol><li>  Remove heavy wget and generally rewrite all scripts on VBS </li><li>  Make a web-based interface for tracking connected clients and the ability to download a VNC file for quick connection. </li><li>  What else? </li></ol></div><p>Source: <a href="https://habr.com/ru/post/137723/">https://habr.com/ru/post/137723/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137716/index.html">The use of vacuum fluorescent indicator</a></li>
<li><a href="../137719/index.html">MSP430, learn to program and debug hardware (part 3)</a></li>
<li><a href="../137720/index.html">Yota antenna do it yourself</a></li>
<li><a href="../137721/index.html">Java DNS API, Wikipedia and twitter-marathon in one bottle</a></li>
<li><a href="../137722/index.html">Microsoft removed the start button</a></li>
<li><a href="../137725/index.html">Image Catalyst 2.2</a></li>
<li><a href="../137726/index.html">Web-based smart home with Perl XS</a></li>
<li><a href="../137730/index.html">We interpret Go as Python, Ruby, Bash</a></li>
<li><a href="../137732/index.html">Comparison of iOS and Android on the probability of crash reports</a></li>
<li><a href="../137734/index.html">Neurorents disconnected the tracker part</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>