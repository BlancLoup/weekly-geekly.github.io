<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Application of the principle of poka-yoke in programming using the example of PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I'm Alexei Grezov, server team badoo developer. We at Badoo always try to make our code easy to maintain, develop and reuse, because it depends...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Application of the principle of poka-yoke in programming using the example of PHP</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/def/090/184/def090184a614361ae5bca1c06063481.png"></p><br><p>  <em>Hello!</em>  <em>I'm Alexei Grezov, server team badoo developer.</em>  <em>We at Badoo always try to make our code easy to maintain, develop and reuse, because it depends on these parameters how quickly and efficiently we can implement a feature.</em>  <em>One way to achieve this goal is to write such code that simply does not allow you to make a mistake.</em>  <em>The most rigorous interface will not make a mistake with the order of its call.</em>  <em>The minimum number of internal states ensures the expected results.</em>  <em>The other day I saw an article that describes how the use of these methods simplifies the life of developers.</em>  <em>So, I offer you the translation of an article about the principle of "poka-yoke".</em> </p><a name="habracut"></a><br><p>  When working together with code in a medium or large team, sometimes there are difficulties in understanding and using someone else's code.  There are various solutions to this problem.  For example, you can agree to follow certain coding standards or use the framework known to the whole team.  However, this is often not enough, especially when you need to correct the error or add a new function to the old code.  It is hard to remember what specific classes were meant for and how they should work both individually and jointly.  At such moments, you can accidentally add side effects or errors, even without realizing it. </p><br><p>  These errors can be detected during <a href="https://www.sitepoint.com/8-must-have-php-quality-assurance-tools/">testing</a> , but there is a real chance that they will slip into production.  And even if they are revealed, it can take quite a long time to roll back the code and fix it. </p><br><p>  So how can we prevent this?  Using the principle of "poka-yoke". </p><br><h3 id="chto-takoe-poka-yoke">  What is poka-yoke? </h3><br><p>  Poka-yoke is a Japanese term that translates into English roughly as ‚Äúmistake-proofing‚Äù (error protection), and in the Russian version is better known as <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D1%2589%25D0%25B8%25D1%2582%25D0%25B0_%25D0%25BE%25D1%2582_%25D0%25B4%25D1%2583%25D1%2580%25D0%25B0%25D0%25BA%25D0%25B0">‚Äúfool protection‚Äù</a> .  This concept originated in <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B6%25D0%25BB%25D0%25B8%25D0%25B2%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B8%25D0%25B7%25D0%25B2%25D0%25BE%25D0%25B4%25D1%2581%25D1%2582%25D0%25B2%25D0%25BE">lean manufacturing</a> , where it refers to any mechanism that helps the equipment operator avoid mistakes. </p><br><p>  In addition to production, poka-yoke is often used in consumer electronics.  Take, for example, a SIM card, which, due to its asymmetric shape, can be inserted into the adapter only on the right side. </p><br><p><img src="https://habrastorage.org/web/881/b1c/09d/881b1c09d4a04aecaeaf087ae63e8179.jpg"></p><br><p>  The opposite example (without using the poka-yoke principle) is the PS / 2 port, which has the same connector shape for both the keyboard and the mouse.  They can only be distinguished by color and therefore easily confused. </p><br><p><img src="https://habrastorage.org/web/a5f/453/8a9/a5f4538a9c4549b48d4a3ff7a583578f.jpg"></p><br><p>  Another concept poka-yoke can be used in programming.  The idea is to make the public interfaces of our code as simple and clear as possible and generate errors as soon as the code is used incorrectly.  This may seem obvious, but in fact we often come across code in which there is none. </p><br><p>  Please note that poka-yoke is not intended to prevent intentional abuse.  The goal is to avoid accidental errors, and not to protect the code from malicious use.  Anyway, as long as someone has access to your code, he can always bypass the fuses, if he really wants it. </p><br><p>  Before discussing specific measures to make the code more error-proof, it is important to know that poka-yoke mechanisms can be divided into two categories: </p><br><ul><li>  error prevention </li><li>  error detection. </li></ul><br><p>  Error prevention mechanisms are useful for eliminating errors at an early stage.  Having simplified interfaces and behavior as much as possible, we ensure that no one can accidentally use our code incorrectly (remember the example with a SIM card). </p><br><p>  On the other hand, error detection mechanisms are outside our code.  They monitor our applications to track possible errors and warn us about them.  An example would be software that determines whether a device connected to a PS / 2 port has the correct type, and if not, tells the user why it is not working.  Such software could not <strong>prevent an</strong> error, since the connectors are the same, but it can <strong>detect</strong> it and report it. </p><br><p>  Next, we will look at several methods that can be used both to prevent and to detect errors in our applications.  But keep in mind that this list is just a starting point.  Depending on the specific application, additional measures may be taken to make the code more error proof.  In addition, it is important to make sure that poka-yoke is incorporated into your project: depending on the complexity and size of your application, some measures may be too expensive compared to the potential cost of errors.  Therefore, it is up to you and your team to decide which measures are best for you. </p><br><h3 id="primery-predotvrascheniya-oshibok">  Error Prevention Examples </h3><br><h4 id="obyavlenie-tipov">  Type declaration </h4><br><p>  Previously known as Type Hinting in PHP 5, type declarations are an easy way to protect against errors when calling functions and methods in PHP 7. By assigning certain types to function arguments, it becomes harder to disturb the order of arguments when calling this function. </p><br><p>  For example, let's consider a notification that we can send to the user: </p><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $userId; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $subject; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $message; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $userId, $subject, $message )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId = $userId; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;subject = $subject; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message = $message; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;subject; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message; } }</code> </pre> <br><p>  Without a type declaration, you can accidentally pass variables of the wrong type, which can disrupt the application.  For example, we can assume that <code>$userId</code> should be <code>string</code> , while in fact it can be <code>int</code> . </p><br><p>  If we pass the wrong type to the constructor, the error is likely to go unnoticed until the application tries to do something with this notification.  And at this moment, most likely, we will receive some mysterious error message, in which nothing will point to our code, where we pass <code>string</code> instead of <code>int</code> .  Therefore, it is usually preferable to force the application to crash as soon as possible, in order to detect such errors as early as possible during development. </p><br><p>  In this particular case, you can simply add a type declaration - PHP will stop and immediately warn us with a fatal error as soon as we try to pass a parameter of the wrong type: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $userId; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $subject; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $message; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $userId, string $subject, string $message )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId = $userId; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;subject = $subject; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message = $message; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;subject; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message; } }</code> </pre> <br><p>  Note that by default, PHP will try to cast invalid arguments to their expected types.  To prevent this from happening and a fatal error is generated, it is important to enable strict typing ( <code>strict_types</code> ).  Because of this, scalar type declaration is not an ideal form of poka-yoke, but serves as a good starting point for reducing errors.  Even with strong typing disabled, a type declaration can still serve as a hint as to what type is expected for the argument. </p><br><p>  In addition, we declared return types for our methods.  This makes it easier to determine what values ‚Äã‚Äãwe can expect when calling a particular function. </p><br><p>  Well-defined return types are also useful for avoiding a lot of switch statements when dealing with return values, because without explicitly declared return types, our methods can return different types.  Therefore, someone using our methods will have to check which type was returned in a particular case.  Obviously, you can forget about the <code>switch</code> , which will lead to errors that are difficult to detect.  But they become much less common when declaring the return type of a function. </p><br><h4 id="obekty-znacheniya">  Value objects </h4><br><p>  The problem that a type declaration cannot solve is that having multiple function arguments makes it possible to confuse their order when called. </p><br><p>  When arguments are of different types, PHP can warn us about the violation of the order of the arguments, but this does not work if we have several arguments with the same type. </p><br><p>  To avoid errors in this case, we could wrap our arguments in value-object <a href="https://en.wikipedia.org/wiki/Value_object">objects</a> : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserId</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $userId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $userId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId = $userId; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Subject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $subject; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $subject)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;subject = $subject; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;subject; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $message; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message = $message; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( UserId $userId, Subject $subject, Message $message )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId = $userId; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;subject = $subject; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message = $message; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserId</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subject</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Message</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre> <br><p>  Since our arguments are now of a very specific type, they are almost impossible to confuse. </p><br><p>  An additional advantage of using value objects compared to declaring scalar types is that we no longer need to include strong typing in each file.  And if we do not need to remember this, then we will not be able to forget about it. </p><br><h4 id="validaciya">  Validation </h4><br><p>  When working with value objects, we can encapsulate the logic of checking our data inside objects themselves.  Thus, it is possible to prevent the creation of a value object with an invalid state, which may lead to problems in the future in other layers of our application. </p><br><p>  For example, we may have a rule that any <code>UserId</code> should always be positive.  We could obviously check it whenever we get a <code>UserId</code> as input, but, on the other hand, it can also be easily forgotten in one place or another.  And even if this forgetfulness leads to an actual error in another layer of our application, it may be difficult to understand from the error message what actually went wrong, and this will complicate debugging. </p><br><p>  To prevent such errors, we could add some validation to the <code>UserId</code> constructor: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserId</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $userId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($userId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_int($userId) || $userId &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \InvalidArgumentException( <span class="hljs-string"><span class="hljs-string">'UserId should be a positive integer.'</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId = $userId; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userId; } }</code> </pre> <br><p>  Thus, we can always be sure that when working with the <code>UserId</code> object <code>UserId</code> it has the correct state.  This will save us from having to constantly check the data at different levels of the application. </p><br><p>  Note that here we could add a scalar type declaration instead of using <code>is_int</code> , but this will force us to include strong typing wherever <code>UserId</code> used.  If this is not done, PHP will try to cast other types to <code>int</code> whenever they are passed as a <code>UserId</code> .  This can be a problem, since we could, for example, pass a <code>float</code> , which may be an incorrect variable, since user IDs are usually not <code>float</code> .  In other cases, when we could, for example, work with a <code>Price</code> object, disabling strong typing can lead to rounding errors, because PHP automatically converts float variables to <code>int</code> . </p><br><h4 id="neizmenyaemost">  Immutability </h4><br><p>  By default, objects in PHP are passed by reference.  This means that when we make changes to an object, it changes instantly in the entire application. </p><br><p>  Although this approach has its advantages, it also has some drawbacks.  Consider an example of a notification sent to the user via SMS and email: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotificationSenderInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Notification $notification)</span></span></span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SMSNotificationSender</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotificationSenderInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Notification $notification)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cutNotificationLength($notification); <span class="hljs-comment"><span class="hljs-comment">// Send an SMS... } /** * Makes sure the notification does not exceed the length of an SMS. */ private function cutNotificationLength(Notification $notification) { $message = $notification-&gt;getMessage(); $messageString = substr($message-&gt;getValue(), 160); $notification-&gt;setMessage(new Message($messageString)); } } class EmailNotificationSender implements NotificationSenderInterface { public function send(Notification $notification) { // Send an e-mail ... } } $smsNotificationSender = new SMSNotificationSender(); $emailNotificationSender = new EmailNotificationSender(); $notification = new Notification( new UserId(17466), new Subject('Demo notification'), new Message('Very long message ... over 160 characters.') ); $smsNotificationSender-&gt;send($notification); $emailNotificationSender-&gt;send($notification);</span></span></code> </pre> <br><p>  Since the <code>Notification</code> object is passed by reference, there is an unintended side effect.  When reducing the length of a message in <code>SMSNotificationSender</code> associated <code>Notification</code> object was updated throughout the application, so the message was also cut off when it was later sent to <code>EmailNotificationSender</code> . </p><br><p>  To fix this, make the <code>Notification</code> object immutable.  Instead of providing set methods for making changes to it, add with-methods that make a copy of the original <code>Notification</code> before making these changes: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ... )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserId</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withUserId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserId $userId)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Notification</span></span></span><span class="hljs-function"> </span></span>{ $c = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; $c-&gt;userId = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> $userId; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $c; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subject</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withSubject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Subject $subject)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Notification</span></span></span><span class="hljs-function"> </span></span>{ $c = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; $c-&gt;subject = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> $subject; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $c; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Message</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Message $message)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Notification</span></span></span><span class="hljs-function"> </span></span>{ $c = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; $c-&gt;message = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> $message; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $c; } }</code> </pre> <br><p>  Now, when we make changes to the <code>Notification</code> class, for example, by reducing the length of the message, they no longer apply to the entire application, which helps prevent various side effects. </p><br><p>  However, note that in PHP it is very difficult (if not impossible) to make an object truly immutable.  But in order to make our code more error-proof, it will be enough to add ‚Äúimmutable‚Äù with-methods instead of set-methods, since users of a class will no longer need to remember to clone an object before making changes. </p><br><h4 id="vozvraschenie-null-obektov">  Returning null objects </h4><br><p>  Sometimes we come across functions and methods that can return either a value or <code>null</code> .  And these null return values ‚Äã‚Äãcan be a problem, since it will almost always need to check for null values ‚Äã‚Äãbefore we can do something with them.  This is again easy to forget. </p><br><p>  To eliminate the need to test return values, we could return null objects instead.  For example, we may have <code>ShoppingCart</code> with or without a discount: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Discount</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $total)</span></span></span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ShoppingCart</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateTotal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiscount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Discount</span></span></span></span>; }</code> </pre> <br><p>  When calculating the final cost of ShoppingCart, before calling the <code>applyTo</code> method <code>applyTo</code> we now always need to check what the <code>getDiscount(): null</code> function returned <code>getDiscount(): null</code> or a discount: </p><br><pre> <code class="php hljs"> $total = $shoppingCart-&gt;calculateTotal(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($shoppingCart-&gt;getDiscount()) { $total = $shoppingCart-&gt;getDiscount()-&gt;applyTo($total); }</code> </pre> <br><p>  If you do not perform this check, we will get a PHP warning and / or other side effects when <code>getDiscount()</code> returns <code>null</code> . </p><br><p>  On the other hand, these checks can be avoided if we return a null object when the discount is not available: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ShoppingCart</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiscount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Discount</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !is_null(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;discount) ? <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;discount : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoDiscount(); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoDiscount</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Discount</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $total)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $total; } }</code> </pre> <br><p>  Now, when we call <code>getDiscount()</code> , we always get a <code>Discount</code> object, even if there is no discount.  Thus, we can apply a discount to the total amount, even if it is not, and we no longer need the <code>if</code> : </p><br><pre> <code class="php hljs"> $total = $shoppingCart-&gt;calculateTotal(); $totalWithDiscountApplied = $shoppingCart-&gt;getDiscount()-&gt;applyTo($total);</code> </pre> <br><h4 id="opcionalnye-zavisimosti">  Optional dependencies </h4><br><p>  For the same reasons that we want to avoid null return values, we want to get rid of optional dependencies by simply making all dependencies mandatory. </p><br><p>  Take, for example, the following class: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoggerAwareInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLogger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LoggerInterface $logger)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger-&gt;debug(<span class="hljs-string"><span class="hljs-string">'...'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">// do something if ($this-&gt;logger) { $this-&gt;logger-&gt;warning('...'); } // etc... } }</span></span></code> </pre> <br><p>  There are two problems: </p><br><ol><li>  We constantly need to check for the presence of the logger in our <code>doSomething()</code> method. </li><li>  When setting up the SomeService class in our service container, someone may forget to configure the logger, or it may not know at all that the class has the ability to do this. </li></ol><br><p>  We can simplify the code by making the <code>LoggerInterface</code> mandatory dependency: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LoggerInterface $logger)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger-&gt;debug(<span class="hljs-string"><span class="hljs-string">'...'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// do something $this-&gt;logger-&gt;warning('...'); // etc... } }</span></span></code> </pre> <br><p>  Now our public interface has become less cumbersome, and whenever someone creates a new instance of <code>SomeService</code> , he knows that the class requires an instance of the <code>LoggerInterface</code> , and therefore he can‚Äôt forget to specify it. </p><br><p>  In addition, we got rid of the need to constantly check for a logger, which makes <code>doSomething()</code> easier to understand and less susceptible to errors whenever someone makes changes to it. </p><br><p>  If we wanted to use <code>SomeService</code> without a logger, then we could apply the same logic as with returning a null object: </p><br><pre> <code class="php hljs">$service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeService(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NullLogger());</code> </pre> <br><p>  As a result, this approach has the same effect as using the optional <code>setLogger()</code> method, but it simplifies our code and reduces the likelihood of an error in the dependency embedding container. </p><br><h4 id="public-metody">  Public methods </h4><br><p>  To make the code easier to use, it is better to limit the number of public methods in the classes.  Then the code becomes less confusing, and we are less likely to abandon backward compatibility when refactoring. </p><br><p>  The analogy with transactions will help to minimize the number of public methods to a minimum.  Consider, for example, the transfer of money between two bank accounts: </p><br><pre> <code class="php hljs">$account1-&gt;withdraw(<span class="hljs-number"><span class="hljs-number">100</span></span>); $account2-&gt;deposit(<span class="hljs-number"><span class="hljs-number">100</span></span>);</code> </pre> <br><p>  Although a database using a transaction can cancel a withdrawal, if a deposit cannot be done (or vice versa), it cannot prevent us from forgetting to call either <code>$account1-&gt;withdraw()</code> or <code>$account2-&gt;deposit()</code> , which will to incorrect operation. </p><br><p>  Fortunately, we can easily fix this by replacing two separate methods with one transactional: </p><br><pre> <code class="php hljs">$account1-&gt;transfer(<span class="hljs-number"><span class="hljs-number">100</span></span>, $account2);</code> </pre> <br><p>  As a result, our code becomes more reliable, since it will be more difficult to make an error, completing the transaction partially. </p><br><h3 id="primery-obnaruzheniya-oshibok">  Error Detection Examples </h3><br><p>  Error detection mechanisms are not intended to prevent them.  They should only warn us about problems when they are discovered.  Most of the time, they are outside of our application and check the code at regular intervals or after specific changes. </p><br><h4 id="unit-testy">  Unit tests </h4><br><p>  Unit tests can be a great way to make sure new code works correctly.  They also help ensure that the code still works correctly after someone reorganizes part of the system. </p><br><p>  Since someone may forget to conduct unit testing, it is recommended to automatically run tests when making changes using services such as <a href="https://www.sitepoint.com/php-continuous-integration-travis-ci/">Travis CI</a> and <a href="https://about.gitlab.com/">GitLab CI</a> .  Thanks to them, developers receive notifications when something breaks, which also helps to make sure that the changes made work as intended. </p><br><p>  In addition to error detection, unit tests are excellent examples of using specific parts of the code, which in turn prevents errors when someone else uses our code. </p><br><h4 id="otchyoty-o-pokrytii-koda-testami-i-mutacionnoe-testirovanie">  Code Coverage and Mutation Testing Reports </h4><br><p>  Since we can forget to write enough tests, it is useful when testing to automatically generate reports on code coverage by tests using services such as <a href="https://coveralls.io/">Coveralls</a> .  Whenever our code coverage drops, Coveralls sends us a notification, and we can add the missing tests.  Thanks to Coveralls, we can also understand how code coverage changes over time. </p><br><p>  Another way to make sure that we have enough unit tests is to use mutation tests, for example, using <a href="https://www.sitepoint.com/testing-your-tests-who-watches-the-watchmen/">Humbug</a> .  As the name implies, they check whether our code is sufficiently covered with tests, slightly changing the source code and then running unit tests that should generate errors due to the changes made. </p><br><p>  Using code coverage reports and mutation tests, we can make sure that our unit tests are sufficient to prevent errors. </p><br><h4 id="staticheskie-analizatory-koda">  Static code analyzers </h4><br><p>  Code analyzers can detect errors in our application at the beginning of the development process.  For example, IDEs such as <a href="https://www.sitepoint.com/phpstorm-8-released-see-whats-new-grab-free-license/">PhpStorm</a> use code analyzers to warn us about errors and give hints when we write code.  Errors can range from simple syntax to duplicate code. </p><br><p>  In addition to the analyzers built into most IDEs, you can include third-party and even custom analyzers in the build process of our applications to identify specific problems.  A partial list of analyzers suitable for PHP projects can be found on <a href="https://github.com/exakat/php-static-analysis-tools">GitHub</a> . </p><br><p>  There are also online solutions, for example, <a href="https://insight.sensiolabs.com/">SensioLabs Insights</a> . </p><br><h4 id="logirovanie">  Logging </h4><br><p>  Unlike most other error detection mechanisms, logging can help detect errors in an application when it is running in production. </p><br><p>  Of course, this requires that the code write to the log whenever something unexpected happens.  Even when our code supports loggers, you can forget about them when setting up the application.  Therefore, optional dependencies should be avoided (see above). </p><br><p>  Although most applications are at least partially logged, the information that is recorded there becomes really interesting when it is analyzed and monitored using tools such as <a href="https://www.elastic.co/products/kibana">Kibana</a> or <a href="https://www.nagios.com/solutions/log-monitoring/">Nagios</a> .  They can give an idea of ‚Äã‚Äãwhat errors and warnings occur in our application when people actively use it, and not when it is being tested. </p><br><h4 id="ne-podavlyat-oshibki">  Do not suppress errors </h4><br><p>  Even when logging errors, it happens that some of them are suppressed.  PHP tends to continue working when a ‚Äúrecoverable‚Äù error occurs.  However, errors can be useful in developing or testing new functions, as they may indicate errors in the code.  This is why most code analyzers warn you when they find that you <a href="https://www.sitepoint.com/why-suppressing-notices-is-wrong/">use @ for error suppression</a> , as this may hide errors that will inevitably appear again as soon as the application is used. </p><br><p>  As a rule, it is better to set the <code>error_reporting PHP  E_ALL</code> level <code>error_reporting PHP  E_ALL</code> in order to receive even the slightest warning message.  However, do not forget to log these messages somewhere and hide them from users so that no confidential information about the architecture of your application or potential vulnerabilities is available to end users. </p><br><p>  In addition to <code>error_reporting</code> , it is important to always include <code>strict_types</code> so that PHP does not automatically attempt to <code>strict_types</code> function arguments to their expected type, as this can lead to difficult-to-find errors (for example, rounding errors when converting <code>float</code> to <code>int</code> ). </p><br><h3 id="ispolzovanie-vne-php">  Use outside PHP </h3><br><p>  Since poka-yoke is more of a concept than a specific technique, it can also be applied in areas not related to PHP. </p><br><h4 id="infrastruktura">  Infrastructure </h4><br><p>  At the infrastructure level, many errors can be prevented by creating a common development environment, identical to the production environment, using tools such as <a href="https://www.sitepoint.com/re-introducing-vagrant-right-way-start-php/">Vagrant</a> . </p><br><p>  Automating the deployment of an application using build servers, such as <a href="https://jenkins.io/">Jenkins</a> and <a href="https://www.gocd.org/">GoCD</a> , can help prevent errors when deploying changes to an application, since this process can involve many steps, some of which can be easily forgotten to be performed. </p><br><h4 id="rest-api">  REST API </h4><br><p>  When creating a <code>REST API</code> you can implement poka-yoke to simplify the use of the API.  For example, we can make sure that we return an error whenever an unknown parameter is passed in the URL or in the body of the request.    ,  , ,   ¬´¬ª  API-, ,  ,      ,   API,   ,         . </p><br><p> ,    API    <code>color</code> ,  -,    API,     <code>colour</code> .  -        ,      . </p><br><p>  ,   API,     ,   <a href="https://www.sitepoint.com/build-apis-wont-hate-review/">Building APIs You Won't Hate</a> . </p><br><h4 id="konfiguraciya-prilozheniya">   </h4><br><p>      -  .           ,   . ,     <code>color</code>  <code>colour</code> ,      ,         . </p><br><p>    ,       .         ‚Äì          ,      . </p><br><h4 id="predotvraschenie-oshibok-polzovatelya">    </h4><br><p>  poka-yoke         . ,      ,  ,        .        . </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  poka-yoke    ,     ,   ,         ,         .            -,       ,   ,      . </p><br><p>  ‚Äì , ,       ,        ,          ,     .        ,   ,         . </p><br><p>      ,     ,  public-       . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/333592/">https://habr.com/ru/post/333592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333582/index.html">Search InterSystems documentation using iKnow and iFind technologies</a></li>
<li><a href="../333584/index.html">A collection of developer tools</a></li>
<li><a href="../333586/index.html">Bot for Telegram for 48 hours on Perl or how to buy cat food without leaving the chat</a></li>
<li><a href="../333588/index.html">Debugging the Android application using a browser</a></li>
<li><a href="../333590/index.html">Configuring the Apache CloudStack Failover Management Server using MariaDB Galera Replication</a></li>
<li><a href="../333594/index.html">The system of rewinding time in the style of Prince of Persia</a></li>
<li><a href="../333596/index.html">I am the cause of the emergence of the Hungarian notation in Android</a></li>
<li><a href="../333598/index.html">Cold calls for web studio. Lead for 159 rubles a reality or fantasy?</a></li>
<li><a href="../333600/index.html">Competitive Intelligence at PHDays: Spying on the Internet of Things</a></li>
<li><a href="../333602/index.html">Time of miracles, or Brakes for the end of the world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>