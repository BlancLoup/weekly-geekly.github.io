<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>REST-API automatic documentation system in Laravel projects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Preamble 


 In order to describe and document client-server rules 
 interactions using Rest-api can be divided into three main methods: 


1. Describ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>REST-API automatic documentation system in Laravel projects</h1><div class="post__text post__text-html js-mediator-article"><h2 id="preambula">  Preamble </h2><br><p>  In order to describe and document client-server rules <br>  interactions using Rest-api can be divided into three main methods: </p><br><ol><li>  <strong>Describe to your colleagues the rules for accessing the server on your fingers</strong> <br>  This method is fast and does not require long-term support, but it is highly likely that you will be beaten for it. <br><img src="https://habrastorage.org/getpro/habr/post_images/6f6/ea4/521/6f6ea4521d7f912680729bce212a21f3.jpg"></li><li>  <strong>Hands to compile Google-docs / Wiki / Readme in the project</strong> <br>  Conveniently, once written documentation does not require a second explanation.  It can be shown to colleagues and even sometimes to the customer.  The disadvantage of this method is the long-term support of such documentation.  When Api in a project grows to such an extent that the very thought "And when did I update the documentation?"  causes a chill on the back, then you realize that this can not continue.  Formally, you can update the documentation very often with small fixes, but this is before the first vacation. </li><li><p>  <strong>Use auto-documenting system</strong> <br>  And so, in order to solve the disadvantages of the first two methods, mankind invented automatic documentation systems.  The basic idea is that a plugin is docked to the project, which collects information on your code, compiles the documentation itself and wraps it in a readable format.  But most of the solutions for this method are not perfect.  Let's try to make a tool that will help get the documentation of our project with a minimum number of gestures. </p><a name="habracut"></a><br><h2 id="problema">  Problem </h2><br><p>  In order to ensure the self-documenting of the code, annotations are used mainly, that is, commented sections of code that carry certain information.  But this approach also has several serious drawbacks: </p><br><ul><li><p>  <strong>Adding annotations to an already written project.</strong> <br>  Adding annotations for all methods of all controllers of an already implemented project is a rather routine task.  With a large amount of code it is easy to make mistakes even in such a simple task. </p><br></li><li><p>  <strong>Annotation support.</strong> <br>  In fact, annotations do not solve this problem; they only combine it with code support.  So you will inevitably have to monitor the relevance of all comments scattered throughout the project. </p><br></li><li><p>  <strong>Code jamming</strong> <br>  To demonstrate, let's turn to the classic <a href="http://petstore.swagger.io/">example</a> from the Swagger system and see how the <a href="https://github.com/zircote/swagger-php/blob/master/Examples/petstore.swagger.io/controllers/PetController.php">controller</a> works <a href="https://github.com/zircote/swagger-php/blob/master/Examples/petstore.swagger.io/controllers/PetController.php">.</a> </p><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SWG</span></span></span><span class="hljs-comment">\Get( * path="/pet/{petId}", * summary="Find pet by ID", * description="Returns a single pet", * operationId="getPetById", * tags={"pet"}, * consumes={ * "application/xml", * "application/json", * "application/x-www-form-urlencoded" * }, * produces={"application/xml", "application/json"}, * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SWG</span></span></span><span class="hljs-comment">\Parameter( * description="ID of pet to return", * in="path", * name="petId", * required=true, * type="integer", * format="int64" * ), * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SWG</span></span></span><span class="hljs-comment">\Response( * response=200, * description="successful operation", * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SWG</span></span></span><span class="hljs-comment">\Schema(ref="#/definitions/Pet") * ), * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SWG</span></span></span><span class="hljs-comment">\Response( * response="400", * description="Invalid ID supplied" * ), * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SWG</span></span></span><span class="hljs-comment">\Response( * response="404", * description="Pet not found" * ), * security={ * {"api_key": {}}, * {"petstore_auth": {"write:pets", "read:pets"}} * } * ) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomethingSmart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> failItAllAndReturn500Response(); }</code> </pre> <br><p>  Now imagine that you have 5 methods in your controller, each of which has 10 lines maximum?  The ratio of comments to the code will be depressing. </p><br></li><li>  <strong>Relevance of documentation</strong> <br>  This example demonstrates another flaw - the documentation does not depend on how your code actually works.  Despite the fact that this method will always return a response with the code 500, the documentation will contain answers 200, 400, 404. </li></ul><br></li></ol><br><h2 id="reshenie">  Decision </h2><br><p>  Since we have a fairly good test coverage, the solution suggests itself - the tests still run all the necessary scenarios.  In the process of passing tests, you can collect codes and sample answers, a list of routes, input parameters and validation rules for them.  In other words, most of the documentation.  The rest is just remarks.  In fact, we wrote this tool almost two years ago, but all hands did not reach writing an article about it. </p><br><h2 id="realizaciya">  Implementation </h2><br><p>  The whole principle of action is based on the Middleware pattern, that is, an intermediary.  For each of the routes you can configure your list of resellers.  Each of the requests before getting into the controller will go through a chain of intermediaries, each of whom can do something clever (or not so). </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request, Closure $next)</span></span></span><span class="hljs-function"> </span></span>{ $response = $next($request); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((config(<span class="hljs-string"><span class="hljs-string">'app.env'</span></span>) == <span class="hljs-string"><span class="hljs-string">'testing'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;service-&gt;addData($request, $response); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $response; }</code> </pre> <br><p>  This code shows that the plugin starts collecting information during testing.  The service collects the necessary information from the request and response.  Request returns us URI and heders, as well as the route for which the current action is performed.  The only difficulty is getting validation rules.  In the middleware comes an instance of the class <code>Illuminate\Http\Request</code> , from which it is impossible to obtain data on validation.  Therefore, it is recommended for the validation of "injecting" to the methods of the controller classes of requests. <br>  For example, like this </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MyAwersomeRequest $request)</span></span></span><span class="hljs-function"> </span></span>{ ..... }</code> </pre> <br><p>  Knowing which controller method should be called, we will be able to get access to the request that is injected into it.  Knowing the specific class of the request you can get validation rules.  It seemed to me appropriate in the annotation to the class of the request to place a full and brief description, description of response codes and description of parameters. </p><br><p>  <strong>The whole point of the idea is that annotations should be clarification rather than an obligatory element.</strong> </p><br><h2 id="primenenie">  Application </h2><br><p>  To demonstrate the capabilities of this plugin we will create a test project, the link to which is located at the bottom of the article.  In this article we will consider the step-by-step creation of documentation. <br>  Let's create a test controller. </p><br><p>  <em>/app/Http/Controllers/TestController.php</em> </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $data = [ <span class="hljs-string"><span class="hljs-string">'some'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'complex'</span></span>, <span class="hljs-string"><span class="hljs-string">'structure'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'with'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'multiple'</span></span>, <span class="hljs-string"><span class="hljs-string">'nesting'</span></span> =&gt; [] ] ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response()-&gt;json($data); } ... }</code> </pre> <br><p>  As you can see, this method simply returns a json object.  Next, you need to register the route by which the lists method of our controller will be called. <br>  <em>/routes/api.php</em> </p><br><pre> <code class="php hljs">... Route::get(<span class="hljs-string"><span class="hljs-string">'/test'</span></span>, [<span class="hljs-string"><span class="hljs-string">'uses'</span></span> =&gt; TestController::class . <span class="hljs-string"><span class="hljs-string">'@lists'</span></span>]);</code> </pre> <br><p>  And accordingly apply middleware autodoc-plugin <br>  <em>/app/Http/Kernel.php</em> </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $middlewareGroups = [ <span class="hljs-string"><span class="hljs-string">'api'</span></span> =&gt; [ ... AutoDocMiddleware::class ], ];</code> </pre> <br><p>  To test it, let's create the following test. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;json(<span class="hljs-string"><span class="hljs-string">'get'</span></span>, <span class="hljs-string"><span class="hljs-string">'/api/test'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertResponseOk(); } }</code> </pre> <br><p>  In order to track the last test and the success of the tests created a special <code>AutoDocTestCase</code> .  For the plugin to work correctly, you need to make your TestCase a successor to it or add the following code to your parent TestCase‚Äôs <code>tearDown</code> method: </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tearDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $currentTestCount = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getTestResultObject()-&gt;count(); $allTestCount = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getTestResultObject()-&gt;topTestSuite()-&gt;count(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($currentTestCount == $allTestCount) &amp;&amp; (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasFailed())) { $autoDocService = app(SwaggerService::class); $autoDocService-&gt;saveProductionData(); } <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::tearDown(); }</code> </pre> <br><p>  After running the tests, we can see the collected documentation on the route that was specified for the documentation in the config <code>config/auto-doc.php</code> </p><br><p>  It will look something like this: </p><br><p><img src="https://habrastorage.org/webt/mb/_8/c2/mb_8c2agdpocp5xuoldizrbf9f8.jpeg"></p><br><p>  As we see, there is no complete or brief description, everything is dry - here is the request, here is the method, here is the answer.  Nothing more can be obtained from this code (partly because there is nothing else there).  Now let's create a request through </p><br><pre> <code class="hljs vbscript">php artisan make:<span class="hljs-built_in"><span class="hljs-built_in">request</span></span> TestGetRequest</code> </pre> <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestGetRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Request</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Determine if the user is authorized to make this request. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Get the validation rules that apply to the request. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'not-found'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'boolean'</span></span>, <span class="hljs-string"><span class="hljs-string">'need-authorization'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'boolean'</span></span>, <span class="hljs-string"><span class="hljs-string">'test-parameter'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'integer'</span></span> ]; } }</code> </pre> <br><p>  There are specifically not-found, need-authorization, test-parameter parameters to simulate different answers. <br>  In order for this to work as expected, let's add a couple of checks to our controller's method. </p><br><pre> <code class="hljs php"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TestGetRequest $request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;input(<span class="hljs-string"><span class="hljs-string">'not-found'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response()-&gt;json([ <span class="hljs-string"><span class="hljs-string">'error'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'entity not found'</span></span> ], Response::HTTP_NOT_FOUND); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;input(<span class="hljs-string"><span class="hljs-string">'need-authorization'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response()-&gt;json([ <span class="hljs-string"><span class="hljs-string">'error'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'authorization failed'</span></span> ], Response::HTTP_UNAUTHORIZED); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response()-&gt;json([ <span class="hljs-string"><span class="hljs-string">'some'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'complex'</span></span>, <span class="hljs-string"><span class="hljs-string">'structure'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'with'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'multiple'</span></span>, <span class="hljs-string"><span class="hljs-string">'nesting'</span></span> =&gt; [] ] ]); }</code> </pre> <br><p>  Remaining small things - let's add three more test! </p><br><pre> <code class="hljs php"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetListNotFound</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;json(<span class="hljs-string"><span class="hljs-string">'get'</span></span>, <span class="hljs-string"><span class="hljs-string">'/api/test'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'not-found'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ]); $response-&gt;assertStatus(Response::HTTP_NOT_FOUND); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetListNoAuth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;json(<span class="hljs-string"><span class="hljs-string">'get'</span></span>, <span class="hljs-string"><span class="hljs-string">'/api/test'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'need-authorization'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ]); $response-&gt;assertStatus(Response::HTTP_UNAUTHORIZED); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetListWrongParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;json(<span class="hljs-string"><span class="hljs-string">'get'</span></span>, <span class="hljs-string"><span class="hljs-string">'/api/test'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'test-parameter'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test'</span></span> ]); $response-&gt;assertStatus(Response::HTTP_UNPROCESSABLE_ENTITY); }</code> </pre> <br><p>  After running the tests, we can see more complete documentation. </p><br><p><img src="https://habrastorage.org/webt/xx/tm/la/xxtmlakrnzesxcwiey_h-b7z4do.jpeg"><br><img src="https://habrastorage.org/webt/jb/cb/ol/jbcbolrb3yti8yf8q24wg6f66rg.jpeg"></p><br><p>  But what is missing here?  For example, the lack of a detailed description of our request.  Test get request is a reformatted class name TestGetRequest.  Also, standard descriptions of answers are used here, and sometimes I would like to specify what exactly is meant by a response code and input parameter.  In short, I want <br>  to play <br>  Let's add annotations to the testGetRequest class. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@description</span></span></span><span class="hljs-comment"> * This request designed to demonstrate request with full annotation and response witch contain some data. * It has multi-line description witch will be displayed in Annotation Notes block of documentation. * It has custom summary, response code descriptions and parameters descriptions. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@summary</span></span></span><span class="hljs-comment"> Test Get Request with full annotations * * @_204 This request has successfully done * @_401 You must remove need-authorization flag from input parameters for pass authorization. * @_404 We so sorry but you entity not exists. * @_422 Wrong input parameter. It must be integer * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@need</span></span></span><span class="hljs-comment">-authorization If this parameter is true then you will get 401 response * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@not</span></span></span><span class="hljs-comment">-found If this parameter is true then you will get 404 response * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@test</span></span></span><span class="hljs-comment">-parameter This parameter designed for demonstrate unprocesable entity response */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestGetRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Request</span></span></span><span class="hljs-class"> </span></span>{...}</code> </pre> <br><p>  None of the parameters in the annotation is optional. </p><br><p><img src="https://habrastorage.org/webt/um/5m/et/um5metoxsjbno2tbbzoasurpamq.jpeg"><br><img src="https://habrastorage.org/webt/wb/eg/2z/wbeg2zz4-0cbsogyta25ftk-hyu.jpeg"><br><img src="https://habrastorage.org/webt/xh/l_/_w/xhl__woyin5qazstzaroqqpeupw.jpeg"></p><br><p>  It is also possible to set a standard description of the response code at the application level.  This is done in the file <em>config / auto-doc.php</em> .  The priority of the descriptions is as follows: </p><br><ul><li>  description of the response code in the annotation </li><li>  config value </li><li>  standard response code description </li></ul><br><p>  Also in this config is all you need to configure the project description in the documentation. <br>  When you execute a command </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">php</span></span> artisan vendor:publish</code> </pre> <br><p>  The folder <code>swagger-description.blade.php</code> is placed in the <code>resources/views</code> folder.  For example, if you add the following code there </p><br><pre> <code class="html hljs xml">This project designed to demonstrate working of <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>ronasit/laravel-swagger<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> plugin. Here is project description from <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>swagger-description.blade.php<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"swagger-ui"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"opblock-body"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span> You can add some code here <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> Or some image <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: flex; justify-content: center; width: 100%"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/img/hqdefault.jpg"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><p>  In the end, the project description in the documentation will look like this: </p><br><p><img src="https://habrastorage.org/webt/7a/gq/_o/7agq_onxiyqljofdxvrpcm1-ifa.jpeg"></p><br><h2 id="itog">  Total </h2><br><p>  The main goal of this plugin is the possibility of its integration with the minimum number of gestures and the possibility of further concretization of bottlenecks.  All you need in order to have documentation in your project when using this plugin is to carefully write tests for each documented case, and also to store validations not in the controller method, but in the requester class.  In other words, compliance with the rules is required, which in any case is useful to follow. </p><br><h2 id="ssylki">  Links </h2><br><p>  <a href="https://github.com/RonasIT/laravel-swagger">The repository of this plugin is here</a> </p><br><p>  <a href="https://github.com/Asxer/auto-doc-example">Demonstration project here</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/358528/">https://habr.com/ru/post/358528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358518/index.html">VimpelCom subscribers will pay 13 rubles per month for the Spring Law</a></li>
<li><a href="../358520/index.html">Java and Linux - features of operation</a></li>
<li><a href="../358522/index.html">Go: we accelerate sampling of large tables from MySQL</a></li>
<li><a href="../358524/index.html">We will again be counted: National biometric platform and ‚Äúpass-through identifier‚Äù</a></li>
<li><a href="../358526/index.html">Number all real numbers on the interval [0,1]</a></li>
<li><a href="../358530/index.html">Introduction to Data Engineering. ETL, star schema and airflow</a></li>
<li><a href="../358532/index.html">Open webinar: ‚ÄúTranslation difficulties: 2 and 3 versions‚Äù</a></li>
<li><a href="../358536/index.html">The Telegram v. Russia case will be considered by the European Court of Human Rights. Also sent a complaint to the Moscow City Court</a></li>
<li><a href="../358538/index.html">New orienteering: how to determine your location</a></li>
<li><a href="../358540/index.html">First Atlassian User Group in Minsk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>