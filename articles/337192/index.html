<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience of raising IP telephony in the hotel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings. This text tells how the telephony rose in the hotel, which was planned to open on April 1st. No matter how funny it was, but it did not wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience of raising IP telephony in the hotel</h1><div class="post__text post__text-html js-mediator-article">  Greetings.  This text tells how the telephony rose in the hotel, which was planned to open on April 1st.  No matter how funny it was, but it did not work out and the opening date was postponed.  As a result, the hotel is launched, all necessary communications are carried out and configured.  I will tell only about telephony and what it concerned. <br><br>  As always, people do not have huge budgets, so there was no question of putting something cosmic or something proprietary there.  Especially since during the discussion of this project, the broadcast was filled with information that one of the leading manufacturers was declared bankrupt and was looking for a patron.  Therefore, I did not want to contact him at all. <br><br><img src="https://habrastorage.org/web/77a/1c9/87d/77a1c987d5dd4db7b1552e59807e2bcd.jpg"><br><a name="habracut"></a><br><h3>  About the hotel itself </h3><br>  It is small, with 30 rooms with a bar, a restaurant and small things.  In each number, of course, you need a phone.  That is, as such, the accounts required 40, taking into account the administrative staff and owner.  premises. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All this on one floor.  Since I was there at the stage of building walls, like other specialists (one networker, lol), then all the necessary wires and switching were thought out beforehand and laid.  As a result, each number includes a twisted pair from switches, divorced, including vlans, so that wi-fi, telephony, internal hotel services do not overlap. <br><br><h3>  Equipment </h3><br>  It was decided to abandon analog phones at the discussion stage. <br><br>  I will tell you about the course of thought on the organization of the telephony itself.  There was an option to put a normal virtualization server there and drive an asterisk there.  But immediately there was a question of selecting a piece of iron for analog lines from a city operator (where to go without them), a GSM gateway and SIP itself.  Regardless of the choice of platform, for me it was highly desirable that she had an Asterisk inside. <br><br>  Evaluating the list of ready-made solutions out of the box and talking to a large number of managers from integrators and importers of various PBX systems - the decision management again won out. <br>  For a very tasty price for them, the ZyCoo U50 was offered and purchased with two expansion cards.  4FXO module for connecting to analog city lines and 2GSM module for GSM gateway. <br><br>  Before you buy, the youngest model from ZyCoo was taken to the test, this is the CoVoox U20. <br>  2FXS / FXO port, console port, LAN, WAN and RP-SMA for connecting a GSM antenna.  SIM card is installed there inconvenient and only one.  It is necessary to unwind the case, remove the GSM module and only then it is possible to crawl to the tray. <br><br>  The restrictions on the PBX are such that it can have up to 30 accounts.  No matter what.  But in terms of size and capabilities - a great "portable" PBX, for the size of a home router.  The interface completely repeats its senior counterparts in the lineup. <br><br><div class="spoiler">  <b class="spoiler_title">Photo inside</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/672/c89/3d2/672c893d27a24370b4c64fe72f787c38.jpg"><br><br><img src="https://habrastorage.org/web/6a4/8ae/a7b/6a48aea7b1ba4bbe8f982568fbc46247.jpg"><br><br><img src="https://habrastorage.org/web/3c0/578/b28/3c0578b2848d4c89b14f9a6914ff6284.jpg"><br><br><img src="https://habrastorage.org/web/334/a1d/666/334a1d66680841a3a7ccbcd79f8fc275.jpg"><br><br><img src="https://habrastorage.org/web/dc0/049/a13/dc0049a13b29442d834a283a24fb44ad.jpg"><br><br><img src="https://habrastorage.org/web/399/6e3/368/3996e3368be244c3bf6d0c0774b2593a.jpg"><br><br><img src="https://habrastorage.org/web/bed/013/4cb/bed0134cb8c24003ba4c4c34ca89a0cc.jpg"><br></div></div><br>  Dialplans, IVR, schedule were established on the same ‚Äúhare‚Äù. <br><br>  Setting up these on this PBX is not something surprising.  It is intuitive for any person who has set up FreePBX at least once. <br><br>  And for those who did not set up - there is documentation on the U50.  It would be very strange and disrespectful towards customers not to have it. <br><br>  The only thing that I didn‚Äôt want to do at this PBX was autobusiness with a ball for phone books, updates.  But more about this later in the text. <br><br>  For reservation was purchased another similar PBX. <br><br>  As phones - AKUVOX SP-R50P went to the numbers.  Selected from the price / quality ratio.  Of all that was available, the Acquacas seemed the most adequate and stitched tightly. <br><br>  At the posts in all sorts of restaurants, bars, and reception - AKUVOX SP-R59P.  For these phones have the largest screen with excellent information.  And he b / w with a few grades of gray.  Another plus of this phone is a panel with a bunch of short dialing buttons for subscribers with BLF support, so that employees can clearly see who of the services is currently busy.  All Akuvox phones described have two Ethernet ports.  The second works either in router mode or in bridge mode.  It was marked in the same vlan as the guest Wi-Fi network. <br><br>  The wire from this port was put on the patch panel in the tables of the rooms.  And if a guest needs a stable wired connection, he can ask at the reception for a patchcord, plug into the phone (to the socket in the table, to be exact) and be king.  At the same time, we do not need additional RJ45 sockets in the wall. <br><br><h3>  About the PBX itself </h3><br>  ZyCoo U50 was a purebred Chinese.  Therefore, the setting was not always perfect.  This is not due to functional problems (in general, they are not), but apparently with the peculiarities of the Chinese mentality.  For example, after pulling out of the box, all interfaces have static IP addresses in the first subnets.  Well at least they did not think for us even further and did not tag the ports.  This will go to negative in the standings.  Nevertheless, it is expected from the piece of iron to get an address via DHCP, from which it is already able to manage the network. <br><br><img src="https://habrastorage.org/web/048/2ee/324/0482ee3246b84c75a50962e6c2548bea.png"><br><br>  To fix it, we naturally need to get IP on the same subnet and reconfigure the ports.  Admin PBX works on a strange number of browsers. <br>  IE / chrome / safari.  My favorite Vivaldi refused to show anything.  Like Opera.  Firefox has not been tested for lack of browser. <br><br>  After logging in, the PBX immediately asks to change the default password to something more serious than the admin \ admin pair.  And the filter is tricky.  Give him at least 8 characters with numbers and letters in different case.  And it will not let.  Meticulous some kind of policy.  But correct.  There is nothing to shine with a naked "body".  Let even in LAN. <br><br>  We are greeted by an ascetic, but generally understandable, interface written by the same Chinese.  Let the Russian language be there, but it wasn‚Äôt even installed by me to check localization. <br><br>  First of all, we step into the network and change the network settings that we need.  The rest of the network settings we do not need.  My mikrotik is engaged in it.  Previously, purchased modules were installed in the piece of iron.  On the monitoring page you can see that they do not work.  For no SIM cards were inserted.  Disassemble the module again ... Two ports transferred to FXS to test analog communication. <br><br>  The antennas came with a standard RP-SMA connector.  But the wires from the complete antennas are a bit short, therefore normal cables were purchased and brought to the roof to connect to the antennas of the building. <br><br>  Screenshots show default configuration. <br><br><img src="https://habrastorage.org/web/121/dc2/e1b/121dc2e1bf92402baa01b66ade4795be.png"><br><br>  The connection of trunks is carried out according to the classics, with the SIP provider MTT connected without problems.  Next went the settings, in fact, extensions, groups, dialplans.  Voice mail did not set up, because it was not required in the TK.  But with IVR ... The customer has so far decided without it.  If the need arises - set up. <br><br>  That is, anyone who has tried to set up FreePBX at least once is familiar with this interface. <br><br>  He is certainly not as elegant as FreePBX, but gives what is required of him.  For the beauty here is clearly not pursuing.  Although, few people will sit 24x7 in the admin panel. <br><br>  Inside, as I said, there is Asterisk and full access via SSH or telnet is provided.  But even here, the Chinese decided to be smart.  The password from the admin does not match the root password of the user in ssh \ telnet.  There it is 8 characters MAC address of the device.  Surprised.  Also, access itself is closed by default.  Sekuro <br><br>  But that we should change it ... In case of problems, it is always more convenient to open ssh and in the maximum debug find out what happens to the PBX and calls.  Or restart any module. <br><br>  Inside installed ARMv7 rev 4, 1 GB of RAM, 6 GB of ROM and also has a slot for an expansion card, which will store voice mail and the like. <br><br>  If the details are interesting, then they are under the spoiler.  Such capacity for 40 (!) Active calls will be enough with the head. <br><br><div class="spoiler">  <b class="spoiler_title">Insides</b> <div class="spoiler_text"><code>root@coovox-u50v2:/# asterisk -V <br> Asterisk 13.2.0 <br> <br> root@coovox-u50v2:/# uname -a <br> Linux coovox-u50v2 3.4.103+ #43 SMP PREEMPT Mon Aug 10 21:47:43 EDT 2015 armv7l GNU/Linux <br> <br> root@coovox-u50v2:/# free -h <br> total used free shared buffers cached <br> Mem: 987M 99M 888M 0B 1.3M 31M <br> -/+ buffers/cache: 66M 921M <br> Swap: 0B 0B 0B <br> <br> root@coovox-u50v2:/# cat /proc/cpuinfo <br> Processor : ARMv7 Processor rev 4 (v7l) <br> processor : 0 <br> BogoMIPS : 2011.05 <br> <br> processor : 1 <br> BogoMIPS : 2011.05 <br> <br> Features : swp half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt <br> CPU implementer : 0x41 <br> CPU architecture: 7 <br> CPU variant : 0x0 <br> CPU part : 0xc07 <br> CPU revision : 4 <br> <br> Hardware : sun7i <br> Revision : 0000 <br> Serial : 0000000000000000 <br> root@coovox-u50v2:/# df -h <br> Filesystem Size Used Avail Use% Mounted on <br> rootfs 5.3G 1.4G 3.7G 28% / <br> /dev/root 5.3G 1.4G 3.7G 28% / <br> devtmpfs 494M 0 494M 0% /dev <br> tmpfs 99M 576K 99M 1% /run <br> tmpfs 5.0M 0 5.0M 0% /run/lock <br> tmpfs 198M 0 198M 0% /run/shm <br></code> <br></div></div><br>  As a result, we needed from this PBX: <br><br>  Dialplans, routes, RingAll groups, call recording, schedule, conferences.  Redundancy does not work according to the Master \ Slave or Active \ Active scheme, and in the old manner by exporting the configuration.  When all the settings were made on the PBX, its configuration was carefully placed where it will wait in the wings.  If that comes. <br><br>  <b>Why I did not use AutoP embedded in PBX</b> <br><br><img src="https://habrastorage.org/web/8af/789/edb/8af789edbd96434887051c22a82de509.png"><br><br>  He is here, but to manage it is not always convenient.  Moreover, for the same updates, you still need to raise the ftp \ http \ tftp ball.  Since, to change the configuration, you need to go into the admin area and change files. <br><br>  For these purposes, my colleague, I was allocated a part of the typewriter resource for debian, on which I deployed a tftp ball for these tasks. <br><br>  To be very precise, this is tftpd-hpa.  For by itself tftp is a priori not something complicated.  Therefore, the final configuration file that needed to be edited contains four lines.  Read more in the tftpd-hpa documentation. <br><br>  Returning to the question why I didn‚Äôt use the functionality built into the PBX, I‚Äôll answer: I want to manage all this in a more civilized way, through the file manager, and not to climb into the PBX admin panel every time. <br><br>  66 option with the address of this server was added to the DHCP server and that is enough. <br><br><h3>  Then everything that concerns only phones </h3><br>  In Akuvox phones, I repeat, there is also AutoP.  But what exactly is the syntax from the template is not completely clear.  Therefore, first of all, we configure one of the phones through the web-interface and then download its configuration. <br><br>  For phones there are two configuration files.  Individual and group.  In the group settings are specified for all phones of the same model.  There were listed catalogs with updates, notebooks, music. <br><br><img src="https://habrastorage.org/web/b45/3a1/bcb/b453a1bcb7db40b1acdf925c31b164c1.png"><br><br>  As a result, we see quite familiar syntax: <br><br>  Option = value <br>  Individual configs are named by the MAC address of each phone and store the individual settings of each phone. <br>  There just were hidden account data. <br><br>  In general, the differences between different models of Akuvox IP phones only in the number of accounts, screen sizes, the number of additional buttons.  Well and still, it is impossible to connect modules of expansion of the keyboard to younger models.  As for the controls, all Akuvox phones have the same interfaces (web and through the screen).  Therefore, they sign rather quickly and without problems. <br><br><div class="spoiler">  <b class="spoiler_title">One more photo</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/4e0/b4c/4d1/4e0b4c4d1afb4e2ea6941f27aecc9546.jpg"><br><br><img src="https://habrastorage.org/web/498/fbc/1c9/498fbc1c955c43c9a85880c56ce3c016.jpg"><br><br><img src="https://habrastorage.org/web/f0b/0bd/4b1/f0b0bd4b1aae4ea2bb2faad5020891a3.jpg"><br></div></div><br>  <b>Firmware:</b> <br><br>  You rarely remember them, but when you recall, it is better that the firmware update itself.  This is especially true when you have not 4 phones, but more than 40. To solve this problem, the paths and file names were written in common configs for different models.  If it is necessary to replace the name of the firmware file, we need to change only two values ‚Äã‚Äãin the general configuration.  In them we write the address of the firmware and the new file name. <br><br>  <b>Phone book:</b> <br><br>  Supported "tsiskovskie" books, which I was somewhat surprised and delighted.  For the sake of experiment I decided to slip them there.  Still left with old projects. <br><br>  But as a result I decided not to mix the donkey with the beaver and did as requested by the manufacturer.  From one phone I filled out a couple of numbers with a certain number of records and imported.  By analogy, changed and made edits there.  The phones themselves support up to 5 deleted books. <br><br><img src="https://habrastorage.org/web/3ed/49e/b9d/3ed49eb9dc7140f1bb3a0043ef84ab08.png"><br><br>  Worst of all, it turned out with phones for reception, bars and administrative.  The hotel management had to try for a long time exactly what settings to put on shortcut phones, BLF. <br><br>  For the reception Akuvokovsky was also purchased the EM53 keyboard expansion module and was included in the three-page scrolling list of subscribers.  As a result, the operator at the reception received all the available numbers on the shortcuts, moreover, with the indication BLF.  What is characteristic of the module, on the last pages there are still quite a few unoccupied buttons for future modifications and configurations. <br><br>  I'll tell you a little more about this EM53.  Included with the module is a bracket, which you can screw the module to the phone, as well as the desired wire with bolts.  He has enough power from the phone and the whole structure looks complete.  All add.  The buttons have a three-color backlight.  Like the right panel on the phone, and each button on the module.  BLF for each room is also instituted.  Well, why not. <br><br><div class="spoiler">  <b class="spoiler_title">Again, the photo under the spoiler</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/11a/774/3a2/11a7743a298a4a70a291db62bac0a366.jpg"><br><br><img src="https://habrastorage.org/web/15d/662/293/15d6622932db4d55862d1a515f389fe4.jpg"><br><br><img src="https://habrastorage.org/web/91a/337/8d3/91a3378d330946feb3953401dcd1ca57.jpg"><br><br><img src="https://habrastorage.org/web/b64/9cb/542/b649cb542fbf4c94b64998dfc3039050.jpg"><br><br><img src="https://habrastorage.org/web/340/7aa/014/3407aa014c624c44b853840c53b8029b.jpg"><br><br><img src="https://habrastorage.org/web/d74/d43/9f2/d74d439f283148d7b1135d80bf004280.jpg"><br><br></div></div><br><h2>  Total </h2><br>  The task was completed without much mental and physical strain on my part.  The networker nevertheless needed to invest some of his efforts, but rather not on the broach, but on the crimping of cables. <br><br>  The internal services of the hotel were already configured by other people with whom I did not intersect.  But there were no problems there either. <br><br>  As a result, there is a ready network with the necessary service infrastructure, telephony, fire alarm and video surveillance.  Video surveillance, by the way, was launched on separate cables, which I consider to be a very competent decision.  Who would not say all-in-one about unified communications, but video surveillance and office traffic, including VoIP, should be physically routed so as not to make noise on the work network. <br><br>  The Chinese PBX pleased the customer with the price tag, but sometimes I was upset because of the strange default settings.  It is also not entirely clear how to perceive the cruel rules on the password account.  For we are not asked if we want to change it.  We are faced with the fact.  Perhaps this is for the better, but this attitude does not satisfy me.  All that is required of the PBX - it proddubivaet. <br><br>  Akuvox phones are a confident four, maybe even with a plus.  In general, the sensations from them are no worse than from tsiska.  Of course, there is little that can be said about modern SIP phones.  In terms of functionality, they are all about the same "from the face."  Yes, and the back side is the same.  Differences only in the design and number of SIP accounts.  The flexibility of settings for Akuvox is, fashionable HD voice is also available.  The sound of the tube and the speakerphone was objectively very pleased.  Materials are comfortable, the tube is not felt at the ear.  Keys with a great, slightly tight move.  Everything is programmed and quite informatively shines with its light bulbs. <br><br>  The customer is satisfied, and I have not been called on this project anymore.  So everything works and you can sleep peacefully. </div><p>Source: <a href="https://habr.com/ru/post/337192/">https://habr.com/ru/post/337192/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337182/index.html">Greetings to Yandex developers</a></li>
<li><a href="../337184/index.html">Current data on the telephone codes of Russian cities</a></li>
<li><a href="../337186/index.html">Epidemic of the Petya blackmailer virus: what you need to know</a></li>
<li><a href="../337188/index.html">7 rules of good tone when writing Unit tests</a></li>
<li><a href="../337190/index.html">CaptureManager SDK</a></li>
<li><a href="../337194/index.html">Climbing an Unbowed Mountain: The Difficulties of Creating a Game Alone</a></li>
<li><a href="../337196/index.html">Another git tutorial</a></li>
<li><a href="../337200/index.html">Step by Step Plan for Upwork # 2</a></li>
<li><a href="../337202/index.html">The ideal OS: rethinking the operating systems for the desktop</a></li>
<li><a href="../337204/index.html">35 Gbps - as Megafon and Huawei set a 5G speed record</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>