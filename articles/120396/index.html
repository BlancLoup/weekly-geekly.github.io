<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C / C ++. Command line parsing method</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, at work, I faced the task of writing a program in the C ++ Builder environment, and there was a moment in it when I needed to parse t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C / C ++. Command line parsing method</h1><div class="post__text post__text-html js-mediator-article"> Not so long ago, at work, I faced the task of writing a program in the C ++ Builder environment, and there was a moment in it when I needed to parse the command line.  The task also included the magic ‚Äúyou can use all the sources that are there.  They lie here: ... ".  The first thing I did, of course, was to the address ... and I found there a terribly branching code structure in which I tried to figure it out and decided that it was hell to customize it for myself.  Therefore, it occurred to me to write something like Qt-shnoy system of signals and slots, only for C ++ Builder and command line arguments. <br>  So, let's begin.  The idea is as follows: analysis of the command line is reduced to checking whether there is a special character in the argument (in my case, this ‚Äú-‚Äù - was to take the Linux standard).  Depending on this, the argument is read as the parameter name or its value.  To call processing functions, an associative array is used, i.e.  an array in which the keys are the names of the available parameters, and the values ‚Äã‚Äãare the addresses of the processing functions of a particular parameter.  Here, in general, and all.  Getting to the implementation? <a name="habracut"></a><br><br>  Forward.  Let's start with the study of devices.  To handle associative arrays in C ++ Builder, the map type is used (declared in map.h) <br><br> <code>#include &lt;map.h&gt;</code> <br> <br>  Further on help.  Declare your type: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>typedef map &lt;AnsiString, int*&gt; TFuncTable;</code> <br> <br>  and in the class instance type: <br><br> <code>TFuncTable funcTable;</code> <br> <br>  Here, AnsiString is used as the key (forgive me std :: string), and the values ‚Äã‚Äãare int * (by the way, it may not work for 64-bit systems).  Now, let's see how to insert into this hash.  It turned out that it was not so easy and it had to kill 2 hours. And this is done like this: <br><br> <code>int *addr = (int*)&amp;myFunction; <br> funcTable.insert(TFuncTable::value_type(AnsiString("-myParam"), addr)); <br></code> <br>  It is worth paying attention to TFuncTable :: value_type () - why do this, I honestly did not understand, but apparently this is some kind of type fitting, without which the program does not even compile. <br>  So, initialized the array - great.  What will it look like?  Yes, something like this: <br><br> <code>funcTable[‚Äú-myParam‚Äù] == 0xABCDEF // - </code> <br> <br>  Slowly but surely, we approach the use of this whole economy.  Immediately it is worth mentioning one minus of such an algorithm: processing functions must be of the same type, that is, we declare a functional type: <br><br> <code>typedef void (*TFunc)(AnsiString param); <br></code> <br>  and stick to it in writing your handlers.  An example of such a handler: <br><br> <code>void myFunction(AnsiString name) <br> { <br> MainForm-&gt;setTestName(name); <br> } <br></code> <br>  But this is a simple handler.  It will be more difficult, perhaps, when something like comes in as a parameter: <br><br> <code>"param1,param2,param3"</code> <br> <br>  For a real example, you can look at the / etc / fstab file - Linux. <br>  Well, it's time to tell how to start the function from the hash by the parameter name.  Yes, but before that, I think it is worth collecting the entire initialization procedure in a heap: <br><ol><li>  Enable map </li><li>  Declared a type hash, declared an instance of this type. </li><li>  Declared a functional type and wrote function-parameter handlers, adhering to this type. </li><li>  Fill the hash. </li></ol><br>  Now you can proceed to the processing function of the command line itself.  Here is the algorithm for calculating whether the argument is a parameter name or its value: <br><br> <code>bool TMainForm::parseParams() <br> { <br> int argc; <br> TFunc srvFunc; <br> LPWSTR *cmdLine = CommandLineToArgvW(GetCommandLineW(), &amp;argc); <br> int iter = 1; <br> <br> for(int i = 1; i &lt; argc; i += iter) <br> { <br> AnsiString param = ""; <br> AnsiString paramName = cmdLine[i]; <br> if(i &lt; argc - 1) <br> { <br> if(AnsiString(cmdLine[i + 1])[1] == '-') <br> iter = 1; <br> else <br> { <br> param = cmdLine[i + 1]; <br> iter = 2; <br> } <br> } <br> <br> if(funcTable.find(paramName) == funcTable.end()) <br> { <br> Out("  " + paramName); <br> return false; <br> } <br> srvFunc = (TFunc)funcTable[paramName]; <br> srvFunc(param); <br> } <br> return true; <br> } <br></code> <br><br>  What is what: <br>  LPWSTR * cmdLine = CommandLineToArgvW (GetCommandLineW (), &amp; argc);  - with this in the Borlandovsky certificate, too, everything is rather dull, but it all boils down to the fact that such a sequence of transformations produces standard argc and argv, so we go further. <br>  Out () is a specialized input / output function.  For a given topic does not represent any interest. <br>  I don‚Äôt need to tell the procedure for searching for the ‚Äú-‚Äù character in the string argument - it‚Äôs banal.  The most interesting here: <br><br> <code>srvFunc = (TFunc)funcTable[paramName]; <br> srvFunc(param); <br></code> <br>  This is how the handler function starts.  Simple, isn't it?  And no wild branching up to the 1000th knee. <br><br>  So what do we have?  I work in the state.  office, and that's why linger there not going.  That is, the worker who came after me will easily write his handlers, will drive addresses into the hash, and he will not have to think about the command line analyzer.  Here is the arithmetic. </div><p>Source: <a href="https://habr.com/ru/post/120396/">https://habr.com/ru/post/120396/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120389/index.html">The hard life of anti-spam or as it actually happens</a></li>
<li><a href="../120391/index.html">iPADrom - S03E05. IPad software review</a></li>
<li><a href="../120393/index.html">10 gigabit link at home?</a></li>
<li><a href="../120394/index.html">About certification: catch up to the global price increase</a></li>
<li><a href="../120395/index.html">Yandex.Money now allows you to delete the old account and create a new</a></li>
<li><a href="../120401/index.html">Creating your own sophisticated styles for LaTeX</a></li>
<li><a href="../120402/index.html">Some features of the implementation of background applications for iOS 4</a></li>
<li><a href="../120404/index.html">Subjective view of DevCon'11 or will HTML5 conquer Russia in the near future</a></li>
<li><a href="../120405/index.html">API: added new and deleted old</a></li>
<li><a href="../120406/index.html">Client for Habrahabr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>