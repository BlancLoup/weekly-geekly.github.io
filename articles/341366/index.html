<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of multi-boot files with progress indicators on ASP.NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, Mark Sullivan tells how using ASP.NET and the Uploadify libraries to implement multi-loading of files with dynamic progress indicator...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of multi-boot files with progress indicators on ASP.NET</h1><div class="post__text post__text-html js-mediator-article">  In this article, Mark Sullivan tells how using ASP.NET and the Uploadify libraries to implement multi-loading of files with dynamic progress indicators.  The Http-processor class created in the process, along with the control class, is suitable for any other ASP.NET application, which makes this code, on the one hand, a useful plug-in-play solution, and on the other, a visual demonstration of working with Http -handler.  He also added a number of additional features to the ASP.NET layer, such as filtering by file extension, postback on completion, and session-based security. <br><br><img src="https://habrastorage.org/webt/59/e8/79/59e87976a1ebc481309545.jpeg"><br><a name="habracut"></a><br><h3>  general information </h3><br>  With the release of HTML5, there was hope for the possibility of implementing the simultaneous loading of several files without using ActiveX or other plug-ins.  But pure HTML5 does not support dynamic indicators during loading, besides it is processed differently in some browsers.  I also needed a secure solution that allows you to implement filtering by file extension. <br><br>  I discovered Uploadify when I was looking for a replacement for the previous solution.  This library was originally written as a free Flash plugin, but in 2012, a solution for HTML5 was also presented.  The cost of the HTML5 library varies from $ 5 to $ 100 depending on whether you are going to distribute it.  In my opinion, this is a low price for such a high-quality product, but, of course, you decide.  In any case, I also made an implementation of the Flash version, if it suddenly comes in handy for someone.  Perhaps I myself will be able to apply it to support some of my projects in older browsers.  Unfortunately, I have not yet met on the Internet any illustrative examples of the implementation of this solution on ASP.NET. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/yl/ak/nd/ylakndp0hy2u7xfp7omqu_vpsdo.png"><br><br>  I wrapped the options in a C # web control and C # class (for writing directly to the output stream without controls).  Classes handle most of the options handled by the library.  I also added JavaScript support to filter downloads from the server and client.  With regard to security and filtering on the server side, their implementation requires a session state.  However, they help prevent unwanted downloads.  Other options needed for the project have also been added to C # classes or controls. <br><br><h3>  Code usage </h3><br>  <b>Introductory notes</b> <br><br>  Before using the provided code, you should choose between a free Flash library and a paid HTML5 library.  All the contents of the first must be placed in the empty subfolder Uploadify, and the second in UploadiFive.  The Flash version is used in the third demo (Demo3.aspx), and the HTML5 version is used in the first two. <br><br>  Alternatively, you can wrap the classes around the HTML5 multiload file field. <br><br>  <b>Connecting libraries</b> <br><br>  You need to add links to the jQuery library and the selected Uploadify library.  The standard CSS file comes with packages, so I added a link to it in my code.  Add the following lines inside the head tag of your ASPX form. <br><br><pre><code class="javascript hljs">&lt;script src=<span class="hljs-string"><span class="hljs-string">"jquery/jquery-1.10.2.js"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script src=<span class="hljs-string"><span class="hljs-string">"uploadifive/jquery.uploadifive.js"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/css"</span></span> href=<span class="hljs-string"><span class="hljs-string">"uploadifive/uploadifive.css"</span></span> /&gt;</code> </pre> <br>  or so: <br><br><pre> <code class="javascript hljs">&lt;script src=<span class="hljs-string"><span class="hljs-string">"jquery/jquery-1.10.2.js"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script src=<span class="hljs-string"><span class="hljs-string">"uploadify/jquery.uploadify.js"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/css"</span></span> href=<span class="hljs-string"><span class="hljs-string">"uploadify/uploadify.css"</span></span> /&gt;</code> </pre> <br><br>  Adding to the page control <br><br>  In ASP.NET web forms, you can add a control to a page by creating an instance of the UploadiFiveControl class code and adding it to the form or placeholder. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Get the save path string savepath = Context.Server.MapPath("files"); // Create the upload control and add to the form UploadiFiveControl uploadControl = new UploadiFiveControl { UploadPath = savepath, RemoveCompleted = true, SubmitWhenQueueCompletes = true, AllowedFileExtensions = ".jpg|.bmp" }; form1.Controls.Add(uploadControl);</span></span></code> </pre> <br>  Adding a control to MVC is similar. <br><br>  Working with the Flash version is quite simple, since it uses the same classes and control, but the version flag is set to Flash, not to default.  The remaining changes, including the names of some options, are processed by the control. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Create the upload control and add to the form UploadiFiveControl uploadControl = new UploadiFiveControl { UploadPath = savepath, RemoveCompleted = true, SubmitWhenQueueCompletes = true, AllowedFileExtensions = ".jpg|.bmp", Version = UploadiFive_Version_Enum.Flash }; form1.Controls.Add(uploadControl);</span></span></code> </pre> <br>  <b>Http handler for downloaded files</b> <br><br>  You also need to add the UploadiFiveFileHandler Http handler class to the project, which processes the files as they are uploaded to the server.  This part of the implementation is the least described anywhere in reference books or blogs, and that is why I devoted the entire next section to it.  To enable this class, copy the UploadiFiveFileHandler.ashx and UploadiFiveFileHandler.ashx.cs files into your project. <br><br>  <b>Http Handler and Security</b> <br><br>  Creating an Http handler is quite simple, but it is much more difficult to ensure its flexibility and to introduce some additional functions.  I used session state to secure and transfer information from the loading page to the handler.  For this, I created the class UploadiFive_Security_Token.  Here‚Äôs what his ad looks like: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; Token used to add security, via adding a key to the session /// state, for uploading documents through this system &lt;/summary&gt; public class UploadiFive_Security_Token { /// &lt;summary&gt; Path where the uploaded files should go &lt;/summary&gt; public readonly string UploadPath; /// &lt;summary&gt; List of file extensions allowed &lt;/summary&gt; public readonly string AllowedFileExtensions; /// &lt;summary&gt; Name of the file object to use in your server-side script&lt;/summary&gt; public readonly string FileObjName; /// &lt;summary&gt; The GUID for this security token &lt;/summary&gt; public readonly Guid ThisGuid; /// &lt;summary&gt; Constructor for a new instance of the UploadiFive_Security_Token class &lt;/summary&gt; /// &lt;param name="UploadPath" /&gt; Path where the uploaded files should go /// &lt;param name="AllowedFileExtensions" /&gt; List of file extensions allowed /// &lt;param name="FileObjName" /&gt; Name of file object to use in your server-side script public UploadiFive_Security_Token(string UploadPath, string AllowedFileExtensions, string FileObjName ) { this.UploadPath = UploadPath; this.AllowedFileExtensions = AllowedFileExtensions; this.FileObjName = FileObjName; ThisGuid = Guid.NewGuid(); } }</span></span></code> </pre> <br>  This class contains the path to the file, the valid file extensions and the key by which the handler will find the file.  When rendering the UploadiFiveControl class, a new security token is created, which is stored in session state under the GUID.  The GUID itself is added to the FormData dictionary, then transferred to the Uploadify library, and then returned to the processor with the file data.  After that, the handler can find a security token in the session based on the corresponding GUID. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Create a new security token with all the configuration info UploadiFive_Security_Token newToken = new UploadiFive_Security_Token(UploadPath, AllowedFileExtensions, FileObjName); // Add this token to the current session for the HttpHandler HttpContext.Current.Session["#UPLOADIFIVE::" + newToken.ThisGuid.ToString()] = newToken; // Save the token into the formdata so comes to the HttpHandler FormData["token"] = newToken.ThisGuid.ToString();</span></span></code> </pre> <br>  Form data is included in the JavaScript code for creating the Uploadify control.  The following is an example of the resulting HTML code without any restrictions on the file extension: <br><br><pre> <code class="javascript hljs">&lt;input id=<span class="hljs-string"><span class="hljs-string">"file_upload"</span></span> name=<span class="hljs-string"><span class="hljs-string">"file_upload"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"file_upload"</span></span> type=<span class="hljs-string"><span class="hljs-string">"file"</span></span> /&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> $(</span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">).ready(</span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"></span><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span></span><span class="xml"><span class="javascript">{ $(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'#file_upload'</span></span></span></span><span class="xml"><span class="javascript">).uploadifive({ </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'fileObjName'</span></span></span></span><span class="xml"><span class="javascript">: </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'Filedata'</span></span></span></span><span class="xml"><span class="javascript">, </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'formData'</span></span></span></span><span class="xml"><span class="javascript">: { </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'token'</span></span></span></span><span class="xml"><span class="javascript"> : </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'da66e0ad-750b-4d76-a016-72633dea8b53'</span></span></span></span><span class="xml"><span class="javascript"> }, </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'onQueueComplete'</span></span></span></span><span class="xml"><span class="javascript">: </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function"> (</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">uploads</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">) </span></span></span></span><span class="xml"><span class="javascript">{ $(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'#file_upload'</span></span></span></span><span class="xml"><span class="javascript">).closest(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"form"</span></span></span></span><span class="xml"><span class="javascript">).submit(); }, </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'uploadScript'</span></span></span></span><span class="xml"><span class="javascript">: </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'UploadiFiveFileHandler.ashx'</span></span></span></span><span class="xml"><span class="javascript"> }); }); </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  As seen above, the generated security token GUID is included in the JavaScript code to initialize the library. <br><br>  The Http handler needs access to the session state, so it needs to implement the IReadOnlySessionState interface.  Here is the full code of the ProcessRequest handler method without any restrictions on the file extension: <br><br><pre> <code class="javascript hljs">Context.Response.ContentType = <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>; Context.Response.Expires = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Try to get the security token key string tokenKey = Context.Request["token"]; if (tokenKey == null) { Context.Response.Write("No token provided with this request"); Context.Response.StatusCode = 401; return; } // Try to get the matching token object from the session UploadiFive_Security_Token tokenObj = Context.Session["#UPLOADIFIVE::" + tokenKey] as UploadiFive_Security_Token; if (tokenObj == null) { Context.Response.Write("No matching server-side token found for this request"); Context.Response.StatusCode = 401; return; } try { // Get the posted file from the appropriate file key HttpPostedFile postedFile = Context.Request.Files[ tokenObj.FileObjName ]; if (postedFile != null) { // Get the path from the token and ensure it exists string path = tokenObj.UploadPath; if (!Directory.Exists(path)) Directory.CreateDirectory(path); string filename = Path.GetFileName(postedFile.FileName); postedFile.SaveAs(path + @"\" + filename); // Post a successful status Context.Response.Write(filename); Context.Response.StatusCode = 200; } } catch (Exception ex) { Context.Response.Write("Error: " + ex.Message); Context.Response.StatusCode = 500; }</span></span></code> </pre> <br>  If the token in the session is not found, the file will not be allowed to be downloaded. <br><br>  <b>File Extension Restrictions</b> <br><br>  Good practice when developing a bootloader is to add a mechanism for restricting files by their extension.  In this section, I will show how I managed to do this on the client and server side, taking into account the security parameters discussed above. <br><br>  Check on the client side is implemented as an event in the UploadiFive library.  But the event of adding an onChange file can be used outside the library. <br><br>  Valid extensions are passed to the UploadiFiveControl control as a string, separated by commas. <br><br><pre> <code class="javascript hljs">uploadControl.AllowedFileExtensions = <span class="hljs-string"><span class="hljs-string">".jpg|.bmp"</span></span>;</code> </pre> <br>  If everything is set correctly, the JavaScript code is attached to the onAddQueueItem event when rendering HTML. <br><br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#file_upload'</span></span>).uploadifive({ <span class="hljs-string"><span class="hljs-string">'fileObjName'</span></span>: <span class="hljs-string"><span class="hljs-string">'Filedata'</span></span>, <span class="hljs-string"><span class="hljs-string">'formData'</span></span>: { <span class="hljs-string"><span class="hljs-string">'token'</span></span> : <span class="hljs-string"><span class="hljs-string">'4c893799-fd21-4d85-80c4-e32e6cacc794'</span></span> }, <span class="hljs-string"><span class="hljs-string">'removeCompleted'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'onAddQueueItem'</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> extArray = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(<span class="hljs-string"><span class="hljs-string">'[ ".jpg", ".bmp" ]'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileName = file.name; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ext = fileName.substring(fileName.lastIndexOf(<span class="hljs-string"><span class="hljs-string">'.'</span></span>)).toLowerCase(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isExtValid = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; extArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ext == extArray[i] ) { isExtValid = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !isExtValid ) { alert(<span class="hljs-string"><span class="hljs-string">"File types of '&lt;extension&gt;' are not allowed"</span></span>.replace(<span class="hljs-string"><span class="hljs-string">'&lt;extension&gt;'</span></span>, ext)); $(<span class="hljs-string"><span class="hljs-string">'#file_upload'</span></span>).uploadifive(<span class="hljs-string"><span class="hljs-string">'cancel'</span></span>, file); } }, <span class="hljs-string"><span class="hljs-string">'uploadScript'</span></span>: <span class="hljs-string"><span class="hljs-string">'UploadiFiveFileHandler.ashx'</span></span> }); }); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  This code takes the list of extensions converted by the C # control to a JSON array and compares the specific extension with the array data.  If this extension is invalid, the user receives a warning, and the file is removed from the download queue. <br><br>  The Http handler code on the server side looks about the same.  It uses a security token to get a list of valid extensions: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Get the filename for the uploaded file string filename = Path.GetFileName(postedFile.FileName); // Are there file extension restrictions? if ( !String.IsNullOrEmpty(tokenObj.AllowedFileExtensions)) { string extension = Path.GetExtension(postedFile.FileName).ToLower(); List&lt;string&gt; allowed = tokenObj.AllowedFileExtensions.Split("|,".ToCharArray()).ToList(); if (!allowed.Contains(extension)) { Context.Response.Write("Invalid extension"); Context.Response.StatusCode = 401; return; } } // Save this file locally postedFile.SaveAs(path + @"\" + filename);</span></span></code> </pre> <br>  Now the restriction of invalid formats on the client and server side can be considered implemented. <br><br>  <b>File Size Limits</b> <br><br>  There are also a number of ways to limit file downloads to their size.  The IIS server has such limitations, and this should be kept in mind when working.  In addition, Uploadify also has a way to limit the size of uploaded files, as I mentioned. <br><br>  In the web.config file, you can set the maximum size for a valid content type, which will impose restrictions on the downloaded files.  The requestLimits tag is responsible for this. It accepts values ‚Äã‚Äãin the number of bytes.  For example, the code snippet below limits the size of the uploaded file to approximately 200 MB.  This fragment was also included in the code in the web.config file. <br><br><pre> <code class="javascript hljs">&lt;configuration&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">system.webServer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">security</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">requestLimits</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">maxAllowedContentLength</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"209715200"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">security</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">system.webServer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  In addition, the Uploadify library uses the JavaScript fileSizeLimit property as a FileSizeLimit in C # classes.  It looks like a string like ‚Äú100KB‚Äù or ‚Äú200MB‚Äù. <br><br>  <b>Flash as a backup and compatibility issues</b> <br><br>  Some popular browsers, especially IE9, do not receive the necessary updates in order to support HTML5.  Therefore, if in our case you do not take care of the backup option, the user of the old browser will see only the standard HTML file upload field without a download button.  In this case, of course, nothing will work. <br><br>  Fortunately, we can take as a backup version a Flash version, which is very similar to the HTML5 version.  To do this, use the onFallback event.  It was additionally implemented in C # classes available for download here.  If you add this function to the current code using the UploadiFiveControl control, you get something like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Create the upload control and add to the form UploadiFiveControl uploadControl = new UploadiFiveControl { UploadPath = savepath, RemoveCompleted = true, Version = UploadiFive_Version_Enum.HTML5, RevertToFlashVersion = true, NoHtml5OrFlashMessage = "Please try a more current browser" };</span></span></code> </pre><br>  In the code below, we tell the class to add a backup Flash option, setting the RevertToFlashVersion property to true.  If the browser does not support either HTML5 or Flash, you can display a warning window using the NoHtml5OrFlashMessage property. <br><br>  The example above generates the following JavaScript code that will be included in the HTML code of your aspx page: <br><br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#file_upload'</span></span>).uploadifive({ <span class="hljs-string"><span class="hljs-string">'fileObjName'</span></span>: <span class="hljs-string"><span class="hljs-string">'Filedata'</span></span>, <span class="hljs-string"><span class="hljs-string">'formData'</span></span>: { <span class="hljs-string"><span class="hljs-string">'token'</span></span> : <span class="hljs-string"><span class="hljs-string">'f8916a9f-9dda-441f-a58b-13948e61f7e7'</span></span> }, <span class="hljs-string"><span class="hljs-string">'removeCompleted'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'uploadScript'</span></span>: <span class="hljs-string"><span class="hljs-string">'UploadiFiveFileHandler.ashx'</span></span>, <span class="hljs-string"><span class="hljs-string">'onFallback'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Revert to flash version if no HTML5 $('#file_upload').uploadify({ 'fileObjName': 'Filedata', 'formData': { 'token' : 'f8916a9f-9dda-441f-a58b-13948e61f7e7' }, 'removeCompleted': true, 'swf': 'uploadify/uploadify.swf', 'uploader': 'UploadiFiveFileHandler.ashx', 'onFallback': function() { alert('Please try a more current browser'); } }); } }); }); &lt;/script&gt;</span></span></code> </pre> <br>  Now we have a working backup version for old browsers, which is almost identical to the main version.  To trigger the backup mechanism, a Flash version is needed, but only as a secondary option, as in my example.  Of course, you will need to download both versions and link the links to the corresponding CSS and JS files inside the head tag. <br><br>  Link to code: <br><br>  All code and four aspx demo pages are available <a href="">for download at the link.</a> </div><p>Source: <a href="https://habr.com/ru/post/341366/">https://habr.com/ru/post/341366/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341352/index.html">FrontFest.Keynote - Blaine Cook (creator of OAuth) and Mateus Fernandez (CTO Zeit)</a></li>
<li><a href="../341354/index.html">Bayram Annakov (CEO App in the Air): How to do the right onboarding</a></li>
<li><a href="../341356/index.html">Digest: ITMO University developments in 2017</a></li>
<li><a href="../341360/index.html">Deobfuscation of a single script with popups</a></li>
<li><a href="../341364/index.html">11 rules of data visualization</a></li>
<li><a href="../341368/index.html">GDG DevFest Gorky 2017</a></li>
<li><a href="../341370/index.html">How to make an LXC container on a router running LEDE</a></li>
<li><a href="../341372/index.html">C ++ User Group News</a></li>
<li><a href="../341374/index.html">6 IT infrastructure trends: forecast for 2018</a></li>
<li><a href="../341376/index.html">Pebble Kombat. Javascript Watch Game Development History</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>