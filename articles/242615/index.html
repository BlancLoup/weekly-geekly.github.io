<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúEppur si muove!‚Äù * Or working with timezone in Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On our planet Earth, at the same time, in different geographic points of the planet there may be different times of day. This is a consequence of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúEppur si muove!‚Äù * Or working with timezone in Python</h1><div class="post__text post__text-html js-mediator-article">  On our planet Earth, at the same time, in different geographic points of the planet there may be different times of day.  This is a consequence of the fact that our world is a rotating geoid, not a flat disk, but that our solar system has only one star, the sun.  Since school, we all know about time zones, and we all met with their manifestations in real life (‚ÄúMoscow time - 15 hours, in Petropavlovsk-Kamchatsky - midnight‚Äù, jet-lan for long-haul flights, etc.).  Unfortunately, time zones are only partially based on the physical features of our world, and in computer calculations we have to take into account other, sometimes unexpected, nuances. <br><br>  * "And yet it turns!" - a catch phrase, which Galileo Galilei allegedly said, leaving the process of the Inquisition, after the abdication of his conviction that the Earth revolves around the sun.  In our case, alas, this rotation leads to all these ‚Äúwonderful‚Äù problems with time zones. <br><br>  What does this article have in common with Galileo?  Yes, in general, nothing.  I'm afraid that if our world were the center of the universe, we would still have to deal with time zones.  Let us take the title as my misstep, which I can no longer fix (although I can). <br><a name="habracut"></a><br><h1>  What is a ‚ÄúTime Zone‚Äù? </h1>  What is your time zone?  If you answer "UTC + 3" - this will be the correct answer only for the current time, but in general this statement is incorrect.  If you look at the time zone database, you will see, for example, that Berlin and Vienna, despite the UTC + 1 offset, have different time zones (Europe / Berlin and Europe / Vienna).  Why is that?  The reason is that they had different summer time (DST) in different periods of history.  Even if today these two countries and these two cities have the same DST rules, a hundred years ago this was not the case.  For example, in Austria and Germany at different times there was no transition to summer time: in Austria since 1920, and in Germany since 1918. During the Second World War, both countries had the same DST rules (which is not surprising), but after its endings are again out of sync.  Germany canceled daylight saving time in 1949 and introduced it again in 1979, Austria also canceled DST in 1948 and introduced it again in 1980. The worst thing is that they did not even agree on the same daylight saving time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And it happens all over the world.  For computer calculations, daylight saving time is a huge problem, because we assume that time has a continuous moton move.  With the transition to summer time, we have an hour every year, which is repeated twice, and there is an hour that we just skip.  If you specify local time when writing to the log, you may lose the order of the log lines when sorting. <br><br>  Quote from pytz documentation: <br><blockquote>  So, for example, in the US / Eastern timezone in 2002 during the end of the DST, October 27, the time 01:30 came twice, and during the start of the DST, April 7, the time 02:30 did not come, because  at 02:00 the clock moved forward an hour. </blockquote><br>  But in the timezone stored not only the rules of daylight saving time.  Some countries change time zones, sometimes even without changing the DST.  So, for example, in 1915, Warsaw passed to Central European Time.  As a result, at midnight on August 5, 1915, the clock was switched to 24 minutes ago (while summer time was in effect in Warsaw). <br>  In general, even more hell is going on with time zones.  There is at least one country whose timezone was different during the day due to the 0:00 time synchronization with the time of sunrise. <br><br><h1>  Where is common sense? </h1>  Common sense is and it is called Coordinated Universal Time (UTC).  UTC is a timezone without daylight saving time and without any changes in the past.  However, due to the fact that our Earth is a rotating geoid and there are things in the world that we cannot control, there is a problem of adjustment seconds (leap seconds).  Whether UTC will take into account correction seconds (which are irregular and therefore difficult to take them into account when calculating), or not (then each timezone will have a difference of a few seconds from UTC) - as far as I know, it has not been decided yet. <br><br>  Despite this, right now UTC is the safest option.  From UTC you can convert the time to a local time for any time zone.  The inverse transformation, given the above, is impossible. <br><br>  So, here is the main rule of thumb that will never let you down: <br><blockquote>  <strong>Always store and work over time in UTC</strong> .  If you need to keep the original data - write them separately.  Never store local time and timezone! </blockquote><br><h1>  What is the problem? </h1>  In general, this article would have to end.  But unfortunately, there are a couple of things you need to keep in mind when you are programming in Python.  This is a legacy of architectural solutions of those ancient times, when no one thought about the practical use of language.  Motivation mattered, common sense did not. <br><br>  One day, the following decisions were made about the archive of the datetime module of the standard Python library: <br><ol><li>  The datetime module should not store information about the timezone, because the timezone changes too often. </li><li>  On the other hand, the datetime module should provide the ability to add information about the timezone (tzinfo). </li><li>  The following objects must be implemented in the datetime module: date, time, date + time, timedelta. </li></ol><br>  Unfortunately, something went wrong.  The main problem is that the datetime object, which has been added information about the timezone (tzinfo), will not interact with the datetime object without the timezone: <br><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytz, datetime &gt;&gt;&gt; a = datetime.datetime.utcnow() &gt;&gt;&gt; b = datetime.datetime.utcnow().replace(tzinfo=pytz.utc) &gt;&gt;&gt; a &lt; b Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; TypeError: can<span class="hljs-string"><span class="hljs-string">'t compare offset-naive and offset-aware datetimes</span></span></code> </pre> <br>  If you close your eyes to that horrible API, with which you have to add information about the timezone to the datetime object, there are still problems.  When you work with datetime objects in Python, you will sooner or later have to add or delete tzinfo in all places of your program. <br><br>  Another problem is that you have two ways to create a datetime object with the current time in Python: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>datetime.datetime.utcnow() datetime.datetime(<span class="hljs-number"><span class="hljs-number">2011</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">375010</span></span>) &gt;&gt;&gt; datetime.datetime.now() datetime.datetime(<span class="hljs-number"><span class="hljs-number">2011</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">57</span></span>, <span class="hljs-number"><span class="hljs-number">70767</span></span>)</code> </pre><br>  One returns the time in UTC, the other returns the local time.  However, the datetime object will not tell you what ‚Äúlocal time‚Äù is (because it does not have information about the time zone, at least until Python 3.3), and there is no way to find out which of these objects stores time in UTC. <br><br>  If you convert the UNIX timestamp to a datetime object, you should also be careful when using the datetime.datetime.utcfromtimestamp method, because it accepts the timestamp in local time. <br><br>  The datetime library also provides date and time objects, in which it is absolutely useless to add tzinfo.  The time object cannot be transferred to another timezone, because for this you need to know the date.  The date object in general only makes sense for the local time zone, because ‚Äútoday‚Äù for me may be ‚Äúyesterday‚Äù or ‚Äútomorrow‚Äù for you ‚Äî say, thanks to the wonderful world of time zones. <br><br><h1>  So what are the recommendations of experts? </h1>  Now we know who is to blame.  But what to do?  If we ignore theoretical problems that manifest themselves only in the case of working with historical dates in the past, then here are a number of recommendations.  In case you have to work with historical dates, there is an alternative mxDateTime module, well-designed enough and even supporting various calendars (Gregorian and Julian). <br><br><h3>  Use UTC inside the program </h3><br>  If you need to get the current time, always use datetime.datetime.utcnow ().  If you get local time from a user, always convert it to UTC right away.  If you can‚Äôt do a single-valued conversion, report it to the user, do not try to guess his time blindly.  During the transition to summer time and back, my iPhone several times failed to correctly translate time.  I know when it needs to be done, because I have to translate the analogue clock. <br><br><h3>  Never use time with time zone </h3><br>  It may seem like a good idea to you - always add time zone information to datetime objects, but in fact a much better idea is not to do this.  A good solution would be to use a datetime object without tzinfo and with a UTC time.  Consider the fact that you cannot compare time with a timezone with time without it, just as you cannot mix bytes and unicode in Python 3. Use this API flaw for your own purposes. <br><ol><li>  Inside the program, always use datetime objects without tzinfo with a UTC time. </li><li>  When you interact with a user, always convert his local UTC time and back. </li></ol><br>  Why don't you need to add tzinfo to a datetime object?  First, because the overwhelming majority of libraries expect tzinfo to be None.  Secondly, it‚Äôs a terrible idea to always work with tzinfo, given the crooked API of working with it.  The pytz library has alternative functions for converting timezone, because the API implemented in the standard library for converting tzinfo is not flexible enough to work with most real timezone.  If we do not use tzinfo objects, there is a chance that in the future everything will change for the better. <br><br>  Another reason for not using time with the time zone is that the tzinfo object is very specific and depends heavily on its implementation.  There is no standard way to transfer information about the timezone (except, perhaps, the UTC timezone) to other languages, via HTTP, etc.  In addition, datetime objects with information about the timezone often become too huge when serialized using the pickle module, or even impossible to serialize them (this depends on the implementation of the tzinfo object). <br><br><h3>  Conversion for formatting </h3><br>  If you need to show the time in the user's timezone, take a datetime object with a UTC time, add the UTC timezone to it, convert the time to the user's local time and format it.  Do not use the timezone conversion tzinfo methods, because they do not work correctly, use pytz.  Then transfer the time to the ‚Äúnaive‚Äù by dropping the timezone offset from the resulting datetime object that you created for formatting and continue to live happily. <br><br>  <em>Translated <a href="https://habrahabr.ru/users/dreadatour/" class="user_link">Dreadatour</a> , text read <a href="https://habrahabr.ru/users/dreadatour/" class="user_link">%%</a> username.</em> <br><hr><br><h3>  Bonus from the translator for those who read to the end: </h3><br>  Gorgeous video from Tom Scott about timezone: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/-5wpm-gesOY%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhh5-aB5iX4G8jQpQvRBLWuf_mDmRA" frameborder="0" allowfullscreen=""></iframe><br><br>  And in my <a href="http://habrahabr.ru/company/mailru/blog/242645/">next article</a> I will write where the author is wrong, why he is wrong and how to do it right after all. </div><p>Source: <a href="https://habr.com/ru/post/242615/">https://habr.com/ru/post/242615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242601/index.html">Immersion cooling, underwater servers: Immersion-2 for 3M ‚Ñ¢ Novec ‚Ñ¢ delivers magical results, put into practice in Hong Kong</a></li>
<li><a href="../242603/index.html">Cryptographic solutions. From the cloud signature to the trusted environment</a></li>
<li><a href="../242609/index.html">Expressive javascript: search and error handling</a></li>
<li><a href="../242611/index.html">Career project manager vs organization</a></li>
<li><a href="../242613/index.html">Write clean code with Reactive Extensions</a></li>
<li><a href="../242619/index.html">"IT theater" of concrete and green</a></li>
<li><a href="../242621/index.html">Objective-C Minimalism</a></li>
<li><a href="../242623/index.html">Brackets for doubters and newbies</a></li>
<li><a href="../242627/index.html">A cozy book post for you and your project.</a></li>
<li><a href="../242629/index.html">Hands off the console</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>