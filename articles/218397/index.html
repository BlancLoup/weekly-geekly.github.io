<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Debug asynchronous javascript using Chrome DevTools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 The ability to work asynchronously using callback functions (hereinafter simply returning functions) is a distinctive feature of JavaSc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Debug asynchronous javascript using Chrome DevTools</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  The ability to work asynchronously using callback functions (hereinafter simply returning functions) is a distinctive feature of JavaScript.  Using asynchronous return functions allows you to write event-oriented code, but also adds a bunch of problems, because the code stops running in a linear sequence. <br><br>  Fortunately, now in Chrome Canary DevTools you can track the entire call stack of asynchronous functions in JavaScript! <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f90/48d/db7/f9048ddb74812db53fcf75e9641c904c.gif"></div><br>  <i>A small presentation of the stack of asynchronous calls.</i> <br><br>  As soon as you enable support for the asynchronous function call stack in DevTools, you can get detailed information about the status of your web application at any time.  Stroll through the full stack of your event handlers, setInterval, setTimeout, XMLHttpRequest, promises, requestAnimationFrame, MutationObservers, and so on. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition to the fact that you can view the call stack, you can also analyze the values ‚Äã‚Äãof any variables at any time during the execution of functions.  This is like a time machine for observing expressions. <br><br>  Let's turn on support for this functionality and run through several scenarios. <br><br><h4>  Enable asynchronous debugging support in Chrome Canary </h4><br>  Try the new functionality, including its support in Chrome Canary (build 35 and higher).  Open the Sources page in Chrome Canary DevTools. <br><br>  The ‚ÄúAsync‚Äù checkbox is located on the panel next to the Call Stack panel on the right side.  Depending on the position of this checkbox, the ability to debug asynchronous functions will be turned on or off (although once you turn it on, you will most likely never want to turn it off). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/44c/085/e8e/44c085e8ee6f3b4fecb29b1651fc005a.gif"></div><br><h4>  Interception of deferred events and XHR responses </h4><br>  You may have seen this before in Gmail: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f8/e7e/3b1/2f8e7e3b1dab73e5163918b3e2aadd89.png"><br><br>  If there is an error in sending the request (there are problems on the server side or problems with the connection on the client side), Gmail will try to send a letter to a short time. <br><br>  To demonstrate how the asynchronous call stack can help us analyze deferred events and XHR responses, I described the situation described above with <a href="http://www.html5rocks.com/en/tutorials/developertools/async-call-stack/xhr/demo.html">an example of a Gmail stub</a> .  All the JavaScript code of the example can be found at the link above.  The algorithm of his work is as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d16/edb/37d/d16edb37d7e3327cac38b630a5159eff.gif"></div><br>  <i>In the diagram above, the methods highlighted in blue are the main places to use the new features of DevTools, since these methods are executed asynchronously.</i> <br><br>  If you only look at the Call Stack panel in previous versions of DevTools, a breakpoint in the postOnFail () function will give you only a little information about where the postOnFail () function was called.  And now let's take a look at the difference with the case when we work with the ability to debug asynchronous calls: <br><table><tbody><tr><td>  <b>Before</b> </td><td>  <b>After</b> </td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/511/5c3/a60/5115c3a6052631df8a0afe4bf9256b4d.gif"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/a0a/0e4/a21/a0a0e4a213626d58d66897954f1beac7.gif"></td></tr><tr><td>  <b>Call Stack Panel Without Asynchronous Request Support</b> <br>  Here you can see that the postOnFail () function call originated from the returned AJAX function, but nothing more. <br></td><td>  <b>Call Stack Panel with asynchronous request support</b> <br>  Here you can see that the XHR was called from submitHandler (), which was called by the click event handler declared in scripts.js.  Cool! <br></td></tr></tbody></table><br>  When using the asynchronous call stack, we can easily view all call chains.  For example, we can determine if the call to the submitHandler () method was initiated in the same way as described above, or via retrySubmit () as described below: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/25c/62c/7b725c62ca59d153e5aa735522cbc62f.gif"></div><br><br>  Using the call stack panel, you can also tell whether the triggering of a user interface event (for example, a click), a setTimeout () delay, or an asynchronous return function has led to a breakpoint. <br><br><h4>  Watch expressions asynchronously </h4><br>  When you view your call stack, your expressions added to the tracking will be updated to reflect the state they took at the specified time! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/309/15e/6b9/30915e6b97372748d21d97302b24fd81.gif"></div><br><br><h4>  Execute code from previous states </h4><br>  In addition to simply observing expressions, you can also interact with your code from previous states directly in the DevTools JavaScript console. <br><br>  Imagine that you are a Doctor Who (Dr.. Who) and you need a little help comparing the hours that you had until this point in the Tardis and now.  From the DevTools console, you can easily execute, save, and perform calculations on values ‚Äã‚Äãfrom different execution points. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99b/4b5/c2a/99b4b5c2ae45c3956f43372172dbc4e4.gif"></div><br>  <i>Use the JavaScript console to debug the asynchronous call stack of your code.</i> <i><br></i>  <i>An example above can be found <a href="http://www.html5rocks.com/en/tutorials/developertools/async-call-stack/past-scope/demo.html">here.</a></i> <br><br>  Staying in DevTools to manipulate your expressions, you save time that would take you to return to previous code states, make changes, and refresh the browser page. <br><br><h4>  On the way: Debugging promise chains </h4><br>  If in the last Gmail example you had a hard time unraveling the stack of asynchronous calls without the new DevTools feature, then you can probably imagine how much more difficult it will be with more complex asynchronous queues, for example, with a chain of promises?  Let's go over the last example from the <a href="http://jakearchibald.com/">Jess Archibald</a> <a href="http://habrahabr.ru/post/209662/">promise in JavaScript training</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/444/2a8/158/4442a81582600ca72559f996dee2e7c6.png"></div><br>  <i>Javascript promises flowchart</i> <br><br>  Here is a small animation of working with the call stack <a href="http://www.html5rocks.com/tutorials/es6/promises/async-best-example.html">in the best asynchronous example</a> from Jake: <br><br>  <b>Before:</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/eac/895/2c9/eac8952c9a290e618bacc249072eb960.gif"><br>  <i><b>Call Stack Panel without asynchronous debugging</b></i> <i><br></i>  <i>Notice how little information the call stack panel provides when we debug promises.</i> <br><br>  <b>After:</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/929/1dc/041/9291dc0415bccc200ceb062920db6892.gif"><br>  <i><b>Call Stack Panel with Asynchronous Debug Support</b></i> <i><br></i>  <i>Wow, what promises!</i>  <i>A huge number of returned functions.</i> <br><br><h6>  Note: </h6><br>  The promise support for the call stack will be ready very soon, as soon as the realization of the promises grows from the version in Blink to the final version in V8. <br><br>  In the spirit of going back in time, if you want to look at asynchronous call stacks for promises today, you can use <a href="https://googledrive.com/host/0B8R1QvA3x5IbWll3M0hIYXVLZlk/">Chrome 33 or Chrome 34</a> .  Go to <a href="http://chrome//flags/">chrome: // flags / # enable-devtools-experiments</a> and enable experimental DevTools support.  After rebooting Canary, go to the DevTools settings, there you will be able to enable <a href="">support for asynchronous call stacks</a> . <br><br><br><h4>  Dive deeper into web animation </h4><br>  Let's go deeper into the HTML5Rocks archives.  Remember the article by Paula Lewis ‚ÄúMore compact, productive and faster animations using requestAnimationFrame‚Äù? <br><br>  Open the requestAnimationFrame demo and add a breakpoint at the beginning of the update () method (that's about 874 lines) of the post.html file.  With an asynchronous call stack, we can ‚Äúplunge deeper‚Äù into requestAnimationFrame.  And, just like in the example with the Gmail stub, we have the opportunity to walk back to the starting event (this is a scroll event). <br><table><tbody><tr><td>  <b>Before</b> </td><td>  <b>After</b> </td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/92d/499/de8/92d499de84342e5736c8a8dfde6d872b.gif"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/330/b96/736/330b96736b93268b660f53a35ad60517.gif"></td></tr></tbody></table><br><h4>  Track DOM changes with MutationObserver </h4><br>  MutationObserver allows us to monitor events in the DOM.  Consider a simple example: when you click a button, a new DOM element is added to the block. <br><br>  Add a new breakpoint in the nodeAdded () function (line 31) in the demo.html file.  Using the asynchronous call stack, you can go back through the call history through the addNode () method to the initial event of the click. <br><table><tbody><tr><td>  <b>Before</b> </td><td>  <b>After</b> </td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/d56/d27/aab/d56d27aab9f47fbc8ce03ab468e9603c.gif"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/52b/541/b57/52b541b5754903ba5e2b26bc92a5722f.gif"></td></tr></tbody></table><br><h4>  Notes on debugging javascript code using the asynchronous call stack </h4><br><h5>  Call your functions </h5><br>  If you are used to adding all your returned functions as anonymous functions, then you may now need to reconsider your decision and start giving names to functions that will help you debug using the asynchronous call stack even easier. <br><br>  For example, take an anonymous function: <br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'load'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre> <br>  And give her a name.  Let's say windowLoaded (): <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'load'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windowLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre><br>  When a document load event occurs, this will be reflected in the stack output using DevTools, where instead of the mystical name "(anonymous function)", the full name of the function will appear.  This will significantly simplify the readability of the call history, and in most cases will allow us to understand at a glance what is happening there. <br><table><tbody><tr><td>  <b>Before</b> </td><td>  <b>After</b> </td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/fc3/ab6/f82/fc3ab6f82412401e924b6040ce860fa5.gif"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/8af/7bd/97e/8af7bd97ee56fe478e18647d89cfab6f.gif"></td></tr></tbody></table><br><h4>  What's next </h4><br>  Summarizing all of the above, all these asynchronous return functions will display the full call stack: <br><br><ul><li>  <b>Timers</b> : Return back before initialization setTimeout () or setInterval () </li><li>  <b>XHRs</b> : Return back to the point where xhr.send () was called </li><li>  <b>Animations</b> : Bring back to the time the requestAnimationFrame is called. </li><li>  <b>Event Handlers</b> : Bring back to the time the handler was installed using addEventListener () </li><li>  <b>Change Watchers</b> : Bring back to the point where the change event was triggered. </li></ul><br>  You can also view the full stack of changes in the near future for the following JavaScript API: <br><br><ul><li>  <b>Promises</b> : Return back to the moment where promises were fulfilled </li><li>  <b>Object.observe</b> : Returns back before attaching the return function. </li></ul><br>  The ability to view the entire stack of your return functions should be raising your hair.  This feature in DevTools will be especially useful when several asynchronous events happen depending on each other, or when an uncaught error message occurs in one of your asynchronous return functions. <br><br>  Give them a chance at Chrome Canary.  If you have something to tell us about this, email us in the <a href="https://groups.google.com/forum/">Chrome DevTools</a> group or <a href="http://crbug.com/new">send us bugs</a> in our Chrome DevTools bug tracker. </div><p>Source: <a href="https://habr.com/ru/post/218397/">https://habr.com/ru/post/218397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218387/index.html">Another do-it-yourself NAS, part 3: the adventures of XXX in the old tower</a></li>
<li><a href="../218389/index.html">Hybrid applications in Qt using D3.js as an example</a></li>
<li><a href="../218391/index.html">3000 mAh Battery Cover for Sony Xperia Z1 Review</a></li>
<li><a href="../218393/index.html">Open Interfaces: Future Business Strategy</a></li>
<li><a href="../218395/index.html">Systems such as DoubleClick can identify up to 90% of users.</a></li>
<li><a href="../218399/index.html">Python-digest # 21. News, interesting projects, articles and interviews [March 30, 2014 - April 6, 2014]</a></li>
<li><a href="../218401/index.html">Game Master Tools</a></li>
<li><a href="../218403/index.html">Mathematicians have found a way to simultaneously contact 7 cylinders</a></li>
<li><a href="../218405/index.html">Structural Typing in C #</a></li>
<li><a href="../218407/index.html">The history of game consoles in advertising. Part 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>