<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What to do if Google authenticator always gives the wrong codes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 
 I would like to tell you about the 2FA authentication problems on Android 4.4.2 KitKat devices and about the solution, which in our case s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What to do if Google authenticator always gives the wrong codes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://lh6.ggpht.com/SK6qynd5-RDcys_3anR6QLocnjY_o9ZbDMmKtTnrAiQ3zNuWVFbkE2N15IyNBGBUhdkH=w300-rw" align="right"><br>  Good day. <br>  I would like to tell you about the 2FA authentication problems on Android 4.4.2 KitKat devices and about the solution, which in our case stopped long searches. <br><br>  Some time ago, my colleagues and I decided to add Two-stage authentication (Two factor authentication or, for short, 2FA) for our small office server based on Ubuntu Server. <br><br>  2FA is an extra level of security and a nice addition to the existing authentication mechanism.  In addition to the usual pair of login + password from the user who performs the authorization, a digital key is required, which is dynamically changed every 30 seconds and is generated by a device in the user's possession.  To generate the key, we used the <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.google.android.apps.authenticator2%26hl%3Dru">Google authenticator</a> App and a mobile phone on the Android platform.  After a one-time setup, the application generates codes that have a lifetime of 30 seconds, and the server generates exactly the same codes.  When authenticating codes are compared. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since data is not transmitted from the server and is stored only on the device, this mechanism is more secure than sending confirmation codes (for example, as a 3D-secure SMS confirmation in banking systems). <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea8/721/502/ea8721502916c0df4ea01abd0632b786.jpg"></div><br>  There were a lot of step-by-step instructions on how to configure the server on the network.  Everything is very simple and intelligible in them.  I was guided by <a href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-two-factor-authentication">this article</a> . <br><br>  After the server settings, the <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.google.android.apps.authenticator2%26hl%3Dru">Google Authenticator</a> application was installed on the Lenovo p780 phone, ‚Äúread‚Äù the phone from the QR-code monitor and received the cherished tsiferki for authorization.  Before you restart SSH, <b>do not forget to save backup keys to restore access</b> . <br><br>  And now, everything is ready to use!  Reboot the SSH, go to the server, specify the password, after the password we are asked to present the Verification code, rewrite it from the phone and ... ask again for the password? !!!  It looks like this: <br><blockquote>  ssh user@server.ru <br>  Password: &lt;enter password&gt; <br>  Verification code: &lt;enter the code from the phone&gt; <br>  Password: &lt;? !!, enter the password again&gt; <br>  Verification code: &lt;enter the code from the phone&gt; <br>  Password: &lt;enter the password again&gt; <br>  Verification code: &lt;re-enter the code&gt; <br>  user@server.ru's password: &lt;once again password&gt; <br>  Permission denied, please try again. <br>  user@server.ru's password: &lt;re-enter password&gt; <br>  Received disconnect from xx.xxx.xx.xx: 2: Too many authentication failures for user </blockquote><br><br>  At first they thought that the error was made in the settings, but after trying several mobile devices it became obvious that the <b>codes generated on Android 4.4.2 KitKat by the Google Authenticator application are always wrong</b> . <br><br><h2>  "Solutions" that were found and their results: </h2><br><ol><li>  If you roll back the version of Android, it starts working correctly.  (with this "decision" worked for some time, but decided to move on) </li><li>  Since the problem boils down to incorrect time zones, many solutions are aimed precisely at correcting them.  The TimeZone Fixer application can really help with this problem, however, after using it, some applications start to display erroneous time and need to be repaired manually.  (The solution has its drawbacks and risks. All information about the application is available on <a href="http://4pda.ru/forum/index.php%3Fshowtopic%3D274688">w3bsit3-dns.com</a> ) </li><li>  Adjust the time manually.  To be honest, this method did not work for us.  Transfer the clock manually and thereby synchronize the time on the phone and the server.  Alas, all attempts gave nothing, although there were people claiming what worked for them.  In any case, the prospect of losing the function of the clock in the phone is not the most pleasant ... </li><li>  Clock synchronization inside the settings of the Google authenticator application (in our case without results, however there were comments that helped someone) </li></ol><br><br><h2>  The final solution: FreeOTP </h2><br>  During the search for a solution on the web, I already came across the <a href="https://github.com/google/google-authenticator">Google Authenticator</a> GitHub application, there is our error tracking, and the solution suggested is: <br><blockquote>  ‚ÄúYou can be used by FreeOTP Authenticator (by Red Hat) instead of Google Authenticator until someone fix it.‚Äù </blockquote><br><img src="https://lh3.ggpht.com/XrHHxpjdFjJ-pAj63VRshglFm8VtCA6S_QxYBufoEmcxU3LGfPHDt6g90g-vYHp6yfU=w300-rw" align="right"><br>  For a long time it seemed to me that it is recommended to use another authentication mechanism that needs to be put on the server instead of Google, so I diligently searched for other solutions.  I wanted to make Google authenticator work, but in fact they recommend using another Android application, and the backend remains unchanged. <br><br>  Red Hat <b><a href="https://play.google.com/store/apps/details%3Fid%3Dorg.fedorahosted.freeotp%26hl%3Dru">FreeOTP Authenticator</a> application</b> .  After setting up the same QR code, everything began to work without the need to correct something. <br><br>  Unfortunately, I cannot tell you the reason for the error in the Google authenticator, but I hope that my sad experience will help save someone's time. <br><br>  I will be glad to your comments!  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/257197/">https://habr.com/ru/post/257197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257171/index.html">Application Development for Apple Watch (iPhone and iPad) using Wolfram Language (Mathematica)</a></li>
<li><a href="../257173/index.html">Microsoft Azure platform updates for April-May 2015. Special // Build Edition</a></li>
<li><a href="../257177/index.html">Webair data center NY1: one of the most reliable Tier III data centers in the United States (feature overview + photo)</a></li>
<li><a href="../257189/index.html">Imager on FLIR Lepton do it yourself</a></li>
<li><a href="../257191/index.html">JavaScript and CSS Compilation</a></li>
<li><a href="../257199/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ158 (April 27 - May 3, 2015)</a></li>
<li><a href="../257203/index.html">CLRium # 2. Grand Workshop on .NET in St. Petersburg</a></li>
<li><a href="../257207/index.html">Free SSL certificates - now for 3 years from WoSign</a></li>
<li><a href="../257209/index.html">Making the application push</a></li>
<li><a href="../257211/index.html">Creating a Landing Page Design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>