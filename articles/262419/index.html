<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windows Remote Arduino - control a desk lamp directly from a universal Windows application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Finishing a week of the Internet of things on Habr√© and in continuation of the previous post about partnership with Arduino , I will tell you about co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Windows Remote Arduino - control a desk lamp directly from a universal Windows application</h1><div class="post__text post__text-html js-mediator-article">  Finishing a <a href="http://habrahabr.ru/company/microsoft/blog/261367/">week of the Internet of things</a> on Habr√© and in continuation of the previous post <a href="http://habrahabr.ru/company/microsoft/blog/262249/">about partnership with Arduino</a> , I will tell you about connection of devices to Windows.  I <a href="http://blog.soshnikov.com/2015/04/28/%25D0%25BE%25D1%2582-%25D0%25BF%25D0%25BE%25D0%25B3%25D0%25BE%25D0%25B4%25D0%25BD%25D0%25BE%25D0%25B9-%25D1%2581%25D1%2582%25D0%25B0%25D0%25BD%25D1%2586%25D0%25B8%25D0%25B8-%25D0%25BA-%25D0%25B2%25D0%25B7%25D1%2580%25D0%25BE%25D1%2581%25D0%25BB%25D0%25BE%25D0%25BC%25D1%2583-%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580/">already wrote about various scenarios for connecting sensors to the cloud</a> , but there are scenarios when we just want to connect sensors or devices to our computer and remotely manage them.  For example, we want to make an application that will turn the desk lamp on and off.  In these cases, the simplest solution would be to use <a href="http://ms-iot.github.io/content/en-US/win10/SetupWRA.htm">Windows Remote Arduino</a> . <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/YngFIquMWIM%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgOhKtRYcZrtgERDuiQo5NAqJI6zQ" frameborder="0" allowfullscreen=""></iframe><br><a name="habracut"></a><br><h3>  What is Windows Remote Arduino </h3><br>  <a href="http://ms-iot.github.io/content/en-US/win10/SetupWRA.htm">Windows Remote Arduino</a> is a WinRT library that allows you to control the digital and analog channels of the Arduino card from a Windows / Windows Phone application using familiar commands like digitalRead / Write and analogRead / Write.  At the same time, the board itself can be connected to the computer via USB or Bluetooth - it is important that the serial data transmission channel is provided.  In addition to simple on / off I / O commands, in one form or another, it is possible to work with the I2C bus and (in the future) with servo drives. <br><br><img src="https://habrastorage.org/files/bd3/7c1/e07/bd37c1e07a2448668764fcaaf3fbe40e.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For work, it is necessary that the Arduino board runs a special program that supports the execution of commands using the <a href="http://firmata.org/">Firmata</a> protocol.  The Windows Remote Arduino library exchanges commands with the board, providing the programmer with high-level control functions. <br><br>  Windows Remote Arduino is available for Windows 8.1 / Windows Phone 8.1 and for universal Windows 10 applications. To use them in your project, it is currently easiest to <a href="https://github.com/ms-iot/remote-wiring/">clone a Git-project repository</a> and add the necessary projects to your solution (I will describe an example below). <br><br><h3>  Example - light bulb switch </h3><br>  In my example, I will develop an intelligent application that includes a desk lamp.  For this purpose, I use the Arduino Uno board and a relay capable of switching 220V.  The relay is connected to some digital output (for example, 7).  Also, to detect the presence of a person, we will use an <a href="http://amperka.ru/product/infrared-motion-sensor">infrared presence sensor</a> , which will be included in the analog input A0.  For the convenience of switching, we use <a href="http://amperka.ru/product/arduino-troyka-shield">Troyka Shiled</a> from <a href="http://amperka.ru/">Amperki</a> .  In the video above, see more about the hardware setup, as well as the entire project in action. <br><br><h3>  Install the Firmata sketch on the Arduino board </h3><br>  The first step is to install a standard sketch on the Arduino board to execute the Firmata commands.  Such a sketch is already included in the standard delivery of the Arduino IDE - just select File -&gt; Examples -&gt; Firmata -&gt; Standard Firmata from the menu.  The sketch that opens will need to be loaded into the board in the usual way. <br><br><img src="https://habrastorage.org/files/603/5ee/b69/6035eeb69307410ea676617b8db7c39b.png"><br><br>  At this stage it will be useful to make sure that all the hardware is configured correctly.  To do this, you can use the special program <a href="">firmata_test.exe</a> (or any of the programs described <a href="http://firmata.org/wiki/Main_Page">here</a> ) - you should be able to control the light bulb by switching the state of digital output 7, as well as at input A0, you should receive a value of 0 if there is no movement around the sensor, and a large positive value (about 600 or more) otherwise <br><br><img src="https://habrastorage.org/files/8a3/f14/21d/8a3f1421d6244d1780ca9c5a0df6b137.png"><img src="https://habrastorage.org/files/626/b83/b12/626b83b12aba407a8974be84d880dd48.png"><br><br><h3>  Preparing a project with Windows Remote Ardunio </h3><br>  To use Windows Remote Arduino in your project, you need to connect the appropriate libraries.  Currently, the technology is quite young, and libraries exist in the form of source texts.  We hope that NuGet packages will appear over time, but now the process of including libraries is as follows: <br><br><ol><li>  Create a new project - in our case it will be a universal Windows 10 application. </li><li>  Clone the <a href="https://github.com/ms-iot/remote-wiring/">GitHub repository of the Windows Remote Arduino project</a> into a local folder: <br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/ms-iot/remote-wiring/</code> </pre> <br>  <strong>IMPORTANT</strong> : there are several versions of the library in the repository.  At the time of this writing, the last <strong>master</strong> branch contained many errors when working with analog and digital inputs, so I use the most stable revert-18-develop branch.  I really hope that an even more stable version will be released soon, and it will be possible to clone as shown above, without specifying a branch. </li><li>  In the resulting project tree there are folders Microsoft.Maker.Win10 and Microsoft.Maker.Win8_1.  We will use the option for Windows 10, but the project also supports universal Windows 8.1 applications. </li><li>  There are three projects in the Microsoft.Maker.Win10 folder: Microsoft.Maker.Firmata, Microsoft.Maker.Serial and Microsoft.Maker.RemoteWiring.  These three projects need to be added to the project we have created (Add Existing Project) </li><li>  The result is the following project tree: <br><img src="https://habrastorage.org/files/0d5/0f7/b9a/0d50f7b9a95b459eaf8fbab8b65f680d.png"><img src="https://habrastorage.org/files/fa6/e40/b2b/fa6e40b2b7784392a3f033ffb80a4ffe.png"><br></li><li>  In order for projects to be compiled in the correct order, you need to install the correct project dependencies.  Right-click on our project, select ‚ÄúBuild Dependencies -&gt; Project Dependencies,‚Äù and check the boxes for all three added projects.  The remaining dependencies should be already installed, but you can check them: the Firmata project depends on the Serial project, the RemoteWiring project - on the Firmata and Serial projects.  Accordingly, on the ‚ÄúAssembly Order‚Äù tab, projects should be assembled in the following order: Serial, Firmata, RemoteWiring, and our application. </li><li>  In our main project, right-click on References and add the Microsoft Visual C ++ AppLocal Runtime Package for Windows UAP extension.  There in the item ‚ÄúCommon projects‚Äù select all three added projects Windows Remote Arduino. <br><img src="https://habrastorage.org/files/542/f52/d8c/542f52d8cb184d7aabcd6dff39265bfe.png"><br></li><li>  <strong>IMPORTANT:</strong> In order for our application to use the capabilities of working with a serial port, it is necessary in the application manifest (Package.appxmanifest file) in the section <pre>  &lt;Capabilities&gt; </pre>  add the following code: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeviceCapability</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"serialcommunication"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"any"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name:serialPort"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeviceCapability</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  We are ready to create our application that will use the Windows Remote Arduino libraries!  To make sure everything works correctly, try building the resulting application. </li></ol><br><br><h3>  Create an application with Windows Remote Arduino </h3><br>  Our application will have three buttons: to turn on the light, to turn it off, and for auto-mode, in which the light will be controlled by the presence sensor.  To begin with, we will add these three buttons to the main page of the <strong>MainPage.xaml</strong> application, setting them to the inactive state: <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Horizontal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"on"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"False"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ON"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"on_Click"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"off"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"False"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OFF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"off_Click"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"False"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AUTO"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"auto_Click"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txt"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lst"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This code is added inside the Grid container that the page already has by default.  Also for each button we will create a handler function in C # (by double-clicking on each button, or through the Visual Studio properties window). <br><br>  To begin, initialize the Remote Arduino object.  To do this, in the window class in the <strong>MainPage.xaml.cs</strong> file <strong>we</strong> describe two variables: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">UsbSerial</span></span> usbcomm; <span class="hljs-attribute"><span class="hljs-attribute">RemoteDevice</span></span> arduino;</code> </pre><br>  To connect to the Arduino, we describe the connect () function, which we then call from the MainPage () constructor: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dev = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> UsbSerial.listAvailableDevicesAsync(); usbcomm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsbSerial(dev[<span class="hljs-number"><span class="hljs-number">0</span></span>]); arduino = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RemoteDevice(usbcomm); usbcomm.ConnectionEstablished += Comm_ConnectionEstablished; usbcomm.begin(<span class="hljs-number"><span class="hljs-number">57600</span></span>, SerialConfig.SERIAL_8N1); }</code> </pre><br>  Here, we first define a list of available ports where Arduino can be connected, then create a UsbSerial serial connection with this port, and then on top of this - a RemoteDevice object, which will be a virtual Arduino.  After that we call the begin function, passing the parameters of the serial connection. <br><br>  <strong>IMPORTANT:</strong> The speed of the serial channel used by the Firmata protocol is specified in the StandardFirmata sketch.  By default, it is 57600, so we select this particular speed in our application.  If the speeds do not match, the connection will not work. <br><br>  When a connection to the board is established, the Comm_ConnectionEstablished function will be called, which we describe as follows: <br><pre> <code class="hljs pgsql">private <span class="hljs-type"><span class="hljs-type">void</span></span> Comm_ConnectionEstablished() { Dispatcher.RunAsync(Windows.UI.Core.CoreDispatcherPriority.Normal,<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Windows.UI.Core.DispatchedHandler(() =&gt; { arduino.pinMode(<span class="hljs-number"><span class="hljs-number">14</span></span>, PinMode.ANALOG); arduino.pinMode(relay_pin, PinMode.OUTPUT); dt = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DispatcherTimer() { <span class="hljs-type"><span class="hljs-type">Interval</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> TimeSpan(<span class="hljs-number"><span class="hljs-number">500</span></span>) }; dt.Tick += <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>; dt.<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>.IsEnabled = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>.IsEnabled = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; auto.IsEnabled = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; })); }</code> </pre><br>  The main function code is wrapped in a call to the dispatcher that runs it in the UI thread - this is important.  Next we set the modes of the main Arduino pins used, create a timer that will call the loop () function every half-second, and also make the buttons visible. <br><br>  An interesting point - the installation of port 14 in analog mode.  The fact is that the analog inputs in the Arduino are numbered after the digital ones, and input A0 corresponds to number 14. It is necessary to set the mode to ANALOG, and not INPUT, which means digital input. <br><br>  Now to turn on / off the light bulb, it is enough to describe the function-event handlers of the buttons as follows: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { auto_mode = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; arduino.digitalWrite(relay_pin, PinState.HIGH); }</code> </pre><br>  The off_Click function is done by analogy.  Please note that familiar commands like digitalRead / digitalWrite are used to work with remote Arduino pins. <br><br>  The variable auto_mode is a variable of type bool that needs to be described in our class.  It is needed in order to handle the automatic mode.  The AUTO button will set this variable to true: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auto_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { auto_mode = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br>  Now it remains for the small - to implement the function loop, which will switch the lamp depending on the presence of a signal from the presence sensor.  This should be done only if auto_mode is set: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (auto_mode) { arduino.pinMode(<span class="hljs-number"><span class="hljs-number">14</span></span>, PinMode.ANALOG); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> = arduino.analogRead(<span class="hljs-number"><span class="hljs-number">0</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">512</span></span>; arduino.digitalWrite(relay_pin, <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> ? PinState.HIGH : PinState.LOW); } }</code> </pre><br>  <strong>IMPORTANT</strong> : For more reliable work right before reading the port, it is better to set its mode to analog again.  This should not be so, but in practice it improves stability.  Also note that we use analogRead (0), although the line previously indicated the port number 14. The port number from 0 to 5 is transmitted in analogRead, when setting the port mode, you must add 14 to these numbers. <br><br><h3>  How to connect Arduino via Bluetooth and control from a smartphone </h3><br>  In our case, we wrote a universal application that can be placed on Windows Phone 10. However, this is useless, since it is impossible to connect the Arduino board via USB to a smartphone.  However, if we use Bluetooth instead of a USB connection by connecting a <a href="https://www.sparkfun.com/products/12577">Bluetooth card</a> to the Arduino, then we will be able to control our design from the smartphone with the same application.  In this case, the following lines should be added to the application manifest to allow Bluetooth communication: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeviceCapability</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bluetooth.rfcomm"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"any"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name:serialPort"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeviceCapability</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We will not now consider using bluetooth - this is a topic for a separate article.  However, we note that from the point of view of programming there is almost no difference - you need to use the BluetoothSerial object instead of UsbSerial, and all other constructs remain unchanged. <br><br><h3>  Where to get the source code </h3><br>  The source code of my project is traditionally available on GitHub: <a href="https://github.com/evangelism/RemoteArduinoLamp/tree/v1.0-serial">https://github.com/evangelism/RemoteArduinoLamp/tree/v1.0-serial</a> .  Please take it, experiment, if you find mistakes - make pull requests. <br><br><h3>  findings </h3><br>  Windows Remote Arduino is a rather young and raw technology, but now it can simplify the solution of a number of tasks in which you need to directly control the inputs / outputs of the Arduino connected to the computer.  Of course, all the same can be programmed by hand, writing your sketch and using a serial channel to interact with it, but why not use the ready-made developments and established standards (Firmata) in order not to reinvent the wheel. <br><br>  I hope you will use Windows Remote Arduino in your projects, and if you do something interesting, I will be pleased to know about it!  Write in the comments, <a href="http://twitter.com/shwars">twitter</a> or <a href="http://vk.com/shwars">vkontakte</a> ! </div><p>Source: <a href="https://habr.com/ru/post/262419/">https://habr.com/ru/post/262419/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262407/index.html">Entity Framework 6 (7) vs NHibernate 4: a DDD perspective</a></li>
<li><a href="../262409/index.html">Introduction to Octopus Deploy</a></li>
<li><a href="../262411/index.html">Fundamentals of successful implementation of push notifications for mobile applications</a></li>
<li><a href="../262413/index.html">What do anti-virus protection profiles provide?</a></li>
<li><a href="../262415/index.html">Objective C Class Organization</a></li>
<li><a href="../262423/index.html">Simulation and analysis of computational processes</a></li>
<li><a href="../262427/index.html">Truly responsive letters. Part ... first again</a></li>
<li><a href="../262429/index.html">Condition as a compromise</a></li>
<li><a href="../262431/index.html">Real-time data processing in AWS Cloud. Part 2</a></li>
<li><a href="../262433/index.html">IDA Pro Upgrade. Debugger plugin. Part I. Theory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>