<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New HTTPS Interception Detection Tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As the use of HTTPS grows, there is a growing desire for outsiders to infiltrate secure traffic. A 2017 study by The Security Impact of HTTPS Intercep...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New HTTPS Interception Detection Tools</h1><div class="post__text post__text-html js-mediator-article"> <a href=""><img src="https://habrastorage.org/webt/fo/qw/00/foqw00u6rxe1pz2sawwacn1c6ao.png"></a> <br><br>  As the use of HTTPS grows, there is a growing desire for outsiders to infiltrate secure traffic.  A 2017 study by <a href="https://jhalderm.com/pub/papers/interception-ndss17.pdf"><i>The Security Impact of HTTPS Interception has</i></a> shown that this is becoming an increasingly common practice.  An analysis of the traffic on the Firefox update servers showed that in some countries the percentage of introducing extraneous agents in HTTPS reaches 15%. <br><br>  Since the study, the situation is unlikely to have improved.  Now even the latest model of Sennheiser wireless headphones <a href="https-on-pcs-and-macs/">requires installing a root certificate in the system</a> (with insecure parameters). <br><a name="habracut"></a><br>  Most often, the protection is compromised by the antivirus or the corporate middlebox (see the list below), but it can be worse.  In any case, it's best to know for sure when your HTTPS channel is not really end-to-end secure.  Even when a third-party system intercepts traffic from the best intentions, it often does not support modern ciphers or does not validate certificates, thus reducing the overall protection of the connection.  But intercept SSL-traffic can not only for good purposes, but also malicious, for example, for censorship at the state level. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      HTTPS monitoring programs work as transparent proxies that terminate the TLS session, inspect the content, and then establish a new session with the destination server.  They use different versions of TLS libraries than popular browsers, which allows them to be detected on the server side due to the mismatch between the HTTP User-Agent and the TLS Client Hello of the real browser and proxy. <br><br>  To begin with, we present some practical conclusions from a 2017 study in which Mozilla, Google, GlobalSign participated, as well as academic researchers from the University of Michigan, the University of Illinois at Urbana-Champaign and the University of California at Berkeley. <br><br>  <a href="https://www.us-cert.gov/ncas/alerts/TA17-075A">The practical harm of HTTPS interception</a> is the degradation of encryption and the additional vulnerabilities of the transparent proxy.  The authors of the study rated a number of popular middleboxes by these parameters.  As we see, in 2017, almost half of them did not support modern cipher suites, and five registered serious vulnerabilities.  Only 1 out of 12 was able to fully mirror all user cipher suites. <br><br> <a href=""><img src="https://habrastorage.org/webt/lb/na/sw/lbnasw0tvhmtkxl3sf09liqlhpe.png"></a> <br><br>  Antivirus activity on users' computers is also usually detected on the server side.  The study showed that only two antiviruses completely mirror user ciphers; in other cases, encryption is degraded. <br><br> <a href=""><img src="https://habrastorage.org/webt/kl/xb/xl/klxbxlkefin0ubouor2j7mxl24g.png"></a> <br><br>  By protecting against some threats, antiviruses reduce encryption and add their own vulnerabilities.  In general, installing third-party anti-virus often significantly impairs the overall security of the system.  Some experts advise users to <a href="https://habr.com/ru/post/401059/">always remove third-party antiviruses from the system</a> , because their invasive and poorly written code makes it difficult for browsers and other programs to ensure their own security. <br><br>  Other transparent proxies can work on the path between the client and the server.  To better detect these agents, Cloudflare recently released two new tools: <br><br><ol><li>  <a href="https://github.com/cloudflare/mitmengine">MITMEngine</a> , a free library for determining HTTPS interception. </li><li>  <a href="https://malcolm.cloudflare.com/">MALCOLM</a> , dashboard for displaying HTTPS intercept metrics on the Cloudflare network. </li></ol><br>  The main interest is the library MITMEngine.  Developers <a href="https://blog.cloudflare.com/monsters-in-the-middleboxes/">write</a> that they took as an example the popular <a href="https://caddyserver.com/docs/mitm-detection">Caddy Server MITM Detection</a> tool.  It supports a set of popular browsers and recognizes HTTPS interception using specific fingerprints of TLS Client Hello and User Agent messages, as described above. <br><br>  The developers have tried to provide extensibility, simplifying the future of adding new versions of browsers to the detector, as well as improved performance and expanded detector functionality, compared to Caddy Server MITM Detection.  It analyzes the following TLS Client Hello parameters by comparing real data with fingerprints of known browsers: <br><br><ul><li>  TLS version; </li><li>  cipher suites; </li><li>  extensions and their meanings; </li><li>  supported groups of elliptic curves; </li><li>  formats of points of an elliptic curve. </li></ul><br>  In fact, MITMEngine performs partial fingerprinting of a user without de-anonymizing it, but with a reliable determination that the connection is established by a real browser, and not by an intermediary. <br><br><h4>  Work example </h4><br>  Suppose MITMEngine sees the following User Agent from the user: <br><br> <code>Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) <br> Chrome/47.0.2526.111 Safari/537.36</code> <br> <br>  This User Agent corresponds to Chrome 47 for Windows 7. It is accompanied by a TLS Client Hello message that indicates the following cipher suites in hex: <br><br> <code>0000 c0 2b c0 2f 00 9e c0 0a c0 14 00 39 c0 09 c0 13 .+./.... ...9.... <br> 0010 00 33 00 9c 00 35 00 2f 00 0a .3...5./ ..</code> <br> <br>  This message corresponds to these cipher suites: <br><br> <code>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 (0xc02b) <br> TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f) <br> TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 (0x009e) <br> TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA (0xc00a) <br> TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (0xc014) <br> TLS_DHE_RSA_WITH_AES_256_CBC_SHA (0x0039) <br> TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA (0xc009) <br> TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA (0xc013) <br> TLS_DHE_RSA_WITH_AES_128_CBC_SHA (0x0033) <br> TLS_RSA_WITH_AES_128_GCM_SHA256 (0x009c) <br> TLS_RSA_WITH_AES_256_CBC_SHA (0x0035) <br> TLS_RSA_WITH_AES_128_CBC_SHA (0x002f) <br> TLS_RSA_WITH_3DES_EDE_CBC_SHA (0x000a)</code> <br> <br>  The default cipher suites for Chrome 47 are as follows: <br><br> <code>0000 c0 2b c0 2f 00 9e cc 14 cc 13 c0 0a c0 14 00 39 .+./.... .......9 <br> 0010 c0 09 c0 13 00 33 00 9c 00 35 00 2f 00 0a .....3.. .5./..</code> <br> <br>  If you look closely, you can see: in real traffic, the cipher list is slightly shorter than it should be in a real browser.  Although the others are arranged in the same order, but two sets are missing: <br><br> <code>TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 (0xcc14) <br> TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 (0xcc13)</code> <br> <br>  It can be assumed that the traffic from the user's browser passes through a transparent proxy, which does not support the ChaCha ciphers.  This reduces the security of the user, because the list of AES-CBC cipher suites that follow ChaCha <a href="https://blog.cloudflare.com/padding-oracles-and-the-decline-of-cbc-mode-ciphersuites/">are vulnerable</a> to padding oracle attacks. <br><br>  In some cases, MITMEngine even allows you to determine which program causes the degradation of an HTTPS connection (in the example above, this is Sophos antivirus).  The server may alert the user about this threat. <br><br><hr><br> <a href="https://clck.ru/EhoeK"><img src="https://habrastorage.org/webt/1z/ee/y0/1zeey0n_oamytquvhui2rpjuyzu.jpeg"></a> </div><p>Source: <a href="https://habr.com/ru/post/444496/">https://habr.com/ru/post/444496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444480/index.html">How to reduce the weight of an element of aircraft design by a third</a></li>
<li><a href="../444482/index.html">What does memory expand in Ruby?</a></li>
<li><a href="../444486/index.html">The SIRIUS-19 project is a four-month imitation of an expedition to the moon in a ground complex in Moscow</a></li>
<li><a href="../444488/index.html">Matrix Powerwatch inside and out: what's new?</a></li>
<li><a href="../444494/index.html">La Moto Volante (Lazareth LMV 496) - flying transforming motorcycle</a></li>
<li><a href="../444500/index.html">March 29, Moscow - Backend Stories 3.0</a></li>
<li><a href="../444502/index.html">Is quantum cryptography reliable?</a></li>
<li><a href="../444504/index.html">Using the local package directory in Python now</a></li>
<li><a href="../444508/index.html">How we made PHP 7 twice as fast as PHP 5</a></li>
<li><a href="../444514/index.html">Webinar "Machine Learning Security: Natural Problems of Artificial Intelligence"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>