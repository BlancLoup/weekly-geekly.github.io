<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Last-Modified Heading, Symfony and Search Indexing Acceleration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing websites, many developers forget about the very useful Last-Modified header, thanks to which you can optimize the loading of web-pages...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Last-Modified Heading, Symfony and Search Indexing Acceleration</h1><div class="post__text post__text-html js-mediator-article">  When developing websites, many developers forget about the very useful Last-Modified header, thanks to which you can optimize the loading of web-pages and facilitate the work of search robots.  Next, I will try to fill this annoying gap. <br><a name="habracut"></a><br><br><h4>  What is the Last-Modified header for? </h4><br>  The title function as you can guess from the name is informing the client about the date of the last modification of the web document.  Based on the rfc 2616 specification, the client can ‚Äúask‚Äù the web server if the page has not changed from a certain number by sending the ‚ÄúIf-Modified-Since‚Äù header to the server.  If the page has not changed, the server only returns the ‚Äú304 Not Modified‚Äù header; otherwise, the server returns the ‚Äú200 OK‚Äù header and the body of the page.  As you can see, the benefit is obvious both for the server and for the client: the browser will not load the page again and again, and the web server will give less data. <br><br><img src="https://habrastorage.org/storage/6d236b96/7314382d/3827d962/e4ba6779.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Which sites are indexed better?  Dynamic or static? </h4><br>  A couple of years ago, there were controversies among SEO people about which sites are indexed better?  Dynamic, written for example in php, or static, without the use of programming languages.  Knowing the title of Last-Modified, you can answer this question.  The thing is that the web server itself processes the ‚ÄúIf-Modified-Since‚Äù header if the file is static.  In the case of dynamic page generation, all responsibility for the answer lies with the programming language and developer.  And since the developer is often not interested in this issue, the headers are not given at all. <br><br><h4>  How does the Last-Modified header speed up search indexing? </h4><br>  Everything is simple, as written <a href="http://help.yandex.ru/webmaster/%3Fid%3D995332">in the help of Yandex</a> , ‚Äúthe robot will not be able to get information about whether the site page has been updated since the last indexing.  And since the number of pages received by the robot from the site in one go is limited, the changed pages will be reindexed less often. ‚Äù <br><br>  Imagine.  There is a site with 10 thousand pages.  The site is written in php.  Correct Last-Modified header is not given.  The search robot cannot get information on whether the site page has been updated since the last indexing.  What is he doing?  Indexes all pages !!!  And not just those that have changed. <br>  Of course!  Many sites use a <a href="http://help.yandex.ru/webmaster/%3Fid%3D1007070">sitemap</a> .  But Sitemap is a recommendation, help search engine optimizer.  Replacing the Last-Modified header, it can not be! <br><br><h4>  Setup and processing of the Last-Modified header in php </h4><br>  In order for the web server to transmit the If-Modified-Since header to the php-backend, it needs to inform it from it! <br><br>  <b>For the nginx + php bundle,</b> <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">location ~ \.php$ <br> { <br> ‚Ä¶ <br> if_modified_since off; <br> <br> fastcgi_pass  fcgi; <br> fastcgi_index index.php; <br> fastcgi_param SCRIPT_FILENAME /&lt; &gt; /web$fastcgi_script_name; <br> ‚Ä¶ <br> fastcgi_pass_header Last-Modified; <br> include fastcgi_params; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <b>For a bunch of apache + php, so</b> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"># If-Modified-Since ( <font color="#0000ff">if</font> php <font color="#0000ff">is</font> not installed <font color="#0000ff">as</font> cgi then comment lines below) <br> RewriteRule .* - [E=HTTP_IF_MODIFIED_SINCE:%{HTTP:If-Modified-Since}] <br> RewriteRule .* - [E=HTTP_IF_NONE_MATCH:%{HTTP:If-None-Match}]</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  If php works as a module, then nothing needs to be set up! <br><br>  <b>A simple php-code processing request for If-Modified-Since,</b> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$qtime = isset($_SERVER[ <font color="#A31515">'HTTP_IF_MODIFIED_SINCE'</font> ])? $_SERVER[ <font color="#A31515">'HTTP_IF_MODIFIED_SINCE'</font> ]: <font color="#A31515">''</font> ; <br> <br> $modified = substr(gmdate( <font color="#A31515">'r'</font> , $timestamp), 0, -5). <font color="#A31515">'GMT'</font> ; <br> <br> <font color="#0000ff">if</font> ($hdr == $modified) <br> { <br> header ( <font color="#A31515">"HTTP/1.1 304 Not Modified "</font> ); <br> header ( <font color="#A31515">"Last-Modified: $modified"</font> ); <br> exit(); <br> } <br> header ( <font color="#A31515">"Last-Modified: $modified"</font> ); <br> //render</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h4>  How to handle an If-Modified-Since request in symfony? </h4><br>  Symfony already has a header handling mechanism.  All the developer needs is to pass a header to the sfWebResponse object.  If it is specified, the framework will do everything by itself. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$datestamp = time(); <br> $response-&gt;setHttpHeader( <font color="#A31515">'Last-Modified'</font> , $response-&gt;getDate($datestamp));</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Since the page is usually located different content, I wrote a method that exposes the latest of the transferred titles! <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">public</font> function setLastModified($datestamp) <br> { <br> $response = sfContext::getInstance()-&gt;getResponse(); <br> $request = sfContext::getInstance()-&gt;getRequest(); <br> <br> <font color="#0000ff">if</font> (is_array($datestamp)) <br> { <br> rsort($datestamp, SORT_NUMERIC); <br> $datestamp = $datestamp[0]; <br> } <br> <br> <font color="#0000ff">if</font> (!$response-&gt;hasHttpHeader( <font color="#A31515">'Last-Modified'</font> )) <br> { <br> $response-&gt;setHttpHeader( <font color="#A31515">'Last-Modified'</font> , $response-&gt;getDate($datestamp)); <br> } <br> <font color="#0000ff">else</font> <br> { <br> $origLastModified = strtotime($response-&gt;getHttpHeader( <font color="#A31515">'Last-Modified'</font> )); <br> <font color="#0000ff">if</font> ($origLastModified &lt; $datestamp) <br> $response-&gt;setHttpHeader( <font color="#A31515">'Last-Modified'</font> , $response-&gt;getDate($datestamp)); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  It is very convenient to use it if on the page, for example, there are 3 last videos, 3 last articles and there is something else.  By loading each model from the database, we can call the method, and as a result we get the latest modification date in the response. <br>  For those interested, the header processing code is in the sfCacheFilter.class.php class. <br><br>  In conclusion, I want to say that the use of the Last-Modified header is not always justified.  For example, if the site has 5,000 pages and each has the same block with frequently changing content, using the title will be useless!  In this case, you can only give different headers for customers and search robots.  But as for me, deception of robots does not lead to anything good.  Well, or remove this block;). <br><br>  Still, <br><br>  Check the site for correct processing of the title <a href="http://www.feedthebot.com/tools/if-modified/">here</a> or so, <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;?php <br> $ch = curl_init(); <br> <br> $url = <font color="#A31515">'http://site.ru/1.php '</font> ; <br> <br> curl_setopt($ch, CURLOPT_URL, $url); <br> curl_setopt($ch, CURLOPT_HEADER, <font color="#0000ff">true</font> ); <br> curl_setopt($ch, CURLOPT_NOBODY, <font color="#0000ff">true</font> ); <br> curl_setopt($ch, CURLOPT_HTTPHEADER, array( <br> <font color="#A31515">'If-Modified-Since: Sun, 28 Nov 2010 15:45:53 GMT'</font> <br> )); <br> <br> ob_start(); <br> curl_exec ($ch); <br> curl_close ($ch); <br> $data = ob_get_contents(); <br> ob_end_clean(); <br> <br> <br> echo nl2br($data); <br> ?&gt; <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> </div><p>Source: <a href="https://habr.com/ru/post/109043/">https://habr.com/ru/post/109043/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109035/index.html">Check Creative Commons on the Civil Code of the Russian Federation</a></li>
<li><a href="../109036/index.html">Firmware update for Russian Samsung Galaxy S version 2.2 (Froyo) has been released</a></li>
<li><a href="../109037/index.html">OpenStreetMap website launches new fully rewritten editor Potlatch 2</a></li>
<li><a href="../109039/index.html">HTC Desire HD Android Review: The Hungry Giant</a></li>
<li><a href="../109041/index.html">Code Interface Driven Design</a></li>
<li><a href="../109044/index.html">Google Earth 6</a></li>
<li><a href="../109045/index.html">Free Clouds from Amazon + Ruby on Rails. First impressions</a></li>
<li><a href="../109046/index.html">Firebug 1.6 release</a></li>
<li><a href="../109049/index.html">#poSEEDelki in December: ideas, motivation, investment</a></li>
<li><a href="../109050/index.html">Increased performance with block caching</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>