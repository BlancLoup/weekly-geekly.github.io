<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Problems with the form and content of the list of sites Roskomnadzor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© already there were several articles about the difficulties associated with obtaining access to the list of prohibited sites, with its updatin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Problems with the form and content of the list of sites Roskomnadzor</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© already there were <a href="http://habrahabr.ru/post/158891/">several</a> <a href="http://habrahabr.ru/post/164329/">articles</a> about the difficulties associated with obtaining access to the list of prohibited sites, with its updating and use.  This article is a logical continuation of the criticism previously expressed by others (including in the comments).  Immediately make a reservation that I am not an employee of any provider. <br><br>  So, suppose that you are going to provide your customers with Internet access services, or, more simply, to become a provider.  In order to achieve customer loyalty, you decided to buy a sophisticated DPI-system, block forbidden information by URLs and not block anything superfluous.  No filtering by domain and IP, only by URLs!  All legal, bureaucratic, ethical and monetary issues are settled, technical issues remain.  It remains only to take a ready-made automatic rocking of the list of prohibited sites and configure the automatic download of this list to the DPI-system in the format that it understands.  Those.  write a script converter.  So, I have to disappoint you - write a working converter will not work.  It will not work until Roskomnadzor does not move and change the data format, and also does not correct obvious errors in the existing elements of the list. <br><a name="habracut"></a><br>  To begin with, in what format Roskomnadzor gives the list of prohibited information.  This is the XML corresponding to the XSD scheme published as part of the <a href="http://www.zapret-info.gov.ru/docs/description_for_operators_2012-11-09v1.4.pdf">Memo to the carrier</a> .  Or, to put it more simply, XML containing a sequence of blocks like the following: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">content</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"105"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">includeTime</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2012-11-11T15:39:37"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">decision</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">date</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2012-11-04"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">number</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2/1/16402"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">org</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://go-****.com/workshop/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag">&gt;</span></span>go-****.com<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span>62.75.***.***<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">content</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this case, according to the scheme, &lt;url&gt; tags can be from zero to infinity, followed by zero or one &lt;domain&gt; tag, and then from one to infinity &lt;ip&gt; tags.  We are obviously interested in &lt;url&gt; tags.  So, like, you just need to close access to the listed list of URLs. <br><br>  And now let's see what means similar tasks were solved earlier and what clever words were said. <br><br>  Access to URLs on servers must be closed not only from people, but also from robots.  To do this, use the /robots.txt file with the <a href="http://www.robotstxt.org/norobots-rfc.txt">documented</a> syntax.  No less important, the <strong>semantics</strong> is described in detail in the same document, i.e.  the exact rules for interpreting each record to decide whether the robot can visit any URL: <br><br><blockquote>  The matching process compares every octet in the path portion of <br>  the URL and the path from the record.  If a% xx encoded octet is <br>  encountered it is unencoded prior to comparison, unless it is the <br>  "/" character, which has special meaning in a path.  The match <br>  if you want <br>  Record is reached. <br></blockquote><br><br>  That is, for the entry to work, the path in the robots.txt entry must be <strong>the</strong> path <strong>prefix</strong> in the URL.  There are simply no corresponding rules on the Roskomnadzor website, and this, from my point of view, is a bug.  Maybe try to write these rules for them?  And it seems that filtering by prefix, and not by exact URL match, is more appropriate in the case of content blocking from people.  Roskomnadzor will not list all the URLs of the site that should be blocked entirely! <br><br>  Another standard for robots.txt is the <a href="http://help.yandex.ru/webmaster/%3Fid%3D996567">Clean-Param</a> extension.  It indicates which <strong>GET parameters</strong> are <strong>insignificant</strong> , i.e.  should not be considered when comparing URLs.  The very notion of the importance of parameters is important - this is in fact bad if the user can bypass the lock by adding unblock_me = 1 &amp; after the question mark in the URL.  Only in the case of blocking content from people, it would be more correct to talk about meaningful parameters and that the order of these parameters really does not matter. <br><br>  In total, this speculative scheme emerges plausible interpretation of the meaning of URLs in the registry of banned sites: <br><br><ul><li>  Before applying the following steps, both the URL in the registry and the URL addressed by the user must be normalized by replacing the% xx encoded octets with decoded octets, with the exception of the ‚Äú/‚Äù symbol. </li><li>  If the URL list in the list of forbidden sites does not contain the "?" Character, then in order for the blocking to work, the URL in the registry must be a prefix of the URL the user has accessed. </li><li>  If in the list of prohibited sites the URL contains the character "?", Then in order for the blocking to work, the URL in the registry and the URL that the user has accessed should match character by character up to the first "?"  inclusive.  The set of GET parameters in the URL from the registry must be a subset of the set of GET parameters from the user URL.  GET parameters are considered to be separated by the symbol "&amp;". </li></ul><br><br>  Only this scheme is still incomplete.  Do I need to make a case-sensitive comparison?  How exactly is case sensitive - because we only have bytes in an unknown encoding? <br><br>  And most importantly - the existing data in the registry under this scheme is not suitable.  What are just such records here: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://*******tube.ru/index.php<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://********.kiev.ua/index.php<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://***forum.org/index.php?s=3a95f6da301a36067be68329be6f88a8&amp;showforum=8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://****lib.net/b/27415/read#t16<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In the first two cases, I, as a reader of thoughts, obviously intend to block the site entirely, instead of which only URLs are blocked whose path starts with /index.php.  In the third parameter, s is similar to a non-significant session identifier.  In the fourth, there is a hash tag.  In general, the source data is too dirty for the circuit to work. <br><br>  And even if it worked, I would not use this scheme.  When writing it, I made too many <strong>attempts to guess something</strong> , and all this strongly resembles an attempt to write another <a href="http://lurkmore.to/Libastral">libastral</a> clone.  When interpreting laws, such actions are unacceptable. <br><br>  So, if someone tries to sell you a filtering system by URLs based on official data from zapret-info.gov.ru, do not believe it - this is definitely a divorce.  Until Roskomnadzor makes its data truly machine-readable and unambiguously interpretable, such solutions simply cannot work.  To this day, the &lt;url&gt; tag in the XML dump of the registry is only suitable as background information to check the validity of including the site in the registry.  What we really need are not URLs, but filtering rules. <br><br>  Now let's talk about what Roskomnadzor could do to correct the situation when people talk about the fundamental possibility of URL filtering on its lists, but in reality there is no such possibility. <br><br>  The easiest (and, in my opinion, the most correct) way is to leave everything as it is, but to publicly admit that information in the registry of prohibited sites is unsuitable and may not be suitable for filtering by URLs.  Leave the &lt;url&gt; tag - as already mentioned, it is useful for checking locking decisions and thus ensuring the transparency of the process. <br><br>  The more complicated way is to write the rules for interpreting the contents of the &lt;url&gt; tag (as I tried to do above) and adjust the existing contents of the database to them. <br><br>  Another way is to remake the XML structure.  Instead of a single &lt;url&gt; tag, make a structure that can store a prefix, required parameters, and possibly other information that can describe a group of related URLs.  Then it can be turned into a regular expression for <a href="http://www.squid-cache.org/Doc/config/acl/">‚Äúacl aclname url_regex‚Äù in SQUID</a> or glob for <a href="http://www.cisco.com/en/US/docs/ios/qos/command/reference/qos_m1.html">‚Äúmatch protocol http url‚Äù in Cisco NBAR</a> . <br><br>  And this is why I consider the first method to be the most correct.  It seems that Roskomnadzor has implemented such a scheme of work: a complaint with a URL of illegal content comes in, moderators check it and enter the same URL into the database.  In this process, there is no place for converting the complained URL to machine-readable filtering rules.  And if you try to make this (essentially manual) step, then you need to look for people who can perform it.  This is also necessary to explain the performers that the machine can not read minds.  It is also necessary to find people who are psychologically stable, and are able to put themselves in the place of the car and check whether the rule really works as it should.  Difficult task for the personnel department!  Well, if you leave the &lt;url&gt; tag purely informational and explicitly say this, then the providers will not have a desire to spend money on a sophisticated DPI-system, which in fact will not be able to be used for its intended purpose. </div><p>Source: <a href="https://habr.com/ru/post/164859/">https://habr.com/ru/post/164859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164845/index.html">The fan-cybersquatter will give the player a name domain if he fulfills his wish</a></li>
<li><a href="../164851/index.html">Calling an Alertdialog from a widget</a></li>
<li><a href="../164853/index.html">Programming for Android for beginners. Part 1</a></li>
<li><a href="../164855/index.html">Are they encrypted? We take out baytkod from JVM</a></li>
<li><a href="../164857/index.html">Building a torus with WPF</a></li>
<li><a href="../164865/index.html">Creating an encrypted USB flash drive with Linux OS</a></li>
<li><a href="../164867/index.html">Development of power supply for energy-intensive portable device</a></li>
<li><a href="../164869/index.html">How to make friends Django and Sphinx?</a></li>
<li><a href="../164871/index.html">AWS mobile management application</a></li>
<li><a href="../164873/index.html">Creating a resilient gateway based on Mikrotik RouterOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>