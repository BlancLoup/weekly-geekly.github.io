<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LOTSMAN: We write our WorkFlow configurator. Start</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I work in an organization that began to introduce software from ASCON, to be precise, the ‚ÄúASCON 2013 Solution Complex‚Äù (hereinafter re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LOTSMAN: We write our WorkFlow configurator. Start</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  I work in an organization that began to introduce software from ASCON, to be precise, the ‚ÄúASCON 2013 Solution Complex‚Äù (hereinafter referred to as the ‚ÄúComplex‚Äù) + COMPAS.  I am in charge of administering this ‚ÄúComplex‚Äù.  The ‚Äúcomplex‚Äù has a three-tier architecture (Client-Server, Application-Database Server).  The key product of the "Complex" is LOTSMAN: PLM, there is also a set of administration utilities.  One of the administration utilities is called ‚ÄúLOTSMAN WorkFlow Configurator‚Äù (hereinafter referred to as WF configurator). <br><br><img src="https://habrastorage.org/files/807/cc9/f8b/807cc9f8b3b244ceb004e71bf484c22e.png" alt="image"><br>  <i>Figure 1 - LOTSMAN WorkFlow Configurator</i> <br><br>  During the work, the main disadvantages of the WF configurator were identified: <br><ul><li>  There is no Russian-language search by full name, there is only by login (and only in the form of domain \ login, by the way in the ‚ÄúControl Center for the Complex‚Äù, where users are added to the system, there is no search at all ...); </li><li>  With a large number of users (&gt; 1K), it became terribly slow (about 4 minutes for the operation of adding a user). </li></ul><br>  Since users had to add often and a lot, I had to figure out how to optimize this process. <br><a name="habracut"></a><br>  The WF configurator has a lot of functionality, but for now I‚Äôm only interested in adding users. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To eliminate the estimated delays, I decided to work directly with the database, bypassing the "Application Server".  After the analysis (I had to manually look at the contents of the tables), several tables (wfActors, wfDepartments, wfRoles, wfUserRoles) were identified, in which the necessary data are stored.  As a result, the procedure of adding a user to a post has been reduced to the fact that you need to add an entry to just 1 table (wfUserRoles), which contains entries of the form (inIdUser, inIdRole, dtStart, dtEnd): <br><br><ol><li>  inIdUser - user id; </li><li>  inIdRole- role id (position); </li><li>  dtStart - start date; </li><li>  dtEnd is the end date. </li></ol><br>  If the fields for the start / end date are NULL, it means that the user‚Äôs term in office is unlimited. <br><br>  The action algorithm is as follows: <br><br><ol><li> We find the user id <code>select * from wfActors where stDescription like '%' order by stDescription</code> , the result is a table with user id fields, a Russian username.  Remember the user id; </li><li>  We find which unit to add the user to <code>select * from wfDepartments</code> , the result is a table with the fields of the id-division, the name of the division, the id-parent of the division.  We remember id-divisions; </li><li>  We find a position in the required subdivision <code>select * from wfRoles where inIdDepartment = id-( . )</code> , the result is a table with the fields id-positions, id-subdivisions, the name of the position, remember id-positions. </li><li>  now we have user id and position id (in the required subdivision), all that remains is to add an entry to the <code>insert into wfUserRoles values (id-, id-,null,null).</code> table <code>insert into wfUserRoles values (id-, id-,null,null).</code> <br></li></ol><br>  Even executing these SQL queries in Managment Studio, the user was added faster than through the WF configurator.  Then a script was written in Python that performed all these actions in the console. <br><br>  The next step is to develop a GUI for this script, after analyzing which of the GUI libraries there are for Python I chose PySide. <br><br>  The following was installed on the home computer: <br><br>  1) Installed in the virtual: <br><br><ul><li>  Windows Server 2008 R2; </li><li>  MSSQL Server 2008 R2; </li><li>  "Complex" ASCON 2013. </li></ul><br>  2) Installed on the computer: <br><br><ul><li>  Python 3.4.1; </li><li>  pypyodbc module; </li><li>  Pyside module. </li></ul><br>  Once everything is installed, you can begin to develop. <br><br>  I painted an application form in QT Designer, saved it in a file with the .ui extension. <br><br>  PySide has a great tool, pyside-uic.exe, with which you can create a .py file from a ui file.  To do this, it is sufficient to execute the following command in the console: <code>pyside-uic.exe file.ui -o file.py</code>  If you also specify the <code>-x</code> argument, then this file.py can be immediately launched and the form drawn in Designer will be displayed.  I found out about this parameter (-x) a little later, when I already used the instructions from <a href="http://zetcode.com/gui/pysidetutorial/">zetcode.com/gui/pysidetutorial</a> , so my code is slightly different from that generated using <code>pyside-uic.exe file.ui -x -o file.py</code> . <br><br>  Here is the shape I got: <br><br><img src="https://habrastorage.org/files/248/d17/239/248d17239da14f50920e038bea368e86.png" alt="image"><br>  <i>Figure 2 - My WorkFlow Configurator</i> <br><br>  Used pypyodbc library to work with the database, PySide to work with the form. <br><br>  It turned out 3 files: <br><br><ol><li>  GUI drawing and event binding from the form to various functions; </li><li>  class to work with the database </li><li>  just a text file from which the initial settings for the form are loaded (and saved on exit) </li></ol><br>  To add a user to a post, you must first connect the ‚ÄúConnect‚Äù button to the database (the login and password are currently registered directly in the program code), the ‚ÄúOrganization Structure‚Äù tree appears, you can expand the elements if they have nested (1 click) and go to the selected element (double click), then select the position.  Find a user by last name (‚ÄúSearch‚Äù button), select the found user and click the ‚ÄúINSERT‚Äù button (the position in the tree should be selected and the user should be selected in the search results field). <br><br>  An interesting point was the construction of the tree, until this moment I did not come across this.  I want to write something easier, but for now I‚Äôm forming a list of elements. <br><br><pre> <code class="python hljs"> treeItems=[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> l <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sorted(list1): parent=str(l[<span class="hljs-number"><span class="hljs-number">2</span></span>]) itemId=str(l[<span class="hljs-number"><span class="hljs-number">0</span></span>]) descr=str(l[<span class="hljs-number"><span class="hljs-number">1</span></span>]) treeItem=QtGui.QTreeWidgetItem([descr,itemId,parent]) treeItems.append(treeItem) treeItemsFin=[] i=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> treeItems: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> itemj <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> treeItems[i:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item.text(<span class="hljs-number"><span class="hljs-number">1</span></span>)==itemj.text(<span class="hljs-number"><span class="hljs-number">2</span></span>): item.insertChild(<span class="hljs-number"><span class="hljs-number">0</span></span>,itemj) i+=<span class="hljs-number"><span class="hljs-number">1</span></span> treeItemsFin.append(item) self.treeWid.insertTopLevelItems(<span class="hljs-number"><span class="hljs-number">0</span></span>,treeItemsFin)</code> </pre><br><br>  First, from a normal list (with items of the form: [id-item, description, parent-id]), form a list of objects of type QTreeWidgetItem (first cycle), and then from this list form another list of items, such as QTreeWidgetItem, but with a nesting. <br><br>  So far I have intentionally refused to display already added users, because it seems to me that this is the problem with the ASCON WF configurator, they have the entire tree updated after each operation and it takes a lot of time. <br><br>  In the future, I plan to make the display of users only in the selected branch. <br><br>  So far, only I use this application, but perhaps other administrators will come in handy ... The application requires Python, PySide, pypyodbc installed on the administrator‚Äôs computer, unlike the WF configurator and ASCON, is cross-platform. <br><br><h5>  Results </h5><br>  Of the benefits, the main objectives are affected: <br>  + Russian search by users; <br>  + quick work time. <br><br>  Minuses: <br>  - posts are not displayed if they are in the root of the tree (i.e., in none of the divisions, I plan to finalize); <br>  - already added users are not displayed in the tree (I plan to modify it); <br>  - there is no functionality to create / delete a unit, position (I plan to finalize); <br>  - there is no functionality for business processes, automatic operations, etc., which is in the ASCON WF configurator (I do not plan to add it in the near future, as I use it not so often and it seems to work fine). <br><br>  That's all for now, the source code on <a href="https://github.com/be1ay/WF_Configurator">github.com</a> . <br><br><h4>  List of used sources </h4><br>  <a href="http://zetcode.com/gui/pysidetutorial/">zetcode.com/gui/pysidetutorial</a> <br>  <a href="https://deptinfo-ensip.univ-poitiers.fr/ENS/pyside-docs/index.html">deptinfo-ensip.univ-poitiers.fr/ENS/pyside-docs/index.html</a> <br>  <a href="http://www.pythoncentral.io/pyside-pyqt-tutorial-using-built-in-signals-and-slots/">www.pythoncentral.io/pyside-pyqt-tutorial-using-built-in-signals-and-slots</a> </div><p>Source: <a href="https://habr.com/ru/post/238813/">https://habr.com/ru/post/238813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238801/index.html">Media Center with IPTV from laptop and monitor</a></li>
<li><a href="../238803/index.html">The company is planned to introduce SED? 10 recommendations to an IT specialist</a></li>
<li><a href="../238805/index.html">When a programmer has nothing to do, he writes a Gopher-server</a></li>
<li><a href="../238807/index.html">What will happen to the law on the prohibition of the storage of personal data of Russians abroad</a></li>
<li><a href="../238809/index.html">20 ways to scam when buying an iPhone</a></li>
<li><a href="../238815/index.html">Windows 10 from Microsoft, new Google requirements for device manufacturers, new mobile advertising opportunities - and other news of the week for mobile developers</a></li>
<li><a href="../238817/index.html">Lenovo Yoga 13 + Comodo Firewall ‚â† <3</a></li>
<li><a href="../238819/index.html">Asterisk Callback, or how to make cheap calls</a></li>
<li><a href="../238821/index.html">A word about DSP Builder</a></li>
<li><a href="../238823/index.html">How to withdraw Yandex-money to a free card of Sberbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>