<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>React.js: build an isomorphic / universal application from scratch. Part 2: add bootstrap, pages and routing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Developing an isomorphic application through the eyes of my wife 


 This is a continuation of an article about developing an isomorphic application f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>React.js: build an isomorphic / universal application from scratch. Part 2: add bootstrap, pages and routing</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4da/094/bdd/4da094bdddfe4d758b870f5f7fb5f204.png"><br><p>  <em>Developing an isomorphic application through the eyes of my wife</em> </p><br><p>  This is a continuation of an article about <a href="https://habrahabr.ru/post/309958/">developing an isomorphic application from scratch to React.js</a> .  In this part we will add some pages, <em>bootstrap</em> , routing, the concept of <em>Flux</em> and its popular implementation of <em>Redux</em> . </p><a name="habracut"></a><br><h3 id="oglavlenie">  Table of contents </h3><br><p>  1) <a href="https://habrahabr.ru/post/309958/">We assemble the base stack of an isomorphic application</a> <br>  2) We make a simple application with routing and <em>bootstrap</em> <br>  3) We <a href="https://habrahabr.ru/post/310952/">implement interaction with API and authorization</a> </p><br><p>  So, <a href="https://habrahabr.ru/post/309958/">in the first part</a> we ended up developing a simple <em>HelloWorld</em> component and <em>putting</em> together an environment for building and quality control of the code.  It is time to make a full-fledged site, which means that we will add a few more pages, link them with links and implement isomorphic routing. </p><br><h1 id="1-dobavlyaem-v-proekt-react-bootstrap">  1. Add to the project <em>react-bootstrap</em> </h1><br><p>  This is a very popular library that allows you to use <em>React</em> -style <em>bootstrap</em> elements. </p><br><p>  For example, instead of constructions like </p><br><pre><code class="javascript hljs">&lt;div className=<span class="hljs-string"><span class="hljs-string">"nav navbar"</span></span>&gt;</code> </pre> <br><p>  we can write </p><br><pre> <code class="javascript hljs">&lt;Nav navbar&gt;</code> </pre> <br><p>  You also do not have to use the JavaScript code of the original <em>bootstrap</em> , because it is already implemented in the components <em>react-bootstrap</em> . </p><br><h4 id="ustanavlivaem-react-bootstrap">  Install <em>react-bootstrap</em> </h4><br><pre> <code class="bash hljs">npm i --save react-bootstrap</code> </pre> <br><h2 id="vnosim-izmeneniya-v-proekt">  We make changes to the project </h2><br><p>  <em>Select the</em> <em>HelloWorld</em> widget from <em>App.jsx</em> into a separate component.  I recall that <em>App.jsx</em> is the entry point to the isomorphic part of the application, and we will soon rewrite it in the form of a layout, inside which the pages requested by the user will be displayed. </p><br><h3 id="refaktoring">  Refactoring </h3><br><ol><li>  Create a folder <em>src / components / HelloWorldPage</em> </li><li>  Rename <em>App.jsx</em> to <em>HelloWorldPage.jsx</em> , <em>App.css</em> to <em>HelloWorldPage.css</em> </li><li>  Move the <em>HelloWorldPage.jsx</em> and <em>HelloWorldPage.css</em> files to the <em>src / components / HelloWorldPage</em> folder </li></ol><br><pre> <code class="bash hljs">mkdir src/components/HelloWorldPage mv src/components/App.jsx src/components/HelloWorldPage/HelloWorldPage.jsx mv src/components/App.css src/components/HelloWorldPage/HelloWorldPage.css</code> </pre> <br><ol><li>  Let's make changes to <em>HelloWorldPage.jsx</em> </li></ol><br><pre> <code class="javascript hljs">--- <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./App.css'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./HelloWorldPage.css'</span></span>;</code> </pre> <br><ol><li>  Create an <em>index.js</em> file with the following content </li></ol><br><h4 id="srccomponentshelloworldpageindexjs">  src / components / HelloWorldPage / index.js </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HelloWorldPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./HelloWorldPage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> HelloWorldPage;</code> </pre> <br><p>  This step will allow us to import our component so </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HelloWorldPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/HelloWorldPage'</span></span>;</code> </pre> <br><p>  instead </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HelloWorldPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/HelloWorldPage/HelloWorldPage'</span></span>;</code> </pre> <br><p>  It is neater and simplifies the maintenance of the source code of the application. </p><br><h3 id="sozdaem-appjsx">  Create <em>App.jsx</em> </h3><br><ol><li>  Create <em>App</em> folder </li><li>  Create two files in the <em>App</em> folder: <em>index.js</em> and <em>App.jsx</em> </li></ol><br><pre> <code class="bash hljs">mkdir src/components/App</code> </pre> <br><h4 id="srccomponentsappindexjs">  src / components / App / index.js </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> App;</code> </pre> <br><h4 id="srccomponentsappappjsx">  src / components / App / App.jsx </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Grid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Grid'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Nav <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Nav'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Navbar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Navbar'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> NavItem <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/NavItem'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HelloWorldPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/HelloWorldPage'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div&gt; &lt;Navbar&gt; &lt;Navbar.Header&gt; &lt;Navbar.Brand&gt; &lt;span&gt;Hello World&lt;/span&gt; &lt;/Navbar.Brand&gt; &lt;Navbar.Toggle /&gt; &lt;/Navbar.Header&gt; &lt;Navbar.Collapse&gt; &lt;Nav navbar&gt; &lt;NavItem&gt;&lt;/NavItem&gt; &lt;NavItem&gt;&lt;/NavItem&gt; &lt;/Nav&gt; &lt;/Navbar.Collapse&gt; &lt;/Navbar&gt; &lt;Grid&gt; &lt;HelloWorldPage /&gt; &lt;/Grid&gt; &lt;/div&gt; ); } } export default App;</code> </pre> <br><p>  <em>Important note:</em> note that I explicitly indicate which components of the <em>react-bootstrap</em> I am importing.  This will help the <em>webpack</em> in the build process to include only the <em>react-bootstrap</em> part used in the project, and not the entire library, as it would have happened if I had written </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Grid, Nav, Navbar, NavItem } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap'</span></span>;</code> </pre> <br><p>  It is important to note that this maneuver only works in cases where the library used supports modularity.  For example, <em>react-bootstrap</em> and <em>lodash refer</em> to such, but <em>jquery</em> and <em>momentjs</em> do not. </p><br><div class="spoiler">  <b class="spoiler_title">This component can be implemented better.</b> <div class="spoiler_text"><p>  As can be seen from the code, the above component does not work with the <em>state</em> and does not use <em>component workflow callbacks</em> (for example, <em>componentWillMount</em> and <em>componentDidMount</em> ).  This means that it can be rewritten in the form of the so-called <em>Pure Sateless Function Component</em> . </p><br><p>  In the future, components written in this way will have an advantage in performance (thanks to the functional programming theory and the concept of <em>pure functions</em> ), and the more productive each component is, the more productive the application will be in the end. </p><br><p>  In the meantime, the reactor wraps such components in the usual ES6-classes, but with one nice bonus: </p><br><p>  By default, the component is always updated when new <em>props</em> and / or <em>state</em> values ‚Äã‚Äãare <em>received</em> , even in cases where they completely coincide with the previous ones.  This is not always necessary.  A developer has the opportunity to independently implement the method <em>shouldComponentUpdate (nextProps, nextState)</em> , which returns either <em>true</em> or <em>false</em> .  With the help of it, you yourself can explicitly tell the React, in which cases you want the component to be redrawn, and in which cases it is not. </p><br><p>  If the component is implemented as the <em>Pure Stateless Function Component</em> , then the React is itself able to determine the need to update the appearance of the component without the obvious implementation of <em>shouldComponentUpdate</em> , that is, we get more profit with less effort. </p><br><p>  <em>Note: The</em> code below is an example of such a component.  Since we will make changes to <em>App.jsx</em> in the <em>future</em> , and it will cease to be a <em>pure stateless</em> component, this example should not be transferred to our project. </p><br><p>  <em>Note 2:</em> in our project I will implement all components in the form of ES6-classes, even where it would be possible and correct to implement them in the form of <em>Pure Stateless Functions Components</em> , so as not to complicate the content of the article. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Grid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Grid'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Nav <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Nav'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Navbar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Navbar'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> NavItem <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/NavItem'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HelloWorldPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./HelloWorldPage'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">App</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div&gt; &lt;Navbar&gt; &lt;Navbar.Header&gt; &lt;Navbar.Brand&gt; &lt;span&gt;Hello World&lt;/span&gt; &lt;/Navbar.Brand&gt; &lt;Navbar.Toggle /&gt; &lt;/Navbar.Header&gt; &lt;Navbar.Collapse&gt; &lt;Nav navbar&gt; &lt;NavItem&gt;&lt;/NavItem&gt; &lt;NavItem&gt;&lt;/NavItem&gt; &lt;/Nav&gt; &lt;/Navbar.Collapse&gt; &lt;/Navbar&gt; &lt;Grid&gt; &lt;HelloWorldPage /&gt; &lt;/Grid&gt; &lt;/div&gt; ); } export default App;</code> </pre> </div></div><br><p>  It's time to see what has changed in the browser.  And ... yes, <em>bootstrap has</em> no styles.  The developers of <em>react-bootstrap</em> deliberately did not include them in the distribution, as all the same you will use your own theme.  Therefore, we go to any site with themes for <em>bootstrap</em> , for example <a href="http://bootswatch.com/">bootswatch.com</a> , and download the one you like.  Save it in src / components / App / bootstrap.css.  I recommend saving the full version, since it is easier to customize it, and then the webpack will still make the <em>minification anyway</em> . </p><br><p>  <em>Note:</em> you can download my theme from the <a href="">repository on github</a> . </p><br><p>  <em>Let's make a</em> change in <em>App.jsx</em> </p><br><h4 id="srccomponentsappappjsx-1">  src / components / App / App.jsx </h4><br><pre> <code class="javascript hljs">+++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./bootstrap.css'</span></span>;</code> </pre> <br><p>  I do not want to focus now on setting up work with <em>glyphicons</em> , especially since we will not use them in the project, so just remove them from the styles. </p><br><h4 id="srccomponentsappbootstrapcss">  src / components / App / bootstrap.css </h4><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">---</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">font-face</span></span> { --- <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'Glyphicons Halflings'</span></span>; --- <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'../fonts/glyphicons-halflings-regular.eot'</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'../fonts/glyphicons-halflings-regular.eot?#iefix'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'embedded-opentype'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'../fonts/glyphicons-halflings-regular.woff2'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'woff2'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'../fonts/glyphicons-halflings-regular.woff'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'woff'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'../fonts/glyphicons-halflings-regular.ttf'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'truetype'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'../fonts/glyphicons-halflings-regular.svg#glyphicons_halflingsregular'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'svg'</span></span>); --- }</code> </pre><br><p>  Back in the browser, and now everything should look good. </p><br><p>  <em>Note:</em> if you are annoyed when reloading the page, that the old version of the page first appears, and the new one only after a couple of seconds - just restart <em>nodemon</em> . </p><br><h1 id="2-dobavlyaem-neskolko-stranic-i-routing">  2. Add a few pages and routing. </h1><br><h2 id="21-sdelaem-dve-zaglushki">  2.1.  We make two plugs </h2><br><ol><li>  Create folders <em>src / components / CounterPage</em> and <em>src / components / TimePage</em> </li><li>  Write the stub code </li></ol><br><h4 id="srccomponentscounterpageindexjs">  src / components / CounterPage / index.js </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CounterPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./CounterPage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> CounterPage;</code> </pre> <br><h4 id="srccomponentscounterpagecounterpagejsx">  src / components / CounterPage / CounterPage.jsx </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CounterPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> CounterPage;</code> </pre> <br><h4 id="srccomponentstimepageindexjs">  src / components / TimePage / index.js </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TimePage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./TimePage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> TimePage;</code> </pre> <br><h4 id="srccomponentstimepagetimepagejsx">  src / components / TimePage / TimePage.jsx </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimePage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> TimePage;</code> </pre> <br><h2 id="22-dobavim-routing">  2.2.  Add routing </h2><br><p>  For routing, we will use the <em>react-router</em> library. </p><br><pre> <code class="bash hljs">npm i --save react-router</code> </pre> <br><p>  To make it work, you need to make the following changes to our project: </p><br><ol><li>  Define a file with <em>routes</em> .  In it, we indicate the correspondence between the <em>URL</em> and the components that should be rendered. </li><li>  At the server side of the application, the <em>express</em> web server will pass the request <em>URL</em> to the <em>match</em> function from <em>react-router</em> .  It will either return <em>renderProps</em> , which we can use to render the content requested by the user, or will report that there are no matches, and then we will return the page with 404 errors. </li><li>  We will also make changes to the client part of the application so that the <em>react-router</em> library can track <em>URL</em> changes.  If the new <em>URL</em> matches one of the configured paths, then client-side <em>JavaScript</em> updates the page content without contacting the server.  If the new <em>URL</em> does not match any of the configured paths, then the browser will follow the classic link. </li></ol><br><h3 id="221-fayl-routes">  2.2.1.  <em>Routes</em> file </h3><br><h4 id="srcroutesjsx">  src / routes.jsx </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { IndexRoute, Route } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CounterPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/CounterPage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HelloWorldPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/HelloWorldPage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TimePage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/TimePage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ( &lt;Route component={App} path='/'&gt; &lt;IndexRoute component={HelloWorldPage} /&gt; &lt;Route component={CounterPage} path='counters' /&gt; &lt;Route component={TimePage} path='time' /&gt; &lt;/Route&gt; );</code> </pre> <br><p>  Please note that we are in fact exporting the React component.  <em>IndexRoute</em> is analogous to <em>index.html</em> or <em>index.php</em> on the web: if part of the path is omitted, then it will be chosen. </p><br><p>  <em>Note: The</em> <em>Route</em> and <em>IndexRoute components</em> can be nested in other <em>Routes</em> as many times as necessary.  In our example, we limit ourselves to two levels. </p><br><h4 id="takim-obrazom-my-opredelili-sleduyuschee-sootvetstvie">  Thus, we have determined the following correspondence </h4><br><p>  URL '/' =&gt; component of the form &lt;HelloWorldPage /&gt; <br>  URL '/ counter' =&gt; &lt;CounterPage /&gt; <br>  URL '/ time' =&gt; &lt;TimePage /&gt; </p><br><p>  In our application, the <em>App</em> component should play the role of the layout, so you need to ‚Äúteach‚Äù it to render the nested ( <em>children</em> ) components. </p><br><h4 id="srccomponentsappappjsx-2">  src / components / App / App.jsx </h4><br><pre> <code class="javascript hljs">--- <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component, PropTypes } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Grid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Grid'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Nav <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Nav'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Navbar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Navbar'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> NavItem <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/NavItem'</span></span>; --- <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HelloWorldPage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/HelloWorldPage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./bootstrap.css'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> propTypes = { +++ children: PropTypes.node +++ }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div&gt; &lt;Navbar&gt; &lt;Navbar.Header&gt; &lt;Navbar.Brand&gt; &lt;span&gt;Hello World&lt;/span&gt; &lt;/Navbar.Brand&gt; &lt;Navbar.Toggle /&gt; &lt;/Navbar.Header&gt; &lt;Navbar.Collapse&gt; &lt;Nav navbar&gt; &lt;NavItem&gt;&lt;/NavItem&gt; &lt;NavItem&gt;&lt;/NavItem&gt; &lt;/Nav&gt; &lt;/Navbar.Collapse&gt; &lt;/Navbar&gt; &lt;Grid&gt; +++ {this.props.children} --- &lt;HelloWorldPage /&gt; &lt;/Grid&gt; &lt;/div&gt; ); } } +++ App.propTypes = propTypes; export default App;</code> </pre><br><h3 id="222-dobavim-routing-v-servernuyu-chast-prilozheniya">  2.2.2 Add Routing to the Server Side of the Application </h3><br><h4 id="srcserverjs">  src / server.js </h4><br><pre> <code class="javascript hljs">--- <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/App'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { match, RouterContext } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./routes'</span></span>; app.use(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { --- <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> componentHTML = ReactDom.renderToString(&lt;App /&gt;); +++ match({ routes, location: req.url }, (error, redirectLocation, renderProps) =&gt; { +++ if (redirectLocation) { //    redirect +++ return res.redirect(301, redirectLocation.pathname + redirectLocation.search); +++ } +++ if (error) { //     +++ return res.status(500).send(error.message); +++ } +++ if (!renderProps) { //    ,     URL +++ return res.status(404).send('Not found'); +++ } +++ const componentHTML = ReactDom.renderToString(&lt;RouterContext {...renderProps} /&gt;); +++ return res.end(renderHTML(componentHTML)); +++ }); --- return res.end(renderHTML(componentHTML)); });</code> </pre> <br><p>  <em>Note:</em> The <em>match</em> function takes as its first parameter a <em>JavaScript</em> object with the <em>routes</em> and <em>location</em> keys.  I am using <em>shorthand notation ES6</em> , the full version would look like this </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">routes</span></span>: routes, <span class="hljs-attr"><span class="hljs-attr">location</span></span>: req.url},</code> </pre> <br><p>  where we import <em>routes</em> from the <em>routes.jsx</em> file.  As the second parameter <em>match</em> takes the <em>callback</em> function, which is responsible for rendering. </p><br><p>  Temporarily disable client <em>javascript</em> </p><br><h4 id="srcclientjs">  src / client.js </h4><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ReactDOM.render(&lt;App /&gt;, document.getElementById('react-view'));</span></span></code> </pre> <br><p>  Now let's test the routing in the browser - our page looks the same, even though we got rid of the explicit attachment of the <em>HelloWorldPage</em> component in the <em>App</em> container.  Moving on. </p><br><h3 id="dobavim-ssylki-na-drugie-stranicy-obychno-eto-delaetsya-tak">  Add links to other pages.  This is usually done like this: </h3><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Link } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; &lt;Link <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>=<span class="hljs-string"><span class="hljs-string">'/my-fancy-path'</span></span>&gt;Link <span class="hljs-type"><span class="hljs-type">text</span></span>&lt;/Link&gt;</code> </pre><br><p>  However, we need to arrange the <em>NavItem</em> components as links.  To do this, use the <em>react-router-bootstrap</em> library. </p><br><pre> <code class="bash hljs">npm i --save react-router-bootstrap</code> </pre> <br><h4 id="srccomponentsappappjsx-3">  src / components / App / App.jsx </h4><br><pre> <code class="javascript hljs">+++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Link } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinkContainer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router-bootstrap/lib/LinkContainer'</span></span>; --- <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Hello World</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> +++ <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Link</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'/'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Hello World</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> --- <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> +++ <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LinkContainer</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'/time'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LinkContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> --- <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> +++ <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LinkContainer</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'/counters'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LinkContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  Test server routing. </p><br><p>  Restart <em>nodemon</em> .  In the browser, open the <em>Developer Tools</em> , <em>Network</em> tab. </p><br><p>  Now you can evaluate the results of our work and click on the links in the navigation menu.  Note that the requests go to the server where the <em>express is</em> processed.  It, in turn, renders and returns to the browser the HTML code of the requested page.  Now our application works exactly like a classic web application. </p><br><p>  If client-side <em>JavaScript</em> does not have time to load and initialize, or there is an error in it, our application will still work successfully, as we just could see. </p><br><h3 id="223-dobavim-routing-v-klientskuyu-chast-prilozheniya">  2.2.3 Add routing to the client part of the application. </h3><br><h4 id="srcclientjs-1">  src / client.js </h4><br><pre> <code class="javascript hljs">--- <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/App'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { browserHistory, Router } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./routes'</span></span>; --- <span class="hljs-comment"><span class="hljs-comment">// ReactDOM.render(&lt;App /&gt;, document.getElementById('react-view')); +++ const component = ( +++ &lt;Router history={browserHistory}&gt; +++ {routes} +++ &lt;/Router&gt; +++ ); +++ ReactDOM.render(component, document.getElementById('react-view'));</span></span></code> </pre> <br><p>  <em>Note:</em> Please note that now the <em>Router</em> component has become the root component of our application.  It tracks <em>URL</em> changes and generates page content based on the <em>routes</em> we configured. </p><br><p>  Back in the browser and click on the links again, carefully watching the <em>Developer Tools</em> <em>Network</em> tab.  This time the page does not reload, requests to the server do not go away, and client-side <em>JavaScript</em> renders the requested page time after time.  Everything is working! </p><br><h3 id="promezhutochnyy-rezultat">  Intermediate result </h3><br><p>  We added several pages and successfully configured client and server routing, making sure that they work correctly for all scenarios. </p><br><h1 id="3-flux-i-redux">  3. Flux and Redux </h1><br><p>  First, we will implement a page with "counters" to talk about <em>Flux</em> and <em>Redux</em> as close as possible to practice. </p><br><p>  Create two new components: <em>Counter.jsx</em> and <em>StateCounter.jsx</em> . </p><br><p>  <em>Counter</em> will display the value passed to it and the plus button, which is responsible for changing this value. </p><br><p>  <em>StateCounter</em> is the parent component of the <em>Counter</em> component.  It will store the current <em>Counter</em> value in its own <em>state</em> storage and contain the business logic for updating this value when the user clicks the plus button. </p><br><p>  I deliberately chose this implementation to explicitly separate the interface and business logic. <br>  This technique is very often used in practice, since such code is simpler: </p><br><ul><li>  maintain and accompany </li><li>  test, </li><li>  reuse. </li></ul><br><p>  In particular, in our project several components will use <em>Counter</em> at once. </p><br><h4 id="srccomponentscounterpagecounterjsx">  src / components / CounterPage / Counter.jsx </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component, PropTypes } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/Button'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./Counter.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> propTypes = { <span class="hljs-attr"><span class="hljs-attr">onClick</span></span>: PropTypes.func, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: PropTypes.number }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defaultProps = { <span class="hljs-attr"><span class="hljs-attr">onClick</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {}, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Counter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { onClick, value } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'counter-label'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Value: {value} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{onClick}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">+</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } Counter.propTypes = propTypes; Counter.defaultProps = defaultProps; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Counter;</code> </pre> <br><h4 id="srccomponentscounterpagecountercss">  src / components / CounterPage / Counter.css </h4><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.counter-label</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; }</code> </pre> <br><h4 id="srccomponentscounterpagestatecounterjsx">  src / components / CounterPage / StateCounter.jsx </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Counter <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Counter'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StateCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleClick = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleClick.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; } handleClick() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.value + <span class="hljs-number"><span class="hljs-number">1</span></span> }); } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Counter</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.state.value}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.handleClick}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; } } export default StateCounter;</span></span></code> </pre> <br><h4 id="srccomponentscounterpagecounterpagejsx-1">  src / components / CounterPage / CounterPage.jsx </h4><br><pre> <code class="javascript hljs">+++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PageHeader <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-bootstrap/lib/PageHeader'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StateCounter <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./StateCounter'</span></span>; render() { --- <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( +++ <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">PageHeader</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Counters</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">PageHeader</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">State Counter</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">StateCounter</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> +++ ); }</code> </pre> <br><p>  It's time to test the updated code.  In the browser, go to the "Counters" tab and click on the "+" button.  The value has changed from 0 to 1. Great!  Now go to any other tab, and then go back.  The counter value again became "0".  This is highly expected, but does not always correspond to what we would like to see. </p><br><p>  It is time to discuss the concept of "Flux". </p><br><img src="https://habrastorage.org/files/f54/1a5/e85/f541a5e85ad943d3b6443941b0ec0755.png" alt="Flux"><br><p>  <em>Note:</em> <em>Flux</em> is a concept, not a library.  Today, there are many different libraries that implement it. </p><br><h2 id="31-osnovnye-principy-flux-na-palcah">  3.1.  <em>Flux basics</em> on the fingers </h2><br><ol><li><p>  Components do not contain business logic, but are responsible only for rendering the interface. </p><br></li><li><p>  There is one object in the application that stores the state of the entire application.  I will call it a ‚Äúglobal state,‚Äù although I'm not quite sure that this is the most successful term.  At the request of the developer, some components "subscribe" to the part of the global state they are interested in.  Over time, the global state may change, and all components subscribed to it receive updates automatically. </p><br></li><li>  It is forbidden to explicitly change the global state inside the component.  To change the global state, components call the special function <em>dispatch</em> .  Tracking the progress of this function is anti-pattern, since it violates the first principle of <em>Flux</em> .  In practice, the global state will contain all the information you need for your component, for example, the execution status of the API request and errors.  This and other information will be promptly and explicitly transmitted to your component using <em>props</em> . </li></ol><br><p>  <em>Important note: the</em> global state only describes the state of your <em>front-end</em> application in a separate tab and is stored exclusively in the RAM memory of the browser.  Thus, it will be lost if the user presses F5, which is absolutely normal, expected by design.  I will focus on this topic in more detail in the third part. </p><br><h3 id="prakticheskiy-primer">  Practical example </h3><br><p>  Suppose we have an online store site: in the center of the page we will see a list of products, in the navigation bar there is a basket icon with the quantity of goods and their total cost, and somewhere on the right there is a block with details of the goods added to the basket.  In short, a fairly common scenario. </p><br><img src="https://habrastorage.org/files/6d0/090/f0d/6d0090f0d0d149f9b1ca3fba6adfae66.jpg"><br><p><br></p><br><h4 id="scenariy-s-tochki-zreniya-polzovatelya">  Scenario from the user's point of view </h4><br><ol><li>  The user clicks on the button "Add to cart". </li><li>  The button is no longer active, its icon is changed to the download indicator. </li><li>  Server API query in progress. </li><li>  After the server part has successfully processed the request and returned the answer, a hint appears on top of ‚ÄúThe item was successfully added to the basket‚Äù, the icon value with the number of goods is increased by one, the amount is recalculated, a new record appears in the block with details of the contents of the basket.  The download indicator disappears, and the button itself becomes active again. </li><li>  In case of an error at step 3, we show the user a message with an error and return the button for adding the product to the cart in its original state. </li></ol><br><p>  If we wrote this script on <em>jQuery</em> , then we would have to write a lot of code to work with DOM.  In the process of implementing all new customer requirements, the code would become more complicated, and, with a high degree of probability, something would break in the end, and the complexity and cost of support would constantly increase with the passage of time and new "hoteles". </p><br><h4 id="etot-zhe-scenariy-s-tochki-zreniya-flux">  The same scenario from the point of view of <em>Flux</em> </h4><br><p>  <em>Note:</em> the "Add to Cart", "Notifications", "Basket" and "Cart Detail" components are subscribed to a global state. </p><br><ol><li>  The user clicks on the "Add to cart" button, which leads to the call of the <em>dispatch</em> function. </li><li>  This function updates the global state: the Add to Cart button receives a new <em>prop <code>loading</code></em> value equal to <em>true</em> , which makes it off, and its icon changes to the download indicator according to the source code of this component. </li><li>  The next step is to make an API request to save information about the added product in the backend. </li><li>  If successful, we update the global state: the Notifications component receives a new <em>prop <code>message</code></em> value, which makes it visible to the user, the Recycle component receives the <em>prop <code>count</code></em> values ‚Äã‚Äãwith the new quantity of goods and the <em>prop <code>value</code></em> with the order amount, the Recycle Bin component receives the value <em>prop <code>items</code></em> - an updated list of objects corresponding to all products added to the cart.  If in the future the customer wishes that something else happens on the page, we can easily bring it to life without changing either the code of other components or the function that performs the business logic.  We need only implement a new component and indicate in it what part of the global state we are interested in. </li><li>  If the API returns an error, the Notifications component will receive the corresponding <em>prop <code>message</code></em> value and show the user an informational message. </li><li>  The function last updates the global state by telling the "Add to Cart" button a new <em>prop <code>loading</code></em> value <em>false</em> .  The button will return to its original state. </li></ol><br><h4 id="primer-koda-takoy-funkcii">  Code example of such a function </h4><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addItemToCart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">itemId</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function">) =&gt;</span></span> { dispatch(addItemToCartStarted(itemId)); addItemToCartAPICall(itemId) .then( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) =&gt;</span></span> { dispatch(itemToCardAdded(data)); dispatch(addItemToCartFinished(data)); } ) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> dispatch(addItemToCartFailed(itemId, error))); } }</code> </pre> <br><p>  Simplified, though not entirely correct: in this example, the <em>dispatch</em> function is responsible for updating the global state.  We take a function that contains the business logic of updating the global state, and pass it as the first argument to the <em>dispatch</em> function. </p><br><p>           . </p><br><ol><li>   ,     -,  </li></ol><br><pre> <code class="javascript hljs">&lt;Button onClick={() =&gt; dispatch(addItemToCart(<span class="hljs-number"><span class="hljs-number">3</span></span>))} /&gt;</code> </pre> <br><ol><li><p>            . </p><br></li><li>       ,   ,    <em>props</em>     . </li></ol><br><p>    ! </p><br><h2 id="32-redux">  3.2.  Redux </h2><br><p> :        <em>Flux</em> . </p><br><p>  Pros: </p><br><ul><li>  :    ,        ; </li><li>   .       . ,  -    ,   ,  ; </li><li>   .     2 ; </li><li>     ‚Äî   <a href="https://twitter.com/dan_abramov"> </a> ,   <em>facebook</em> . </li></ul><br><p>  Minuses: </p><br><ul><li>     :    ,     . </li></ul><br><h3 id="nam-predstoit-mnogoe-sdelat">    : </h3><br><ol><li>   ; </li><li>  -    ; </li><li>   <em>redux</em> ; </li><li>   <em>redux</em>    ; </li><li>   <em>redux</em>    ; </li><li>   "",      ; </li><li>       ; </li><li>  . </li></ol><br><p> <em> :</em>          : "  ?"  "    ?".  Nothing!  ,   .      ,     .   , - ,    ! ,       ,    ,          , ! </p><br><h3 id="321-ustanovim-redux-react-redux-i-redux-thunk">  3.2.1.  <em>redux</em> , <em>react-redux</em>  <em>redux-thunk</em> </h3><br><pre> <code class="bash hljs">npm i --save redux react-redux redux-thunk</code> </pre> <br><h3 id="322-realizuem-biznes-logiku-schetchikov">  3.2.2.  -  </h3><br><p> 3.2.2.1   <em>src/redux</em> , <em>src/redux/actions</em>  <em>src/redux/reducers</em> . <br> 3.2.2.2   <em>counterActions.js</em> .     ,      . </p><br><h4 id="srcreduxactionscounteractionsjs"> src/redux/actions/counterActions.js </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INCREMENT_COUNTER = <span class="hljs-string"><span class="hljs-string">'INCREMENT_COUNTER'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">incrementCounter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: INCREMENT_COUNTER }; }</code> </pre> <br><p> 3.2.2.3   <em>counterReducer.js</em> .        . </p><br><h4 id="srcreduxreducerscounterreducerjs"> src/redux/reducers/counterReducer.js </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { INCREMENT_COUNTER } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux/actions/counterActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> INCREMENT_COUNTER: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: state.value + <span class="hljs-number"><span class="hljs-number">1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br><h4 id="chto-delaet-etot-kod">    ? </h4><br><ol><li>  ,        0. </li><li>       <em>INCREMENT_COUNTER</em> ,     <em>value</em>  1. </li><li>  ‚Äî   . </li></ol><br><p> <em>:</em>       ,      <em>redux</em>    (   "")      <em>@@INIT</em> ,       . </p><br><h3 id="323-realizovyvaem-inicializaciyu-redux"> 3.2.3   <em>redux</em> </h3><br><p>   <em>configureStore.js</em> </p><br><h4 id="srcreduxconfigurestore"> src/redux/configureStore </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { applyMiddleware, combineReducers, createStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> thunk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-thunk'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> counterReducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducers/counterReducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">initialState = {}</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rootReducer = combineReducers({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: counterReducer }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> createStore(rootReducer, initialState, applyMiddleware(thunk)); }</code> </pre> <br><h4 id="chto-delaet-etot-kod-1">    ? </h4><br><ol><li>    <em>combineReducers</em> ,      .  ,           ,            -. </li><li>      .          . </li><li>   <em>thunk</em>   <em>middleware</em> .     "" ‚Äî     ,  <em>dispatch</em> .      ,       . </li><li>     <em>createStore</em>     ,  ""         . </li></ol><br><h3 id="324-dobavlyaem-inicializaciyu-redux-v-servernuyu-chast-prilozheniya">  3.2.4.   <em>redux</em>     </h3><br><h4 id="srcserverjs-1"> src/server.js </h4><br><pre> <code class="javascript hljs">+++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Provider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./redux/configureStore'</span></span>; app.use(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { +++ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = configureStore(); ... --- <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> componentHTML = ReactDom.renderToString(&lt;RouterContext {...renderProps} /&gt;); +++ const componentHTML = ReactDom.renderToString( +++ &lt;Provider store={store}&gt; +++ &lt;RouterContext {...renderProps} /&gt; +++ &lt;/Provider&gt; +++ );</code> </pre> <br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p>  ‚Äî  <em>props</em>    .          <em>props</em> ,       <em>child</em>    <em>child</em>    .  ,    ,  ,   ,   API    , ,        . </p><br><p>  ,     ,    .  API  ,       ,   ,        . </p><br><p>       <em>Provider</em>   <em>react-redux</em>       store.       ,       ,                ,       . </p></div></div><br><h3 id="325-dobavlyaem-inicializaciyu-redux-v-klientskuyu-chast-prilozheniya"> 3.2.5.   <em>redux</em>     </h3><br><h4 id="srcclientjs-2"> src/client.js </h4><br><pre> <code class="javascript hljs">+++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Provider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./redux/configureStore'</span></span>; +++ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = configureStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = ( +++ <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">store</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{store}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Router</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">history</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{browserHistory}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {routes} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Router</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre> <br><h3 id="326-realizuem-komponent-schetchik-kotoryy-budet-podpisan-na-globalnoe-sostoyanie"> 3.2.6.   "",       </h3><br><h4 id="srccomponentscounterpagereduxcounterjsx"> src/components/CounterPage/ReduxCounter.jsx </h4><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component, PropTypes } from <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect } from <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Counter from <span class="hljs-string"><span class="hljs-string">'./Counter'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { incrementCounter } from <span class="hljs-string"><span class="hljs-string">'redux/actions/counterActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> propTypes = { dispatch: PropTypes.func.isRequired, value: PropTypes.number.isRequired }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReduxCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleClick = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleClick.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } handleClick() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.dispatch(incrementCounter()); } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;Counter value={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.value} onClick={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleClick} /&gt;; } } ReduxCounter.propTypes = propTypes; function mapStateToProps(state) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { value } = state.counter; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { value }; } export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> connect(mapStateToProps)(ReduxCounter);</code> </pre> <br><p>  <em>connect</em>      .      : </p><br><ol><li>      <em>mapStateToProps</em> ,     ,   ""        ,    ; </li><li>   <em>dispatch</em> ; </li><li>    ,  <em>mapStateToProps</em> ""       <em>props</em>   <em>ReduxCounter</em> . </li></ol><br><p> <em>:</em>    <em>connect</em>  <em>High Order Components</em>   <em>HOCs</em> . </p><br><div class="spoiler"> <b class="spoiler_title">   High Order Components</b> <div class="spoiler_text"><p>  <em>High Order Component</em>   :    ,       ,   , ,  ,        <em>props</em> . </p><br><p> <em>connect</em>       .      </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mapStateToProps</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...</span></span></span><span class="hljs-function">) </span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> injectedProps = mapStateToProps(globalState); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WrappedComponent</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HighOrderComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { &lt;WrappedComponent {...this.props} {...injectedProps} dispatch={dispatch} /&gt;; } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HighOrderComponent; } }</code> </pre> <br><h4 id="chto-proishodit-kogda-my-pishem-export-default-connectmapstatetopropsreduxcounter-">  ,    <em>export default connect(mapStateToProps)(ReduxCounter)</em> ? </h4><br><ol><li>   <em>connect</em>   <em>mapStateToProps</em> . </li><li>    <em>connect</em>   <em>mapStateToProps</em> ,     .     <em>{ value: "_____"}</em> ,      <em>injectedProps</em> . </li><li> <em>connect</em>        . </li><li>         <em>ReduxCounter</em> . </li><li>     <em>props</em> ,    ( <em>{...this.props}</em> ),   <em>injectedProps</em>      <em>dispatch</em> </li><li>      </li></ol></div></div><br><h3 id="327-dobavlyaem-novyy-schetchik-na-stranicu-s-counterpage">  3.2.7.       <em>CounterPage</em> </h3><br><h4 id="srccomponentscounterpagecounterpagejsx-2"> src/components/CounterPage/CounterPage.jsx </h4><br><pre> <code class="javascript hljs">+++ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReduxCounter <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ReduxCounter'</span></span>; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">StateCounter</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Redux Counter</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +++ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ReduxCounter</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span></span></code> </pre> <br><h3 id="328-testiruem"> 3.2.8.  We are testing </h3><br><ol><li>          "+"  .      . </li><li>     ,    .      ,       .  Great!  Works! </li></ol><br><p>    ,       , ! </p><br><p>     github ‚Äî <a href="https://github.com/yury-dymov/habr-app/tree/v2">https://github.com/yury-dymov/habr-app/tree/v2</a> . </p><br><h1 id="v-trete-chasti">    </h1><br><ol><li>            . </li><li>     API. </li><li>        API. </li></ol><br><h1 id="poleznye-resursy-i-materialy">     </h1><br><ol><li> <a href="https://react-bootstrap.github.io/">    react-bootstrap</a> </li><li> <a href="https://github.com/ReactTraining/react-router/tree/master/docs"> react-router</a> </li><li> <a href="https://facebook.github.io/flux/"> Flux</a> </li><li> <a href="https://egghead.io/courses/getting-started-with-redux">    redux   </a> </li></ol><br><p> Ps       , ,      .  Thank you in advance! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310284/">https://habr.com/ru/post/310284/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310268/index.html">REST server and thin client using vibe-d</a></li>
<li><a href="../310270/index.html">Naive implementation of std :: bind (boost :: bind)</a></li>
<li><a href="../310276/index.html">Embedding functional objects, functions and lambdas through templates and unification using virtual in C ++</a></li>
<li><a href="../310278/index.html">Gitlab-CI and Ansible-lint syntax checking</a></li>
<li><a href="../310282/index.html">The second wave of fateful changes GitHub</a></li>
<li><a href="../310286/index.html">What links to use: absolute or relative?</a></li>
<li><a href="../310288/index.html">ClusterR clustering, part 1</a></li>
<li><a href="../310292/index.html">Bug work</a></li>
<li><a href="../310294/index.html">The digest of interesting materials for the mobile developer # 171 (September 12-18)</a></li>
<li><a href="../310296/index.html">Voice and video for programmers. How we create a realtime communications conference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>