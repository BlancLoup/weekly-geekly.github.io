<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interesting prioritization of voice traffic in Telegram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, many people wonder how the Telegram team managed to make the voice calls function, popular for messengers, immediately after the launch of a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interesting prioritization of voice traffic in Telegram</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/f08/55a/c84/f0855ac8443d419194ed6732c7bf02e1.jpg"></div><br>  Probably, many people wonder how the Telegram team managed to make the voice calls function, popular for messengers, immediately after the launch of a strikingly different quality for the better in front of many other VoIP services. <br><br>  While studying the work of Telegram Calls, I noticed an interesting technical detail that is used at the network level and helps to reduce delays during the passage of packets when the relay servers are used when connecting. <br><a name="habracut"></a><br>  If you look at the traffic dump, which passes when you call using the relay server, you will notice that the traffic is determined by the RIP protocol.  The IP at 91. is a Telegram server.  I filmed a traffic dump on my VPN server, so the client‚Äôs address is from the local subnet. <br><br><img src="https://habrastorage.org/files/019/91b/0f8/01991b0f8f2a4cc8a94afbecbb79cc3c.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And here is a screenshot from the client debug, but already with P2P.  It is worth noting that port 520 is assigned only to servers, so this method works when P2P - connection between clients is impossible and one of the servers from the list acts as a relay. <br><br><img src="https://habrastorage.org/files/a72/310/cbb/a72310cbb7ba496486c739e73a991a99.png"><br><br>  Recall what we know about <a href="https://ru.wikipedia.org/wiki/RIP_(%25D1%2581%25D0%25B5%25D1%2582%25D0%25B5%25D0%25B2%25D0%25BE%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25BE%25D0%25BB)">the RIP protocol</a> ? <br>  RIP - routing protocol.  RIP operates at layer 3 (network) TCP / IP stack using UDP port 520. UDP, that is, delivery that does not require confirmation of reception, is known to be in itself perfectly suited for real-time traffic, which is voice. <br><br>  Routing protocols are needed so that routers can quickly exchange service information about the networks connected to them and their neighbors.  Updating route information is critical to quickly restoring a network to work as it changes; therefore, many network equipment manufacturers assign routing protocol traffic the maximum processing priority.  That is, they pass it ahead of the rest of the traffic. <br><br>  This prioritization is implemented in routers using <a href="http://www.cisco.com/c/en/us/support/docs/quality-of-service-qos/qos-packet-marking/10103-dscpvalues.html">DSCP codes</a> (Differentiated Services Code Point), and by default, for example, in Cisco according to RFC 791 and RFC 2474, the routing protocols RIP / RIP2 / OSPF / EIGRP are marked with code 6. And this, for a moment , superior, Internetwork Control priority. <br><br><img src="https://habrastorage.org/files/bc2/682/cbd/bc2682cbd49145e68a1308f0cf1bc435.png"><br><br>  In addition to DSCP prioritization, Cisco IOS also has an internal <a href="http://www.cathayschool.com/PAK_priority-a703.html">PAK_priority</a> mechanism, which serves to provide priority for important <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B0%25D1%2582%25D0%25B0%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B0">datagrams</a> at the moment they pass through a router.  The PAK_priority designation was conceived by the Cisco developers (and, we may assume, by some others) of the equipment as critical for the correct operation of Cisco IOS, and therefore cannot be configured at all.  This excludes the possibility for administrators to somehow influence the priority traffic transmission that has Control characteristics for the system. <br><br>  It seems that having remembered the ancient protocol and the peculiarities of its work (useful UDP, the existence of the <a href="http://www.cathayschool.com/Unicast-Updates-for-RIP-a34.html">Unicast exchange</a> capability), Telegram architects used its port, thereby forcing many routers along the way of packets to process their traffic as very important, thereby, somewhat reducing delays. <br><br>  It seems to be a small detail in the world of powerful codecs, but, as they say, the devil is in the details - so why not make these things work for the good of the final goal? </div><p>Source: <a href="https://habr.com/ru/post/326566/">https://habr.com/ru/post/326566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326550/index.html">How we made a completely new KOMPAS-3D: History in seven chapters ‚Üí part 1</a></li>
<li><a href="../326552/index.html">An article about static code analysis for managers that should not be read by programmers.</a></li>
<li><a href="../326554/index.html">Security Week 15: Leaky Modem in Huawei, VirusTotal as a data breach channel, Microsoft patches from Dridex</a></li>
<li><a href="../326556/index.html">Schr√∂dinger's trusted download. Intel Boot Guard</a></li>
<li><a href="../326564/index.html">Project generator</a></li>
<li><a href="../326568/index.html">Autonumber in four languages. Part 1</a></li>
<li><a href="../326570/index.html">How to talk with artificial intelligence?</a></li>
<li><a href="../326572/index.html">Creating a single-player game: from idea to prototype</a></li>
<li><a href="../326574/index.html">TCP / IP basics for future dilettantes</a></li>
<li><a href="../326576/index.html">Test Data Generator for C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>