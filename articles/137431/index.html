<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MSP430, learn to program and debug hardware (part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear user. 
 In the previous article, we began to consider programming under MSP430. 
 The material described in this article will allow you to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MSP430, learn to program and debug hardware (part 2)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/e59/aac/829/e59aac829e587062f7506a857fae95a3.jpg" align="left"><br>  Hello, dear user. <br>  In the <a href="http://habrahabr.ru/blogs/controllers/137205/">previous article,</a> we began to consider programming under MSP430. <br>  The material described in this article will allow you to familiarize yourself with the <b>interruptions</b> and understand some of the subtleties of MSP430. <br><a name="habracut"></a><br><br clear="all"><h4>  Introduction </h4><br>  <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D1%2580%25D1%258B%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Interrupt</a> (English interrupt) - a signal informing the processor about the occurrence of an event.  In this case, the execution of the current sequence of commands is suspended and control is transferred to the interrupt handler, which responds to the event and serves it, and then returns control to the interrupted code. <br>  The interrupt mechanism is created to ensure the most rapid response of the program to certain events.  This is a very important part of dating with any microcontroller. <br><br><h4>  Interruptions </h4><br>  Let's start with a small example. <br><blockquote><ol><li>  <font color="#339900">#include "msp430f2274.h"</font> </li><li></li><li>  <font color="#0000ff">void</font> main <font color="#008000">(</font> <font color="#008000">)</font> </li><li>  <font color="#008000">{</font> </li><li>  WDTCTL <font color="#000080">=</font> WDTPW <font color="#000040">+</font> WDTHOLD <font color="#008080">;</font> </li><li></li><li>  P1DIR <font color="#000040">&amp;</font> <font color="#000080">=</font> ~ BIT2 <font color="#008080">;</font> </li><li>  P1REN <font color="#000040">|</font>  <font color="#000080">=</font> BIT2 <font color="#008080">;</font> </li><li></li><li>  P1IE <font color="#000040">|</font>  <font color="#000080">=</font> BIT2 <font color="#008080">;</font>  <font color="#666666">// Enable interrupts on P1.2</font> </li><li>  P1IES <font color="#000040">|</font>  <font color="#000080">=</font> BIT2 <font color="#008080">;</font>  <font color="#666666">// Interrupt occurs by 1/0 (release / press)</font> </li><li>  P1IFG <font color="#000040">&amp;</font> <font color="#000080">=</font> ~ BIT2 <font color="#008080">;</font>  <font color="#666666">// Clear interrupt flag for P1.2</font> </li><li></li><li>  P1DIR <font color="#000040">|</font>  <font color="#000080">=</font> BIT0 <font color="#000040">+</font> BIT1 <font color="#008080">;</font> </li><li>  P1OUT <font color="#000040">|</font>  <font color="#000080">=</font> BIT0 <font color="#008080">;</font> </li><li>  P1OUT <font color="#000040">&amp;</font> <font color="#000080">=</font> ~ BIT1 <font color="#008080">;</font> </li><li>  __bis_SR_register <font color="#008000">(</font> GIE <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// Set global interrupt enable flag</font> </li><li></li><li>  <font color="#0000ff">while</font> <font color="#008000">(</font> <font color="#0000ff">true</font> <font color="#008000">)</font> <font color="#008080">;</font> </li><li>  <font color="#008000">}</font> </li><li></li><li>  <font color="#339900">#pragma vector = PORT1_VECTOR</font> </li><li>  __interrupt <font color="#0000ff">void</font> P1INT <font color="#008000">(</font> <font color="#008000">)</font> <font color="#666666">// Interrupt Handler</font> </li><li>  <font color="#008000">{</font> </li><li>  P1IE <font color="#000040">&amp;</font> <font color="#000080">=</font> ~ BIT2 <font color="#008080">;</font>  <font color="#666666">// Disable interrupts on P1.2</font> </li><li></li><li>  P1OUT <font color="#000040">^</font> <font color="#000080">=</font> BIT0 <font color="#008080">;</font>  <font color="#666666">// P1.0 changes its state</font> </li><li>  P1OUT <font color="#000040">^</font> <font color="#000080">=</font> BIT1 <font color="#008080">;</font>  <font color="#666666">// P1.1 changes its state</font> </li><li></li><li>  <font color="#0000ff">for</font> <font color="#008000">(</font> <font color="#0000ff">volatile</font> <font color="#0000ff">unsigned</font> <font color="#0000ff">int</font> i <font color="#000080">=</font> <font color="#0000dd">30000</font> <font color="#008080">;</font> i <font color="#000040">!</font> <font color="#000080">=</font> <font color="#0000dd">0</font> <font color="#008080">;</font> i <font color="#000040">-</font> <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// Delay</font> </li><li>  P1IE <font color="#000040">|</font>  <font color="#000080">=</font> BIT2 <font color="#008080">;</font>  <font color="#666666">// Enable interrupts on P1.2</font> </li><li>  P1IFG <font color="#000040">&amp;</font> <font color="#000080">=</font> ~ BIT2 <font color="#008080">;</font>  <font color="#666666">// Clear interrupt flag for P1.2</font> </li><li>  <font color="#008000">}</font> </li><li></li></ol></blockquote><br>  In this example, pressing a button (P1.2) causes an interruption, which changes the state of two LEDs (P1.0 and P1.1).  Let's see how this happens. <br><br>  <b>PxIE</b> enables interrupts for Px port pins.  The value ‚Äú1‚Äù written to a certain digit allows receiving interrupts from a certain pin. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>PxIES</b> determines by what level of signal the interruption will occur.  In our case, this means that a unit placed in a particular digit of this register will allow receiving a button press event.  And vice versa, zero will allow receiving a button release event. <br> <i><img align="left" src="https://habrastorage.org/storage2/23d/d35/475/23dd3547558a07942a2005e3e248f985.jpg"></i>  <i>Let me remind you that the button in this example is ‚Äúpulled up‚Äù to one, which means that the pressed button has a value of zero.</i> <i><br></i>  <i>On the wiring diagram, resistor R1 is drawn indicatively, in fact it is inside the microcontroller and turned on by the P1REN register.</i> <br clear="all">  <b>PxIFG</b> is the interrupt flag.  In the case of a button press event, it will be set to one, which will cause the interrupt handler (__interrupt void P1INT ()).  Accordingly, immediately after processing the event, the flag must be reset. <br>  <i>Try removing line 32 from the example at the end of the handler, and then, immediately after first pressing the button, the light bulbs will switch as if you are constantly pressing the button.</i> <br><br>  <b>__bis_SR_register (GIE)</b> sets the Global Interrupt Enable flag in the status register.  In fact, this is equivalent to the SR | = GIE record, but we can access the SR register only by means of the __bis_SR_register and __get_SR_register functions. <br>  Below is a diagram of the bits in the SR register. <br><img src="https://habrastorage.org/storage2/36e/e15/0d1/36ee150d1180a948e1e360831237d9c2.jpg"><br>  <b>The 0, 1, 2, and 8</b> bits are bits of mathematical operations. <br>  <b>4, 5, 6, 7</b> - control bits of energy consumption levels, by reducing the frequency or turning off the ALU. <br>  Well, actually bit <b>3</b> is the global resolution of interrupts.  As long as this bit is not set to one, no interrupts will be processed. <br><br>  <b>#pragma vector</b> is a directive that specifies that the following function is a handler for the specified interrupt. <br>  <i>A list of all available interrupt vectors can be found in the header file for your controller.</i>  <i>In this case, it is <a href="">msp430f2274.h</a> .</i> <br><br><h4>  Contact Bounce </h4><br>  About this phenomenon can be <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D1%2580%25D0%25B5%25D0%25B1%25D0%25B5%25D0%25B7%25D0%25B3_%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BE%25D0%25B2">read in</a> detail <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D1%2580%25D0%25B5%25D0%25B1%25D0%25B5%25D0%25B7%25D0%25B3_%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BE%25D0%25B2">in Wikipedia</a> .  Contacts bounce occurs when the button is pressed, so that the interrupt handler will be called repeatedly.  In this example, this was avoided as follows: <br><ol><li>  Immediately after calling the handler, the interrupt ban is set (line 25); </li><li>  after switching the states of the LEDs, a delay is made (line 30); </li><li>  interrupt resolution is set again (line 31). </li></ol><br>  <i>The <b>volatile</b> directive in line 30 of the code means that the variable <b>i</b> will not be optimized during compilation.</i>  <i>If you remove it, there will be no delay.</i> <br><br><h4>  Conclusion </h4><br>  After reading the previous article, colleagues and friends reproached me for not paying enough attention to detail.  This time I tried to correct this shortcoming and make the article more accessible.  However, this greatly increased the amount of information. <br>  Next time I will try to consider transferring data from the controller to a personal computer within the means of the programmer and, depending on the received volume, watchdog. <br><br>  I hope this article has been helpful to you, reader. </div><p>Source: <a href="https://habr.com/ru/post/137431/">https://habr.com/ru/post/137431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137423/index.html">Free-to-play games: how to make them successful</a></li>
<li><a href="../137425/index.html">I haven't taken checkers for a long time. Know, know how you play</a></li>
<li><a href="../137426/index.html">Javascript. Sort table</a></li>
<li><a href="../137428/index.html">Qt parallel compilation in Windows</a></li>
<li><a href="../137429/index.html">Kinect for Windows went on sale</a></li>
<li><a href="../137432/index.html">Sony has received a new head of the company</a></li>
<li><a href="../137433/index.html">Based on what PHP capabilities and how do you develop applications?</a></li>
<li><a href="../137434/index.html">I work for random ()</a></li>
<li><a href="../137436/index.html">Facebook timeline</a></li>
<li><a href="../137437/index.html">OGS Mahjong Solitaire 0.9, one step away from the finish line</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>