<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Under the hood JobIntentService</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will discuss one problem with the JobIntentService, about which there are many questions on the relevant resources and reports in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Under the hood JobIntentService</h1><div class="post__text post__text-html js-mediator-article"><p>  In this article, we will discuss one problem with the JobIntentService, about which there are many questions on the relevant resources and reports in the Google tracker bug.  And also about the reason for which, judging by everything, Google does not consider it a bug and will close these reports. </p><a name="habracut"></a><br><h2 id="vvedenie">  Introduction </h2><br><p>  JobIntentServices were created for background work.  They are widely used in Android 8 and above, when the ability to use services in the background has disappeared. <br>  In essence, they replace services in the background, as well as being managed by a task scheduler (JobScheduler). </p><br><p>  Thus, the system has the ability to control the progress of tasks in the background as well as manage wakelockes, which allowed optimizing the device‚Äôs battery consumption and avoiding incorrect use of wakelock developers.  These steps allowed to minimize the situation when the device cannot plunge into sleep mode (Doze Mode), which again affects the battery saving. </p><br><h2 id="korotko-o-jobintentservice">  JobIntentService in brief </h2><br><p>  In essence, a JobIntentService is the same IntentService under the control of a task scheduler (JobScheduler). </p><br><p>  It is executed in the AsyncTask background thread. </p><br><p>  In versions of Android 4.4 and below, the usual IntentService is used. </p><br><p>  <a href="https://developer.android.com/reference/android/support/v4/app/JobIntentService">A detailed description can be found in the documentation.</a> </p><br><h2 id="zhiznennyy-cikl-i-podvodnye-kamni">  Life cycle and pitfalls </h2><br><p>  Both types of tasks have the same life cycle.  Tasks are controlled by Handler and have states. </p><br><p>  Although these states are not accessible from the outside, under certain circumstances, the system throws exceptions in which the application ‚Äúcrashes‚Äù.  These behaviors are a problem and a headache for many developers and unfortunately do not have a simple solution.  To begin with, we will study the states and the life cycle of tasks, and then we will look at possible solutions. </p><br><h4 id="posledovatelnost-sostoyaniy-zadach">  Sequence of task states </h4><br><p><img src="https://habrastorage.org/webt/ix/nu/if/ixnuifwlnlnsdr6m9ong9riwdd0.png" alt="image"><br>  <em>BINDING</em> - task creation status (service binding) timeout 18 seconds. <br>  <em>STARTING</em> - task start status, timeout 8 seconds. <br>  <em>EXECUTING</em> - task execution status, timeout 10 minutes. <br>  <em>STOPPING</em> - the task stop state (for example, after calling cancel ()), timeout 8 seconds. <br>  <em>FINISHED</em> - the final state of the completed task, the last state in the life cycle of the task. </p><br><h4 id="uproschennaya-shema-zhiznennogo-cikla-zadach">  Simplified task life cycle diagram </h4><br><p><img src="https://habrastorage.org/webt/ys/rm/t3/ysrmt3elk_ymztwmtymubn94ea0.png" alt="image"><br>  Each task state has its own timeout.  When the timeout expires, the task is interrupted regardless of its state.  Actually, this is a timeout mechanism and is a pitfall.  after the timeout expires, the system throws an exception of type <code>java.lang.SecurityException</code> and the application ‚Äúcrashes‚Äù with the following message <code>Caller no longer running, last stopped +1s600ms because: timed out while starting</code> when the exception is thrown, and ‚Äúreason‚Äù ( <code>because: timed out while starting</code> ) indicates the state of the task when the timeout has expired. </p><br><h2 id="vyvody">  findings </h2><br><p>  Experience shows that these exceptions are found in pretty loaded applications. </p><br><p>  In confirmation of this problem, one can observe both on weak and on top devices.  This problem is also indicated by thrown exceptions with messages about timeouts.  Accordingly, the decision about unloading the application and optimizing the use of JobIntentService, for example, to avoid situations when several JobIntentService are launched in parallel, suggests itself.  The second solution, in some cases more trivial, and sometimes more difficult the first option - is to use the JobService. </p><br><p>  Also, if you google this problem, you can stumble upon other "dubious" solutions to this problem, for example, you can see the following links: </p><br><p>  <a href="https://issuetracker.google.com/issues/63622293">Option 1</a> <br>  <a href="https://github.com/evernote/android-job/issues/255">Option 2</a> <br>  <a href="https://stackoverflow.com/a/50750543/1289285">Option 3</a> </p><br><h2 id="p-s">  PS </h2><br><p>  At the moment, Google is preparing a good replacement for JobService and JobIntentService - this is Worker and WorkManger from the androidx.work package. </p><br><p>  Unfortunately, these tools are not yet ready for production and have a number of bugs, but already now, as tests have shown, they solve the problem described above. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/432576/">https://habr.com/ru/post/432576/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432564/index.html">Rust 2018 came out ... but what is it?</a></li>
<li><a href="../432566/index.html">Two worlds or "engineers have something to say." About the various types of complex tasks and processes associated with them</a></li>
<li><a href="../432568/index.html">‚ÄúWhen you are the editor in chief of Rusbase‚Äù: a new podcast about working with content and a career in technology media</a></li>
<li><a href="../432572/index.html">Metal-air transistor will extend Moore's law - how technology works</a></li>
<li><a href="../432574/index.html">Difficult development of simple devices</a></li>
<li><a href="../432578/index.html">China confirms leadership in the Asian lunar race</a></li>
<li><a href="../432580/index.html">What is the AI ‚Äã‚Äãpierced when generating human faces?</a></li>
<li><a href="../432584/index.html">China leads the way in the development of quantum cryptography systems</a></li>
<li><a href="../432586/index.html">Atomic CSS - order and cleanliness</a></li>
<li><a href="../432590/index.html">How Emelya went on Ludum Dare</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>