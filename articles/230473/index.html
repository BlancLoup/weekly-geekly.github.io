<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Marlight: lamps for programmers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Marlight is a RGBW LED bulb controlled by a 2.4 GHz radio channel. It can be controlled both from the remote control, which directly transmits on the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Marlight: lamps for programmers</h1><div class="post__text post__text-html js-mediator-article">  Marlight is a RGBW LED bulb controlled by a 2.4 GHz radio channel.  It can be controlled both from the remote control, which directly transmits on the frequency of the light bulb, and with the help of a router, which is connected in your home Wi-Fi.  With the help of a router that transmits commands sent to it over the network in the radio package for a lamp, lamps can be controlled from a mobile application, computer or home server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb7/567/dc9/cb7567dc9e3c045fcbc1f113eb39dd0a.jpg" alt="image"><br><br>  I told earlier about the system for a smart home - NooLite ( <a href="http://habrahabr.ru/company/boxowerview/blog/165131/">1</a> , <a href="http://habrahabr.ru/company/boxowerview/blog/168039/">2</a> ), but its main drawback for ordinary users is that it must be installed using terminals, a soldering iron, cutting wiring, and so on.  The downside is the high ability to customize everything to your liking, but it is not always necessary.  This time I will talk about a system that has similar functions, but is designed for ordinary people - all you need to do to install it, is to simply screw the light bulb into the cartridge. <br><a name="habracut"></a><br><h4>  Kit </h4><br>  The whole system consists of three things - the bulb itself, the console and the router, each of which can be bought separately: <br><img src="https://habrastorage.org/getpro/habr/post_images/d4c/3d6/3d0/d4c3d63d02f50851d23f72c39031c858.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Lamp </h5>  The lamp box looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/16d/d35/90e/16dd3590e4b1f63dde454915c5f1750c.jpg" alt="image"><br>  Inside is a lamp packed in plastic: <br><img src="https://habrastorage.org/getpro/habr/post_images/2d0/fd5/7a4/2d0fd57a40e5c95adff75902a59c7b63.jpg" alt="image"><br>  And that's it!  There is nothing more inside, it is implied that a lamp that has no buttons or other controls does not need instructions.  By the way, the packaging is strong enough - only one of more than 1000 lamps that have passed through the store was damaged - the basement was crushed a little.  I had this very handy, and now we have the opportunity to see what is inside it, the truth about it a little further. <br><br>  So, the lamp: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8aa/c53/62f/8aac5362f9bdd9a5ffe4486c2c2cb303.jpg" alt="image"><br><br>  It has a base E27 - standard for household lamps: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f77/6a8/240/f776a8240f8838ec985a166c05ba522d.jpg" alt="image"><br><br>  To understand the size, you can put it next to the Ikea lamp - <a href="http://www.ikea.com/ru/ru/catalog/products/70242289/">SPARSAM</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f8/b7a/979/6f8b7a9795396598d8d408885feb8e22.jpg" alt="image"><br><br>  It would be nice to compare with the incandescent lamp, but I could not find one in the house.  It is convenient to compare them also because they are approximately the same in brightness, but Ikeevskaya is much more yellow. <br><br>  Their weight is also similar, Spars weighs 185 grams: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/66f/2b7/214/66f2b72146ab3c565ad2cd4d41b6c016.jpg" alt="image"><br><br>  And marlite 179: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2db/6aa/eb9/2db6aaeb99b8dc02ba65b5a6eb7a878e.jpg" alt="image"><br><br>  Such a small light bulb weight is due to the thick aluminum housing, which serves as a radiator for LEDs. <br>  To compare the brightness of two lamps, I photographed them in the same position on the same settings (1/100, 2.8, 400): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f2/d3f/437/6f2d3f43731ed092d82d4b002133b00d.gif" alt="image"><br><br>  It turned out that marlight at maximum settings is even slightly brighter.  Do not pay attention to what is being illuminated in different ways, because this is the lamp from which I removed the diffuser (why - it will become clear later). <br><br><h5>  Remote controller </h5><br>  The control panel looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ea/f46/fa3/3eaf46fa306bb27b822fc33da16ad8de.jpg" alt="image"><br><br>  You can see the box in the title photo, so there‚Äôs no point in showing it.  Components of the console are much richer than the lamp - it has a whole instruction in the kit: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c8/db5/3b0/3c8db53b0e21736b8b914defd58520d8.jpg" alt="image"><br><br>  The remote, by the way, works on three AAA batteries (which are not included): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/90a/5eb/0f8/90a5eb0f8598b8a2b955814cbb73820f.jpg" alt="image"><br><br>  The most interesting thing in the console (besides the viscera, of course) are the controls: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aaa/ad7/000/aaaad700069ff057dc5d9a13b537b476.jpg" alt="image"><br><br>  In order not to talk about which button is responsible for what, I drew such a picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5fd/83a/b7b/5fd83ab7b5d18db774918bdd0a3c26d6.jpg" alt="image"><br><br>  She entered into <a href="https://github.com/vvzvlad/marlight-wifi/blob/master/text_img_data/rus_manual.pdf%3Fraw%3Dtrue">our leadership</a> .  We had to write a normal manual, because the one that comes with is not only written in bad English, but still incomplete and partly contradictory. <br><br>  At the bottom of the remote - channel control buttons.  As in the case of NooLite, the lamps are tied to the console, and not vice versa.  In the sense that the remote control code (more precisely, the channel code on the remote control) is written to the lamp, from which it will receive commands. <br><br>  Each console has 4 channels. Each channel is controlled by two buttons - turn it on and off.  The power button is also the channel activation button ‚Äî all the top controls (color change, brightness, light temperature) are applied to the last active channel, i.e.  to the channel where you last pressed the power button.  If the lamps were turned off, after pressing it, they will turn on in the ‚Äúwhite light‚Äù mode with the previous setting of brightness and color temperature.  If the lamps are already burning, then nothing will happen, but the remote will remember this channel, and all the following commands using the upper buttons will give this channel. <br><br>  You can attach as many lamps as you like to each channel, as long as they are in the coverage area of ‚Äã‚Äãthe console.  For example, in this video, the dude controls a bunch of bulbs at once: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Fy62hv9_jbs%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhh8uQB3QO2Xw6TWKw4-8BQvLSaRxA" frameborder="0" allowfullscreen=""></iframe><br><br>  One of my colleagues, who really liked these lamps (hello, <a href="http://habrahabr.ru/users/fundorin/" class="user_link">fundorin</a> ), bought 11 pieces at once and put them in all the rooms in the house.  4 channels of the console - 4 places in the house: kitchen, toilet-bathroom, living room and corridor.  It turned out that from one remote control you can control the lighting in the whole apartment from anywhere.  He says it is very convenient, especially turning off the light already lying in bed and dimming while lying in the bath. <br><br>  Each console has serial numbers for different channels, so two remotes can control 8 sets of lamps, and neighbors cannot turn on the kitchen light when going to the toilet at night. <br><br><h5>  The control unit - a router </h5><br>  Light bulbs, controlled from the remote - of course, cool, on the smart home well, in general, does not pull.  The most interesting thing starts when it becomes possible to connect the lamps to a computer and set up some automation.  For this purpose, a connector router is used in such a box: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd3/a9b/d09/fd3a9bd091eda6d1ea1bbc11ee1b5462.jpg" alt="image"><br><br>  Her bundle is even richer than the console - in addition to the manual, she also has power cables in the kit! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f0/7fa/ee9/6f07faee989a761eeee1297b539e6b78.jpg" alt="image"><br><br>  Despite the USB connector, the wire is only for power - connecting the router connector to the computer will not work.  No, of course, it will work, but there will be no difference compared to the power supply.  It also does not have a LAN connector, all communication is via wireless connections.  He can either create his own WiFi network, or connect to an existing one. <br><br>  Of the interactive elements on the body of the connector, there are three LEDs: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/09f/fa2/c14/09ffa2c144cfc3740d7bd80e1db3ec9e.jpg"><br><br>  As well as a microUSB connector for power and a hole in which the reset button is hidden: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e91/704/2f6/e917042f6e88a2556e7e573ac99fcd9c.jpg" alt="image"><br><br>  All the necessary data for the first connection to the router are written on it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/43b/d90/6a8/43bd906a8bc57b5471ccb213371cead5.jpg"><br><br>  Therefore, we will not even open the instruction - we translated everything we needed into Russian and added it to our file. <br><br><h4>  What's inside? </h4><br><h5>  The control unit - a router </h5><br>  Of course, without disassembling the device at least once, you cannot be considered its full-fledged owner.  We start with the router.  Do not pay attention to the warranty label - just when you are a company that provides a guarantee. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62f/c73/f4e/62fc73f4e9dd357e886d11639f0c4b16.jpg"><br><br>  It is easy to disassemble it - there are no screws or cunning fasteners.  All that is needed is to pry the bottom cover with something flat and durable to pull it out of the latches: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe3/776/10f/fe377610f038bad70ccd1403a04508ef.jpg"><br><br>  After removing the cover, we see the bottom part of the board, which is not interesting to look at. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d2/243/911/1d22439112a6e1cdb0f9b84d9b094ac9.jpg"><br><br>  But the reverse side is much more interesting: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/953/11a/fca/95311afca2142807a24cdab8516988a4.jpg" alt="image"><br><br>  On it, we see a 2.4 GHz transmitter with an unmarked microcircuit: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85e/b7a/b04/85eb7ab04ad2ed351370fb10b84f6a64.jpg" alt="image"><br><br>  Like the main controller: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c5/868/3d4/1c58683d4ca75d8c8f27b05bb1f7d4e1.jpg" alt="image"><br><br>  I do not understand why ordering controllers without labeling, if the firmware still cannot be counted.  What will give the absence of marking?  Well, okay, it is necessary to ask the Chinese.  We go further and see the RTC chip - a real-time clock called <a href="http://datasheets.maximintegrated.com/en/ds/DS1302.pdf">DS1302</a> .  This is such a specialized microcircuit that deals only with one thing - time counts.  True, she does it perfectly - with good accuracy and very low power consumption - from a CR2032 battery it can work for about two years, even if it has not been connected to the power supply all this time. <br><br>  For the very calculation of time, the ‚Äúhourly‚Äù quartz is located next to the hard-to-remember frequency of 32768 Hz, which is simply a twain of 15 degrees.  It is enough to reduce this frequency by 15 times in a row and we get a frequency of 1 Hz - a tick every second. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/210/38e/d14/21038ed14074b8c1d6371fb857c64b09.jpg" alt="image"><br><br>  Go ahead.  There is only a Wi-Fi module with a <a href="http://habrahabr.ru/post/109395/">UART</a> interface: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3c/891/a8a/c3c891a8a2120f0e9f9390019617ebac.jpg" alt="image"><br><br>  He is actually responsible for communicating with the local network of your router or creating your own. <br><br><h5>  Lamp </h5><br>  Now we analyze the lamp itself.  In general, unlike the console and the router, it is completely non-separable (but the most interesting).  For example, the first stage of disassembly involves cutting with a hot knife or cutting a plastic diffusing dome: <br><br><img src="https://habrastorage.org/getpro/habr/comment_images/562/ac8/3cd/562ac83cd9e7d2c78490a0748b4a1bbf.jpg" alt="image"><br><br>  By the way, it is rather thick - almost 3 mm thick: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/30b/67d/96f/30b67d96fb76c3f031c45cbb79091609.jpg" alt="image"><br><br>  To break a lamp with such plastic is difficult.  After trepanning the lamp, we get access to the main board: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/424/005/d49/424005d49997dbc771d76b6e7499617e.jpg" alt="image"><br><br>  As we can see, 30 LEDs are used for illumination - 24 white LEDs (12 warm LED and 12 cold LEDs) and 6 RGB LEDs.  RGB LEDs are responsible for color lighting, and white, respectively, for white. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/298/4c0/40f/2984c040f5d64aeaa478f319efcb491b.gif" alt="image"><br><br>  Moreover, as can be seen on the gif, at the same time, two types of LEDs do not work at full power - even though this would increase the brightness, it would require more cooling and a more powerful power supply.  And the brightness would change during temperature control. <br>  The disassembled lamp, by the way, to shoot without a lens is just awful, it turns out like <a href="http://instagram.com/p/q2gRwXsU7c/">this</a> (by the way, <a href="http://instagram.com/vvz_vlad">subscribe</a> ). <br><br>  In the center is the radio module, already familiarly completely without marking: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/783/500/c8a/783500c8a3682c77c0094a7af46e829a.jpg"><br><br>  Under it is the controller: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/391/e0f/286/391e0f286e351509725464051c4ce03f.jpg" alt="image"><br><br>  This is <a href="http://www.st.com/web/en/resource/technical/document/datasheet/DM00024550.pdf">STM8</a> controller <a href="http://www.st.com/web/en/resource/technical/document/datasheet/DM00024550.pdf">STM8S003F3</a> , completely normal - 16MHz, 8 Kb of memory.  The controller communicates with the radio module on the SPI. <br><br>  To get to the lamp power supply, you need to cut off the lamp base in a similar way: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/283/928/d2b/283928d2b6ed686c22728cc4f21df96b.jpg" alt="image"><br><br>  And then climb the soldering iron deep and solder the power wires: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97d/29d/59e/97d29d59e1cb9e60d1556bc9d752f644.jpg" alt="image"><br><br>  What fell off after that from the light bulb is the power supply: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b9/812/0ca/2b98120ca3fc873c202cbaaf026d7a85.jpg" alt="image"><br><br>  The power supply is built on a single chip <a href="http://www.mouser.com/ds/2/328/linkswitch-ii_family_datasheet-8160.pdf">LNK606</a> , which is quite unusual for Chinese devices. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/541/958/4a6/5419584a6ea3b0682cbaae99c9897e49.jpg" alt="image"><br><br>  LNK606 is a LinkSwitch-II series chip designed specifically for the manufacture of power supplies.  Due to the fact that they monitor completely all the parameters of the power supply, its scheme is very simple: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1e/e25/273/b1ee25273a513a468c7ea9a626c301d4.png" alt="image"><br><br>  At the same time we get protection against short circuits, low network consumption without load, thermal protection and good efficiency. <br><br>  So, back to the LEDs: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/276/bc0/40c/276bc040c211b91de7246608ab977166.jpg" alt="image"><br><br>  White LEDs are the same, differ only in the type of phosphor.  "White" LEDs - in fact, blue or ultraviolet, exactly that vyrviglaznogo shade that shines us right in the eye at night.  White makes them yellow substance - phosphor, which absorbs blue light and re-emits it in a different range.  Combining different substances in its composition can achieve different shades of white, such as cold or warm, as was done here.  A big plus of phosphor LEDs is a smooth spectrum unlike RGB assemblies: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c2/b74/d5c/0c2b74d5c4f1cbd8429617c380ba56ca.png" alt="image"><br><br>  This has a positive effect on the quality of lighting - such LEDs have a higher color rendering index - <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D0%25B4%25D0%25B5%25D0%25BA%25D1%2581_%25D1%2586%25D0%25B2%25D0%25B5%25D1%2582%25D0%25BE%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B0%25D1%2587%25D0%25B8">CRI</a> , despite the fact that they can look at first glance like assemblies - emit about the same white light.  But there is a nuance! <br><br>  Since the color of an object determines what part of the spectrum reflects its surface, an interesting situation may arise when the spectrum of light incident on the object simply lacks a part that is reflected by the object.  For example, we have a blue object that reflects waves with a length of 450 nm.  If we shine this object with sunlight, then everything is fine: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/81e/871/758/81e871758d6a59b35af06ebae54bcb3b.png" alt="image"><br><br>  The spectrum contains waves of this length and they are successfully reflected by the subject.  And if we illuminate this object with a light source, whose spectrum does not look like that of sunlight?  It turns out that: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bf6/c52/f14/bf6c52f1498f6f72f72ddaf0dba1e983.png" alt="image"><br><br>  This, however, about fluorescents, but not the essence.  A lamp in the spectrum simply lacks some of the waves of this length, although it seems to us to be as white as the sunlight.  Since there are no waves in the spectrum, the object has nothing to reflect, it will look dark. <br><br>  Of course, everything is more complicated in life - <a href="http://habrahabr.ru/post/229825/">almost</a> any surface reflects not only one specific wavelength, almost always capturing the infrared and ultraviolet range, so a blue object most likely will not look black with such lighting.  But here you can easily get all sorts of problems with color perception.  Therefore, printers never show the result to the client in the workshop, only in the office, only under halogen or incandescent lamps. <br><br>  In short, phosphor LEDs - this is good, and only they should be used to illuminate the workplace.  And that someone did not know? <br>  In general, all normal white LED lamps use phosphor LEDs, and I say this simply to the fact that Marlight can be used to illuminate the workplace, if you are satisfied with its brightness. <br><br>  However, in the lamp RGB-assembly is still there, but they are used to display all the other colors.  Here is one of the three-color LEDs closer, you can see three different crystals and wiring to them: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5de/2e1/740/5de2e17402c5042678288b74c0708038.jpg" alt="image"><br><br>  True, in my opinion, the colors are very concentrated and pure, I would like it more if they could be mixed with white to create different shades. <br><br>  Another scourge of LED lighting - flicker.  The LED, in contrast to the incandescent lamp, does not have thermal inertia, and if we turn on the LED directly into the network, as they do in cheap corn lamps, the LEDs blink 100 times per second, which is well noticed with fast eye movements or objects - a <a href="http://ammo1.livejournal.com/418344.html">pencil test</a> .  There we are talking about monitors, but for lighting it works.  Here, for example, looks like a "power supply" in one of the lamps in my house: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2f/507/8d1/e2f5078d1a735450d34bc83fba887278.jpg" alt="image"><br><br>  Use it to illuminate the premises, of course not.  It is in the toilet. <br>  Again, in normal lamps there is no such problem - there, as in marlaite, there is a power supply unit that converts the mains voltage to the right (constant) for the LED, eliminating flicker at all.  More precisely, eliminating the flicker at maximum brightness, because the brightness decreases the <a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-shim.html">PWM</a> th, usually low frequency.  Since we have disassembled the light bulb, connect an oscilloscope to it and take a look at how the brightness change works here: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d58/524/d77/d58524d77efce81451476f933680f137.jpg" alt="image"><br><br>  Now you can turn on the light bulb and look at what is happening with the oscilloscope probes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b14/60f/299/b1460f2996fcdcc0c9cdb8409ec0330f.jpg" alt="image"><br><br>  When it is turned on at full brightness, no ripples are expected: <br><br><img src="https://habrastorage.org/files/7fe/618/f5f/7fe618f5fae5485aa4dd7cf97111804e" alt="image"><br><br>  Two channels of the oscilloscope are connected to the channels of warm and cold LEDs.  In this case, the "warm" LEDs are lit at full capacity, and the "cold" ones are turned off altogether, which is what we see in the picture. <br><br>  And now reduce the brightness of the button on the remote or in the application: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ed/49c/a71/6ed49ca71f3fe132fffbe69f0896b4b5.png" alt="image"><br><br>  Now the constant glow of the LED periodically stops, and the human eye perceives it as a decrease in lighting due to its inertia.  240 Hz - the frequency is not very large, but coupled with a good diffuser, the eyes at medium brightness do not particularly interfere. <br><br>  Here is the change of brightness in the dynamics: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b4/aea/729/1b4aea729d62ed55c36ab34734f7687c.gif" alt="image"><br><br>  Now let's change not the brightness, but the color temperature: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/70f/3be/35c/70f3be35cc4ec2150c3fe5a19547b2ee.png" alt="image"><br><br>  Obeying the fill plate, protected inside the controller, the ‚Äúcold‚Äù LED turned on at 20% brightness along with white in order to shift the temperature of the light to the cooler one.  But at the same time, to avoid changing the brightness (part of the cycle, both LEDs work together), the ‚Äúwarm‚Äù at the end of the cycle turned off exactly at the time when the ‚Äúcold‚Äù was turned on, and thus the total brightness of the whole lamp did not change.  If you turn on the temperature in the "average" mode, then both LEDs will work the same time, and it will look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c71/bb9/b08/c71bb9b089342b63cabfbaec320b3436.png" alt="image"><br><br>  And this is how it looks in the form of animation, here the light in the first frame works in the ‚Äúonly warm‚Äù mode, then gradually goes to the ‚Äú10% warm, 90% cold‚Äù mode, and then comes back. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27c/b35/e71/27cb35e71dcbd6e47efa0ed5bdebec05.gif" alt="image"><br><br>  To disassemble what is left of the lamp, you need to unscrew the two screws (blue arrows), and then unsolder the connection points of the processor board to the LED board (red arrows): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/714/a9b/0b6/714a9b0b6ab41f6211c6ef7eef157a65.jpg" alt="image"><br><br>  The boards are connected with a sandwich for a reason - the bottom board is aluminum, and the top one is made of PCB.  This is done in order to remove heat from the LEDs, but at the same time not to experience problems with two-sided installation on an aluminum board.  By the way, its thickness is 1.5mm: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/369/347/933/369347933b3c3509d8e0ca7919aea5b3.jpg" alt="image"><br><br>  Now, if you hook the aluminum board with something curved and pull, it is not without difficulty, but it will be separated from the radiator: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/21a/699/632/21a6996323a17342f4453c8b0040c6b4.jpg" alt="image"><br><br>  Between the bottom board and the radiator there is a thermal interface layer applied - the same as that used on the heatsinks for the processor. <br><br>  In the hand there remains such a solid aluminum radiator, which makes up most of the lamp's weight: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e1/ec2/856/5e1ec2856110c9a46293ee8ab33bef39.jpg" alt="image"><br><br><h5>  Remote controller </h5><br>  With sadness (because this is the last thing that can be disassembled), open the console: <br><img src="https://habrastorage.org/getpro/habr/post_images/cd1/908/495/cd1908495666b9d95c9f079da1207899.jpg" alt="image"><br><br>  The upper part is the sensory ring: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/78f/2f4/54c/78f2f454cea8ea40e0c046dba8415e48.jpg" alt="image"><br><br>  Similar to the <a href="http://www.st.com/st-web-ui/static/active/en/resource/technical/document/application_note/CD00222015.pdf">app</a> from ST: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/380/418/55a/38041855a4b592d3d758c9e2e989e3df.png" alt="image"><br><br>  The lower part - the buttons, the membrane for on-off channel, touch for all other functions: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c2/0bf/fee/5c20bffee8e695fe478cacc065fe189d.jpg" alt="image"><br><br>  The reverse side is more interesting: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/249/221/1cd/2492211cd9fbc69b9ff5d27e6fac593c.jpg" alt="image"><br><br>  There are two unmarked chips: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e82/4e8/b7a/e824e8b7a58d47286ba2407f0190eba0.jpg" alt="image"><br><br>  And the transmitter module already familiar to us: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7f/06f/fb5/b7f06ffb5d4cfc5bec246c377787d293.jpg" alt="image"><br><br><h4>  Control </h4><br>  About how to control the lamps with the remote, I have already described above.  Now let's talk about what applications can do.  To begin with, I will show the web panel of the router - it is quite simple.  You can configure the network in it, this is what the settings look like when the connector creates its wifi-socket network without encryption: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed6/c76/54b/ed6c7654bbbf6369ca5cd9de1b8d6b34.png" alt="image"><br><br>  And so the connector connects to the network as a client: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/753/dd5/79c/753dd579c62918a5cf72e70949440d71.png" alt="image"><br><br>  You can also change the login password there: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/254/683/c6d/254683c6de792c8204ee5711063a843f.png" alt="image"><br><br>  And reload it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c41/92c/365/c4192c365efe0c9b3674fdbfa4afd906.png" alt="image"><br><br>  The remaining settings are not needed by the user and do not need to touch them, because it is fraught with the loss of the router before resetting - they relate to the settings of the TCP &lt;-&gt; UART transmission to the controller, which translates them into commands for the radio module. <br><br><h5>  Phone application </h5><br>  An application for controlling light bulbs is available for <a href="https://itunes.apple.com/ru/app/marlight/id687198712%3Fmt%3D8">iOS</a> and <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.fafu.marlight_android1%26hl%3Dru">Android</a> .  They are fairly simple in functionality, and in fact duplicate the buttons on the remote control.  Here is the iOS app: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f4/fce/f94/8f4fcef94049e62edd729a100696934c.png" alt="image"><br><br>  There is also a tablet application, but I don‚Äôt have it, so I won‚Äôt be able to show it.  Judging by the monotony of applications, even for different platforms, it will not be any different. <br><br>  As I said, for the android application is exactly the same, but it looks a little worse - in some places the buttons went. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/643/5ca/0e2/6435ca0e2f4e6c0edd68031600b458f0.png" alt="image"><br><br>  To get started, they need to specify the IP address and port.  Why did I not understand the possibility of setting up the port, although it can be changed in the web interface, but why this is necessary is not clear.  And in the Name field, in spite of the ‚ÄúUserName‚Äù prompt, it is necessary to enter not the ‚Äúadmin‚Äù, as written on the connector, but the name of the router.  However, you can also enter admin there, you just have a connector with the name in the admin program. <br>  As I said, the application functionality for the most part duplicates the console, except for the last screen.  There are collected presets that can not be reassigned, and some more functionality - a timer, alarm clock and so on. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2d/a26/df3/e2da26df34c16e6dfa76cb7b2f78265d.png" alt="image"><br><br>  So we would have lived with simple applications for the phone, if we had not unexpectedly written <a href="http://habrahabr.ru/users/efimomax/" class="user_link">Efimomax</a> , who bought a light bulb, and then conducted reverse engineering of the communication program of the mobile program and the connector (it was not very difficult) and wrote the implementation in PHP and C # in as a library and a simple application. <br><br><h5>  Computer application </h5><br>  <a href="http://habrahabr.ru/users/efimomax/" class="user_link">Efimomax</a> wrote a simple application, we were glad, thrown off in a general chat in Skype and forgot.  But this message was seen by our seller in the store on the <a href="http://habrahabr.ru/company/madrobots/blog/221697/">top crust</a> , and while bored waiting for customers, he wrote down such a beautiful application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d85/c65/e28/d85c65e28f0cea15ad681a071008cc76.jpg" alt="image"><br><br>  It is functional and works pretty well.  You can pick up the application with the source <a href="https://github.com/vvzvlad/marlight-wifi/tree/master/marlight_C%2523/Marlight_gui">here</a> .  Forks and pushrequests are welcome :) <br><br><h5>  Server application </h5><br>  Written in PHP, the HTML looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27f/b31/c78/27fb31c784bc617cdc3c7e766a2f5f55.png" alt="image"><br><br>  But this is not the most important thing.  The most important thing is that the script can transfer parameters from a web page or from the console. <br><br>  The script itself is quite simple, the main part of it is this function: <br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($udp_message)</span></span></span><span class="hljs-function"> </span></span>{ $message = vsprintf(str_repeat(<span class="hljs-string"><span class="hljs-string">'%c'</span></span>, count($udp_message)), $udp_message); <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $server_ip, $server_port, $delay, $debug, $error_value, $ok_value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($socket = socket_create(AF_INET, SOCK_DGRAM, SOL_UDP)) { socket_sendto($socket, $message, strlen($message), <span class="hljs-number"><span class="hljs-number">0</span></span>, $server_ip, $server_port); sleep ($delay); socket_close($socket); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $ok_value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $error_value; } }</code> </pre> <br><br>  The rest are commands, error handling, and so on. <br>  You can find it in <a href="https://github.com/vvzvlad/marlight-wifi/tree/master/marlight_php">Github</a> , fork and push quest as usual, welcome! <br>  You can use it as usual, passing it the parameters via the address bar: <pre> <code class="hljs objectivec">http:<span class="hljs-comment"><span class="hljs-comment">//192.168.12.1/marlight.php?command=RGB_MODE_SET_COLOR&amp;r=255&amp;g=10&amp;b=0</span></span></code> </pre> <br>  So calling it directly from the script inside the system: <pre> <code class="hljs bash">MBP-Zaytsev:~ vvzvlad$ php marlight.php <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=RGB_MODE_SET_COLOR&amp;r=255&amp;g=10&amp;b=0</code> </pre> <br><br><h4>  Total </h4><br>  Quite an interesting device that is quite suitable for an entry-level smart home.  Of course, not without flaws, and requiring some dopilki (read "writing control software"), but quite workable, well done and cool. <br><br><h4>  Links </h4><br>  <a href="https://github.com/vvzvlad/marlight-wifi">The repository</a> on github with source codes for <a href="https://github.com/vvzvlad/marlight-wifi/tree/master/marlight_php">PHP</a> and <a href="https://github.com/vvzvlad/marlight-wifi/tree/master/marlight_C%2523">C #</a> . <br><br><h4>  Where to buy and how much? </h4><br>  Of course, in our store: <br>  <a href="http://madrobots.ru/catalog/ustroystva_upravlyaemye_so_smartfona/marlight-wifi-lampochka/">Lamp in the store</a> : 990 rubles <br>  <a href="http://madrobots.ru/catalog/ustroystva_upravlyaemye_so_smartfona/marlight-wifi-konnektor/">Router in the store</a> : 990 rubles <br>  <a href="http://madrobots.ru/catalog/ustroystva_upravlyaemye_so_smartfona/marlight-pult-upravleniya/">Remote in the store</a> : 690 rubles <br>  And you can also come to our <a href="http://madrobots.ru/about/">offline store</a> on the crust and live to see, touch, smell, twist in your hands, and then ask to wrap. <br><br><h4>  Make an application for your favorite platform - get a set of Marlight </h4><br>  Due to the fact that the application for phones does not look <s>like shit</s> , and working with it is just as convenient, we are changing a set of five Marlight lamps, a console and a connector for an application for your favorite operating system or mobile platform! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/78f/803/13b/78f80313b73eaa16663a7ce21a8d5f58.png" alt="image"><br><br>  Conditions: <br><br><ol><li>  The action involves applications for the following platforms: <s>Android</s> , <s>iOS,</s> <s>Windows Phone</s> , <s>BlackBerry</s> , <s>Windows</s> , console for Linux / OpenWRT / DD-WRT, <s>MacOS</s> . </li><li>  The application and its source code must be published under the BSD license. </li><li>  The kit is transferred to the participant after he demonstrates the first version of the application with the design. </li><li>  Design and additional functionality and - at the discretion of the developer. </li></ol><br><br>  To participate, please email me at vz@madrobots.ru with the topic ‚ÄúMarlight Promotion‚Äù. <br><br> <a href="https://twitter.com/MadrobotsRu"><img src="https://habrastorage.org/files/ac1/fc6/d2a/ac1fc6d2a19948c59791b0da6ab659df.gif"></a> <a href="http://vk.com/madrobots"><img src="https://habrastorage.org/files/933/ac3/0b6/933ac30b6fd24ffd82218148c2fb0917.gif"></a> <a href="http://instagram.com/madrobotsru"><img src="https://habrastorage.org/files/464/a82/e04/464a82e045a34bae81406fd0b640cf08.gif"></a> <a href="http://facebook.com/madrobotsrussia"><img src="https://habrastorage.org/files/0b5/542/136/0b55421365064901acdf0ed58cc4a111.gif"></a> <br> <a href="http://madrobots.ru/"><img src="https://habrastorage.org/files/63d/405/78e/63d40578ecbf48f28c62f57705c73eb6.gif"></a> </div><p>Source: <a href="https://habr.com/ru/post/230473/">https://habr.com/ru/post/230473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230463/index.html">MakeItLab at the Innoprom 2014 exhibition</a></li>
<li><a href="../230465/index.html">The landing of a man on the moon turned 45 years old</a></li>
<li><a href="../230467/index.html">FSB and user data</a></li>
<li><a href="../230469/index.html">Break open Asus RT-AC66U and prepare for SOHOpelesslyBroken CTF</a></li>
<li><a href="../230471/index.html">IPTV from MGTS: channel search</a></li>
<li><a href="../230477/index.html">WebCamp 2014 Live Webcast</a></li>
<li><a href="../230479/index.html">3 worst things you can do with Linq to Database</a></li>
<li><a href="../230481/index.html">The digest of interesting news and materials from the world of PHP No. 44 (July 1 - 20, 2014)</a></li>
<li><a href="../230483/index.html">Lightning bolts</a></li>
<li><a href="../230487/index.html">Macros in Vim are just</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>