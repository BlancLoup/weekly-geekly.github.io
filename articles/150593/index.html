<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is Windows Azure Media Services and how can they be used?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you follow the cloud news, you probably already know that Windows Azure Media Services was used to broadcast the 2012 Olympic Games in London . 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is Windows Azure Media Services and how can they be used?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/e8c/100/191/e8c1001919e4f0e8460249dc10ea4b0a.png"><br>  If you follow the cloud news, you probably already know that <a href="http://habrahabr.ru/company/microsoft/blog/150115/">Windows Azure Media Services was used to broadcast the 2012 Olympic Games in London</a> . <a name="habracut"></a><br><br>  Let's see what they are and how they can be used. <br><br>  If to simplify a little, then <a href="http://www.windowsazure.com/en-us/home/features/media-services/">Windows Azure Media Services</a> is technologies of the <a href="http://www.microsoft.com/en-us/mediaplatform/">Microsoft Media Platform platform</a> , and also our partners transferred mostly to the cloud.  In other words, on the one hand, it is proven and familiar solutions, on the other hand, the ability to scale these solutions and integrate them into their own processes of encoding, broadcasting and distribution of media content. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Windows Azure Media Services provides the following services for building your own media services and applications: <ul><li>  content download, </li><li>  transcoding </li><li>  format conversion, </li><li>  content protection </li><li>  broadcast on demand and </li><li>  live broadcast as well </li><li>  analytics and advertising. </li></ul><br>  Or, if you present all of the above in the form of a diagram, the architecture of Windows Azure Media Services will look like this: <img src="https://habrastorage.org/storage2/0c7/c71/080/0c7c71080df69ca11f0d0f3b5acf7511.png"><br><br>  If you take a closer look at the scheme, you can see another great feature of Windows Azure Media Services - they can be a source of media content for almost all types of devices currently on the market: from desktop computers to set-top boxes or smartphones. <br><br>  And, of course, this remarkable functionality is available to the developer through the REST API, which allows you to develop solutions based on Windows Azure Media Services using any familiar, convenient or, for example, standard in the organization of technology.  Developers on the .NET platform have access to the Windows Azure Media Services SDK for .NET, which conveniently wraps the provided REST API. <br><br>  So now you have a general idea of ‚Äã‚Äãwhat Windows Azure Media Services is.  Let's take a closer look at them. <br><br><h4>  Development of customer service </h4><br><h6>  Mac and PC </h6>  Now you can develop for Mac and PC using Microsoft Silverlight.  After some time, the SDK will be available for developing the client in Flash.  Available Silverlight SDKs: <br>  <a href="http://www.iis.net/download/smoothclient">Smooth Streaming Client for Silverlight</a> <br>  <a href="http://smf.codeplex.com/documentation">Microsoft Media Platform: Player Framework for Silverlight</a> <br><br><h6>  Windows 8 </h6>  To develop WinRT applications under Windows 8, you can develop in HTML / JS, C # or C ++ using the following SDKs: <br>  <a href="http://go.microsoft.com/fwlink/%3FLinkID%3D246146">Smooth Streaming Client SDK for WinRT Windows 8applications</a> <br>  <a href="http://playerframework.codeplex.com/wikipage%3Ftitle%3DPlayer%2520Framework%2520for%2520Windows%25208%2520Metro%2520Style%2520Apps%26referringTitle%3DHome">Microsoft Media Platform: Player Framework for WinRT Windows 8 Applications</a> <br><br><h6>  Windows phone </h6>  Microsoft provides an SDK for building video applications on Windows Phone. <br>  <a href="http://www.iis.net/download/smoothclient/">Smooth Streaming Client for Silverlight</a> <br>  <a href="http://smf.codeplex.com/documentation/">Microsoft Media Platform: Player Framework for Silverlight</a> <br><br><h6>  iOS devices </h6>  For iOS devices, including the iPhone, iPod, and iPad, Microsoft ships the Smooth Streaming SDK for iOS Devices with PlayReady. <br>  Smooth Streaming SDK for iOS Devices with PlayReady <br><br><h6>  Android devices </h6>  Microsoft partners develop and deliver SDKs for these devices. <br><br><h6>  Xbox </h6>  Xbox supports Xbox LIVE apps with Smooth Streaming.  The Xbox LIVE Application Development Kit (ADK) contains: <br>  Smooth Streaming client for Xbox LIVE ADK <br>  Microsoft Media Platform: Player Framework for Xbox LIVE ADK <br><br><h6>  Embedded and other devices </h6>  For embedded devices, such as TVs, set-top boxes, media players, etc., that is, for devices with their own framework to develop and work with media content, you can license packages for porting: <br>  <a href="http://www.microsoft.com/en-us/mediaplatform/sspk.aspx">Smooth Streaming Client Porting Kit</a> <br>  <a href="http://www.microsoft.com/PlayReady/Licensing/device_technology.mspx">Microsoft PlayReady Device Porting Kit</a> <br><br><h4>  Work with the service part </h4>  To start working with Windows Azure Media Services, you must first create them in your Windows Azure management portal (it is currently in beta): <br><img src="https://habrastorage.org/storage2/999/550/cda/999550cdaa756a08bb006a49dfe0731b.png"><br><br>  After the service state of the service is Active - it is ready to work. <br><img src="https://habrastorage.org/storage2/db3/f16/8f3/db3f168f3b9d5f92e60dccc428c44f7d.png"><br><br>  After that, if you are a developer on .NET, and you already have Visual Studio 2010 SP1 installed, you need to install: <ul><li>  Windows Azure SDK 1.6 using <a href="http://go.microsoft.com/fwlink/%3Flinkid%3D255386%26clcid%3D0x409">Web Platform Installer</a> </li><li>  <a href="http://go.microsoft.com/fwlink/%3FLinkID%3D256500%26clcid%3D0x409">Windows Azure Media Services SDK for .NET</a> </li><li>  <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D29306">WCF Data Services 5.0 for OData v3</a> </li></ul><br>  Now you are fully prepared to develop applications using Windows Azure Media Services. <br><br>  Let's create a simple application that works with Windows Azure Media Services. <br><br>  Create a project for .NET Framework 4 in Visual Studio. Add the following libraries to the project in the Reference: <br><div class="spoiler">  <b class="spoiler_title">Microsoft.WindowsAzure.MediaServices.Client.dll</b> <div class="spoiler_text">  \ Program Files (x86) \ Microsoft SDKs \ Windows Azure Media Services \ Services SDK \ v1.0 \ </div></div><br><div class="spoiler">  <b class="spoiler_title">Microsoft.WindowsAzure.StorageClient.dll</b> <div class="spoiler_text">  \ Program Files \ Windows Azure SDK \ v1.6 \ bin \ </div></div><br><div class="spoiler">  <b class="spoiler_title">Microsoft.Data.Edm.dll</b> <div class="spoiler_text">  (\ Program Files (x86) \ Microsoft WCF Data Services \ 5.0 \ bin \ .NETFramework \ </div></div><br><div class="spoiler">  <b class="spoiler_title">Microsoft.Data.OData.dll</b> <div class="spoiler_text">  (\ Program Files (x86) \ Microsoft WCF Data Services \ 5.0 \ bin \ .NETFramework \ </div></div><br><div class="spoiler">  <b class="spoiler_title">Microsoft.Data.Services.Client.dll</b> <div class="spoiler_text">  (\ Program Files (x86) \ Microsoft WCF Data Services \ 5.0 \ bin \ .NETFramework \ </div></div><br><div class="spoiler">  <b class="spoiler_title">Microsoft.Data.Services.dll</b> <div class="spoiler_text">  (\ Program Files (x86) \ Microsoft WCF Data Services \ 5.0 \ bin \ .NETFramework \ </div></div><br><div class="spoiler">  <b class="spoiler_title">System.Spatial.dll</b> <div class="spoiler_text">  (\ Program Files (x86) \ Microsoft WCF Data Services \ 5.0 \ bin \ .NETFramework \ </div></div><br>  System.Configuration <br><br>  Add to the app.config of your Media Services account setup application: <br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">supportedRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v4.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sku</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".NETFramework,Version=v4.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"accountName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Add-Media-Services-Account-Name"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"accountKey"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Add-Media-Services-Account-Key"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Add variables to the code that point to the local video file and the existing folder for the results: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _singleInputFilePath = Path.GetFullPath(<span class="hljs-string"><span class="hljs-string">@"C:\mediaFiles\interview.wmv"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _outputFilesFolder = Path.GetFullPath(<span class="hljs-string"><span class="hljs-string">@"C:\outputfiles"</span></span>);</code> </pre> <br><br>  Replace the using block in the file with the following: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Threading; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.WindowsAzure.MediaServices.Client;</code> </pre> <br><br>  Determine the variables that will contain your account data: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _accountKey = ConfigurationManager.AppSettings[<span class="hljs-string"><span class="hljs-string">"accountKey"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _accountName = ConfigurationManager.AppSettings[<span class="hljs-string"><span class="hljs-string">"accountName"</span></span>];</code> </pre> <br><br>  Define variables to reference the server context and the result of the work: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CloudMediaContext _context = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _outputAssetID = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> <br><br>  In the Main method, add the creation of the service context: <br><pre> <code class="hljs lisp">_context = new CloudMediaContext(<span class="hljs-name"><span class="hljs-name">_accountName</span></span>, _accountKey)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  Now you need to create and upload media data to the service: <br><pre> <code class="hljs pgsql">static IAsset CreateAndUploadAsset(string inputMediaFilePath) { IAsset theAsset = _context.Assets.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(inputMediaFilePath, AssetCreationOptions.StorageEncrypted); Console.WriteLine("Asset name: " + theAsset.Name); Console.WriteLine("Asset ID: " + theAsset.Id); Console.WriteLine("Time created: " + theAsset.Created.Date.ToString()); Console.WriteLine("Encrypted status: " + theAsset.<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span>.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> theAsset; } IAsset asset = CreateAndUploadAsset(_singleInputFilePath);</code> </pre><br><br>  For transcoding tasks on the server, we will create several auxiliary functions: <br><pre> <code class="hljs pgsql">//   static <span class="hljs-type"><span class="hljs-type">void</span></span> CreateEncodingJob(IAsset asset, string outputFolder) { IJob job = _context.Jobs.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("My Encoding Job"); //  - IMediaProcessor processor = GetMediaProcessor("Windows Azure Media Encoder"); //    ITask task = job.Tasks.AddNew("My encoding task", processor, "H.264 256k DSL CBR", TaskCreationOptions.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>); // ,   task.InputMediaAssets.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(asset); //  Asset    task.OutputMediaAssets.AddNew("Output asset", <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, AssetCreationOptions.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>); //  . job.Submit(); //        CheckJobProgress(job.Id); //    Job job = GetJob(job.Id); //     IAsset outputAsset = job.OutputMediaAssets[<span class="hljs-number"><span class="hljs-number">0</span></span>]; //     _outputAssetID = outputAsset.Id; //  SAS URL      string sasUrl = GetAssetSasUrl(outputAsset, TimeSpan.FromMinutes(<span class="hljs-number"><span class="hljs-number">30</span></span>)); //  URL    string outFilePath = <span class="hljs-type"><span class="hljs-type">Path</span></span>.GetFullPath(outputFolder + @"\" + "SasUrl.txt"); WriteToFile(outFilePath, sasUrl); }</code> </pre><br><br>  Secondary functions. <br><br>  We are waiting for the end of work and display the status in the console: <pre> <code class="hljs ruby">private static void CheckJobProgress(string jobId) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    bool jobCompleted = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   const int JobProgressInterval = <span class="hljs-number"><span class="hljs-number">20000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!jobCompleted) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     Job IJob theJob = GetJob(jobId); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       switch (theJob.State) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JobState.<span class="hljs-symbol"><span class="hljs-symbol">Finished:</span></span> jobCompleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Console.WriteLine(<span class="hljs-string"><span class="hljs-string">""</span></span>); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"********************"</span></span>); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Job state: "</span></span> + theJob.State + <span class="hljs-string"><span class="hljs-string">"."</span></span>); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Please wait while local tasks complete..."</span></span>); Console.WriteLine(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JobState.<span class="hljs-symbol"><span class="hljs-symbol">Queued:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JobState.<span class="hljs-symbol"><span class="hljs-symbol">Scheduled:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JobState.<span class="hljs-symbol"><span class="hljs-symbol">Processing:</span></span> Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Job state: "</span></span> + theJob.State + <span class="hljs-string"><span class="hljs-string">"."</span></span>); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Please wait..."</span></span>); Console.WriteLine(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JobState.<span class="hljs-symbol"><span class="hljs-symbol">Error:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-symbol"><span class="hljs-symbol">default:</span></span> Console.WriteLine(theJob.State.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } /<span class="hljs-regexp"><span class="hljs-regexp">/ ,      Thread.Sleep(JobProgressInterval); } }</span></span></code> </pre><br><br>  We are requesting a media processor: <pre> <code class="hljs pgsql">private static IMediaProcessor GetMediaProcessor(string mediaProcessor) { //         // MP4 <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Smooth Streams Task // Windows Azure Media Encoder // PlayReady Protection Task // Smooth Streams <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> HLS Task // <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span> Decryption // ,       var theProcessor = <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _context.MediaProcessors <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.Name == mediaProcessor <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p; //   IMediaprocessor. IMediaProcessor processor = theProcessor.First(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (processor == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentException(string.Format(<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Globalization.CultureInfo.CurrentCulture, "Unknown processor", mediaProcessor)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> processor; }</code> </pre><br><br>  Getting a Job Link: <br><pre> <code class="hljs pgsql">static IJob GetJob(string jobId) { //  Job  Id var job = <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _context.Jobs <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> j.Id == jobId <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> j; //     IJob theJob = job.FirstOrDefault(); // ,  Job  :) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (theJob != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> theJob; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Console.WriteLine("Job does not exist."); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br><br>  Getting SAS URL for encoding results: <br><pre> <code class="hljs pgsql">static String GetAssetSasUrl(IAsset asset, TimeSpan accessPolicyTimeout) { //   IAccessPolicy readPolicy = _context.AccessPolicies.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("My Test Policy", accessPolicyTimeout, AccessPermissions.<span class="hljs-keyword"><span class="hljs-keyword">Read</span></span>); //  locator,     asset    ILocator locator = _context.Locators.CreateSasLocator(asset, readPolicy, DateTime.UtcNow.AddMinutes(<span class="hljs-number"><span class="hljs-number">-5</span></span>)); Console.WriteLine("Locator path: "); Console.WriteLine(locator.Path); Console.WriteLine(); //    mp4  -     - <span class="hljs-type"><span class="hljs-type">xml</span></span> var theOutputFile = <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> asset.Files <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> f.Name.EndsWith(".mp4") <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> f; //  IQueryable  IFileInfo. IFileInfo theFile = theOutputFile.FirstOrDefault(); string fileName = theFile.Name; //   SAS URL var uriBuilder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> UriBuilder(locator.Path); uriBuilder.Path += "/" + fileName; Console.WriteLine("Full URL to file: "); Console.WriteLine(uriBuilder.Uri.AbsoluteUri); Console.WriteLine(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> uriBuilder.Uri.AbsoluteUri; }</code> </pre><br><br>  Auxiliary method of writing to the file: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteToFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outFilePath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileContent</span></span></span><span class="hljs-function">)</span></span> { StreamWriter sr = File.CreateText(outFilePath); sr.Write(fileContent); sr.Close();</code> </pre><br><br>  It remains to add to Main: <br><pre> <code class="hljs lisp">CreateEncodingJob(<span class="hljs-name"><span class="hljs-name">asset</span></span>, _outputFilesFolder)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  And you can run our program. <br><div class="spoiler">  <b class="spoiler_title">Sample program results</b> <div class="spoiler_text"><pre> <code class="hljs perl">Asset name: interview Asset ID: nb:cid:UUID:xyzxyza-<span class="hljs-number"><span class="hljs-number">318</span></span>a-<span class="hljs-number"><span class="hljs-number">4</span></span>a47-b996-<span class="hljs-number"><span class="hljs-number">27353</span></span>b23abc3 Time created: <span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2012</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> AM Encrypted status: StorageEncrypted Job <span class="hljs-keyword"><span class="hljs-keyword">state</span></span>: Queued. Please wait... Job <span class="hljs-keyword"><span class="hljs-keyword">state</span></span>: Processing. Please wait... Job <span class="hljs-keyword"><span class="hljs-keyword">state</span></span>: Processing. Please wait... ******************** Job <span class="hljs-keyword"><span class="hljs-keyword">state</span></span>: Finished. Please <span class="hljs-keyword"><span class="hljs-keyword">wait</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> tasks complete... Locator path: https:<span class="hljs-regexp"><span class="hljs-regexp">//</span></span>MediaServicesServer.blob.core.windows.net/asset-zzzz374-<span class="hljs-number"><span class="hljs-number">1234</span></span>-<span class="hljs-number"><span class="hljs-number">4</span></span>c6<span class="hljs-number"><span class="hljs-number">0</span></span>-<span class="hljs-number"><span class="hljs-number">9</span></span>da8-<span class="hljs-number"><span class="hljs-number">3</span></span>daf <span class="hljs-number"><span class="hljs-number">7</span></span>a6dabcd?st=<span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span>-<span class="hljs-number"><span class="hljs-number">24</span></span>T21%3A59%3A55Z&amp;se=<span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span>-<span class="hljs-number"><span class="hljs-number">24</span></span>T22%3A29%3A55Z&amp;sr=c&amp;si=b1a0cf8 f-<span class="hljs-number"><span class="hljs-number">45</span></span>bf-<span class="hljs-number"><span class="hljs-number">4</span></span>f77-a84a-a38c3f8a002d&amp;sig=tWmPLPpNuQpEXvCd2Ik8rCfY5AqjII3gnWgi9ustBI4%3D Full URL to file: https:<span class="hljs-regexp"><span class="hljs-regexp">//</span></span> MediaServicesServer.blob.core.windows.net/asset- zzzz374-<span class="hljs-number"><span class="hljs-number">1234</span></span>-<span class="hljs-number"><span class="hljs-number">4</span></span>c6<span class="hljs-number"><span class="hljs-number">0</span></span>-<span class="hljs-number"><span class="hljs-number">9</span></span>da8-<span class="hljs-number"><span class="hljs-number">3</span></span>daf <span class="hljs-number"><span class="hljs-number">7</span></span>a6dabcd/interview.mp4?st=<span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span>-<span class="hljs-number"><span class="hljs-number">24</span></span>T21%3A59%3A55Z&amp;se=<span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span>-<span class="hljs-number"><span class="hljs-number">24</span></span>T22%3A29%3A55Z&amp;<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> r=c&amp;si=b1a0cf8f-<span class="hljs-number"><span class="hljs-number">45</span></span>bf-<span class="hljs-number"><span class="hljs-number">4</span></span>f77-a84a-a38c3f8a002d&amp;sig=tWmPLPpNuQpEXvCd2Ik8rCfY5AqjII3g nWgi9ustBI4%3D</code> </pre><br></div></div><br><br>  So, we got acquainted with the services of Windows Azure Media Services and even tried to write a simple program that uses the simplest features provided by the services.  More information about the services can be found at the following link: <a href="http://www.windowsazure.com/en-us/develop/net/how-to-guides/media-services/">www.windowsazure.com/en-us/develop/net/how-to-guides/media-services</a> </div><p>Source: <a href="https://habr.com/ru/post/150593/">https://habr.com/ru/post/150593/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150584/index.html">Why ITIL to the usual average administrator (10-500 PCs)</a></li>
<li><a href="../150588/index.html">Beautiful domain names .by will be sold at a charity auction</a></li>
<li><a href="../150589/index.html">Stopped the existence of the oldest search engine Runet - Aport</a></li>
<li><a href="../150590/index.html">SurfPatrol extension for Google Chrome</a></li>
<li><a href="../150591/index.html">The second gigapixel panorama of Yekaterinburg</a></li>
<li><a href="../150595/index.html">Batch video conversion for household players</a></li>
<li><a href="../150596/index.html">Ministry of Finance cuts funding for federal space programs</a></li>
<li><a href="../150597/index.html">BDD vice versa</a></li>
<li><a href="../150598/index.html">The practice of obtaining and using digital signatures when submitting reports to government agencies</a></li>
<li><a href="../150599/index.html">There, the dwarf leader for the quest gives the quest until you get bored</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>