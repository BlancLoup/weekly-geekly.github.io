<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flask Mega-Tutorial, Part 3: Web Forms (Edition 2018)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="blog.miguelgrinberg.com 
 Miguel grinberg 



 <<< previous next >>> 


 This article is a translation of the third part of the new edition of Miguel ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flask Mega-Tutorial, Part 3: Web Forms (Edition 2018)</h1><div class="post__text post__text-html js-mediator-article"><p>  <a href="http://blog.miguelgrinberg.com/" title="blog.miguelgrinberg.com">blog.miguelgrinberg.com</a> </p><br><h3 id="miguel-grinberg">  <em>Miguel grinberg</em> </h3><br><hr><br><p>  <a href="https://habrahabr.ru/post/346340/">&lt;&lt;&lt; previous</a> <a href="https://habrahabr.ru/post/346344/">next &gt;&gt;&gt;</a> </p><br><p>  This article is a translation of the third part of the new edition of Miguel Greenberg‚Äôs textbook.  <a href="https://habrahabr.ru/post/193242/" title="Previous translation">The old translation</a> has long lost its relevance. </p><a name="habracut"></a><br><p>  In this third installment of the Flask Mega-Tutorial series, I‚Äôll talk about how to work with forms. </p><br><p>  For reference, below is a list of articles in this series. </p><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/post/346306/"><strong>Chapter 1: Hello world!</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346340/"><strong>Chapter 2: Templates</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346342/"><strong>Chapter 3: Web Forms (This article)</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346344/"><strong>Chapter 4: Database</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346346/"><strong>Chapter 5: User Logins</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346348/"><strong>Chapter 6: Profile Page and Avatars</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346880/"><strong>Chapter 7: Error Handling</strong></a> </li><li>  <a href="https://habrahabr.ru/post/347450/"><strong>Chapter 8: Subscribers, Contacts, and Friends</strong></a> </li><li>  <a href="https://habrahabr.ru/post/347926/"><strong>Chapter 9: Pagination</strong></a> </li><li>  <a href="https://habrahabr.ru/post/348566/"><strong>Chapter 10: Email Support</strong></a> </li><li>  <a href="https://habrahabr.ru/post/349060/"><strong>Chapter 11: Reconstruction</strong></a> </li><li>  <a href="https://habrahabr.ru/post/349604/"><strong>Chapter 12: Date and Time</strong></a> </li><li>  <a href="https://habrahabr.ru/post/350148/"><strong>Chapter 13: I18n and L10n</strong></a> </li><li>  <a href="https://habrahabr.ru/post/350626/"><strong>Chapter 14: Ajax</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351218/"><strong>Chapter 15: Improving Application Structure</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351900/"><strong>Chapter 16: Full Text Search</strong></a> </li><li>  <a href="https://habrahabr.ru/post/352266/"><strong>Chapter 17: Deploying to Linux</strong></a> </li><li>  <a href="https://habrahabr.ru/post/352830/"><strong>Chapter 18: Deploying to Heroku</strong></a> </li><li>  <a href="https://habrahabr.ru/post/353234/"><strong>Chapter 19: Deploying to Docker Containers</strong></a> </li><li>  <a href="https://habrahabr.ru/post/353804/"><strong>Chapter 20: JavaScript Magic</strong></a> </li><li>  <a href="https://habrahabr.ru/post/354322/"><strong>Chapter 21: User Notifications</strong></a> </li><li>  <a href="https://habrahabr.ru/post/354752/"><strong>Chapter 22: Background Tasks</strong></a> </li><li>  <a href="https://habrahabr.ru/post/358152/"><strong>Chapter 23: Application Programming Interfaces (APIs)</strong></a> </li></ul></div></div><br><p>  <em>Note 1: If you are looking for old versions of this course, this is <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world-legacy" title="here">here</a> .</em> </p><br><p>  <em>Note 2: If suddenly you would like to speak in support of my (Miguel) work on this blog, or simply do not have the patience to wait for a week of the article, I (Miguel Greenberg) offer a full version of this guide a packed e-book or video.</em>  <em>For more information, visit <a href="http://learn.miguelgrinberg.com/" title="learn.miguelgrinberg.com">learn.miguelgrinberg.com</a> .</em> </p><br><h2 id="kratkoe-povtorenie">  Brief repetition </h2><br><p>  In <strong>Chapter 2,</strong> I created a simple template for the application's home page and used false entities as placeholders for objects I don‚Äôt have yet, such as users or blog posts.  In this chapter, I will discuss one of the many phenomena that I have in this application, in particular, how to receive input data from users via web forms. </p><br><p>  Web forms are one of the most basic building blocks in any web application.  I will use the form so that users can post blog posts as well as to enter the application. </p><br><p> Before continuing to read this chapter, make sure you have a <code>microblog</code> application.  The work done in the previous chapter should allow it to run without any errors. </p><br><p>  <em>GitHub links for this chapter:</em> <a href="">Browse</a> , <a href="">Zip</a> , <a href="">Diff</a> . </p><br><h2 id="vvedenie-v-flask-wtf">  Introduction to Flask-WTF </h2><br><p>  To process the web forms in this application, I'm going to use the <a href="http://packages.python.org/Flask-WTF">Flask-WTF</a> extension, which is a wrapper for the <a href="https://wtforms.readthedocs.io/">WTForms</a> package and perfectly integrates it with Flask.  This is the first Flask extension that I introduce to you, but not the last.  Extensions are a very important part of the Flask ecosystem, as they provide solutions to problems. </p><br><p>  Flask extensions are regular Python packages that are installed along with <code>pip</code> .  You need to install Flask-WTF in your virtual environment: </p><br><pre> <code class="hljs sql">(venv) $ pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> flask-wtf</code> </pre> <br><h2 id="konfiguraciya">  Configuration </h2><br><p>  So far, the application is very simple, and for this reason I did not need to worry about its configuration.  But for any application other than the simplest, you will find that Flask (and possibly also the Flask extensions used) offer some freedom in how to do something, and you need to make some decisions that you pass as a list of configuration variables. . </p><br><p>  There are several formats for specifying configuration parameters.  The most basic solution is to define your variables as keys in app.config, which uses a dictionary style for working with variables.  For example, you can do something like this: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">app</span></span> = Flask(__name__) app.config[<span class="hljs-string"><span class="hljs-string">'SECRET_KEY'</span></span>] = <span class="hljs-string"><span class="hljs-string">'you-will-never-guess'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... add more variables here as needed</span></span></code> </pre> <br><p>  Although the above syntax is enough to create configuration parameters for Flask, I like to apply the principle of problem sharing, so instead of setting my configuration in the same place where I create my application, I will use a slightly more complicated structure that allows me to save my configuration in a separate file. </p><br><p>  The format I like a lot because it is extensible is to use a class to store configuration variables.  So that everything is well organized, I'm going to create a configuration class in a separate Python module.  Below you can see the new configuration class for this application, which is stored in the <strong>config.py</strong> module in the <u>upper (!!!) level</u> directory <u>.</u> </p><br><p><img src="https://habrastorage.org/webt/ft/-e/gk/ft-egkbseevmalbrgqlucegufmu.png"></p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Config(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>): SECRET_KEY = os.environ.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'SECRET_KEY'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'you-will-never-guess'</span></span></code> </pre> <br><p>  Pretty simple, isn't it?  Configuration parameters are defined as class variables within the <code>Config</code> class.  Because the application requires more configuration items, they can be added to this class, and later, if I find that I need to have more than one configuration set, I can create subclasses of it.  But don't worry about it for now. </p><br><p>  The <code>SECRET_KEY</code> configuration <code>SECRET_KEY</code> , which I added as the only configuration item, is an important part of most Flask applications.  Flask and some of its extensions use the secret key value as a cryptographic key, useful for generating signatures or tokens.  The Flask-WTF extension uses it to protect web forms against a nasty attack called <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">Cross-Site Request Forgery</a> or CSRF (pronounced "seasurf").  As its name implies, the secret key must be secret, since the strength of the tokens and signatures generated by it depends on the fact that no one outside the circle of trusted persons accompanying the application knows about it. </p><br><p>  The value of the secret key is specified as an expression with two terms to which the <code>OR</code> operator is attached.  The first term looks for the value of an environment variable, also called SECRET_KEY.  The second term is simply a hard-coded string.  This is a template that you will see that I often repeat for configuration variables.  The idea is that the value that appears from the environment variable is preferable, but if the environment does not define a variable, then a hard-coded string is used instead.  When developing this application, the security requirements are small, so you can simply ignore this parameter and allow the use of a hard-coded string.  But when this application is deployed on a production server, I will set a unique and hard-to-guess value, so the server will have a secure key that nobody knows. </p><br><p>  Now that I have a configuration file, I need Flask to read it and apply it.  This can be done immediately after creating an instance of the Flask application using the <code>app.config.from_object()</code> method ( <code>app\__init__.py</code> ): </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask from config <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Config app = Flask(<span class="hljs-title"><span class="hljs-title">__name__</span></span>) app.config.from_object(<span class="hljs-type"><span class="hljs-type">Config</span></span>) from app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> routes</code> </pre> <br><p>  The way I import the Config class may seem confusing at first, but if you look at how the Flask class (uppercase F) is imported from the flask package (lowercase f), you will notice that I do the same with configuration.  The string "config" is the name of the python module config.py, and obviously, the one that has the upper case "C" is the actual class. </p><br><p>  As I mentioned above, configuration items can be accessed with the dictionary syntax from app.config.  Here you can see a quick session with the Python interpreter, where I check what the secret key value is: </p><br><pre> <code class="hljs python"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> microblog <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> app &gt;&gt;&gt; app.config[<span class="hljs-string"><span class="hljs-string">'SECRET_KEY'</span></span>] <span class="hljs-string"><span class="hljs-string">'you-will-never-guess'</span></span></code> </pre> <br><h2 id="forma-vhoda-polzovatelya">  User login form </h2><br><p>  The Flask-WTF extension uses Python classes to represent web forms.  The form class simply defines the form fields as class variables. </p><br><p>  Once again, keeping in mind the separation of problems, I'm going to use the new <em>app / forms.py</em> module to store the web form classes.  First, let's define a user login form in which the user will be prompted to enter a username and password.  The form will also include the "Remember me" checkbox and the Submit button: </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">from</span></span> flask_wtf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlaskForm from wtforms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StringField, PasswordField, BooleanField, SubmitField from wtforms.validators <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> DataRequired class LoginForm(<span class="hljs-type"><span class="hljs-type">FlaskForm</span></span>): username = StringField('<span class="hljs-type"><span class="hljs-type">Username</span></span>', <span class="hljs-title"><span class="hljs-title">validators</span></span>=[<span class="hljs-type"><span class="hljs-type">DataRequired</span></span>()]) password = PasswordField('<span class="hljs-type"><span class="hljs-type">Password</span></span>', <span class="hljs-title"><span class="hljs-title">validators</span></span>=[<span class="hljs-type"><span class="hljs-type">DataRequired</span></span>()]) remember_me = BooleanField('<span class="hljs-type"><span class="hljs-type">Remember</span></span> <span class="hljs-type"><span class="hljs-type">Me</span></span>') submit = SubmitField('<span class="hljs-type"><span class="hljs-type">Sign</span></span> <span class="hljs-type"><span class="hljs-type">In</span></span>')</code> </pre> <br><p>  Most Flask extensions use the flask_ naming convention for top-level imports.  In this case, Flask-WTF changes all its characters under flask_wtf.  Here, the base class FlaskForm is imported from the top of <code>app/forms.py</code> . <br></p><p>  The four classes that represent the field types I use for this form are imported directly from the WTForms package, because the Flask-WTF extension does not provide custom versions.  For each field, an object is created as a class variable in the <code>LoginForm</code> class.  Each field is assigned a description or label as the first argument. </p><br><p>  The optional <code>validators</code> argument, which you see in some fields, is used to bind the verification behavior to fields.  The DataRequired validator simply checks that the field is not sent empty.  There are many more validators available, some of which will be used in other forms. </p><br><h2 id="shablony-form">  Form templates </h2><br><p>  The next step is to add the form to the HTML template so that it can be visualized on the web page.  The fields defined in the <code>LoginForm</code> class know how to visualize themselves as HTML, so this task is quite simple.  Below you can see the login template, which I am going to store in the file <code>app/templates/login.html</code> : </p><br><blockquote>  <code>app/templates/login.html</code> : Login Form Template <br>  (The code is corrected due to changes in the original article 2018-06-09. Thank you <a href="https://habr.com/users/magax/">magax</a> !) </blockquote><br><pre> <code class="html hljs xml">{% extends "base.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Sign In<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">novalidate</span></span></span><span class="hljs-tag">&gt;</span></span> {{ form.hidden_tag() }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {{ form.username.label }}<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> {{ form.username(size=32) }} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {{ form.password.label }}<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> {{ form.password(size=32) }} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{ form.remember_me() }} {{ form.remember_me.label }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{ form.submit() }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre> <br><p>  For this template, I reuse <code>base.html</code> one more time, as shown in <a href="https://habrahabr.ru/post/346340/">Chapter 2</a> , through the template's extended inheritance instruction.  In fact, I will do this with all the templates to provide a uniform layout that includes the top navigation bar across all pages of the application. </p><br><p>  This template assumes that the form object created from the <code>LoginForm</code> class will be provided as an argument, which can be seen as a <code>form</code> link.  This argument will be sent by the input viewer function, which I have not yet written. </p><br><p>  The <code>HTML</code> <code>&lt;form&gt;</code> element is used as a container for the web form.  The form's <code>action</code> attribute is used to tell the web browser the URL that should be used when sending information entered by the user into the form.  If an empty string is specified for the action, the form is transferred to the URL address currently located in the address bar, that is, the URL that renders the form on the page.  The <code>method</code> attribute specifies the HTTP request method to be used when sending the form to the server.  By default, it is sent with a <code>GET</code> request, but in almost all cases the use of a <code>POST</code> request improves interaction with the user, because requests of this type can send form data to the request body, while <code>GET</code> requests add form fields to the URL address, cluttering the address browser string. </p><br><blockquote>  <em>Added 2018-06-09</em> Thanks for the comments <a href="https://habr.com/users/magax/">magax</a> ! <br>  The <code>novalidate</code> attribute <code>novalidate</code> used to instruct the web browser not to apply validation to the fields in this form, which effectively leaves this task to the Flask application running on the server.  Using <code>novalidate</code> is completely optional, but <strong>for this first form, it is important</strong> that you install it, because it will allow you to test the server side check later in this chapter. </blockquote><p>  The <code>form.hidden_tag()</code> template argument creates a hidden field containing a token used to protect the form from CSRF attacks.  All you need to do to protect the form is to enable this hidden field and define the <code>SECRET_KEY</code> variable in the Flask configuration.  If you take care of these two things, Flask-WTF does the rest for you. </p><br><p>  If you have already written HTML Web Forms in the past, you may have thought it strange that there are no HTML fields in this template.  This is because the fields from the Form object know how to visualize themselves as HTML.  All I had to do was enable <code>{{ form.&lt;field_name&gt;.label }}</code> in the place where the field label is needed and <code>{{ form.&lt;field_name&gt;() }}</code> where the field itself is needed.  For fields that require additional HTML attributes, they can be passed as arguments.  The username and Password fields in this template take the <code>size</code> size as an argument, which will be added to the <code>&lt;input&gt;</code> HTML element as an attribute.  In this way, you can also attach CSS classes or identifiers to form fields. </p><br><h2 id="predstavlenie-formy">  Form submission </h2><br><p>  The final step before you see this form in the browser is the code for the new viewing function in the application that displays the template from the previous section. </p><br><p>  So let's write a new view function that is mapped to the <code>/login</code> URL, which will create the form, and pass it to the rendering template.  This browsing feature can be found in the <code>app/routes.py</code> complementing the content: </p><br><pre> <code class="hljs scala">from flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render_template from app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> app from app.forms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">LoginForm</span></span> # ... <span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route('/login') <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span></span>(): form = <span class="hljs-type"><span class="hljs-type">LoginForm</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-symbol"><span class="hljs-symbol">'login</span></span>.html', title=<span class="hljs-symbol"><span class="hljs-symbol">'Sign</span></span> <span class="hljs-type"><span class="hljs-type">In</span></span>', form=form)</code> </pre> <br><p>  Here I imported the <code>LoginForm</code> class from <em>forms.py</em> , created an instance of an object from it, and sent it to the template.  The <code>form = form</code> syntax may look weird, but simply passes the form object created in the line above (and shown to the right) to the template with the form of the name (shown to the left).  This is all that is required to display form fields. </p><br><p>  To simplify access to the login form, the basic template should include a link to the navigation bar: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> Microblog: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/index"</span></span></span><span class="hljs-tag">&gt;</span></span>Home<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/login"</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  At this stage, you can run the application and see what happened with the web browser.  When launching the application, enter <code>http://localhost:5000/</code> in the address bar of the browser, and then click the Sign In link in the top navigation bar to see the new login form.  Pretty cool, isn't it? </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5bf/956/150/5bf956150c3131a77332da51c1496a57.png"></p><br><h2 id="poluchenie-dannyh-formy">  Getting form data </h2><br><p>  If you try to click the send button (Sign In), the browser displays the error "Method Not Allowed".  This is due to the fact that the login function from the previous section performs half the task.  It can display a form on a web page, but it has no logic to process the data submitted by the user.  This is another area where Flask-WTF makes it easy.  The following is an updated version of the view function that accepts and validates user submitted data: </p><br><pre> <code class="hljs kotlin">from flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render_template, flash, redirect <span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route(<span class="hljs-string"><span class="hljs-string">'/login'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) def login(): form = LoginForm() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.validate_on_submit(): flash(<span class="hljs-string"><span class="hljs-string">'Login requested for user {}, remember_me={}'</span></span>.format( form.username.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>, form.remember_me.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> redirect(<span class="hljs-string"><span class="hljs-string">'/index'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">'login.html'</span></span>, title=<span class="hljs-string"><span class="hljs-string">'Sign In'</span></span>, form=form)</code> </pre> <br><p>  The first novelty in this version is the <code>methods</code> argument in the route designer.  This is a message to Flask that this view function accepts <code>GET</code> and <code>POST</code> requests, overriding the default value, which should only accept <code>GET</code> requests.  The HTTP protocol indicates that <code>GET</code> requests are those that return information to the client (in this case, a web browser).  All requests in the application are still of this type.  <code>POST</code> requests are usually used when the browser sends form data to the server (in fact, <code>GET</code> requests can also be used for this purpose, but this is not recommended).  The ‚ÄúMethod Not Allowed‚Äù error that the browser showed you before appears because the browser tried to send a <code>POST</code> request and the application is not configured to accept it.  By providing the <code>methods</code> argument, you tell Flask to accept the methods of the query. </p><br><p>  The <code>form.validate_on_submit()</code> method performs all form processing.  When the browser sends a <code>GET</code> request to get a web page with a form, this method returns <code>False</code> , so in this case the function skips the if statement and proceeds to display the template in the last line of the function. </p><br><p>  When the browser sends a <code>POST</code> request as a result of the user clicking the submit button, <code>form.validate_on_submit()</code> collects all data, runs all validators attached to the fields, and if everything is OK, returns <code>True</code> , stating that the data is valid and can be processed by the application.  But if at least one field does not confirm the check, the function returns <code>False</code> , and this will result in the form being returned to the user, for example, in the case of a <code>GET</code> request.  Later, I'm going to add an error message when the check failed. </p><br><p>  When <code>form.validate_on_submit()</code> returns <code>True</code> , the login function calls two new functions imported from Flask.  The <code>flash()</code> function is a useful way to display a message to a user.  Many applications use this technique to tell the user whether an action was successful or not.  In this case, I will use this mechanism as a temporary solution, because I do not have all the infrastructure necessary for registering users in reality.  The best thing I can do now is show a message confirming that the application has received credentials. </p><br><p>  The second new function used in the login function is <code>redirect()</code> .  This function instructs the client web browser to automatically switch to another page specified as an argument.  This browsing function uses it to redirect the user to the <code>/index</code> page of the application. </p><br><p>  When you call the <code>flash()</code> function, Flask saves the message, but magic messages will not appear on web pages.  Application templates should display these minimized messages in a way that works for the site layout.  I'm going to add these messages to the base template so that all templates inherit this functionality.  This is the updated base template: </p><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> title %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ title }}</span></span><span class="xml"><span class="xml"> - microblog</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">else</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">microblog</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Microblog: </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/index"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Home</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/login"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Login</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">with</span></span></span></span></span><span class="hljs-template-tag"> messages = get_flashed_messages() %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> messages %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> message </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> messages %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ message }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endwith</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  Here I use the <code>with</code> construct to assign the result of the <code>get_flashed_messages()</code> call to the <code>messages</code> variable, all in the context of the template.  The <code>get_flashed_messages()</code> function comes from Flask and returns a list of all messages that were previously registered with <code>flash()</code> .  The condition that follows checks whether the message has some content, in which case the <code>&lt;ul&gt;</code> element is displayed with each message as a list item <code>&lt;li&gt;</code> .  This style of rendering does not look very good, but the theme of styling a web application will appear later. </p><br><p>  An interesting feature of these flash messages is that after they are requested once through the <code>get_flashed_messages</code> function <code>get_flashed_messages</code> they are removed from the list of messages, so they appear only once after the <code>flash()</code> function is called. </p><br><p>  Time to try the application again and check how the form works.  Make sure that you are trying to submit a form with username or password fields blank to see how the <code>DataRequired</code> validator stops the <code>DataRequired</code> process. </p><br><h2 id="povyshenie-effektivnosti-proverki-poley">  Improved field validation </h2><br><p>  Validators attached to form fields prevent invalid data from being passed to the application.  The way the application responds to invalid form field input is to re-display the form to allow the user to make the necessary corrections. </p><br><p>  If you tried to enter invalid data, I am sure that you noticed that, although the checking mechanisms work well, there are no messages to the user that something is wrong with the form, the user simply receives the form back.     ,     ,         ,    . </p><br><p> ,         ,  ,  , ‚Äî         . </p><br><p>       (  .)     : </p><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "base.html" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Sign In</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.hidden_tag() }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.username.label }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.username(size=32) }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> error </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> form.username.errors %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"color: red;"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">[</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ error }}</span></span><span class="xml"><span class="xml">]</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.password.label }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.password(size=32) }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> error </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> form.password.errors %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"color: red;"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">[</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ error }}</span></span><span class="xml"><span class="xml">]</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.remember_me() }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.remember_me.label }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.submit() }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br><p>  ,   ,       <code>username</code>  <code>password</code> ,     ,     .  ,  ,    ,     ,   <code>form.&lt;field_name&gt;.errors</code> .   ,                    . </p><br><p>           ,      . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ae3/e52/24d/ae3e5224d8735f43f653f456b1dfa3a0.png"></p><br><h2 id="sozdanie-svyazey">   </h2><br><p>       ,                 .       ,     . ,       : </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> Microblog: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/index"</span></span></span><span class="hljs-tag">&gt;</span></span>Home<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/login"</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>   <code>login</code>   ,    <code>redirect()</code> : </p><br><pre> <code class="hljs ruby">@app.route(<span class="hljs-string"><span class="hljs-string">'/login'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: form = LoginForm() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.validate_on_submit(): <span class="hljs-comment"><span class="hljs-comment"># ... return redirect('/index') # ...</span></span></code> </pre> <br><p>               ,           ,           . </p><br><p>     , Flask   <code>url_for()</code> ,   URL-,    URL-   . , <code>url_for('login')</code>  <code>/login</code> ,  <code>url_for('index')</code>  <code>'/index</code> .   <code>url_for()</code>   <em> </em> ,     view. </p><br><p>   ,       URL-.   ,  URL-   ,   ,   .     , ,    ,  URL-   ,     URL     ,      . <code>url_for()</code>      URL-. </p><br><p>        <code>url_for()</code>  ,     URL .         : </p><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Microblog: </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('index') }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Home</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('login') }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Login</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>     <code>login()</code> : </p><br><pre> <code class="hljs scala">from flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render_template, flash, redirect, url_for # ... <span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route('/login', methods=[<span class="hljs-symbol"><span class="hljs-symbol">'GE</span></span>T', <span class="hljs-symbol"><span class="hljs-symbol">'POS</span></span>T']) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span></span>(): form = <span class="hljs-type"><span class="hljs-type">LoginForm</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.validate_on_submit(): # ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> redirect(url_for(<span class="hljs-symbol"><span class="hljs-symbol">'inde</span></span>x')) # ...</code> </pre> <br><p>  <a href="https://habrahabr.ru/post/346340/">&lt;&lt;&lt; previous</a> <a href="https://habrahabr.ru/post/346344/">next &gt;&gt;&gt;</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/346342/">https://habr.com/ru/post/346342/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346332/index.html">Visualization of discrete space: a torus versus a simplex</a></li>
<li><a href="../346334/index.html">Unlimited speech recognition. Or how I translate voice messages into text in a bot</a></li>
<li><a href="../346336/index.html">Rust: ‚ÄúUnsafe Abstractions‚Äù</a></li>
<li><a href="../346338/index.html">Using the inverse Laplace transform to analyze the dynamic links of control systems</a></li>
<li><a href="../346340/index.html">Flask Mega-Tutorial, Part 2: Patterns (Edition 2018)</a></li>
<li><a href="../346344/index.html">Flask Mega-Tutorial, Part 4: Database (edition 2018)</a></li>
<li><a href="../346346/index.html">Flask Mega-Tutorial, Part 5: Custom Logins (Edition 2018)</a></li>
<li><a href="../346348/index.html">Flask Mega-Tutorial, Part 6: Profile page and avatars (edition 2018)</a></li>
<li><a href="../346350/index.html">As a researcher hacked his own computer and became convinced of the reality of the most serious vulnerability in the history of processors</a></li>
<li><a href="../346352/index.html">Useful materials on SAN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>