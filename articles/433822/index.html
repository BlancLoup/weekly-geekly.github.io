<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The complete guide to CMake. Part Three: Testing and Packaging</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 This article is about testing and packaging software with CMake, a flexible and versatile set of utilities for developing various sof...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The complete guide to CMake. Part Three: Testing and Packaging</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/lf/se/70/lfse70sjifxiyddiuym73hdvcho.png"></p><br><h1 id="vvedenie">  Introduction </h1><br><p>  This article is about testing and packaging software with CMake, a flexible and versatile set of utilities for developing various software products.  It is strongly recommended to read the <a href="https://habr.com/post/431428/">first</a> and <a href="https://habr.com/post/432096/">second</a> parts of the manual in order to avoid misunderstanding the syntax and principle of CMake. </p><a name="habracut"></a><br><h1 id="zapusk-cmake">  Launch CMake </h1><br><p>  Below are examples of using the CMake language that you should practice using.  Experiment with the source code, changing existing commands and adding new ones.  To run these examples, install CMake from the <a href="https://cmake.org/">official site</a> . </p><br><h1 id="primer-testirovaniya">  Test Example </h1><br><p> As mentioned earlier, CMake supports automated software testing.  This feature is very easy to use - just write a few commands in the usual <code>CMakeLists.txt</code> , and then run the tests using <code>ctest</code> or <code>make test</code> .  At your disposal there is verification of the output of programs, dynamic memory analysis and much more. </p><br><p>  We consider the process of testing the program with a specific example.  The source file <code>Multiply.c</code> contains the following code: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #define ARG_COUNT 3 int main(const int argc, const char *argv[]) { if (argc != ARG_COUNT) { fprintf(stderr, "Error!\n"); return EXIT_FAILURE; } const int first = atoi(argv[1]); const int second = atoi(argv[2]); printf("The result is: %d\n", first * second); return EXIT_SUCCESS; }</span></span></span></span></code> </pre> <br><p>  This code displays the result of multiplying the two arguments in the console.  Please note that an error situation is also possible if the actual number of arguments does not satisfy the expected: in this case, Error will be output to the error stream <code>Error!</code>  . </p><br><p>  In the same directory is the <code>CMakeLists.txt</code> file describing the build process, containing the code below: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">3.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">project</span></span>(MyProgram) <span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(Multiply Multiply.c) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(MULTIPLY_TIMEOUT <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   : enable_testing() #  : add_test(FirstTest Multiply 15 207) add_test(SecondTest Multiply -54 -785) add_test(ThirdTest Multiply 85234) #   : set_tests_properties(FirstTest SecondTest ThirdTest PROPERTIES TIMEOUT ${MULTIPLY_TIMEOUT}) set_tests_properties(FirstTest PROPERTIES PASS_REGULAR_EXPRESSION "The result is: 3105" FAIL_REGULAR_EXPRESSION "Error!") set_tests_properties(SecondTest PROPERTIES PASS_REGULAR_EXPRESSION "The result is: 42390" FAIL_REGULAR_EXPRESSION "Error!") set_tests_properties(ThirdTest PROPERTIES PASS_REGULAR_EXPRESSION "Error!")</span></span></code> </pre> <br><p>  Consider everything in order.  The first four commands should be familiar to you from the <a href="https://habr.com/post/432096/">previous article</a> , and the next <a href="https://cmake.org/cmake/help/latest/command/enable_testing.html"><code>enable_testing</code></a> command raises a number of questions.  In essence, this command only notifies CMake of your intention to test the program, simultaneously generating some configuration files, the existence of which you don‚Äôt need to know. </p><br><p>  The following three <a href="https://cmake.org/cmake/help/latest/command/add_test.html"><code>add_test</code></a> add tests to the current project.  The short form of this command takes the name of the test as the first argument, and the subsequent arguments form the shell command to run the test. </p><br><p>  A series of commands <a href="https://cmake.org/cmake/help/latest/command/set_tests_properties.html"><code>set_tests_properties</code></a> sets the behavior of individual tests.  After the list of test names follows the <code>PROPERTIES</code> keyword, which signals the beginning of the list of properties that have the form <code>&lt; &gt; &lt; &gt;</code> and are specified for the selected tests.  Full list of available properties is <a href="https://cmake.org/cmake/help/latest/manual/cmake-properties.7.html">here</a> . </p><br><p>  For all tests, the maximum execution time in one second is set by the <a href="https://cmake.org/cmake/help/latest/prop_test/TIMEOUT.html"><code>TIMEOUT</code></a> property, and then for subsequent tests, the expected output is set by the <a href="https://cmake.org/cmake/help/latest/prop_test/PASS_REGULAR_EXPRESSION.html"><code>PASS_REGULAR_EXPRESSION</code></a> and <a href="https://cmake.org/cmake/help/latest/prop_test/FAIL_REGULAR_EXPRESSION.html"><code>FAIL_REGULAR_EXPRESSION</code></a> (for example, if <code>The result is: 3105</code> coincides with the test, then the <code>FirstTest</code> test continues, and if it matches with the expression <code>Error!</code> test stops and is considered failed). </p><br><h1 id="sposoby-vklyucheniya-testirovaniya">  Ways to turn on testing </h1><br><p>  There is an analogue of the command <a href="https://cmake.org/cmake/help/latest/command/enable_testing.html"><code>enable_testing</code></a> - this is the inclusion of the <a href="https://cmake.org/cmake/help/latest/module/CTest.html"><code>CTest</code></a> module through the <a href="https://cmake.org/cmake/help/latest/command/include.html"><code>include</code></a> command.  In general, the inclusion of a module is more universal, but there is still a difference between them. </p><br><p>  The <a href="https://cmake.org/cmake/help/latest/command/enable_testing.html"><code>enable_testing</code></a> command enables testing for the current directory, as well as for all subsequent ones.  It should be in the root <code>CMakeLists.txt</code> , since CTest expects the test file in the root of the assembly. </p><br><p>  Turning on the <a href="https://cmake.org/cmake/help/latest/module/CTest.html"><code>CTest</code></a> module configures the project for testing via CTest / CDash, and also automatically determines the <code>BUILD_TESTING</code> option, which accepts the truth if testing is possible (by default, <code>ON</code> ).  Thus, when using this command, it is reasonable to describe the testing process in a similar way: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(BUILD_TESTING) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(FirstTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(SecondTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(ThirdTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  ... endif()</span></span></code> </pre> <br><h1 id="ispolnenie-testirovaniya">  Execution testing </h1><br><p>  A series of <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code> commands <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code>  run all three tests.  The <code>ctest -R &lt;RegularExpression&gt;</code> executes the test suite that satisfies the specified regular expression.  For example, the command <code>ctest -R ThirdTest</code> runs only the third test. </p><br><h1 id="primer-paketirovaniya">  Sample packaging </h1><br><p>  To create a package of source files, libraries and executable files, all you have to do is to install the necessary files using the <a href="https://cmake.org/cmake/help/latest/command/install.html"><code>install</code></a> command, and then turn on the <a href="https://cmake.org/cmake/help/latest/module/CPack.html"><code>CPack</code></a> module <a href="https://cmake.org/cmake/help/latest/module/CPack.html"><code>CPack</code></a> the <a href="https://cmake.org/cmake/help/latest/command/include.html"><code>include</code></a> command: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "Multiply"   "bin": install(TARGETS Multiply DESTINATION bin) #    : set(CPACK_PACKAGE_NAME "Multiply") set(CPACK_PACKAGE_VENDOR "MyCompany") set(CPACK_PACKAGE_CONTACT "https://myprojectsite.org") set(CPACK_DEBIAN_PACKAGE_MAINTAINER "mycontacts@gmail.com") set(CPACK_PACKAGE_DESCRIPTION "The most stupid program ever written") #    : set(CPACK_GENERATOR "DEB") #    "CPack": include(CPack)</span></span></code> </pre> <br><p>  In this case, the <a href="https://cmake.org/cmake/help/latest/command/install.html"><code>install</code></a> command notifies the packet generator about the target installation directory <code>Multiply</code> .  Without writing installation commands, packet generation is not possible. </p><br><p>  The following lists the characteristics of a package by specifying several variables.  In fact, there is an abundance of such variables that properly package.  Most of them are optional, but some package generators require their definition.  A list of variables common to all package generators is available <a href="https://cmake.org/cmake/help/latest/module/CPack.html">here</a> . </p><br><p>  Definition of the variable <code>CPACK_GENERATOR</code> is <code>CPACK_GENERATOR</code> - it is a list of package generators called by the <code>cpack</code> utility.  In this case, it takes the value of <code>DEB</code> , therefore, a debian-package is generated in the root directory of the overview application. </p><br><p>  Finally, the <a href="https://cmake.org/cmake/help/latest/module/CPack.html"><code>CPack</code></a> module is <a href="https://cmake.org/cmake/help/latest/module/CPack.html"><code>CPack</code></a> , which configures the future package of the project, using the previously defined variables and the installation command for the executable file, as well as adding two assembly targets ‚Äî <code>package</code> and <code>package_source</code> (respectively, binary assembly and source code assembly). </p><br><h1 id="ispolnenie-paketirovaniya">  Package execution </h1><br><p>  A series of <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> commands <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code>  <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> runs the selected generator to create a binary package, and the <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> command <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code>  <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> generate a source package right in the root directory. </p><br><h1 id="zavershenie">  Completion </h1><br><p>  In this cycle of articles full guide to CMake came to an end.  I hope that you have extracted a lot of useful material, as well as improved your skills in programming.  Good luck! <br></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/433822/">https://habr.com/ru/post/433822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433810/index.html">Problem-oriented approach to projects in Internet marketing</a></li>
<li><a href="../433814/index.html">How to scale down databases in Yandex. Cloud without downtime. Three hosts example</a></li>
<li><a href="../433816/index.html">Where to publish a mobile application</a></li>
<li><a href="../433818/index.html">Compiling and running C # and Blazor inside a browser</a></li>
<li><a href="../433820/index.html">ECMAScript Proposal: Array.prototype. {Flat, flatMap}</a></li>
<li><a href="../433824/index.html">Habro suicide. Why 1C programmers will save the world</a></li>
<li><a href="../433826/index.html">Persimmon 2.0 Instructions for use</a></li>
<li><a href="../433828/index.html">Using QML Map to Build Airways - Part 1</a></li>
<li><a href="../433830/index.html">New LED Lamp Diall</a></li>
<li><a href="../433832/index.html">Formatting Linux source code with ClangFormat: problems and solution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>