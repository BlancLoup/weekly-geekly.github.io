<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Turning on the server using a mobile phone from the outside world</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day habravchane! It all started with the fact that working remotely in the terminal it was necessary to restart the server. Toli did not ask the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Turning on the server using a mobile phone from the outside world</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/72e/416/8e4/72e4168e4fa5048b606456d62e30f645.jpg" alt="image" align="left">  Good day habravchane!  It all started with the fact that working remotely in the terminal it was necessary to restart the server.  Toli did not ask the day, thoughts were toli about something else and instead of the command: <br> <code>sudo shutdown -r now</code> <br>  sent him to rest after a hard day at work, with the command: <br>  <code>sudo shutdown now</code> <b>Enter</b> <br>  And everything happened mechanically and so quickly that even he did not have time to understand.  Understanding began to arrive in 15-20 minutes, after uncontrolled attempts to connect remotely to the terminal.  And I think it is not even worth talking about how far the server was, and it was almost impossible to reach it.  After long telephone conversations and explanations where to go, and where to press, the server still returned to the working rhythm.  After that, the idea of ‚Äã‚Äãturning on the server remotely appeared. <br><a name="habracut"></a><br>  And so we have: <br><ul><li>  server with Ethernet interface with support for Wake-on-LAN (hereinafter WOL) </li><li>  operating system: Ubuntu Server 12.04.2 LTS </li><li>  Cisco 85/86/87/88 / 89x Router </li><li>  Nokia N9 mobile phone </li></ul><br>  <b>a</b> .  enable / check server WOL support <br>  <b>b</b> .  enable / check WOL support in Ubuntu Server <br>  To do this, install the package <b>ethtool</b> <br> <code>sudo apt-get install ethtool</code> <br>  after which we check WOL support <br> <code>sudo ethtool &lt;&gt; | grep Wake</code> <br>  command output should be as follows <blockquote>  Supports Wake-on: g <br>  Wake-on: g </blockquote>  This suggests that the network card supports WOL and it is enabled.  If <blockquote>  Supports Wake-on: </blockquote>  a letter other than <b>g</b> , the network card does not support WOL.  And if it is off <blockquote>  Wake-on: d </blockquote>  then enable it with the following command: <br> <code>sudo ethtool -s &lt;&gt; wol g</code> <br>  On many systems, this command has to be executed after a reboot, so we‚Äôll make it run every time when the system boots automatically.  To do this, create the wakeonlan.conf file with the following commands: <br><pre> <code class="bash hljs">sudo bash -c <span class="hljs-string"><span class="hljs-string">"cat &gt; /etc/init/wakeonlan.conf"</span></span> &lt;&lt;<span class="hljs-string"><span class="hljs-string">'EOF'</span></span> start on started network script <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> interface <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(cut -d: -f1 /proc/net/dev | tail -n +3); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> logger -t <span class="hljs-string"><span class="hljs-string">'wakeonlan init script'</span></span> enabling wake on lan <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-variable"><span class="hljs-variable">$interface</span></span> ethtool -s <span class="hljs-variable"><span class="hljs-variable">$interface</span></span> wol g <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> end script</code> </pre><br>  Make the file executable <br> <code>sudo chmod +x /etc/init/wakeonlan.conf</code> <br>  and run the service <br> <code>sudo service wakeonlan start</code> <br>  <b>c</b> .  on the Cisco router, configure the WOL packet forwarding.  To do this, add the following commands: <br> <code>interface X</code> <br> <code>ip directed-broadcast</code> <br> <code>!</code> <br> <code>!</code> <br> <code>ip nat inside source static udp abc255 7 interface Y 7</code> <br>  Where <br>  interface X - local interface (ip nat inside) <br>  interface Y - external interface (ip nat outside) <br>  <b>d</b> .  On the Nokia N9, add the perl script that creates the WOL package with the following content: <br><div class="spoiler">  <b class="spoiler_title">wol.pl</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w # wol.pl, written 20031220 by Walter Roberson robe...@ibd.nrc-cnrc.gc.ca # this program constructs a WOL (Wake on Lan) packet suitable for # sending locally or over a net. The MAC of the system to be woken # is required. # # The IP address the user supplies should NOT be # the IP address of the system to be woken: instead it should be the # subnet directed broadcast IP (eg, 192.168.1.255) of any subnet # known to be present on the segment of the target system. This # would usually be the directed broadcast IP of the target system itself, # but need not be in cases of multiple subnets that aren't carefully # VLAN'd away from each other. # # To repeat: do NOT use the IP address of the target system. Not unless # you are on the same subnet and you are using a static ARP entry. # The target system is asleep, so it isn't going to answer an ARP # from a router trying to find that particular address. Use a # broadcast address, or some other packet forwarding trick. use strict; require 5.002; use Socket; use Sys::Hostname; my ( $hisiaddr, $hispaddr, $hisMACtext, $hisaddr, $hisport, $proto, @MACbytes, $hisMACbin, $magicbody ); die "Syntax: $0 MAC ipaddr [port]" if @ARGV &lt; 2; $hisMACtext = shift @ARGV; $hisaddr = shift @ARGV; $hisport = shift @ARGV || 22357; # default 'WU', no significance $magicbody = "\xff" x 6; @MACbytes = split /[:-]/, $hisMACtext; die "MAC wrong size" unless @MACbytes == 6; $hisMACbin = pack "H*H*H*H*H*H*", @MACbytes; $magicbody .= $hisMACbin x 16; $proto = getprotobyname('udp'); socket(SOCKET, PF_INET, SOCK_DGRAM, $proto) || die "socket: $!"; $| = 1; print "WOL packet being sent to udp port $hisport of ip $hisaddr\n"; $hisiaddr = inet_aton($hisaddr) || die "unknown host $hisaddr"; $hispaddr = sockaddr_in($hisport, $hisiaddr); defined(send(SOCKET, $magicbody, 0, $hispaddr)) || die "send $hisaddr: $!";</span></span></code> </pre></div></div><br>  make the script executable in the phone terminal <br> <code>chmod +x wol.pl</code> <br>  the script is run in the terminal with the following parameters <br> <code>./wol.pl &lt;MAC         XX-XX-XX-XX-XX-XX&gt; &lt; IP    &gt; &lt; udp  (   7)&gt;</code> <br> <br>  The most surprising thing is that from the moment of that ridiculous mistake, I never had to use it, except perhaps only during the test set-up. <br><br>  References: <br><ul><li>  <a href="https://help.ubuntu.com/community/WakeOnLan">https://help.ubuntu.com/community/WakeOnLan</a> </li><li>  <a href="https://gist.github.com/jevinskie/721245">https://gist.github.com/jevinskie/721245</a> </li><li>  <a href="https://supportforums.cisco.com/docs/DOC-14333">https://supportforums.cisco.com/docs/DOC-14333</a> </li><li>  <a href="https://groups.google.com/forum/%3Fhl%3Den">https://groups.google.com/forum/?hl=en#!msg/alt.internet.wireless/h1bH7K6x1MI/-6PTCfFe-qwJ</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/184950/">https://habr.com/ru/post/184950/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184934/index.html">Review Parrot Asteroid Tablet - the most "car" Android</a></li>
<li><a href="../184938/index.html">The administration of VKontakte with the attackers blocking popular communities</a></li>
<li><a href="../184940/index.html">Translating the D-Link DIR-320 into a 3G router</a></li>
<li><a href="../184942/index.html">Building scalable applications in TypeScript. Part 1 - Asynchronous Module Loading</a></li>
<li><a href="../184946/index.html">Why I refused to use the Vkontakte API</a></li>
<li><a href="../184952/index.html">Build CLDC HotSpot Implementation for ARM</a></li>
<li><a href="../184954/index.html">Windows 8.1 (aka Blue) Preview available for download</a></li>
<li><a href="../184956/index.html">Parsing a CSV file with bash and awk</a></li>
<li><a href="../184958/index.html">Drawings in SVG format. Part 1 - Draft Standard</a></li>
<li><a href="../184960/index.html">Self build cURL for iOS and Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>