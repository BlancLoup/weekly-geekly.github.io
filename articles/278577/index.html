<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automation of easy database 1C list management</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, in your work, like me, you often have to deal with IT systems of companies that were incomprehensible to you and how they were served. Befor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automation of easy database 1C list management</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4e6/dba/eab/4e6dbaeabbcf4f3798987ceecaff6be5.png"><br><br>  Probably, in your work, like me, you often have to deal with IT systems of companies that were incomprehensible to you and how they were served.  Before fully supplying the company for maintenance, it is imperative to do an IT Audit and put all the systems in order. <br><br>  Often one of the systems where there is no order is the 1C system.  For example, you can find databases with the name of the folders <b>"new_copybase1_old"</b> or <b>"Base1CompanyZP"</b> , or in general folders nested in each other. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Who and what has access to these databases is sometimes extremely difficult to determine.  Lists of databases on client computers, in the application 1C, can also be called incomprehensible.  In general, not a very happy picture. <br><br>  If it is time for you to bring all the databases to one common standard and automate the connection of users, then I ask for cat. <br><a name="habracut"></a><br>  To bring all the bases to a common standard, to bring order - everything is good!  But how to do it most quickly and efficiently? <br><br><h4>  Search for a ready solution </h4><br>  A search on the web showed that the best articles on this topic are on Habr√©: <br><br>  1. <a href="http://habrahabr.ru/post/179405/">‚ÄúManaging lists of 1C 8.2 databases‚Äù</a> ; <br>  2. <a href="http://habrahabr.ru/company/knopka/blog/225027/">"How to prepare hundreds of bases 1C and not go crazy"</a> ; <br>  3. <a href="http://habrahabr.ru/post/231119/">"Managing the list of 1C 8.2 databases using Active Directory"</a> ; <br>  4. <a href="https://habrahabr.ru/post/250287/">"Easy management of 1C database lists</a> . <a href="https://habrahabr.ru/post/250287/">"</a> <br><br>  The article <a href="https://habrahabr.ru/post/250287/">‚ÄúEasy management of 1C bases lists‚Äù</a> by <a href="https://habrahabr.ru/users/sergey-s-kovalev/" class="user_link">Sergey-S-Kovalev</a> seemed the most useful, it begins with a famous quote: <br><br><blockquote>  ‚ÄúIt‚Äôs better to lose a day and then fly five minutes later‚Äù (s) m / f. Wings, legs and tails. <br></blockquote><br>  But not everything is so quick and easy. <br><br>  So, setting up an article by the user <a href="https://habrahabr.ru/users/sergey-s-kovalev/" class="user_link">Sergey-S-Kovalev</a> is to perform the steps, which are divided into 6 stages. <br><br>  Stage 1 - Inventory; <br>  Stage 2 - Groups AD for 1C databases; <br>  Stage 3 - Configuration files 1C; <br>  Stage 4 - File or DFS resource; <br>  Stage 5 - Group Policy; <br>  Stage 6 - User. <br><br>  The steps in stages 1, 5 are implemented once for each of the companies, there is no routine in them, you can easily do it by hand. <br><br>  The setup scheme that <a href="https://habrahabr.ru/users/sergey-s-kovalev/" class="user_link">Sergey-S-Kovalev</a> offers is great!  No scripts, everything works simple and clear.  But you have to lose not a day, but much more if you need to customize this work scheme, for example, in 10 companies in which there can be about 200 1C bases in total. <br><br>  That is, the initial setup in a large company can be very long and tedious. <br><br>  I propose to automate part of the steps and reduce the number of stages. <br><br>  <i>To better understand what I‚Äôm talking about, I recommend that you first familiarize yourself with the <a href="https://habrahabr.ru/post/250287/">‚ÄúEasy management of 1C bases lists‚Äù</a></i> . <br><br><h4>  Stage 1 - Inventory </h4><br>  1. Create an Excel file for a shared accounting resource, as shown in the figure. <br><br><img src="https://habrastorage.org/files/491/0b8/333/4910b8333f394402a1f66a2f1c5cd835.JPG"><br><br>  Be sure to bring the names of old databases and folders into this file so that later it would be clear where to copy the bases from.  <i>OldBaseName, OldFolderName</i> .  The file can be taken <a href="https://www.dropbox.com/s/efcf2io9gu21hzi/BasesBuh.xlsx%3Fdl%3D0">here</a> . <br><br>  2. Together with the most important accountant of the company we fill in the fields: <br><br> <code>BaseName, FolderName, GroupName, AccessUser(1-7) <br></code> <br><ul><li>  The column <code>BaseName</code> filled in manually in Russian according to the standard, for example, IP-Ivanov_BOOH. </li><li>  The <code>FolderName</code> column <code>FolderName</code> filled in manually in Latin according to the standard, in our case IP-IVANOV_BUH. </li><li>  The name of the AD group is already generated based on the <code>FolderName</code> column, in our case GRRS_IP-IVANOV_BUH, I think you know how you can add cells in Excel based on information from other cells. </li><li>  You can ask access to the databases in the AccessUser fields for the most important accountant himself, but you can also ease the work.  To do this, you need to take a list of accounting records from AD, for example, using the command <br><br> <code>Get-Aduser -searchbase "OU=Accountants, DC=domain, DC=ru" -filter * -Properties SamAccountname | FT SamAccountname <br></code> <br>  and place this list on the second sheet of our file. </li><li>  Next to the <i>AccessUser</i> fields, <i>you</i> must bind this list.  If you don‚Äôt know how, ask Google something like the following: ‚ÄúOr, just use my file. </li></ul><br>  In the end, the most important accountant simply puts down access for each database, selecting users from the list.  The list can be pre-ordered by means of Excel itself, for example, place the most common accounts at the beginning. <br><br>  3. After filling this file, it must be saved and copied to the directory in which the script will run. <br><br>  From the file <a href="https://habrahabr.ru/users/sergey-s-kovalev/" class="user_link">Sergey-S-Kovalev</a> , it differs in that it immediately gives access to users, no description, server and cluster names.  In my environment, this information is superfluous and I did not include it in the file. <br><br><h4>  Stage 2 - Running the Script </h4><br>  Probably, you already understand that we will feed the script with the file that resulted from the first stage.  The script will perform all the actions that <a href="https://habrahabr.ru/users/sergey-s-kovalev/" class="user_link">Sergey-S-Kovalev</a> described in stages 2,3,4,6. <br><br>  What the script will do: <br><br>  1. Will create groups in AD for each base. <br>  2.Adds the path to the folder with the database to the description field of each group. <br>  3. In the notes field of each group, add the name of the base and the path to the folder with the base. <br>  4. Add to user access groups according to the list. <br>  5. Generates a common file 1CEStart.cfg with a list of all databases, and will place this file in a network folder with 1C configuration files. <br>  6. Generates v8i-files for each database and places these files in a network folder with 1C configuration files. <br>  7. Record the corresponding group for each v8i file in the access lists. <br>  8.Creates folders for databases and assigns the appropriate group to the folder access lists. <br><br>  In general, the script will do almost everything that <a href="https://habrahabr.ru/users/sergey-s-kovalev/" class="user_link">Sergey-S-Kovalev</a> did in his article manually. <br><br>  Before running the script, you need the following. <br><br>  <i>(Automation of these actions so far only in the plans)</i> <br><br><h4>  Create AD groups </h4><br>  1. Create in the domain OU to store groups with access to databases 1C.  In my example, it will be $ OU = ‚ÄúOU = 1C, OU = Resources, DC = domain, DC = ru‚Äù <br>  2. Create the group GRRS_1C_ConfigBasesRO in this OU.  Add GRRS_1C_ConfigBasesRO group to ‚ÄúDomain computers‚Äù group <br>  3. Create a group GRRS_1CBases in this OU. <br>  4. Create a group GRUS_1Cadmins in this OU and add admins 1C to it (optional) <br><br><h4>  Create folders </h4><br>  1. Create a folder on the 1C server for storing databases.  In our case it will be 1cshare. <br>  2. The 1cshare folder must be given access to the GRRS_1CBases group for writing, in the permissions on the Share tab. <br>  3. On the Security tab, delete the Users group and set read permissions for the GRRS_1CBases group. <br>  4. Create a shared DFS folder in the domain or just a folder, for example, \\ domain.ru \ DfsShare \ 1cconfig \ <br>  5. This folder will contain 1C configuration files. <br>  6. The folder \\ domain.ru \ DfsShare \ 1cconfig \ should be granted access to the group GRRS_1C_ConfigBasesRO for reading only. <br><br>  <i>It is necessary that the user, from which the script will be launched, had the right to write to the folder with databases and to the folder \\ domain.ru \ DfsShare \ 1cconfig \.</i> <i><br></i> <br><br><h4>  Requirements for running the script </h4><br>  The script reads an Excel file using Microsoft Access Database Engine 2010 Redistributable <br>  It is better to immediately install this product on the server from which the script will run. <br><br>  You can download the engine <a href="https://www.microsoft.com/en-us/download/details.aspx%3Fid%3D13255">here</a> .  It is important that the bit of the operating system matches the bit depth of the engine. <br><br>  Attention!  If you go to run the script from your desktop client computer, the bit depth of Microsoft Office should also match the bit width of the engine. <br><br>  I recommend to install the engine on the server and not suffer with reinstalling Microsoft Office on your computer.  On the computer to run the script must be installed powershell version 4.0 or higher and snap-AD with PowerShell modules. <br><br>  <b>You must also write the following variables in the script.</b> <br><br> <code># 1-,    <br> <b>$1CServer = "nn-1cserver"</b> <br> #    ,     1. <br> <b>$ShareName = "1cshare"</b> <br> #OU  Active Directory,      1c <br> <b>$OU = ‚ÄúOU=1C, OU=Resources, DC=domain, DC=ru‚Äù</b> <br> # DFS  ,      1 <br> <b>$1CConfigFolder = "\\domain.ru\DfsShare\1cconfig\"</b> <br> #     ,      <br> <b>$datafile = "BasesBuh.xlsx"</b> <br> #         <br> <b>$strSheetName = 'Sheet1$'</b> <br></code> <br>  <b>Note:</b> Why did I implement Excel reading, not csv?  I don‚Äôt like to work with CSV, as it is necessary to follow the encoding for Cyrillic characters, also CSV is not convenient to edit.  If you can read an Excel file, you can immediately slip it into any script without preparing its format. <br><br><h4>  Stage 3 - Creating a Policy for Users </h4><br>  <a href="https://habrahabr.ru/users/sergey-s-kovalev/" class="user_link">Sergey-S-Kovalev</a> very well described the creation of a policy for the operation of this scheme. <br><br>  1. We implement, according to his article, copying the configuration file 1CEStart.cfg from the shared network folder to the folder on the computer% ProgramData% \ 1C \ 1CEStart \ Create this policy for computers. <br><br>  2. Further, in the policy it is necessary to ensure the cleaning of the% Appdata% \ 1C \ 1CEStart \ ibases.v8i file for each user.  Its new content will be formed when you first run 1C from the 1CEStart.cfg file. <br><br><h4>  Stage 4 - Copy Old Bases to New Folders </h4><br>  After you run the script, and it has created all the groups, folders, and files, you need to copy the old databases to a new location, that is, distribute them into new folders.  Here you will be helped by the columns <i>OldFolderName, FolderName.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Script here</b> <div class="spoiler_text"> <code>########################################################### <br> # AUTHOR : Rinat K. Nugaev - http://www.nugaev.net - rinat@nugaev.net <br> # DATE : 07-02-2016 <br> # EDIT : 07-03-2016 <br> # COMMENT : This script creates folders, groups, and other <br> # stuff for 1C envinronment. <br> # Use it for your own risk! <br> # VERSION : 1.2 <br> ########################################################### <br> <br> # CHANGELOG <br> # Version 1.2: 07-03-2016 - Changed the code <br> # - Added DataFilePath checking <br> # - Added AD modules installing <br> # - Changed users's array creating <br> # - Added Russian comments <br> <br> #   AD PowerShell <br> Try <br> { <br> Import-Module ActiveDirectory -ErrorAction Stop <br> } <br> Catch <br> { <br> Write-Host "[ERROR]`t  ActiveDirectory  Powershell  ! ,  !" <br> Write-Host "[ERROR]`t  Windows 2008/2008R2  Import-Module ServerManager" <br> Write-Host "[ERROR]`t Add-WindowsFeature RSAT-AD-PowerShell" <br> Write-Host "[ERROR]`t  Windows 2012/2012R2  Add-WindowsFeature RSAT-AD-PowerShell" <br> Exit 1 <br> } <br> <br> #--------------------------------------------------------------------------------------- <br> #    -     <br> #--------------------------------------------------------------------------------------- <br> #    <br> $dataFile = "BasesBuh.xlsx" <br> # 1-,    <br> $1Cserver = "nn-1cserver" <br> #   1    ,     1. <br> $ShareName = "1cshare" <br> #OU  Active Directory,      1c <br> $OU = ‚ÄúOU=1C,OU=Resources,DC=domain,DC=ru‚Äù <br> # DFS  ,     1 <br> #,  ,     ,     . <br> $1CConfigFolder = "\\domain.ru\DfsShare\1cconfig\" <br> #      <br> #         <br> $strSheetName = 'Sheet1$' #  1$ <br> <br> #---------------------------------------------------------- <br> #  <br> #---------------------------------------------------------- <br> $dataFilePath = $localPath + "\$dataFile" <br> $localPath = $PSScriptRoot <br> #   1 <br> $1CBasesCFG = $1CConfigFolder + ‚Äú1CEStart.cfg‚Äù <br> #      <br> #       ACL    . <br> $GRRS_1C_ConfigBasesRO = "GRRS_1C_ConfigBasesRO" <br> #            <br> #       ACL    . <br> $GRRS_1CBases = "GRRS_1CBases" <br> #   1 <br> $GR_1CAdmins = "GRUS_1Cadmins" <br> <br> #        <br> If (!(Test-Path -Path $dataFilePath -PathType Any)) <br> { <br> Write-Host "[ERROR]`t    $dataFile  ! ,  $dataFile   !" -ForegroundColor Red <br> Exit 1 <br> } <br> <br> #  Excel-   ,    SQLDB <br> #        Microsoft Access Database Engine 2010 Redistributable <br> #    www.microsoft.com/en-us/download/details.aspx?id=13255 <br> # ,       .     Office <br> #      .     ,   . <br> $strProvider = "Provider=microsoft.ace.oledb.12.0" <br> $strDataSource = "Data Source = $dataFilePath" <br> $strExtend = "Extended Properties=Excel 8.0" <br> $strQuery = "Select * from [$strSheetName]" <br> $objConn = New-Object System.Data.OleDb.OleDbConnection("$strProvider;$strDataSource;$strExtend") <br> $sqlCommand = New-Object System.Data.OleDb.OleDbCommand($strQuery) <br> $sqlCommand.Connection = $objConn <br> $objConn.open() <br> $DataReader = $sqlCommand.ExecuteReader() <br> <br> #     <br> $AccessArr = New-Object System.Collections.ArrayList <br> <br> #         <br> While($DataReader.Read()) <br> { <br> #      (.replace(' ','')),  -    . <br> $BaseName = $DataReader[2].Tostring().replace(' ','') <br> $FolderName = $DataReader[3].Tostring().replace(' ','') <br> $GroupName = $DataReader[4].Tostring().replace(' ','') <br> #     $AccessArr <br> [void] $AccessArr.Add($DataReader[5].Tostring().replace(' ','')) <br> [void] $AccessArr.Add($DataReader[6].Tostring().replace(' ','')) <br> [void] $AccessArr.Add($DataReader[7].Tostring().replace(' ','')) <br> [void] $AccessArr.Add($DataReader[8].Tostring().replace(' ','')) <br> [void] $AccessArr.Add($DataReader[8].Tostring().replace(' ','')) <br> [void] $AccessArr.Add($DataReader[10].Tostring().replace(' ','')) <br> [void] $AccessArr.Add($DataReader[11].Tostring().replace(' ','')) <br> <br> # .   ,   . <br> #   .      . <br> $FullPathBase = "\" + "\" + $1Cserver + "\" + $Sharename + "\" + $FolderName <br> <br> #       AD <br> $CommentBase = ‚Äú‚Äù + ‚Äú ‚Äù + $BaseName + ‚Äú ‚Äù <br> $CommentPath = $FullPathBase <br> $Comment = $CommentBase + $CommentPath <br> <br> #   ,    <br> $ConfigBaseFile = $1cConfigFolder + $FolderName + ‚Äú.v8i‚Äù <br> <br> #     v8i <br> #   1,  Connect=File <br> $ConfigBaseFileContent ="[$BaseName] <br> Connect=File=$FullPathBase <br> ClientConnectionSpeed=Normal <br> App=Auto <br> WA=1 <br> Version=8.3 <br> " <br> # v8i-   1CEStart.cfg <br> #  v8i-    <br> $ConfigBaseFileContent | Set-Content $ConfigBaseFile -Encoding UTF8 <br> #     v8i-   1CEStart.cfg <br> $1CBasesCFGContent = "CommonInfoBases=$ConfigBaseFile" <br> #    v8i-   1CEStart.cfg <br> $1CBasesCFGContent | Add-Content $1CBasesCFG -Encoding UTF8 <br> <br> #    ,          . <br> New-ADGroup -GroupScope DomainLocal -GroupCategory Security ` <br> -name $GroupName -Path $OU -Description $CommentPath -OtherAttributes @{info="$Comment"} <br> #           <br> Add-ADGroupMember -Identity $GRRS_1C_ConfigBasesRO $GroupName <br> #           <br> Add-ADGroupMember -Identity $GRRS_1CBases $GroupName <br> <br> #           . <br> foreach ($i in $AccessArr) <br> { <br> if ($i) <br> { <br> Add-ADGroupMember -Identity $GroupName $i <br> } <br> } <br> <br> #    <br> New-item -Path $FullPathBase -ItemType directory <br> #         <br> $acl = Get-Acl $FullPathBase <br> $GroupOwner = New-Object System.Security.Principal.NTAccount("Builtin", "Administrators") <br> $acl.SetOwner($GroupOwner) <br> $rule = New-Object System.Security.AccessControl.FileSystemAccessRule(‚ÄúAdministrators‚Äù,‚ÄùModify,FullControl, Synchronize‚Äù, ‚ÄúContainerInherit, ObjectInherit‚Äù, ‚ÄúNone‚Äù, ‚ÄúAllow‚Äù) <br> $acl.AddAccessRule($rule) <br> $rule = New-Object System.Security.AccessControl.FileSystemAccessRule(‚ÄúDomain admins‚Äù,‚ÄùModify,FullControl, Synchronize‚Äù, ‚ÄúContainerInherit, ObjectInherit‚Äù, ‚ÄúNone‚Äù, ‚ÄúAllow‚Äù) <br> $acl.AddAccessRule($rule) <br> $rule = New-Object System.Security.AccessControl.FileSystemAccessRule(‚Äú$GroupName‚Äù,‚ÄùModify, Synchronize‚Äù, ‚ÄúContainerInherit, ObjectInherit‚Äù, ‚ÄúNone‚Äù, ‚ÄúAllow‚Äù) <br> $acl.AddAccessRule($rule) <br> $rule = New-Object System.Security.AccessControl.FileSystemAccessRule(‚Äú$GR_1CAdmins‚Äù,‚ÄùModify, Synchronize‚Äù, ‚ÄúContainerInherit, ObjectInherit‚Äù, ‚ÄúNone‚Äù, ‚ÄúAllow‚Äù) <br> $acl.AddAccessRule($rule) <br> $acl.SetAccessRuleProtection($True, $False) <br> Set-Acl $FullPathBase $acl <br> <br> #      v8i- <br> $aclfl = Get-Acl $ConfigBaseFile <br> $GroupOwner = New-Object System.Security.Principal.NTAccount("Builtin", "Administrators") <br> $aclfl.SetOwner($GroupOwner) <br> $rulefl = New-Object System.Security.AccessControl.FileSystemAccessRule(‚ÄúAdministrators‚Äù,‚ÄùModify,FullControl, Synchronize‚Äù, ‚ÄúAllow‚Äù) <br> $aclfl.AddAccessRule($rulefl) <br> $rulefl = New-Object System.Security.AccessControl.FileSystemAccessRule(‚ÄúDomain admins‚Äù,‚ÄùModify,FullControl, Synchronize‚Äù, ‚ÄúAllow‚Äù) <br> $aclfl.AddAccessRule($rulefl) <br> $rulefl = New-Object System.Security.AccessControl.FileSystemAccessRule(‚Äú$GroupName‚Äù,‚ÄùReadAndExecute, Synchronize‚Äù, ‚ÄúAllow‚Äù) <br> $aclfl.AddAccessRule($rulefl) <br> $rulefl = New-Object System.Security.AccessControl.FileSystemAccessRule(‚Äú$GR_1CAdmins‚Äù,‚ÄùReadAndExecute, Synchronize‚Äù, ‚ÄúAllow‚Äù) <br> $aclfl.AddAccessRule($rulefl) <br> Set-Acl $ConfigBaseFile $aclfl <br> <br> #      1CEStart.cfg <br> $aclcf = Get-Acl $1CBasesCFG <br> $GroupOwner = New-Object System.Security.Principal.NTAccount("Builtin", "Administrators") <br> $aclcf.SetOwner($GroupOwner) <br> $rulecf = New-Object System.Security.AccessControl.FileSystemAccessRule(‚ÄúAdministrators‚Äù,‚ÄùModify,FullControl, Synchronize‚Äù, ‚ÄúAllow‚Äù) <br> $aclcf.AddAccessRule($rulecf) <br> $rulecf = New-Object System.Security.AccessControl.FileSystemAccessRule(‚ÄúDomain admins‚Äù,‚ÄùModify,FullControl, Synchronize‚Äù, ‚ÄúAllow‚Äù) <br> $aclcf.AddAccessRule($rulecf) <br> $rulecf = New-Object System.Security.AccessControl.FileSystemAccessRule(‚Äú$GRRS_1C_ConfigBasesRO‚Äù,‚ÄùReadAndExecute, Synchronize‚Äù, ‚ÄúAllow‚Äù) <br> $aclcf.AddAccessRule($rulecf) <br> $rulecf = New-Object System.Security.AccessControl.FileSystemAccessRule(‚Äú$GR_1CAdmins‚Äù,‚ÄùReadAndExecute, Synchronize‚Äù, ‚ÄúAllow‚Äù) <br> $aclcf.AddAccessRule($rulecf) <br> Set-Acl $1CBasesCFG $aclcf <br> } <br> #       <br> $dataReader.close() <br> $objConn.close() <br></code> <br></div></div><br><h4>  Possible difficulties </h4><br>  I did not understand for what reasons, but for some reason I didn‚Äôt <i>turn on the ‚Äúreplace all object object permissions with this object‚Äù</i> option for some folders with databases, although everything is written in the script.  And therefore, after copying the databases to a new location, check whether the rights to the copied files were inherited from the parent folder. <br><br><h4>  Conclusion </h4><br>  Colleagues, the script is pretty well documented, but written on the knee, in about an hour.  All responsibility for its use lies only with the UFO. <br><br>  I (think) know how to write functions in PowerShell correctly, make requests and check parameters, implement logging, write help for a script, and so on, but I think this is all unnecessary for this script.  Although, some checks, for example, directories with configs or shared folders can be done.  But, I think, not this time, not such a level is a task. <br><br>  <b>#ChangeLog</b> <br><ol><li>  Corrected the inaccuracies pointed out by <a href="https://habrahabr.ru/users/sergey-s-kovalev/" class="user_link">Sergey-S-Kovalev</a> ; </li><li>  Changed the way users are added to the array, <a href="https://habrahabr.ru/users/n1nj4p0w3r/" class="user_link">n1nj4p0w3r</a> ; </li><li>  Added check for Active Directory modules; </li><li>  Added a check for the presence of a file with data in the directory. </li></ol><br>  <i>Thank!</i> <i><br></i>  <i>All good!</i> </div><p>Source: <a href="https://habr.com/ru/post/278577/">https://habr.com/ru/post/278577/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278567/index.html">Still messing around with debugging?</a></li>
<li><a href="../278569/index.html">Critical vulnerability of Cisco Nexus 3000 Series Switches and 3500 Platform allows remote access to them</a></li>
<li><a href="../278571/index.html">Preparing an ASP.NET 5 (Core) project and DNX environment to participate in the hackathon as part of hack.summit () 2016 at Koding.com</a></li>
<li><a href="../278573/index.html">Adaptive Split View Controller and Popover in iOS 9 (Swift). Part 1</a></li>
<li><a href="../278575/index.html">Superscalar Stacking Processor: We Cross Horror And Hedgehog</a></li>
<li><a href="../278579/index.html">Using the Chromium project codebase as an SDK for developing cross-platform applications</a></li>
<li><a href="../278581/index.html">History of Chatto</a></li>
<li><a href="../278583/index.html">Work with FireBird from 1C. Collection of proven recipes</a></li>
<li><a href="../278585/index.html">Margaret Hamilton: "Guys, I'll send you to the moon"</a></li>
<li><a href="../278589/index.html">libuniset2 is a library for creating ACS. It‚Äôs better to see once ... Part 4 (Adjustment)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>