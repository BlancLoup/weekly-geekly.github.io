<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing an Android widget to display a bitcoin course</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, hablochiteli! Background: more recently, I track the growth of bitcoin cryptocurrency (BTC). Previously, to view the quotes, I looked at the site ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing an Android widget to display a bitcoin course</h1><div class="post__text post__text-html js-mediator-article">  Hi, hablochiteli!  Background: more recently, I track the growth of bitcoin cryptocurrency (BTC).  Previously, to view the quotes, I looked at the site of some stock exchange, but it is much more convenient to have a small widget on the working screen of a smartphone that displays actual information. <br><br>  On the market there are a lot of various widgets showing cryptocurrency rates.  But much more interesting to create something of their own.  In this article I will briefly describe my experience of creating a widget for a gadget running the Android OS. <br><a name="habracut"></a><br>  To understand the material of the article, it is advisable to get acquainted with Java and Android development in IDE Android Studio.  If not, go here: <a href="https://developer.android.com/develop/index.html">Android developers</a> . <br><br>  My small widget will display the price of bitcoin in dollars and the time for which this price is relevant.  The information will be downloaded from the <a href="https://btc-e.nz/">BTC-e</a> Russian-language stock exchange, since this platform delivers the course in a convenient JSON format in response to a get request by url <a href="https://btc-e.nz/api/3/ticker/btc_usd">btc-e.nz/api/3/ticker/btc_usd</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sample exchange response: <br><br><pre><code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"btc_usd"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"high"</span></span>:<span class="hljs-number"><span class="hljs-number">880</span></span>,<span class="hljs-attr"><span class="hljs-attr">"low"</span></span>:<span class="hljs-number"><span class="hljs-number">836</span></span>,<span class="hljs-attr"><span class="hljs-attr">"avg"</span></span>:<span class="hljs-number"><span class="hljs-number">858</span></span>,<span class="hljs-attr"><span class="hljs-attr">"vol"</span></span>:<span class="hljs-number"><span class="hljs-number">3774491.17766</span></span>,<span class="hljs-attr"><span class="hljs-attr">"vol_cur"</span></span>:<span class="hljs-number"><span class="hljs-number">4368.01172</span></span>,<span class="hljs-attr"><span class="hljs-attr">"last"</span></span>:<span class="hljs-number"><span class="hljs-number">871.999</span></span>,<span class="hljs-attr"><span class="hljs-attr">"buy"</span></span>:<span class="hljs-number"><span class="hljs-number">872</span></span>,<span class="hljs-attr"><span class="hljs-attr">"sell"</span></span>:<span class="hljs-number"><span class="hljs-number">870.701</span></span>,<span class="hljs-attr"><span class="hljs-attr">"updated"</span></span>:<span class="hljs-number"><span class="hljs-number">1482754417</span></span>}}</code> </pre> <br>  So, to start developing we create a new project in the IDE with the help of a suitable template.  Select ‚ÄúStart a new Android Studio project‚Äù, then enter the name and location of the project, select the target device and API version, then you need the ‚ÄúAdd no activity‚Äù option. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/276/c33/1b0/276c331b043a4aeb8a3f0c06a4cf4d84.png" alt="image"><br><img src="https://habrastorage.org/files/2e9/7f9/950/2e97f9950f004bd7b6324424f3c4d3b8.png" alt="image"><br><img src="https://habrastorage.org/files/0cc/9c3/eca/0cc9c3ecac7343878088af7328538fec.png" alt="image"><br></div></div><br>  After IDE workspace opens, create an empty widget using the built-in templates.  To do this, in the project file tree open the context menu on the app folder and select New ‚Üí Widget ‚Üí App Widget. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ed2/a34/2ff/ed2a342ffa0b4b0aa8fe6ddd2f886dd3.png" alt="image"><br></div></div><br>  Several files will be created, of which three are particularly interesting. <br><br>  The first is the xml file (res ‚Üí xml ‚Üí btcwidget_info.xml) with the main parameters of the widget: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xml"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appwidget-provider</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:initialKeyguardLayout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/btcwidget"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:initialLayout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/btcwidget"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minHeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minWidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"110dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:previewImage</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/example_appwidget_preview"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:resizeMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"horizontal|vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:updatePeriodMillis</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"180000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:widgetCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"home_screen"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appwidget-provider</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The initialLayout parameter specifies the name of the xml file with the visual layout of the widget.  minHeight and min-Width - the minimum size of the added widget, updatePeriodMillis - information update time in ms, but not more than once every half hour (the 10 ms parameter is still perceived as the minimum 30 minutes). <br><br>  The second xml file (res ‚Üí layout ‚Üí btcwidget.xml) contains the widget's visual display parameters (layout of visual elements). <br><br>  It contains a description of a single TextView visual element inside the RelativeLayout ( <a href="https://developer.android.com/guide/topics/ui/declaring-layout.html%3Fhl%3Dru">Layouts</a> ) markup: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#09C"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/widget_margin"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/appwidget_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_centerHorizontal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_centerVertical</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#09C"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:contentDescription</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/appwidget_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/appwidget_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#ffffff"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20sp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textStyle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bold|italic"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The most interesting is the third file with the source code template for the widget in java.  In this form, the template does not bear the functional load, however, it is possible to understand from the comments of the code which method is executed when and for which it answers: <br><br><div class="spoiler">  <b class="spoiler_title">Widget code template</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Implementation of App Widget functionality. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BTCWidget</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppWidgetProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateAppWidget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AppWidgetManager appWidgetManager, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> appWidgetId)</span></span></span><span class="hljs-function"> </span></span>{ CharSequence widgetText = context.getString(R.string.appwidget_text); <span class="hljs-comment"><span class="hljs-comment">// Construct the RemoteViews object RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.btcwidget); views.setTextViewText(R.id.appwidget_text, widgetText); // Instruct the widget manager to update the widget appWidgetManager.updateAppWidget(appWidgetId, views); } @Override public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) { // There may be multiple widgets active, so update all of them for (int appWidgetId : appWidgetIds) { updateAppWidget(context, appWidgetManager, appWidgetId); } } @Override public void onEnabled(Context context) { // Enter relevant functionality for when the first widget is created } @Override public void onDisabled(Context context) { // Enter relevant functionality for when the last widget is disabled } }</span></span></code> </pre> <br></div></div><br>  It should immediately be said that the Android OS allows you to create a large number of instances of our widget and their behavior will be completely described by the above code.  For a deeper understanding of the behavior and life cycle of widgets, I recommend reading the <a href="https://developer.android.com/guide/topics/appwidgets/index.html">Android Widget</a> article.  Below in the comments of the code I will explain only some of the points. <br><br>  Faced the following complexity: the system allows the widget to be updated (using the updateAppWidget method) no more than once every 30 minutes for reasons of battery saving.  But I wanted to be able to update the data at the right time and I found a way around this limitation.  For this, the widget has been programmed to force update by clicking on it.  Implemented such an action in the following way: by clicking on the widget, an intent (Intent) is sent to the system, which is caught by the widget itself and processed by the start of data update.  If someone knows a simpler way - I will be glad to advice in the comments. <br><br><div class="spoiler">  <b class="spoiler_title">Added Functionality Widget Source Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Implementation of App Widget functionality. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BTCwidget</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppWidgetProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SYNC_CLICKED = <span class="hljs-string"><span class="hljs-string">"btcwidget_update_action"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String WAITING_MESSAGE = <span class="hljs-string"><span class="hljs-string">"Wait for BTC price"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> httpsDelayMs = <span class="hljs-number"><span class="hljs-number">300</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,     static void updateAppWidget(Context context, AppWidgetManager appWidgetManager, int appWidgetId) { // RemoteViews        : RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.btcwidget); //   -  TextView views.setTextViewText(R.id.appwidget_text, WAITING_MESSAGE); appWidgetManager.updateAppWidget(appWidgetId, views); String output; //         //      -   HTTPRequestThread thread = new HTTPRequestThread(); thread.start(); try { while (true) { Thread.sleep(300); if(!thread.isAlive()) { output = thread.getInfoString(); break; } } } catch (Exception e) { output = e.toString(); } //    views.setTextViewText(R.id.appwidget_text, output); // Instruct the widget manager to update the widget appWidgetManager.updateAppWidget(appWidgetId, views); } @Override public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) { RemoteViews remoteViews; ComponentName watchWidget; remoteViews = new RemoteViews(context.getPackageName(), R.layout.btcwidget); watchWidget = new ComponentName(context, BTCwidget.class); //         ,    remoteViews.setOnClickPendingIntent(R.id.appwidget_text, getPendingSelfIntent(context, SYNC_CLICKED)); appWidgetManager.updateAppWidget(watchWidget, remoteViews); //    for (int appWidgetId : appWidgetIds) { updateAppWidget(context, appWidgetManager, appWidgetId); } } //   ,         //   @Override public void onReceive(Context context, Intent intent) { super.onReceive(context, intent); if (SYNC_CLICKED.equals(intent.getAction())) { AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(context); RemoteViews remoteViews; ComponentName watchWidget; remoteViews = new RemoteViews(context.getPackageName(), R.layout.btcwidget); watchWidget = new ComponentName(context, BTCwidget.class); remoteViews.setTextViewText(R.id.appwidget_text, WAITING_MESSAGE); //updating widget appWidgetManager.updateAppWidget(watchWidget, remoteViews); String output; HTTPRequestThread thread = new HTTPRequestThread(); thread.start(); try { while (true) { Thread.sleep(httpsDelayMs); if(!thread.isAlive()) { output = thread.getInfoString(); break; } } } catch (Exception e) { output = e.toString(); } remoteViews.setTextViewText(R.id.appwidget_text, output); //widget manager to update the widget appWidgetManager.updateAppWidget(watchWidget, remoteViews); } } //  protected PendingIntent getPendingSelfIntent(Context context, String action) { Intent intent = new Intent(context, getClass()); intent.setAction(action); return PendingIntent.getBroadcast(context, 0, intent, 0); } }</span></span></code> </pre><br></div></div><br>  Content of HTTPRequestThread.java class: <br><br><div class="spoiler">  <b class="spoiler_title">Look:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.hakey.btcwidget; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.BufferedReader; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.InputStreamReader; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.HttpURLConnection; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.URL; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Calendar; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPRequestThread</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thread</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String urlString = <span class="hljs-string"><span class="hljs-string">"https://btc-e.nz/api/3/ticker/btc_usd"</span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInfoString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String output = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { URL url = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(urlString); HttpURLConnection con = (HttpURLConnection) url.openConnection(); con.setRequestMethod(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>); BufferedReader in = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BufferedReader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(con.getInputStream())); String inputLine; StringBuilder response = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((inputLine = in.readLine()) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { response.append(inputLine); } in.close(); output = <span class="hljs-string"><span class="hljs-string">"Price: "</span></span> + JSONParser.getPrice(response.toString()) + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + getTimeStamp(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { output = e.toString(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ requestPrice(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTimeStamp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Calendar calendar = Calendar.getInstance(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(calendar.get(Calendar.MINUTE)&gt;<span class="hljs-number"><span class="hljs-number">9</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Time: "</span></span> + calendar.get(Calendar.HOUR_OF_DAY) + <span class="hljs-string"><span class="hljs-string">":"</span></span> + calendar.get(Calendar.MINUTE); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Time: "</span></span> + calendar.get(Calendar.HOUR_OF_DAY) + <span class="hljs-string"><span class="hljs-string">":0"</span></span> + calendar.get(Calendar.MINUTE); } } }</code> </pre><br></div></div><br>  Parser response from the server - JSONParser.java: <br><br><div class="spoiler">  <b class="spoiler_title">Watch:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.hakey.btcwidget; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.json.JSONException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.json.JSONObject; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSONParser</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> JSONException </span></span>{ String price; JSONObject obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(s); JSONObject pairObj = obj.getJSONObject(<span class="hljs-string"><span class="hljs-string">"btc_usd"</span></span>); price = pairObj.getString(<span class="hljs-string"><span class="hljs-string">"last"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> price; } }</code> </pre><br></div></div><br>  Here is the widget described above: <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/4b8/9ea/8d6/4b89ea8d6c8c4b3d996bb52c1a643006.png" alt="image"><br></div></div><br>  The full source code is available here: <a href="https://github.com/hakeydotom/BTCPriceWidget">github.com/hakeydotom/BTCPriceWidget</a> </div><p>Source: <a href="https://habr.com/ru/post/318482/">https://habr.com/ru/post/318482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318472/index.html">Front-end JavaScript framework Evolution :: release 1.5.7</a></li>
<li><a href="../318474/index.html">Framework for working with Telegraph API</a></li>
<li><a href="../318476/index.html">Shielded VM Technology in Windows Server 2016</a></li>
<li><a href="../318478/index.html">Microsoft‚Äôs .NET open source translation brought tangible benefits</a></li>
<li><a href="../318480/index.html">ASP.NET Core, Angular 2, SignalR for Dummies</a></li>
<li><a href="../318484/index.html">Fast Data Mining or C # vs Python Performance Comparison (pandas-numpy-skilearn)</a></li>
<li><a href="../318486/index.html">The operating temperature range of the Raspberry Pi. Test results</a></li>
<li><a href="../318488/index.html">How IT professionals celebrate New Year (survey infographic)</a></li>
<li><a href="../318494/index.html">Uninitialized variables: look for errors</a></li>
<li><a href="../318496/index.html">Simple framework UI ERP with Vaadin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>