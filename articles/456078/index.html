<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Projection of corporate conflict on network connectivity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The corporate conflict arose on 10.06.2019 due to the increasing cost of delivering SMS to VimpelCom users by Mail.RU Group. In response, Mail.RU Grou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Projection of corporate conflict on network connectivity</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/cp/8x/ty/cp8xty7ejmoaj8gl7q7uhikmku0.png" alt="image"></div><br>  The corporate conflict arose on 10.06.2019 due to the increasing cost of delivering SMS to VimpelCom users by Mail.RU Group.  In response, Mail.RU Group ceased to ‚Äúserve‚Äù direct Russian IP channels in the direction of the VimpelCom network. <br><br>  Below is a brief analysis of the situation from the perspective of a network engineer. <br><br>  <b>Update</b> : 06/14/2019 18:45 - emphasis on Russian routes to VimpelCom network, corrected conclusions, added an explanation by <b>Sergey Kubasov (CIO Vkontakte)</b> . <br>  <b>Update</b> : 06/14/2019 19:48 - Added description of a method for limiting the distribution of routes along the ‚Äúshort‚Äù Russian route via Rostelecom, MTS, RETN. NO .. <br>  <b>Update</b> : 06/15/2019 09:39 - Mail.ru has blocked its Looking Glass. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  Introductory: <br>  VimpelCom has an AS3216 autonomous system, all others (8402 - home Internet, 16345 - mobile Internet) are located behind 3216. <br><br>  Mail.RU Group - autonomous systems AS47541, AS47542 and AS47764.  The main content generator is 47,542, the so-called.  CDN VKONTAKTE (movies, music).  All autonomous systems are independent of each other (from the standpoint of an external autonomous system). <br><br>  First, we look at the situation from the VimpelCom network.  <a href="http://lg.gldn.net/">Looking Glass Vimpelcom</a> will help us to do this. <br><br>  We look at the first autonomous system - AS47541. <br><br><pre><code class="perl hljs"><span class="hljs-number"><span class="hljs-number">2914</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span> <span class="hljs-number"><span class="hljs-number">79.104</span></span>.<span class="hljs-number"><span class="hljs-number">32.251</span></span> (metric <span class="hljs-number"><span class="hljs-number">10500</span></span>) (<span class="hljs-number"><span class="hljs-number">79.104</span></span>.<span class="hljs-number"><span class="hljs-number">32.251</span></span>) Origin IGP, metric <span class="hljs-number"><span class="hljs-number">30</span></span>, localpref <span class="hljs-number"><span class="hljs-number">87</span></span>, valid, internal, best, group-best, import-candidate, import suspect Received Path ID <span class="hljs-number"><span class="hljs-number">0</span></span>, Local Path ID <span class="hljs-number"><span class="hljs-number">1</span></span>, version <span class="hljs-number"><span class="hljs-number">2865394342</span></span> Community: <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">410</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">1214</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">2213</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">3200</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3103</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">40000</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">50078</span></span></code> </pre> <br>  AS-PATH contains two autonomous systems - 2914 (NTT) and 47541 (VKONTAKTE-SPB-AS). <br>  The localpref metric is set to 87, which, according to the description in the RIPE DB for the AS3216 object, corresponds to the international peering. <br><blockquote>  ... <br>  remarks: International peer's routes get local preference in the <br>  remarks: range of 81-89. <br>  ... </blockquote>  The same information is confirmed by the 3216: 3000 and 3216: 3103 community (source - <a href="https://apps.db.ripe.net/db-web-ui/">RIPE DB for AS3216</a> ): <br><blockquote>  ... <br>  remarks: 3216: 3000 Receieved from an international uplink or peer, specifically: <br>  ... <br>  remarks: 3216: 3103 AMS-IX <br>  ... </blockquote>  That is, the route to VKontakte Vimpelcom sees through the European joint. <br><br>  Let's look at another VKontakte 47542 VK (VKONTAKTE-MSK-CDN-AS). <br><br><div class="spoiler">  <b class="spoiler_title">All the same.</b> <div class="spoiler_text"><pre> <code class="perl hljs"> <span class="hljs-number"><span class="hljs-number">2914</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span> <span class="hljs-number"><span class="hljs-number">79.104</span></span>.<span class="hljs-number"><span class="hljs-number">32.251</span></span> (metric <span class="hljs-number"><span class="hljs-number">10500</span></span>) (<span class="hljs-number"><span class="hljs-number">79.104</span></span>.<span class="hljs-number"><span class="hljs-number">32.251</span></span>) Origin IGP, metric <span class="hljs-number"><span class="hljs-number">30</span></span>, localpref <span class="hljs-number"><span class="hljs-number">87</span></span>, valid, internal, best, group-best, import-candidate, import suspect Received Path ID <span class="hljs-number"><span class="hljs-number">0</span></span>, Local Path ID <span class="hljs-number"><span class="hljs-number">1</span></span>, version <span class="hljs-number"><span class="hljs-number">2865394338</span></span> Community: <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">410</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">1214</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">2213</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">3200</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3103</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">40000</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">50078</span></span></code> </pre> <br></div></div><br>  And what about Mail.ru itself?  Let's look at AS47764 (mailru-as). <br><br><pre> <code class="perl hljs"> <span class="hljs-number"><span class="hljs-number">3356</span></span> <span class="hljs-number"><span class="hljs-number">47764</span></span> <span class="hljs-number"><span class="hljs-number">194.67</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">215</span></span> (metric <span class="hljs-number"><span class="hljs-number">10501</span></span>) (<span class="hljs-number"><span class="hljs-number">194.67</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">215</span></span>) Origin IGP, metric <span class="hljs-number"><span class="hljs-number">0</span></span>, localpref <span class="hljs-number"><span class="hljs-number">77</span></span>, valid, internal, best, group-best, import-candidate Received Path ID <span class="hljs-number"><span class="hljs-number">0</span></span>, Local Path ID <span class="hljs-number"><span class="hljs-number">1</span></span>, version <span class="hljs-number"><span class="hljs-number">2867605667</span></span> Community: <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3007</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">123</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">519</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">2094</span></span> <span class="hljs-number"><span class="hljs-number">47764</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">47764</span></span>:<span class="hljs-number"><span class="hljs-number">40000</span></span> <span class="hljs-number"><span class="hljs-number">47764</span></span>:<span class="hljs-number"><span class="hljs-number">50077</span></span></code> </pre> <br>  Vimpelcom sees Mail.ru through as3356 (Level3 uplink, Tier1 operator).  This information is confirmed by localpref 77: <br><blockquote>  ... <br>  remarks: Uplink's routes get local preference in the range of 71-79. <br>  remarks: Last Update: February 2012 ... </blockquote>  and the community (3216: 3000 and 3216: 3007): <br><blockquote>  ... <br>  remarks: 3216: 3000 Receieved from an international uplink or peer, specifically: <br>  ... <br>  remarks: 3216: 3007 Level 3 Communications <br>  ... </blockquote><br>  From the information received, it is clear that the traffic from the Vimpelcom network to VKontakte and MailRu spreads through European junctions according to the routes received via the BGP protocol.  There are no alternative routes through the internal Russian joints in Looking Glass.  Measures to artificially redirect traffic through the obviously worst routes were not detected. <br><br>  And how does Mail.ru Group see the VimpelCom network? <br>  Use the <a href="https://net.mail.ru/looking_glass.html">Looking Glass from Mails</a> .  <b>Update</b> : as of the morning 06/15/2019 Looking Glass does not work, when prompted, the 500th error is issued: <img src="https://habrastorage.org/getpro/habr/post_images/928/482/db5/928482db54c7ee3799479416ed03d9b3.png" alt="image"><br><br>  From AS47764 (mailru-as) routers: <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#6: Received by speaker 0 Advertised to peers (in unique update groups): 188.93.60.188 1299 1299 1273 3216 3216 217.20.147.250 (metric 100) from 217.20.147.250 (217.20.147.253) Origin IGP, metric 500, localpref 200, valid, internal, best, group-best Received Path ID 0, Local Path ID 0, version 1172721494 Community: 1299:20000 47764:701 47764:41100 47764:41108 47764:50077</span></span></code> </pre> <br><br>  AS-PATH contains AS1299 (Telia, Tier1 operator, uplink Mail.RU) and as1273 (Vodafon, Tier1 operator, uplink VimpelCom). <br><br>  LocalPreference 200 is the standard for external Mail.ru joints (https://net.mail.ru/bgp.html), and the MED 500 matches everything that was received not from a direct interface, not from IXs, not from peering. <br><br>  But why are there no local routes through Russian telecom operators ??? <br>  There are they, but their priority is ‚Äúnon-standard‚Äù! <br>  Here is the route through Rostelecom (as12389): <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#1: Received by speaker 0 Not advertised to any peer 12389 3216 46.61.178.149 from 46.61.178.149 (213.59.207.79) Origin IGP, metric 500, localpref 199, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 3216:2001 3216:2999 3216:4100 12389:5 12389:6 12389:1100 12389:1105 12389:1277 47764:701 47764:41100 47764:41104 47764:50077 Origin-AS validity: not-found</span></span></code> </pre> <br>  Here through Megaphone (as31133): <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#2: Received by speaker 0 Not advertised to any peer 31133 3216 78.25.77.41 from 78.25.77.41 (10.222.253.97) Origin IGP, metric 500, localpref 199, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 3216:2001 3216:2999 3216:4100 31133:300 31133:46170 47764:701 47764:41100 47764:41105 47764:50077 Origin-AS validity: not-found</span></span></code> </pre> <br>  Here through RETN. NO: <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#3: Received by speaker 0 Not advertised to any peer 9002 9002 3216 87.245.253.24 from 87.245.253.24 (87.245.225.1) Origin IGP, metric 500, localpref 199, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 9002:9002 9002:64667 47764:701 47764:41100 47764:41101 47764:50077 Origin-AS validity: not-found</span></span></code> </pre> <br>  And even through the MTS! <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#5: Received by speaker 0 Not advertised to any peer 8359 3216 212.188.61.105 from 212.188.61.105 (195.34.52.77) Origin IGP, metric 500, localpref 199, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 8359:200 8359:609 8359:5012 47764:701 47764:41100 47764:41103 47764:50077 Origin-AS validity: not-found</span></span></code> </pre> <br>  The metric localpref on these Russian routes is understated, that is, routes are worsened compared to foreign ones! <br><br>  In addition, <b>Mail.Ru Group prohibits the</b> distribution of its prefixes in VimpelCom through Russian operators! <br><br>  RETN. NO (http://lg.retn.net/): <br>  On announcements from Mail.RU Group there is a 3216: 65535 community. <br><div class="spoiler">  <b class="spoiler_title">Output from LG RETN. NO</b> <div class="spoiler_text">  inet.0: 762737 destinations, 1734826 routes (762708 active, 222780 holddown, 277 hidden) <br>  94.100.176.0/20 (1 entry, 1 announced) <br>  * BGP Preference: 170 / -201 <br>  ... <br>  ... <br>  AS path: 47764 I <br>  AS path: Recorded <br>  Communities: 3216: 65535 9002: 64667 9002: 65530 <br>  ... <br></div></div><br>  Routes marked by such a community VimpelCom does not accept on its network.  Extract from RIPE DB by AS3216: <br><blockquote>  ... <br>  remarks: Internal comminuties are only internally assigned. <br>  remarks: They are in range 3216: 0000-3216: 4999 and 3216: 6000-3216: 65535 <br>  remarks: at the border <br>  remarks: routers. <br>  ... </blockquote><br>  Towards Rostelecom (http://lg.ip.rt.ru) Mail.RU Group gives similar routes with the 12389: 8350 community. <br><div class="spoiler">  <b class="spoiler_title">Withdraw from LG Rostelecom</b> <div class="spoiler_text">  94.100.176.0/20 via 217.107.65.1 on eth0.9 [sr2 2019-06-13] * (100 /?) [AS47764i] <br>  Type: BGP unicast univ <br>  BGP.origin: IGP <br>  BGP.as_path: 47764 <br>  BGP.next_hop: 213.59.207.78 <br>  BGP.med: 0 <br>  BGP.local_pref: 850 <br>  BGP.community: (12389.1) (12389,1100) (12389.1105) (12389.1277) (12389.8350) (12389.8380) (47764.1) (47764.40000) (47764.50077) <br>  BGP.originator_id: 213.59.207.78 <br>  BGP.cluster_list: 95.167.88.79 95.167.88.49 95.167.88.17 <br></div></div><br>  According to the entries in the RIPE DB for the as12389 object, this community means ‚Äúdo not announce as3216 on the network‚Äù: <blockquote>  ... <br>  remarks: |  12389: 835y When advertising to GoldenTelecom (AS3216) | <br>  ... <br>  remarks: |  ... y = 0 - do not advertise | <br>  ... </blockquote><br>  Similarly, in the direction of MTS (http://lg.mtu.ru): <div class="spoiler">  <b class="spoiler_title">Withdraw from LG MTS</b> <div class="spoiler_text">  BGP routing table entry for 94.100.176.0/20, version 161717219 <br>  Paths: (2 available, best # 1, table default) <br>  Multipath: eBGP <br>  Advertised to update-groups: <br>  6 <br>  47764, (received &amp; used) <br>  195.34.52.77 (metric 16) from 195.34.52.181 (195.34.52.181) <br>  Origin IGP, metric 0, localpref 140, valid, internal, best <br>  Community: 8359: 2120 8359: 2150 8359: 5500 8359: 55277 <br>  Originator: 195.34.52.77, Cluster list: 83.59.83.59 <br>  47764, (received &amp; used) <br>  195.34.52.77 (metric 16) from 195.34.52.182 (195.34.52.182) <br>  Origin IGP, metric 0, localpref 140, valid, internal <br>  Community: 8359: 2120 8359: 2150 8359: 5500 8359: 55277 <br>  Originator: 195.34.52.77, Cluster list: 83.59.2.77 <br></div></div><br>  Community 8359: 2120 means: <blockquote>  ... <br>  remarks: 8359: 212x when announcing to Sovam (Beeline) <br>  ... <br>  remarks: x = 0 - do not announce <br>  ... </blockquote><br>  It is impossible to look at the announcements of Mail.RU Group in the direction of Megaphone - the latter does not have Looking Glass. <br><br>  Let's see AS47541 (VKONTAKTE-SPB-AS). <br><br><div class="spoiler">  <b class="spoiler_title">The output is too big.</b> <div class="spoiler_text"><pre> <code class="perl hljs"> Router: a9922-e-<span class="hljs-number"><span class="hljs-number">5</span></span> Command: show ip bgp <span class="hljs-number"><span class="hljs-number">81.211</span></span>.<span class="hljs-number"><span class="hljs-number">56.202</span></span> Last switch-over Thu Apr <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>:09 <span class="hljs-number"><span class="hljs-number">2018</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> year, <span class="hljs-number"><span class="hljs-number">10</span></span> weeks, <span class="hljs-number"><span class="hljs-number">6</span></span> hours, <span class="hljs-number"><span class="hljs-number">9</span></span> minutes ago Fri Jun <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">20.791</span></span> MSK BGP routing table entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">81.211</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">17</span></span> Versions: Process bRIB/RIB SendTblVer Speaker <span class="hljs-number"><span class="hljs-number">913059757</span></span> <span class="hljs-number"><span class="hljs-number">913059757</span></span> Last Modified: May <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">38.536</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>y03w Paths: (<span class="hljs-number"><span class="hljs-number">6</span></span> available, best <span class="hljs-comment"><span class="hljs-comment">#4) Advertised to update-groups (with more than one peer): 0.2 Advertised to peers (in unique update groups): 188.93.60.188 Path #1: Received by speaker 0 Not advertised to any peer 1299 1273 3216 3216 87.240.191.235 (metric 31) from 87.240.191.235 (87.240.191.235) Origin IGP, metric 5000, localpref 150, valid, internal Received Path ID 0, Local Path ID 0, version 0 Community: 1273:12752 1299:431 1299:4000 1299:20000 1299:20002 1299:20200 3216:2001 3216:2999 3216:4100 47541:701 47541:41100 47541:41111 47541:50078 Path #2: Received by speaker 0 Not advertised to any peer 1299 1273 3216 3216 87.240.191.248 (metric 31) from 87.240.191.248 (87.240.191.248) Origin IGP, metric 5000, localpref 150, valid, internal Received Path ID 0, Local Path ID 0, version 0 Community: 1273:12752 1299:431 1299:4000 1299:20000 1299:20002 1299:20200 3216:2001 3216:2999 3216:4100 47541:701 47541:41100 47541:41111 47541:50078 Path #3: Received by speaker 0 Not advertised to any peer 174 6762 3216 3216 87.240.191.249 (metric 31) from 87.240.191.249 (87.240.191.249) Origin IGP, metric 5000, localpref 150, valid, internal Received Path ID 0, Local Path ID 0, version 0 Community: 174:21100 174:22005 47541:701 47541:41100 47541:41108 47541:50078 Path #4: Received by speaker 0 Advertised to update-groups (with more than one peer): 0.2 Advertised to peers (in unique update groups): 188.93.60.188 174 6762 3216 3216 149.6.169.113 from 149.6.169.113 (38.28.1.236) Origin IGP, metric 5000, localpref 150, valid, external, best, group-best Received Path ID 0, Local Path ID 0, version 913059757 Community: 174:21100 174:22005 47541:701 47541:41100 47541:41108 47541:50078 Origin-AS validity: not-found Path #5: Received by speaker 0 Not advertised to any peer 1273 1273 3216 3216 195.89.114.197 from 195.89.114.197 (195.2.1.107) Origin IGP, metric 5005, localpref 150, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 1273:12752 3216:2001 3216:2999 3216:4100 47541:701 47541:41100 47541:41110 47541:50078 Origin-AS validity: not-found Path #6: Received by speaker 0 Not advertised to any peer 3356 3356 3216 3216 3216 213.242.69.69 from 213.242.69.69 (4.69.177.130) Origin IGP, metric 5000, localpref 150, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 3216:2001 3216:2999 3216:4100 3356:2 3356:22 3356:100 3356:123 3356:503 3356:2067 47541:701 47541:41100 47541:41107 47541:50078 Origin-AS validity: not-found</span></span></code> </pre> </div></div><br>  AS-PATH points to AS174 - Cogent (uplink Mail.RU, Tier1), then AS6762 - Telecom Italia (uplink VimpelCom).  Local Preference everywhere 150, but so on all external joints, regardless of the <a href="https://net.mail.ru/bgp.html">written policy</a> . <br><br>  Let's see AS47542 (VKONTAKTE-MSK-CDN-AS). <br><pre> <code class="perl hljs"> Router: mx96<span class="hljs-number"><span class="hljs-number">0</span></span>-m9-<span class="hljs-number"><span class="hljs-number">0</span></span> Command: op lg-sh-bgp prefix <span class="hljs-number"><span class="hljs-number">81.211</span></span>.<span class="hljs-number"><span class="hljs-number">56.202</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> LP:<span class="hljs-number"><span class="hljs-number">151</span></span> MED: NH:<span class="hljs-number"><span class="hljs-number">87.240</span></span>.<span class="hljs-number"><span class="hljs-number">191.222</span></span> AS path: <span class="hljs-number"><span class="hljs-number">47541</span></span> I Communities: Accepted Best <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> LP:<span class="hljs-number"><span class="hljs-number">151</span></span> MED: NH:<span class="hljs-number"><span class="hljs-number">95.142</span></span>.<span class="hljs-number"><span class="hljs-number">204.251</span></span> AS path: <span class="hljs-number"><span class="hljs-number">47541</span></span> I Communities: Accepted Inactive-reason: Interior &gt; Exterior &gt; Exterior via Interior</code> </pre> <br>  And from the second router: <pre> <code class="perl hljs"> Router: mx96<span class="hljs-number"><span class="hljs-number">0</span></span>-m9-<span class="hljs-number"><span class="hljs-number">1</span></span> Command: op lg-sh-bgp prefix <span class="hljs-number"><span class="hljs-number">81.211</span></span>.<span class="hljs-number"><span class="hljs-number">56.202</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> LP:<span class="hljs-number"><span class="hljs-number">151</span></span> MED: NH:<span class="hljs-number"><span class="hljs-number">87.240</span></span>.<span class="hljs-number"><span class="hljs-number">191.224</span></span> AS path: <span class="hljs-number"><span class="hljs-number">47541</span></span> I Communities: Accepted Best <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> LP:<span class="hljs-number"><span class="hljs-number">151</span></span> MED: NH:<span class="hljs-number"><span class="hljs-number">95.142</span></span>.<span class="hljs-number"><span class="hljs-number">204.250</span></span> AS path: <span class="hljs-number"><span class="hljs-number">47541</span></span> I Communities: Accepted Inactive-reason: Interior &gt; Exterior &gt; Exterior via Interior</code> </pre> <br>  Only default routes (0.0.0.0/0).  This situation was explained by an employee of Mail.RU Group <a href="https://habr.com/ru/users/greediness/" class="user_link">greediness</a> , for which he thanks.  In short: the Moscow segment of the VKontakte network is caching (and not generating), whose task is to optimize the download speed of popular popular content.  Caring for users, yes. <br><br>  If there is no route to any network, then this network is not served by caching servers.  This means that the optimization of download speed does not work, and users are suffering.  But here it is necessary to emphasize - users are not only their own, but also VimpelCom. <br><br>  <b>Findings:</b> <br><br><ol><li>  On the VimpelCom side, the traffic towards Mail.RU Group is distributed naturally.  No artificial redirects were found using Local Preference manipulations. </li><li>  <b>From Mail.RU Group, there are manipulations with VimpelCom prefixes</b> .  For existing routes towards the Vimpelcom network through Russian operators, priorities are understated compared to routes through foreign Tier1 operators. </li><li>  Mail.RU Group routes to the Russian operators (MTS, Rostelecom, RETN.) Have been added by BGP management communities to limit their distribution towards VimpelCom </li></ol><br>  Why does Mail.RU Group put routes through Europe higher priority?  Why does Mail.RU Group prohibit short domestic Russian connectivity with VimpelCom? <br><br>  Are they so cheaper?  Drive traffic through foreign channels and pay Tirvana currency? <br>  Or is there a desire to drive traffic away to take it was not so convenient, eh? <br>  This is not known to the network engineer ... </div><p>Source: <a href="https://habr.com/ru/post/456078/">https://habr.com/ru/post/456078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456060/index.html">We check information about unreliability in extracts from the Unified State Register of Legal Entities by gluing them in pdf to python</a></li>
<li><a href="../456064/index.html">October. Revolutionary Security Approaches</a></li>
<li><a href="../456068/index.html">5 mistakes novice lead</a></li>
<li><a href="../456070/index.html">How to attract users to the self-service portal</a></li>
<li><a href="../456072/index.html">Dav1d - the fastest AV1 decoder now in Firefox by default.</a></li>
<li><a href="../45608/index.html">Sparko</a></li>
<li><a href="../456080/index.html">Which student needs a magician and which AI do we need?</a></li>
<li><a href="../456086/index.html">iOS Storyboards: analysis of the pros and cons, best practices</a></li>
<li><a href="../456088/index.html">Big Data Analysis Problems</a></li>
<li><a href="../456090/index.html">Introduction to unit testing in Unity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>