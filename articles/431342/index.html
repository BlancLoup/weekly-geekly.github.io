<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Used car loan for 1 minute</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instead of introducing 


 Like all interesting stories, this one started long enough and unexpectedly. One day, our partner bank came to us and said:...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Used car loan for 1 minute</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/sb/mw/tr/sbmwtrme9nvzfag22j8cxpouqzk.jpeg"></p><br><h2 id="vmesto-vvedeniya">  Instead of introducing </h2><br><p>  Like all interesting stories, this one started long enough and unexpectedly.  One day, our partner bank came to us and said: ‚ÄúGuys, we learned how to score in our system in one minute.  How about combining our efforts and integrating projects?  With us - a solution and a loan, with you - cars. ‚Äù  To say that we were inspired - to say nothing!  We had every chance of becoming the first one in the world who can give a loan online for a used car in one minute (ONE MINUTE, KARL)!  Below, I will tell you what came out of it, but for a start I will tell you who we are. <a name="habracut"></a></p><br><p><img src="https://habrastorage.org/webt/n7/t5/sl/n7t5sljpvereqprdx0rbocrdm84.jpeg"></p><br><p>  We are ‚ÄúWheels |  Roof |  Market ‚Äùis the largest IT-company based in Kazakhstan.  Every day, our products help six million Kazakhstanis to buy and sell cars, apartments, cribs and thousands of other things.  Kolesa.kz is the largest auto resource and application, not the first year it has been ranked 1st in the mobile rating of Kazakhstan. </p><br><h2 id="chto-iz-sebya-predstavlyaet-proekt-avtokredit">  What is the project "Car loan"? </h2><br><p>  At the moment, the base of used cars is 103,400 cars, more than 60% of them are available on credit! </p><br><div class="spoiler">  <b class="spoiler_title">What it looks like in pictures</b> <div class="spoiler_text"><h3 id="1-vybiraem-mashinu-kotoruyu-hotim-vzyat-v-kredit">  1. Choose the car you want to borrow </h3><br><p><img src="https://habrastorage.org/webt/j6/ft/id/j6ftidhsd9nk8dsrqghfo5jyfes.png"></p><br><p>  <em>Figure 1. Search engine lending available</em> </p><br><h3 id="2-na-stranice-obyavleniya-vidim-formu-dlya-podachi-zayavki-na-kredit">  2. On the advertisement page we see the form for applying for a loan </h3><br><p><img src="https://habrastorage.org/webt/qo/ja/cr/qojacrzpfgmut_8xd7-nlbcr-1s.png">  <em>Figure 2. Ad Page Screen</em> </p><br><h3 id="3-vybiraem-period-i-pervonachalnyy-vznos-i-nazhimaem-poluchit-odobrenie">  3. Select the period and the initial fee and click to get approval </h3><br><p><img src="https://habrastorage.org/webt/yd/ve/ol/ydveol7jxtupaoguc81pyowbsmc.png"><br>  <em>Figure 3. Credit calculator for ad</em> </p><br><h3 id="4-popadaem-na-formu-gde-nam-nuzhno-vvesti-svoi-kontaktnye-dannye">  4. We get on the form where we need to enter our contact details </h3><br><p><img src="https://habrastorage.org/webt/sq/sk/zj/sqskzj6wk-zophmc7dibyd1teys.png"><br>  <em>Figure 4. Loan application initialization form</em> </p><br><p>  Here we enter your mobile phone number Name and IIN (in Russia it would be an INN) </p><br><h3 id="5-dalee-vam-neobhodimo-vvesti-kod-sms-kotoryy-pridyot-na-ukazannyy-vami-nomer">  5. Next you need to enter the SMS code that will come to the number you specified. </h3><br><p><img src="https://habrastorage.org/webt/od/ey/kc/odeykcr1vtkveylifnf6oza8xxm.png"><br>  <em>Figure 5. The form of confirmation of the phone number by entering SMS</em> </p><br><h3 id="6-posle-etogo-nachinaetsya-sam-process-skoringa-kotoryy-dlitsya-ne-bolee-1-minuty">  6. After this, the scoring process itself begins, which lasts no more than 1 minute. </h3><br><p><img src="https://habrastorage.org/webt/9s/po/6s/9spo6soaw7vjupijhkpfnehkdyq.png">  <em>Figure 6. The scoring process screen</em> </p><br><h3 id="7-est-neskolko-variantov-rezultata-skoringa">  7. There are several options for scoring: </h3><br><ol><li>  You approve of a loan </li><li>  You are denied a loan </li><li>  You are offered alternative conditions. </li><li>  You are asked for additional information, after the provision of which you receive one of the previous options (a, b, c) </li></ol><br><p><img src="https://habrastorage.org/webt/7s/ba/d_/7sbad_bmbosrd4kcgdt4wa65884.png"><br>  <em>Figure 7. Example of Car Loan Approval Screen</em> </p><br><p>  After the person receives approval of his application, the manager from the bank calls him back within 10 minutes and informs the person about what actions he needs to take further in order to issue a loan.  Convenient, isn't it?  Let's see how it was all implemented. </p></div></div><br><h2 id="ty-pomnish-kak-vsyo-nachinalos">  Do you remember how it all started‚Ä¶ </h2><br><p>  It was the first time and again!  If earlier, as a credit form, we simply had a feedback form, then our new idea was something completely new and incomprehensible.  Since  We had no analogues, we had to have a very exciting experience - to plan, design, distribute and implement.  To begin with, we broke the whole process of our joint integration into 2 blocks, which were performed in parallel, namely: </p><br><ul><li>  Infrastructure integration </li><li><p>  Software integration </p><br><p>  Initially, we agreed with the partner bank that it (the partner bank) will provide us with some kind of API, to which we will send some data and receive some answers.  On that and decided.  We began to wait for API documentation from the bank, brought our engineers and their network engineers together!  In terms of software integration, a fairly simple scheme emerged, we send the data to the bank, the bank scrolls through it in its system, and returns it to us, and all this within the guaranteed 60 seconds.  In case of a timeout (where without it), we agreed to display an emergency questionnaire in which we collect data that the bank may additionally need. </p><br></li></ul><br><h3 id="seti">  Network </h3><br><p>  At that time, while the developers chose the tools for implementation, designed their system and waited for the documentation on the partner system, in the infrastructure department the work was already in full swing!  We had two partners with our partner bank: 2 adjacent tsiska in one DC, cable connecting tsiski, VPN-tunnel, safety certificates and access to work with them of all colors and sizes ... The plan was as follows, We pass the encrypted VPN channel between our servers, and build direct integration between our services.  Schematically, this can be represented as: </p><br><p><img src="https://habrastorage.org/webt/hl/oy/wn/hloywn-uxue8ceolpvmdodhla5w.png"></p><br><h3 id="pogovorim-pro-kod">  Let's talk about the code </h3><br><p>  Below we will talk about how and what is arranged by our service.  So, having received a document describing the partner's service ready for integration, we learned that, unlike us, the bank works only with SOAP requests, and does not want to hear about any RESTful services.  And since in our services we use SOAP a little less than never, we had many wonderful discoveries about how to learn how to prepare SOAP in our new product.  Therefore, we needed to teach our service how to parse SOAP requests and convert our responses back to SOAP. </p><br><h4 id="vybora-freymvorka">  Choosing a framework </h4><br><p>  To begin with, it was necessary to choose at least an implementation language, there were a lot of ideas, starting with C and C # ending with golang and erlang.  We decided to go on a simple path.  The system will need to be maintained, and in order not to run into the bus factor with the lack of specialists in the market, we decided to focus on the most common technology in our company - PHP.  Thank God that the window was no longer 2001, and the year 2017 and php frameworks are so numerous that they can satisfy the needs of even highly sophisticated engineers.  After going through a whole bunch, we chose one of the simplest and at the same time supported - Yii 2. </p><br><p>  <strong>For this decision was:</strong> </p><br><ul><li>  Easy to master, a whole bunch of literature; </li><li>  It is easy enough to build forms and validators; </li><li>  There is an Active Record and a car ready for work with all sorts of tools; </li><li>  He really is fast; </li><li>  At its base, the API is simply built, it is convenient to write console commands. </li></ul><br><p>  <strong>It was against:</strong> </p><br><ul><li>  The framework is built on static methods - this is very inconvenient, including when writing tests </li><li>  It was not entirely clear what additional tools we would need in the near future after launch, and, as a result, there was a risk of not finding the necessary libraries ... </li></ul><br><h4 id="vybor-hranilisch">  Storage selection </h4><br><p>  The framework has been chosen; now it‚Äôs time to choose a repository for applications.  There were several options, MySQL, mongoDB, postgreSQL ... On the one hand, the application is a document, for sure its structure can change, from time to time adding new fields and getting rid of irrelevant ones.  On the other hand, the use of non-relational databases will impose its limitations.  After weighing all the pros and cons, we decided to sit on 2 chairs and start using MySQL, and after starting migrate to the mongoDB + ElasticSearch bundle.  As a result, 2 MySQL replicas were raised as storage and bolted to the application using ActiveRecord.  By the time we started the transition to mongoDB, the amount of data has grown tremendously and has taken such a growth rate that there is another need to separate requests for conditional storage.  As a tool for near-realtime document indexing, ElasticSearch decided to use a service written in Golang - monstache. </p><br><h4 id="stroim-infrastrukturu">  We build infrastructure </h4><br><p>  The infrastructure decided to do the following: 10 backends with an application request handler, 2 balancers, 2 MySQL replicas, 3 elasticsearch shards, 3 mongoDB replicas and 2 monstache replicas of the service. <img src="https://habrastorage.org/webt/n4/c4/gz/n4c4gzsszplllqrpbxxgd4uhnkw.png"></p><br><h2 id="process">  Process </h2><br><p>  In general, the process of car loans can be divided into 2 parts: </p><br><ol><li>  To get started, you need to find a suitable car available on credit.  Most likely you will be guided by its condition and credit conditions. </li><li>  After you select a car, you need to get a loan approval, for this you will need to fill out an application </li></ol><br><p>  We have more or less told about the implementation of the second part, we will talk about the implementation of the first part.  The implementation of the first part consists of several parts: </p><br><ol><li>  When searching for a car, a person should be able to focus, in addition to technical parameters, on the availability of a car for purchase on credit and on the minimum monthly payment.  To do this, we need to know at the time of the announcement of the announcement whether the car is available on credit and what will be the minimum payment for it. </li><li>  After a person chooses a car, we need to provide him with a loan calculator, where he could choose the size of the down payment and the loan term, thereby choosing the most comfortable monthly payment amount. </li></ol><br><p>  For this purpose, a special microservice in the go language was developed.  Its essence was as follows: When submitting an advertisement, an object is sent to microservice with all the vehicle data, microservice, based on the rules that are written separately for it, returns the minimum monthly payment for indexation in the search, and also returns the minimum initial installment and allowable time credits that form the basis for building a loan calculator. </p><br><p><img src="https://habrastorage.org/webt/v3/3s/oj/v33sojevpnsmwuqh8il4vhciili.png"></p><br><p>  We pre-cache the miscalculation options for the standard values ‚Äã‚Äãof the initial payment and the monthly payment.  This is done for each of the available credit periods.  If a person changes the initial payment (within the limits of the allowable), then microservice will again calculate all the data.  If the initial payment is specified less than the allowable, the calculator will display a validation error. </p><br><p><img src="https://habrastorage.org/webt/o0/0o/vv/o00ovv3safkjazq87fpkhqvvp2o.png"></p><br><p>  Due to the high load on our service, the loan calculator has 2 degrees of caching: the first occurs on the back end, where customers initially go for the calculator, the second in microservice itself. </p><br><h2 id="tak-chto-v-itoge">  So what is the result? </h2><br><p> We launched the project on September 11, 2017.  From the moment on today's date (12/04/2018) 2,973,868 applications have been submitted.  We are in a continuous process of improving our service and simplifying the user path.  Making it faster easier and more stable!  Uptime of the project for the entire period since launch was 99.99%. </p><br><p>  As a result, we have the following results: </p><br><ol><li>  Significantly shortened user path </li><li>  Expanded the volume of cars available for lending to 60% of the entire base </li><li>  To date, the number of applications has increased by more than 7 times! </li></ol><br><h2 id="vmesto-zaklyucheniya">  Instead of conclusion </h2><br><p>  For 3 months we managed to build a truly amazing and unique project.  Its main goal was to give our customers the opportunity to purchase used cars without leaving our platform.  In just 1 minute, the user can get a decision on his request, call the seller, and arrange all the necessary documents on the same day. <br>  Judging by the number of applications per year and 2 months, we can conclude that we manage to make the service really convenient and in demand. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/431342/">https://habr.com/ru/post/431342/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431330/index.html">Mobile weekend: free live Mobius</a></li>
<li><a href="../431332/index.html">Overview of the most interesting reports DotNext 2018: version of EastBanc Technologies</a></li>
<li><a href="../431334/index.html">Huawei: Protection of the control plane</a></li>
<li><a href="../431338/index.html">The book "DNA. The history of the genetic revolution "</a></li>
<li><a href="../431340/index.html">His fleet of 11 polygons, nothing to do with the present</a></li>
<li><a href="../431344/index.html">Built-in acoustics: what it is and how it works</a></li>
<li><a href="../431346/index.html">Developing Action-able Slack Applications</a></li>
<li><a href="../431348/index.html">Anycubic Photon: A Mini-Review of an Affordable Photopolymer 3D Printer</a></li>
<li><a href="../431350/index.html">Plans for the development of a line of processors from Baikal Electronics</a></li>
<li><a href="../431354/index.html">The first video codec on machine learning radically surpassed all existing codecs, including H.265 and VP9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>