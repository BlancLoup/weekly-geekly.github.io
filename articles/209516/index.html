<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Netavis Observer is a Linux based IP video surveillance software. Installation, configuration and small hacking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Netavis Observer is a software product for organizing video surveillance using IP cameras based on a Linux server. 
 Netavis Observer is written in Ja...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Netavis Observer is a Linux based IP video surveillance software. Installation, configuration and small hacking</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>Netavis Observer</b> is a software product for organizing video surveillance using IP cameras based on a Linux server. </h4><br>  Netavis Observer is written in Java, products like Apache Tomcat, Webmin, Munin, Mysql are also used. <br><br>  There are two options for Netavis Observer - Bundled (supplied as an installation iso-image based on Centos5 or Centos6) and Unbundled - a set of rpm-packages for self-installation on a server running Centos or RedHat. <br><div class="spoiler">  <b class="spoiler_title">basic functionality and features:</b> <div class="spoiler_text">  - Support for popular IP cameras and video servers, such as AXIS, ArecontVision, D-link, ACTi, Sanyo, Samsung and others (you can see the full list on the Netavis website). <br>  - Support separation of camera access rights, viewing the archive, video export, PTZ control (PTZ control) with the ability to create groups and users for a specific situation (only viewing online video, viewing online video and archive, but without the right to export video from archive, etc.) <br>  - Availability of the client under Windows, IPhone / iPad. <br>  - Ability to work via a browser (JAVA installation required). <br>  - Ability to create a cluster to work with a large number of cameras. <br>  - Active Directory support (as amended by Enterprise). <br>  - Support Video Analysis (iCAT - motion detection with variations, sabotage detection, remote object detection, privacy mask). <br>  - Adjust the quality of displaying video online and when recording to the archive. <br>  - Customize the location of cameras and the formation of custom sets with the ability to copy these sets to other users. <br>  - Ability to limit bandwidth for cameras and clients when viewing live video and archive. <br>  - Exporting the archive to AVI or SAFE (a .EXE executable file is created with a primitive player and the actual video, you can export the right number of cameras at once in one period of time, one EXE file will be created). <br>  - The ability to run the graphical shell directly on the server - the LXDE session is started, after which the Netavis client is launched. <br></div></div><br><a name="habracut"></a><br><h5>  Now proceed to install </h5><br>  We follow the link and download the Bundled version of the Netavis Observer in the form of iso, write it to the disc and insert it into the server's CD-ROM drive. <br>  Immediately after loading, we see a welcome screen with options for further actions, and there are not very many of them: <br><img src="https://habrastorage.org/getpro/habr/post_images/fee/a0f/b7a/feea0fb7afeb72dd373fc27b01f03fa6.jpg" alt="image"><br>  - <i>install options</i> where <i>options</i> : <br>  - <i>no options</i> - standard installation on one hard disk. All data from the hard disk will be deleted. <br>  - <i>hwraid</i> - installation on iron RAID. <br>  - <i>nus</i> ‚Äî installation of the event server and without archive. <br>  - <i>part</i> - installation with the possibility of manual partitioning of disks. <br>  - <i>nlis</i> ‚Äî install without archive storage on local disks. Archive storages are mounted via NFS or SAMBA. <br>  - <i>repair</i> - system recovery after a failure. <br><br>  Our choice is boot: install. Next is the standard installation procedure for Centos5.  After the installation is complete, we agree to reboot.  After loading the operating system, we see an invitation to enter the login <b>admin</b> to complete the installation of the system. <br><img src="https://habrastorage.org/getpro/habr/post_images/d67/ec0/d01/d67ec0d01066bcc09da9547af89d2da3.jpg" alt="image"><br>  After that, press Enter, and then <b>0</b> to confirm the completion of the installation. We agree with the terms of the license agreement by entering <b>yes</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, enter the password for the admin user: <br><img src="https://habrastorage.org/getpro/habr/post_images/17e/3dc/66b/17e3dc66bd9da7173fbba32fd5477d92.jpg" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">Next on the list:</b> <div class="spoiler_text">  - Choose which file system the hard drives will be formatted for storing archives (by default, this is xfs). <br>  - Enter the server name. <br>  - Save the parameters by entering <b>Save</b> . <br>  - Enter the name of the configuration (I left the default value - Default configuration). <br>  - Choose whether to use DHCP to configure the network or set the parameters statically. <br>  - Enter the IP address, network mask, gateway IP address, DNS server IP address (only if the static network setting is selected). <br>  - Enter the IP address of the mail server (to send system events to the mail). <br>  - Enter the domain name. <br>  - Save the parameters by entering <b>Save</b> . <br>  - Choose whether the server is also a time server. <br><img src="https://habrastorage.org/getpro/habr/post_images/bc5/fc9/e10/bc5fc9e103ba389df4269ba7af69d44e.jpg" alt="image"><br>  - Determine servers for time synchronization and save the parameters by entering <b>Save.</b> <br>  - Enter the email address of the administrator. <br>  - Enter the credentials of the so-called.  Customer-user (name, address, organization name). <br>  - We decide whether to launch the client to view the video and archive on the server (by default, do not start). <br></div></div><br>  At this point, the installation is complete and you can reboot by first memorizing or writing down the address of the administrator and client interface: <br>  - <a href="http://192.168.0.5/">192.168.0.5</a> : 8000 - administrator interface - a strongly truncated version of WEBMIN (for login, we use the login <b>admin</b> and the password specified at the beginning of the installation). <br><img src="https://habrastorage.org/getpro/habr/post_images/a1a/5d1/5ff/a1a5d15ffc63e271f11152fe5685479b.png" alt="image"><br>  - <a href="http://192.168.0.5/">192.168.0.5</a> - the Netavis Observer client interface (for logging we use the login <b>admin</b> and the password specified at the beginning of the installation). <br><br>  Launch the browser (tested in recent Firefox and Chrome, as well as in IE7) and enter the client's Netavis Observer address - in this case <i><a href="http://192.168.0.5/">192.168.0.5</a></i> <br>  <b>Important!</b>  - client operation requires installed Java and its support must be activated in the browser settings. <br>  Accordingly, when entering the Netavis interface, this page will first appear: <br><img src="https://habrastorage.org/getpro/habr/post_images/b8d/20c/0a4/b8d20c0a43357076f90d5561ecf85abf.png" alt="image"><br>  and if everything is fine with Java, you can select the interface language and click <b>Start</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/797/8b3/8da/7978b38da5a95ddc39f1000b5c8e61f8.png" alt="image"><br>  In the next screenshot, everything is clear - you can start the client from the browser, install the client on the local computer running Windows, as well as on smartphones under iOS (did not test this feature), also view the documentation or go to the Customizer interface under the <b>admin</b> username and password <b>admin.</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/d44/808/811/d4480881101d1d79ff7d87d1f972050c.png" alt="image"><br>  But let's go back and launch (or install locally) the Netavis Observer client. And the first thing we see is the window in which it is proposed to license the program - and there are four points in it: <br>  - Run without license - cut functionality, even the camera is not added. <br>  - Run with a demo license - you can add a camera, but from time to time it will be thrown out of the program. <br>  - Request a license depending on the number of cameras, users and other buns from the official site. <br>  - Directly enter the license key. <br><img src="https://habrastorage.org/getpro/habr/post_images/d82/daa/737/d82daa737da51bcdff148c33a65fd276.png" alt="image"><br><br>  We are interested in the last item, as the license key is available. Enter the key, click OK and under the key input fields a message appears that the key is stored on the server. Close the licensing window and start the client again. <br>  After launch, an authorization window appears - login and password according to the documentation: <b>admin</b> / <b>admin</b> <br>  and finally, the Netavis Observer client interface: <br><img src="https://habrastorage.org/getpro/habr/post_images/157/5d3/74c/1575d374ce8cb8239fea1ae890bcd96f.png" alt="image"><br><br>  At some point, it turned out that the hard drives installed in the server are not enough to permanently record the archive for each camera for 1 month. <br>  Hard disks of the required capacity were purchased and after reading the documentation, the process of adding and replacing hard disks into the system was clarified. For this, it is not enough to have access to the client interface, access to the system management console is necessary - according to the documentation, you need to log in via SSH to the server as <b>admin</b> and installed for him a password. <br><br>  This can be done with the <i>ssh -l admin 192.168.0.5 command</i> and enter the password. You can also login to the console locally. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/59f/5a0/e7b/59f5a0e7beabdae4339aeaf08ab6b42d.jpg" alt="image"><br><br>  According to the documentation, the procedure for adding is as simple as three rubles - we turn off the server, connect a clean, unformatted hard disk, turn on the server and log in to the system. <br>  Next, we type 27 to check on whether the hard disk has been determined or not, then we dial 23 and wait until the end of the file system creation process, the creation of a mount point, etc. <br>  After restarting the server and launching the system, the new hard disk is visible in the system and is ready to write an archive to it. <br>  And in case one of the hard drives fails and needs to be replaced, we follow a different procedure: turn off the server, change the failed hard drive to a working one, turn on the server and log in to the console. We first look at the status of the hard drives, and then type 24 - <b>Configure replaced disk</b> and wait for the end of the procedure. <br><br>  <b>Important: The</b> new hard disk must be unformatted, and it must be connected to the same place as the defective hard disk. <br><br><h5>  We are looking for a problem - and we find it. </h5><br>  Once it was necessary to add two hard disks and remove one small capacity. And since the server was already in near operational use, I wanted to combine the two procedures - adding a hard disk and replacing one hard disk with another. <br>  After booting the system and logging in to the console, I decided to start with the procedure of adding a hard disk instead of replacing one hard disk with another. The system added two new hard disks to the system, and there was nothing to change the hard disk. <br>  The result of such hasty actions was the error displayed in the client's interface next to the processor load ‚Äî Degraded recording, and the erroneous value of the space available to the system just as much as there were gigabytes on the replaced hard disk.  At the same time, in the console this hard disk was displayed as unused - point 25 - Show unusable disks. <br>  No actions in the management console, rollback to the previous configuration and attempts to restore the system from the installation disk to success did not lead.  Documentation on this account advised to rearrange the system from scratch or contact the dealer. <br><br><h5>  Solution to the problem </h5><br>  It was decided to create a similar problem on a virtual machine.  It is easily managed. <br>  It was impossible to enter the console under the root - the password is not known.  Boot from the live-cd Xubuntu on this virtual machine and start exploring the insides of the system. <br><br>  The system found the following interesting sections: <br>  - / - proper root partition. <br>  - / netavis - the section where the Netavis system is actually located <br>  - / var / lib / mysql - the partition where the database directory is located. <br>  There are also sections Images1, Images3, Images4 which are mounted in / Images <br><br>  First we look at the / etc / shadow file for a list of users and their passwords. <br><br>  We are interested in the following users: <br>  root: $ 1 $ UEe5kAv4 $ nWyqBmcmg3P.kM / ZB / s / 2.: 16086: 0: 99999: 7 ::: <br>  arms: $ 1 $ gKURq9W3 $ oYJWwNw9hKtJBmoVpkFju /: 16086: 0: 99999: 7 ::: <br>  admin: $ 1 $ 0.3jcW1k $ i6QabIE2yN0hCcTmrQ7j80: 16086: 0: 99999: 7 ::: <br>  netavis: $ 1 $ SQ4LOu8J $ Gp6PEphFVKucMyQbkm55f1: 16086: 0: 99999: 7 ::: <br>  chpass: $ 1 $ CWDhlmfR $ b / IoN0Inx / A6eT04hivM / .: 16086: 0: 99999: 7 ::: <br><br>  It can be seen that the root password is there, but it does not coincide with the password that we set for the <b>admin</b> . <br>  The only way out is to change the <b>root</b> password to the admin password known to us. Therefore, we erase the root password hash and change the <b>admin</b> password to the hash, then save the file, unmount all file systems and reboot into Netavis. <br>  Next, log in as root with the admin password we know and start looking around from the live system with root privileges. <br><div class="spoiler">  <b class="spoiler_title">We look, what hard drives are connected:</b> <div class="spoiler_text">  [root @ videosystem ~] # fdisk -l <br>  / dev / sda1 * 1 13 104391 83 Linux <br>  / dev / sda2 14,664 5229157+ 83 Linux <br>  / dev / sda3 665 1315 5229157+ 83 Linux <br>  / dev / sda4 1316 2635 10602900 5 Extended <br>  / dev / sda5 1316 1966 5229126 83 Linux <br>  / dev / sda6 1967 2097 1052226 82 Linux swap / Solaris <br>  / dev / sda7 2098 2635 4321453+ 83 Linux <br>  / dev / sdb1 1 1045 8388607+ ee EFI GPT <br>  / dev / sdc1 1 1045 8388607+ ee EFI GPT <br></div></div><br>  3 hard disks are connected - system (dev / sda) and two archive disks (dev / sdb dev / sdc) and they are mounted accordingly: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  [root @ videosystem ~] # mount <br>  / dev / sda7 on / Images / Images1 type xfs (rw, noatime, nodiratime, logbufs = 8, logbsize = 256k, allocsize = 256k) <br>  / dev / sdb1 on / Images / Images3 type xfs (rw, noatime, nodiratime, logbufs = 8, logbsize = 256k, allocsize = 256k) <br>  / dev / sdc1 on / Images / Images4 type xfs (rw, noatime, nodiratime, logbufs = 8, logbsize = 256k, allocsize = 256k) <br></div></div><br><div class="spoiler">  <b class="spoiler_title">But what we have in fstab:</b> <div class="spoiler_text">  LABEL = Images1 / Images / Images1 xfs noauto 1 0 <br>  LABEL = Images2 / Images / Images2 xfs noauto 1 0 <br>  LABEL = Images3 / Images / Images3 xfs noauto 1 0 <br>  LABEL = Images4 / Images / Images4 xfs noauto 1 0 <br></div></div><br>  That is, there is a record of a replaced hard disk, which is actually not in the server.  Remove the mount point Images2 from fstab, save and reboot. <br>  After loading, launch the client and go to the System administration - System information section and see that the error has not disappeared, so information about the used disks is stored somewhere ... and this is probably Mysql. <br><br><h5>  We understand with Mysql. </h5><br>  So you need to connect to the database server, and for this you need to know the logins and passwords for access.  To do this, go to <i>/ var / lib / mysql</i> and see which databases are available. <br><br>  Here is the list of databases: <br>  - arms <br>  - mysql <br>  - test <br><br>  The mysql database is systemic; you can see a list of server users and password hashes in it.  So - the final path to the file with the information we are interested in is <i>/va/lib/mysql/mysql/user.MYD</i> - open the file in your favorite editor and see that there are not so many users - <b>root</b> and <b>arms</b> and the password hash is the same - <b>2f36c5e96b75ee48</b> , besides the old type, which is confirmed by viewing the config of the Mysql server, which is located along the path <i>/etc/my.cnf</i> : <br>  ... <br>  old_passwords = 1 <br>  ... <br>  Things are easy - either guess the password or brute force, which could take some time.  I started by trying to guess the password, substituting known passwords, empty passwords, passwords that match the logins ... good luck smiled almost immediately. <br>  For both logins ( <b>root</b> and <b>arms</b> ) password - <b>arms</b> <br><br>  Next, we will configure an SSH tunnel between the Netavis server and the computer on which we will launch one of the graphical tools for administering the Mysql database, for example, <a href="http://www.mysql.com/products/workbench/">MySQL Workbench</a> or <a href="http://www.fastflo.de/projects/emma">Emma</a> or any other that you usually use. <br><br>  So, create a tunnel: <br>  - On Linux - <i>using the ssh -L 3306</i> command <i>: localhost: 3306 root@192.168.0.5</i> , enter the password that we copied from the <b>admin</b> user. <br>  - Universal option - using Putty: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/18e/8b3/72f/18e8b372f20a17005b5a5ca78d7018d9.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0de/37a/1bc/0de37a1bc3da932f8c341294f1de2fde.png" alt="image"><br><br>  Next, we run Emma, ‚Äã‚Äãfor example, tune in to the connection with localhost: 3306 and the <b>arms</b> / <b>arms</b> username / password and go straight to the base with which Netavis - <b>arms</b> works. <br>  Using the text search across the entire database for the keyword "Images2" (after all, this section we are trying to remove from the program settings) we get the result in the form of a <i>Directories</i> table, in which the required information is stored: <br><img src="https://habrastorage.org/getpro/habr/post_images/723/d70/379/723d70379bcff5b2094372ca5e1b35d3.png" alt="image"><br><br>  Delete the entry with the information about Images2 and reboot the server. <br>  After loading, start the client and go to the section System administration - System information and see that the error has disappeared! <br>  The archive is written monolithically, the error of Degraded recording from the client interface disappeared, as well as information about the unused hard disk in the management console.  Available file space is displayed correctly. <br><br><div class="spoiler">  <b class="spoiler_title">References:</b> <div class="spoiler_text">  <a href="http://www.netavis.net/">Netavis official website.</a> <br>  <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">Putty</a> <br></div></div><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/209516/">https://habr.com/ru/post/209516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209506/index.html">Fast graphics output in Matlab</a></li>
<li><a href="../209508/index.html">Attempt to drain the client databases of BillManager users</a></li>
<li><a href="../209510/index.html">Monads in Scala</a></li>
<li><a href="../209512/index.html">Kepler equation: reboot</a></li>
<li><a href="../209514/index.html">Porting C # LINQ to PHP</a></li>
<li><a href="../209520/index.html">dSort - put everything on the shelves</a></li>
<li><a href="../209524/index.html">Network programming for game developers. Part 2: receiving and transmitting data packets</a></li>
<li><a href="../209526/index.html">All about namespaces in yii1</a></li>
<li><a href="../209532/index.html">Basics of Scala. 5 hours of brain drain</a></li>
<li><a href="../209534/index.html">Give way to ambitious goals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>