<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determine that the user has Wikipedia blocked.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Roskomnadzor recently attempted to block access to Wikipedia from the territory of the Russian Federation . The attempt failed , and it's time to go t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determine that the user has Wikipedia blocked.</h1><div class="post__text post__text-html js-mediator-article"><br>  Roskomnadzor recently <a href="http://habrahabr.ru/post/265367/">attempted to block access</a> to Wikipedia <a href="http://habrahabr.ru/post/265367/">from the territory of the Russian Federation</a> .  The attempt <a href="http://rublacklist.net/12468/">failed</a> , and it's time to go to the counter.  In the article under the cut, I will show that if user X has visited site A, then site A can determine if another site B is blocked for the user. <img src="https://habrastorage.org/getpro/habr/post_images/41e/bd3/586/41ebd3586997761764ff1cd95a66da56.jpg">  And then, in the <a href="http://habrahabr.ru/post/256339/">emerging tradition</a> , the presentation will go in question-answer form. <br><br><h2>  What is it all for? </h2><br>  When discussing the blocking of Wikipedia, the community noticed two circumstances that are very beneficial to censorship.  First, Wikipedia uses HTTPS and, moreover, HSTS.  This means that an encyclopedia can only be blocked entirely (with an accuracy of the domain), but it cannot be redirected to the notorious page with a message about blocking.  Instead, a connection establishment error message is displayed.  This looks like an internal problem of Wikipedia and alleviates the user's dissatisfaction with the actions of Roskomnadzor;  At the same time, feedback is necessary for the development of a legal state.  Secondly, even if users find out about blocking, many of them simply won‚Äôt know what to do.  Hang a permanent die ‚ÄúIf you block Wikipedia, download Tor Browser!‚Äù On non-caring sites at least strange;  At the same time, notifying users about blocking Wikipedia and ways to circumvent it is necessary.  The solution of the problem and trying to give this article. <a name="habracut"></a><br><br><h2>  What is it all about? </h2><br>  This is a fairly universal way to determine the availability of virtually any (previously investigated) site on the client side, using Javascript. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPD:</b> According to the advice of comrades <a href="http://habrahabr.ru/users/bakhirev/" class="user_link">bakhirev</a> and <a href="http://habrahabr.ru/users/xobotyi/" class="user_link">xobotyi, the</a> mechanism of work has been changed.  The most interesting part with entertaining geometry turned out to be unnecessary, the definition was rewritten on events. <h2>  I want a demo! </h2><br>  <a href="https://nickkolok.github.io/chas-antidot/demo.html">You are welcome!</a> <br><div class="spoiler">  <b class="spoiler_title">The same entertaining geometry is to print when prohibiting cross-domain events for images.</b> <div class="spoiler_text"><br><h2>  How it works? </h2><br>  An invisible block of HTML code is created, containing two images: one control - from a knowingly non-existent URL, the second signal - any image from the checked site.  If their sizes coincide after some time, it means that the image from the checked site has not loaded, that is, it either ‚Äúlies‚Äù so much that it cannot give even static, or is blocked. <br><br><h2>  And more? </h2><br>  An image in HTML, inserted by the img tag, is by default defined by the image file itself.  The image that failed to load, also has some dimensions - in different browsers are different.  Here they are (width x height): <ul><li>  Firefox 37.0 - 24x24 </li><li>  Chrome 44.0.2403.155 - 0x0 (before loading), 20x20 (with unsuccessful loading) </li><li>  Opera 12.16 - 114x22 </li></ul>  You can get the size of an item in Javascript using the properties of the .offsetWidth and .offsetHeight element <br><br><h2>  And if suddenly the signal image in size coincides with what the browser displays on error? </h2><br>  This is rather unlikely, given that both width and height are compared.  You can request two images of obviously different sizes and compare their sizes.  If they match, the download failed.  And yet it is better not to pull favicons as the only images. <br></div></div><br><h2>  And the source? </h2><br>  <a href="https://github.com/nickkolok/chas-antidot">On the githaba</a> under GPLv3. <br><br><h2>  And how to use it all? </h2><br>  I tried to make the code readable, although, of course, this does not free me from giving an example. <pre><code class="hljs lua">chasAntidot.testSiteWithImg({ url: <span class="hljs-string"><span class="hljs-string">'https://ru.wikipedia.org/static/images/project-logos/ruwiki.png'</span></span>, //URL - ifBlocked: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{message(<span class="hljs-string"><span class="hljs-string">''</span></span>);}, //callback,   ifNotBlocked: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{message(<span class="hljs-string"><span class="hljs-string">' '</span></span>);}, //callback,    <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">3500</span></span>, //    ,   <span class="hljs-number"><span class="hljs-number">4000</span></span> secondImage: <span class="hljs-string"><span class="hljs-string">'https://ru.wikipedia.org/favicon.ico'</span></span>, //URL   -  });</code> </pre>  No additional jQuery type libraries are required, all on pure JS. <br><br><h2>  Well, I am ready to inform my users about the possible blocking of Wikipedia!  Can I get the code ready? </h2><br>  First, in any case, the library itself is better to download to your site.  github.io is not insured against blocking.  Secondly, for pure JS such an option is possible, for example: <pre> <code class="hljs xml">chasAntidot.createBanner( ', <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://ru.wikipedia.org"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> . <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://rublacklist.net"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span><span class="hljs-tag">&gt;</span></span>,   !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>', { url: 'https://ru.wikipedia.org/static/images/project-logos/ruwiki.png', secondImage: 'https://ru.wikipedia.org/favicon.ico', } );</code> </pre>  This, of course, works, but not very nice :) Patches that add features to create banners using various libraries are welcome! <br><br><h2>  And if Wikipedia really falls? </h2><br>  In this case, you can use a similar mechanism by comparing the availability of images directly and through some anonymizer.  In this case, the resource can be considered blocked if and only if the image is visible through the anonymizer, and not directly.  True, the anonymizer can also be blocked, and then you have to check its availability too - for example, by requesting a picture from the RKN site itself. <br><br><h2>  Where else is there any sense of this in the national economy? </h2><br><ul><li>  The mobile version of Wikipedia will be able to warn users about the blocking of the desktop (they are at different addresses and on different domains), and vice versa. </li><li>  By installing a script with a similar principle of operation on the page, the webmaster will be able to change links to a finite number of blocked resources for links through a proxy on the fly.  There is no ready decision, but patches are accepted. </li><li>  You can accurately identify users who have blocked (it does not matter, the licensor or employer) favorite site (VKontakte, etc.) and offer them to buy a VPN / proxy or use a free proxy with advertising. </li><li>  <s>You can</s> <a href="http://habrahabr.ru/post/266553/"><b>not</b></a> determine on the client the fact of using TOR / I2P, thus requesting a picture from the domain .onion / .i2p </li><li>  Want to know if your IPv6 user is active?  Just upload a picture to some IPv6 address.  Or use the pictures on the servers of someone large (like Google), supporting the new protocol. </li><li>  And in some cases, you can determine the DNS, which is used by the client.  For example, OpenNIC and other NameCoin / .bit </li><li>  In web interfaces of routers there are also pictures!  This means that the model of the router, if desired, can also be determined, even if the web interface is not accessible from the outside. </li><li>  Finally, you can check the belonging to a particular network.  For example, some providers have entire subdomains with sites that are accessible only to their subscribers.  Is there not a single picture there?  You can check and belonging to corporate networks - if, of course, know what resources are available only from the inside.  Maybe you want to show something special to users who access the network via WiFi from the Moscow metro?  From the widespread cafe network?  Then you should look for pictures on the corresponding authorization page that are accessible only from the inside!  Although it must be admitted that the definition of IP is sometimes more justified. </li><li>  <b>It is impossible</b> to check the presence of any extension that has separate image files using the chrome extension URLs.  I always get a "broken" picture. </li><li>  In some older browsers (IE6?), Which do not block access to local images, you can probably determine the versions of applications installed by the user (Libre Office, GIMP, MS Office, Adobe Photoshop, etc.) with fairly good accuracy - it‚Äôs enough to know What pictures of what size are typical for each version?  Of course, this will work only if the program is installed in the default directory, but, for example, such a technique will allow you to display on the site instructions for installing the program, which is not available to the user, but is necessary for working with the site.  <b>In modern browsers, most likely, does not work.</b> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/266553/">https://habr.com/ru/post/266553/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266541/index.html">As one of the operators increased the capacity of 3G in a densely populated district of Minsk, not forgetting about the coming on the heels of LTE</a></li>
<li><a href="../266545/index.html">Installation programs - how much do they influence the product or company image?</a></li>
<li><a href="../266547/index.html">JetBrains IDE is now only available for rent.</a></li>
<li><a href="../266549/index.html">Healthcare IT: or how to throw out $ 34 million</a></li>
<li><a href="../266551/index.html">Recognize cannot be left a picture, or something about difficult cases of optical character recognition</a></li>
<li><a href="../266557/index.html">Sorting integers when memory is low</a></li>
<li><a href="../266559/index.html">Smart and Stupid React Components</a></li>
<li><a href="../266561/index.html">We develop a monitoring system for 55,000 RTP video streams</a></li>
<li><a href="../266563/index.html">Profit about the printer</a></li>
<li><a href="../266565/index.html">GPS service ViaLatM - scripting language (part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>