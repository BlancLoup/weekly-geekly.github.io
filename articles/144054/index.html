<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data Structures Used in Redis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: 
 I want to bring to your attention a translation of the answer of one of the Redis developers, to the question of what data stru...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Data Structures Used in Redis</h1><div class="post__text post__text-html js-mediator-article">  <em>From the translator:</em> <em><br></em>  <em>I want to bring to your attention a translation of the answer of one of the Redis developers, to the question of what data structures are used inside Redis.</em>  <em>The original discussion can be found on <a href="http://stackoverflow.com/questions/9625246/what-are-the-underlying-data-structures-used-for-redis">stackoverflow</a> .</em> <br><br>  I will try to answer the question, but to begin with, it may seem strange at first glance: if you are not interested in Redis internals, you <strong>do not have to worry</strong> about how data structures are implemented from the inside.  The reason for this is simple - the complexity of each Redis command can be found in the documentation, and if you have a set of operations and their computational complexity, then the only thing you need is some idea of ‚Äã‚Äãmemory usage (and because we do a lot of optimizations, depending on the data, the best way to get these last numbers is tests in real conditions) <br><br>  But as you asked, here are the internal implementations of each Redis data structure: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <strong>Strings are</strong> implemented using the C dynamic strings library, so we do not pay (speaking asymptotically) for memory allocation in add operations.  Thus, we get the complexity of adding O (N), instead of, for example, quadratic. </li><li>  <strong>Lists are</strong> implemented as linked lists. </li><li>  <strong>Sets</strong> and <strong>hashes are</strong> implemented as hash tables. </li><li>  <strong>Ordered sets are</strong> implemented as pass lists (special type of balanced trees) </li></ul><a name="habracut"></a><br>  But when lists, sets, and ordered sets are small, in terms of the number of elements and the size of the largest values, a different, more compact representation is used.  This representation is different for different structures, but it has the following feature: it is a compact BLOB, often having O (N) complexity for each operation.  Since we only use this format for small objects, this is not a problem;  Passing through a small O (N) BLOB's <em>cache-independent (cache-oblivious algorithm, comment of the translator)</em> , practically speaking, it is very fast, and as soon as there are a lot of elements, the view automatically switches to the native (linked list, hash, and etc.). <br><br>  But your question is, in fact, not only about the internals, you wanted to ask: ‚Äú <em>What structure to use for this or that?</em>  ". <br><br><h3>  Strings </h3><br>  Strings are the basic structure.  This is one of the four basic structures, as well as the basis of all complex structures, because the List is a list of strings, the Set is a plurality of lines, and so on. <br><br>  Strings are good in all obvious usage scenarios, when you want to store an HTML page, but they are also good if you want to avoid converting already encoded data.  For example, if you have JSON or MessagePack, you can simply store objects as strings.  In Redis 2.6, you can even manage this kind of server-side structures using Lua scripts. <br><br>  Another interesting use of strings is bitmaps, and in general, random access to byte arrays, since Redis provides commands for accessing arbitrary byte ranges, or even individual bits.  As an example, take a look at <a href="http://blog.getspool.com/2011/11/29/fast-easy-realtime-metrics-using-redis-bitmaps/">this nice post: Fast Easy real time metrics using Redis</a> . <br><br><h3>  Lists </h3><br>  Lists are good when you mainly work with extreme elements: near the tail, or near the head.  Lists are not the best choice for dividing something into pages, due to slow random access, O (N).  Good use of lists will be simple queues and stacks, or looping through items with the RPOPLPUSH command, whose parameters will be the same list. <br><br>  Lists are just as good when we need a limited collection of N elements, access to which is <em>usually</em> carried out only to the upper or lower elements, or when N is small. <br><br><h3>  Sets </h3><br>  A set is not an ordered set of data, it is effective when you have a collection of items, and it is important to very quickly check the presence of an item in the collection, or get its size.  Another ‚Äútrick‚Äù of the sets is the ability to get a random element (the SRANDMEMBER and SPOP commands). <br><br>  Sets represent a relationship well, for example, ‚ÄúWhat are the friends of user X?‚Äù And the like.  But, as we will see later, there are other suitable structures for such things, ordered sets. <br><br>  The sets support complex operations such as intersection, union, and so on; this is a good way to use Redis in a ‚Äúcomputational‚Äù manner, when you have data, and you want to get some results by performing transformations on this data. <br><br>  Small sets are encoded in a very efficient way. <br><br><h3>  Hashes </h3><br>  Hashes have a great structure for representing objects made up of fields and values.  Hash fields can be atomically incremented by the HINCRBY command.  If you have objects, such as users, blog posts, or other types of <em>elements</em> , hashes are what you need if you do not want to use your own format, such as JSON or any other. <br><br>  However, keep in mind that small hashes in Redis are encoded very efficiently, and you can use atomic GET, SET operations or atomically increment a particular field at high speed. <br><br>  Hashes can also be used to represent related data structures using links.  For an example, take a look at the implementation of comments in lamernews.com <br><br><h3>  Ordered Sets </h3><br>  An ordered Set is the <em>only data structure other than a list that supports working with ordered items</em> .  With ordered sets you can do a lot of cool things.  For example, you can implement all kinds of <strong>Top Anything</strong> in your web application.  Top users by rating, top posts by number of views, top anything, and one copy of Redis will serve tons of inserts and queries per second. <br><br>  Ordered sets, like ordinary sets, can be used to describe relationships, but they also allow you to divide elements into pages, and maintain order.  For example, if I keep friends of user X as an ordered set, I can easily store them in the order of adding to friends. <br><br>  Ordered sets are good for priority queues. <br><br>  Ordered sets are something like more powerful lists, in which inserting, deleting or getting items from the middle of the list is just as fast.  But they use more memory, and are O (log (N)) structures. <br><br><h3>  Conclusion </h3><br>  I hope I have provided some information in this post, but it will be much better to download the <a href="http://github.com/antirez/lamernews">source code of lamernews</a> and understand how it works.  Most Redis data structures are used in Lamer News, and their use can serve as a clue what to use to solve this problem. </div><p>Source: <a href="https://habr.com/ru/post/144054/">https://habr.com/ru/post/144054/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144049/index.html">10 popular games and applications in April 2012 for Ubuntu (repository UALinux)</a></li>
<li><a href="../144050/index.html">Performance Comparison for 802.11ac Draft and 802.11n</a></li>
<li><a href="../144051/index.html">Our development process: 50 months of evolution</a></li>
<li><a href="../144052/index.html">Multiload files, version N</a></li>
<li><a href="../144053/index.html">Microsoft and Nokia started the attraction of unprecedented generosity</a></li>
<li><a href="../144055/index.html">OpenStack Swift. Not all three copies are equally useful.</a></li>
<li><a href="../144057/index.html">Mozilla Firefox Metro Design Concept for Windows 8</a></li>
<li><a href="../144058/index.html">Copyright to the / bin / true command</a></li>
<li><a href="../144059/index.html">BGP: some features of traffic behavior</a></li>
<li><a href="../144060/index.html">The Pirate Bay is actively DDoS`yat. UPD Former Anonymous</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>