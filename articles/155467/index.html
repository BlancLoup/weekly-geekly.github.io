<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to CMake</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CMake is a cross-platform utility for automatically building a program from source code. At the same time, CMake itself does not directly build, but i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to CMake</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/629/110/019/6291100193702d4032d7e69ecc4f04f4.png" alt="image" align="left">  CMake is a cross-platform utility for automatically building a program from source code.  At the same time, CMake itself does not directly build, but is a front-end.  Different versions of make and Ninja can be used as a back-end.  CMake also allows you to create projects for CodeBlocks, Eclipse, KDevelop3, MS VC ++ and Xcode.  It should be noted that most of the projects are not native, but with the same back-end. <br><a name="habracut"></a><br>  In order to build a project using CMake, you need to place the CMakeLists.txt file in the root of the source tree, which stores the rules and goals of the assembly, and perform several simple steps. <br>  Let's look at examples. <br><br><h4>  Example 1. Hello, World: </h4><br>  To begin with, let's write the simplest heloworld and create a project structure: <br><blockquote><div class="spoiler">  <b class="spoiler_title">main.cpp</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; int main(int argc, char** argv) { std::cout &lt;&lt; "Hello, World!" &lt;&lt; std::endl; return 0; }</span></span></span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">CMakeLists.txt</b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">2.8</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   CMake. #     #  ,   . add_executable(main main.cpp) #      main #   main.cpp</span></span></code> </pre><br></div></div><br></blockquote><br>  The CMake syntax is similar to the bash syntax, everything after the "#" character is a comment and will not be processed by the program.  CMake allows you not to litter the source tree with temporary files - it is very simple and without extra gestures, the assembly is done ‚ÄúOut-of-Source‚Äù. <br><br>  Create an empty directory for temporary files and go there. <br><blockquote>  fshp @ panica-desktop: ~ $ mkdir tmp <br>  fshp @ panica-desktop: ~ $ cd tmp / <br>  fshp @ panica-desktop: ~ / tmp $ <br></blockquote><br>  Now run the cmake command, passing the path to the source folder as a parameter to it: <br><blockquote>  fshp @ panica-desktop: ~ / tmp $ cmake ~ / cmake / example_1 / <br>  ... <br>  - Build files have been written to: / home / fshp / tmp <br>  fshp @ panica-desktop: ~ / tmp $ <br>  fshp @ panica-desktop: ~ / tmp $ ls <br>  CMakeCache.txt CMakeFiles cmake_install.cmake Makefile <br>  fshp @ panica-desktop: ~ / tmp $ <br></blockquote><br>  We see that in the folder there are several temporary files needed to build the project. <br>  Now you can run make directly: <br><blockquote>  fshp @ panica-desktop: ~ / tmp $ make <br>  Scanning dependencies of target main <br>  [100%] Building CXX object CMakeFiles / main.dir / main.cpp.o <br>  Linking CXX executable main <br>  [100%] Built target main <br>  fshp @ panica-desktop: ~ / tmp $ ./main <br>  Hello, World! <br>  fshp @ panica-desktop: ~ / tmp $ <br></blockquote><br>  So, our program has gathered. <br>  The tmp folder can be cleaned \ deleted without the risk of breaking the source.  If CMakeLists.txt has been changed, the make call will automatically start cmake.  If the source has been moved, then you need to clear the temporary directory and run cmake manually. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Example 2. Libraries: </h4><br>  If your project contains a library, then CMake will build it without problems. <br>  To do this, let's complicate an example. <br><blockquote><div class="spoiler">  <b class="spoiler_title">foo.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello_world</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">foo.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; void hello_world() { std::cout &lt;&lt; "Hello, World!" &lt;&lt; std::endl; }</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">main.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"foo.h"</span></span></span><span class="hljs-meta"> int main(int argc, char** argv) { hello_world(); return 0; }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">CMakeLists.txt</b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">2.8</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   CMake. #     #  ,   . project(hello_world) #   set(SOURCE_EXE main.cpp) #         set(SOURCE_LIB foo.cpp) #  ,    add_library(foo STATIC ${SOURCE_LIB}) #      foo add_executable(main ${SOURCE_EXE}) #      main target_link_libraries(main foo) #    </span></span></code> </pre><br></div></div><br></blockquote><br>  Variables can store lists of values ‚Äã‚Äãseparated by spaces \ tabs \ hyphens: <br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(SOURCE main.cpp foo.cpp) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(HEADER main.h foo.h)</code> </pre><br>  Both options are correct. <br>  To get the value of a variable, we use the construct: <br><pre> <code class="cmake hljs"><span class="hljs-variable"><span class="hljs-variable">${var_name}</span></span></code> </pre><br>  So, this version of our project includes one static library collected from source codes.  If we replace ‚ÄúSTATIC‚Äù with ‚ÄúSHARED‚Äù, then we will get a dynamic library.  If the library type is not specified, by default it will be collected as static. <br>  When linking all necessary libraries are indicated: <br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">target_link_libraries</span></span>(main foo ogg vorbis)</code> </pre><br>  As with manual compilation, library names are specified without the standard ‚Äúlib‚Äù prefix. <br>  So, building libraries with CMake does not cause problems, and the type of library static / dynamic changes only with one parameter. <br><br><h4>  Example 3. Subprojects: </h4><br>  Subprojects are very convenient if your program is divided into several libraries or a project consists of several programs. <br>  Each subproject is essentially a complete project and can be used independently. <br>  Now we have ‚Äúfoo‚Äù in the subdirectory and CMakeLists.txt of the subproject is also there. <br><blockquote><div class="spoiler">  <b class="spoiler_title">CMakeLists.txt</b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">2.8</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   CMake. #     #  ,   . project(hello_world) #   set(SOURCE_EXE main.cpp) #      include_directories(foo) #    add_executable(main ${SOURCE_EXE}) #      main add_subdirectory(foo) #  ,    target_link_libraries(main foo) #    </span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">main.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"foo.h"</span></span></span><span class="hljs-meta"> int main(int argc, char** argv) { hello_world(); return 0; }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">foo / CMakeLists.txt</b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">2.8</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   CMake. #     #  ,   . project(foo) #   set(SOURCE_LIB foo.cpp) #      add_library(foo STATIC ${SOURCE_LIB})#   </span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">foo / foo.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello_world</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">foo / foo.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; void hello_world() { std::cout &lt;&lt; "Hello, World!" &lt;&lt; std::endl; }</span></span></span></span></code> </pre><br></div></div><br></blockquote><br>  There is nothing new for you in the subproject file.  But in the main file new commands: <br><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">include_directories</span></span>(foo)</code> </pre>  we did not change main.cpp, but foo.h was moved.  The command tells the compiler where to look for header files.  May be called several times.  Headers will be searched in all specified directories. <br><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_subdirectory</span></span>(foo)</code> </pre>  Specify the directory with the subproject, which will be assembled as an independent. <br>  Conclusion: CMake projects can be combined into fairly complex hierarchical structures, with each subproject in reality being an independent project, which in turn can consist of subprojects itself.  This makes it easy to split your program into the required number of individual modules.  An example of this approach is KDE. <br><br><h4>  Example 4. Library search: </h4><br>  CMake has quite advanced search facilities for installed libraries, although they are not built-in, but implemented as separate modules.  In the standard package there are quite a few modules, but some projects (for example, Ogre) supply their own.  They allow the system to automatically determine the presence of libraries required for linking a project. <br>  On debian, the modules are located in /usr/share/cmake-2.8/Modules/ (your version may differ).  The search for libraries is answered by modules called FindNAME.cmake, where NAME is the name of the library. <br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">find_package</span></span>(SDL REQUIRED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> SDL_FOUND) <span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(SEND_ERROR <span class="hljs-string"><span class="hljs-string">"Failed to find SDL"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">include_directories</span></span>(<span class="hljs-variable"><span class="hljs-variable">${SDL_INCLUDE_DIR}</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>() <span class="hljs-comment"><span class="hljs-comment">########################################################## find_package(LibXml2 REQUIRED) if(NOT LIBXML2_FOUND) message(SEND_ERROR "Failed to find LibXml2") return() else() include_directories(${LIBXML2_INCLUDE_DIR}) endif() ########################################################## find_package(Boost COMPONENTS thread-mt REQUIRED) if(NOT Boost_FOUND) message(SEND_ERROR "Failed to find boost::thread-mt.") return() else() include_directories(${Boost_INCLUDE_DIRS}) endif() ########################################################## target_link_libraries(${TARGET} ${SDL_LIBRARY} ${LIBXML2_LIBRARIES} ${Boost_LIBRARIES})</span></span></code> </pre><br>  I think the meaning should be clear.  The first and second block is a library search.  If it is not in the system, an error message is displayed and cmake completes.  The third block is similar, only it is not looking for a whole library package, but only a necessary component.  Each such automated search determines after performing at least 3 variables: <br>  SDL_FOUND, LIBXML2_FOUND, Boost_FOUND - a sign of the presence of the library; <br>  SDL_LIBRARY, LIBXML2_LIBRARIES, Boost_LIBRARIES - names of libraries for linking; <br>  SDL_INCLUDE_DIR, LIBXML2_INCLUDE_DIR, Boost_INCLUDE_DIRS - paths to header files. <br>  If the first is more or less clear, then the second and third brought me a lot of trouble - half have names in the singular, half - in the plural.  But it turned out, it is easy to track.  In each module, there are comments at the beginning, the defined variables are described there.  See, for example, /usr/share/cmake-2.8/Modules/FindLibXml2.cmake <br>  As you can see, CMake is able to determine the presence and location of the necessary libraries and header files.  In principle, this should be able to any automatic assembly system, otherwise the meaning of it? <br><br><h4>  Example 5. External libraries and object files: </h4><br>  If you write for ‚Äúuncle‚Äù, and the evil ‚Äúuncle‚Äù loves samopisnye libraries and does not want to share the source code, so sends the finished library, then you are at the address. <br>  The object files in CMake are along with the source code - it is enough to include the object file in the list of files to compile. <br>  With libraries tighter.  As you know, a static library is nothing more than an ar-archive, inside of which there are ordinary object workers who are not related to each other.  You probably already guessed how I acted first.  Yes, just gutting the library.  But then a more elegant way was found: <br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_library</span></span>(netutil STATIC IMPORTED) <span class="hljs-keyword"><span class="hljs-keyword">set_property</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span> netutil PROPERTY IMPORTED_LOCATION Binary/game_client/libnetutil.a)</code> </pre><br>  The word "IMPORTED" indicates that the library is being taken from the outside. <br>  In CMake, each target has parameters, and set_property allows you to change them. <br>  This library is standardly linked: <br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">target_link_libraries</span></span>(<span class="hljs-variable"><span class="hljs-variable">${TARGET}</span></span> netutil)</code> </pre><br>  For dynamic libraries, everything is the same, only the ‚ÄúSHARED‚Äù type, the extension is ‚Äú.so‚Äù. <br>  Unfortunately, support for non-system libraries is a bit of a crutch.  Maybe I just don‚Äôt know the right option, so I‚Äôll be happy if you ‚Äúpoke a muzzle.‚Äù  On the other hand, this is not a heaped up exoskeleton with a life support system, but a simple two-line crutch. <br><br><h4>  Generators: </h4><br>  As stated at the beginning, CMake can generate many different types of projects.  This is convenient and allows you to use CMake for almost any popular IDE. <br>  If you run cmake without parameters, the available generators will be described at the end.  Use this: <br><blockquote>  fshp @ panica-desktop: ~ / tmp $ cmake ~ / cmake / example_3 / -G "KDevelop3 - Unix Makefiles" <br></blockquote><br><h4>  Conclusion: </h4><br>  This is not a translation of the manual, but the result of using CMake in a single commercial project.  I would be glad if the article will help at least one person - in Russian there is not enough such documentation. <br><br>  What I personally liked CMake with: <br><ul><li>  one project - one file.  No need to store a bunch of customization scripts, builds and other junk; </li><li>  Work speed in comparison with autotools; </li><li>  simple and understandable syntax, of course, with the elegance of python, do not contend, but also not Brainfack, after all .; </li><li>  is a front-end for a variety of IDEs; </li><li>  displaying progress is quite convenient; </li><li>  color output - in everyday life a little paint will not hurt; </li></ul><br>  For Sublime Text there is a plugin that adds CMake syntax highlighting, it is called ‚ÄúCMake‚Äù. <br>  <a href="https://github.com/fshp/cmake-examples">Examples</a> </div><p>Source: <a href="https://habr.com/ru/post/155467/">https://habr.com/ru/post/155467/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../155449/index.html">Curiosity sent the first soil sample for internal research</a></li>
<li><a href="../155451/index.html">A scientific journal in mathematics accepted an article from the text generator Mathgen</a></li>
<li><a href="../155459/index.html">A look from Google on site optimization</a></li>
<li><a href="../155461/index.html">There's More Than One Way To Do It</a></li>
<li><a href="../155465/index.html">Easy way to create Unity Lens for Ubuntu (translation)</a></li>
<li><a href="../155469/index.html">9 core issues in a developer‚Äôs career</a></li>
<li><a href="../155471/index.html">Holographic properties of bit-reversible permutation</a></li>
<li><a href="../155473/index.html">About unmanned vehicles or why I do not want to live in a "smart house"</a></li>
<li><a href="../155475/index.html">New tricks SMS scam</a></li>
<li><a href="../155479/index.html">Jot Touch Stylus for iPad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>