<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Administration for the smallest (Part 1: restore order)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every time I am surprised when familiar admins who are absolutely no problem working in linux are lost and do not know what to do when faced with the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Administration for the smallest (Part 1: restore order)</h1><div class="post__text post__text-html js-mediator-article">  Every time I am surprised when familiar admins who are absolutely no problem working in linux are lost and do not know what to do when faced with the administration of the AD domain. <br>  For most experienced administrators, this article is unlikely to be useful, but ... <br><br>  So, you got a job.  The conditions are good, the salary is big, the secretaries are smiling, the guards are friendly, and the coffee is free, but the previous sysadmin was a third-year student at the technical college of agriculture and left 50 computers with names like ‚ÄúNOVENKIY‚Äù, ‚ÄúSPORTSMEN‚Äù, ‚ÄúUVALEN‚Äù, ‚Äú23FG34‚Äù ".  Well, it is also worth noting that half of the computers in AD are dead.  And those who are named after the employees are named after those who have not been working in the company for a long time. <br><br>  Among other things, this type of hand has done a bunch of nasty things "for security."  And you absolutely do not understand how and where to start.  And it is best to start with restoring order. <br><a name="habracut"></a><br><h4>  Deletion </h4><br>  For starters, the best way is to download the <a href="http://www.joeware.net/freetools/tools/oldcmp/">OldCmp</a> utility - using it we will sift out computers that have not been registered in the system for more than 30 days. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>oldcmp -disable -unsafe -forreal -llts-sage 30</i> <br><br>  With this team we disable those machines that nobody logged in for 30 days.  For domains under windows 2003, you can use a command that processes not logins, but changing the password of a computer within a domain (not a user, but specifically a computer) <br><br>  <i>oldcmp -disable -unsafe -forreal -age 50</i> <br><br>  If within two or three weeks (you need to leave this time on ‚Äúvacationers‚Äù) nobody has addressed you - you can delete disabled computers: <br><br>  <i>oldcmp -delete -age 0 -onlydisabled -forreal</i> <br><br>  So, we have only those computers that have been used in the last 30 days. <br>  How to be with renaming? <br><br><h4>  Theoretical part </h4><br>  Here, too, everything is simple.  First we need to download utilities from Microsoft: <a href="http://technet.microsoft.com/en-us/sysinternals/bb896649">PsTools</a> , and also <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D15326">Support Tools</a> . <br><br>  Now, in order to correctly rename computers, it is best to use the system of unique identifiers pasted on the computer.  Since we are not familiar with all people in the company - it‚Äôs best to ask HR (or anyone) a list of employees by department - this can help us in distributing computers (and users afterwards) into AD folders. <br><br>  By the way, yes, create the folder Companyname_Computers in the AD tree, and in it - the subfolders with the name - the name of the department.  This small action will save you from many problems in the future. <br><br>  To find out which computer belongs to whom we will use the PsLoggedOn utility.  The syntax is very simple.  We will use it in this form: <br><br>  <i>psloggedon -l \\ computername</i> <br><br>  At the exit we will receive a list of users who are logged on to the computer.  If the utility is not executed, the remote registry editing service is disabled.  We turn it on using the PsService command. <br><br>  <i>psservice \\ computername start remoteregistry</i> <br><br>  After we get the username of the user logged in to the system, we transfer the computer to the appropriate AD folder and in the Description we mark the name of the user who is sitting at this computer. <br><br>  Also, I recommend that all administrators in the new company use the PsPasswd utility to change the password of the local administrator to something you know. <br><br>  <i>pspasswd \\ camputername Administrator Password</i> <br><br>  Now it‚Äôs time to use the <a href="http://support.microsoft.com/kb/298593/ru">NetDom</a> utility <a href="http://support.microsoft.com/kb/298593/ru">.</a> <br><br>  This utility from the Support Tools package we downloaded earlier can do a lot of things.  We will use it to rename the computer. <br>  In general, the team should look like this: <br><br>  <i>netdom renamecomputer computername / newname: newcomputer / userd: domainname \ adminname / passwordd: *</i> <br><br>  This program, unlike PsTools, does not know how to execute from under the current user and the admin name must be specified manually.  In order not to keep the password in clear text - we inserted an asterisk in the passwordd field - the password will be requested. <br><br>  After we renamed the computer - we need to mark a new name on the list with users, opposite the employee's last name, in order to just go through the departments and paste the names of the computers on their buildings (I mean computers, not employees). <br><br><h4>  ... And on the side of a bow </h4><br>  For ease of use, I created a batch file, maybe it will be convenient for you: <br><br> <code>@echo off <br> Set DomainName= <br> Set DomainAdminName= <br> Set LocalAdminName= <br> Set LocalPass= <br> Set PsToolsFolder= <br> Set SupportToolsFolder= <br> Set /P TARGET= Enter computer name: <br> %PsToolsFolder%\psservice \\%TARGET% start remoteregistry <br> %PsToolsFolder%\psloggedon -l \\%TARGET% <br> %PsToolsFolder%\pspasswd \\%TARGET% %LocalAdminName% %LocalPass% <br> echo " " <br> echo " " <br> echo " " <br> Set /P NEWNAME= Set new name of PC: <br> %SupportToolsFolder%\netdom renamecomputer %TARGET% /newname:%NEWNAME% /userd:%domainname%\%domainadminname% /passwordd:* <br> echo " " <br> echo " " <br> echo " " <br> echo " " <br> Set /P Ok= PressAnyKey to exit</code> <br> <br>  Do not forget to fill in the first fields inside the batch file before Set / p TARGET - you don‚Äôt need to fill out anything further. <br>  Well, do not forget about the marks on the list and the transfer of users and computers to the appropriate folders - we will need them for the next steps. <br><br><h4>  Fastening </h4><br>  So, we start the batch file, enter the computer name, and find out who lives in the cottage, then make a mark in the list against the user's name and transfer the computer to the folder we need in the AD tree, then enter the new computer name, your password and joyfully click any button after completion of the procedure. <br><br>  After all computers are renamed, we take our leaf with users and computer names, stickers with computer names and in 20 minutes go around the office by department, glue papers on computer cases. <br><br>  After that, when someone calls you, you just ask to read the name of the computer on its case, after which ... Well, this is the topic of the next article :) </div><p>Source: <a href="https://habr.com/ru/post/129271/">https://habr.com/ru/post/129271/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129260/index.html">Intvideo.tv - invented, embodied, burned, found money, rewrote, share experiences, look for money</a></li>
<li><a href="../129262/index.html">Short list of WYSIWYG editors</a></li>
<li><a href="../129265/index.html">Good news: Akado was forced to pay a fine for spam on the phone</a></li>
<li><a href="../129266/index.html">Ubuntu opens portal for application developers</a></li>
<li><a href="../129269/index.html">Droider Chart. Issue 71 Space</a></li>
<li><a href="../129275/index.html">Blitz overview of Windows 8</a></li>
<li><a href="../129276/index.html">Electric and two cars</a></li>
<li><a href="../129277/index.html">Use of controllers to keep ErlyBank afloat</a></li>
<li><a href="../129279/index.html">The prototype of the national OS will be developed for 5 million rubles and 16 days</a></li>
<li><a href="../129280/index.html">The Big Kinescope Theory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>