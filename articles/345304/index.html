<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúVery handles‚Äù: make Tableau / Qlik from R and ‚Äúblue tape‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is a continuation of previous publications . 


 Naturally, the name is amusing, but, as is well known, in every joke there is some truth. The topi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúVery handles‚Äù: make Tableau / Qlik from R and ‚Äúblue tape‚Äù</h1><div class="post__text post__text-html js-mediator-article"><p>  It is a continuation of <a href="https://habrahabr.ru/users/i_shutov/posts/">previous publications</a> . </p><br><p> Naturally, the name is amusing, but, as is well known, in every joke there is some truth.  The topic itself arose when, for the hundredth time, it was necessary to hear the insistent wish that a ‚Äúflexible report / chart designer‚Äù is needed.  After a certain point, it is easier to take and do than to once again explain that the <code>tidyverse</code> covers all necessary needs. </p><br><habracut></habracut><br><p>  The very formulation of the problem is very simple: to provide a graphical interface for drawing various graphical representations from arbitrary tabular data.  The classic solution consists of two related entities: </p><br><ul><li>  interface with a large number of menus and buttons, with multiple behind-the-scenes <code>IF</code> for managing the mutual states of these elements; </li><li>  ‚ÄúFlexible plotter‚Äù with a large number of nested <code>IF</code> for drawing graphs in accordance with the fed data and the position of the slider buttons set in the UI. </li></ul><br><p>  On the one hand, doing ‚ÄúYet Another Tableau‚Äù is completely uninteresting.  On the other hand, staging in the style of ‚Äúmaking it so that everything is, but nothing needs to be done‚Äù is a typical task for TRIZ. </p><br><p>  In general, after a brief reflection, a solution was developed that almost satisfies the last formulation.  The Shiny application itself is still under the NDA, a freely published prototype is shown in the picture. </p><br><p><img src="https://habrastorage.org/webt/7-/gy/ya/7-gyya1edlqbzgyq3n8qelfccce.png"></p><br><p>  Two key ideas for simplifying the tasks are the following (nothing new, everything has already been thought out before us): </p><br><ol><li>  instead of a statically defined UI, go to the dynamically generated UI; </li><li>  We use the R interpreter not only for the source code, but also inside the code itself. </li></ol><br><h2 id="ideya-1-dinamicheskiy-web-interfeys">  Idea 1. Dynamic web-interface </h2><br><p>  The option when all control elements are statically defined and only their parameterization changes (name, status, lists, selected elements ...) is convenient at the design stage.  Everything is clear, everything is obvious, you can touch it with pens.  But if the admissible states of these elements are very strongly connected both with the initial data for analysis ( <code>data.frame</code> ) and with the state of each other, we find ourselves in a situation of a very large number of non-trivial event handlers for each element.  Lots and lots of confusing code. </p><br><p>  Let's do it differently.  Instead of UI elements with complex behavior, we <code>uiOutput</code> with <code>uiOutput</code> , which we dynamically calculate and generate with the help of the <code>shiny::renderUI</code> representation of this element.  All external parameters required for element generation are treated as reactive elements (reactive).  At the same time, all such interactive elements act as ‚Äúautonomous agents‚Äù who look at the environment and adapt to it.  The user changed the state of one element - all dependent began to recalculate their status in turn (we obviously do not process events, but use the shiny shiny approach).  When their states change, new induced changes may occur.  And so, until everything stabilizes. </p><br><div class="spoiler">  <b class="spoiler_title">As a result, only one handler remains in the code (‚ÄúGo‚Äù button)</b> <div class="spoiler_text"><pre> <code class="hljs lisp"> observeEvent(<span class="hljs-name"><span class="hljs-name">input</span></span>$gen_plot, { #    escname &lt;- function(<span class="hljs-name"><span class="hljs-name">x</span></span>){ #     # ..... } point_code &lt;- <span class="hljs-string"><span class="hljs-string">""</span></span> if(<span class="hljs-name"><span class="hljs-name">input</span></span>$shape_type!=<span class="hljs-string"><span class="hljs-string">"__NO_MAPPING__"</span></span>) { aes &lt;- c(<span class="hljs-string"><span class="hljs-string">"shape"</span></span>=escname(<span class="hljs-name"><span class="hljs-name">input</span></span>$aes_shape_col), <span class="hljs-string"><span class="hljs-string">"color"</span></span>=escname(<span class="hljs-name"><span class="hljs-name">input</span></span>$aes_color_col)) point_code &lt;- buildPointCode(<span class="hljs-name"><span class="hljs-name">fixed=c</span></span>(<span class="hljs-string"><span class="hljs-string">"shape"</span></span>=input$shape_type, <span class="hljs-string"><span class="hljs-string">"color"</span></span>=glue(<span class="hljs-string"><span class="hljs-string">"'{input$plot_color}'"</span></span>)), aes=aes) } line_code &lt;- <span class="hljs-string"><span class="hljs-string">""</span></span> if(<span class="hljs-name"><span class="hljs-name">input</span></span>$line_type!=<span class="hljs-string"><span class="hljs-string">"__NO_MAPPING__"</span></span>) { aes &lt;- c(<span class="hljs-string"><span class="hljs-string">"linetype"</span></span>=escname(<span class="hljs-name"><span class="hljs-name">input</span></span>$aes_linetype_col), <span class="hljs-string"><span class="hljs-string">"color"</span></span>=escname(<span class="hljs-name"><span class="hljs-name">input</span></span>$aes_color_col)) line_code &lt;- buildLineCode(<span class="hljs-name"><span class="hljs-name">fixed=c</span></span>(<span class="hljs-string"><span class="hljs-string">"linetype"</span></span>=input$line_type, <span class="hljs-string"><span class="hljs-string">"color"</span></span>=glue(<span class="hljs-string"><span class="hljs-string">"'{input$plot_color}'"</span></span>)), aes=aes) } gcode &lt;- glue(<span class="hljs-string"><span class="hljs-string">"ggplot(data_df(), aes(x=`{input$x_axis_value}`, y=`{input$y_axis_value}`))\\ {point_code} {line_code} + xlab('{input$x_axis_label}')"</span></span>) %&gt;% style_text(<span class="hljs-name"><span class="hljs-name">scope=</span></span><span class="hljs-string"><span class="hljs-string">"spaces"</span></span>) plot_Rcode(<span class="hljs-name"><span class="hljs-name">gcode</span></span>) })</code> </pre> <a name="habracut"></a></div></div><br><p>  Dependencies of elements can be very difficult, multi-step, but the equilibrium state is fast, the user does not notice all this.  For an analyst-developer, this is all also hidden under the hood.  To simplify life, we give the end user pictures of points and lines instead of numbers appearing in <code>ggplot</code> . </p><br><h2 id="ideya-2-povtornoe-ispolzovanie-interpretatora-r">  Idea 2. The reuse of the interpreter R </h2><br><p>  Many people like to poke into the fact that R is "slow because he is an interpreter."  Omitting the groundlessness and unsubstantiatedness of such an assertion (in fact, no one wishes to go down in detail), we use this ‚Äúweakness‚Äù as a force. </p><br><p>  Instead of writing a complicated ‚Äúflexible plotter‚Äù which, when generating graphics, will parameterize the process (welcome to Non-Standard-Evaluation!) Initial data and take into account all the nuances of the UI state, we will instead make the tidyverse generator of the R code dialect ( which during subsequent program execution (eval) will generate the required schedule: </p><br><pre> <code class="hljs perl"> output$staticPlot &lt;- renderPlot({ base::<span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(parse(text=re<span class="hljs-string"><span class="hljs-string">q(plot_Rcode)</span></span>)) })</code> </pre> <br><h2 id="fin">  Fin </h2><br><p>  Shiny prototype "a la Tableau" fits into 250 lines of code, including the UI part, comments and multiple validation (assertions) and costs 0 rubles 0 kopecks for licenses. </p><br><p>  Happy 2018 year! </p><br><p>  Previous publication - <a href="https://habrahabr.ru/post/345000/">‚ÄúR and Information Security.</a>  <a href="https://habrahabr.ru/post/345000/">How to eliminate the contradiction of interests and run R on Linux in offline mode</a> . <a href="https://habrahabr.ru/post/345000/">‚Äù</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/345304/">https://habr.com/ru/post/345304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345294/index.html">From tanks to nuclear power plants: looking back at Heisenbug 2017 Moscow</a></li>
<li><a href="../345296/index.html">Ratings of car brands: an example of analyzing variables with multiple response</a></li>
<li><a href="../345298/index.html">Automatic update of LetsEncrypt certificates in MDaemon mail server: step-by-step instructions</a></li>
<li><a href="../345300/index.html">Free Software Developer Self-Financing Guide</a></li>
<li><a href="../345302/index.html">Distributed Team Anatomy - Requirements Preparation Process</a></li>
<li><a href="../345306/index.html">Working with the in-memory database using Intel Optane</a></li>
<li><a href="../345310/index.html">Predict outflow using neural network</a></li>
<li><a href="../345312/index.html">New Year's post good</a></li>
<li><a href="../345314/index.html">I want to program, let them teach me! Avito educational projects</a></li>
<li><a href="../345316/index.html">Pay attention to people, not technology.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>