<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parsing URLs in Zend Framework 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task: 

1. Have a method that parses a string containing a URL. The string can contain both absolute and relative URLs, and both of these options must...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parsing URLs in Zend Framework 2</h1><div class="post__text post__text-html js-mediator-article">  <b>Task:</b> <ol><li>  Have a method that parses a string containing a URL.  The string can contain both absolute and relative URLs, and both of these options must be correctly parsed. </li><li>  Moreover, in the stock, the ‚Äúwrong‚Äù format of an absolute link is allowed - without the ‚Äúhttp: //‚Äù.  Further in the text, links of ‚Äúwrong‚Äù format will be called <i>incomplete absolute links</i> . </li><li>  Implement support for "RF" domains. </li></ol><br><a name="habracut"></a><br><table><tbody><tr><td>  Example: </td><th><code><a href="http://site.ru/page.php"></a> site.ru/page.php</code> </th> <th> <code>/page.php</code> </th> <th> <code>site.ru/page.php</code> </th> </tr><tr><th>  scheme </th><td>  http </td><td></td><td></td></tr><tr><th>  host </th><td>  site.ru </td><td></td><td>  site.ru </td></tr><tr><th>  path </th><td>  page.php </td><td>  page.php </td><td>  page.php </td></tr></tbody></table><br><h4>  Implementation of points 1 and 2 of our task </h4><br>  The <code>Zend\Uri\Http</code> class should help us with this.  It has the methods we need: <code>parse($uri)</code> , <code>getHost()</code> , <code>getPath()</code> , etc. <br>  <b>But!</b>  When parsing a URL like ‚Äú <code>site.ru/page.php</code> ‚Äù (without ‚Äú <code>http://</code> ‚Äù), <code>getHost()</code> returns an empty string, and <code>getPath()</code> returns ‚Äú <code>site.ru/page.php</code> ‚Äù. <br><br>  <b>Here is my way to achieve the desired</b> .  The format of an absolute incomplete link is identical to the link relative to the source (relative reference type).  You can recognize the absolute incomplete link by checking its TDL (first level domain).  If such a domain exists, the link can be considered absolute incomplete. <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myParse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($url)</span></span></span></span>{ $Http = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Http($url); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($Http-&gt;isValidRelative()){ <span class="hljs-comment"><span class="hljs-comment">//  url    $path = $Http-&gt;getPath(); //  path   ¬´/¬ª ‚Äî       ¬´¬ª    //    if( $path{0} !== '/' ){ //     ... $absoluteUrl = '//'.urldecode($Http-&gt;toString()); $absoluteHttp = new Http($absoluteUrl); // (1) $Hostname = new Hostname(array('allow'=&gt;Hostname::ALLOW_DNS, 'useTldCheck'=&gt;false)); $decode = true; // ...       (2) if ($Hostname-&gt;isValid($absoluteHttp-&gt;getHost($decode))) { //     ,    ¬´¬ª  $Http = $absoluteHttp; } } } return $Http; }</span></span></code> </pre> <br><h5>  Comments on the code </h5><br><ol><li>  We configure <code>Zend\Validator\Hostname</code> to check the presence of the first-level domain of the link in the <code>$validIdns</code> </li><li>  Pass in the <code>getHost()</code> method the <code>$decode = true;</code>  in order to <i>decode the</i> host.  The <code>getHost()</code> method of the <code>Zend\Uri\Http</code> class does not imply any parameters and does not decode anything!  Why then and how does it work?! .. Read below. </li></ol><br><h4>  The implementation of paragraph 3 of our task.  IDN RF and work with him </h4><br>  Unfortunately, ZF2 does not really work with IDNs, which we will have to compensate.  To do this, you need to download any class you like encoding and decoding url with punycode and extend the class <code>Zend\Uri\Http</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Application</span></span>\<span class="hljs-title"><span class="hljs-title">Other</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Zend</span></span>\<span class="hljs-title"><span class="hljs-title">Uri</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ZendHttp</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Application</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">IdnaConvert</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Http</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZendHttp</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($host)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($host){ $idn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IdnaConvert(); $host = $idn-&gt;encode($host); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::setHost($host); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($decode=false)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($decode &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;host){ $idn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IdnaConvert(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $idn-&gt;decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;host); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::getHost(); } }</code> </pre><br>  Accordingly, our method <code>myParse()</code> should use the extended class <code>Http</code> , which, when parsing a URL, will be able to encode RF domains;  and when calling the <code>getHost($decode)</code> method, we will be able to return the Punycode representation or decoded representation, depending on the parameter passed to the method. <br><br>  <i><b>PS</b> There are doubts about the quality of the above, but at the same time it is one of the reasons to publish a post in order to learn the opinion of those who are more experienced in the ZF2 part.</i>  <i>Another reason - where I have not found a solution to this seemingly obvious problem.</i>  <i>Maybe from you I learn about other, perhaps more simple and literate options.</i> </div><p>Source: <a href="https://habr.com/ru/post/198614/">https://habr.com/ru/post/198614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198602/index.html">Increase store conversion through purchases on credit</a></li>
<li><a href="../198606/index.html">Inflate tables and devour tablespaces</a></li>
<li><a href="../198608/index.html">USB Standard Organization vs Open Source</a></li>
<li><a href="../198610/index.html">Mikeysoft - BBS sysop, ceased to exist in 1995</a></li>
<li><a href="../198612/index.html">Questions for an interview middle / senior iOS Developer</a></li>
<li><a href="../198616/index.html">iPad Air (5), iPad Mini Retina, OS X, iLife, iWorks</a></li>
<li><a href="../198618/index.html">Harbor - new face xBase family</a></li>
<li><a href="../198620/index.html">HTML Academy, Habr and Crowd Funding</a></li>
<li><a href="../198622/index.html">Maria Bondarenko - Managing customer experience (talk from SPM Conference)</a></li>
<li><a href="../198626/index.html">Confederate Express - a game about survival in the harsh retro tones, ‚Äúwritten‚Äù by the masters of modern pixel art (Kickstarter Campaign)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>