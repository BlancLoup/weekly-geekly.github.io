<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Transceiver Signal Level via SNMP in Cisco</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes you need to know the signal level in the transceiver. The reasons are different: the sudden drop in the communication channel, the connectio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Transceiver Signal Level via SNMP in Cisco</h1><div class="post__text post__text-html js-mediator-article">  Sometimes you need to know the signal level in the transceiver.  The reasons are different: the sudden drop in the communication channel, the connection of new optical cross connects, monitoring.  An engineer with the necessary level of access resolves this issue in less than one minute using the command: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#show interfaces Te1/49 transceiver !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Optical Optical Temperature Voltage Tx Power Rx Power Port (Celsius) (Volts) (dBm) (dBm) --------- ----------- ------- -------- -------- Te1/49 53.3 3.25 -4.3 -2.8</span></span></code> </pre> <br>  Someone (who does not have the appropriate access) has to wait this minute for ages.  For example, when the channel fell at peak hours and on the backup link there were some losses that only showed up when the link was loaded with traffic.  Or when it was necessary to pass the new channel yesterday, but nothing works, because the supplier incorrectly signed the optics on the CWDM multiplexer, and it is required to find the ‚Äúright wave‚Äù using the random method.  And all this happens in the conditions of shortage of supreme network engineers and time. <br><br>  The article discusses the option of how to check the signal, having only read-only access via SNMP. <a name="habracut"></a>  At the same time, it is necessary to wait no more than 10 minutes (the normal period for updating the corresponding variable).  Allocating such access seems more <s>secure</s> than logical for a number of employees who, for one reason or another, do not have CCNA or CCNP (monitoring engineers, tellers, technical managers).  The same information can be useful when setting up monitoring systems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Given </h4><br><ul><li>  host with an IP address that has read-only access via SNMP to several Cisco (7604, 7609, 4948-10GE) </li><li>  Cisco device IP address (for example, 10.0.7.35) </li><li>  port number (for example, Te1 / 49) </li></ul><br><h4>  To find </h4><br><ul><li>  signal level of the transceiver installed in the specified port </li></ul><br><h4>  Decision </h4><br>  First, find the OID you need.  It will consist of the ID <a href="http://tools.cisco.com/Support/SNMP/do/BrowseOID.do%3Flocal%3Den%26translate%3DTranslate%26objectInput%3D1.3.6.1.4.1.9.9.91.1.1.1.1.4">"entSensorValue"</a> and the "index" of the sensor itself.  The latter can be found by running the following request from a host that has access via snmp to a network device with management IP 10.0.7.35: <br><br><pre> <code class="bash hljs">$ snmpwalk -v 2c -c community 10.0.7.35 1.3.6.1.2.1.47.1.1.1.1.7 | grep Te1/49 SNMPv2-SMI::mib-2.47.1.1.1.1.7.1107 = STRING: <span class="hljs-string"><span class="hljs-string">"Te1/49 Module Temperature Sensor"</span></span> SNMPv2-SMI::mib-2.47.1.1.1.1.7.1157 = STRING: <span class="hljs-string"><span class="hljs-string">"Te1/49 Supply Voltage Sensor"</span></span> SNMPv2-SMI::mib-2.47.1.1.1.1.7.1207 = STRING: <span class="hljs-string"><span class="hljs-string">"Te1/49 Bias Current Sensor"</span></span> SNMPv2-SMI::mib-2.47.1.1.1.1.7.1257 = STRING: <span class="hljs-string"><span class="hljs-string">"Te1/49 Transmit Power Sensor"</span></span> SNMPv2-SMI::mib-2.47.1.1.1.1.7.1307 = STRING: <span class="hljs-string"><span class="hljs-string">"Te1/49 Receive Power Sensor"</span></span></code> </pre><br>  We use the last number in the OID for "Te1 / 49 Transmit Power Sensor" and "Te1 / 49 Receive Power Sensor".  These are respectively 1257 and 1307. Using these numbers, we can immediately obtain the level of the outgoing and incoming optical signal (value): <br><br><pre> <code class="bash hljs">$ snmpget -v 2c -c community 10.0.7.35 1.3.6.1.4.1.9.9.91.1.1.1.1.4.1257 SNMPv2-SMI::enterprises.9.9.91.1.1.1.1.4.1257 = INTEGER: -28 $ snmpget -v 2c -c community 10.0.7.35 1.3.6.1.4.1.9.9.91.1.1.1.1.4.1307 SNMPv2-SMI::enterprises.9.9.91.1.1.1.1.4.1307 = INTEGER: -35</code> </pre><br>  Combining in a similar way <a href="http://tools.cisco.com/Support/SNMP/do/BrowseOID.do%3Flocal%3Den%26translate%3DTranslate%26objectInput%3D1.3.6.1.4.1.9.9.91.1.1.1.1.3">‚ÄúentSensorPrecision‚Äù</a> and ‚Äúindex‚Äù of the sensor, we find the measurement accuracy (the number of decimal places): <br><br><pre> <code class="bash hljs">$ snmpget -v 2c -c community 10.0.7.35 1.3.6.1.4.1.9.9.91.1.1.1.1.3.1257 SNMPv2-SMI::enterprises.9.9.91.1.1.1.1.3.1257 = INTEGER: 1 $ snmpget -v 2c -c community 10.0.7.35 1.3.6.1.4.1.9.9.91.1.1.1.1.3.1307 SNMPv2-SMI::enterprises.9.9.91.1.1.1.1.3.1307 = INTEGER: 1</code> </pre><br>  The number ‚Äú1‚Äù in this case means that you need to put a comma in front of one number to the right in the meaning of the corresponding sensor. <br>  Te1 / 49 Transmit Power = -2.8 <br>  Te1 / 49 Receive Power = -3.5 <br><br>  To determine the units of measure, we use <a href="http://tools.cisco.com/Support/SNMP/do/BrowseOID.do%3Flocal%3Den%26translate%3DTranslate%26objectInput%3D1.3.6.1.4.1.9.9.91.1.1.1.1.1">‚ÄúentSensorType‚Äù</a> in combination with the sensor ‚Äúindex‚Äù: <br><br><pre> <code class="bash hljs">$ snmpget -v 2c -c community 10.0.7.35 1.3.6.1.4.1.9.9.91.1.1.1.1.1.1257 SNMPv2-SMI::enterprises.9.9.91.1.1.1.1.1.1257 = INTEGER: 14 $ snmpget -v 2c -c community 10.0.7.35 1.3.6.1.4.1.9.9.91.1.1.1.1.1.1307 SNMPv2-SMI::enterprises.9.9.91.1.1.1.1.1.1307 = INTEGER: 14</code> </pre><br>  A value of 14 corresponds to the units of "dBm".  The list of values ‚Äã‚Äãis given in the <a href="http://tools.cisco.com/Support/SNMP/do/BrowseOID.do%3Flocal%3Den%26translate%3DTranslate%26objectInput%3D1.3.6.1.4.1.9.9.91.1.1.1.1.1">description of</a> "entSensorType". <br>  Decimal prefix can be added to units of measurement.  Which one will show <a href="http://tools.cisco.com/Support/SNMP/do/BrowseOID.do%3Flocal%3Den%26translate%3DTranslate%26objectInput%3D1.3.6.1.4.1.9.9.91.1.1.1.1.2">‚ÄúentSensorScale‚Äù</a> : <br><br><pre> <code class="bash hljs">$ snmpget -v 2c -c community 10.0.7.35 1.3.6.1.4.1.9.9.91.1.1.1.1.2.1257 SNMPv2-SMI::enterprises.9.9.91.1.1.1.1.2.1257 = INTEGER: 9 $ snmpget -v 2c -c community 10.0.7.35 1.3.6.1.4.1.9.9.91.1.1.1.1.2.1307 SNMPv2-SMI::enterprises.9.9.91.1.1.1.1.2.1307 = INTEGER: 9</code> </pre><br>  In this case, the prefix "Units" (which corresponds to the number 9) actually means the absence of the prefix. <br>  Thus, we received the signal level of the transceiver installed in the port Te1 / 49, on the switch with IP 10.0.7.35 <br><br>  Te1 / 49 Transmit Power = -2.8 dBm <br>  Te1 / 49 Receive Power = -3.5 dBm <br><br>  Let's make the answer according to the <a href="http://www.opennet.ru/docs/RUS/bash_scripting_guide/">textbook</a> : <br><br><div class="spoiler">  <b class="spoiler_title">light.bash</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash E_OPTERROR=65 verbose=0 get_type () { if [ -z "$1" ] # Length of argument is 0? then exit $E_OPTERROR elif [ "$1" -eq "1" ] then truetype=other elif [ "$1" -eq "2" ] then truetype=unknown elif [ "$1" -eq "3" ] then truetype=voltsAC elif [ "$1" -eq "4" ] then truetype=voltsDC elif [ "$1" -eq "5" ] then truetype=amperes elif [ "$1" -eq "6" ] then truetype=watts elif [ "$1" -eq "7" ] then truetype=hertz elif [ "$1" -eq "8" ] then truetype=celsius elif [ "$1" -eq "9" ] then truetype=percentRH elif [ "$1" -eq "10" ] then truetype="rpm" elif [ "$1" -eq "11" ] then truetype=cmm elif [ "$1" -eq "12" ] then truetype=truthvalue elif [ "$1" -eq "13" ] then truetype=specialEnum elif [ "$1" -eq "14" ] then truetype=dBm else echo type=$1,error; exit $E_OPTERROR fi return 0 } get_scale () { if [ -z "$1" ] # Length of argument is 0? then exit $E_OPTERROR elif [ "$1" -eq "1" ] then truescale=yocto elif [ "$1" -eq "2" ] then truescale=zepto elif [ "$1" -eq "3" ] then truescale=atto elif [ "$1" -eq "4" ] then truescale=femto elif [ "$1" -eq "5" ] then truescale=pico elif [ "$1" -eq "6" ] then truescale=nano elif [ "$1" -eq "7" ] then truescale=micro elif [ "$1" -eq "8" ] then truescale=milli elif [ "$1" -eq "9" ] then truescale="" elif [ "$1" -eq "10" ] then truescale=kilo elif [ "$1" -eq "11" ] then truescale=mega elif [ "$1" -eq "12" ] then truescale=giga elif [ "$1" -eq "13" ] then truescale=tera elif [ "$1" -eq "14" ] then truescale=exa elif [ "$1" -eq "15" ] then truescale=peta elif [ "$1" -eq "16" ] then truescale=zetta elif [ "$1" -eq "17" ] then truescale=yotta else echo scale=$1,error; exit $E_OPTERROR fi return 0 } #reading the options while getopts ":c:h:i:v" Option do #echo $OPTIND case $Option in c ) community=$OPTARG;; h ) host=$OPTARG;; i ) interface=$OPTARG;; v ) echo "Verbose mode is set";verbose=1;; * ) echo "Usage: `basename $0` -c community -h host -i interface"; exit $E_OPTERROR;; # default options esac done shift $(($OPTIND - 1)) #moving on to the next provided option if [ -z "$community" ] || [ -z $host ] || [ -z $interface ] # if some of options is not submitted then echo "Usage: `basename $0` -c community -h host -i interface" exit $E_OPTERROR fi if [ $verbose -eq 1 ] then echo "community is \"$community\"" echo "host is \"$host\"" echo "interface is \"$interface\"" fi #looking for the index of sensor if [ $verbose -eq 1 ] then echo "executing \"snmpwalk -v 2c -OX -c $community $host 1.3.6.1.2.1.47.1.1.1.1.7 | grep $interface\"" fi # step1: getiing information about device #snmpwalk -v 2c -OX -c $community $host 1.3.6.1.2.1.47.1.1.1.1.7 | grep $interface &gt; index=0 while read line; do string[$index]="$line" index=$(($index+1)) # done &lt; &lt;(cat tempcache) done &lt; &lt;(snmpwalk -v 2c -OX -c $community $host 1.3.6.1.2.1.47.1.1.1.1.7 | grep $interface) if [ $verbose -eq 1 ] then for ((a=0; a &lt; ${#string[*]}; a++)) do echo "have a string#$a as ${string[$a]}" done fi # step2: parse/cut received strings if [ $verbose -eq 1 ] then echo "parsing/cuting snmpwalk result" fi for ((a=0; a &lt; ${#string[*]}; a++)) do rx_string=`echo ${string[$a]} | grep Receive`; tx_string=`echo ${string[$a]} | grep Transmit`; if [ -n "$rx_string" ] then rx_sensor=`echo ${string[$a]}| cut -d "[" -f2 | cut -d "]" -f1` elif [ -n "$tx_string" ] then tx_sensor=`echo ${string[$a]}| cut -d "[" -f2 | cut -d "]" -f1` fi done if [ $verbose -eq 1 ] then echo "index of rx_sensor parsed to $rx_sensor" echo "index of tx_sensor parsed to $tx_sensor" fi #getting the sensor value if [ $verbose -eq 1 ] then echo "getting the sensor value" fi rx_value=`snmpget -v 2c -c $community $host 1.3.6.1.4.1.9.9.91.1.1.1.1.4.$rx_sensor | grep -o -e "INTEGER: [-+0-9]*" | cut -f2 -d" "` rx_precision=`snmpget -v 2c -c $community $host 1.3.6.1.4.1.9.9.91.1.1.1.1.3.$rx_sensor | grep -o -e "INTEGER: [-+0-9]*" | cut -f2 -d" "` rx_type=`snmpget -v 2c -c $community $host 1.3.6.1.4.1.9.9.91.1.1.1.1.1.$rx_sensor | grep -o -e "INTEGER: [-+0-9]*" | cut -f2 -d" "` get_type $rx_type rx_type=$truetype rx_scale=`snmpget -v 2c -c $community $host 1.3.6.1.4.1.9.9.91.1.1.1.1.2.$rx_sensor | grep -o -e "INTEGER: [-+0-9]*" | cut -f2 -d" "` get_scale $rx_scale rx_scale=$truescale tx_value=`snmpget -v 2c -c $community $host 1.3.6.1.4.1.9.9.91.1.1.1.1.4.$tx_sensor | grep -o -e "INTEGER: [-+0-9]*" | cut -f2 -d" "` tx_precision=`snmpget -v 2c -c $community $host 1.3.6.1.4.1.9.9.91.1.1.1.1.3.$tx_sensor | grep -o -e "INTEGER: [-+0-9]*" | cut -f2 -d" "` tx_type=`snmpget -v 2c -c $community $host 1.3.6.1.4.1.9.9.91.1.1.1.1.1.$tx_sensor | grep -o -e "INTEGER: [-+0-9]*" | cut -f2 -d" "` get_type $tx_type tx_type=$truetype tx_scale=`snmpget -v 2c -c $community $host 1.3.6.1.4.1.9.9.91.1.1.1.1.2.$rx_sensor | grep -o -e "INTEGER: [-+0-9]*" | cut -f2 -d" "` get_scale $tx_scale tx_scale=$truescale let lengthrx=${#rx_value}-$rx_precision let lengthtx=${#tx_value}-$tx_precision echo RX=${rx_value:0:$lengthrx}.${rx_value:$lengthrx} $rx_scale$rx_type echo TX=${tx_value:0:$lengthtx}.${tx_value:$lengthtx} $tx_scale$tx_type exit 0</span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/260721/">https://habr.com/ru/post/260721/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260711/index.html">Free mono-vendor seminar on Kerio solutions - Kerio Control</a></li>
<li><a href="../260713/index.html">Where to go to study as a programmer</a></li>
<li><a href="../260715/index.html">How to use Canvas to compile a clickable world map on Unity3d</a></li>
<li><a href="../260717/index.html">Quick Start Template for Arduino Due at QtCreator</a></li>
<li><a href="../260719/index.html">AJAX and performance</a></li>
<li><a href="../260723/index.html">Fix Alt-Tab in LabView</a></li>
<li><a href="../260727/index.html">Replacing HDD on NetUP tape drive and installing firmware</a></li>
<li><a href="../260733/index.html">The future of electronic signature</a></li>
<li><a href="../260735/index.html">Go as a language for learning programming</a></li>
<li><a href="../260737/index.html">Thunderstorm, lightning, and means of protection of the power grid on its own</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>