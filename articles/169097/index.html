<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Build traffic lights in the office</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a long time I had the idea to visualize build statuses in some simple and effective way. Under the cut, I'll tell you how a real traffic light app...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Build traffic lights in the office</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/601/4e6/bef/6014e6bef45862ab1da9b44a81f106cc.jpg"><br clear="all"><br clear="all"><br clear="all">  For a long time I had the idea to visualize build statuses in some simple and effective way.  Under the cut, I'll tell you how a real traffic light appeared in my office, how it works and why it is needed at all. <a name="habracut"></a><br clear="all"><br clear="all"><br clear="all"><h1>  Search for traffic lights. </h1>  Finding a traffic light was the most difficult task.  I wanted to find exactly the written off traffic light, warm and lamp.  As it turned out, there are simply no such traffic lights in Runet.  There are several companies specializing in the production of signaling lighting equipment, including traffic lights, but, unfortunately, these are either LED traffic lights or lamp lights (for signaling at car washes or conveyor lines), but not road.  The proposals of Russian and Belarusian companies look like this: <br clear="all"><br clear="all"><img src="https://habrastorage.org/storage2/061/119/a6e/061119a6ec2cc831138788ac0511604d.jpg"><br clear="all"><br clear="all">  In addition, the new traffic light is not cheap.  Prices for a three-piece traffic light start at $ 300. <br clear="all"><br clear="all">  Written off (or stolen) road traffic lights can be found on ebay, the blessing of the sea offers.  Classic American and English traffic lights look amazing, but at the expense of the ‚Äúvintage‚Äù console, prices for normal options start at $ 400.  Plus, you need to consider the cost of delivering a large and heavy load. <br clear="all"><br clear="all"><img src="https://habrastorage.org/storage2/540/f09/267/540f0926720dd85fe1c9904957e5527a.jpg"><br clear="all"><br clear="all">  By luck, after a few weeks of searching, I managed to find a way out to people at the traffic police (this is happening in Belarus), who are engaged in the replacement of street traffic lights.  Through them, I found out that the lamp traffic light, which has served 15 years, is dismantled and disposed of.  Glass lenses go to the cement plant, iron reflectors for scrap metal, plastic shells (yes, they are all plastic for a long time) for recycling.  One of these traffic lights still continued its work, only now in a comfortable office. <br clear="all"><br clear="all"><br clear="all"><h1>  Subject </h1><img src="https://habrastorage.org/storage2/510/197/c4b/510197c4b65c62d12bea5f8b4e25a2a8.jpg"><br clear="all"><br clear="all">  The size of the traffic light is determined by the diameter of the lenses.  In our country there are traffic lights with lenses of 10, 20 and 30 centimeters, and the latter are more common.  Depending on the width of the street and the saturation of the movement choose one or another type.  I got the biggest one - the total height of the traffic light exceeds a meter.  Driving along the street you do not even notice how huge it is.  The size of such a traffic light is the first thing that amazes people in the office.  There were suggestions that this is some specially increased version or even a railway traffic light. <br clear="all"><br clear="all">  The housing and visors of the domestic traffic light produced in the mid-nineties are made of sturdy plastic, 5 millimeters thick.  Lenses from colored glass, grooved from the inside, reflectors from iron.  In the traffic light, there are 3 separate interchangeable sections, bolted together.  Sections can be opened - there are curtains on the left, and unpretentious spring latches on the right.  There is no security system against hooligans at such a traffic light, it can be opened with a flick of the wrist.  Besides the 60 watt bulbs and wires, there's nothing inside. <br clear="all"><br clear="all"><img src="https://habrastorage.org/storage2/604/5bc/a45/6045bca454f4e5192d2eeb05d8ad3399.jpg"><br clear="all"><br clear="all">  I got the traffic light in good condition, not counting a small crack in one of the sections, which judging by the appearance appeared quite recently (possibly during dismantling or transportation).  Inside, I was awaited by a mountain of dead insects and layers of stuck road soot, so I had to spend one evening to restore order.  In addition, the reflectors noticeably rotted during service, but they cope with their task regularly.  I laundered the traffic light, replaced the light bulbs and plugged it directly into an outlet in my kitchen.  Here's what happened: <br clear="all"><br clear="all"><img src="https://habrastorage.org/storage2/16d/4df/cee/16d4dfcee2add83912ff68683c246c52.jpg"><br clear="all"><br clear="all"><br clear="all"><h1>  Electronics </h1>  To switch the traffic light signals, it was decided to use a 16-channel controller (there is simply no less) <a href="http://www.masterkit.ru/main/set.php%3Fcode_id%3D573112">MP710</a> and 4-channel <a href="http://www.masterkit.ru/main/set.php%3Fcode_id%3D573715">MP701</a> relay, produced by <a href="http://www.masterkit.ru/">MASTER KIT</a> .  At the heart of the controller chip <a href="http://www.atmel.com/devices/attiny45.aspx">Attiny45</a> .  It works at a frequency of 20 MHz, has a memory of as much as 4kb.  The 16 channels of the controller can be switched in a huge number of modes, such as slow fading, strobe, etc.  On the back of the controller there are 16 LEDs, very convenient for debugging code.  Initially, a script is loaded into the chip, showing the capabilities of the controller: <br clear="all"><br clear="all"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/r9YmabU7GKk%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhjEqj1uv8E5b2EjXjDqtEN7RO2Fmg" frameborder="0" allowfullscreen=""></iframe><br clear="all"><br clear="all">  All this magnificence can come in handy except for the implementation of the New Year's garland.  I think in most projects would be enough just on / off. <br clear="all"><br clear="all">  From the electronics in my traffic light there is still the usual household voltage regulator.  He had to finish the already assembled and installed structure: the light from the traffic light is not very pleasant and hurts the eyes, I want to mute it a little.  Now the traffic light works for about one third of its maximum power, that is, somewhere per watt 20. I will say that this is quite enough for its tasks.  If desired, you can turn the knob to a larger voltage or turn off the traffic light altogether. <br clear="all"><br clear="all">  When debugging a relay, it is worth considering that it does not have any fuses, any connection error will become fatal, so you cannot do without a multimeter.  Another thing to remember is that the length of the usb wire is limited.  It was experimentally found that the resistance of the wire over 13 meters does not allow the signal to pass normally. <br clear="all"><br clear="all"><img src="https://habrastorage.org/storage2/28f/8af/e6e/28f8afe6e0bfc99455fb43296c1f942e.jpg"><br clear="all"><br clear="all">  On the manufacturer's website, you can download software for controlling the controller for Windows.  The program is intended solely for debugging, the interface looks like this: <br clear="all"><br clear="all"><img src="https://habrastorage.org/storage2/6c8/6ff/f9b/6c86fff9b2ec89483c4a5cdbeeb60be0.png"><br clear="all"><br clear="all">  In addition, it is possible to manage the controller via FTP.  The scheme is approximately as follows: on a Windows machine, you have a service running that checks a configuration file on a remote server with a certain period.  This option is interesting except for educational purposes, and there is no desire to use it in a real application. <br clear="all"><br clear="all">  I needed to use only 3 channels of the controller.  Using the <a href="http://libhid.alioth.debian.org/">Libhid</a> library <a href="http://libhid.alioth.debian.org/">,</a> I wrote 3 very simple scripts, the tasks of each of which included extinguishing all channels and turning on one corresponding to a red, yellow, or green light.  Next, I will tell on what principle these same lights turn on. <br clear="all"><br clear="all"><br clear="all"><h1>  Logics </h1>  The logic of the traffic light is as follows: on Jenkins server, project builds are launched, which are essentially Selenium test suites.  Projects about 10, in each order of hundreds of tests.  Every minute, krone runs a php script that checks the status of all recent builds.  If at least one of the builds fails (at least one test fails), the php script calls a program that includes a red light.  If all builds are green, then the light bulb, respectively, lights up green.  In the event that a valid response from the Jenkins server does not come (the server is lying or not the Internet, for example), a yellow traffic light comes on.  The task of the developers is to check what is wrong if the traffic light is red.  That's all the logic :). <br clear="all"><br clear="all"><br clear="all"><h1>  Alternatives </h1> The electronic part of the traffic light could be implemented in a different way.  When choosing a controller to implement my idea, I was guided by the fact that in the office, in any case, there are computers to which this controller can be connected.  Later, experimentally, I was convinced that the idea would not be feasible with the MP710 controller, if the length of the USB wire exceeded 13 meters.  Believe me, this is not so much, because the wire from the traffic light does not go directly to the computer (as from an iron to a power outlet), but along the wall and floor / desktop boxes.  In addition, in my implementation, the minus is that the user of the computer in which the controller is turned on may restart or simply turn off the machine, in which case the yellow light comes on. <br clear="all"><br clear="all"><br clear="all">  Full independence could be obtained using <a href="http://research.andbas.com/2013/01/arduino-ethernet-shield.html">Arduino + Ethernet Shield</a> . <br clear="all"><br clear="all"><img src="https://habrastorage.org/getpro/habr/post_images/d1a/4c3/669/d1a4c36691caa652f0d9cf0a4d18fdca.jpg" alt="image"><br clear="all"><br clear="all"><img src="https://habrastorage.org/getpro/habr/post_images/512/878/d89/512878d895a98299d1e250c8c7ccc029.jpg" alt="image"><br clear="all"><br clear="all">  Another independent option would be the <a href="http://en.wikipedia.org/wiki/Raspberry_Pi">Raspberry Pi</a> board or any equivalent. <br clear="all"><br clear="all"><img src="http://makezineblog.files.wordpress.com/2012/08/raspberry-pi-makey.jpg?w=598&amp;h=371" alt="image"><br clear="all"><br clear="all">  Such a solution would be a bit more expensive than the one I chose (if you do not take into account the cost of the computer to which the controller is connected), but there would be complete independence and autonomy.  Maybe next time I will. <br clear="all"><br clear="all"><br clear="all"><h1>  Cost of </h1>  Calculate the objective cost of the entire device is not easy, because most of it is the cost of traffic lights, which can vary depending on your region / tastes / luck.  Conventionally, we will take it equal to $ 300, which corresponds to a new traffic light, which is not difficult to find in almost any city. <br clear="all"><br clear="all"><table><tbody><tr><td>  <a href="http://www.masterkit.ru/main/set.php%3Fcode_id%3D573112">MP710 Controller</a> </td><td>  $ 30 </td></tr><tr><td>  <a href="http://www.masterkit.ru/main/set.php%3Fcode_id%3D573715">MP701 Relay</a> </td><td>  $ 17 </td></tr><tr><td>  Wires, USB extensions, box, fasteners, brightness control </td><td>  $ 40 </td></tr><tr><td>  Traffic light </td><td>  $ 300 </td></tr><tr><td>  123 </td><td>  Total: $ 387 </td></tr></tbody></table><br clear="all"><br clear="all">  In my opinion, the solution was effective.  I will be glad to answer your questions in the comments. <br clear="all"><br clear="all"><img src="https://habrastorage.org/storage2/c4a/91d/f8f/c4a91df8f55ef41d3e5b08faf3139bfc.jpg"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/169097/">https://habr.com/ru/post/169097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169085/index.html">We are making a dream or "Truckers-2 - the old drive in the new packaging"</a></li>
<li><a href="../169087/index.html">We are urgently updated to Ruby on Rails 3.2.12, 3.1.11 and 2.3.17 for the benefit of our own nerves</a></li>
<li><a href="../169089/index.html">VLC can get support for streaming torrent playback</a></li>
<li><a href="../169091/index.html">YouTube is testing a new channel design</a></li>
<li><a href="../169093/index.html">Cheat Sheet by Language R</a></li>
<li><a href="../169099/index.html">An inside look: postgraduate study at EPFL. Part 1</a></li>
<li><a href="../169103/index.html">MPLS and VPLS on Mikrotik</a></li>
<li><a href="../169105/index.html">Flickr accidentally made some private photos for 20 days public.</a></li>
<li><a href="../169107/index.html">Washington Post: Mass cyber espionage campaign underway against the USA</a></li>
<li><a href="../169109/index.html">Own constitution as a foundation for setting goals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>