<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Part 3. How to connect a smartphone to the car - read the data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the cycle of articles on how to connect to the on-board system of your car (see Part 1 and Part 2 ) and today we will tell you how to read...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Part 3. How to connect a smartphone to the car - read the data</h1><div class="post__text post__text-html js-mediator-article">  We continue the cycle of articles on how to connect to the on-board system of your car (see <a href="http://habrahabr.ru/company/pnn/blog/186242/">Part 1</a> and <a href="http://habrahabr.ru/company/pnn/blog/186930/">Part 2</a> ) and today we will tell you how to read the data. <br><img src="https://habrastorage.org/storage2/a7e/698/5d2/a7e6985d2dd1d1aec92d6ecf955c8a74.png" align="left"><br>  <i>It is assumed that by the current moment we have a car with a diagnostic connector that meets the OBD-II standard, a favorite mobile device (laptop, smartphone, tablet) and an adapter based on ELM327, which will allow connecting the machine and mobile device.</i> <br><br>  As mentioned in the previous section, regardless of the type of communication between the mobile device and the adapter (Bluetooth, Wi-Fi, USB) at the logical level, this is a serial connection.  At the program level, you must open the Socket connection between the computer and the adapter over the existing connection of the lower level.  Practical software implementation will depend on the operating system and type of connection, examples can be found a lot under all your favorite programming languages.  As a basic example, you can take the implementation of the connection on the examples of chat programs for Bluetooth or TCP \ IP.  In this article we will not dwell in detail on the implementation of such a connection, for experiments we have enough capabilities of existing programs a la Telnet, for experiments under Android and iOS we have embedded a simple command console in our application <a href="http://play.google.com/store/apps/details%3Fid%3Dcom.pnn.obdcardoctor">OBD Car Doctor</a> . <br><a name="habracut"></a><br>  So, download and install a program that allows you to establish a serial connection with the adapter and provide us with the command line to communicate with the machine. <br><br><ul><li>  For a laptop with Windows (Linux), you can use <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">Putty</a> , </li><li>  for Android and iOS, you can use <a href="http://play.google.com/store/apps/details%3Fid%3Dcom.pnn.obdcardoctor">OBD Car Doctor Android</a> , <a href="https://itunes.apple.com/us/app/obd-car-doctor/id652142348%3Fl%3Dru%26ls%3D1%26mt%3D8">OBD Car Doctor iOS</a> .  <i>Please note that at the time of publishing the article on iTunes, there may still be an old version 1.2, the console will be available in version 1.3.</i> </li></ul><br><h6>  After downloading and installing programs, it‚Äôs time to take a computer (smartphone), an adapter and slide out to the machine.  Listing this article also does not hurt. </h6>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  We are convinced that before you is your car, and / or that its owner is not against <s>cruel</s> experiments with the diagnostic system of the car. </li><li>  We connect the adapter to the diagnostic connector (I hope you have prepared in advance and have already found the connector in accordance with the recommendations in the previous section). </li><li>  The key "to start", turn on the ignition. </li><li>  The power light on the adapter should come on and we can continue. </li></ul><br><h6>  We will discuss in more detail the connection with the Bluetooth adapter, as the most popular and popular type of adapter. </h6><br><br><h4>  Windows: </h4><br>  In the Devices section we search for new devices (on some adapters, you need to press a button for the device to be detected), after detecting the device and entering the pin code, the device will appear in the general list. <br><img src="https://habrastorage.org/storage2/653/c6e/fe1/653c6efe11047c79eddb4f8948e08c20.png"><br>  We look at the properties tab equipment <br><img src="https://habrastorage.org/storage2/937/23d/f27/93723df27180cb97bc869b6d506fa5b5.png"><br>  Now the properties of the serial port. <br><img src="https://habrastorage.org/storage2/ec1/844/64a/ec184464a377bb729db40ec6d0c4352c.png"><br>  We see and remember that the Bluetooth serial connection is mapped onto the COM3 port.  If necessary, change to another port.  Now we start Putty and configure the program to work with the COM port defined in the previous step (in the example with COM3). <br><img src="https://habrastorage.org/storage2/9b4/f1c/1f2/9b4f1c1f2d84b50af445c662de6c9951.png"><br>  So, enter the name of the COM port, speed 9600, type Serial and click Open to open the terminal window. <br><br><h4>  Android: </h4><br>  1. Connect the Bluetooth adapter to the OBD-II connector of your car (we wrote about it and its location in <a href="http://habrahabr.ru/company/pnn/blog/186930/">Part 2</a> ).  Make sure the light on the adapter is lit. <img src="https://habrastorage.org/storage2/2db/474/a12/2db474a128653e67cb3164a68a73ff2d.png" align="right"><br>  2. Start the car engine <br>  3. Go to the Bluetooth environment on your smartphone: ‚ÄúSettings‚Äù&gt; Bluetooth and start searching for Bluetooth devices, find the OBD II adapter, it should appear in the list of devices as' scantool ',' obdkey ',' plx ... ',' cbt 'or something similar.  Select an adapter.  He will offer to make conjugation devices. <br>  4. Pair the devices.  The device will ask for a secret pairing code, as a rule: 1234 or 0000. <br>  5. Go to the OBD Car Doctor app on your smartphone. <br>  6. In <i>Settings,</i> in the <i>BT connection</i> item, select the name of the adapter with which the pairing was previously performed. <br>  7. In <i>Settings,</i> in the <i>Test</i> section, check the <i>Console</i> option.  Go back to the main page, click <i>Connect</i> and after successful connection select <i>Console</i> ( <i>this function is available starting from the OBD Car Doctor Android 2.22 version</i> ). <br><br><h4>  iOS: </h4><br>  1. Connect the OBD-II Wi-Fi adapter to the OBD-II connector of your car.  Start the car engine and wait for the green glow on the Wi-Fi adapter. <img src="https://habrastorage.org/storage2/79d/c90/e7c/79dc90e7c3feced345a00f2a595ea566.png" align="right"><br>  2. On your iPhone device, go to Settings (Settings), select to connect to the Wi-Fi network.  After connecting to Wi-Fi, go to advanced settings and install: <br><ul><li>  IP Address: Static </li><li>  IP Address: 192.168.0.11 </li><li>  Subnet Mask: 255.255.255.0 </li></ul>  Select the device name for the Wi-Fi connection.  Exit settings. <br>  3. Navigate to the OBD Car Doctor app&gt; Settings, where you configure the following: <br><ul><li>  IP Address: 192.168.0.10 </li><li>  Port: 35000 </li><li>  Click ‚ÄúSave‚Äù and ‚ÄúExit‚Äù </li></ul><br>  4. Start the engine. <br>  5. Go to the OBD Car Doctor app on your smartphone.  In Settings, in the <i>Test</i> section, check the <i>Console</i> option.  We return to the main page, click <i>Connect</i> and, after successful connection, select the <i>Console</i> item ( <i>this function is available starting from the OBD Car Doctor iOS 1.3 version, which is expected to be released soon</i> ). <br><br>  Upon completion of the described actions you are ready to enter commands and receive answers from the vehicle diagnostic system.  It is natural to work with the console in motion is not very convenient and not safe even for a passenger.  Therefore, we offer to experiment on a set, but conveniently parked car. <br><br>  Above, we mentioned that the commands are divided into 2 types: <i>adapter control commands and the OBD-II command itself</i> .  Usually, control commands start with an AT sequence, while OBD-II commands consist of hexadecimal digits only. <br><br><h6>  So, our first team: </h6><br>  ‚Ä¢ type <b>ATZ</b> and press Enter (or the Send button).  If the adapter has power and the connection with it has been established, we should see the response line: <br> <code>ELM 327 v1.3a &gt;</code> <br>  Or something similar, depending on the controller used and the firmware version of the adapter.  <b>ATZ</b> is an initialization command and reloads the adapter. <br><br>  ‚Ä¢ The next command can be the protocol installation command, enter the <b>ATSP0</b> command, we should receive in response <br> <code>ATSP0 OK &gt;</code> <br>  The <b>ATSP0</b> command <b>does</b> not directly establish the adapter-vehicle interaction protocol, this is a special command that sets the adapter to automatically detect the protocol protocol.  To directly search and establish a connection, we must send an OBD-II command. <br><br>  ‚Ä¢ We send command <b>0100</b> (which stands for MODE 01, PID 00), in case of success, we should get something like <br> <code>0100 Searching‚Ä¶</code> <br> <code>41 00 XX XX XX XX &gt;</code> <br>  Where X can be any hexadecimal digit. <br><img src="https://habrastorage.org/storage2/7a4/d8a/a9c/7a4d8aa9cacf9d429a4b39935dde9a17.jpg"><br><br><h5>  Here we pay attention to a few points: </h5><br>  ‚Ä¢ spaces can be ignored both in commands and in responses;  the presence or absence of spaces in the response is controlled by a separate <code>ATS{0|1}</code> command <code>ATS{0|1}</code> <br>  ‚Ä¢ echo may be present or absent in the response (i.e. command repetition, as in the example above);  the presence or absence of spaces in the response is controlled by a separate <code>ATE{0|1}</code> command <code>ATE{0|1}</code> <br>  ‚Ä¢ the response to the command itself contains the modified value of the command, namely <b>(mode + 0x40) (PID)</b> , i.e.  positive response to command <b>0100</b> , must begin with <b>4100</b> . <br><br><h5>  In case of failure, the answers may be as follows: </h5><br> <code>0100 SEARCHING...</code> <br> <code>UNABLE TO CONNECT &gt;</code> <br>  or <br> <code>0100 SEARCHING...</code> <br> <code>NO DATA &gt;</code> <br>  ... <br>  Similar answers mean that the adapter could not automatically determine the communication protocol with the car. <br><br>  Instead of the automatic protocol search, you can set the protocol number explicitly, hex numbers from 1 to C are supported. <br> <code>1 - SAE J1850 PWM</code> <br> <code>2 - SAE J1850 VPW</code> <br> <code>3 - ISO 9142-2</code> <br> <code>4 - ISO 14230-4 KWP (5 baud init)</code> <br> <code>5 - ISO 14230-4 KWP (fast init)</code> <br> <code>6 - ISO 15765-4 CAN (11 bit, 500 Kbaud)</code> <br> <code>7 - ISO 15765-4 CAN (29 bit, 500 Kbaud)</code> <br> <code>8 - ISO 15765-4 CAN (11 bit, 250 Kbaud)</code> <br> <code>9 - ISO 15765-4 CAN (29 bit, 250 Kbaud)</code> <br> <code>A - SAE J1939 CAN (29 bit, 250 Kbaud)</code> <br> <code>B - USER1 CAN (11 bit, 125 Kbaud)</code> <br> <code>C - USER2 CAN (11 bit, 50 Kbaud)</code> <br> <br>  For example, to explicitly establish communication using the ISO 9142-2 protocol, type the ATSP3 command, we get in response ATSP3 OK&gt; <br>  And check the performance of the team 0100, again, if successful, we expect to see <br> <code>0100 Searching‚Ä¶</code> <br> <code>01 00 41 00 XX XX XX XX &gt;</code> <br> <br>  If we see something else, like <br> <code>0100 BUS INIT:</code> <br> <code>‚Ä¶ERROR</code> <br>  What does it mean - communication under this protocol is not established. <br><br>  For testing and establishing a communication protocol, any vehicle supported by OBD-II can be used, but it is recommended to use the 0100, since it must be supported by the manufacturer in accordance with the standard.  This command should return PID support information from 01 to 20 for MODE 01. <br><br>  Recall that MODE 01 is responsible for reading the dynamic parameters of the vehicle (speed, speed, temperature, etc.) in real time.  Accordingly, after reading the answer to 0100, which contains information on which of the PIDs from 01 to 20 (hexadecimal) are supported.  To decrypt, we need to convert the hexadecimal representation of a number into a binary one, with the bit position (from highest to lowest) corresponding to the PID number (from 01 to 20). <br>  For example, a response containing 80 00 00 00 = 1000 0000 0000 0000 0000 0000. <br>  Means support for a single PID, namely 01. <br><br>  Now you can read the answer of your car to the command 0100 and find out the numbers of all the commands (PID) supported in your car.  Please note that if the command 0120 is supported, then by sending it you can read the numbers of the supported PIDs in the range 21 - 40, etc., i.e.  0100, 0120, ... 01D0, which are responsible for determining the numbers of all supported commands in MODE 01. <br><br>  To consolidate the knowledge gained, we propose to perform another simple command and disassemble the result.  If you decrypted the response of command 0100 and received that the PID 0C is supported, send the command 010C (engine rpm), the answer should be in the form: <br> <code>01 0C 41 0C 0B B8 &gt;</code> <br>  To obtain the value in revolutions per minute, you must receive the answer (0B B8 = 3000) divided by 4, i.e.  we get 750 rpm <br>  A list of supported commands and conversion formulas can be found <a href="http://en.wikipedia.org/wiki/OBD-II_PIDs">here</a> . <br><br>  <i>While you are experimenting with sending various commands, as well as receiving and decoding values, we will prepare the next part (s), which will deal with issues of working with multiple onboard controllers, what you need to know about command headers, reading and dumping errors, for which other MODE, "almost OBD-II", as well as other topics that may interest you.</i> </div><p>Source: <a href="https://habr.com/ru/post/188488/">https://habr.com/ru/post/188488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188472/index.html">Features of the gaming market in China - part 1</a></li>
<li><a href="../188474/index.html">Configuring OpenVPN Internet Gateway on Debian, which is on OpenVZ</a></li>
<li><a href="../188480/index.html">New Brief: Samsung launches first 3GB LPDDR3 memory modules in mass production</a></li>
<li><a href="../188484/index.html">Mobile typography</a></li>
<li><a href="../188486/index.html">Farewell to Ilya Segalovich</a></li>
<li><a href="../188490/index.html">If you are not crazy midnight danser, you do not have a car, and live on an uninhabited island, then do not read this article!</a></li>
<li><a href="../188492/index.html">The idea and implementation of a simple means of controlling battery power consumption</a></li>
<li><a href="../188496/index.html">MakeCloud: what's new</a></li>
<li><a href="../188498/index.html">Updated vision of approaches to information security from Gartner</a></li>
<li><a href="../188504/index.html">Hackathon PayPal "Battle Hack" in Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>