<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dagaz: Halfway</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Just to the right, the slope - fall, disappear! 
 A little to the left slope - still not save! 
 But calm, it remains to pass 
 Just two-quarters of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dagaz: Halfway</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/43e/794/3a3/43e7943a3e289a281570ab8b68d347b8.png" alt="image">  <b><i>Just to the right, the slope - fall, disappear!</i></b> <b><i><br></i></b>  <b><i>A little to the left slope - still not save!</i></b> <b><i><br></i></b>  <b><i>But calm, it remains to pass</i></b> <b><i><br></i></b>  <b><i>Just two-quarters of the way!</i></b> <b><i><br><br></i></b>  <b><i>Vladimir Vysotsky " <a href="http://www.bards.ru/archives/part.php%3Fid%3D18158">Tensioned rope</a> "</i></b> <br><br>  When the front of work looks completely immeasurable, it has to be divided into small pieces.  Slice, for the first iteration, I chose a very <a href="">small one</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Very simple checkers</b> <div class="spoiler_text"><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">board</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> chess-board-10x10) (<span class="hljs-name"><span class="hljs-name">dim</span></span> <span class="hljs-string"><span class="hljs-string">"aj"</span></span>) (<span class="hljs-name"><span class="hljs-name">dim</span></span> <span class="hljs-string"><span class="hljs-string">"10-1"</span></span>) (<span class="hljs-name"><span class="hljs-name">dir</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> nw) <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>) (<span class="hljs-name"><span class="hljs-name">dir</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> ne) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>) (<span class="hljs-name"><span class="hljs-name">dir</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> se) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">dir</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> sw) <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) ) (<span class="hljs-name"><span class="hljs-name">piece</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> Man) (<span class="hljs-name"><span class="hljs-name">pre</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?) (<span class="hljs-name"><span class="hljs-name">take</span></span>) (<span class="hljs-name"><span class="hljs-name">log</span></span> position) (<span class="hljs-name"><span class="hljs-name">let</span></span> captured <span class="hljs-number"><span class="hljs-number">0</span></span>) ) (<span class="hljs-name"><span class="hljs-name">post</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;=</span></span> max-captured captured)) (<span class="hljs-name"><span class="hljs-name">set!</span></span> max-captured captured) (<span class="hljs-name"><span class="hljs-name">log</span></span> <span class="hljs-string"><span class="hljs-string">" - "</span></span> position) (<span class="hljs-name"><span class="hljs-name">drop</span></span>) ) (<span class="hljs-name"><span class="hljs-name">move</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">any</span></span> nw ne)) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) ) (<span class="hljs-name"><span class="hljs-name">move</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> true (<span class="hljs-name"><span class="hljs-name">let</span></span> dir (<span class="hljs-name"><span class="hljs-name">any</span></span> nw ne sw se)) (<span class="hljs-name"><span class="hljs-name">check</span></span> dir) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-enemy?) (<span class="hljs-name"><span class="hljs-name">capture</span></span>) (<span class="hljs-name"><span class="hljs-name">inc!</span></span> captured) (<span class="hljs-name"><span class="hljs-name">check</span></span> dir) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) (<span class="hljs-name"><span class="hljs-name">end-move</span></span>) ) ) ) (<span class="hljs-name"><span class="hljs-name">game</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> <span class="hljs-string"><span class="hljs-string">"Simple Checkers"</span></span>) (<span class="hljs-name"><span class="hljs-name">board</span></span> chess-board-10x10) (<span class="hljs-name"><span class="hljs-name">players</span></span> (<span class="hljs-name"><span class="hljs-name">White</span></span> (<span class="hljs-name"><span class="hljs-name">Man</span></span> a1 c1 e1 g1 i1 b2 d2 f2 h2 j2 a3 c3 e3 g3 i3)) (<span class="hljs-name"><span class="hljs-name">Black</span></span> (<span class="hljs-name"><span class="hljs-name">Man</span></span> b8 d8 f8 h8 j8 a7 c7 e7 g7 i7 b6 d6 f6 h6 j6)) ) )</code> </pre> <br></div></div><br>  Even without ladies!  The figures move forward and can "beat" the enemy, according to the usual rules of " <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2588%25D0%25BA%25D0%25B8">Checkers</a> " (jumping over the figure).  Having reached the last line of the board, they do not turn into anything, but can take enemy pieces, since taking "back" is allowed.  In this regard, the game being developed is similar to the ‚ÄúOssetian checkers‚Äù described in a previous <a href="http://habrahabr.ru/post/253397/">article</a> .  Taking is mandatory and, from all possible moves, the player must choose a move that takes the maximum number of pieces.  The game ends when one of the players cannot complete the next move (locked or lost all the pieces). <br><br>  Of course, this is not about ‚Äúcode the next checkers‚Äù (this could be done with less effort).  I want to develop a "meta-game" system that allows you to describe fairly complex logic games using simple <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA">DSL</a> and, ideally, not possessing advanced programming skills (that is, exactly what <a href="http://www.zillions-of-games.com/">Zillions of Games</a> does, but in a fully open and cross-platform project). <br><a name="habracut"></a><br><h4>  <b>Crazy Russian Stack Machine</b> </h4><br>  I was thinking about one question for a very long time.  In fact, in order to make descriptions of games as declarative as possible, I need <a href="http://icem-www.folkwang-hochschule.de/~finnendahl/cm_kurse/doc/t-y-scheme/t-y-scheme-Z-H-15.html">non-deterministic programming</a> !  Just look at this snippet: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">move</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">any</span></span> nw ne)) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) )</code> </pre><br>  This is a description of the ‚Äúquiet‚Äù stroke of the figure.  And it says that <b>any</b> shape can move to the "northwest" <b>or</b> "northeast", provided that the target cell is empty.  We are not talking about parallel execution (this kind of ‚Äúoptimization‚Äù is premature at the current stage of development)!  Simply, for each of the figures there are (at least) two possible variants of the move, each of which must be considered. <br><br>  It is very important that the moment of choosing a direction (let's call it a point of non-determinism) precedes the subsequent checks of the correctness of the course.  If any of the checks is not performed (for example, going off the board), the analysis of the selected option immediately stops.  We roll back to the ‚Äúpoint of non-determinism‚Äù and choose the next possible option.  In fact, this is the well-known " <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA_%25D1%2581_%25D0%25B2%25D0%25BE%25D0%25B7%25D0%25B2%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D0%25BC">search with return</a> " algorithm expressed in the most declarative form.  Similarly, for example, <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D0%25B3%25D1%2583%25D0%25BB%25D1%258F%25D1%2580%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25B2%25D1%258B%25D1%2580%25D0%25B0%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">regular expressions</a> can be interpreted. <br><br>  The <b>any</b> form is not the only source of non-determinism in the game description.  In checkers, several takeings can be performed "along the chain" (moreover, if the continuation of the capture is possible, it should be performed).  Here is how it looks in code: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">move</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> true (<span class="hljs-name"><span class="hljs-name">let</span></span> dir (<span class="hljs-name"><span class="hljs-name">any</span></span> nw ne sw se)) (<span class="hljs-name"><span class="hljs-name">check</span></span> dir) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-enemy?) (<span class="hljs-name"><span class="hljs-name">capture</span></span>) (<span class="hljs-name"><span class="hljs-name">check</span></span> dir) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) (<span class="hljs-name"><span class="hljs-name">end-move</span></span>) ) )</code> </pre><br>  Do not be confused by the "infinite" cycle!  It will be interrupted by any of the check-checks (along with the analysis of the corresponding course option), if the relevant conditions are violated.  This code is a bit more complicated than the previous one, but to understand it is quite realistic.  Here is what is done (in steps) in each iteration of the loop: <br><br><ol><li>  We select one of the four directions (already known to us by the <b>any</b> operator) and save it to a variable </li><li>  We are moving in the chosen direction (provided that this is possible) </li><li>  On the field where we moved, there must be an enemy figure (otherwise we interrupt everything)! </li><li>  Take the figure (now we are not considering measures to counter the " <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2583%25D1%2580%25D0%25B5%25D1%2586%25D0%25BA%25D0%25B8%25D0%25B9_%25D1%2583%25D0%25B4%25D0%25B0%25D1%2580">Turkish strike</a> ") </li><li>  And we continue to move in the same direction (checking what is where to go) </li><li>  Target cell must be empty! </li><li>  ... </li></ol><br>  Then the magic begins.  The <b>end-move</b> form says that in this place the move <b>can be</b> completed, and the (infinite) cycle requires moving on!  In fact, this is equivalent to the execution of the following pseudocode, in which the familiar <b>any</b> again comes out into the arena: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">any</span></span> true false) (<span class="hljs-name"><span class="hljs-name">execute</span></span> post-actions) (<span class="hljs-name"><span class="hljs-name">generate-move</span></span>) )</code> </pre><br>  Moreover, <b>any is</b> so universal that, with its help, you can rewrite another participant of the performance, who still remained in the shadows.  Here is what pseudo-code equivalent to the <b>check</b> statement looks like: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">not</span></span> &lt;condition&gt;) (<span class="hljs-name"><span class="hljs-name">any</span></span>) )</code> </pre><br>  Choosing a variant without the possibility of choice is an excellent metaphor for completing any sorting.  Of course, this does not mean that <b>check</b> will be implemented in this way, but we <b>can</b> implement it in this way! <br><br><div class="spoiler">  <b class="spoiler_title">Out of scope</b> <div class="spoiler_text">  The <b>any</b> operator has other useful applications that we will not consider at the current stage of project development.  Here is how, for example, the condition of the end of the game in <a href="">chess</a> will look like: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">game</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> chess-game) (<span class="hljs-name"><span class="hljs-name">loss</span></span> (<span class="hljs-name"><span class="hljs-name">exists</span></span>? (<span class="hljs-name"><span class="hljs-name">any</span></span> King) (<span class="hljs-name"><span class="hljs-name">if</span></span> is-friend? (<span class="hljs-name"><span class="hljs-name">check</span></span> is-attacked?) ) (<span class="hljs-name"><span class="hljs-name">check</span></span> no-moves?) ) ) )</code> </pre><br>  Intuitively, this record is understandable, and about the details of its implementation, we will not bother ourselves so far.  When we get to chess, we will do that too. <br></div></div><br>  In general, <b>what</b> to do was clear, but <b>how</b> to do it?  The operator <b>any</b> (as, however, and much more) can be implemented with the help of <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D0%25B4%25D0%25BE%25D0%25BB%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25B8%25D0%25BD%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0)">continuations</a> , but in Java there are no continuations!  For a while, I seriously thought about translating kernel development to <a href="https://ru.wikipedia.org/wiki/Scheme">Scheme</a> (in which there are not only extensions, but everything is built upon them).  When (after lengthy experimentation with screwing "extensions" to syntactic expression trees) I was already at the maximum depth of despair and was reading with <a href="http://habrahabr.ru/post/204442/">small</a> <a href="https://habrahabr.ru/users/ilammy/" class="user_link">strides</a> " <a href="http://habrahabr.ru/post/204442/">Lisp in small pieces</a> " (thanks, <a href="https://habrahabr.ru/users/ilammy/" class="user_link">ilammy</a> ), I realized that there is another way. <br><br><div class="spoiler">  <b class="spoiler_title">A little bit about dwarven bread</b> <div class="spoiler_text">  I do not know how anyone, but Scheme is very reminiscent to me of ‚Äúdwarven bread‚Äù, repeatedly mentioned in the works of <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B0%25D1%2582%25D1%2587%25D0%25B5%25D1%2582%25D1%2582,_%25D0%25A2%25D0%25B5%25D1%2580%25D1%2580%25D0%25B8">Terry Pratchett</a> .  Here is how <a href="https://ru.wikipedia.org/wiki/Nanny_Ogg%25E2%2580%2599s_Cookbook">the</a> author <a href="https://ru.wikipedia.org/wiki/Nanny_Ogg%25E2%2580%2599s_Cookbook">describes it</a> : <br><blockquote>  Dwarven bread can be used for buying and selling, for holding ceremonies - often dwarves hold the bargains together by ‚Äúbreaking bread‚Äù and some iron hammers with which they broke it are valuable works of art.  And, of course, bread is used as a weapon, which is its main purpose.  A flat round loaf of dwarf bread with a sandy crust, launched in the manner of a throwing disc, will easily decapitate the enemy and moreover, if it is properly thrown, he will return to its owner.  Less common long loaves, called baguettes, are traditionally used in hand-to-hand combat.  Uneven pellets were originally used for defensive purposes, for example, in the defense of fortress walls.  Dwarven bread can be eaten, at least by dwarves. </blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/files/238/833/906/238833906cac45e683d48e1a1dc5e753.jpg"></div><br>  I want to be understood correctly.  I <b>immensely</b> respect the language of Scheme (as well as the dwarves of my bread).  I <b>love</b> this language!  But whenever I (out of despair) are already quite seriously going to use it in a real project, I <b>suddenly</b> come up with a way to solve the problem <b>differently</b> in any other programming language that I use at that time.  Perhaps, for me personally, this is the most valuable feature of Scheme.  This language awakens the imagination! <br></div></div><br>  In general, the secret is simple.  If we consider the program as a chain of commands (with the possibility of arbitrary transfer of control to them) - the implementation of the continuations becomes obvious.  In fact, the continuation is nothing more than the address of the command, together with the saved state of all variables.  This is much simpler than what you have to deal with when using <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B1%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2581%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BA%25D1%2581%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE">AST expressions</a> . <br><br>  With the "processor" itself, there were no questions.  <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D1%2582_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">Stack machines</a> have proved their <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D1%2582_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">worth</a> more than once, and besides, I had to deal with them.  Their only drawback is that a very high qualification of the programmer is required in order to <b>constantly</b> monitor the correct order of the operands on the stack.  For me, this is not a problem, since I do not plan to open access to commands at the DSL level.  The stack machine commands will be used exclusively for <b>internal</b> representation. <br><br><div class="spoiler">  <b class="spoiler_title">Another great opportunity</b> <div class="spoiler_text">  Using the stack machine commands opens another interesting opportunity.  I already <a href="http://habrahabr.ru/post/245849/">wrote</a> that I would like to ensure compatibility with the descriptions of games in ZRF (Zillions of Games) and GDL ( <a href="http://www.cameronius.com/cv/publications/ciaig-browne-maire-19.pdf">Ludi Project</a> ) formats.  Both of these languages ‚Äã‚Äãare lis-like and I plan to use <a href="https://ru.wikipedia.org/wiki/XSLT">XSLT</a> to convert descriptions into them into my own format on the fly.  It is difficult, but quite possible. <br><br>  Alas, for <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D1452">Axiom</a> this method is not suitable.  A ForthScript machine is unlikely to be thrown into an XSLT script.  But, since I use a stack machine, what prevents me from duplicating the (well-documented) Axiom command system to load descriptions directly into the internal view, bypassing DSL?  I think the author will not mind (however, I'll ask him). <br></div></div><br>  Further - everything is simple.  Executing a chain of commands is, for the most part, a sequential pass through it into the <a href="">AbstractPorocessor</a> .  The <a href="">If</a> and <a href="">Jump</a> commands provide the ability to branch and loop.  <a href="">Any</a> is full of magic, but the implementation of <a href="">Check is</a> rather trivial.  <a href="">CommandFactory</a> provides a convenient interface for creating commands by name.  Only one thing can darken the mood.  To implement rollbacks to "points of non-determinism", it is necessary to learn how to memorize and restore the state of all variables that are changed during program execution.  Let's do this! <br><br><h4>  <b>Not ACID</b> </h4><br>  Before we proceed further, we will determine what we are going to store in memory.  The list is big, but I really need all this!  In parentheses, there is a sign of data storage, the value of which I will decipher later: <br><br><ol><li>  Placement of figures (part of the state) </li><li>  Attribute values ‚Äã‚Äãof figures (state part) </li><li>  Position attribute values ‚Äã‚Äã(state part) </li><li>  Positional values ‚Äã‚Äã(temporary) </li><li>  Values ‚Äã‚Äãof local variables (temporary) </li></ol><br>  The shape placement information is not a value (it consists of several related scalar values).  The remaining values ‚Äã‚Äãwill be typed, but their names will not be permanently associated with any particular type.  In addition, implicit type conversions will apply, whenever possible.  Currently, three types of values ‚Äã‚Äãare supported: <br><br><ul><li>  Line </li><li>  Integer </li><li>  Boolean value </li></ul><br><div class="spoiler">  <b class="spoiler_title">In fact, there are links</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">while</span></span> true (<span class="hljs-name"><span class="hljs-name">let</span></span> dir (<span class="hljs-name"><span class="hljs-name">any</span></span> ...)) (<span class="hljs-name"><span class="hljs-name">check</span></span> dir) ... )</code> </pre><br>  Here, <b>any</b> returns a string that is subsequently used to execute the navigation command (I will tell you more about how navigation is performed below).  If the value stored in <b>dir</b> is not marked as a link, <b>check</b> interprets it as a boolean (this will be 'true', because the line is not empty and not equal to ‚Äú0‚Äù) without attempting to perform any side effects related to positioning. <br></div></div><br>  Most likely, I will add support for list types (they <a href="http://habrahabr.ru/post/256701/">will be needed</a> to implement games such as <a href="http://www.iggamecenter.com/info/ru/ordo.html">Ordo</a> and <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25BE">Go</a> ).  In addition, now, I do not consider issues related to the optimization of performance and use of RAM.  If the prototype works as I plan, it will be possible, for example, to think about using bit masks to store a large number of Boolean values. <br><br><div class="spoiler">  <b class="spoiler_title">What do the marks in brackets mean?</b> <div class="spoiler_text">  It is important to understand that by ‚Äústate‚Äù I understand the information necessary to accurately restore the corresponding position on the board.  For example, placing pieces on a board is definitely part of the state.  A more complex example is the attributes of shapes.  One of the conditions for <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25BE%25D0%25BA%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0">castling</a> is the immobility of the figures involved in it during all previous moves.  Such a feature is conveniently stored in the attribute of the shape containing a boolean value.  When performing any move by a figure, we change this value, making subsequent castling impossible.  Since this information is transmitted between different positions, it is part of the state.  In a similar way, attributes associated with the entire position, and not with any particular figure, can be defined.  I will not use attributes in the current iteration, but since this is a very important element of the architecture, I implement them. <br><br>  Temporary values ‚Äã‚Äãare not part of the state and, therefore, are not transmitted between positions corresponding to different moves.  The simplest example is local variables.  We can associate some value with some name in order to use it later.  The scope of a local variable is from the place it is defined by the <b>let</b> command to the end of a chain of commands.  This explains the difference in the syntax of the <b>let</b> command from that used in Scheme. <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">seq</span></span> (<span class="hljs-name"><span class="hljs-name">let</span></span> &lt;&gt; &lt;&gt;) ... &lt;  &gt; ... )</code> </pre><br>  This is a very important point, because, when calculating a move in a <b>move</b> phrase, it should be possible to use variables declared in one of the pre-action phrases (the <b>pre</b> phrase).  Also, declared variables must remain available when performing final actions ( <b>post</b> clause).  Variables may overlap by repeated <b>let</b> declarations.  In addition, the value of a local variable can be changed using the <b>set!</b>  .  The ability to delete a variable (close its scope) is <a href="">implemented</a> at the level of the stack machine commands (to define ‚Äúhygienic‚Äù variables), but, so far, it is not supported at the DSL level. <br><br>  A more complex example of temporal data is ‚Äúpositional values.‚Äù  In some cases, it may be necessary to associate a value not just with some name, but with a certain place on the board.  For example, in games of the <a href="https://ru.wikipedia.org/wiki/%25D0%25A5%25D0%25B0%25D0%25BB%25D0%25BC%25D0%25B0">Hulma</a> family, when calculating a move, it is necessary to mark the board fields visited to avoid looping.  Upon completion of the calculation of the course, this information becomes unnecessary (and it would be too expensive to store it as part of the state).  As well as attributes, I will not use positional values ‚Äã‚Äãin the current iteration (just so as not to complicate my life).  With their help, it would be possible to implement the rule of "Turkish strike", but, in the absence of long-range ladies, it is not relevant. <br></div></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/eb1/bd7/8cd/eb1bd78cdf874089bfc37ce1cbf8848d.PNG"></div><br><br>  This diagram shows all types of storages used in calculating the course.  It does not consider data about the loaded game (such as the topology of the board).  They can be quite complex, but from the point of view of the move generator, they are constant.  All information about the placement of figures, as well as all the previously listed values, except for local variables, are stored in <b>State</b> .  Objects of the <b>State</b> type can be cloned, but only information about the state elements gets into the cloned object (positional values ‚Äã‚Äãare discarded). <br><br>  The main task of the <b>LocalEnvironment</b> is the management of local variables.  The <b>IEnvironment</b> interface provides all the necessary methods for this.  In addition, the <b>get</b> method returns the corresponding value if, instead of the variable name, a constant is passed to it (a number, a string in quotes, and <b>true</b> and <b>false</b> literals).  Values ‚Äã‚Äãcorresponding to these strings cannot be changed with the <b>set!</b>  or redefined with <b>let</b> . <br><br>  From the DSL point of view, any mention of a ‚Äúbare‚Äù name (a string without quotes) results in the execution of a <b>get</b> command.  The consequences of executing this command depend on the environment in which it is processed.  All environments are <b>chained</b> and if the <b>LocalEnvironment</b> does not know any name, it refers to the <b>StateEnvironment</b> .  This is where the fun begins.  This module provides access to ‚Äúpseudo-variables‚Äù that control navigation and provide access to information on the placement of pieces on the board. <br><br>  Here's what it looks like.  Suppose a model determines the position of a regular chessboard.  In this case, we can use the name of any position in DSL as if it were a variable name.  The value of a ‚Äúvariable‚Äù (for example, ' <b>a1</b> ') is requested in the <b>LocalEnvironment</b> , and then in the <b>StateEnvironment</b> .  This environment is associated with <b>State</b> and has complete information about all positions defined by the model.  If the requested position exists, it returns <b>true</b> , and, as a side effect, the name of the position received is stored in a variable that determines the current position in <b>State</b> .  Otherwise, <b>false is</b> returned and no side effects are performed.  Names of directions are processed in the same way (with the difference that at the time of the request, the ‚Äúcurrent position‚Äù in the <b>State</b> must be defined).  In addition to pseudo-variable navigation, <b>StateEnvironment</b> defines several more names that provide access to extremely useful information: <br><br><ul><li>  <b>position</b> - the name of the current position </li><li>  <b>is-empty?</b>  - true if current position is empty </li><li>  <b>not-empty?</b>  - false if current position is empty </li><li>  <b>is a friend</b>  - true if there is a friendly figure on the field </li><li>  <b>not-friend?</b>  - true if there is no friendly figure on the field </li><li>  <b>is-enemy?</b>  - true if there is a hostile figure on the field </li><li>  <b>not-enemy?</b>  - true if there is no hostile figure on the field </li><li>  <b>player</b> - the name of the player holding the figure located at the current position </li><li>  <b>piece</b> - the type of figure located at the current position </li></ul><br><div class="spoiler">  <b class="spoiler_title">Forms - ordinary and special</b> <div class="spoiler_text">  From what I said above, it was already possible to notice that there is a certain ‚Äúconceptual‚Äù gap between the DSL described by me and the chains of commands of the stack machine.  This is a class of <a href="https://github.com/GlukKazan/Dagaz/tree/master/src/java/model/src/main/java/com/gluk/dagaz/statements">statements</a> .  The task of each of these classes is to transform a sequence of tokens that make up a form known to it into the correct chain of commands of a stack machine (that is, code generation).  For example, <a href="">ExpressionStatement</a> processes all ‚Äúregular‚Äù forms (that is, forms that are not special).  All arithmetic expressions work this way (by the way, since arity is defined by parentheses, functions such as addition and multiplication are not limited to only two operands, and the minus may well be unary). <br><br>  Special forms implement a special order of processing operands.  Their typical representatives are <a href="">IfStatement</a> (the <b>else</b> clause is supported) and <a href="">WhileStatement</a> .  The forms of <a href="">OrStatement</a> and <a href="">AndStatement</a> are also special, because they implement the "abbreviated calculation" of logical expressions.  This is important because pseudo-variables can be used in expressions, access to which is associated with side effects. <br><br>      ( <a href="">StateStatement</a> )      ,    <b>State</b> . ,       ,  ,     (  ). ,      ,  ¬´ ¬ª,    : <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">is-empty</span></span>? n nw) (<span class="hljs-name"><span class="hljs-name">is-empty</span></span>? n ne) (<span class="hljs-name"><span class="hljs-name">is-empty</span></span>? e ne) (<span class="hljs-name"><span class="hljs-name">is-empty</span></span>? e se) (<span class="hljs-name"><span class="hljs-name">is-empty</span></span>? s se) (<span class="hljs-name"><span class="hljs-name">is-empty</span></span>? s sw) (<span class="hljs-name"><span class="hljs-name">is-empty</span></span>? w sw) (<span class="hljs-name"><span class="hljs-name">is-empty</span></span>? w nw) ) )</code> </pre><br>   , <b>is-empty?</b>   ,  . ,          (  ,   ,  ),       ,  ,        ? <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StateEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> does not know any name, it is accessed down the chain to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlayersEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The task of this environment is to clarify the relationship of the players. In the current iteration, everything is simple - if the requested player name does not match the name of the player performing the current turn, then he is the enemy. Subsequently, the logic of checks can be complicated (for example, coalitions of players will be added). Accepting the name specified in the player list, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlayerEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compares it with the name of the current player and returns </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> if there is a mismatch ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does StateEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> use this </font><font style="vertical-align: inherit;">when calculating </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is-friend?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is-enemy?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Other names processed by this environment:</font></font><br><br><ul><li> <b>current-player</b> ‚Äî  ,    </li><li> <b>next-player</b> ‚Äî  ,    </li><li> <b>turn-number</b> ‚Äî  ''  (   ‚Äî  ) </li><li> <b>turn-order</b> ‚Äî     ''  </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the requested name is not known to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlayersEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , it is even lower, but </font><font style="vertical-align: inherit;">I‚Äôm going to talk </font><font style="vertical-align: inherit;">about why </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GlobalEnvironment is</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> needed </font><font style="vertical-align: inherit;">and how it works in the next section (this is really a complex topic). Now the main thing, and where does </font></font><a href="https://ru.wikipedia.org/wiki/ACID"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? In general, absolutely nothing to do with, but I could not think of a more suitable name for the </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ITransactional</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interface </font><font style="vertical-align: inherit;">. I don't even need </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B7%25D0%25B0%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F_%2528%25D0%25B8%25D0%25BD%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0%2529"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transactions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , per se. All that is required is to be able to define savepoints and perform a full rollback of the state to them. Thus, you have to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">roll back LocalEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (the state of local variables) and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">State</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (the state of the board). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StateEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- just a wrapper over the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">State</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and does not own any data, and the state of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlayersEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> does not change in the course of calculating the progress. </font><font style="vertical-align: inherit;">In addition, the </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> should be able to roll back the state of the data stack, but this is its internal matter.</font></font><br><br><h4> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beyond ‚ÄúTransactional‚Äù</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Above, I have already said that, according to the rules of most varieties of </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2588%25D0%25BA%25D0%25B8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checkers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , if taking is possible, it must be fulfilled (this is called taking priority). </font><font style="vertical-align: inherit;">In some variants of the game, for example, in </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D0%25B6%25D0%25B4%25D1%2583%25D0%25BD%25D0%25B0%25D1%2580%25D0%25BE%25D0%25B4%25D0%25BD%25D1%258B%25D0%25B5_%25D1%2588%25D0%25B0%25D1%2588%25D0%25BA%25D0%25B8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">International Checkers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , an even stricter rule applies (usually called the ‚Äúmajority rule‚Äù). </font><font style="vertical-align: inherit;">According to him, from all possible moves, the player must choose a move that takes the maximum number of opponent's pieces. </font><font style="vertical-align: inherit;">It is the ‚Äútaking priority‚Äù that turns checkers into a positional, strategic game. </font><font style="vertical-align: inherit;">Without it, the game </font></font><a href="http://habrahabr.ru/post/258437/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">would have been</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> much less interesting! </font><font style="vertical-align: inherit;">But how is this rule reflected in DSL?</font></font><br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">piece</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> Man) (<span class="hljs-name"><span class="hljs-name">pre</span></span> ... (<span class="hljs-name"><span class="hljs-name">let</span></span> captured <span class="hljs-number"><span class="hljs-number">0</span></span>) ) (<span class="hljs-name"><span class="hljs-name">post</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;=</span></span> max-captured captured)) (<span class="hljs-name"><span class="hljs-name">set!</span></span> max-captured captured) ... ) ... (<span class="hljs-name"><span class="hljs-name">move</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> true (<span class="hljs-name"><span class="hljs-name">let</span></span> dir (<span class="hljs-name"><span class="hljs-name">any</span></span> nw ne sw se)) ... (<span class="hljs-name"><span class="hljs-name">check</span></span> is-enemy?) (<span class="hljs-name"><span class="hljs-name">capture</span></span>) (<span class="hljs-name"><span class="hljs-name">inc!</span></span> captured) ... ) ) )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tricky check in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">post</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I call a "broken invariant".</font></font> How does he work?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, during the parsing process, a move was generated that takes one piece. The check in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">post</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was successful and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the unit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was saved to the </font><b><font style="vertical-align: inherit;">max-captured</font></b><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">. Now all moves that do not take a take will be rejected, since the condition in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will be violated. It is clear that the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max-captured</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">should be stored in a very special place. It should not be affected by any state rollbacks and, most importantly, it should be accessible to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">all</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variants of the calculated moves (almost to different realities). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GlobalEnvironment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the place. This environment does not know how to create local variables with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">let</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">, but creates global variables for any</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> request! If the variable name is not declared with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attribute</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">let</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> construction </font><font style="vertical-align: inherit;">, the variable is created automatically, when it is first used, and its value is divided </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">between the</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> various options for calculating the course. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But, in themselves, global variables are only part of the story! Usually, there is a completely different case. We find some move, taking one piece, and then, for example, continuing the chain of takes, take the second, third, fourth ... A simple check does not help here! We have to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repeat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> all the checks performed earlier, each time the global variable </font><b><font style="vertical-align: inherit;">max-captured</font></b><font style="vertical-align: inherit;"> changes.</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and reject the corresponding moves, when violations are detected. </font><font style="vertical-align: inherit;">The invariant for these moves was </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performed</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> at the time of their generation, but was </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">broken by</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> changing </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max-captured</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">This is a really tricky place and I‚Äôm not sure yet that it works. </font><font style="vertical-align: inherit;">To manage all this "magic" should </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MoveGenerator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moves - partial and not very</font></font></b> <div class="spoiler_text">       ,     ,        ZoG.  ,     ZSG-.  ,   ,    <b></b>  ,  . ,  .     ,  ,     .  ,   . Axiom    <a href="http://www.zillions-of-games.com/progsample.html">DLL Engine</a>      ,        ZSG.   , ,  , ,   ,        (  ),       ,    .      . <br><br>    ZoG ‚Äî  .    ,    ( ),    ¬´¬ª .       .   ,   .     . ,   (      ,     )  <a href="http://habrahabr.ru/post/254947/"></a>        .    ,  ,    . <br><br>  Dagaz    !  ,         <b></b>  .    , ,    ,    <b>IState</b> ,           .     . ,   <b></b>    .        DSL.  <b>log</b>     (   ,     ,     ).  <a href="">MoveLogger</a>    ,   <b>ITransactional</b> . <br><br>      . ,     ,   (      ,  ).   ,      (   ,        ). ,       ,       (          ,  ).  ,   AI    . <br><br> ,     .  ZoG,     ,       . ,   ,      ,    .  , ,  ,      .  Dagaz        <b>take</b> ,  <b></b>  ¬´ ¬ª    ,    <b>drop</b> .  ,    <b>cascade</b> , <b>from</b>  <b>to</b> ,       ,       (,   ).  (   ),       ¬´  ¬ª (      <a href="http://www.iggamecenter.com/info/ru/ordo.html"></a> , <a href="http://www.iggamecenter.com/info/ru/bashni.html"> </a> , <a href="http://www.iggamecenter.com/info/ru/tavreli.html"></a>  .). <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, well, with the "rule of the majority" figured out (I hope that all this will really work), but what about other options for games? In some of them, it is not required to take the maximum number of pieces, only the capture itself is mandatory (the exception is ‚ÄúOssetian checkers‚Äù, in which the priority of capture does not work). The ‚Äúmajority rule‚Äù itself is also understood in very </font></font><a href="http://habrahabr.ru/post/253397/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">different ways</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sometimes it is required to take the greatest number of ladies (if there is such an opportunity), in other cases, the taking of the lady is the priority. All this can be described in terms of ‚Äúbroken invariants‚Äù, but there is a more subtle point. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In almost all games of the family of checkers (from among the traditional games, the only exception is </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B0%25D0%25BD%25D0%25BE%25D1%2580%25D0%25BE%25D0%25BD%25D0%25B0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fanoron</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"), starting the chain of taking, the player must go through to the end! At the same time, for example, in </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D1%2583%25D1%2581%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B5_%25D1%2588%25D0%25B0%25D1%2588%25D0%25BA%25D0%25B8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Russian Checkers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , you do not need to take the maximum number of pieces. This is a more complicated restriction than a simple" majority rule "(in any case, until I came up with how to express it through a ‚Äúbroken invariant") and another type of deferred check will be used for it. The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no-moves</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> predicate </font><font style="vertical-align: inherit;">will check if there are no possible continuations. If the continuation is detected, the previous (shorter) variant of the move will be canceled. I will not to occupy </font><font style="vertical-align: inherit;">I implementation of this predicate in the current iteration.</font></font><br><br><h4> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About unit tests</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main thing you need to know about unit tests is that unit tests help! No, seriously, I am not a supporter of the </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BA%25D0%25B0_%25D1%2587%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> methodology </font><font style="vertical-align: inherit;">, but the usefulness of the unit tests themselves, it is in this project, it is difficult to overestimate! Here (so far) there is no database or any network components (respectively, one does not have to wrestle with mock-wrappers for them), but the project itself is rather complicated. The idea that you can simply write it from scratch, run it </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entirely</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and debug it in this form - it scares me. Unit tests help to perform this debugging in parts, starting with simple things, like a system of </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commands</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , going higher and higher to more complex </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concepts.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This approach really works! In the process of writing tests, I have already found and corrected several serious errors. Similar corrections, at the stage of debugging the entire project, would have cost me much more.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When moving to a higher layer, unit tests give confidence (sometimes false, but it all depends on the coverage) that all underlying layers work as intended. </font><font style="vertical-align: inherit;">Moreover, if something seriously changes in the project (and this happens), unit tests immediately signal what and how it fell apart. </font><font style="vertical-align: inherit;">In a sense, unit-tests document the project's API (this of course does not cancel the usual documentation), while focusing on the most delicate and complex cases. </font><font style="vertical-align: inherit;">In general, at the moment, I am working on unit tests and intend to continue moving in this direction until it is possible (up to the moment when the goal of the first iteration of the project itself becomes one of the tests). </font><font style="vertical-align: inherit;">This is half the way and I hope to go all the way.</font></font></div><p>Source: <a href="https://habr.com/ru/post/270033/">https://habr.com/ru/post/270033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270017/index.html">Michael Stonebreaker - Hadoop at the Crossroads</a></li>
<li><a href="../270019/index.html">Vivaldi Beta 1.0 browser release</a></li>
<li><a href="../270023/index.html">Introduction to RxJava: Key Types</a></li>
<li><a href="../270027/index.html">Why ‚Äúerrors are meanings‚Äù in Go</a></li>
<li><a href="../270031/index.html">NSNJSON. ÈÅì (Final article)</a></li>
<li><a href="../270039/index.html">Creating Gesture Recognition Web Applications with the Intel RealSense SDK</a></li>
<li><a href="../270041/index.html">Run iOS applications from the console on the device and simulator</a></li>
<li><a href="../270045/index.html">Office as Platform: publish the SharePoint application in the Office Store</a></li>
<li><a href="../270047/index.html">Idea for handling errors in Go</a></li>
<li><a href="../270049/index.html">Retrieving deleted data in iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>