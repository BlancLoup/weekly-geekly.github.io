<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Leaflet 1.xx vs Openlayers 4.xx Part 2. How maps are drawn</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article, I promised that this would be about communities and plugins, but then I decided that it would be better to first talk about how m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Leaflet 1.xx vs Openlayers 4.xx Part 2. How maps are drawn</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://habrahabr.ru/post/331796/">last</a> article, I promised that this would be about communities and plugins, but then I decided that it would be better to first talk about how maps are drawn in these frameworks.  I'll start with Openlayers, then Leaflet, then its plugins. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/75b/895/29e/75b89529eeb7416b829a613b25491cd3.png" alt="image"></div><a name="habracut"></a><br>  At first, the common and the banal: when the user acts, both frameworks change the internal state of the card (or the internal state changes itself from callback or by timer), and it already gives the command to redraw. <br><br><h3>  How to draw openlayers </h3><br>  Openlayers uses two drawing options ‚Äî Canvas and WebGL (the DOM render for tiles and images has been removed from the current 3rd version).  The map component creates a div in which these two renders work.  A strongly simplified sequence of calls is something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  The renderFrame function is called in the map component. </li><li>  The layers that are visible at this scale are determined. </li><li>  Each of the visible layers draws its own image.  In addition to dividing into driver types (canvas and webgl), then renders are also divided by layer types (ol.renderer.canvas.TileLayer, ol.renderer.canvas.VectorLayer, etc.). </li><li>  Transparency, transformations and cutting (clip, if any) are added to the resulting layer images and they are all drawn in the general context of the map. </li></ol><br>  Both renders work well, however, if you switch to webgl, you should remember that resources (for example, tile images) will need to be started via a proxy, otherwise you will receive: <blockquote>  Uncaught DOMException: Failed to execute 'texImage2D' on 'WebGLRenderingContext': The cross-origin image at may not be loaded. </blockquote><br>  If the server supports cross-origin, and still gives an error, put in the settings of the image source, <i>crossOrigin: 'anonymous'</i> <br><br><h3>  How to draw a leaflet </h3><br>  To begin with, here is a <a href="http://leafletjs.com/examples/extending/class-diagram.html">good class diagram</a> , which is displayed again through leaflet. <br>  A drawing leaflet creates several panels (Pane), which are DOM elements (div) that layers already work with. <br><table><thead><tr><th>  Title </th><th>  Description </th><th>  zIndex </th></tr></thead><tbody><tr><td>  mapPane </td><td>  the main panel contains all the rest </td><td>  auto </td></tr><tr><td>  tilePane </td><td>  tile panel </td><td>  200 </td></tr><tr><td>  overlayPane </td><td>  panel for vector layers </td><td>  400 </td></tr><tr><td>  shadowPane </td><td>  shadow panel </td><td>  500 </td></tr><tr><td>  markerPane </td><td>  marker bar </td><td>  600 </td></tr><tr><td>  tooltipPane </td><td>  toolbar </td><td>  650 </td></tr><tr><td>  popupPane </td><td>  panel for appearing data on objects </td><td>  700 </td></tr></tbody></table><br>  And here is the first interesting detail, if in Openlayers the numbering by zIndex is through for all layers by default, then in Leaflet, the layers are grouped.  If you suddenly want your tile layer to ever be ‚Äúabove‚Äù vectorial, you need to either force a specific tile layer in options pane: overlay, or if all layers need pass through numbering, then put them all into one.  By the way, you can create your own pane and it doesn‚Äôt have to be inside the mapPane. <br><br>  And then the most interesting begins, if in Openlayers for all layers, the same set of renders is used, then Leaflet, each of the layers chooses how and what to draw.  For example, tile layers and ImageOverlay are drawn only by DOM elements (although plug-ins have variations on the theme of drawing tiles using WebGl and Canvas).  SVG or Canvas are used for vector layer layers; if both are supported by the browser, SVG is used by default. <br><br><h3>  Features drawing in different Leaflet plugins </h3><br>  As I said, despite the fact that Leaflet doesn‚Äôt have a webgl render out of the box, some plugins use this technology.  <a href="">Leaflet.TileLayer.GL</a> , for example, creates a canvas instead of an image of a tile that draws a Webgl render.  With this plugin, you can play with GPU performance with pixels in tiles.  Here is an example of coloring pixels in tiles in latitude: <br><br><img src="https://habrastorage.org/webt/59/d9/a6/59d9a64d46db9290512060.png"><br><br>  Or, from the same author, <a href="https://gitlab.com/IvanSanchez/Leaflet.GLMarkers">Leaflet.GLMarkers</a> allows <a href="https://gitlab.com/IvanSanchez/Leaflet.GLMarkers">you</a> to draw large volumes of points on the map (markers can be animated), although it looks crooked, especially the non-working zoom animation is annoying. <br><br><img src="https://habrastorage.org/webt/59/d9/aa/59d9aa79ac685788162211.gif"><br><br>  There are severe cases of plug-ins, which are served by serious companies.  For example, <a href="https://github.com/Esri/esri-leaflet">esri-leaflet</a> in DynamicMapLayer with each refresh creates a new layer ImageOverlay, and creates it when the corresponding image is loaded, i.e.  The order of the layers on the map is constantly mixed, it is impossible to work with z-index.  Your humble servant even had to make <a href="https://github.com/SVoyt/esri-leaflet-dynamic-advanced">an improved version of this layer</a> , also there is a transition through the 180 meridian, which is not in the original plugin. <br><br>  Another common problem: different plug-in support for 2 main leaflet versions - 0.7 and 1.0.  There are a lot of critical changes between them, and plugins may not work in a specific version.  It also happens this way: one plug-in works only in version 1.0, and the other plugin we need is not updated by the author or has completely scored on his service (although now there are less and less) and it works only under the old one. <br><br>  In short, the main problem of drawing a leaflet is that every plugin does everything as it pleases, someone creates an html img, someone paints on a canvas, someone webgl paints a canvas on a tile, and so on.  And further work with this in the complex becomes problematic. <br><br>  PS: The next article will be about the sources of map data and the possibilities of working with them in each of the frameworks, as well as the final conclusions about which framework to choose in your case. </div><p>Source: <a href="https://habr.com/ru/post/334676/">https://habr.com/ru/post/334676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334666/index.html">Generation of documents. Problems and Solutions</a></li>
<li><a href="../334668/index.html">Thematic modeling with BigARTM</a></li>
<li><a href="../334670/index.html">Math pack for Android - "Micro-Math" - now open source</a></li>
<li><a href="../334672/index.html">JetBrains MPS for those interested # 3</a></li>
<li><a href="../334674/index.html">How not to distract yourself from work. Tips and slak bot</a></li>
<li><a href="../334678/index.html">Writing a bot for Slack in Python</a></li>
<li><a href="../334680/index.html">Apache Curator for Apache Zookeeper features overview</a></li>
<li><a href="../334682/index.html">Rapid deployment containers</a></li>
<li><a href="../334684/index.html">Juniper Node Slicing and Universal Chassis</a></li>
<li><a href="../334688/index.html">Flash is dead: who's next?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>