<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pautomount is a daemon for automatic mounting, running scripts and all such other things.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There was a task in front of me - to automatically perform an action when inserting some storage device in Debian. For example, just automatically mou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pautomount is a daemon for automatic mounting, running scripts and all such other things.</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6a6/b06/06a/6a6b0606ad0fe3efa8fca3819d840631.jpg" alt="image"><br><br>  There was a task in front of me - to automatically perform an action when inserting some storage device in Debian.  For example, just automatically mount it.  Or maybe mount and sync data if the device is known.  Or maybe check his clamav for all garbage and run something like a USB vaccine on it.  Maybe turn on the siren, if the owner is not near the computer =) <br><br>  For example, I have flash drives, pieces that way 5-7.  Each one has something different, one boot, one with documents, one with programs, one with music and photos ... And there is a server at home, on which there are all-all copies of what is on flash drives.  I would like the documents to be synchronized with one flash drive, the other with music and photos, the third with boot images, and so on.  Only now you need to automatically start this business somehow, because it doesn‚Äôt work every time through SSH to climb the server and edit everything with handles.  Therefore, you need something, where it would be possible to register flash drives and specify the actions needed when connecting.  And there once the synchronization script was written - and it‚Äôs done. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Only here nothing ready and completely suitable in Google was found.  Some solutions pull a bunch of dependencies behind them and are not designed for a headless installation, some are outdated, some do not have all the necessary functionality, and some allow you to do this, only now it‚Äôs too dreary, it‚Äôs difficult to tune, and in general, NIH ;-) the auto-mount daemon, well, I post it here, maybe it will be useful to someone else, maybe the same home server owner, who just wants to sync flash drives with a home NAS.  Yes, and I want someone to criticize the code, pointed out the errors and suggested solutions to some problems - look at the end of the topic. <br><a name="habracut"></a><br><br>  I had an iPod somehow.  Sometimes it was necessary to charge it from a computer with Linux.  But as soon as you connect it to the computer, it immediately turns on the synchronization mode.  In order for it to stop charging, you need either a hardware solution (a USB daddy adapter with specially closed contacts), or to perform eject / dev / sdx1, which turns off synchronization mode and places it in charge mode.  Accordingly, you need to execute this command every time - soldering the adapter is so lazy ... then such a script was born - umipod.sh: (UnMount-iPOD) <br><br><div class="spoiler">  <b class="spoiler_title">umipod.sh</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #Intended to run in background and eject device specified by UUID if plugged # in.Check is performed every N seconds where N variable is set in script # header part. N=10 #Yes, this is delay between checks, best recommended is 10 seconds # which is just N=10. UUID="4C25-4DC2" BEACON="/usr/local/bin/umipod/a.flg" if [[ $1 = "-a" ]] then touch $BEACON echo "Mounting temporarily allowed" exit 0 fi if [[ $1 = "-d" ]] then rm -f $BEACON echo "Device will be ejected " exit 0 fi while [ true ] do if [[ ! -e $BEACON &amp;&amp; -e /dev/disk/by-uuid/$UUID ]] then DEVPART=`blkid -U $UUID` eject $DEVPART echo "Device ejected" fi sleep $N done</span></span></code> </pre> </div></div><br><br>  I strongly ask you not to spit on the quality of the code, it was written two years ago, and further there will be a lot of code in the article - save saliva =) The essence is simple - we check in the loop whether the device is connected with a specific UUID, if yes, then find out which block device eject'it and do it.  I connected the player to the computer, after a couple of seconds it automatically turns off, but continues to charge - you can continue listening to music.  It was quite convenient ... Until I lost the player = (Since then, the need for such a device has almost disappeared. <br><br>  And now I ran into some tasks that require automatic actions when connecting media.  So I decided to fix it, but now I don‚Äôt even come close to Bash =) I didn‚Äôt have to choose a programming language for a long time - and, frankly, I‚Äôm only in Python lately.  Then I had to think whether to write a daemon, which in the loop checks if new, still raw partitions appeared, or to cling via udev, so that the program could be called as a callback when connecting any USB flash drive.  The second option seems to consume less resources - but the first does not depend on udev and is simpler =) Therefore, I decided to write a demon that can be easily put into autorun. <br><br>  Actually, <a href="https://github.com/CRImier/pautomount">here it is</a> .  It will be easiest to tell about the device and its capabilities, describing how to configure it.  But still briefly describe the principle of operation: <br><br><ol><li>  The daemon checks / dev / disk / by-uuid every n seconds, then compiles a list of available partitions from there </li><li>  This list is compared with a list made n seconds before that, sections are defined that were not there before </li><li>  If there are newly connected sections, it is determined by the entries from the config file which section to ignore, and for which section to perform some action. </li><li>  GOTO 1 </li></ol><br><br>  Next - already requires a description of the config =) The config usually consists of four sections, any of which can be skipped painlessly. <br><br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"globals"</span></span>: { <span class="hljs-string"><span class="hljs-string">"interval"</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"debug"</span></span>:false, <span class="hljs-string"><span class="hljs-string">"noexecute"</span></span>:true, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"Everything that is in this section will be exported as a global variable in the script, replacing if there's something to replace."</span></span> }, <span class="hljs-string"><span class="hljs-string">"exceptions"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"ceb62844-7cc8-4dcc-8127-105253a081fc"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System boot partition"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"6d1a8448-10c2-4d42-b8f6-ee790a849228"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System root partition"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"9b0bb1fc-8720-4793-ab35-8a028a475d1e"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System swap partition"</span></span>} ], <span class="hljs-string"><span class="hljs-string">"rules"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"E02C8F0E2C8EDEC2"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:{<span class="hljs-string"><span class="hljs-string">"mountpoint"</span></span>:<span class="hljs-string"><span class="hljs-string">"/media/16G-DT100G2"</span></span>}}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"7F22-AD64"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:{<span class="hljs-string"><span class="hljs-string">"mountpoint"</span></span>:<span class="hljs-string"><span class="hljs-string">"/media/16G-DT100G3"</span></span>}}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"406C9EEE6C9EDE4A"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:{<span class="hljs-string"><span class="hljs-string">"mountpoint"</span></span>:<span class="hljs-string"><span class="hljs-string">"/media/80G-Music"</span></span>}}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"52663FC01BD35EA4"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:{<span class="hljs-string"><span class="hljs-string">"mountpoint"</span></span>:<span class="hljs-string"><span class="hljs-string">"/media/32G-Data"</span></span>}} ], <span class="hljs-string"><span class="hljs-string">"default"</span></span>: { <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:true, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"Configuration section for the actions that are taken if drive isn't in either exception or rule list."</span></span> } }</code> </pre><br><br><h6>  1) Section "globals" </h6><br><br>  Everything is simple here - any variable in this section is exported to the global namespace of the daemon with such a simple function: <br><br><div class="spoiler">  <b class="spoiler_title">def export_globals ():</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">export_globals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> log(<span class="hljs-string"><span class="hljs-string">"Exporting globals from config file"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> variable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> config[<span class="hljs-string"><span class="hljs-string">"globals"</span></span>].keys(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> debug: log(<span class="hljs-string"><span class="hljs-string">"Exporting variable "</span></span>+variable+<span class="hljs-string"><span class="hljs-string">" from config"</span></span>) globals()[variable] = config[<span class="hljs-string"><span class="hljs-string">"globals"</span></span>][variable]</code> </pre></div></div><br>  Simply and quickly, you do not need to make all sorts of lists of variables to export or push all the variables into the dictionary. <br><br>  <i>Useful variables:</i> <br>  <b>main_mount_dir</b> - the main mount directory, when the mount path is unknown or specified as a relative path.  The default is "/ media". <br>  <b>default_mount_option</b> - options when mounting by default when others are not specified.  I leave ‚Äúrw‚Äù there, although I‚Äôm not sure if this isn‚Äôt the default for drivers for file systems =) <br>  <b>logfile</b> - path to the log file.  If you need to change, it is better to specify the absolute - the devil knows where the logs will go, if you specify the relative =) Most likely - in \. <br>  <b>interval</b> - the interval between checks for new sections.  As for me, even an interval of one second does not load the processor in any way significantly, even on a single-core Celeron 900MHz =) <br><br>  <i>Not so useful variables:</i> <br>  <b>debug</b> - everything is clear.  Significantly speeds up the increase in the size of the log file, in real life is unlikely to need =) <br>  <b>super_debug</b> - speeds up the log file extension even more.  The probability of what is needed is even less. <br>  <b>noexecute</b> is an option that is enabled by default and in which the daemon only simulates calls to external commands ‚Äî thus, from the moment of the first launch and until the option is removed, nothing will be mounted / executed.  This is done to ensure that the daemon does not mount partitions that are already mounted using fstab prior to configuration. <br><br><h6>  2) Section "exceptions" </h6><br><br>  Any section whose UUID / Label is listed in this section will be severely ignored.  Actually, the main use case are partitions that are automatically mounted when the system is loaded from fstab.  That is, the usual entries in this section will look like this: <br><pre> <code class="python hljs"> <span class="hljs-string"><span class="hljs-string">"exceptions"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"ceb62844-7cc8-4dcc-8127-105253a081fc"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System boot partition"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"6d1a8448-10c2-4d42-b8f6-ee790a849228"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System root partition"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"9b0bb1fc-8720-4793-ab35-8a028a475d1e"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System swap partition"</span></span>} ]</code> </pre><br>  By the way, all sorts of ‚Äúcomment‚Äù type keys are naturally ignored.  Except for the key reuse trick in the dictionary, this is the only way to comment the config file in JSON format =) <br><br><h6>  3) Section "rules" </h6><br><br>  Here are the rules for special cases.  For example, here you can specify a type rule: <br><br><pre> <code class="python hljs"> {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"E02C8F0E2C8EDEC2"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:{<span class="hljs-string"><span class="hljs-string">"mountpoint"</span></span>:<span class="hljs-string"><span class="hljs-string">"/media/16G-DT100G2"</span></span>, <span class="hljs-string"><span class="hljs-string">"options"</span></span>:<span class="hljs-string"><span class="hljs-string">"rw,uid=1002,gid=1002"</span></span>}},</code> </pre><br><br>  With such a rule, the partition with the UUID E02C8F0E2C8EDEC2 will always be mounted along the path "/ media / 16G-DT100G2" using the options "rw, uid = 1002, gid = 1002". <br><br><h6>  4) Section "default" </h6><br><br>  Everything is simple - if the section does not match the entries in the two previous sections, then this section is responsible for the default action.  Usually it just contains ‚Äúmount‚Äù: true, or ‚Äúmount‚Äù: false. <br><br><h6>  rules </h6><br><br>  As you can see, in the last three sections of the rules there are two types of variables. <br>  The first type is variables to identify a specific section.  There are three types of them so far - ‚Äúuuid‚Äù, ‚Äúlabel‚Äù and ‚Äúlabel_regex‚Äù. <br><ul><li>  <b>"Uuid"</b> - everything is clear. </li><li>  <b>‚ÄúLabel‚Äù</b> - allows you to specify the label of the section, if it coincides, the action will be taken. </li><li>  <b>Label_regex</b> matches the disk label to the specified regular expression using re.match ().  At the input, naturally, a Perl-like regular expression is expected. </li></ul><br>  The second type is variables to denote action.  They are also three: <br><ul><li>  <b>‚ÄúMount‚Äù</b> can have the following values: true (automatically mount), false (do not mount), or a dictionary with additional arguments to mount (true is implied).  For now, the valid keys for the dictionary are ‚Äúmountpoint‚Äù (setting the mount point) and ‚Äúoptions‚Äù (additional options for mounting). </li><li>  <b>"Command"</b> is a string containing the path to the command to be executed.  It's all clear =) </li><li>  <b>"Script"</b> is any custom script that is called with the arguments "DEVICE_PATH UUID MOUNTPOINT LABEL".  Instead of the last two, if there is no mount point or partition label, it will be None. </li></ul><br>  Naturally, when processing the ‚Äúexceptions‚Äù section, no actions will be taken, even if specified, and identification variables will not be processed in the ‚Äúdefault‚Äù section - there is no sense =) <br><br>  I will add a couple of examples of rules in the config: <br><br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"globals"</span></span>: { <span class="hljs-string"><span class="hljs-string">"interval"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"debug"</span></span>:false, <span class="hljs-string"><span class="hljs-string">"default_mount_option"</span></span>:<span class="hljs-string"><span class="hljs-string">"noexec,noatime,rw"</span></span> }, <span class="hljs-string"><span class="hljs-string">"exceptions"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"label"</span></span>:<span class="hljs-string"><span class="hljs-string">"Root"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System boot partition"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"6d1a8448-10c2-4d42-b8f6-ee790a849228"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System root partition"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"9b0bb1fc-8720-4793-ab35-8a028a475d1e"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"System swap partition"</span></span>} ], <span class="hljs-string"><span class="hljs-string">"rules"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"label"</span></span>:<span class="hljs-string"><span class="hljs-string">"MULTISYSTEM"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:{<span class="hljs-string"><span class="hljs-string">"mountpoint"</span></span>:<span class="hljs-string"><span class="hljs-string">"/media/MULTISYSTEM"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">" ,        =( "</span></span>}}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"7F22-AD64"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:{<span class="hljs-string"><span class="hljs-string">"mountpoint"</span></span>:<span class="hljs-string"><span class="hljs-string">"/media/16G-DT100G3"</span></span>}, <span class="hljs-string"><span class="hljs-string">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"/usr/local/bin/sync_dt100g3.sh"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"uuid"</span></span>:<span class="hljs-string"><span class="hljs-string">"406C9EEE6C9EDE4A"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:{<span class="hljs-string"><span class="hljs-string">"mountpoint"</span></span>:<span class="hljs-string"><span class="hljs-string">"/media/80G-Music"</span></span>}, <span class="hljs-string"><span class="hljs-string">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"mocp --server; mocp -P"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"    "</span></span>}, {<span class="hljs-string"><span class="hljs-string">"label_regex"</span></span>:<span class="hljs-string"><span class="hljs-string">".*iPhone.*"</span></span>, <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:true, <span class="hljs-string"><span class="hljs-string">"script"</span></span>:<span class="hljs-string"><span class="hljs-string">"/usr/loca/bin/iphone_factory_restore.sh"</span></span>, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"   ;-) "</span></span>} ], <span class="hljs-string"><span class="hljs-string">"default"</span></span>: { <span class="hljs-string"><span class="hljs-string">"mount"</span></span>:false, <span class="hljs-string"><span class="hljs-string">"comment"</span></span>:<span class="hljs-string"><span class="hljs-string">"  ,    "</span></span> } }</code> </pre><br><br><h5>  What for? </h5><br><br>  In the end - what allows this demon?  In addition to helping to automatically mount partitions on connected devices, it can be used to: <br><ol><li>  Synchronize files on removable media with, for example, a home server on Linux </li><li>  Peculiar usb-modeswitch, remember the same situation with the iPod </li><li>  Virus media checks </li><li>  Merging data from someone's iPhone / Android / flash drives / cameras quietly =) </li><li>  Samba-ball creations to access media over a network </li></ol><br><br>  Now, when everything is written and fully worked out, but not yet fully polished, I have a few questions on how to improve security and conformity to the traditions of writing demons that have developed over many years. <br><br><ol><li>  Is it possible to constantly keep this demon under the root?  The problem is that you need to have the privileges to run all commands - both mount and execute external scripts, among which may be the same rsync, for example.  The security of the configuration file is from the same opera.  If the script is launched under the root, and a command is written in the config that <i>accidentally</i> erases the MBR &amp; MFT, it will be fun. </li><li>  To execute scripts and commands, definitely, in the near future, it will be necessary to make mandatory execution in the background, in a separate thread ‚Äî otherwise, any command that will work longer than a couple of seconds will stop the whole demon.  In principle, the same situation can occur when mounting.  But there is a dilemma - if you mount in the background, then the command or script can be executed before the mount, such is race condition = (I think to separate the processing of each section into a separate thread, so there will be neither race condition nor hanging, if mount hangs from for the fact that you need to fix the FS. </li><li>  Does the daemon need to go into the background itself or is it optional?  So far, it is arranged this way - the demon does not know how to leave for the background mode itself, for it it makes a start-stop-daemon in the init-script. </li><li>  How on the way to the block device (/ dev / sdxZ) the easiest and fastest way to check whether it is mounted?  Preferably using standard Python modules, well, or at most - using external commands.  Then you can get rid of the problems associated with double mounting of the same partition.  Parse the mtab and compare the UUID with the paths to the block devices - the task is still that ;-) </li><li>  Should I generate an exception list from fstab before the first run, or can I rely on a user who handles it once? </li><li>  When launching external scripts, you should keep in mind possible special characters in the partition label, such as <i>accidentally</i> getting there "&amp;&amp; rm -rf /" (it will work when you run an external script) and "../../etc/" (can mount a section instead of "/ etc ") ;-) Question - what special characters need to be filtered to fully protect this hole?  Immediately come to mind "&amp;", "/" and ";", but there may be more. </li></ol><br><br>  <a href="https://github.com/CRImier/pautomount">Github</a> <br>  By the way, this article can be considered a continuation of what I promised, but for almost a year now, as a stopped <a href="http://habrahabr.ru/post/188108/">course of articles on setting up your portable server, using Debian.</a>  I was going to do something in the framework of the implementation of my file server, but only then I could not find a ready-made solution ... And now I wrote my own =) In the near future I think to write a couple more articles that fit the subject of this course. </div><p>Source: <a href="https://habr.com/ru/post/220301/">https://habr.com/ru/post/220301/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220291/index.html">J: programming on emoticons</a></li>
<li><a href="../220293/index.html">The release of the library libGDX 1.0</a></li>
<li><a href="../220295/index.html">Bootstrap Dropdown Menus Enhancement v3.1.1</a></li>
<li><a href="../220297/index.html">Library for sharing events, data and tasks between browser tabs</a></li>
<li><a href="../220299/index.html">Marionette.js. Drag & Drop sorting models in the collection</a></li>
<li><a href="../220305/index.html">A small story from the author of the most popular photos in the world</a></li>
<li><a href="../220307/index.html">The collective blog of the inhabitants of Silicon Valley and Hackercast</a></li>
<li><a href="../220309/index.html">Add support for Windows mount balloon in Android</a></li>
<li><a href="../220315/index.html">Amazon will go to the smartphone market, Unity to analytics, and Candy Crush Saga to China - the main mobile news of the week</a></li>
<li><a href="../220319/index.html">What showed tests of new flash-storage EMC XtremIO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>