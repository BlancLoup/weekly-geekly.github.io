<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fast course Redux + websockets for backend</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello from 2018! The original react-redux-universal-hot-example ceased development in 2017, but it can be assembled on version 6.14.2, there will be e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fast course Redux + websockets for backend</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  Hello from 2018!  The original <a href="https://github.com/erikras/react-redux-universal-hot-example">react-redux-universal-hot-example</a> ceased development in 2017, but it can be assembled on version 6.14.2, there will be errors on version 8 and above.  But there is his fork <br>  <a href="https://github.com/bertho-zero/react-redux-universal-hot-example">https://github.com/bertho-zero/react-redux-universal-hot-example</a> , where development continues and more recent versions of Nodejs are supported. </blockquote><p>  This is a quick guide and training for frontened for backend.  In this guide, I solve the problem of quickly building a user interface to a server application in the form of a single-page web application (single page app). </p><br><p>  The main goal of my research is the possibility for a reasonable time (for one <del>  of normal </del>  rights) get a convenient and easy-to-use interface-draft to the server application.  We (as developers of the server part) understand that our priority is the server part.  When (in a hypothetical project) pros appear in the front, they will do everything beautifully and "correctly." </p><br><p>  In the role of an academic task, there is a chat page with some speculative "bot" that works on the server side and accepts the message only through WebSocket.  The bot thus performs an echo of your messages (we do not consider the server part here at all). </p><a name="habracut"></a><br><p>  For the presentation of the material, I need you to have: </p><br><ul><li>  Basic knowledge of javascript (here you need to search the Internet for a directory of at least js of ES-2015 standards) </li><li>  knowledge of reactjs (at the level of learning <a href="https://facebook.github.io/react/tutorial/tutorial.html"></a>  <a href="https://facebook.github.io/react/tutorial/tutorial.html">https://facebook.github.io/react/tutorial/tutorial.html</a> ) </li><li>  concept of websockets (this is very simple, the main thing is that your server can do it) </li><li>  knowledge and ability to use bootstrap (at the level of this section <a href="http://getbootstrap.com/css/"></a>  <a href="http://getbootstrap.com/css/">http://getbootstrap.com/css/</a> ) </li></ul><br><h2 id="chto-ispolzuem">  What we use </h2><br><p>  Redux - official documentation located at <a href="http://redux.js.org/"></a>  <a href="http://redux.js.org/">http://redux.js.org</a> .  In Russian there are several options, I personally used mostly <a href="https://rajdee.gitbooks.io/redux-in-russian/content/docs/introduction/index.html"></a>  <a href="https://rajdee.gitbooks.io/redux-in-russian/content/docs/introduction/index.html">https://rajdee.gitbooks.io/redux-in-russian/content/docs/introduction/index.html</a> . </p><br><p>  The exec64 article, she became the reason to write this tutorial <a href="https://exec64.co.uk/blog/websockets_with_redux/"></a>  <a href="https://exec64.co.uk/blog/websockets_with_redux/">https://exec64.co.uk/blog/websockets_with_redux/</a> . </p><br><p>  Ready server with react and redux from <a href="https://github.com/erikras/react-redux-universal-hot-example"></a>  <a href="https://github.com/erikras/react-redux-universal-hot-example">https://github.com/erikras/react-redux-universal-hot-example</a> (it saves us man-months of time for setting up a large bundle of technologies that are necessary for the modern js project) </p><br><h2 id="motivaciya">  Motivation </h2><br><p>  In general, I am developing a Python application.  Wait wait leave </p><br><p>  What I needed: </p><br><ul><li>  I need the interface implementation to not dictate to me the choice of technologies on the server side </li><li>  modern technology (I had nothing to lose or be obliged to something "old proven techniques") </li><li>  this should be a one-page application (I will choose where to update the whole page) </li><li>  I need a real-time UI response to server events </li><li>  I need server-client information exchange (not client-server) in real time </li><li>  I need the ability to generate client updates on the server </li></ul><br><p>  What has been tried: </p><br><ul><li>  variations on the subject on pure js (outdated, there are many useful models of the bike) </li><li>  Jquery ( <del>  I can no longer SO pervert so your brain </del>  the syntax is extremely difficult for a quick start and ... this is the business of professionals) </li><li>  Angular (transition to version 2 scared off and did not find a loophole in the allotted time to solve my problem) </li><li>  Socket.io (everything is implemented there, if you are a node.js programmer, you already use it, but it binds the server part too much to the node, I need only a client without third parties) </li></ul><br><p>  Selected as a result: </p><br><ul><li>  React (clear and accessible / just + babel = makes the language quite understandable) </li><li>  Redux (impressed using <del>  single garbage can </del>  single storage) </li><li>  WebSockets (very simple and does not tie hands, but allows you to use within yourself such a format as fantasy allows) </li></ul><br><h2 id="uproscheniya-i-dopuscheniya">  Simplifications and assumptions: </h2><br><ul><li>  We will not use authorization in the application. </li><li>  We will not use WebSocket authentication. </li><li>  We will use the most accessible application Websocket Echo ( <a href="https://www.websocket.org/echo.html"></a>  <a href="https://www.websocket.org/echo.html">https://www.websocket.org/echo.html</a> ) </li></ul><br><h2 id="soderzhanie">  Content </h2><br><ul><li>  Part one.  Initial setting.  Single page setup </li><li>  Part two.  Designing a future application </li><li>  Part Three  Amazing redux </li><li>  Part Four  Enliven the story </li><li>  Part Five.  Designing chat </li><li>  Part six.  Middleware </li></ul><br><h1 id="kak-chitat">  How to read </h1><br><p>  You will not repeat - skip part 1 <br>  Know reactjs - skip part 2 <br>  Know redux - skip parts 3, 4 and 5 <br>  You know how middleware works in redux - feel free to read part 6 and further in reverse order. </p><br><h1 id="chast-pervaya-pervonachalnaya-nastroyka-nastroyka-stranicy">  Part one.  Initial setting.  Customize the page. </h1><br><h2 id="nastroyka-okruzheniya">  Setting up the environment </h2><br><p>  We need node.js and npm. </p><br><p>  We put node.js from the site <a href="https://nodejs.org/"></a>  <a href="https://nodejs.org/">https://nodejs.org</a> - namely, this guide is written on the 6th version, version 7 was tested - everything works. <br>  npm is installed along with node.js </p><br><p>  Next, you need to run npm and update node.js (for windows, everything is the same without npm) </p><br><pre><code class="bash hljs">sudo npm cache clean -f sudo npm install -gn sudo n stable</code> </pre> <br><p>  check </p><br><pre> <code class="bash hljs">node -v</code> </pre> <br><h2 id="nastroyka-react-redux-universal-hot-example">  Configure react-redux-universal-hot-example </h2><br><p>  Everything is laid out in the <a href="https://github.com/erikras/react-redux-universal-hot-example">react-redux-universal-hot-example</a> , the installation instructions are also there. <br>  Here I bring a sequence of actions </p><br><ol><li>  Download and unzip the archive / forkey / whatever-as-you-like. </li><li>  Through node.js command line or terminal go to this folder </li><li>  Run </li></ol><br><pre> <code class="bash hljs">npm install npm run dev</code> </pre> <br><p>  Go to <a href="http://localhost:3000/">http: // localhost: 3000</a> and should see the start page. </p><br><p>  If everything is OK, we proceed. </p><br><h2 id="sozdaem-novyy-konteyner">  Create a new container </h2><br><p>  To configure the partition, use the help provided by the <a href="https://github.com/erikras/react-redux-universal-hot-example">react-redux-universal-hot-example</a> command.  The original article is <a href="">here</a> . </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ./src/containers &amp;&amp; mkdir ./SocketExample</code> </pre> <br><h2 id="kopiruem-tuda-hellojs-kak-shablon-stranichki">  Copy hello.js there as a page template. </h2><br><pre> <code class="bash hljs">cp About/About.js Hello/SocketExamplePage.js</code> </pre> <br><p>  I use Atom for all this, as a really great editor-anything with some goodies. </p><br><h2 id="pravim-skopirovannyy-fayl">  Rule the copied file </h2><br><p>  Create a stub under our page.  Enter the element <code>&lt;p&gt;</code> .  Later we will display the connection status in this item. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Helmet <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-helmet'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SocketExamplePage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Socket Exapmle Page</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Socket Exapmle Page"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Sockets not connected</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); } }</span></span></code> </pre> <br><h3 id="podklyuchaem-sozdannuyu-stranicu">  We connect the created page </h3><br><p>  Add in <code>./src/containers/index.js</code> new component React </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> SocketExamplePage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./SocketExample/SocketExamplePage'</span></span>;</code> </pre> <br><p>  Add to <code>./src/routes.js</code> to link the transition by <code>/socketexamplepage</code> to the link map </p><br><pre> <code class="hljs xml">... import { App, Chat, Home, Widgets, About, Login, LoginSuccess, Survey, NotFound, SocketExamplePage } from 'containers'; ... { /* Routes */ } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"about"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{About}/</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{Login}/</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"survey"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{Survey}/</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"widgets"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{Widgets}/</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"socketexamplepage"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{SocketExamplePage}/</span></span></span><span class="hljs-tag">&gt;</span></span> ...</code> </pre> <br><p>  Add to <code>./src/containers/App/App.js</code> to add an item to the menu </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinkContainer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/socketexamplepage"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">eventKey</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{99}</span></span></span><span class="hljs-tag">&gt;</span></span>Socket Example Page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NavItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinkContainer</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Check </p><br><pre> <code class="bash hljs">npm run dev</code> </pre> <br><p>  Commit: <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/69935996671fc5dd64062143526d1a00b49afcbd"></a>  <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/69935996671fc5dd64062143526d1a00b49afcbd">https://github.com/valentinmk/react-redux-universal-hot-example/commit/69935996671fc5dd64062143526d1a00b49afcbd</a> </p><br><p>  At the moment we have: </p><br><ul><li>  Web application section </li><li>  React page for our application </li><li>  Procurement to go further </li></ul><br><blockquote>  Before we begin.  I developed everything in the reverse order - first I turned the middleware, then I threw the actions, and only then I screwed up the adequate interface in reactjs.  We in the manual will do everything in the right order, because it‚Äôs really faster and easier.  The minus of my approach is that I used many times more debugging and "crutches" than I really need.  We will be rational. </blockquote><br><h1 id="chast-vtoraya-proektirovanie-buduschego-prilozheniya">  Part two.  Designing a future application </h1><br><p>  First we design the user interface.  To do this, we roughly represent what the skeleton of our interface should look like and what actions will take place in it. </p><br><p>  The React Beginner's Guide presents an approach for designing dynamic applications on React, from which we will not deviate, but will directly follow it. </p><br><p>  Dan Abramov wrote in his documentation a lot about what should be divided in the application and how to organize the structure of the application.  We will follow his example. </p><br><h2 id="itak-nachnem">  So, let's begin. </h2><br><p>  First of all, I want to say that for clarity and debugging, when writing an application, we will add elements that will be removed from the form after the work is finished. </p><br><h3 id="polzovatelskiy-interfeys-variant-1">  User Interface "Option 1" </h3><br><p>  We add two new sections to our page. </p><br><p>  In the socket connection log we will briefly display current events related to disconnecting the connection.  <code>./src/containers/SocketExample/SocketExamplePage.js</code> file. </p><br><pre> <code class="hljs xml">// inside render () { return (...) } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Socket connection log<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rows</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">readOnly</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Waiting ..."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" index = 2, loaded = true, message = Connected, connected = true index = 1, loaded = false, message = Connecting..., connected = false"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><blockquote>  index - the sequence number of the log entry <br><br>  loaded - whether the item is loaded on the user‚Äôs page <br><br>  message - variable-message for debugging and code visibility 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      connected - a sign if we are connected to the server now </blockquote><p>  Of course we forgot about the buttons and input fields, add: </p><br><ul><li>  connect to websocket </li><li>  disconnect from websocket </li></ul><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary btn-sm"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fa fa-sign-in"</span></span></span><span class="hljs-tag">/&gt;</span></span> Connect <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-danger btn-sm"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fa fa-sign-out"</span></span></span><span class="hljs-tag">/&gt;</span></span> Disconnect <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  In the message log we will display the sent <code>-&gt;</code> and received messages <code>&lt;-</code> . </p><br><pre> <code class="hljs xml">// inside render () { return (...) } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Message log<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"unstyled"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"glyphicon glyphicon-arrow-right"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> Socket string <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"unstyled"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"glyphicon glyphicon-arrow-left"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> [ECHO] Socket string <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Button and input for send message </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-inline"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control input-sm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"message_text"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary btn-sm"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fa fa-sign-in"</span></span></span><span class="hljs-tag">/&gt;</span></span> Send <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><blockquote>  Do not press the Send button. </blockquote><p>  We check and commit to get the full code. </p><br><p>  Commit: <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/510a59f732a9bf42e070e7f57e970a2307661739"></a>  <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/510a59f732a9bf42e070e7f57e970a2307661739">https://github.com/valentinmk/react-redux-universal-hot-example/commit/510a59f732a9bf42e070e7f57e970a2307661739</a> </p><br><h3 id="polzovatelskiy-interfeys-variant-2-komponenty">  User Interface Option 2. Components. </h3><br><p>  Let's divide everything into components.  Nothing complicated. </p><br><p>  Create a new folder in the directory <code>./src/components</code> call it <code>SocketExampleComponents</code> . </p><br><p>  Adding a component occurs in three steps: </p><br><p>  1 - create a file with a component in our <code>SocketConnectionLog.js</code> folder </p><br><blockquote>  we wrap the contents of the component in the div as React expects from us </blockquote><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">React</span></span>, {<span class="hljs-type"><span class="hljs-type">Component</span></span>} from <span class="hljs-symbol"><span class="hljs-symbol">'reac</span></span>t'; export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SocketConnectionLog</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div&gt; &lt;h3&gt;<span class="hljs-type"><span class="hljs-type">Socket</span></span> connection log&lt;/h3&gt; &lt;textarea className=<span class="hljs-string"><span class="hljs-string">"form-control"</span></span> rows=<span class="hljs-string"><span class="hljs-string">"1"</span></span> readOnly placeholder=<span class="hljs-string"><span class="hljs-string">"Waiting ..."</span></span> value=<span class="hljs-string"><span class="hljs-string">" index = 2, loaded = true, message = Connected, connected = true index = 1, loaded = false, message = Connecting..., connected = false"</span></span>/&gt; &lt;button className=<span class="hljs-string"><span class="hljs-string">"btn btn-primary btn-sm"</span></span>&gt; &lt;i className=<span class="hljs-string"><span class="hljs-string">"fa fa-sign-in"</span></span>/&gt; <span class="hljs-type"><span class="hljs-type">Connect</span></span> &lt;/button&gt; &lt;button className=<span class="hljs-string"><span class="hljs-string">"btn btn-danger btn-sm"</span></span>&gt; &lt;i className=<span class="hljs-string"><span class="hljs-string">"fa fa-sign-out"</span></span>/&gt; <span class="hljs-type"><span class="hljs-type">Disconnect</span></span> &lt;/button&gt; &lt;/div&gt; ); } }</code> </pre> <br><p>  2 - we register our new component in the <code>components/index.js</code> </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> SocketConnectionLog <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./SocketExampleComponents/SocketConnectionLog'</span></span>;</code> </pre> <br><p>  3 - we rule our page <code>./src/components/SocketExamplePage.js</code> and instead of the code copied by us we <code>./src/components/SocketExamplePage.js</code> only one element </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {SocketConnectionLog} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... &lt;SocketConnectionLog /&gt;</span></span></code> </pre> <br><p>  Add another new component to the same folder <code>./src/components/SocketExampleComponents</code> . </p><br><p>  Add in three steps </p><br><p>  1 - create a file with a component in our <code>SocketMessageLog.js</code> folder </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SocketMessageLog</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Message log</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"unstyled"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"glyphicon glyphicon-arrow-right"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Socket string </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"unstyled"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"glyphicon glyphicon-arrow-left"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> [ECHO] Socket string </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"form-inline"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"form-control input-sm"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"message_text"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary btn-sm"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"fa fa-sign-in"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> Send </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); } }</span></span></code> </pre> <br><p>  2 - we register our new component in the <code>./src/components/index.js</code> file </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> SocketMessageLog <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./SocketExampleComponents/SocketMessageLog'</span></span>;</code> </pre> <br><p>  3 - we rule our page and instead of the code copied by us we interpose only one element </p><br><pre> <code class="hljs coffeescript"><span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {SocketMessageLog} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components'</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ... &lt;SocketMessageLog/&gt;</code> </pre> <br><p>  We are checking.  Nothing has changed and this is a success. </p><br><p>  Commit: <br><a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/97a6526020a549f2ddf91370ac70dbc0737f167b"></a>  <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/97a6526020a549f2ddf91370ac70dbc0737f167b">https://github.com/valentinmk/react-redux-universal-hot-example/commit/97a6526020a549f2ddf91370ac70dbc0737f167b</a> </p><br><p>  We finish 2 part. </p><br><h1 id="chast-tretya-izumitelnyy-redux">  Part Three  Amazing redux </h1><br><p>  Go straight to Redux. </p><br><p>  For this you need: </p><br><ol><li>  Create a reducer </li><li>  Create actions </li><li>  And connect all this to a common system. </li></ol><br><blockquote>  About actions written <a href="http://redux.js.org/docs/basics/Actions.html">in the official documentation</a> <br>  About reduser written <a href="http://redux.js.org/docs/basics/Reducers.html">there</a> </blockquote><br><h3 id="sozdaem-fayl">  Create a file </h3><br><p>  Create a file <code>./src/redux/modules/socketexamplemodule.js</code> and fill it with basic actions and reducers.  Here is a basic example, there is a strange discrepancy, everything is proposed to be written in one file, without dividing actions and reducers into a file, well, let's say.  All the same - we are all adults here (we are all adults). </p><br><h3 id="eksheny-1">  Action 1 </h3><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_CONNECTING = <span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECTING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_DISCONNECTING = <span class="hljs-string"><span class="hljs-string">'SOCKETS_DISCONNECTING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_MESSAGE_SENDING = <span class="hljs-string"><span class="hljs-string">'SOCKETS_MESSAGE_SENDING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_MESSAGE_RECEIVING = <span class="hljs-string"><span class="hljs-string">'SOCKETS_MESSAGE_RECEIVING'</span></span>;</code> </pre> <br><p>  We will launch all <code>SOCKETS_MESSAGE_RECEIVING</code> by pressing the buttons, except for the <code>SOCKETS_MESSAGE_RECEIVING</code> event, which we will synthetically call after sending the message.  This is done in order to emulate in the development process the currently missing (or at a specific stage) functionality of the server part of the application. </p><br><h3 id="redyuser">  Reducer </h3><br><p>  Add to the same file. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action = {}</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SOCKETS_CONNECTING: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, state, { <span class="hljs-attr"><span class="hljs-attr">loaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">message</span></span>: <span class="hljs-string"><span class="hljs-string">'Connecting...'</span></span>, <span class="hljs-attr"><span class="hljs-attr">connected</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SOCKETS_DISCONNECTING: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, state, { <span class="hljs-attr"><span class="hljs-attr">loaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">message</span></span>: <span class="hljs-string"><span class="hljs-string">'Disconnecting...'</span></span>, <span class="hljs-attr"><span class="hljs-attr">connected</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SOCKETS_MESSAGE_SENDING: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, state, { <span class="hljs-attr"><span class="hljs-attr">loaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">message</span></span>: <span class="hljs-string"><span class="hljs-string">'Send message'</span></span>, <span class="hljs-attr"><span class="hljs-attr">connected</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SOCKETS_MESSAGE_RECEIVING: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, state, { <span class="hljs-attr"><span class="hljs-attr">loaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">message</span></span>: <span class="hljs-string"><span class="hljs-string">'Message receive'</span></span>, <span class="hljs-attr"><span class="hljs-attr">connected</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br><p>  More details about the structure of the reducer and why <code>Object.assign({}, state,{});</code>  can be read <a href="http://redux.js.org/docs/basics/Reducers.html">here</a> . </p><br><p>  You noticed the initialization state = initialState, which we did not declare (put ESLint or its analogue - greatly simplify the life of a Normal Person).  Add an announcement to the reducer.  This will be the first state that we will have in our Side when the page loads, or rather the page will be loaded with this initial state. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { loaded: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Just created'</span></span>, connected: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, };</code> </pre> <br><h3 id="eksheny-2">  Action 2 </h3><br><p>  Now we‚Äôll continue with our actions and complete this module.  We must describe how they will change the state of the reducer. </p><br><p>  Add to the same file. </p><br><pre> <code class="hljs lua">export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsConnecting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_CONNECTING}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsDisconnecting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_DISCONNECTING}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsMessageSending</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_MESSAGE_SENDING}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsMessageReceiving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_MESSAGE_RECEIVING}; }</code> </pre> <br><h3 id="podklyuchaem-v-obschiy-redyuser">  We connect to a common reducer </h3><br><p>  At the moment, nothing will change in the application.  We include our module in the general designer of reducer'ov. </p><br><p>  In the file <code>./src/redux/modules/reducer.js</code> prescribe the module. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socketexample <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./socketexamplemodule'</span></span>;</code> </pre> <br><p>  and include it in the general structure of the resultant reducer </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">export</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">combineReducers</span></span>({ <span class="hljs-attribute"><span class="hljs-attribute">routing</span></span>: routerReducer, reduxAsyncConnect, auth, form, multireducer: <span class="hljs-built_in"><span class="hljs-built_in">multireducer</span></span>({ counter1: counter, counter2: counter, counter3: counter }), info, pagination, widgets, // our hero socketexample });</code> </pre> <br><p>  We start the server, check and cheer in DevTools we see. </p><br><p><img src="https://habrastorage.org/files/e0f/4f4/b88/e0f4f4b8851b4e2e84e2ee062a440c54.png" alt="image"></p><br><p>  If the questions with initialState remain, then try changing them or adding a new variable to it. </p><br><p>  Commit: <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/0c984e3b5bc25056aa578ee57f90895bc6baaf18"></a>  <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/0c984e3b5bc25056aa578ee57f90895bc6baaf18">https://github.com/valentinmk/react-redux-universal-hot-example/commit/0c984e3b5bc25056aa578ee57f90895bc6baaf18</a> </p><br><h3 id="stor">  Stor </h3><br><p>  And the line we have already created and the reducer in it is connected.  Do not do anything. </p><br><p>  If more, then you should remember how we added our reducer to <code>combineReducers</code> above the article.  So this <code>combineReducers</code> itself is included in the stor, which is created in the file <code>./src/redux/create.js</code> . </p><br><h2 id="podklyuchaem-stor-k-react-komponentam">  We connect the detector to react components </h2><br><p>  We connect all this now to our modules.  For a comprehensive demonstration, let‚Äôs start with the history module and make it the pure react component (in the sense of redux). </p><br><p>  We do not touch the SocketConnectionLog component yet, but go straight to the <code>SocketExamplePage</code> container. </p><br><p>  In this container, we will connect and receive data from redux. </p><br><p>  We connect the library in the file <code>./src/containers/SocketExample/SocketExamplePage.js</code> . </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>;</code> </pre> <br><p>  We take away actions so that we can use them in react. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> socketExampleActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux/modules/socketexamplemodule'</span></span>;</code> </pre> <br><p>  and we will change the string to connect PropTypes </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component, PropTypes} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>;</code> </pre> <br><p>  We write the connector, which will take the data from our reducer. </p><br><pre> <code class="hljs css">@<span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>( state =&gt; ({ <span class="hljs-selector-tag"><span class="hljs-selector-tag">loaded</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.socketexample</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.loaded</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">message</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.socketexample</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.message</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">connected</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.socketexample</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.connected</span></span>}), <span class="hljs-selector-tag"><span class="hljs-selector-tag">socketExampleActions</span></span>)</code> </pre> <br><p>  As you can see <code>state.socketexample.loaded</code> is the reference to redux, in the structure that we see in DevTools. </p><br><p>  Now we connect the verification of data obtained from redux, which seems appropriate because  Any type data check is a universal good. </p><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> propTypes = { loaded: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, connected: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> }</code> </pre> <br><p>  We got the data now let's transfer it.  Inside the render block, we declare and accept data already from props. </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {loaded, message, connected} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props;</code> </pre> <br><p>  and calmly and confidently transfer them to our module: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SocketConnectionLog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{loaded}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{message}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connected</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{connected}</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  We passed new data (via react) to the component.  Now we rewrite our component, which already knows nothing about redu (redux), but only processes the data transferred to it. </p><br><p>  In the file <code>./src/components/SocketExampleComponents/SocketConnectionLog.js</code> act according to the list: </p><br><ol><li>  check the received props </li><li>  assign them inside the render </li><li>  use in our component </li></ol><br><p>  Let's start importing the missing libraries: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component, PropTypes} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>;</code> </pre> <br><p>  add check: </p><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> propTypes = { loaded: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, connected: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> }</code> </pre> <br><p>  declare and assign variables passed through props </p><br><pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {loaded, message, connected} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props;</code> </pre> <br><p>  use our variables for output </p><br><pre> <code class="hljs coffeescript"> value={<span class="hljs-string"><span class="hljs-string">'index ='</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span> + <span class="hljs-string"><span class="hljs-string">', loaded = '</span></span> + loaded + <span class="hljs-string"><span class="hljs-string">', message = '</span></span> + message + <span class="hljs-string"><span class="hljs-string">', connected = '</span></span> + connected}<span class="hljs-regexp"><span class="hljs-regexp">/&gt; {/</span></span>* value=<span class="hljs-string"><span class="hljs-string">" index = 2, loaded = true, message = Connected, connected = true index = 1, loaded = false, message = Connecting..., connected = false"</span></span><span class="hljs-regexp"><span class="hljs-regexp">/&gt; */</span></span>}</code> </pre> <br><p>  We check and see that the initialState arrives directly from redux-&gt; react-&gt; props-&gt; props. </p><br><p>  Commit: <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/60ac05332e35dfdbc11b9415f5bf5c46cd740ba8"></a>  <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/60ac05332e35dfdbc11b9415f5bf5c46cd740ba8">https://github.com/valentinmk/react-redux-universal-hot-example/commit/60ac05332e35dfdbc11b9415f5bf5c46cd740ba8</a> </p><br><h3 id="socketexamplemessagelog">  SocketExampleMessageLog </h3><br><p>  Now we are going to the <code>SocketExampleMessageLog</code> component and make it completely independent, in the sense of working with a stor.  We will not transfer to him any props, he will receive everything he needs from the pages himself. </p><br><p>  Open the file <code>./src/components/SocketExampleComponents/SocketMessageLog.js</code> </p><br><p>  we add the necessary libraries in it </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component, PropTypes} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> socketExampleActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux/modules/socketexamplemodule'</span></span>;</code> </pre> <br><p>  add <code>connect</code> , type checking and use received data </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@connect</span></span>( state =&gt; ({ loaded: state.socketexample.loaded, message: state.socketexample.message, connected: state.socketexample.connected}), socketExampleActions) export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SocketMessageLog</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ static propTypes = { loaded: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.bool, message: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.string, connected: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.bool } <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre> <br><p>  Don't forget to pass the value to the render () method via props </p><br><pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {loaded, message, connected} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props;</code> </pre> <br><p>  We will use <code>loaded</code> and <code>connected</code> to determine the readiness for message exchange, and we will display <code>message</code> just for verification. </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"unstyled"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"glyphicon glyphicon-arrow-right"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> {message} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"unstyled"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"glyphicon glyphicon-arrow-left"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> [ECHO] {message} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  I will check the variables <code>loaded</code> and <code>connected</code> explicitly to be more transparent to (possible) children. </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-inline"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control input-sm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"message_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">readOnly</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{(loaded</span></span></span><span class="hljs-tag"> === </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">true)</span></span></span><span class="hljs-tag"> ? </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">false</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">true</span></span></span><span class="hljs-tag">}&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary btn-sm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{(connected</span></span></span><span class="hljs-tag"> === </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">true)</span></span></span><span class="hljs-tag"> ? </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">false</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">true</span></span></span><span class="hljs-tag">}&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fa fa-sign-in"</span></span></span><span class="hljs-tag">/&gt;</span></span> Send <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Halfway passed. </p><br><p>  Commit: <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/a473d6a86262f2d2b52c590974e77df9454de5a1"></a>  <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/a473d6a86262f2d2b52c590974e77df9454de5a1">https://github.com/valentinmk/react-redux-universal-hot-example/commit/a473d6a86262f2d2b52c590974e77df9454de5a1</a> . </p><br><h1 id="chast-chetvertaya-ozhivlyaem-istoriyu">  Part Four  Enliven the story </h1><br><p>  In the previous installments, we all prepared to start using the story. </p><br><p>  In this part we will connect events in react and states in the stop.  Let's start. </p><br><p>  Let's revive the connection history in our component <code>./src/components/SocketExampleComponents/SocketConnectionLog.js</code> . <br>  But as we remember, he does not know anything about the story.  This means that he does not know anything about actions and therefore he needs to pass them through the container <code>./src/containers/SocketExample/SocketExamplePage.js</code> .  Just pass them to the component as if they were simple props. </p><br><p>  In general, we connected all the functions of actions via <a href="https://habr.com/users/connect/" class="user_link">connect</a> .  Stop.  More details.  Recall. </p><br><pre> <code class="hljs coffeescript"><span class="hljs-regexp"><span class="hljs-regexp">//</span></span>.... <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> socketExampleActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux/modules/socketexamplemodule'</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>.... @connect( state =&gt; ({ loaded: state.socketexample.loaded, message: state.socketexample.message, connected: state.socketexample.connected}), socketExampleActions)</code> </pre> <br><p>  Therefore, we simply include them in the check in the <code>./src/containers/SocketExample/SocketExamplePage.js</code> file: </p><br><pre> <code class="hljs go">static propTypes = { loaded: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, connected: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, socketsConnecting: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span>, socketsDisconnecting: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span> }</code> </pre> <br><p>  and pass to our component </p><br><pre> <code class="hljs xml"> render() { const {loaded, message, connected, socketsConnecting, socketsDisconnecting} = this.props; return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Socket Exapmle Page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Socket Exapmle Page"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SocketConnectionLog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{loaded}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{message}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connected</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{connected}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connectAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{socketsConnecting}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disconnectAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{socketsDisconnecting}/</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SocketMessageLog</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ); }</code> </pre> <br><p>  Now let's ensure that devotees are accepted into the action component in the <code>./src/components/SocketExampleComponents/SocketConnectionLog.js</code> file. </p><br><p>  We will add them (actions) to the check and use them in our handlers on the form.  We will make two handlers: by clicking the "Connect" and "Disconnect" buttons. </p><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> propTypes = { loaded: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, connected: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, connectAction: PropTypes.func, disconnectAction: PropTypes.func } handleConnectButton = (<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.connectAction(); } handleDisconnectButton = (<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.disconnectAction(); }</code> </pre> <br><p>  We register the call of function handlers by pressing the corresponding buttons. </p><br><pre> <code class="hljs kotlin"> render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {loaded, message, connected} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div&gt; &lt;h3&gt;Socket connection log&lt;/h3&gt; &lt;textarea className=<span class="hljs-string"><span class="hljs-string">"form-control"</span></span> rows=<span class="hljs-string"><span class="hljs-string">"1"</span></span> readOnly placeholder=<span class="hljs-string"><span class="hljs-string">"Waiting ..."</span></span> value={<span class="hljs-string"><span class="hljs-string">'index ='</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span> + <span class="hljs-string"><span class="hljs-string">', loaded = '</span></span> + loaded + <span class="hljs-string"><span class="hljs-string">', message = '</span></span> + message + <span class="hljs-string"><span class="hljs-string">', connected = '</span></span> + connected}/&gt; {<span class="hljs-comment"><span class="hljs-comment">/* value=" index = 2, loaded = true, message = Connected, connected = true index = 1, loaded = false, message = Connecting..., connected = false"/&gt; */</span></span>} &lt;button className=<span class="hljs-string"><span class="hljs-string">"btn btn-primary btn-sm"</span></span> onClick={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleDisconnectButton}&gt; &lt;i className=<span class="hljs-string"><span class="hljs-string">"fa fa-sign-in"</span></span>/&gt; Connect &lt;/button&gt; &lt;button className=<span class="hljs-string"><span class="hljs-string">"btn btn-danger btn-sm"</span></span> onClick={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleConnectButton}&gt; &lt;i className=<span class="hljs-string"><span class="hljs-string">"fa fa-sign-out"</span></span>/&gt; Disconnect &lt;/button&gt; &lt;/div&gt; );</code> </pre> <br><p>  We start.  We are checking.  Hurray, it is alive!  You can see in DevTools that events are created in the stack. </p><br><p>  If you carefully follow how the states change, you can see that the message history component does not work as it should (although it is written correctly).  The fact is that when the connection button is clicked, our state is connected = false, and when the connection is disconnected, our state is connected = true.  Let's fix those. </p><br><p>  To do this, in the file <code>./src/redux/modules/socketexamplemodule.js</code> correct strange lines </p><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SOCKETS_CONNECTING</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">return</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.assign</span></span>({}, <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span>, { <span class="hljs-attribute"><span class="hljs-attribute">loaded</span></span>: true, message: <span class="hljs-string"><span class="hljs-string">'Connecting...'</span></span>, connected: true }); <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SOCKETS_DISCONNECTING</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">return</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.assign</span></span>({}, <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span>, { <span class="hljs-attribute"><span class="hljs-attribute">loaded</span></span>: true, message: <span class="hljs-string"><span class="hljs-string">'Disconnecting...'</span></span>, connected: false });</code> </pre> <br><p>  Well, now everything works correctly. </p><br><blockquote>  But then we will change these values ‚Äã‚Äãto the original, this is an important point.  The connection attempt event is not identical to the connected state (yes, I'm a cap). </blockquote><p>  We realize connection history.  The main limitation is the principle of operation of the store itself.  We can change the state itself, but we can recreate it entirely and assign it.  Therefore, in order to accumulate history, we will copy it, add the current state to the copy, and assign this value to the original (from which the copy was taken). </p><br><pre> <code class="hljs lua"> case SOCKETS_CONNECTING: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Object.assign({}, state, { <span class="hljs-built_in"><span class="hljs-built_in">loaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Connecting...'</span></span>, connected: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, history: [ ...state.history, { <span class="hljs-built_in"><span class="hljs-built_in">loaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Connecting...'</span></span>, connected: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ] }); case SOCKETS_DISCONNECTING: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Object.assign({}, state, { <span class="hljs-built_in"><span class="hljs-built_in">loaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Disconnecting...'</span></span>, connected: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, history: [ ...state.history, { <span class="hljs-built_in"><span class="hljs-built_in">loaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Disconnecting...'</span></span>, connected: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ] });</code> </pre> <br><p>  We do the mapping in the same element.  First of all, we pass the history variable through props in the file <code>./src/containers/SocketExample/SocketExamplePage.js</code> .  Next, in the <code>./src/components/SocketExampleComponents/SocketConnectionLog.js</code> file, <code>./src/components/SocketExampleComponents/SocketConnectionLog.js</code> accepts the passed variable. </p><br><p>  Let's <code>./src/containers/SocketExample/SocketExamplePage.js</code> in the <code>./src/containers/SocketExample/SocketExamplePage.js</code> file from the store: </p><br><pre> <code class="hljs css">@<span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>( state =&gt; ({ <span class="hljs-selector-tag"><span class="hljs-selector-tag">loaded</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.socketexample</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.loaded</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">message</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.socketexample</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.message</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">connected</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.socketexample</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.connected</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">history</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.socketexample</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.history</span></span> }), <span class="hljs-selector-tag"><span class="hljs-selector-tag">socketExampleActions</span></span>)</code> </pre> <br><p>  check for type </p><br><pre> <code class="hljs go"> static propTypes = { loaded: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, connected: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, history: PropTypes.array, socketsConnecting: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span>, socketsDisconnecting: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span> }</code> </pre> <br><p>  assign and pass </p><br><pre> <code class="hljs xml"> render() { const {loaded, message, connected, socketsConnecting, socketsDisconnecting, history} = this.props; return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Socket Exapmle Page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Socket Exapmle Page"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SocketConnectionLog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{loaded}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{message}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connected</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{connected}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connectAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{socketsConnecting}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disconnectAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{socketsDisconnecting}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">history</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{history}/</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SocketMessageLog</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> );</code> </pre> <br><p>  We already accept in the file <code>./src/components/SocketExampleComponents/SocketConnectionLog.js</code> . </p><br><pre> <code class="hljs go"> static propTypes = { loaded: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, connected: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, history: PropTypes.array, connectAction: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span>, disconnectAction: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span> }</code> </pre> <br><p>  To output the history to the log, we no longer actually need the current values ‚Äã‚Äãof <code>loaded</code> , <code>message</code> , <code>connected</code> . </p><br><p>  Let's put in history in reverse chronology, so that the actual state is always on top. </p><br><pre> <code class="hljs pgsql"> render() { const {history} = this.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div&gt; &lt;h3&gt;Socket <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>&lt;/h3&gt; &lt;textarea className="form-control" <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>="1" readOnly placeholder="Waiting ..." <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>={ history.map((historyElement, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) =&gt; <span class="hljs-string"><span class="hljs-string">'index = '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> + <span class="hljs-string"><span class="hljs-string">' loaded = '</span></span> + historyElement.loaded.toString() + <span class="hljs-string"><span class="hljs-string">' message = '</span></span> + historyElement.message.toString() + <span class="hljs-string"><span class="hljs-string">' connected = '</span></span> + historyElement.connected.toString() + <span class="hljs-string"><span class="hljs-string">' \n'</span></span>).reverse() }/&gt; &lt;button className="btn btn-primary btn-sm" onClick={this.handleConnectButton}&gt; &lt;i className="fa fa-sign-in"/&gt; <span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span> &lt;/button&gt; &lt;button className="btn btn-danger btn-sm" onClick={this.handleDisconnectButton}&gt; &lt;i className="fa fa-sign-out"/&gt; Disconnect &lt;/button&gt; &lt;/div&gt; );</code> </pre> <br><p>  The main thing is to not forget to add <code>history</code> when initializing the reducer, otherwise our checks will not work. </p><br><p>  In the <code>./src/redux/modules/socketexamplemodule.js</code> file. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { loaded: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Just created'</span></span>, connected: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, history: [] };</code> </pre> <br><p>  We are checking.  And we get our record in the history of connection, but for some reason with commas.  Javascript wtf?  Well, okay, if we add .join ("") after the map and reverse, then this all solves. </p><br><blockquote>  ".join ('') decides everything.", Karl! </blockquote><p>  What is our result?  We read and write to the store!  You can praise yourself!  But this is clearly not enough, because we do it only within our own page and do not communicate with the outside world. </p><br><p>  Commit: <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/24144226ea4c08ec1af5db3a5e9b37461be2dbdd"></a>  <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/24144226ea4c08ec1af5db3a5e9b37461be2dbdd">https://github.com/valentinmk/react-redux-universal-hot-example/commit/24144226ea4c08ec1af5db3a5e9b37461be2dbdd</a> </p><br><h1 id="chast-pyataya-proektiruem-chat">  Part Five.  Designing chat </h1><br><p>  We have a blank for connecting / disconnecting to the socket.  Now we have to make a chat shell, it will become our working model (we already have a prototype). </p><br><p>  With chat, we will perform the same actions as with the log (history) of connections - we will add chat history and teach it to display. </p><br><p>  The full cycle will look like this: </p><br><ul><li><p>  In the editor you need: </p><br><ul><li>     , </li><li>    , </li><li>      . </li></ul><br></li><li>   : <br><ul><li>   , </li><li>    , </li><li>      . </li></ul></li></ul><br><h3 id="nastroyka-redyusera">   </h3><br><p>    <code>./src/redux/modules/socketexamplemodule.js</code>   <br>   . </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { loaded: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Just created'</span></span>, connected: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, history: [], message_history: [] };</code> </pre> <br><p>      <code>SOCKETS_MESSAGE_SENDING</code>  <code>SOCKETS_MESSAGE_RECEIVING</code> .     . </p><br><p>   ,            . </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SOCKETS_MESSAGE_SENDING</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">return</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.assign</span></span>({}, <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span>, { <span class="hljs-attribute"><span class="hljs-attribute">loaded</span></span>: true, message: <span class="hljs-string"><span class="hljs-string">'Send message'</span></span>, connected: true, message_history: [ ...state.message_history, { direction: <span class="hljs-string"><span class="hljs-string">'-&gt;'</span></span>, message: action.message_send } ] }); <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SOCKETS_MESSAGE_RECEIVING</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">return</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.assign</span></span>({}, <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span>, { <span class="hljs-attribute"><span class="hljs-attribute">loaded</span></span>: true, message: <span class="hljs-string"><span class="hljs-string">'Message receive'</span></span>, connected: true, message_history: [ ...state.message_history, { direction: <span class="hljs-string"><span class="hljs-string">'&lt;-'</span></span>, message: action.message_receive } ] });</code> </pre> <br><p>      <code>action.message_receive</code>  <code>action.message_send</code> .        .     . </p><br><p>       . </p><br><pre> <code class="hljs lua">export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsMessageSending</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sendMessage)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_MESSAGE_SENDING, message_send: sendMessage}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsMessageReceiving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sendMessage)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_MESSAGE_RECEIVING, message_receive: sendMessage}; }</code> </pre> <br><p> . -              <code>sendMessage</code>  <code>sendMessage</code> .          ,           .                 . </p><br><p>               . </p><br><h3 id="nastroyka-interfeysa">   </h3><br><p>  ,        react     .         . </p><br><p>   ,        <code>./src/components/SocketExampleComponents/SocketMessageLog.js</code> . </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@connect</span></span>( state =&gt; ({ loaded: state.socketexample.loaded, message: state.socketexample.message, connected: state.socketexample.connected, message_history: state.socketexample.message_history }), socketExampleActions) export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SocketMessageLog</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ static propTypes = { loaded: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.bool, message: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.string, connected: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.bool, message_history: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.array, socketsMessageSending: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.func }</code> </pre> <br><p>    ,       . </p><br><pre> <code class="hljs cs">handleSendButton = (<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.socketsMessageSending(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.refs.message_text.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.refs.message_text.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>; }</code> </pre> <br><p> ,      <code>message_text</code> .  <code>message_text</code>     .        . </p><br><p>    props. </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {loaded, connected, message_history} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props;</code> </pre> <br><p>   ,     </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> { message_history.map((messageHistoryElement, index) =&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{</span></span></span><span class="hljs-tag">'</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">unstyled</span></span></span><span class="hljs-tag">'}&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{(messageHistoryElement.direction</span></span></span><span class="hljs-tag"> === </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'-&gt;'</span></span></span><span class="hljs-tag">) ? '</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">glyphicon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">glyphicon-arrow-right</span></span></span><span class="hljs-tag">' </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag"> '</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">glyphicon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">glyphicon-arrow-left</span></span></span><span class="hljs-tag">'}&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> {messageHistoryElement.message} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> )} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><blockquote>       ‚Äî     .  Those.     ' '?' ':' '.     .  ‚Äî     .    . </blockquote><p>     </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-inline"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onSubmit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{this.handleSendButton}</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control input-sm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"message_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">readOnly</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{(loaded</span></span></span><span class="hljs-tag"> &amp;&amp; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connected</span></span></span><span class="hljs-tag"> === </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">true)</span></span></span><span class="hljs-tag"> ? </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">false</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">true</span></span></span><span class="hljs-tag">}&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary btn-sm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{this.handleSendButton}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{(connected</span></span></span><span class="hljs-tag"> === </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">true)</span></span></span><span class="hljs-tag"> ? </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">false</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">true</span></span></span><span class="hljs-tag">}&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fa fa-sign-in"</span></span></span><span class="hljs-tag">/&gt;</span></span> Send <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>     . </p><br><p>    .     . </p><br><pre> <code class="hljs cs">handleSendButton = (<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.socketsMessageSending(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.refs.message_text.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.socketsMessageReceiving(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.refs.message_text.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.refs.message_text.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>; }</code> </pre> <br><p> ,                 <code>this.refs.message_text.value</code> . </p><br><p>       ! </p><br><pre> <code class="hljs go">static propTypes = { loaded: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, connected: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message_history: PropTypes.array, socketsMessageSending: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span>, socketsMessageReceiving: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span> }</code> </pre> <br><p> , <del>  </del>   ! </p><br><p> : <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/5158391cdd53545408637fd732c981f17852e84b"></a> <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/5158391cdd53545408637fd732c981f17852e84b">https://github.com/valentinmk/react-redux-universal-hot-example/commit/5158391cdd53545408637fd732c981f17852e84b</a> . </p><br><h1 id="midlvare">  </h1><br><p>            <a href="http://redux.js.org/docs/advanced/Middleware.html"></a> <a href="http://redux.js.org/docs/advanced/Middleware.html">http://redux.js.org/docs/advanced/Middleware.html</a> . </p><br><p>       <a href="https://exec64.co.uk/blog/websockets_with_redux/"></a> <a href="https://exec64.co.uk/blog/websockets_with_redux/">https://exec64.co.uk/blog/websockets_with_redux/</a> . </p><br><p>     ,       ,   websockets. </p><br><h3 id="pervyy-prohod">   </h3><br><p>    <code>./src/redux/middleware/socketExampleMiddleware.js</code> </p><br><p>       ,    .       ,     . </p><br><p>    ,       ,    . </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> socketExampleActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux/modules/socketexamplemodule'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createSocketExampleMiddleware</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> socketExample = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; socketExample = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; socketExampleActions(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> next =&gt; <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(store, socketExample, action); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(action); } }; }</code> </pre> <br><p> .              .   <code>return store =&gt; next =&gt; action =&gt;</code>            <code>switch (action.type)</code>     . </p><br><p>              ,       <code>store, socketExample, action</code> . ( <code>socketExampleActions();</code>  ,    ,      ). </p><br><p>  ,     ,         . . </p><br><p>   <code>./src/redux/create.js</code>   . </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> createSocketExampleMiddleware <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./middleware/socketExampleMiddleware'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//... const middleware = [ createMiddleware(client), reduxRouterMiddleware, thunk, createSocketExampleMiddleware() ];</span></span></code> </pre> <br><p>  .        ,    ! </p><br><p> : <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/7833a405be3445e58e8e672e9db03f8cfbfde022"></a> <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/7833a405be3445e58e8e672e9db03f8cfbfde022">https://github.com/valentinmk/react-redux-universal-hot-example/commit/7833a405be3445e58e8e672e9db03f8cfbfde022</a> </p><br><h3 id="vtoroy-prohod-delaem-log-istoriyu">  .   . </h3><br><p>         .     websockets. </p><br><blockquote>       ,    .     ,       ,        . </blockquote><p>    <code>./src/redux/middleware/socketExampleMiddleware.js</code> ,       . </p><br><pre> <code class="hljs javascript"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onOpen = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function">) =&gt;</span></span> evt =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'WS is onOpen'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'token '</span></span> + token); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'evt '</span></span> + evt.data); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onClose = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> evt =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'WS is onClose'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'evt '</span></span> + evt.data); };</code> </pre> <br><p>    ( ) </p><br><pre> <code class="hljs objectivec"> socketExample = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; socketExampleActions();</code> </pre> <br><p>       . </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECT'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (socketExample !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { console.log(<span class="hljs-string"><span class="hljs-string">'SOCKETS_DISCONNECTING'</span></span>); store.dispatch(socketExampleActions.socketsDisconnecting()); socket.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); } console.log(<span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECTING'</span></span>); socketExample = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WebSocket(<span class="hljs-string"><span class="hljs-string">'ws://echo.websocket.org/'</span></span>); store.dispatch(socketExampleActions.socketsConnecting()); socketExample.onclose = onClose(); socketExample.onopen = onOpen(action.token); break; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return next</span></span>(action);</code> </pre> <br><p> .  .    <code>SOCKETS_CONNECT</code> ,    ,       ,         <code>onClose()</code>  <code>onOpen(action.token)</code> . ,     .    <code>SOCKETS_CONNECT</code> ,     .       <code>SOCKETS_CONNECTING</code> ,      ‚Äî  . </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECTING'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (socketExample !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { console.log(<span class="hljs-string"><span class="hljs-string">'SOCKETS_DISCONNECTING'</span></span>); store.dispatch(SocketExampleActions.socketsDisconnecting()); socket.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); } console.log(<span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECTING'</span></span>); socketExample = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WebSocket(<span class="hljs-string"><span class="hljs-string">'ws://echo.websocket.org/'</span></span>); store.dispatch(SocketExampleActions.socketsConnecting()); socketExample.onclose = onClose(); socketExample.onopen = onOpen(action.token); break; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return next</span></span>(action);</code> </pre> <br><blockquote>  !!!          ‚Äî          . </blockquote><p>   ,     .    <code>SOCKETS_CONNECTING</code>  <code>SOCKETS_DISCONNECTING</code> .    . </p><br><p> .  ""     <code>store =&gt; next =&gt; action =&gt;</code>    ,     <code>SOCKETS_CONNECTING</code> .       <code>store.dispatch(SocketExampleActions.socketsConnecting());</code> ,       <code>SOCKETS_CONNECTING</code> ,     .. </p><br><p>   ‚Äî         ,     . </p><br><p>   . </p><br><p>   (    )  : </p><br><ul><li>       , </li><li>     "" . </li></ul><br><p>      </p><br><ul><li> <code>SOCKETS_CONNECT</code>   </li><li>      <code>SOCKETS_CONNECTING</code> , </li><li>             . </li></ul><br><p>    . </p><br><p> -,    . </p><br><p>   2     <code>src\redux\modules\socketexamplemodule.js</code> . </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_CONNECTING = <span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECTING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_CONNECT = <span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECT'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_DISCONNECTING = <span class="hljs-string"><span class="hljs-string">'SOCKETS_DISCONNECTING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_DISCONNECT = <span class="hljs-string"><span class="hljs-string">'SOCKETS_DISCONNECT'</span></span>;</code> </pre> <br><p>      . </p><br><pre> <code class="hljs lua">export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsConnecting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_CONNECTING}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsConnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_CONNECT}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsDisconnecting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_DISCONNECTING}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsDisconnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_DISCONNECT}; }</code> </pre> <br><p>        .      <code>./src/components/SocketExampleComponents/SocketConnectionLog.js</code> ,           react.    <code>./src/containers/SocketExample/SocketExamplePage.js</code> . </p><br><pre> <code class="hljs xml">static propTypes = { loaded: PropTypes.bool, message: PropTypes.string, connected: PropTypes.bool, history: PropTypes.array, socketsConnecting: PropTypes.func, socketsDisconnecting: PropTypes.func, //HERE socketsConnect: PropTypes.func, socketsDisconnect: PropTypes.func } render() { //HERE const {loaded, message, connected, socketsConnecting, socketsDisconnecting, history, socketsConnect, socketsDisconnect} = this.props; return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Socket Exapmle Page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Socket Exapmle Page"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SocketConnectionLog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{loaded}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{message}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connected</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{connected}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connectAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{socketsConnecting}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disconnectAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{socketsDisconnecting}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">history</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{history}</span></span></span><span class="hljs-tag"> //</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HERE</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connectAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{socketsConnect}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disconnectAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{socketsDisconnect}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SocketMessageLog</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ); }</code> </pre> <br><p>   <code>./src/redux/middleware/SocketExampleMiddleware.js</code>   . </p><br><p>    </p><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECT'</span></span>:</code> </pre> <br><p>     : </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SOCKETS_DISCONNECT'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (socketExample !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { console.log(<span class="hljs-string"><span class="hljs-string">'SOCKETS_DISCONNECTING'</span></span>); store.dispatch(socketExampleActions.socketsDisconnecting()); socketExample.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); } socketExample = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; break;</code> </pre> <br><p>  ,         disconnect       . </p><br><pre> <code class="hljs"> socketExample.onclose = onClose(store);</code> </pre> <br><p>     </p><br><pre> <code class="hljs javascript"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onClose = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function">) =&gt;</span></span> evt =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'WS is onClose'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'evt '</span></span> + evt.data); store.dispatch(socketExampleActions.socketsDisconnect()); };</code> </pre> <br><p>    ‚Äî .    Network      ,      . </p><br><p>    ,            . </p><br><pre> <code class="hljs lisp"> socketExample = new WebSocket('ws<span class="hljs-symbol"><span class="hljs-symbol">://echo</span></span>.websocket.org123/')<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><p> .     ,         .             ‚Äî ,     .         . </p><br><p>    <code>store.dispatch(socketExampleActions.socketsDisconnect());</code>   <code>onClose</code>        . </p><br><p> : <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/7569536048df83f7e720b000243ed9798308df20"></a> <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/7569536048df83f7e720b000243ed9798308df20">https://github.com/valentinmk/react-redux-universal-hot-example/commit/7569536048df83f7e720b000243ed9798308df20</a> </p><br><h3 id="prohod-vtoroy-delaem-soobscheniya">  .   </h3><br><p>      . <br>    <code>./src/redux/modules/socketexamplemodule.js</code> </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_MESSAGE_SENDING = <span class="hljs-string"><span class="hljs-string">'SOCKETS_MESSAGE_SENDING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_MESSAGE_SEND = <span class="hljs-string"><span class="hljs-string">'SOCKETS_MESSAGE_SEND'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_MESSAGE_RECEIVING = <span class="hljs-string"><span class="hljs-string">'SOCKETS_MESSAGE_RECEIVING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOCKETS_MESSAGE_RECEIVE = <span class="hljs-string"><span class="hljs-string">'SOCKETS_MESSAGE_RECEIVE'</span></span>;</code> </pre> <br><p>   </p><br><pre> <code class="hljs lua">export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsMessageSending</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sendMessage)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_MESSAGE_SENDING, message_send: sendMessage}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsMessageSend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sendMessage)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_MESSAGE_SEND, message_send: sendMessage}; } export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socketsMessageReceiving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(receiveMessage)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: SOCKETS_MESSAGE_RECEIVING, message_receive: receiveMessage}; }</code> </pre> <br><p>  Stop.   4 ? . ,   ,     socketsMessageReceive,          .                , ..    "" (     ). </p><br><h4 id="priem-soobscheniya">   </h4><br><p>          <code>./src/redux/middleware/socketExampleMiddleware.js</code> . </p><br><p>       ,          . </p><br><pre> <code class="hljs javascript"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onMessage = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ws, store</span></span></span><span class="hljs-function">) =&gt;</span></span> evt =&gt; { <span class="hljs-comment"><span class="hljs-comment">// Parse the JSON message received on the websocket const msg = evt.data; store.dispatch(SocketExampleActions.socketsMessageReceiving(msg)); };</span></span></code> </pre> <br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECT'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (socketExample !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { console.log(<span class="hljs-string"><span class="hljs-string">'SOCKETS_DISCONNECTING'</span></span>); store.dispatch(SocketExampleActions.socketsDisconnecting()); socket.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); } console.log(<span class="hljs-string"><span class="hljs-string">'SOCKETS_CONNECTING'</span></span>); socketExample = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WebSocket(<span class="hljs-string"><span class="hljs-string">'wss://echo.websocket.org/'</span></span>); store.dispatch(SocketExampleActions.socketsConnecting()); socketExample.onmessage = onMessage(socketExample, store); socketExample.onclose = onClose(store); socketExample.onopen = onOpen(action.token); break;</code> </pre> <br><h4 id="otpravka-soobscheniya">   </h4><br><p>     . </p><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SOCKETS_MESSAGE_SEND'</span></span>: socketExample.send(action.message_send); store.dispatch(SocketExampleActions.socketsMessageSending(action.message_send)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre> <br><p> . <code>action.message_send</code> ‚Äî   ? ,          <code>store =&gt; next =&gt; action =&gt;</code>   .    ,            . </p><br><p>       . </p><br><p>   <code>./src/components/SocketExampleComponents/SocketMessageLog.js</code> ,       . </p><br><pre> <code class="hljs cpp"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> propTypes = { loaded: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message: PropTypes.<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, connected: PropTypes.<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, message_history: PropTypes.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>, socketsMessageSend: PropTypes.func }</code> </pre> <br><p> ,       ,      . </p><br><pre> <code class="hljs cs"> handleSendButton = (<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.socketsMessageSend(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.refs.message_text.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.refs.message_text.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>; }</code> </pre> <br><p> .            <code>message_history</code>  react    .  ,        <code>this.props.socketsMessageSend(this.refs.message_text.value)</code> ,    <code>action</code>    ,     <code>SOCKETS_MESSAGE_SEND</code> ,       <code>SOCKETS_MESSAGE_SENDING</code> ,      . </p><br><p>  We start.  We are checking. </p><br><p> ! </p><br><blockquote> [  ] ,      .                   .      ,   ‚Äî . <br><br> [  ]       . </blockquote><p> : <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/40fd0b38f7a4b4acad141997e1ad9e7d978aa3b3"></a> <a href="https://github.com/valentinmk/react-redux-universal-hot-example/commit/40fd0b38f7a4b4acad141997e1ad9e7d978aa3b3">https://github.com/valentinmk/react-redux-universal-hot-example/commit/40fd0b38f7a4b4acad141997e1ad9e7d978aa3b3</a> </p><br><h1 id="ps">  PS </h1><br><p>      <a href="https://www.gitbook.com/book/valentinmk/react-redux-socket-tutorial"></a> . </p></div><p>Source: <a href="https://habr.com/ru/post/318148/">https://habr.com/ru/post/318148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318136/index.html">How to simplify working with IntelliJ IDEA: useful features for developers</a></li>
<li><a href="../318140/index.html">How companies will save in 2017: 3 effective ways</a></li>
<li><a href="../318142/index.html">Smart, easy and cross-platform C ++ code profiler</a></li>
<li><a href="../318144/index.html">Lecture by Charles Moore, creator of Forth: 144-core processor, why? Is it difficult to program 144 cores?</a></li>
<li><a href="../318146/index.html">Quake Live Server Setup - Step-by-Step Guide</a></li>
<li><a href="../318150/index.html">Poisson distribution and football betting</a></li>
<li><a href="../318154/index.html">Practical interpretation of the method and indicators of mastered volume</a></li>
<li><a href="../318158/index.html">Slow Cooker: load testing network services</a></li>
<li><a href="../318162/index.html">Smart home NooLite. Scenario number 1 - "Master of the house"</a></li>
<li><a href="../318164/index.html">Why Hackintosh is already relevant. Debunking Myths</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>