<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working Pull to refresh</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a story about how to get a working implementation of Pull to refresh under Android. No code examples at all. A few pictures and at the end of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working Pull to refresh</h1><div class="post__text post__text-html js-mediator-article">  This is a story about how to get a working implementation of Pull to refresh under Android.  No code examples at all.  A few pictures and at the end of the article link to the project archive. <br><br>  Recently there was a need to embed Pull to refresh into the current application.  This is now fashionable, users are used to, and for twitter clients has already become the standard.  Search for ready-made solutions on the network brought to the only option - the open-source project <a href="https://github.com/johannilsson/android-pulltorefresh">Johan Nilsson android-pulltorefresh</a> on Github. <br><br><img src="https://habrastorage.org/storage1/ccf36927/c868a5b0/c55179ac/a4846009.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Header is inserted into the ListView, which is hidden if necessary.  The solution is working, but very crooked.  Often hangs in any condition.  If there are few elements in the list and they do not occupy the entire space allocated for the ListView, then the Header is not hidden, and the inscription is changed to Tap to refresh.  The logical limitation of this implementation.  Another feature was discovered when this project was added to the production application.  Since Pull to refresh is a Header, the setSelection (1) method is often executed to hide the Header.  And since we use saving and restoring positions, then of course the constant call to setSelection spoils us all. <br><br>  At first they decided to modify this implementation, correct the most unpleasant moments.  Even built into one project.  But it didn‚Äôt work out the way I wanted, the limitations of using Header affected. <br><br>  There was an idea how to do it differently and free time appeared.  Once the problem is in Header, it means that you need to remove it and put Pull to refresh View and ListView itself into one LinearLayout and move it.  Ideally, I wanted to get the same Pull to refresh as in the official Twitter client.  But they use another bunch.  Pull to refresh is smooth and works well everywhere.  In general, a lot of time spent watching the work of the official Twitter-client. <br><br>  Options that and how to move a lot.  You can move and Pull to refresh View, and ListView, and LinearLayout.  You can move by changing the Padding, Margin or ScrollTo.  After a large number of experiments on the emulator and on real devices, the most optimal combination was found.  The initial shift is done by changing the Padding to the height of Pull to refresh View, so we hide it from the screen.  And then we move the whole Layout by changing the ScrollTo. <br><br>  It turned out beautifully and as smoothly as possible.  But there was a problem, at that time seemingly insurmountable.  For some reason, when the Layout was shifted, everything started to jump.  Coordinates came lower and higher, and there was no way to fix it.  Almost did not even return to the original plan - to finalize Pull to refresh by Johan Nilsson. <br><br>  But then, as if by magic, another project hit my eyes.  <a href="https://github.com/guillep/PullToRefresh">Alternative Pull To Refresh from guillep</a> on the same Github.  It works even worse than with Johan Nilsson, but uses a completely different mechanism, similar to our idea.  And most importantly, there is a problem with jumping Layout.  Take the last three coordinates and calculate the average.  This ensures smoothness. <br><br><img src="https://habrastorage.org/storage1/75cbfac6/c457f38a/56e567a1/f22e8bbe.jpg"><br><br>  We took a bit of each project, everything was combined, and it turned out well-working Pull to refresh, but the loading state remained unfinished.  After releasing Release to refresh turns into Loading and in this state it should scroll with the list, so it should be part of the ListView.  A separate Pull to refresh View should disappear, and Pull to refresh View in the Loading state should be added to the ListView. <br><br>  Since our View must constantly appear and disappear in the ListView, you cannot use it as a Header.  But I also do not want to change the current adapters.  It is necessary that when adding Pull to refresh to the working draft, there should be as few changes as possible.  We decided to use a special Adapter inside Pull to refresh as a Decorator.  And this adapter controls the presence of a special View in the Loading state. <br><br><img src="https://habrastorage.org/storage1/370d312d/3954c850/580904a4/82be3770.jpg"><br><br>  There were many problems, especially when added to the working draft, but they all successfully resolved.  In the end, it turned out to be a class that can replace the usual ListView and which implements a well-functioning Pull to refresh.  It works great on all APIs starting from version 1.5. <br><br>  Only on some Samsung devices with a converted ListView, there are sometimes problems.  But there are already ideas how and what can be redone. <br><br>  <a href="https://github.com/ondesly/Pull-to-refresh">Project on github</a> . </div><p>Source: <a href="https://habr.com/ru/post/132277/">https://habr.com/ru/post/132277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132257/index.html">Coworking in an Internet cafe: Start</a></li>
<li><a href="../132262/index.html">DIY backups for dummies</a></li>
<li><a href="../132272/index.html">On the fixing of negotiations of cellular subscribers</a></li>
<li><a href="../132274/index.html">Installing your own time base database on Junos devices</a></li>
<li><a href="../132276/index.html">Life without patents - for and against</a></li>
<li><a href="../132279/index.html">Crossbrowser APNG</a></li>
<li><a href="../132281/index.html">Mail.Ru does not like Yandex and Google or an interesting feature of the work of Mail.ru Agent</a></li>
<li><a href="../132283/index.html">CSS3 and HTML5 tooltips</a></li>
<li><a href="../132286/index.html">Online json generator</a></li>
<li><a href="../132287/index.html">How to get feedback from the customer on the case and in time</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>