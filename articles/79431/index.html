<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Polymorphic bonds</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, an article about polymorphic links appeared in the Ruby on Rails blog, in which the author wrote all sorts of different things, but for...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Polymorphic bonds</h1><div class="post__text post__text-html js-mediator-article">  The other day, <a href="http://habrahabr.ru/blogs/ror/79389/">an article</a> about polymorphic links appeared in the <a href="http://habrahabr.ru/blogs/ror/">Ruby on Rails</a> blog, in which the author wrote all sorts of different things, but forgot to mention how to use them and why they are needed (then, of course, corrected, but still wrote quite superficially). <br>  At first, I was even scared that this article of mine in some incomprehensible way escaped from the ‚Äúdrafts‚Äù and got into the general tape.  Then I figured it out, collected my thoughts, and decided to finish my own. <br><br>  What are polymorphic links and what are they for?  In <a href="http://railscasts.com/episodes/154-polymorphic-association">one of</a> his <a href="http://railscasts.com/">screencasts,</a> Ryan Bates has already talked about this, and in no case do I want to say the same thing.  The situation was as follows: <blockquote>  we have models <b>Articles</b> , <b>Photos</b> and <b>Events</b> .  And there is a model <b>Comments</b> .  And I really want to keep all comments (comments of articles, photos and events) in one table. </blockquote>  There are a lot of articles on this problem on the Internet, but there are also cases of ‚Äúvice versa‚Äù.  You don‚Äôt need to go far, let's try to develop the functionality of Habrahabr posts! <br><a name="habracut"></a><br>  Here we can write articles, while the articles themselves can be of different types: Topic, Link, Question, Podcast, Translation and Vacancy.  But you must admit, it would be rather foolish to create six separate tables containing almost identical fields: heading, date of creation / change, various seo information, tags, status (published / not) and necessarily something else. <br><br>  <i>I wanted to paint everything ‚Äúfor the smallest,‚Äù but around the middle of the article I realized that somehow it turns out a lot (and they use polymorphic connections, mostly not newbies).</i>  <i>And yes, I completely forgot: let's cut down a bit our functionality and we will design the links at the rate of 3 models: Topic, Link and Podcast (and it really hurts a lot of code, but everything is done in the same way.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So let's go! <br>  Create 4 models: Post, Topic, Link and Podcast.  The incomprehensible Post model will be the ‚Äúparent‚Äù one for the others and, in fact, it will contain all <s>unnecessary</s> common fields. <blockquote><code>bash-3.2$ script/generate model post title:string published:boolean content_id:integer content_type:string <br> bash-3.2$ script/generate model topic body:text <br> bash-3.2$ script/generate model podcast link:string description:text <br> bash-3.2$ script/generate model link link:string description:text</code> </blockquote>  <s>As you can see, links and podcasts have the same fields, let's make another polymorphic link :)</s> <br><br>  When creating the Post migration, we specified common fields for all other tables (in this case, the title (title), the status of the article (published) and the date of creation / modification (they were added automatically)).  In addition, there are 2 fields in which the element ID (content_id) and the model that owns this element will be stored (content_type; we will deal with this a little later). <br>  We will not touch the migration of the Post model anymore, but in all other migrations we will delete this line: <blockquote> <code>t.timestamps</code> </blockquote>  After all, the fields created_at and updated_at (which are generated by the helper timestamps) are now one for all - in the posts table. <br><br>  We do rake db: migrate and ... and the final touch remains: add connections to the models. <blockquote> <code><font color="black"><font color="#696969"># app/models/post.rb</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Post</font> &lt; <font color="#cc6633">ActiveRecord::Base</font> &lt;br/&gt;  belongs_to :content, :polymorphic =&gt; <font color="#0000ff">true</font> , :dependent =&gt; :destroy&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#696969"># app/models/topic.rb</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Topic</font> &lt; <font color="#cc6633">ActiveRecord::Base</font> &lt;br/&gt;  has_one :post, :as =&gt; :content, :dependent =&gt; :destroy&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#696969"># app/models/link.rb</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Link</font> &lt; <font color="#cc6633">ActiveRecord::Base</font> &lt;br/&gt;  has_one :post, :as =&gt; :content, :dependent =&gt; :destroy&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#696969"># app/models/podcast.rb</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Podcast</font> &lt; <font color="#cc6633">ActiveRecord::Base</font> &lt;br/&gt;  has_one :post, :as =&gt; :content, :dependent =&gt; :destroy&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote>  Instead of writing ‚Äúhas_many: links (: topics,: podcasts)‚Äù in the Post model, we say that Post is tightly tied by <s>family ties with a</s> polymorphic link with some: content, and now any model in which we write <blockquote> <code>:has_one :post, :as =&gt; content</code> </blockquote>  will become a subsidiary of our Post'a.  What we, in fact, have done above. <br>  Now we are fully ready to go to the console and rejoice :) <blockquote> <code>bash-3.2$ script/console <br> &gt;&gt; t = Topic.new(:body =&gt; "Just one more test topic body here") <br> &gt;&gt; t.save <br> &gt;&gt; p = Post.new(:title =&gt; "Some test title", :published =&gt; true, :content =&gt; t) <br> &gt;&gt; p.save <br></code> </blockquote>  They created a new topic (indicating only the body), saved, created a new post (indicating the title, status and content itself (you could write and: content_id =&gt; t.id,: content_type =&gt; t.class (as if implying also .to_s)). <br><br>  Without a doubt, so that the content_type field is immediately filled with a value, we can write this: <blockquote> <code>&gt;&gt; Post.topics.new <br> =&gt; #&lt;Post id: nil, title: nil, published: nil, content_id: nil, content_type: "Topic", created_at: nil, updated_at: nil&gt;</code> </blockquote> <br>  Let's try to view all the topics: <br><blockquote> <code>&gt;&gt; Post.find_all_by_content_type("Topic")</code> </blockquote>  I agree, uncomfortable;  let's add some named_scope to the Post model: <blockquote> <code><font color="black">named_scope :topics, :conditions =&gt; { :content_type =&gt; <font color="#008000">"Topic"</font> }&lt;br/&gt;named_scope :links, :conditions =&gt; { :content_type =&gt; <font color="#008000">"Link"</font> }&lt;br/&gt;named_scope :podcasts, :conditions =&gt; { :content_type =&gt; <font color="#008000">"Podcast"</font> } &lt;br/&gt;</font></code> </blockquote>  We go again to the console, do reload!  and look around: <br><blockquote> <code>&gt;&gt; Post.topics <br> &gt;&gt; Post.links <br> &gt;&gt; Post.podcasts</code> </blockquote>  Now you need to understand how to access all the properties of our posts. <br><blockquote> <code>&gt;&gt; p.body <br> NoMethodError: undefined method `body' for #&lt;Post:0x2653e00&gt; <br> &gt;&gt; t.title <br> NoMethodError: undefined method `title' for #&lt;Topic id: 8, body: "Just one more test topic body here"&gt;</code> </blockquote>  It turns out that not so :) Let's try something like this: <br><blockquote> <code>&gt;&gt; p.content.body <br> =&gt; "Just one more test topic body here" <br> &gt;&gt; t.post.title <br> =&gt; "Some test title"</code> </blockquote>  Played and that's enough, it's time to make controllers (and there and close to the presentation).  We leave from the rail console, we are waiting for the usual :) <br><blockquote> <code>bash-3.2$ script/generate controller posts index <br> bash-3.2$ script/generate controller posts/topics index show <br> bash-3.2$ script/generate controller posts/podcasts index show <br> bash-3.2$ script/generate controller posts/links index show <br> bash-3.2$ script/generate controller home index <br></code> </blockquote>  Next we go to config / routes.rb and bring it to this view: <blockquote> <code><font color="black"><font color="#cc6633">ActionController::Routing</font> ::Routes.draw <font color="#0000ff">do</font> |map|&lt;br/&gt;  map.root :controller =&gt; <font color="#008000">'home'</font> &lt;br/&gt; &lt;br/&gt;  map.namespace(:posts) <font color="#0000ff">do</font> |post|&lt;br/&gt;    post.resources :topics, :links, :podcasts&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;  map.resources :posts&lt;br/&gt; &lt;br/&gt;  map.connect <font color="#008000">':controller/:action/:id'</font> &lt;br/&gt;  map.connect <font color="#008000">':controller/:action/:id.:format'</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <blockquote>  And now let's start the server and see what we have: <code>bash-3.2$ script/server</code> </blockquote>  And we got this: <blockquote> <code>/posts (    ) <br> /posts/topics ( ‚Äî  ‚Äì) <br> /posts/links (  ‚Äî  ‚Äì) <br> /posts/podcasts (    ,     ;)</code> </blockquote> <br>  Of course, the whole REST is available, you can even have no doubt about it;) <br><br>  Now fill the code with the controllers: <blockquote> <code><font color="black"><font color="#696969"># app/controllers/posts_controller.rb</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">PostsController</font> &lt; ApplicationController&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">index</font> &lt;br/&gt;    @posts = Post.find(:all)&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#696969"># app/controllers/posts/topics_controller.rb</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Posts</font> ::TopicsController &lt; ApplicationController&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">index</font> &lt;br/&gt;    @posts = Post.topics.find(:all)&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">show</font> &lt;br/&gt;    @post = Post.topics.find(params[:id])&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#696969"># app/controllers/posts/links_controller.rb</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Posts</font> ::LinksController &lt; ApplicationController&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">index</font> &lt;br/&gt;    @posts = Post.links.find(:all)&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">show</font> &lt;br/&gt;    @post = Post.links.find(params[:id])&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#696969"># app/controllers/posts/podcasts_controller.rb</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Posts</font> ::PodcastsController &lt; ApplicationController&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">index</font> &lt;br/&gt;    @posts = Post.podcasts.find(:all)&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">show</font> &lt;br/&gt;    @post = Post.podcasts.find(params[:id])&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote>  In posts_controller, for the time being, we only fill in the index, show is not needed there.  In the rest we fill in both the index (there, as you can see, only the ‚Äúnecessary‚Äù posts will be displayed), and show (and the article / link / podcast will be displayed here).  I think, here you can do without explanations, we have already written all this code in the console. <br><br>  Immediately proceed to the views, and the first - posts # index: <blockquote> <code><font color="black">&lt;!-- app/views/posts/index.html.erb --&gt;&lt;br/&gt;&lt;% @posts.each <font color="#0000ff">do</font> |post| %&gt;&lt;br/&gt;  &lt;%= link_to post.content. <font color="#0000ff">class</font> . <b>to_s</b> .pluralize, <font color="#008000">"/posts/#{post.content.class.to_s.downcase.pluralize}"</font> %&gt; &amp;rarr;&lt;br/&gt;  &lt;%= link_to post.title, <font color="#008000">"/posts/#{post.content.class.to_s.downcase.pluralize}/#{post.id}"</font> %&gt;&lt;br/&gt;&lt;br/&gt;&lt;% <font color="#0000ff">end</font> %&gt; &lt;br/&gt;</font></code> </blockquote>  At first, I wrote this way, because to count down on tons of ifs is even worse (IMHO).  Then I felt ashamed that people would see such horror on Habr√©, and decided to make this horror a little less awful.  So, open app / helpers / posts_helper.rb and write something like <blockquote> <code><font color="black"><font color="#0000ff">module</font> PostsHelper&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">posts_smth_path</font> (post)&lt;br/&gt; <font color="#0000ff">case</font> post.content. <font color="#0000ff">class</font> . <b>to_s</b> .downcase&lt;br/&gt; <font color="#0000ff">when</font> <font color="#008000">"topic"</font> : posts_topic_path(post)&lt;br/&gt; <font color="#0000ff">when</font> <font color="#008000">"link"</font> : posts_link_path(post)&lt;br/&gt; <font color="#0000ff">when</font> <font color="#008000">"podcast"</font> : posts_podcast_path(post)&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">posts_smths_path</font> (post)&lt;br/&gt; <font color="#0000ff">case</font> post.content. <font color="#0000ff">class</font> . <b>to_s</b> .downcase&lt;br/&gt; <font color="#0000ff">when</font> <font color="#008000">"topic"</font> : posts_topics_path&lt;br/&gt; <font color="#0000ff">when</font> <font color="#008000">"link"</font> : posts_links_path&lt;br/&gt; <font color="#0000ff">when</font> <font color="#008000">"podcast"</font> : posts_podcasts_path&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote>  Now we have 2 methods: posts_smth_path and posts_smths_path, which are a special case of posts_topic_path and posts_topics_path (instead of topic / topics, of course, there may also be link / links and podcast / podcasts).  Having done the work on the bugs, we look at what we did: <blockquote> <code><font color="black">&lt;!-- app/views/posts/index.html.erb --&gt;&lt;br/&gt;&lt;% @posts.each <font color="#0000ff">do</font> |post| %&gt;&lt;br/&gt;  &lt;%= link_to post.content. <font color="#0000ff">class</font> . <b>to_s</b> .pluralize, posts_smths_path(post) %&gt; &amp;rarr;&lt;br/&gt;  &lt;%= link_to post.title, posts_smth_path(post) %&gt;&lt;br/&gt;&lt;br/&gt;&lt;% <font color="#0000ff">end</font> %&gt; &lt;br/&gt;</font></code> </blockquote>  I think that is enough for a draft.  Now the rest of the submission: <blockquote> <code><font color="black">&lt;!-- app/views/posts/topics/index.html.erb --&gt;&lt;br/&gt;&lt;% @posts.each <font color="#0000ff">do</font> |post| %&gt;&lt;br/&gt;  &lt;%= link_to post.title, posts_topic_path(post) %&gt;&lt;br/&gt;&lt;br/&gt;&lt;% <font color="#0000ff">end</font> %&gt;&lt;br/&gt;&lt; <font color="#0000ff">p</font> &gt;&lt;br/&gt;  &lt;%= link_to <font color="#008000">"Add new Topic"</font> , new_posts_topic_path %&gt;&lt;br/&gt;&lt;/ <font color="#0000ff">p</font> &gt; &lt;br/&gt;</font></code> </blockquote>  This is the index method, and with the exception of the posts_topic_path and new_posts_topic_path methods it is the same everywhere, it makes no sense to build a ton of code here.  The other two will be posts_link_path / new_posts_link_path and posts_podcast_path / new_posts_podcast_path respectively. <blockquote> <code><font color="black">&lt;h1&gt;&lt;%= @post.title %&gt;&lt;/h1&gt;&lt;br/&gt;&lt;%= @post.content.body %&gt; &lt;br/&gt;</font></code> </blockquote>  And this is a show, and in this example it is generally the same everywhere :) <br><br>  And now - perhaps the most interesting: adding new records.  As you have already noticed, in the previous listing there is a line <blockquote> <code><font color="black">&lt;%= link_to <font color="#008000">"Add new Topic"</font> , new_posts_topic_path %&gt;</font></code> </blockquote>  The link_to helper will generate a link that, when clicked, will go to page / posts / topics / new, so it‚Äôs just vital for us to create the file app / views / posts / topics / new.html.erb and write something like this to it: <blockquote> <code><font color="black">&lt;!-- app/views/posts/topics/ <b>new</b> .html.erb --&gt;&lt;br/&gt;&lt;% form_for [:posts, @topic] <font color="#0000ff">do</font> |form| %&gt;&lt;br/&gt;  &lt;% <b>form</b> .fields_for @post <font color="#0000ff">do</font> | <font color="#0000ff">p</font> | %&gt; &lt;br/&gt;    &lt; <font color="#0000ff">p</font> &gt;&lt;br/&gt;      &lt;%= <font color="#0000ff">p</font> .label :title %&gt;&lt;br/&gt;&lt;br/&gt;      &lt;%= <font color="#0000ff">p</font> .text_field :title %&gt; &lt;br/&gt;    &lt;/ <font color="#0000ff">p</font> &gt;&lt;br/&gt;    &lt; <font color="#0000ff">p</font> &gt;&lt;br/&gt;      &lt;%= <font color="#0000ff">p</font> .check_box :published %&gt;&lt;br/&gt;      &lt;%= <font color="#0000ff">p</font> .label :published %&gt;&lt;br/&gt;    &lt;/ <font color="#0000ff">p</font> &gt;&lt;br/&gt;  &lt;% <font color="#0000ff">end</font> %&gt;&lt;br/&gt; &lt;br/&gt;  &lt; <font color="#0000ff">p</font> &gt;&lt;br/&gt;    &lt;%= <b>form</b> .label :body %&gt;&lt;br/&gt;&lt;br/&gt;    &lt;%= <b>form</b> .text_area :body %&gt; &lt;br/&gt;  &lt;/ <font color="#0000ff">p</font> &gt;&lt;br/&gt; &lt;br/&gt;  &lt; <font color="#0000ff">p</font> &gt;&lt;%= <b>form</b> .submit <font color="#008000">"Create"</font> %&gt;&lt;/ <font color="#0000ff">p</font> &gt;&lt;br/&gt;&lt;% <font color="#0000ff">end</font> %&gt; &lt;br/&gt;</font></code> </blockquote>  At once I will make a reservation, so far it will only be about topics, in the rest of the controllers / views there will be a similar code. <br><br>  To make everything fall into place, I will give the code for the new method of the topics controller: <blockquote> <code><font color="black"><font color="#0000ff">def</font> <font color="#cc6633">new</font> &lt;br/&gt;  @topic = Topic. <font color="#cc6633">new</font> &lt;br/&gt;  @post = Post.topics. <font color="#cc6633">new</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote>  And, for complete clarity, I will repeat the code that we wrote in the routes.rb file: <blockquote> <code><font color="black">map.namespace(:posts) <font color="#0000ff">do</font> |post|&lt;br/&gt;  post.resources :topics, :links, :podcasts&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote>  Once upon a time we defined a namespace, and now when creating forms for topics instead of form_for <a href="https://habrahabr.ru/users/topic/" class="user_link">topic</a> do ... we will specify our namespace, that is, write form_for [: posts, <a href="https://habrahabr.ru/users/topic/" class="user_link">topic</a> ] do ... (similarly for links and podcasts). <br>  At the very end of the form, we put the body field and the submit button of the form, and before that we use the fields_for helper, which is similar in behavior to the form_for helper, unless it creates form tags.  Thus, we get 2 forms, as if, one being nested in another. <br><br>  Fill out the form, click the Create button and go to the create method of the topics controller.  Let's write something working in it, and adding articles is ready! <blockquote> <code><font color="black"><font color="#0000ff">def</font> <font color="#cc6633">create</font> &lt;br/&gt;  @topic = Topic. <b>new</b> (:body =&gt; params[:topic][:body])&lt;br/&gt; <font color="#0000ff">if</font> @topic.save&lt;br/&gt;    @post = Post. <b>new</b> ({ :content =&gt; @topic }.merge params[:topic][:post])&lt;br/&gt; <font color="#0000ff">if</font> @post.save&lt;br/&gt;      redirect_to root_url&lt;br/&gt; <font color="#0000ff">else</font> &lt;br/&gt;      render :new&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">else</font> &lt;br/&gt;    render :new&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote>  I sincerely apologize for such an abundance of code in the method, I am sure that this code can (and should!) Be put into the model, but I do not know how.  I hope some of the more experienced comrades will correct me. <br><br>  On this, I think, everything.  Updating elements is done in a similar way to creation, with this should not be difficult.  I apologize for errors, typos, tediousness and for the size of the article: I did not want to! <br><br>  <s>Treat with all severity, this is not my first article on Habr√©!</s> <br><br>  <b>UPD:</b> <br>  Useful materials on the topic: <br>  <a href="http://habrahabr.ru/blogs/ror/79630/">STI - one table and many models.</a> <br>  <a href="http://habrahabr.ru/blogs/ror/79595/">Creating multi-model forms</a> </div><p>Source: <a href="https://habr.com/ru/post/79431/">https://habr.com/ru/post/79431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79424/index.html">Will your development team be able to create a great product?</a></li>
<li><a href="../79425/index.html">Gadget</a></li>
<li><a href="../79426/index.html">Aqua penguin</a></li>
<li><a href="../79428/index.html">Who actually made the "Roller officials"</a></li>
<li><a href="../79429/index.html">Feedback for online store, my practice</a></li>
<li><a href="../79433/index.html">Firefox is not friendly with cache</a></li>
<li><a href="../79434/index.html">Do you have a floppy disk drive?</a></li>
<li><a href="../79435/index.html">OptionParser and UnitTest in python scripts</a></li>
<li><a href="../79439/index.html">Distributed Network Messaging Protocol - Well Forgotten FTN</a></li>
<li><a href="../79440/index.html">YouTube infrastructure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>