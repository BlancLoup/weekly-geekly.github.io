<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating Today Extension for iOS 8</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the release of iOS 8 , Apple introduced a new concept called App Extensions , through which you can share the functionality of your application w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating Today Extension for iOS 8</h1><div class="post__text post__text-html js-mediator-article"> With the release of <b>iOS 8</b> , Apple introduced a new concept called <b>App Extensions</b> , through which you can share the functionality of your application with other applications, and from the OS itself. <br><br>  One of these types of extensions are <b>Today Extensions</b> , also known as <b>Widgets</b> .  They provide you with the ability to display information in the Notification Center, which is a great way to provide the most up-to-date information that the user is interested in. <br><br>  In this article, you will write an application based on the <b>Today Extension extension</b> , which will present the current market value of a <b>Bitcoin</b> based on the US dollar. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It has never been so easy and so fast to provide the necessary information to your users.  Let's start! <br><a name="habracut"></a><br><br>  <b>Bitcoin / Bitcoin</b> <br><br>  For those who are not yet familiar with <b>Bitcoin</b> , this is a digital cryptocurrency, which is still in its infancy.  In addition to using it for peer-to-peer exchanges and purchases, Bitcoin allows the user to exchange them for other cryptocurrencies such as Dogecoin and Litecoin or for US dollars or Euros. <br><br>  Since it is a relatively new currency, its market value fluctuates by the minute;  there were both huge peaks and downs for the entire period of its existence.  Thus, this is an ideal candidate for Today Extension, as investors or buyers will want to know the stock price to the nearest second! <br><br>  <b>Crypticker</b> <br><br>  As you are writing an extension, you need a ready application to get started;  well, it's time to get to know Crypticker. <br><br>  <b>Crypticker</b> is a simple application that displays the current Bitcoin price, the difference between yesterday and the current price, as well as a chart of price history.  The schedule includes a 30 day history;  swiping your finger along the schedule, you will see the exact price for a specific day. <br><br>  The extension will contain all these functions, but you cannot see the price for a specific day by swiping your finger along the chart.  There are some connections to Today Extensions, especially when it comes to using gestures and multitasking.  The gesture is often activated by swiping between Today Extensions and the Notification Center, so you do not need to have a great user experience to perform it. <br><br>  <b>Let's get to work</b> <br><br>  You need to download the Crypticker startup project to get started.  The project contains Crypticker applications, as written above.  In this article we will not focus on the development of the application itself, so you will be pleasantly surprised by the brevity of this article.  In the end, you will write an extension, but not the whole application. <br><br>  Compile and run the application.  Please note that you will need an Internet connection to see the price in real time using the web service. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea6/7da/165/ea67da165597ae9768301a61c2846d46.png" alt="image"><br><br>  The application looks like a screenshot;  The data displayed will, of course, depend on how things are going on in the Bitcoin market.  Touching the chart near the bottom, a line will appear and display the price for the corresponding day. <br><br>  For those who do not yet know <b>BTC,</b> this is an abbreviated form for <b>Bitcoin</b> ;  just like USD stands for US dollar.  Today Extension will present a smaller version of the Crypticker main view. <br><br>  Theoretically, the Crypticker application has the ability to show pricing for several cryptocurrencies, but our extension is intended only for <b>BTC</b> .  Therefore, it is called <b>BTC Widget</b> . <br><br>  <b>Note:</b> <i>Extensions, by their nature, have only one simple functioning goal.</i>  <i>If you want to display information for other crypto-currencies, such as Dogecoin, then it is best to create another widget and with it an application or develop your UI accordingly, for example, like the <b>Stocks</b> widget.</i> <br><br>  By the end of the article, your <b>Today Extension</b> will look something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb1/811/9ea/cb18119eaa8b7fe752ebb11a4ed7bcb3.png" alt="image"><br><br>  <b>Adding Target Today Extension</b> <br><br>  Extensions are created as a separate binary file received from their host application.  Thus, you will need to add target Today Extension to the Crypticker project. <br><br>  In Xcode in Project Navigato, select the Crypticker project and add a new target, <b>Editor \ Add Target ...</b> Then select <b>iOS \ Application Extension \ Today Extension</b> .  And click the <b>Next</b> button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1bb/baa/a07/1bbbaaa073e0efac1bf19adcfe3c15c6.png" alt="image"><br><br>  In the <b>Product Name,</b> type <b>BTC Widget</b> , and make sure that the programming language is <b>Swift</b> , and that the <b>Embed in Application</b> project is <b>Crypticker</b> .  And click <b>Finish</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/125/bd0/983/125bd098309f042d7ff790a583000281.png" alt="image"><br><br>  When requesting, you need to activate the <b>BTC Widget</b> scheme.  Because the text indicates that another scheme will be created for you to run in <b>Xcode</b> . <br><br>  Congratulations!  Now <b>BTC Widget</b> will appear in your <b>targets</b> list. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc3/07b/430/dc307b430c84330d127c9442ab7da9df.png" alt="image"><br><br>  Make sure you select <b>BTC Widget</b> , then the ‚ÄúGeneral‚Äù tab, and then click the <b>+</b> button, which is located under the <b>Linked Frameworks and Libraries line</b> .  As shown in the picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/901/513/a38/901513a38e364239a63ff4a79af7c334.png" alt="image"><br><br>  Select <b>CryptoCurrencyKit.framework</b> and click <b>Add</b> . <br><br>  <b>CryptoCurrencyKit</b> is a custom framework that is used by the <b>Crypticke</b> application to get prices and currencies from the network.  Fortunately for you, the incredibly kind and thoughtful developer Crypticker has applied modular design to the code, turning it into a framework so that several targets can use it. <br><br>  In order to exchange data between the host application and its extensions, you must use a custom framework.  If you do not do this, you will need to duplicate the code many times, and break an important rule of software engineering: DRY - or, <b>Do not repeat.</b>  <b>I will repeat it again: "Do not repeat</b> . <b>"</b> <br><br>  From this point on, you can start implementing the extension. <br><br>  Please note that you now have a group in the <b>Project navigator</b> , named after your new targeta, <b>BTC Widget</b> .  This is where the Today Extension code is by default. <br><br>  Expand the group and you will see the view controller, storyboard, and Info.plist file.  Its target configuration also instructs it to load its interface from the <b>MainInterface.storyboard</b> , which contains one view controller with a class assigned to <b>TodayViewController.swift</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/610/a7f/ff3/610a7fff376841c07ee250f7fd754e73.png" alt="image"><br><br>  You will notice that some files that should be in the Today Extension template are missing;  for example, as a delegate application.  Remember that extensions work inside another host application in such a way that they do not go through the traditional application lifecycle. <br><br>  In fact, the life cycle of an extension is mapped to the TodayViewController life cycle. <br><br>  Open the <b>MainInterface.storyboard</b> and you will see a dark bright background with the light inscription <b>"Hello World"</b> .  <b>Today Extensions</b> have high-definition images with a light background and light or bright color text that harmonizes perfectly with the dark, blurred background of the Notification Center / Notification Center. <br><br>  Make sure that target <b>BTC Widget is</b> selected on the <b>Xcode</b> toolbar, compiled and running.  As a result, a window will appear asking for permission to launch the application.  <b>Xcode</b> will ask you which host application you want to run.  Select <b>Today</b> .  This indicates that IOS will open the Notification Center on the Today panel, which in turn launches your widget.  The notification center is actually the application host for <b>Today Extensions</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/21c/91b/d32/21c91bd3235bf03ed73ca83270d26aab.png" alt="image"><br><br>  It also allows Xcode to use its debugger while the widget is running. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eba/f19/6f1/ebaf196f17a7949e17297f92e00d3d3d.png" alt="image"><br><br>  Here is your widget.  Cool, right?  Although this is a super-addicting thing, a little more work is needed on the widget.  It's time to do something interesting! <br><br>  <b>Note:</b> <i>You may notice a lot of errors associated with the use of <b>Auto Layout,</b> which are displayed in the console when the widget starts.</i>  <i>This is a template issue in <b>Xcode</b> , and we hope Apple will solve it in the future.</i>  <i>Although, you do not worry, since you will already have your own interface and the ability to use <b>Auto Layout</b> .</i> <br><br>  <b>We create the interface</b> <br><br>  Open the <b>MainInterface.storyboard</b> and delete the <b>Label</b> .  Add a view with a size of 150 points in height and 320 points in width set for it in the <b>Size Inspector</b> .  Move a Button, two Labels and a View from the Object Library to the view controllers. <br><br><ul><li>  Place one of the lables in the upper left corner, and in the Attributes Inspector set the Text to $ 592.12 and Color to Red: 66, Green: 145 and Blue: 211. It will show the current market price. </li><li>  Place another Lable to the right of the one you just installed, but leave the field to the right of the button.  In Attributes Inspector set Text to +1.23 and Color to Red: 133, Green: 191 and Blue: 37. This will show the difference between yesterday's price and the current price. </li><li>  Move the button to the top right view, and in the Attributes Inspector, set the Image to the caret-notification-center and delete the Title. </li><li>  Finally, place an empty view below the two lables and buttons, drag it so that the bottom and side edges touch the view's content and set the Height to 98. In the Attributes Inspector, set the Background as Clear Color, and in the Identity Inspector set the Class - <b>JBLineChartView</b> . </li></ul><br><br>  <b>Note:</b> <i>There is a class called <b>JBLineChartDotView</b> that Xcode can offer when typing, making sure that you choose <b>JBLineChartView</b> .</i> <br><br>  Your <b>View</b> and <b>Document Outline</b> should look something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b27/025/767/b2702576707c3324a4c9a64827719153.png" alt="image"><br><br>  <b>Note:</b> <i>View presented in white for visibility purposes in this article.</i>  <i>Your view will actually have a dark gray background that simulates how your view will appear in the Notification Center.</i> <br><br>  Do not worry about the order in which it is all located, as soon you will add <b>Auto Layout</b> to properly determine the location. <br><br>  Now expand the <b>Crypticker</b> group in <b>Project Navigator</b> and select Images.xcassets.  In the <b>File Inspector</b> , add the subject directory to the extension's target by checking the box to the left of <b>BTC Widget</b> . <br><br>  This forces <b>Xcode</b> to include the graphic resources directory from target <b>Crypticker</b> in your target <b>Widget</b> ;  this is where the caret-notification-center image you used for your button is located.  If you have the same graphic resources between your container application and the widget, then it is a good idea to use a special directory that contains only resources that can be shared.  This will reduce the excessive increase in size in your final set of extensions, not including images that are not used. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27a/42c/a59/27a42ca59d3ef7522fa4c7d7fd41e98b.png" alt="image"><br><br>  Go back to <b>MainInterface.storyboard</b> and open the <b>Assistant Editor</b> .  And make sure <b>TodayViewController.swift</b> is the active file.  Add the following code to the top of the file: <br><br><pre><code class="objectivec hljs">import CryptoCurrencyKit</code> </pre> <br><br>  This you have done importing the <b>CryptoCurrencyKit</b> framework. <br><br>  Then, you need to update the class declaration, which should look like this: <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TodayViewController: CurrencyDataViewController, NCWidgetProviding {</code> </pre><br><br>  This will cause <b>TodayViewController to</b> become a subclass of <b>CurrencyDataViewController</b> , and ensure that it conforms to the <b>NCWidgetProviding</b> protocol. <br><br>  <b>CurrencyDataViewController</b> is included in <b>CryptoCurrencyKit</b> and is also used as the main view in Crypticker.  Since the widget and the application will show this information through the <b>UIViewController</b> , it makes sense to put the reusable components in the superclass, then subclass them, since the requirements set vary. <br><br>  <b>NCWidgetProviding</b> is a protocol that is specifically designed for widgets.  There are two methods of obtaining it that you will implement. <br><br>  Hold Ctrl and move from the button to our class, just below the class declarations.  In the dialog box that appears, make sure that <b>Connection is</b> selected as <b>Outlet</b> , Type is selected as <b>UIButton</b> , and enter <b>toggleLineChartButton</b> in the <b>Name</b> field.  Click <b>Connect</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/097/bec/f9a/097becf9a3b3ef804e94ea887e58dd93.png" alt="image"><br><br>  Then hold down the ctrl and move from the button to the bottom of the class this time.  In the dialog box that appears, change <b>Connection</b> to <b>Action</b> , set <b>Type</b> to <b>UIButton,</b> and type <b>toggleLineChart</b> in the <b>Name</b> <b>box</b> .  Click on <b>Connect</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/804/07d/2e4/80407d2e48d3638d0d65a969e4c8064c.png" alt="image"><br><br>  <b>TodayViewController</b> subclasses <b>CurrencyDataViewController</b> , which has outlets for price lable, leble price changes and line chart display.  Now you need to connect them.  In the <b>Document Outline</b> , hold down the ctrl and drag from T <b>oday View Controller</b> to the <b>price label</b> (with the text set to $ 592.12).  Select priceLabel from the popup to create a connection.  Repeat all this for another lable by selecting <b>priceChangeLabe</b> from the popup.  Finally, do the same for <b>Line Chart View</b> by selecting <b>lineChartView</b> from the popup window ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f0/145/599/3f014559953e2d1a576a2e92d1c7d9fc.png" alt="image"><br><br>  <b>Auto Layout</b> <br><br>  In order for your widget to be responsive, you need to establish an <b>Auto Layout</b> connection.  New connections released with iOS 8 are the concept of <b>Adaptive Layou</b> t.  The general idea is that a view designed with a single layout can work on different screen sizes.  A representation is considered adaptive when it can adapt to unknown future metric values ‚Äã‚Äãof the device. <br><br>  One of the links you add should show and hide the chart, and help determine the overall height of the widget.  The notification center will be based on the entered data to display your widget of the appropriate height. <br><br>  Select Lable $ 592.12, and then select <b>Editor \ Size to Fit Content</b> .  If the <b>Size to Fit Content</b> option is disabled in the menu, deselect Lable, then select it again and try again;  sometimes Xcode may work intermittently.  Next, using the Pin button at the bottom of the <b>storyboard</b> workspace, set the Top and Leading priority to 8 and 16, respectively.  Make sure <b>Constrain to margins is</b> selected. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/de2/fc8/5dc/de2fc85dc21e63982410f6b3ae90953c.png" alt="image"><br><br>  Select Lable +1.23 and select <b>Editor \ Size to Fit Content</b> again.  Then, using the <b>Pin</b> button, select the <b>Top and Trailing</b> relationship, and in the properties set the value to 8. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a76/9d3/a4c/a769d3a4c1c2ce1b3bf12439fdbeebc2.png" alt="image"><br><br>  Select Button, and using the Pin button set the priority for Top and Trailing to 0, and for Bottom to 8. Width and Height to 44. Make sure <b>Constrain to margins is</b> off. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aef/38b/831/aef38b8314b1e65166fb19c4c2f98c08.png" alt="image"><br><br>  You need to lower the priority of the lower anchor for the button.  Select the button and then open the Size Inspector.  Find Bottom Space to: link in the list of links, click on the <b>Edit</b> button and change its <b>Priority</b> to 250. <br><br>  By lowering the priority, you allow the <b>Auto Layout</b> system to change this binding, if it deems it necessary.  250 is an arbitrary value, which turns out to be less than 1000, it is this priority that is set on all bindings by default.  This binding should change as soon as the widget is in a minimized state.  Having different levels of priorities in the bindings, you tell the system which links need to be changed first or last when a conflict occurs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/428/408/d3c/428408d3c891de4134574521f0479c0c.png" alt="image"><br><br>  Finally, select <b>Line Chart View</b> .  Using the <b>Pin</b> button, select <b>Leading, Trailing and Bottom</b> and in the properties set the value to 0, and the height to 98. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a6/a4d/f33/8a6a4df33b95c30a3b9c2ddacace3168.png" alt="image"><br><br>  From the <b>Document Outline,</b> select the <b>View</b> Controllers <b>view</b> , and then <b>Editor \ Resolve Auto Layout Issues \ All Views \ Update Frames</b> .  This will eliminate any <b>Auto Layout</b> warnings in workspaces by updating frames to match the correct bindings.  If <b>Update Frames is</b> selected, then you have done everything as it should, and there is no need to start the application. <br><br>  Since all your bindings are in place, the last step is to create an output for snapping the height of the line chart view.  Find the <b>Line Chart View</b> in the <b>Document Outline</b> and click on the triangle to expand. <br><br>  Then click on the triangle for <b>Constraints</b> to find the necessary peg for the height.  Select it, and then move ctrl + drag to the <b>Assistant Editor</b> , placing it just below another outlet.  In the pop-up window, make sure <b>Connection is</b> selected as <b>Outlet</b> , and enter <b>lineChartHeightConstraint</b> for <b>Name</b> .  Click <b>Connect</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/49e/5cf/a06/49e5cfa066a6b07d8a90a705188f6194.png" alt="image"><br><br>  <b>Implementing TodayViewController.swift</b> <br><br>  Now the interface is in its place and what was needed is configured, open the <b>TodayViewController.swift</b> file by selecting it in Standard Editor. <br><br>  You will notice that you are working with the standard <b>UIViewController</b> subclass.  Comfortable, isn't it?  Although later you will come across the new method <b>widgetPerformUpdateWithCompletionHandler</b> from the <b>NCWidgetProviding</b> protocol.  You will learn more about him by the end of this article. <br>  This view controller is responsible for displaying the current price, the difference in price, for pressing the button and showing the price history on the line chart. <br><br>  Define a property at the top of <b>TodayViewController</b> that you will use to track if the line chart is displayed or not: <br><br><pre> <code class="objectivec hljs">var lineChartIsVisible = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br><br>  Now replace the viewDidLoad () method with the following implementation: <br><br><pre> <code class="objectivec hljs">override func viewDidLoad() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() lineChartHeightConstraint.constant = <span class="hljs-number"><span class="hljs-number">0</span></span> lineChartView.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; lineChartView.dataSource = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; priceLabel.text = <span class="hljs-string"><span class="hljs-string">"--"</span></span> priceChangeLabel.text = <span class="hljs-string"><span class="hljs-string">"--"</span></span> }</code> </pre><br><br>  This method performs the following actions: <br><ol><li>  Sets the height for the line chart ‚Äúheight constraints‚Äù to 0, so that it is the default. </li><li>  Sets self as a data source and a delegate for a line chart view. </li><li>  Sets some placeholder text on two Lables. </li></ol><br><br>  Stay in <b>TodayViewController</b> , and add the following method: <br><br><pre> <code class="objectivec hljs">override func viewDidAppear(animated: Bool) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidAppear(animated) fetchPrices { error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> error == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updatePriceLabel() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updatePriceChangeLabel() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updatePriceHistoryLineChart() } } }</code> </pre><br><br>  The <b>fetchPrices</b> method <b>is</b> defined in <b>CurrencyDataViewController</b> , and is an asynchronous call that accepts block terminations.  The method makes a request to the web service mentioned at the beginning of the article to get information about the price of <b>Bitcoin</b> . <br><br>  The method updates both <b>Lable</b> and Line Chart.  Update methods are also defined in the superclass.  They simply accept the values ‚Äã‚Äãobtained by the fetchPrices method and format them appropriately for display on the screen. <br><br>  Thanks to the construction of the widget, you also need to implement <b>widgetMarginInsetsForProposedMarginInsets</b> to provide custom field tabs.  Add the following code to <b>TodayViewController</b> : <br><br><pre> <code class="objectivec hljs">func widgetMarginInsetsForProposedMarginInsets (defaultMarginInsets: <span class="hljs-built_in"><span class="hljs-built_in">UIEdgeInsets</span></span>) -&gt; (<span class="hljs-built_in"><span class="hljs-built_in">UIEdgeInsets</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UIEdgeInsetsZero</span></span> }</code> </pre><br><br>  By default, widgets have a large field, which is set in many Apple widgets by default.  If you want to fill the entire width of the Notification Center, then you need to implement this method and return <b>UIEdgeInsetsZero</b> , which defines the value 0 for all parties. <br><br>  Now it's time to see what happened.  Select the scheme BTC Widget.  Compile and run the extension.  Select Today as the app to launch when prompted. <br><ul><li>  If the Notification Center does not appear, swipe down from the top of the screen to activate it. </li><li>  If the widget does not appear in the Notification Center, you need to add it via the Edit menu.  At the bottom of the <b>Today</b> content view, you can see the <b>Edit</b> button.  Click the button to expand the menu of all <b>Today Extensions extensions</b> that are installed on the system.  Here you can enable, disable and reorder them as you wish.  Enable <b>BTC Widget</b> if you have not already done so. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/99e/226/7e4/99e2267e478779c7c750b7e697da5417.png" alt="image"><br><br>  Cool, isn't it ?!  Your widget now displays real-time <b>Bitcoin</b> prices right in the Notification Center.  But you probably noticed one problem;  The button does not work, and you do not see the diagram. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ba/8d3/5fc/6ba8d35fc144aed2e185a26723e168b7.png" alt="image"><br><br>  Then you need to implement the <b>toggleLineChart</b> method for the button that you added so that it <b>expands the</b> widget view and presents the diagram.  As the name of the method suggests, this button will act as a switch;  it will also minimize the view to hide the chart. <br><br>  Replace the empty <b>toggleLineChart</b> method <b>with the</b> following code: <br><br><pre> <code class="objectivec hljs">@IBAction func toggleLineChart(sender: <span class="hljs-built_in"><span class="hljs-built_in">UIButton</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lineChartIsVisible { lineChartHeightConstraint.constant = <span class="hljs-number"><span class="hljs-number">0</span></span> let transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeRotation</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) toggleLineChartButton.transform = transform lineChartIsVisible = <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { lineChartHeightConstraint.constant = <span class="hljs-number"><span class="hljs-number">98</span></span> let transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeRotation</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">CGFloat</span></span>(<span class="hljs-number"><span class="hljs-number">180.0</span></span> * M_PI/<span class="hljs-number"><span class="hljs-number">180.0</span></span>)) toggleLineChartButton.transform = transform lineChartIsVisible = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br><br>  This method controls the constant value of the <b>Line Chart View</b> snap height to resize the window.  It also applies an expansion transform to the button, thus accurately reflecting the visibility of the chart. <br><br>  After the binding is updated, it is necessary to reload the diagrams so that they are redrawn on the new layout. <br><br>  You can do this in the viewDidLayoutSubviews <b>method</b> by adding it to <b>TodayViewController</b> : <br><br><pre> <code class="objectivec hljs">override func viewDidLayoutSubviews() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLayoutSubviews() updatePriceHistoryLineChart() }</code> </pre><br><br>  Make sure that the <b>BTC Widget</b> scheme is selected, compile and run the application.  Then select <b>Today</b> as the app to launch when prompted. <br><br>  On the left, you will see the widget appear when the diagram is hidden.  On the right, you will see how it is displayed when we "opened" the widget.  Wow, really! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/502/4a8/bef/5024a8bef3f4dd466f064c348a0bcb6b.png" alt="image"><br><br>  Quick change the color of the line, and you will have one widget.  Add the following to <b>TodayViewController</b> : <br><br><pre> <code class="objectivec hljs">override func lineChartView(lineChartView: JBLineChartView!, colorForLineAtLineIndex lineIndex: <span class="hljs-built_in"><span class="hljs-built_in">UInt</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">UIColor</span></span>! { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UIColor</span></span>(red: <span class="hljs-number"><span class="hljs-number">0.17</span></span>, green: <span class="hljs-number"><span class="hljs-number">0.49</span></span>, blue: <span class="hljs-number"><span class="hljs-number">0.82</span></span>, alpha: <span class="hljs-number"><span class="hljs-number">1.0</span></span>) }</code> </pre><br><br>  Make sure the schema that is still selected is correct.  Compile and run the application.  Select <b>Today</b> as the app to launch when prompted. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e82/011/e69/e82011e69e3eadfcb4a66f2abc7ce564.png" alt="image"><br><br>  Your last requirement that your widget should support is to update its view when it is not displayed, allowing the system to create a snapshot.  The system does this periodically to help your widget meet current requirements. <br><br>  Replace the existing implementation of the <b>widgetPerformUpdateWithCompletionHandler</b> method <b>with the</b> following code: <br><br><pre> <code class="objectivec hljs">func widgetPerformUpdateWithCompletionHandler(completionHandler: ((NCUpdateResult) -&gt; Void)!) { fetchPrices { error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> error == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updatePriceLabel() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updatePriceChangeLabel() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updatePriceHistoryLineChart() completionHandler(.NewData) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { completionHandler(.NoData) } } }</code> </pre><br><br>  This method performs the following actions: <br><ul><li>  It retrieves the current price data from the web service, calling <b>fetchPrices</b> . </li><li>  If there are no errors, the interface is constantly updated. </li><li>  Finally, and in accordance with the requirements of the <b>NCWidgetProviding</b> protocol, the function calls the completion unit supplied with the system with .ND Data enumeration. </li><li>  In case of an error, the completion block is called using the <b>.Failed enumeration</b> .  This informs the system that new data is not available, and an existing snapshot should be used. </li></ul><br><br>  And so, we have completed creating your <b>Today Extension</b> !  You can download the final project <a href="">here</a> . <br><br>  <b>And what's next?</b> <br><br>  The Center for Notifications in iOS 8 is your own personal playground!  Widgets have been available in some other mobile operating systems for years, and now <b>Apple has</b> finally given you the opportunity to create them. <br><br>  As an enterprising developer, you may want to take another look at existing applications and think about how you can update them with widgets.  Go ahead and invent new ideas for the application that will take advantage of the widgets. <br><br>  If you want to learn more about creating other types of extensions IOS 8 App Extensions, read our book iOS 8 by Tutorials, where you can learn about <b>Photo Extensions</b> , <b>Share Extensions</b> , <b>Action Extensions</b> and much more! <br><br>  We can't wait to see what you come up with and hope that your <b>Today Extensions</b> will be in the top of our Notification Centers soon! </div><p>Source: <a href="https://habr.com/ru/post/240475/">https://habr.com/ru/post/240475/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240463/index.html">Effective Django. Part 1</a></li>
<li><a href="../240465/index.html">Welcome to Kharkov on –°iklum Mobile Saturday 25 October</a></li>
<li><a href="../240469/index.html">MindCub3r in Russian - we make a robot that can assemble a Rubik's Cube (article updated)</a></li>
<li><a href="../240471/index.html">Utilities in (FREE status) for the calculation of wave resistance and not only ...</a></li>
<li><a href="../240473/index.html">Demo versions from Google Play, data on revenues from games for 2014, consolidation of market leaders from Japan - and other news of the week for a mobile developer</a></li>
<li><a href="../240477/index.html">Enchanting performance by Bertrand Picard</a></li>
<li><a href="../240479/index.html">Fight against memory leaks in Android. Part 1</a></li>
<li><a href="../240483/index.html">Using the beanstalkd queue server to distribute our mailing list</a></li>
<li><a href="../240485/index.html">Sequential execution of tasks in Gulp JS</a></li>
<li><a href="../240489/index.html">We create notebooks for the book in automatic mode</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>