<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zend_XmlRpc_Client and Crossposting in LiveJournal</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the new year, one kind person gave me a domain. If there is a domain, then there must be something there. I decided to make myself a blog. But sin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zend_XmlRpc_Client and Crossposting in LiveJournal</h1><div class="post__text post__text-html js-mediator-article">  For the new year, one kind person gave me a domain.  If there is a domain, then there must be something there.  I decided to make myself a blog.  But since the last 2 years I used livejournal I wanted my posts to be synchronized with LJ. <br>  I program with the help of my favorite Zend Framework. <br><a name="habracut"></a><br>  Part of the live logging API is based on the <a href="http://ru.wikipedia.org/wiki/XML-RPC">XML-RPC protocol</a> , a description of this API can be found <a href="http://www.livejournal.com/doc/server/ljp.csp.xml-rpc.protocol.html">here</a> . <br>  In order to add a new post in LJ, we first need to get a challenge. <br>  We will use the Zend_XmlRpc_Client component from the Zend Framework. <br>  Create its object - <br><blockquote><code><font color="black">$xmlRpcClient = <font color="#0000ff">new</font> Zend_XmlRpc_Client( <font color="#A31515">'http://www.livejournal.com/interface/xmlrpc'</font> );</font> <br></code> </blockquote><br>  the incoming parameter is the server that we are going to contact in this case, we have the server LJ. <br>  Send a request to the server: <br><br><blockquote> <code><font color="black">$chalengeResponse = $xmlRpcClient-&gt;call( <font color="#A31515">'LJ.XMLRPC.getchallenge'</font> ); <br></font> <br></code> </blockquote><br>  This request will return the server's response to us - this is an array in which both the challenge will be specified, it will be hashed along with your LJ password and sent to the server - after all, it will be more secure to transfer passwords.  Also in this array, you get the server LJ server and the time when your challenge expires.  We will not wait until it expires and immediately post. <br>  But first you need to properly form a request. <br>  If you glance <a href="http://www.livejournal.com/doc/server/ljp.csp.xml-rpc.postevent.html">here</a> you will find an example of the necessary xml file which should be sent, you should also notice that it contains a single parameter of the struct type. <br><br>  In Zend_XmlRpc_Client - all data types from php are automatically converted to the required ones for XML-RPC. <br>  Well, just in case, we will take another component that is Zend_XmlRpc_Value, namely Zend_XmlRpc_Value_Struct for our case.  Like any Zend_XmlRpc_Value, this component has a getAsDOM () method that will return you an object of the <a href="http://php.net/manual/en/class.domdocument.php">DOMDocument</a> class that is included in php.  There is also a saveXML () method - with which you can get xml.  In our case, we can display what we get to see the differences from the example and make some corrections. <br>  The Zend_XmlRpc_Value_Struct constructor takes an associative array. <br>  well, about it we will do something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$postOptions = <font color="#0000ff">new</font> Zend_XmlRpc_Value_Struct( <br> array( <br> <font color="#A31515">'username'</font> =&gt; $ljUsername, <br> <font color="#A31515">'auth_method'</font> =&gt; <font color="#A31515">'challenge'</font> , <br> <font color="#A31515">'auth_challenge'</font> =&gt; $chalengeResponse[ <font color="#A31515">'challenge'</font> ], <br> <font color="#A31515">'auth_response'</font> =&gt; md5($chalengeResponse[ <font color="#A31515">'challenge'</font> ] . md5($ <font color="#0000ff">this</font> -&gt;_ljPassword)), <br> <font color="#A31515">'ver'</font> =&gt; <font color="#A31515">'1'</font> , <br> <font color="#A31515">'event'</font> =&gt; <font color="#A31515">'       xml-rpc'</font> , <br> <font color="#A31515">'subject'</font> =&gt; <font color="#A31515">'xml-rpc test'</font> , <br> <font color="#A31515">'year'</font> =&gt; 2010, <br> <font color="#A31515">'mon'</font> =&gt; 1, <br> <font color="#A31515">'day'</font> =&gt; 3, <br> <font color="#A31515">'hour'</font> =&gt; 4, <br> <font color="#A31515">'min'</font> =&gt; 33, <br> <font color="#A31515">'props'</font> =&gt; array( <br> <font color="#A31515">'opt_preformatted'</font> =&gt; <font color="#0000ff">true</font> , <br> <font color="#A31515">'taglist'</font> =&gt; <font color="#A31515">'tag1, tag2, tag3'</font> <br> ), <br> <font color="#A31515">'security'</font> =&gt; <font color="#A31515">'public'</font> <br> ));</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  In the constructor, we passed an array of parameters, let's figure out what the parameters were there: <br><ul><li>  username - user name </li><li>  auth_method - authorization method </li><li>  auth_challenge - the challenge we got </li><li>  auth_response - the md5 challange encrypted with the same password from the LJ encrypted </li><li>  event - the text of our topic </li><li>  subject - the topic header </li><li>  the following 5 parameters indicate the date of publication of the topic (yes, yes, you can put it in hindsight :)) <br>  props are the parameters of the topic; you can read a lot of them for a long time about them <a href="http://www.livejournal.com/doc/server/ljp.csp.proplist.html">here</a> . </li><li>  security - access rights can be public, private and usemask; if you use the latter, you will need to specify the parameter allowmask.  I indicated that I need to preserve formatting and tags. <br>  this parameter is also a struct. </li></ul><br><br>  It now remains to create our query and execute it: <br><br><blockquote> <code><font color="black">$request = <font color="#0000ff">new</font> Zend_XmlRpc_Request(); <br> $request-&gt;setMethod( <font color="#A31515">'LJ.XMLRPC.postevent'</font> ); <br> $request-&gt;addParam($postOptions); <br> $xmlRpcClient-&gt;doRequest($request);</font> <br></code> </blockquote><br><br>  We created a request object. Zend_XmlRpc_Request set the LJ.XMLRPC.postevent method for it, added a parameter, and executed a request to the server. <br>  The Zend_XmlRpc_Request class also has a toXml method that returns the generated xml, in case we need to use it somewhere else, for example, save it and give it to a friend. <br><br>  we also want to get the id of the post in LJ and its link <br>  we use the getLastResponse () method, and then we get what the server answered us with the getReturnValue () method <br><blockquote> <code><font color="black">$newPost = $xmlRpcClient-&gt;getLastResponse()-&gt;getReturnValue();</font> <br></code> </blockquote><br><br>  In the $ newPost array, there was a server response, which in itself contains a link to a post in LJ and its id. <br><br>  In fact, it could have been much easier. I intentionally complicated everything to show the other components involved in Zend_XmlRpc_Client. <br>  It could be like this: <br><blockquote> <code><font color="black">$newPost = $xmlRpcClient-&gt;call( <font color="#A31515">'LJ.XMLRPC.getchallenge'</font> , array( <font color="#008000">/*  */</font> ));</font> <br></code> </blockquote><br>  In the array of parameters we could shove all the parameters that we need only <br>  It is worth remembering how the data types are converted from php to xml-rpc because they will be converted automatically by this table: <br><table><tbody><tr><td>  Type in PHP </td><td>  XML RPC Type </td></tr><tr><td>  integer </td><td>  int </td></tr><tr><td>  double </td><td>  double </td></tr><tr><td>  boolean </td><td>  boolean </td></tr><tr><td>  string </td><td>  string </td></tr><tr><td>  array </td><td>  array </td></tr><tr><td>  array (associative) </td><td>  struct </td></tr><tr><td>  object </td><td>  array </td></tr></tbody></table><br><br>  In order to edit a post, you just need to send an LJ.XMLRPC.editevent request with the same parameters as when adding a post, just add another itemid that is returned to you when you add a post. <br>  And to delete a post, you need to edit it but without subject and event. <br><br>  Thank you all, I hope someone come in handy.  Maybe next time I will write about Zend_XmlRpc_Server if I figure out why to use it :). </div><p>Source: <a href="https://habr.com/ru/post/80361/">https://habr.com/ru/post/80361/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80356/index.html">Smooth Streaming in Silverlight</a></li>
<li><a href="../80357/index.html">Google gravity</a></li>
<li><a href="../80358/index.html">My recommendation is to stop all recommendations in design.</a></li>
<li><a href="../80359/index.html">Budget backlight do it yourself</a></li>
<li><a href="../80360/index.html">Mass domain hijacking</a></li>
<li><a href="../80364/index.html">The ARP protocol and "with what it is eaten" (added)</a></li>
<li><a href="../80370/index.html">Airnergy - we are charging along the way from WiFi</a></li>
<li><a href="../80375/index.html">foobar2000 1.0</a></li>
<li><a href="../80377/index.html">The battle for automation or IT specialist versus common sense</a></li>
<li><a href="../80378/index.html">Dune2. Reloaded</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>