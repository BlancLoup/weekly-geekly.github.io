<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smooth ride</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the stories about moving the company's information infrastructure from place to place caught my eye, I thought that moving an average Internet c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smooth ride</h1><div class="post__text post__text-html js-mediator-article">  After the stories about moving the company's information infrastructure from place to place caught my eye, I thought that moving an average Internet content project from one site to another was also quite an interesting topic.  Particularly interesting is how to do this with minimal disruption to work. <br><br>  This is, of course, not about a megaportal with two iron dump trucks, but about a medium-sized project, when there are few servers, they are all rented rather than owned by you, or you have an adequate supply of resources to transfer some of the servers to new place. <br><br>  Surely, there are ways how to do it better in certain conditions, but I will state my thoughts on this topic.  I am sure that, as usual, this will happen, someone will complement this with his valuable experience. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The story is designed for a prepared audience and is not an accurate step by step guide to action. <br><br><a name="habracut"></a><br><h1>  Introduction </h1><br>  So, there is a typical "gentleman's set": <br><ul><li>  Nginx - front-end server, followed by Apache or FastCGI </li><li>  Database Server - MySQL </li><li>  Servers in the new data center are a worthy replacement for the servers of the current hoster, who have already tested your patience to the last limit </li></ul><br><br>  The whole project can ‚Äúlive‚Äù on one server or on several, user files can be stored both on the frontend and on a separate server. <br><br>  In the event of a move between the leased servers, it is often possible to negotiate with the new hosting provider only from the beginning of the new month, so that you can put the equipment into operation and transfer the data. <br><br>  Thus, a simple service during the transfer can be reduced at least until the time of creating the database dump.  Well, if the database server is already configured for replication, if not, you will have to do it. <br><br>  The whole process is divided into two parts: the first is the creation of an up-to-date copy of the resource at the new site, the second is the smooth redirection of traffic due to the post-refresh updating of the caching DNS servers. <br><br><h1>  Code </h1><br>  The code, templates, etc. in a good case are transferred by a simple action: <i>svn co svn: //my.repository.ru/myproject/trunk.</i> <br><br><h1>  Base </h1><br>  So, you need to open two connections with the working database server, in one console write <i>flush tables with read lock</i> , in the other run <i>mysqldump</i> with the necessary parameters.  This moment is implied by the moment of idle time, since most likely your project may not work correctly at this time due to the read locks (read only) of all tables, you will probably have to hang a ‚Äústub‚Äù for this time (bonnie creates a full dump of the supergabra in approximately 58 seconds)  After the copy of the database is ready, in the first console, write <i>show master status</i> and store the values ‚Äã‚Äãobtained (the current binary log file name and position in it) to some safe place.  Then simply close the console, which unlocks the tables or executes <i>unlock tables</i> . <br><br>  The resulting file is archived and transferred to the new site.  There, on a new, still smelling factory of servers, a server, we create a base and restore data to it.  Then we make a replication client database from the old site from this server and initiate replication from the previously obtained location: <i>change master to master_log_file = 'server1-relay-bin.00025', master_log = 350384183;</i>  <i>start slave;</i> <br><br>  If you are familiar with replication and did everything correctly, then in a few minutes you will have a ‚Äúlive‚Äù up-to-date copy of the database in a new place.  In most cases, traffic between different sites is transmitted with sufficient speed so that all the ‚Äúwriting‚Äù requests have time to get from server to server without queues and delays. <br><br>  Note: this item can be omitted than to completely eliminate the interruption in work, if you already have a slave server that you can transfer to a new location. <br><br><h1>  Custom files </h1><br>  User files are very conveniently moved using <i>rsync</i> (man rsync).  During initial preparation, you can copy the full set of storage, and during startup, start synchronization again, in order to synchronize the changes: update the changed files and transfer the new ones. <br><br><h1>  Arrow translation </h1><br>  Now the decisive and most interesting moment.  When you already have two working copies of the project, before you make changes to the DNS, you need to "close" one site to another.  This can be done with the help of the native possible nginx, namely: its proxying module.  That is, just make proxying of all requests to the new server through the old one (again, stupid tautology, when is the end?): <i>Proxy_pass https://new.server.ip: 80 /</i> . <br><br>  If everything works fine, you can update the DNS zone file (I think everyone can transfer the DNS server in their own way).  From this point on, one part of the requests will be processed transparently by the old servers, the other part by the new ones.  Of course, the second part will grow as the records of caching servers are updated, and the first part will disappear in about a day. <br><br>  As soon as you feel that the old servers are no longer needed, you can disable or reconfigure replication as you need and tell the old hosting provider that he will not receive more than one ruble from you. </div><p>Source: <a href="https://habr.com/ru/post/40255/">https://habr.com/ru/post/40255/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../402541/index.html">Content Clarifier - an application that aims to improve the quality of life of autists</a></li>
<li><a href="../402543/index.html">Moscow providers' revenues fall after market saturation</a></li>
<li><a href="../402545/index.html">Why are American farmers bypassing DRM tractors with Ukrainian firmware - an analysis of the situation</a></li>
<li><a href="../402547/index.html">Checking passwords from the hacker base iCloud</a></li>
<li><a href="../402549/index.html">Bauman Racing Team - a story with a taste of speed</a></li>
<li><a href="../402551/index.html">FMA3 instructions in Ryzen tightly hang up the operating system</a></li>
<li><a href="../402553/index.html">Why do blockchain musicians?</a></li>
<li><a href="../402559/index.html">Pile Super Power</a></li>
<li><a href="../402561/index.html">XYZPrinting Polymerization Chamber Overview</a></li>
<li><a href="../402563/index.html">Myofascial relaxation with BlackRoll: universal massage rollers for athletes and not only</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>