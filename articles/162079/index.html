<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with ContactListener from Box2d to Libgdx</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the last article about using Box2d in Libgdx decided to consider working with the class ContactListener . 

 It is obvious from the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with ContactListener from Box2d to Libgdx</h1><div class="post__text post__text-html js-mediator-article"> In continuation of the last article about <a href="http://habrahabr.ru/post/161977/">using Box2d in Libgdx</a> decided to consider working with the class <code>ContactListener</code> . <br><br>  It is obvious from the class name that it should be used for handling collisions.  Consider a couple of practical examples. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/308/9e3/b82/3089e3b8294ae766646557ff36b7137f.png" alt="image"><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <code>ContactListener</code> is an interface that can be implemented in its class for future use in the game world. <br><br>  It is necessary to implement 4 methods: <code>beginContact</code> , <code>endContact</code> , <code>preSolve</code> , <code>postSolve</code> . <br><br>  Our class will look something like this: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyContactListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContactListener</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endContact</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Contact contact)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beginContact</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Contact contact)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preSolve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Contact contact, Manifold oldManifold)</span></span></span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postSolve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Contact contact, ContactImpulse impulse)</span></span></span></span>{ } }</code> </pre><br><br>  To use it, you must assign it to the game world. <br><pre> <code class="java hljs">world.setContactListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyContactListener());</code> </pre><br><br><h5> <code>beginContact</code> </h5> <br>  It works when two objects start to overlap.  Prokat only in the framework of the step. <br><br><h5> <code>endContact</code> </h5> <br>  It is triggered when two objects stop touching.  It can be triggered when the body is destroyed, so this event can take place outside the time step. <br><br><h5> <code>preSolve</code> </h5> <br>  It works after a collision is detected, but before it is processed.  This allows us to somehow change the contact before it is processed.  For example, you can make the contact inactive.  Take an example from a previous article.  We used a moving platform.  Suppose you want to make a character pass through it.  Then <code>preSolve</code> will look like this: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preSolve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Contact contact, Manifold oldManifold)</span></span></span></span>{ WorldManifold manifold = contact.getWorldManifold(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; manifold.getNumberOfContactPoints(); j++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(contact.getFixtureA().getUserData() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; contact.getFixtureA().getUserData().equals(<span class="hljs-string"><span class="hljs-string">"p"</span></span>)) contact.setEnabled(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(contact.getFixtureB().getUserData() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; contact.getFixtureB().getUserData().equals(<span class="hljs-string"><span class="hljs-string">"p"</span></span>)) contact.setEnabled(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } }</code> </pre><br><br>  <code>contact.getFixtureA().getUserData().equals("p")</code> used to identify an object.  I recall that when creating a platform, the <code>platform.getFixtureList().get(0).setUserData("p")</code> method is used. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/4jdZBO3aiWs%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhjWxlAy3j31WUS8Tjl-kqA950NhNg" frameborder="0" allowfullscreen=""></iframe><br><br><h5> <code>postSolve</code> </h5> <br>  The method allows you to implement the logic of the game, which changes the physics after contact.  For example, deform or destroy an object after contact.  However, Box2D does not allow you to change the physics in the method, because you could destroy objects that Box2D is currently processing, leading to an error. <br><br>  There is one subtlety here - you cannot just delete an object, since it can be processed somewhere at the moment, and in the end you will get an error: <br> <code>java.lang.NullPointerException <br> at com.badlogic.gdx.physics.box2d.World.contactFilter</code> <br> <br>  And so, in the method we will delete the blocks that we encountered. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postSolve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Contact contact, ContactImpulse impulse)</span></span></span></span>{ Body body = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(contact.getFixtureA() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;amp;&amp;amp; contact.getFixtureA().getUserData() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;amp;&amp;amp; contact.getFixtureA().getUserData().equals(<span class="hljs-string"><span class="hljs-string">"b"</span></span>)) body = contact.getFixtureA().getBody(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(contact.getFixtureB() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;amp;&amp;amp; contact.getFixtureB().getUserData() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;amp;&amp;amp; contact.getFixtureB().getUserData().equals(<span class="hljs-string"><span class="hljs-string">"b"</span></span>)) body = contact.getFixtureB().getBody(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(body != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ body.setActive(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); world.destroyBody(body); } }</code> </pre><br><br>  Now, in a collision, the blocks for which <code>getFixtureList().get(0).setUserData("b")</code> is specified will be destroyed.  I wrote above that during a normal deletion there would be an error.  But, if you make the object inactive <code>body.setActive(false)</code> before deletion, there will be no error. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/pPZ6DUlftk0%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhiOqEXBWz1N0a9nhGPIc1YKyfNrbQ" frameborder="0" allowfullscreen=""></iframe><br><h5>  Sources </h5><br>  You can download the source from the <a href="http://suvitruf.ru/2012/12/10/2672/">blog</a> .  They are pretty damp, really.  But to understand the principles of work will help. <br></div><p>Source: <a href="https://habr.com/ru/post/162079/">https://habr.com/ru/post/162079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162069/index.html">The Pirate Bay - the most efficient public library</a></li>
<li><a href="../162071/index.html">Final Selection Skolkovo MD</a></li>
<li><a href="../162073/index.html">Computer on Elm Street</a></li>
<li><a href="../162075/index.html">SMS ransomware in the form of a set of plug-ins for browsers</a></li>
<li><a href="../162077/index.html">Copyright history. Part 3: Monopoly is dying ... and reborn</a></li>
<li><a href="../162081/index.html">Pseudo 3D effect</a></li>
<li><a href="../162085/index.html">RAW collective processing service</a></li>
<li><a href="../162087/index.html">Collectd - Monitor the system with minimal cost. Setting and using notifications</a></li>
<li><a href="../162091/index.html">SMS notifications from nagios by means of clickatell.com and site monitor on bash</a></li>
<li><a href="../162093/index.html">EPAM IT Share # 3: Search for related images. Define Cloud Computing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>