<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Immersion in technology blockchain: Mutual insurance of animals</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This material from a series of articles on Russia's first projects developed on the basis of blockchain technology is a bit unusual. You will learn ab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Immersion in technology blockchain: Mutual insurance of animals</h1><div class="post__text post__text-html js-mediator-article">  This material from a series of articles on Russia's first projects developed on the basis of blockchain technology is a bit unusual.  You will learn about the technical implementation of the platform for mutual pet insurance, which was launched only today.  Now you can test the bot <a href="https://aka.ms/habr_323548_14">Lexi Bot</a> in Telegram.  We welcome your comments. <br><br><img src="https://habrastorage.org/files/f6c/da5/a15/f6cda5a15262470e8de61d518f2ead0c.jpg"><br><a name="habracut"></a><br><h2>  The series of articles "Immersion in technology blockchain" </h2><br>  1. A series of materials on Emer technology: <br>  1.1.  <a href="https://habrahabr.ru/company/microsoft/blog/311690/">The secrets of EmerCoin</a> . <br>  1.2.  <a href="https://habrahabr.ru/company/microsoft/blog/314368/">Decentralized uncensored domain name system</a> . <br>  1.3.  <a href="https://habrahabr.ru/company/microsoft/blog/316326/">Worldwide public key infrastructure</a> . <br>  1.4.  <a href="https://habrahabr.ru/company/microsoft/blog/316864/">Decentralized password-free security system</a> . <br>  2. <a href="https://habrahabr.ru/company/microsoft/blog/312308/">Fast and secure transactions</a> . <br>  3. <a href="https://habrahabr.ru/company/microsoft/blog/313130/">Ecosystem of digital dentistry</a> . <br>  4. <a href="https://habrahabr.ru/company/microsoft/blog/312054/">Combating counterfeit goods</a> . <br>  5. <a href="https://habrahabr.ru/company/microsoft/blog/323548/">Mutual insurance of animals</a> . <br>  6. <a href="https://habrahabr.ru/company/microsoft/blog/328896/">What is ICO and how to conduct it</a> . <br>  7. Loading ... <br><br><h2>  What is ReGa Risk Sharing and Lexi </h2><br>  ReGa Risk Sharing has developed a platform for mutual pet insurance using smart contract technologies, photo identification and scoring.  <a href="https://aka.ms/habr_323548_14">Lexi Bot, a</a> risk management robot, helps a client to join the Lexi Club pet assistance club and, after transferring a membership fee of about 350 rubles per month, receive up to 80% reimbursement of the cost of veterinary services in case of a sudden illness or an accident .  Each member of the Club receives a virtual Lexi Card, which is the identifier of a smart contract that manages the account of the Club member in the Ethereum blockchain. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Distributed Financial Products </h4><br>  ReGa Risk Sharing platform implements distributed financial products - products that can be produced and serviced without the participation of centralized financial institutions - banks and insurance companies.  For financial products with a low investment size (loan), which can be called micro financial products, the existing banking system cannot provide an adequate balance of cost and quality at a given level of risk.  This is primarily due to the fact that the general principles of regulation do not allow the use of modern technologies to optimize business processes.  An example of such a class of products is micro-insurance, where the average bill is about 1,000 rubles, and at the same time the settlement of losses requires significant costs from the insurance company.  As a result, the contract with the client is usually drawn up in such a way as to practically exclude cases of payments for insured events.  The solution could be the use of mutual insurance approaches, when the clients themselves merge into a virtual insurance company, form the capital of such an insurance company from their contributions (insurance premiums) and make payments for insured events from the mutual insurance fund. <br><br>  The platform of distributed financial products is essentially an automated banking / insurance system for such a mutual bank / insurance company and provides a number of services, including accounting and storing funds in the blockchain, risk assessment and management, automation of business processes and workflow, selection and risk assessment of service providers to settle insurance claims and settlements between participants.  The blockchain is a repository of capital of a mutual insurance company, while access to the account is controlled by a smart contract that defines the rules for replenishing and spending the funds agreed and ‚Äúsigned‚Äù by all participants. <br><br><h4>  Distributed Financial Products Architecture </h4><br>  The architecture of distributed financial products can be represented as a model consisting of 4 levels: blockchain, financial primitives, financial products and applications. <br><br><img src="https://habrastorage.org/files/a21/f1a/5ef/a21f1a5ef4ce4f75b77e1ed7ee929800.jpg"><br><br>  <b>The Blockchain level</b> provides a set of basic services to the rest of the model, including the mechanism for creating and executing smart contracts, accounts, financial messages, private messages, cryptocurrency, and the blockchain itself as a distributed and reliable data repository.  It is assumed that the blockchain has two types of accounts - external or personal accounts that are controlled by the private key and contract accounts that are controlled by the program - a smart contract stored in the blockchain along with the account balance and the state of its internal variables.  Transfer of funds between accounts is carried out by sending financial messages.  The initiator of the sequence of financial messages or transactions can only be the owner of the external account.  The recipient can be either an external account or a contract account.  As a result of processing a financial message, a smart contract can create a new financial message.  Thus, a transaction may consist of a whole sequence of messages or, more precisely, of the results of their processing and involve a whole multitude of accounts, both external and contract accounts.  Each transaction is associated with the cost of its implementation and this value will be debited from the account of the initiator of the transaction. <br><br>  <b>The ‚ÄúFinancial Primitives‚Äù level</b> is a set of ‚Äúbuilding‚Äù blocks for the next level of financial products.  Some of these services are implemented on the basis of the ‚ÄúBlockchain‚Äù services, and some are off-line primitives that are not related to storing information in a distributed database.  So, we cannot store the scoring model (card) on the blockchain, since in this case it becomes accessible to everyone, including potential customers. <br><br><h4>  Photo scoring </h4><br>  To build a scoring model based on customer photography, technologies provided by Microsoft were used: Microsoft Cognitive Service and Azure Machine Learning.  With the help of the Microsoft Face API (MS Cognitive) service, about 15,000 photos of potential borrowers who were denied a consumer loan were processed or approved by at least one of the banks connected to the scoring and underwriting system.  They obtained a complete set of possible parameters: Face Landmarks and Face Attributes ( <code>age</code> , <code>gender</code> , <code>headPose</code> , <code>smile</code> , <code>facialHair</code> and <code>glasses</code> ).  Then, photographs were dropped where no individuals were found, or more than one was found.  About 3% of photos were sifted out in this way. <br><br>  The remaining dataset was normalized, that is, the <code>Landmarks</code> were converted with regard to the head rotation ( <code>Roll</code> and <code>Yaw</code> parameters), and then all the ‚Äúfaces‚Äù were proportionally reduced to a single size - 100x100, which made it possible to compare the parameters of the individuals with each other.  Each of the processed photos was assigned a sign <code>Result = {0 -  | 1 - }</code>  <code>Result = {0 -  | 1 - }</code> .  After this preprocessing and normalization, the array was converted to a CSV file and uploaded to Azure Machine Learning. <br><br>  A number of filters were applied to the resulting table, including <code>Project</code> ‚Äî selection of a subset of features and <code>SMOTE</code> ‚Äî addition of a sample with negative results ( <code>Result = 0</code> ).  As a result, the number of rows in the sample increased to 18,754, and the number of features (columns) was 64. <code>Two-Class Boosted Decision Tree</code> used as a model, trained in 70% of digitized photographs of borrowers and refusers selected randomly from the original array (13,000 lines).  After learning, the remaining part of the array (about 6,000 lines) was used for scoring and evaluating the accuracy of the model. <br><br>  The following results were obtained: <br><br><img src="https://habrastorage.org/files/eb4/588/602/eb45886024e14c2bae9fe9a3c5770e75.jpg"><br><br><img src="https://habrastorage.org/files/030/a06/7fb/030a067fb95a476e892bda3fca5e6236.png"><br><br><h4>  Hierarchical structure of risk groups </h4><br>  To manage risks, the ReGa Risk Sharing platform uses a three-level hierarchical structure of equivalence groups by range of scoring values.  The upper level - ‚ÄúSuperpool‚Äù defines the minimum acceptable level of scoring value for all community members.  The next level - ‚ÄúPool‚Äù ‚Äúsplits‚Äù the maximum range into several subranges, and the next level ‚ÄúSubpool‚Äù finally defines the groups according to risks. <br><br><img src="https://habrastorage.org/files/38d/065/a61/38d065a61da24fb6a2fc04e51c735b99.jpg"><br><br>  For any new member of the community, the scoring value is calculated and, based on this value, the position of the smart contract of the community member in the hierarchical structure is calculated.  The main idea of ‚Äã‚Äãrisk grouping is to isolate various categories of risks from each other and the ability to track the effective value of risk at different levels of the structure.  In this case, if one of the groups exceeds the target values ‚Äã‚Äãfor risks and the estimated cost of maintaining the group is higher than the residual value, then the group can be disbanded and community contributions returned to those members who leave the community. <br><br>  The structure of pools is implemented in the form of smart contracts in the Solidity language for the Ethereum virtual machine.  An online version of the compiler <a href="https://aka.ms/habr_323548_1">is available on GitHub</a> .  It is worth noting that Solidity allows multiple inheritance.  Below are the class interfaces that organize the hierarchical structure. <br><blockquote><div class="spoiler">  <b class="spoiler_title">The poolAccounts class implements the accounting for the movement of funds according to the internal structure of accounts for organizing bank accounting.</b> <div class="spoiler_text"><pre> <code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>; contract poolAccounts { address <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> owner; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[<span class="hljs-number"><span class="hljs-number">11</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> accounts; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeBalance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _amount, an _account)</span></span></span><span class="hljs-function"> internal</span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBalance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(an _account)</span></span></span><span class="hljs-function"> internal constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _balance)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _valid)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(an _dr, an _cr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _amount)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _number, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _case)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">riskManager is an auxiliary class of risk management service.</b> <div class="spoiler_text"><pre> <code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>; contract riskManager { uint <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> risk; <span class="hljs-comment"><span class="hljs-comment">// current risk uint public minScore; // minimum accepting score uint public level; // risk manager level uint public cases; // number of cases per member function accept(regaMember _member) public constant returns(bool _accept, pool _pool); }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">The poolMember class is a member of the pool, which can be both a community member and a mid-level pool.</b> <div class="spoiler_text"><pre> <code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>; contract poolMember is poolAccounts { pool <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> parent; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> limit; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint _level)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pool _pool)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(an _dr, an _cr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _amount)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _number, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _case)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setParent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pool _parent)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _amount)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _loan)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">The pool and poolOfPools classes implement methods for working with a pool and a pool of pools.</b> <div class="spoiler_text">  <b>Pool</b> <br><pre> <code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>; contract pool is riskManager, poolAccounts { bytes32 <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> name; poolMember[] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> members; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(poolMember _member)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isMember</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address _member)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _number, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _case)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint _level)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pool _pool)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lendingCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _loan, poolMember _member)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _loan, poolMember _member)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _amount, uint _level)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; }</code> </pre> <br>  <b>POOLOFPOOLS</b> <br><pre> <code class="cpp hljs">contract poolOfPools is pool { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(poolMember _member)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pool _pool)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isMember</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address _member)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(regaMember _member)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _accept, pool _pool)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br>  <b>REGASUPERPOOL</b> <br><pre> <code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>; contract regaSuperPool is poolOfPools { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">regaSuperPool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint _minScore, address _owner)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br>  <b>REGAPOOL</b> <br><pre> <code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>; contract regaPool is poolOfPools, poolMember { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">regaPool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint _minScore, address _owner)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint _level)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pool _pool)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _amount, uint _level)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; }</code> </pre> <br>  <b>REGASUBPOOL</b> <br><pre> <code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>; contract regaSubPool is pool, poolMember { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">regaSubPool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint _minScore, address _owner, uint _cases)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint _level)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pool _pool)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _amount, uint _level)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(poolMember _member)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span>; }</code> </pre> <br></div></div></blockquote><br><h2>  Products </h2><br>  The following hierarchy is used to describe products. <br><br><img src="https://habrastorage.org/files/df8/a14/a7e/df8a14a7e68642d598356a98564c604b.jpg"><br><br>  Each distributed financial product (LEVEL 1) is described by a class with the following attributes: <br><ul><li>  product parameters and calculator </li><li>  product selection rules for the requirements ( <code>needs</code> ) and customer restrictions </li><li>  business process of contracting ( <code>underwriting process</code> ) </li><li>  product <code>support process</code> business <code>support process</code> </li><li>  business process contract termination ( <code>closure process</code> ) </li><li>  <code>risk management rules</code> </li><li>  <code>scoring cards</code> </li><li>  <code>accounting rules</code> </li><li>  hierarchical pool <code>pools structure</code> </li></ul><br>  For each product, the rules for the selection of this product under the requirements and restrictions of the client are determined.  The contract signing process describes the sequence of actions that must be performed by the system to enter into a contract with a client.  For each client we can calculate the terms of the contract using the parameters of the product and a calculator.  For example, for the case of mutual insurance of an animal, depending on whether it is a cat or a dog, the product calculator will calculate the contract value - Lexi Card Standart per month: 333 rubles - a dog, 289 rubles - a cat. <br><br><h2>  Application implementation on Microsoft Azure </h2><br>  The level of application for mutual pet insurance is implemented in the form of a bot - Lexi Bot, which helps a client to join the Pet Owners Mutual Assistance Club and, after transferring the membership fee, receive up to 80% reimbursement of the cost of veterinary services in case of a sudden illness or an accident with a pet .  In addition, Lexi Bot will help the owner to find the animal from the photos on social networks, if it is lost, and organize an online consultation with a veterinarian.  To get a Lexi Card Club Card, the owner simply needs to open a dialogue with the robot in Facebook Messenger, Telegram, Slack or on the robot's website, upload his own photo, photo of a pet, get a tariff and transfer money to the smart contract of a Club member. <br><br>  For reimbursement, it is enough to make an appointment with the vet through the Lexi Bot, re-photograph the animal in the clinic and send the robot photos of the invoice and check.  The robot will automatically compare the data received from the owner with the data obtained from the veterinary clinic, and will reimburse from the Fund of the Club to the account of the Club member.  The user interface of the Lexi Bot robot is designed using the <a href="https://aka.ms/habr_323548_2">Microsoft Bot Framework</a> and allows you to support several channels of communication with clients using a single application server.  Animal identification is performed by a neural network based classification algorithm, which allows comparing different photos of the same animal with an accuracy of about 95%. <br><br>  Below is the solution architecture. <br><br><img src="https://habrastorage.org/files/392/913/dcb/392913dcbcf048ffbc54a4fbd9100cd2.jpg"><br><br>  Consider some of the technical aspects of the implementation of the bot using the Microsoft Bot Framework on the Microsoft Azure Bot Service. <br><br><h4>  Ethereum consortium blockchain </h4><br>  Despite the fact that the architecture described above interacts with the Ethereum bot via the application server, consider a possible way of interaction between the bot and the Ethereum platform directly.  First of all, we needed to implement the generation and storage of keys for signing the transaction directly in the bot.  To do this, you can use the <code>eth-lightwallet</code> module with the <code>web3</code> module - <a href="https://aka.ms/habr_323548_3">an example on GitHub</a> . <br><br><pre> <code class="cpp hljs">var Web3 = require(<span class="hljs-string"><span class="hljs-string">'web3'</span></span>); var web3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Web3(); var lightwallet = require(<span class="hljs-string"><span class="hljs-string">'eth-lightwallet'</span></span>); var HookedWeb3Provider = require(<span class="hljs-string"><span class="hljs-string">"hooked-web3-provider"</span></span>); var keyStore = lightwallet.keystore; var seed = &lt;seed&gt; var host = &lt;ethereum transaction host&gt;; var pswd = &lt;passowrd&gt; var contractAddr = &lt;contract addr&gt;; var abi = &lt;contract interface&gt;</code> </pre><br>  Now we can implement the method of investing in the account of a smart contract member of the club. <br><br><pre> <code class="cpp hljs">blockchain.prototype.invest = function(acc, amount, success) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(web3 == null) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Error(<span class="hljs-string"><span class="hljs-string">'invest: Web3 provider is null'</span></span>); var contract = web3.eth.contract(abi); var instance = contract.at(contractAddr); var gas = <span class="hljs-number"><span class="hljs-number">500000</span></span>; var gasPrice = web3.toWei(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"gwei"</span></span>); var address = acc; var value = web3.toWei(parseInt(amount), <span class="hljs-string"><span class="hljs-string">"ether"</span></span>); instance.invest.sendTransaction(value, {gas: gas, gasPrice: gasPrice, value: value, from: address}, function(err, tnx) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> err; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> success(tnx); }); }; <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> blockchain();</code> </pre><br><br>  Before testing, you need to access the Azure Ethereum Blockchain Consortium transaction machine (in our case, <code>regakrlby-tx0</code> ), run <code>geth</code> on it and create a contract structure. <br><br><h4>  Microsoft Cognitive Services </h4><br>  For the initial recognition of the type of pet (cat or dog), <a href="https://aka.ms/habr_323548_4">Microsoft Cognitive Services was used</a> .  For integration, you can take a <a href="https://aka.ms/habr_323548_5">cue from GitHub</a> .  Below is a part of the dialogue on getting a photo of an animal. <br><br><pre> <code class="cpp hljs">bot.dialog(<span class="hljs-string"><span class="hljs-string">'/image'</span></span>, session =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasImageAttachment(session)) { var stream = getImageStreamFromUrl(session.message.attachments[<span class="hljs-number"><span class="hljs-number">0</span></span>]); captionService.getCaptionFromStream(stream) .then(caption =&gt; handleSuccessResponse(session, caption)) .<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(error =&gt; handleErrorResponse(session, error)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(imageUrl = (parseAnchorTag(session.message.text) || (validUrl.isUri(session.message.text)? session.message.text : null))) { captionService.getCaptionFromUrl(imageUrl) .then(caption =&gt; handleSuccessResponse(session, caption)) .<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(error =&gt; handleErrorResponse(session, error)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { session.send(<span class="hljs-string"><span class="hljs-string">"Did you upload an image? I'm more of a visual person. Try sending me an image or an image URL"</span></span>); } });</code> </pre><br>  Result processing: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleSuccessResponse = (session, caption) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (caption) { session.send(<span class="hljs-string"><span class="hljs-string">"I think it's "</span></span> + caption); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { session.send(<span class="hljs-string"><span class="hljs-string">"Couldn't find a caption for this one"</span></span>); } session.beginDialog(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); }</code> </pre><br><h4>  Yandex money SDK </h4><br>  To exchange rubles for a cryptocurrency, it is necessary to integrate a bot with a ruble electronic wallet.  In our case, the Yandex Money service was selected and the <code>yandex-money-sdk</code> module was used.  It is worth noting that installing this module from the npm repository using the <code>npm install yandex-money-sdk</code> command <code>npm install yandex-money-sdk</code> we get a library with an error that needs to be fixed: <br><br><pre> <code class="cpp hljs">Wallet.getAccessToken = function (clientId, code, redirectURI, clientSecret, callback) { var full_url = base.SP_MONEY_URL + <span class="hljs-string"><span class="hljs-string">"/oauth/token"</span></span>; request.post({ <span class="hljs-string"><span class="hljs-string">"url"</span></span>: full_url, <span class="hljs-string"><span class="hljs-string">"form"</span></span>: { <span class="hljs-string"><span class="hljs-string">"code"</span></span>: code, <span class="hljs-string"><span class="hljs-string">"client_id"</span></span>: clientId, <span class="hljs-string"><span class="hljs-string">"redirect_uri"</span></span>: redirectURI, <span class="hljs-string"><span class="hljs-string">"client_secret"</span></span>: clientSecret, } }, base.processResponse(callback) ); };</code> </pre><br>  In the prototype of the <code>getAccessToken</code> function of the <code>getAccessToken</code> module, add the line: <br><br><pre> <code class="cpp hljs">Wallet.getAccessToken = function (clientId, code, redirectURI, clientSecret, callback) { var full_url = base.SP_MONEY_URL + <span class="hljs-string"><span class="hljs-string">"/oauth/token"</span></span>; request.post({ <span class="hljs-string"><span class="hljs-string">"url"</span></span>: full_url, <span class="hljs-string"><span class="hljs-string">"form"</span></span>: { <span class="hljs-string"><span class="hljs-string">"code"</span></span>: code, <span class="hljs-string"><span class="hljs-string">"client_id"</span></span>: clientId, <span class="hljs-string"><span class="hljs-string">"redirect_uri"</span></span>: redirectURI, <span class="hljs-string"><span class="hljs-string">"client_secret"</span></span>: clientSecret, <span class="hljs-string"><span class="hljs-string">"grant_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"authorization_code"</span></span> } }, base.processResponse(callback) ); };</code> </pre><br>  The following complexity of integration with Yandex Money arises from the fact that the bot in the Microsoft Azure Bot Service is an <a href="https://aka.ms/habr_323548_6">Azure Function</a> .  To integrate with <code>yandex-money-sdk</code> to the standard <code>messages</code> function, you need to add a new HTTP trigger <code>yandex</code> .  This function will be called by Yandex when passing two-factor authentication.  To add a new function to the root directory of the bot, you need to add a new directory in our case, <code>yandex</code> in which you need to place the following files: <br><blockquote>  drwxr-xr-x 5 sevriugin staff 170 Feb 13 12:16. <br>  drwx ------ @ 12 sevriugin staff 408 Feb 13 12: 15 ... <br>  -rwxr-xr-x @ 1 sevriugin staff 258 Feb 15 11:12 function.json <br>  -rwxr-xr-x @ 1 sevriugin staff 1426 Feb 15 11:13 index.js <br>  -rw-r - r-- 1 sevriugin staff 530 Feb 13 21:05 package.json </blockquote><br>  It is important to correctly describe the new function in the <code>function.json</code> file.  For an incoming call, you must set the authentication level to <code>anonymous</code> .  The fact is that Yandex does a callback: it passes the <code>code</code> value and if the authentication level is not equal to <code>anonymous</code> , then this parameter will be interpreted by the Microsoft Azure Bot Service, and not by your handler. <br><br><pre> <code class="cpp hljs">{ <span class="hljs-string"><span class="hljs-string">"disabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"bindings"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"authLevel"</span></span>: <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"httpTrigger"</span></span>, <span class="hljs-string"><span class="hljs-string">"direction"</span></span>: <span class="hljs-string"><span class="hljs-string">"in"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"req"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-string"><span class="hljs-string">"direction"</span></span>: <span class="hljs-string"><span class="hljs-string">"out"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"res"</span></span> } ] }</code> </pre><br>  For transfer of messages between functions we use service of queues of Azure Storage. <br><br><pre> <code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">"use strict"</span></span>; var config = require(<span class="hljs-string"><span class="hljs-string">'../messages/config'</span></span>); var azure = require(<span class="hljs-string"><span class="hljs-string">'azure-storage'</span></span>); var queueService = azure.createQueueService(config.azure_storage.account, config.azure_storage.key1); queueService.createQueueIfNotExists(<span class="hljs-string"><span class="hljs-string">'myqueue'</span></span>, function(error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!error) { <span class="hljs-comment"><span class="hljs-comment">// Queue exists console.info(`createQueueIfNotExists: Queue is created` + config.azure_storage.name); } }); module.exports = function(context, req) { if (req.query.code || (req.body &amp;&amp; req.body.code)) { context.res = { body: "Please return to the chat‚Ä¶" }; } else { context.res = { status: 400, body: ‚ÄúCode is not found‚Äù }; } queueService.createMessage('myqueue', req.query.sessionId + (req.query.code || req.body.code) , function(error) { if (!error) { console.info(`createMessage: Message is inserted`); } }); context.done(); };</span></span></code> </pre><br>  Now, in the main function that is responsible for the bot operation, it is necessary to make several calls to bind the e-wallet to the bot (bot user).  First of all, it should be noted that the <code>messages</code> function should save the state of the dialog with the user before calling <code>yandex-money-sdk</code> .  To do this, it will be enough to record <code>session.message.address</code> in the database and, when you call Yandex, to transfer <code>session.message.address.id</code> .  This ID will be returned by Yandex when the callback function <code>yandex</code> .  Unfortunately, the queue service in Azure Storage Service works without blocking when checking for a message in the queue, for this it was necessary to implement polling in the messages function: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error, serverMessages, id, cb)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((serverMessages &amp;&amp; Array.isArray(serverMessages)) &amp;&amp; serverMessages.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; serverMessages[<span class="hljs-number"><span class="hljs-number">0</span></span>].messageText.startsWith(id)) { var code = serverMessages[<span class="hljs-number"><span class="hljs-number">0</span></span>].messageText.slice(id.length); cb(code); queueService.deleteMessage(<span class="hljs-string"><span class="hljs-string">'myqueue'</span></span>, serverMessages[<span class="hljs-number"><span class="hljs-number">0</span></span>].messageId, serverMessages[<span class="hljs-number"><span class="hljs-number">0</span></span>].popReceipt, function(error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!error) { <span class="hljs-comment"><span class="hljs-comment">// Message deleted } }); } else { setTimeout(function() { queueService.getMessages('myqueue', function(error, serverMessages) { if(!error) { getMessage(error, serverMessages, id, cb); } }); }, 3000); } } }</span></span></code> </pre><br><h4>  Why Microsoft Azure </h4><br>  To quickly launch a new product on the market, it is difficult to come up with a better cloud service.  It is clear that there are problems and some of the Azure services are still not working as consistently as we would like.  For example, Microsoft Azure Bot Service - while it exists in the preview mode, but a huge number of services that are available quickly and in almost any configuration, cover these minor inconveniences.  For our project, the availability of blockchain services was particularly important, and <a href="https://aka.ms/habr_323548_7">Ethereum Blockchain as a Service</a> fully met our expectations - quick activation and configuration, easy integration with other parts of the project.  In total, the project used the following services: <a href="https://aka.ms/habr_323548_8">Azure Bot Service</a> , <a href="https://aka.ms/habr_323548_9">Azure Storage</a> , <a href="https://aka.ms/habr_323548_10">Microsoft Cognitive Service</a> , <a href="https://aka.ms/habr_323548_11">Azure Machine Learning</a> , <a href="https://aka.ms/habr_323548_12">Azure Ethereum Blockchain Consortium</a> . <br><br><h2>  Conclusion </h2><br>  The article was written at the moment when the animal mutual insurance service was tested.  The industrial configuration will differ slightly from the architecture described above; in particular, the Azure App Service will be used instead of the Microsoft Azure Bot Service.  Our project on <a href="https://aka.ms/habr_323548_13">github</a> . <br><br><h3>  about the author </h3><br><img src="https://habrastorage.org/files/062/e9b/adf/062e9badf4804ce1a8da40a2c039bcb4.png" align="left" width="120">  <a href="https://habrahabr.ru/users/sevriugin/">Sergey Sevryugin</a> - CEO of Bellwood Systems.  In the past, DeltaBank CEO and COO DeltaCredit.  Currently Sergey is Co-Founder ReGa Risk Manager.  In 2015, he started developing solutions on the Ethereum platform, created the first prototype of the product in early 2016: smart contracts in the Solidity language, NodeJS application server, Web App ‚Äî JavaScript with AngularJS, Swift iOS mobile application.  From the end of 2016, I made a prototype of a new product - mutual insurance of animals on Azure using the Microsoft Bot Framework. <br><br>  We remind you that you can try Microsoft Azure for free <a href="https://azure.microsoft.com/ru-ru/free/%3Fwt.mc_id%3DAID570629_QSG_BLOG_139069">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/323548/">https://habr.com/ru/post/323548/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323536/index.html">An example of enterprise anti-virus integration with a SIEM platform. Part 2</a></li>
<li><a href="../323538/index.html">Citrix XenServer Version 7.1 Hypervisor New Release Released</a></li>
<li><a href="../323540/index.html">Turn off auto-run ads in the browser</a></li>
<li><a href="../323542/index.html">Game Designers Learn to Program</a></li>
<li><a href="../323544/index.html">What do 90% forget when writing section headings for a landing page? What prices and discounts attract and help sell?</a></li>
<li><a href="../323550/index.html">When will the next big programming language from Darwin's point of view</a></li>
<li><a href="../323554/index.html">10 Docker Myths That Scare Developers</a></li>
<li><a href="../323556/index.html">Can Python chew a million requests per second?</a></li>
<li><a href="../323558/index.html">Support for users using the free PVS-Studio license is now provided on the StackOverflow website.</a></li>
<li><a href="../323560/index.html">Once again about the presentations. Obvious basics that most neglect. Part one</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>