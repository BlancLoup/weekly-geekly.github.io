<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The order of the fields in accordance with the order in the code (C #)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When working with Reflection, the order of the reflected fields is not guaranteed. This usually does not matter, but sometimes order is needed in exac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The order of the fields in accordance with the order in the code (C #)</h1><div class="post__text post__text-html js-mediator-article"> When working with Reflection, the order of the reflected fields is not guaranteed.  This usually does not matter, but sometimes order is needed in exact correspondence to the order defined in the code.  For example, it may be necessary for partial serialization. <br>  To solve this <s>contrived</s> problem, we use the services of interlanguage interaction. <br><br><a name="habracut"></a><br><br>  First, we mark the class with the attribute <code>StructLayoutAttribute</code> with the parameter <code>LayoutKind.Sequential</code> .  This forces the compiler to place the fields in unmanaged memory in the order declared in the code.  After that, we will sort the reflected fields by offset from the beginning of the class using the <code>Marshal.OffsetOf</code> method. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sample test class: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">StructLayout(LayoutKind.Sequential)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestClass1</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value1; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Value2; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value3; }</code> </pre><br><br>  Example of sorting reflected fields: <br><pre> <code class="cs hljs"> Type type = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TestClass1); List&lt;FieldInfo&gt; fields = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;FieldInfo&gt;(type.GetFields()); <span class="hljs-comment"><span class="hljs-comment">//   foreach (FieldInfo field in fields) Console.WriteLine(field.Name); Console.WriteLine(); //    ( ) fields.Sort( delegate(FieldInfo _first, FieldInfo _second) { int first = _first.FieldType.GetHashCode(); int second = _second.FieldType.GetHashCode(); return first.CompareTo(second); } ); foreach (FieldInfo field in fields) Console.WriteLine(field.Name); Console.WriteLine(); //      fields.Sort( delegate(FieldInfo _first, FieldInfo _second) { int first = Marshal.OffsetOf(type, _first.Name).ToInt32(); int second = Marshal.OffsetOf(type, _second.Name).ToInt32(); return first.CompareTo(second); } ); foreach (FieldInfo field in fields) Console.WriteLine(field.Name); Console.WriteLine();</span></span></code> </pre><br><br>  In what cases might you need this?  Frankly, in very rare.  It is not recommended to write any code that depends on the order, but still it happens when it can be useful: <br><ul><li>  Partial serialization (updating a specific field via the network, ordering by name can have a side effect when refactoring) </li><li>  Mapping to other types </li><li>  Mapping to other languages </li><li>  The order of displaying fields in the toolbox (the visual order will be the same as the order in the code) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/201584/">https://habr.com/ru/post/201584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201572/index.html">Sprite Lamp: dynamic lighting of 2D objects</a></li>
<li><a href="../201574/index.html">Smart Resize and other winners of Nokia Future / Capture</a></li>
<li><a href="../201576/index.html">OllyDbg 2.01</a></li>
<li><a href="../201578/index.html">How to make a contribution to Kickstarter, get the goods + pick up your money? The story of one deception</a></li>
<li><a href="../201582/index.html">UrlEye.com is a free website control service.</a></li>
<li><a href="../201586/index.html">Installing the latest version of Firebird on Ubuntu</a></li>
<li><a href="../201588/index.html">Counts for the smallest: Ford & Bellman or how to understand that you got into the infinitely distant past</a></li>
<li><a href="../20159/index.html">Safari for web developers</a></li>
<li><a href="../201590/index.html">The tragedy of communities in the real world or coupon fever-2</a></li>
<li><a href="../201592/index.html">Iterator in doT.js template engine for objects with filtering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>