<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experienced trivia-5, or "Group joy!"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The continuation of "experienced trifles." Previous parts: one , two , three , four . 

 In this post we will talk about groups in Active Directory. I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experienced trivia-5, or "Group joy!"</h1><div class="post__text post__text-html js-mediator-article"><img src="http://s1.ipicture.ru/uploads/20110619/JF33tDN0.jpg" alt="image" align="left">  The continuation of "experienced trifles."  Previous parts: <a href="http://habrahabr.ru/blogs/sysadm/121801/">one</a> , <a href="http://habrahabr.ru/blogs/sysadm/121917/">two</a> , <a href="http://habrahabr.ru/blogs/sysadm/121946/">three</a> , <a href="http://habrahabr.ru/blogs/sysadm/122184/">four</a> . <br><br>  In this post we will talk about groups in Active Directory.  I will not go deep into the theory and talk about universal, global local groups - those who wish can find all the details in the documentation, since there is plenty of it.  Let's talk about why groups are needed at all and what kind of ‚Äúgoodies‚Äù can be obtained with their help. <br><a name="habracut"></a><br><br><ul><li>  Use groups wherever you can, instead of individual users.  In ACLs, permissions, granting rights, group policy, etc.  Even if there is only one person in the group now - it‚Äôs all the same, use groups.  This not only speeds up the operation of the system (for example, ACLs from 2-3 groups and ACLs from 15 users are not processed at the same time), but in the future it will greatly simplify management.  You do not need to remember where and how you assigned this or that right, you will have a single ActiveDirectory console in which you simply add a new person, or remove the old person from the group, that's all.  Setup complete. </li><li>  Call the group meaningfully, write detailed information in the Description, use prefixes.  For example, the groups that are used to allow access to folders can be called <i>FLD_FolderName_RW</i> , and the Internet access group <i>I_FullAccess</i> .  The prefix allows you to quickly find groups in AD (click to <i>add a user to a group</i> , and the prefix immediately contains a list of exactly the groups you are looking for).  A meaningful name and description in the Description will allow you (or not you) in six months \ year \ it.d.  remember the meaning you put into the group you created. </li><li>  Do not get carried away nested groups.  This is a useful thing, but if you overdo it, you can come to a cyclic nesting and confuse yourself. </li><li>  Delegate group management.  Bring all your groups into a separate structured OU and delegate group membership management rights to those responsible.  For example, we have delegated access control to folders to secretaries, and management of remote access permission is delegated to the Security Council.  All the red tape on "write a service - sign it from the person in charge - ok, we added you - here's your instruction - a service to the archive" passed to them, and part of the routine went away from the IT department. </li><li>  Use groups creatively, for example, to assign any privileges, distribute printers, lay out shortcuts on desktops, prescribe 1C databases using logon scripts, etc.  Given that a group in AD is a fairly ‚Äúcapacious‚Äù object, you can store various settings directly in them, the parameters are passed to the script when executed.  The logic of such scripts is as follows: <ol><li>  The script determines which groups this user is in. </li><li>  Selects specific groups based on a predetermined attribute (for example, by prefix!) </li><li>  Pulls ‚Äúparameters‚Äù out of these groups (Description field, name of group without prefix, etc.) and starts an external command, or procedure with these parameters </li></ol></li></ul><br>  As an example, I will cite a script that works according to this principle: it determines which groups the user is in, finds among them groups with the <b>RDP_</b> prefix, and creates a desktop RDP shortcut for a person with the following parameters: <br><ul><li>  The name of the label equals the name of the group without the prefix, </li><li>  The name of the target server referenced by the RDP label is recorded in the Description group. </li></ul> As a result, in order to send someone to the 1C server, it is enough to add him to the group and ask to restart the system.  In addition, on the accounting terminal server, remote access is allowed only to Administrators and members of the RDP_GroupName groups. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>'       RDP-  ,     . <br> '    - RDP_   Description   ,    RDP- <br> '  AD- RDP_1C-   Server1.domain.local   Desription <br> '        -  ,     . <br> '    RDP-     . <br> On Error Resume Next <br> Set wshShell = WScript.CreateObject("WScript.Shell") <br> Set m_FSO = CreateObject("Scripting.FileSystemObject") <br> <br> '    AD     <br> Set objSysInfo = CreateObject("ADSystemInfo") <br> ADSPath = "LDAP://" &amp; objSysInfo.UserName <br> Set objUser = GetObject(ADSPath) <br> ShortUserName = objUser.SamAccountName <br> DomainName = objSysInfo.DomainShortName <br> <br> '      <br> DesktopPath = wshShell.SpecialFolders("Desktop") <br> LevelCount = 0 <br> MaxLevelCount = 4 <br> Status = CheckGroups(ADSPath) <br> <br> '       <br> '============ Function GetPrefixNameGroup ============ <br> Function GetPrefixNameGroup(sString) <br> ' Trim prefix of name group <br> Dim TempString <br> TempString = Left(sString, InStr(sString, "_")) <br> GetPrefixNameGroup = TempString <br> End Function <br> '===================================================== <br> '============ Function GetLinkNameGroup ============ <br> Function GetLinkNameGroup(sString) <br> ' Trim LinkName of name group <br> Dim TempString <br> TempString = Mid(sString, InStrRev(sString, "_")+1) <br> GetLinkNameGroup = TempString <br> End Function <br> '===================================================== <br> '============ Function Create RdpFile ============ <br> Function CreateRDPFile(sString, sName) <br> spath = DesktopPath &amp; "\" &amp; sString &amp; ".rdp" <br> '      -   -  ' <br> If m_FSO.FileExists(sPath) or m_FSO.FolderExists(sPath) Then <br> m_FSO.DeleteFile (sPath),1 <br> End If <br> Set RDPFile = m_FSO.CreateTextFile (spath, True) <br> RDPFile.writeline ("screen mode id:i:2") <br> RDPFile.writeline ("use multimon:i:0") <br> RDPFile.writeline ("desktopwidth:i:1280") <br> RDPFile.writeline ("desktopheight:i:1024") <br> RDPFile.writeline ("session bpp:i:16") <br> RDPFile.writeline ("winposstr:s:0,1,0,0,800,600") <br> RDPFile.writeline ("compression:i:1") <br> RDPFile.writeline ("keyboardhook:i:2") <br> RDPFile.writeline ("audiocapturemode:i:0") <br> RDPFile.writeline ("videoplaybackmode:i:1") <br> RDPFile.writeline ("connection type:i:2") <br> RDPFile.writeline ("displayconnectionbar:i:1") <br> RDPFile.writeline ("disable wallpaper:i:1") <br> RDPFile.writeline ("disable full window drag:i:1") <br> RDPFile.writeline ("allow desktop composition:i:0") <br> RDPFile.writeline ("allow font smoothing:i:0") <br> RDPFile.writeline ("disable menu anims:i:1") <br> RDPFile.writeline ("disable themes:i:1") <br> RDPFile.writeline ("disable cursor setting:i:0") <br> RDPFile.writeline ("bitmapcachepersistenable:i:1") <br> '    ' <br> RDPFile.writeline ("full address:s:" &amp; sName) <br> RDPFile.writeline ("audiomode:i:2") <br> RDPFile.writeline ("redirectprinters:i:0") <br> RDPFile.writeline ("redirectcomports:i:0") <br> RDPFile.writeline ("redirectsmartcards:i:0") <br> RDPFile.writeline ("redirectclipboard:i:1") <br> RDPFile.writeline ("redirectposdevices:i:0") <br> RDPFile.writeline ("redirectdirectx:i:1") <br> RDPFile.writeline ("autoreconnection enabled:i:1") <br> RDPFile.writeline ("authentication level:i:0") <br> RDPFile.writeline ("prompt for credentials:i:0") <br> RDPFile.writeline ("negotiate security layer:i:1") <br> RDPFile.writeline ("remoteapplicationmode:i:0") <br> RDPFile.writeline ("alternate shell:s:") <br> RDPFile.writeline ("shell working directory:s:") <br> RDPFile.writeline ("gatewayhostname:s:") <br> RDPFile.writeline ("gatewayusagemethod:i:4") <br> RDPFile.writeline ("gatewaycredentialssource:i:4") <br> RDPFile.writeline ("gatewayprofileusagemethod:i:0") <br> RDPFile.writeline ("promptcredentialonce:i:1") <br> '      Domain\Username' <br> RDPFile.writeline ("username:s:" &amp; DomainName&amp; "\"&amp; ShortUserName) <br> RDPFile.writeline ("drivestoredirect:s:") <br> RDPFile.close <br> End Function <br> '===================================================== <br> '============ Function CheckGroups =================== <br> Function CheckGroups(ADSPath) <br> Dim objUser, arrMemberOf <br> Const E_ADS_PROPERTY_NOT_FOUND = &amp;h8000500D <br> LevelCount = LevelCount + 1 <br> if ( LevelCount &gt;= MaxLevelCount) then <br> LevelCount = LevelCount - 1 <br> return LevelCount <br> end If <br> Set objUser = GetObject (ADSPath) <br> On Error Resume Next <br> arrMemberOf = objUser.GetEx("memberOf") <br> If Err.Number = E_ADS_PROPERTY_NOT_FOUND Then <br> LevelCount = LevelCount - 1 <br> return LevelCount <br> Else <br> For Each Group in arrMemberOf <br> ADSGroup = "LDAP://" &amp; Group <br> CheckGroups(ADSGroup) <br> WScript.Echo "Extra=" &amp; LevelCount <br> Set objGroup = GetObject ( ADSGroup ) <br> If(GetPrefixNameGroup(objGroup.CN) = "RDP_") Then <br> Set objGroup = GetObject ( "LDAP://" &amp; Group) <br> LinkName = GetLinkNameGroup(objGroup.CN) <br> LinkServer = objGroup.description <br> LinkResult = CreateRDPFile (LinkName, LinkServer) <br> end If <br> Next <br> End If <br> LevelCount = LevelCount - 1 <br> End Function <br> '=====================================================</code> <br>  And so as not to repeat the script sheet, and in addition to inciting the "righteous curiosity of a sysadmin", example number two will be a screenshot from AD. <br><img src="http://s1.ipicture.ru/uploads/20110621/VcJ4MT8N.jpg" alt="image"><br>  Here, a similar script is used to add 1C databases to users.  Moreover, as it is easy to guess, with a part of the databases, users work in the terminal (in two different) and the script for adding paths runs on the terminal itself, therefore the paths are local.  With another part of the bases (payroll) ‚Äîthrough the network, and the script runs on the workstations, which in general is not important, it doesn‚Äôt matter what ways to add to the user.  If you do this yourself, do not forget that in 1C7.7 and in 1C8.X there are different principles of adding paths to the databases, respectively, either different scripts are needed, or two different functions in the script body. <br>  It is even better to directly launch 1C itself through such a script, which will first register everything that is needed, and then launch the program. <br><br>  To <a href="http://habrahabr.ru/blogs/sysadm/122260/">be</a> continued <a href="http://habrahabr.ru/blogs/sysadm/122260/"><br></a> <br>  PS tell me.  How on Habr√© is better to lay out the scripts and the code in general, and then the painful long post is obtained. </div><p>Source: <a href="https://habr.com/ru/post/122200/">https://habr.com/ru/post/122200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122192/index.html">Three weeks with Acer Iconia Smart</a></li>
<li><a href="../122195/index.html">Symfony in Russian</a></li>
<li><a href="../122197/index.html">2d on unity3d</a></li>
<li><a href="../122198/index.html">Group work with the project and task manager 42tasks.com. Visually</a></li>
<li><a href="../122199/index.html">20 years in Russia. Report from Skolkovo</a></li>
<li><a href="../122205/index.html">Brain computer interface. Part Three Weekdays</a></li>
<li><a href="../122209/index.html">Streaming is increasing in the US</a></li>
<li><a href="../122210/index.html">Examining JOIN Performance in MySQL</a></li>
<li><a href="../122211/index.html">4 the lulz</a></li>
<li><a href="../122212/index.html">Apple has extended a lawsuit against Samsung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>