<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asterisk and information about incoming calls in the browser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading the title, you will probably think ‚ÄúA worn topic, but how much you can write about it,‚Äù but still could not help but share your bikes wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asterisk and information about incoming calls in the browser</h1><div class="post__text post__text-html js-mediator-article">  After reading the title, you will probably think ‚ÄúA worn topic, but how much you can write about it,‚Äù but still could not help but share your <s>bikes with crutches</s> . <br><br><h3>  Introduction </h3><br>  In our company, clients were recorded by telephone through a mini-automatic telephone exchange (I am not strong in this matter and can be mistaken).  All orders were stored in a database, the interface is a web application.  The density of calls at certain moments is very high and dispatchers, due to the human factor, do not always correctly record the client‚Äôs phone (when it is displayed on the phone screen). <br><a name="habracut"></a><br>  But progress did not stand still.  The place of the old PBX was Asterisk 13. I also needed: <br><br><ul><li>  forward information about the web application </li><li>  add outgoing call from web application </li></ul><br>  What wanted to achieve this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Reduce call processing time </li><li>  Reduce the number of errors when recording clients </li><li>  Reduce time to call customers </li></ul><br><h3>  Instruments </h3><br>  After reading several articles, for example, <a href="https://habrahabr.ru/post/278859/">I</a> decided <a href="https://habrahabr.ru/post/278859/">this</a> ‚Äúwhy am I worse?‚Äù And found his own vision of solving the problem. <br><br>  I decided to stop at a bunch of asterisk - <a href="https://packagist.org/packages/marcelog/pami">pami</a> - <a href="https://packagist.org/packages/cboden/ratchet">ratchet</a> <br><br><h3>  Concept </h3><br>  A pami daemon listens on asterisk for incoming calls.  Parallel websocket spinning server.  When an incoming call arrives, the information is parsed and sent to the websocket to the client (if there is one). <br><br><h4>  Implementation </h4><br><div class="spoiler">  <b class="spoiler_title">Demon asteriska</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Asterisk</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Impl</span></span>\<span class="hljs-title"><span class="hljs-title">ClientImpl</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">PamiClient</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">EventMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">HangupEvent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">NewstateEvent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">OriginateResponseEvent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Action</span></span>\<span class="hljs-title"><span class="hljs-title">OriginateAction</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">EventLoop</span></span>\<span class="hljs-title"><span class="hljs-title">Factory</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsteriskDaemon</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $asterisk; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $server; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $loop; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $interval = <span class="hljs-number"><span class="hljs-number">0.1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $retries = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $options = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'host'</span></span>, <span class="hljs-string"><span class="hljs-string">'scheme'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'tcp://'</span></span>, <span class="hljs-string"><span class="hljs-string">'port'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5038</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'user'</span></span>, <span class="hljs-string"><span class="hljs-string">'secret'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' password'</span></span>, <span class="hljs-string"><span class="hljs-string">'connect_timeout'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10000</span></span>, <span class="hljs-string"><span class="hljs-string">'read_timeout'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10000</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $opened = <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $runned = <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Server $server)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server = $server; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;asterisk = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PamiClient(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;options); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop = Factory::create(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;asterisk-&gt;registerEventListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsteriskEventListener(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EventMessage $event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $event <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> NewstateEvent || $event <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> HangupEvent; }); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;asterisk-&gt;open(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opened = <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; $asterisk = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;asterisk; $retries = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;retries; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop-&gt;addPeriodicTimer(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;interval, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($asterisk, $retries)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $asterisk-&gt;process(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $exc) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($retries-- &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \RuntimeException(<span class="hljs-string"><span class="hljs-string">'Exit from loop'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, $exc); } sleep(<span class="hljs-number"><span class="hljs-number">10</span></span>); } }); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__destruct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;runned) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop-&gt;stop(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;asterisk &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opened) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;asterisk-&gt;close(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;runned = <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop-&gt;run(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLoop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop; } }</code> </pre> <br></div></div><br>  Serves for a periodic survey of asterisk`a for the events we need.  To be honest, I will not say if I took the right events, but everything worked with these.  Just similar information can be obtained from many events depending on what you need. <br><br><div class="spoiler">  <b class="spoiler_title">Event listener</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Asterisk</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">EventMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Listener</span></span>\<span class="hljs-title"><span class="hljs-title">IEventListener</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">NewstateEvent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">HangupEvent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">OriginateResponseEvent</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsteriskEventListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IEventListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $server; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Server $server)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server = $server; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EventMessage $event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// getChannelState 6 = Up getChannelStateDesc() // TODO    BridgeEnterEvent if ($event instanceof NewstateEvent &amp;&amp; $event-&gt;getChannelState() == 6) { $client = $this-&gt;server-&gt;getClientById($event-&gt;getCallerIDNum()); if (!$client) { return; } $client-&gt;setMessage($event); // TODO    BridgeLeaveEvent } elseif ($event instanceof HangupEvent) { $client = $this-&gt;server-&gt;getClientById($event-&gt;getCallerIDNum()); if (!$client) { return; } $client-&gt;setMessage($event); } } }</span></span></code> </pre><br></div></div><br>  Well, here, too, everything is clear.  Events we received.  Now they need to be processed.  Who is the server will become clearer below. <br><br><div class="spoiler">  <b class="spoiler_title">Websocket server</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Asterisk</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Ratchet</span></span>\<span class="hljs-title"><span class="hljs-title">MessageComponentInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Ratchet</span></span>\<span class="hljs-title"><span class="hljs-title">ConnectionInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Server</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessageComponentInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> SplObjectStorage */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $clients; <span class="hljs-comment"><span class="hljs-comment">/** *     asterisk * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> AsteriskDaemon */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $daemon; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;clients = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \SplObjectStorage; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;daemon = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsteriskDaemon(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLoop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;daemon-&gt;getLoop(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConnectionInterface $conn)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//echo "Open\n"; } public function onMessage(ConnectionInterface $from, $msg) { //echo "Message\n"; $json = json_decode($msg); if (json_last_error()) { echo "Json error: " . json_last_error_msg() . "\n"; return; } switch ($json-&gt;Action) { case 'Register': //echo "Register client\n"; $client = $this-&gt;getClientById($json-&gt;Id); if ($client) { if ($client-&gt;getConnection() != $from) { $client-&gt;setConnection($from); } $client-&gt;process(); } else { $this-&gt;clients-&gt;attach(new Client($from, $json-&gt;Id)); } break; default: break; } } public function onClose(ConnectionInterface $conn) { //echo "Close\n"; $client = $this-&gt;getClientByConnection($conn); if ($client) { $client-&gt;closeConnection(); } } public function onError(ConnectionInterface $conn, \Exception $e) { echo "Error: " . $e-&gt;getMessage() . "\n"; $client = $this-&gt;getClientByConnection($conn); if ($client) { $client-&gt;closeConnection(); } } /** * * @param ConnectionInterface $conn * @return \Asterisk\Client or NULL */ public function getClientByConnection(ConnectionInterface $conn) { $this-&gt;clients-&gt;rewind(); while($this-&gt;clients-&gt;valid()) { $client = $this-&gt;clients-&gt;current(); if ($client-&gt;getConnection() == $conn) { //echo "Client found by connection\n"; return $client; } $this-&gt;clients-&gt;next(); } return NULL; } /** * * @param string $id * @return \Asterisk\Client or NULL */ public function getClientById($id) { $this-&gt;clients-&gt;rewind(); while($this-&gt;clients-&gt;valid()) { $client = $this-&gt;clients-&gt;current(); if ($client-&gt;getId() == $id) { //echo "Client found by id\n"; return $client; } $this-&gt;clients-&gt;next(); } return NULL; } }</span></span></code> </pre><br></div></div><br>  Actually our websocket server.  I did not bother with the exchange format, I chose JSON.  Here it is worth paying attention that at clients the connection with the server is overwritten.  This allows you to not produce answers when opening many tabs in the browser. <br><br><div class="spoiler">  <b class="spoiler_title">Websocket client</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Asterisk</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Ratchet</span></span>\<span class="hljs-title"><span class="hljs-title">ConnectionInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">EventMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">NewstateEvent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">HangupEvent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PAMI</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">OriginateResponseEvent</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Client</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> PAMI\Message\Event\EventMessage */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $message; <span class="hljs-comment"><span class="hljs-comment">/** *    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Ratchet\ConnectionInterface */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $connection; <span class="hljs-comment"><span class="hljs-comment">/** *    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** *   .   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $lastactive; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConnectionInterface $connection, $id=NULL)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;connection = $connection; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($id) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id = $id; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;lastactive = time(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;connection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($connection)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;connection = $connection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;connection-&gt;close(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;connection = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EventMessage $message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message = $message; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;process(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;connection || !<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> NewstateEvent) { $message = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'event'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'incoming'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message-&gt;getConnectedLineNum()); } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;message <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> HangupEvent) { $message = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'event'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'hangup'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } $json = json_encode($message); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;connection-&gt;send($json); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id = $id; } }</code> </pre><br></div></div><br>  Well here I do not know what to add.  id - ID of the dispatcher's phone.  Needed to determine which of the dispatchers received a call. <br><br><div class="spoiler">  <b class="spoiler_title">Now we launch the rocket</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> implode(DIRECTORY_SEPARATOR, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> , <span class="hljs-string"><span class="hljs-string">'vendor'</span></span>, <span class="hljs-string"><span class="hljs-string">'autoload.php'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//use Ratchet\Server\EchoServer; use Asterisk\Server; try { $server = new Server(); $app = new Ratchet\App('192.168.0.241', 8080, '192.168.0.241', $server-&gt;getLoop()); $app-&gt;route('/asterisk', $server, array('*')); $app-&gt;run(); } catch (Exception $exc) { $error = "Exception raised: " . $exc-&gt;getMessage() . "\nFile: " . $exc-&gt;getFile() . "\nLine: " . $exc-&gt;getLine() . "\n\n"; echo $error; exit(1); }</span></span></code> </pre><br></div></div><br>  It's worth noting that the websocket server and our asterisk daemon use a common thread (loop).  Otherwise, someone from them would not have earned. <br><br><h4>  And how are things going in the web application? </h4><br>  Well, everything is simple.  I will not load information on how to pull out customer information by phone number and other nonsense. <br><br><div class="spoiler">  <b class="spoiler_title">Notification script</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Asterisk</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address, phone</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">3000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isIdle = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, isConnected = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = $(<span class="hljs-string"><span class="hljs-string">'&lt;div/&gt;'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">'asterisk-content'</span></span>, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: <span class="hljs-string"><span class="hljs-string">'text-align: center;'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> widget = $(<span class="hljs-string"><span class="hljs-string">'&lt;div/&gt;'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">'asterisk-popup'</span></span>, <span class="hljs-attr"><span class="hljs-attr">class</span></span>: <span class="hljs-string"><span class="hljs-string">'popup-box noprint'</span></span>, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: <span class="hljs-string"><span class="hljs-string">'min-height: 180px;'</span></span>}) .append($(<span class="hljs-string"><span class="hljs-string">'&lt;div/&gt;'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">class</span></span>: <span class="hljs-string"><span class="hljs-string">'header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>})) .append(content).hide(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> input = $(<span class="hljs-string"><span class="hljs-string">'#popup-addorder'</span></span>).find(<span class="hljs-string"><span class="hljs-string">'input[name=phone]'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = connect(address, phone); $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).append(widget); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ widget.stop(<span class="hljs-literal"><span class="hljs-literal">true</span></span>).show(); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hide</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ widget.show().delay(delay).fadeOut(); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, p</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!a || !p) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Asterisk: no address or phone'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ws = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebSocket(<span class="hljs-string"><span class="hljs-string">'wss://'</span></span> + a + <span class="hljs-string"><span class="hljs-string">'/wss/asterisk'</span></span>); ws.onopen = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ isConnected = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-attr"><span class="hljs-attr">Action</span></span>: <span class="hljs-string"><span class="hljs-string">'Register'</span></span>, <span class="hljs-attr"><span class="hljs-attr">Id</span></span>: p})); }; ws.onclose = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ isConnected = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; content.html($(<span class="hljs-string"><span class="hljs-string">'&lt;p/&gt;'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>})); hide(); }; ws.onmessage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msg = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(evt.data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!msg || !msg.event) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (msg.event) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'incoming'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = msg.value; content.html($(<span class="hljs-string"><span class="hljs-string">'&lt;p/&gt;'</span></span>).html(<span class="hljs-string"><span class="hljs-string">'&lt;br&gt;'</span></span> + p)) .append($(<span class="hljs-string"><span class="hljs-string">'&lt;p/&gt;'</span></span>).html($(<span class="hljs-string"><span class="hljs-string">'&lt;a/&gt;'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">href</span></span>: <span class="hljs-string"><span class="hljs-string">'?module=clients&amp;search='</span></span> + p, <span class="hljs-attr"><span class="hljs-attr">class</span></span>: <span class="hljs-string"><span class="hljs-string">'button'</span></span>}) .html($(<span class="hljs-string"><span class="hljs-string">'&lt;img/&gt;'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">src</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/icons/find.png'</span></span>})).append(<span class="hljs-string"><span class="hljs-string">' '</span></span>))); input.val(p); show(); isIdle = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'hangup'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isIdle) { content.html($(<span class="hljs-string"><span class="hljs-string">'&lt;p/&gt;'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>})); hide(); isIdle = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Unknown event'</span></span> + msg.event); } }; ws.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt</span></span></span><span class="hljs-function">) </span></span>{ content.html($(<span class="hljs-string"><span class="hljs-string">'&lt;p/&gt;'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>})); hide(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Asterisk: error'</span></span>, evt); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ws; }; };</code> </pre><br></div></div><br>  phone is the dispatcher's phone ID. <br><br><h4>  Conclusion </h4><br>  I achieved my goals.  It works in places even better than I expected. <br><br><h4>  What was not included in the article, but what was done </h4><br><ul><li>  Configure asterisk ªa to connect via <b>ami</b> </li><li>  Outgoing call through <b>originate</b> </li><li>  Bash script to monitor the operation of the daemon and its rise in the fall </li></ul><br><h4>  PS </h4><br>  Do not judge strictly for the quality of the code.  The example shows only the concept, although it works successfully in production.  For me it was a wonderful experience with asterisk and websocket. </div><p>Source: <a href="https://habr.com/ru/post/311986/">https://habr.com/ru/post/311986/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311968/index.html">Chrome redesign on the desktop</a></li>
<li><a href="../311970/index.html">Women and murder: is there a relationship here? [part 1 of 2]</a></li>
<li><a href="../311976/index.html">Experience using AWS ECS in our infrastructure</a></li>
<li><a href="../311978/index.html">Summary table of taxiway FSTEC (to protection profiles) in order and in the context of the vultures</a></li>
<li><a href="../311984/index.html">A series of interface (un) updates - "Turn the post joins darkside"</a></li>
<li><a href="../311988/index.html">All the best is in children, or How to find inspiration</a></li>
<li><a href="../311990/index.html">Broadcast ISDEF2016. Conference of software development leaders under their own brands</a></li>
<li><a href="../311994/index.html">How to save the princess, using 8 (+45) programming languages, on Friday</a></li>
<li><a href="../311996/index.html">How Google Cloud breathed life into Pok√©mon GO</a></li>
<li><a href="../311998/index.html">Why you should not use finalizers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>