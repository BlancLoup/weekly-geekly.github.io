<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of developing a simple blog on CleverStyle CMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ATTENTION: The article is relevant at the time of writing, the current state of affairs may differ slightly less than completely. 

 I have long wonde...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of developing a simple blog on CleverStyle CMS</h1><div class="post__text post__text-html js-mediator-article">  ATTENTION: The article is relevant at the time of writing, the current state of affairs may differ slightly less than completely. <br><br>  I have long wondered how, sometimes, modern frameworks make it difficult to develop.  Of course, I have no right to say that they are bad, but I cannot call them good either.  And that's why: their goal is to simplify and speed up development, as well as somehow standardize and structure the project.  But, in my humble subjective opinion, with the first half the opposite effect is sometimes obtained, a lot of code is written, which in itself does nothing, but only serves the main code.  This article is an example of a different approach to the development of a simple blog, using not the Zend Framework 2, <a href="http://habrahabr.ru/post/192522/">as</a> <a href="https://habrahabr.ru/users/rrromka/" class="user_link">rrromka</a> <a href="http://habrahabr.ru/post/192522/">did</a> , but the own development of CleverStyle CMS. <br><a name="habracut"></a><br><h4>  A bit of history </h4><br>  I have been developing CleverStyle CMS for 3 years already.  The need arose precisely because of the complexity and inconvenience of what I was trying to work with.  Development is carried out in free time, as well as in parallel with projects that use CMS (added functionality that is not enough).  This means that the necessary functions are actually added, for which there are tasks, as well as in the form in which they will be most convenient to use.  The basic idea is to make the work of the obvious things automatic, and not quite obvious ones - extremely simple, while there is always the opportunity to influence the standard behavior and adjust it in any appropriate way.  And finally - a huge thanks to the habrasoobshchestvu for constructive criticism of the <a href="http://habrahabr.ru/post/186056/">previous article</a> : you helped me reconsider my views on some things, become the best programmer and change CleverStyle CMS for the better. <br><br><h4>  Environment </h4><br>  Obviously, you need a web server and a database with access details. <br>  Installation does not require composer or any other tools, even the archiver does not need to be used.  Throw the distribution in the root of the future site and open it through a browser.  You get this window: <br><img src="https://habrastorage.org/getpro/habr/post_images/427/88e/293/42788e29314fd78764a99076c505b6f9.png" alt="image"><br>  Filling in all the fields, you get a ready-to-use environment.  The distribution kit will unpack itself, set the default settings where necessary and delete itself for security reasons.  Already from this stage, you can notice the simplicity, do not need to copy a few tens of thousands of small files on ftp / ssh. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  The structure of the future module </h4><br>  The structure of the system can be found in the <a href="https://github.com/nazar-pc/CleverStyle-CMS/wiki">wiki</a> , but we will get acquainted with the parts used in the course of the article. <br>  The module itself will consist of the Posts class, which will be a wrapper over the database and will provide a simple interface for managing posts.  There will also be the actual pages available to the user, the API, and in the end there will be several meta-files that will explain some of the details to the engine and allow the module to be assembled into a self-distributed distribution. <br>  First, create the <a href="https://github.com/nazar-pc/MyBlog/tree/master/components/modules/MyBlog">components / modules / MyBlog</a> directory for our future module. <br><br><h4>  DB </h4><br>  The blog post will have the title, content, author and date of writing.  As an adherent of graphic tools - I prepare the structure in PhpMyAdmin and export: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`[prefix]myblog_posts`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`user`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`title`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">1024</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`text`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8;</code> </pre> <br>  The prefix of the table is replaced by <code>[prefix]</code> for universality, the CMS will substitute the necessary one itself instead. <br>  Create the <a href="">components / modules / MyBlog / meta / install_db / posts / MySQLi.sql file</a> and insert the resulting SQL there.  Thus, when the module is installed in the admin panel, the necessary table in the database will be created.  Similarly, create the file <a href="">components / modules / MyBlog / meta / uninstall_db / posts / MySQLi.sql</a> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`[prefix]myblog_posts`</span></span>;</code> </pre><br>  MySQLi - the name of the database engine, it is the only one <br>  posts is an arbitrary name with which the database is associated (maybe several for different purposes, to the extent that some of the tables will be on one server in MySQL / MariaDB, and the second on another server in PostgreSQL). <br>  The title of posts is written in <a href="">components / modules / MyBlog / meta / db.json</a> : <br><br><pre> <code class="javascript hljs">[ <span class="hljs-string"><span class="hljs-string">"posts"</span></span> ]</code> </pre><br>  On this from a DB all.  The table will be created when the module is installed and deleted when the module is removed. <br><br><h4>  Posts class </h4><br>  Place the class in the <a href="https://github.com/nazar-pc/MyBlog/blob/master/components/modules/MyBlog/Posts.php">components / modules / MyBlog / Posts.php file</a> and place it in the namespace cs \ modules \ MyBlog - this will allow the CMS to find it if necessary. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@package</span></span></span><span class="hljs-comment"> MyBlog * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@category</span></span></span><span class="hljs-comment"> modules * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> Nazar Mokrynskyi &lt;nazar</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@mokrynskyi</span></span></span><span class="hljs-comment">.com&gt; * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@copyright</span></span></span><span class="hljs-comment"> Copyright (c) 2013, Nazar Mokrynskyi * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@license</span></span></span><span class="hljs-comment"> MIT License, see license.txt */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">MyBlog</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>, <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">Cache</span></span>\<span class="hljs-title"><span class="hljs-title">Prefix</span></span>, <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">DB</span></span>\<span class="hljs-title"><span class="hljs-title">Accessor</span></span>, <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">Language</span></span>, <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>, <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">CRUD</span></span>, <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">Singleton</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class Posts for posts manipulation * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@method</span></span></span><span class="hljs-comment"> static \cs\modules\MyBlog\Posts instance($check = false) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Posts</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">CRUD</span></span>, <span class="hljs-title"><span class="hljs-title">Singleton</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Cache object instance * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Prefix */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $table = <span class="hljs-string"><span class="hljs-string">'[prefix]myblog_posts'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $data_model = [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'int'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'int'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'html'</span></span>, <span class="hljs-string"><span class="hljs-string">'date'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'int'</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">construct</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Save instance of cache object with prefix MyBlog (will be added to every item) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Prefix(<span class="hljs-string"><span class="hljs-string">'MyBlog'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** * Required by abstract Accessor class * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int Database index */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cdb</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Config::instance()-&gt;module(<span class="hljs-string"><span class="hljs-string">'MyBlog'</span></span>)-&gt;db(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** * Get post * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int|int[] $id * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array|bool */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($id)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> &amp;$i) { $i = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get($i); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $id; } $id = (int)$id; <span class="hljs-comment"><span class="hljs-comment">/** * Try to get item from cache, if not found - get it from database and save in cache */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;get(<span class="hljs-string"><span class="hljs-string">"posts/$id"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ $data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;read_simple($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($data) { $L = Language::instance(); $data[<span class="hljs-string"><span class="hljs-string">'datetime'</span></span>] = $L-&gt;to_locale(date($L-&gt;_datetime_long, $data[<span class="hljs-string"><span class="hljs-string">'date'</span></span>])); $data[<span class="hljs-string"><span class="hljs-string">'username'</span></span>] = User::instance()-&gt;username($data[<span class="hljs-string"><span class="hljs-string">'user'</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $data; }); } <span class="hljs-comment"><span class="hljs-comment">/** * Add post * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $title * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $text * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool|int Id of created post or &lt;b&gt;false&lt;/b&gt; on failure */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($title, $text)</span></span></span><span class="hljs-function"> </span></span>{ $id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;create_simple([ User::instance()-&gt;id, $title, $text, TIME ]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($id) { <span class="hljs-comment"><span class="hljs-comment">/** * Delete total count of posts */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;total_count); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db_prime()-&gt;id(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Edit post * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $title * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $text * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id, $title, $text)</span></span></span><span class="hljs-function"> </span></span>{ $data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get($id); $data[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = $title; $data[<span class="hljs-string"><span class="hljs-string">'text'</span></span>] = $text; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;update_simple($data)) { <span class="hljs-comment"><span class="hljs-comment">/** * Delete cached item if any */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;{<span class="hljs-string"><span class="hljs-string">"posts/$id"</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Delete post * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $id * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">del</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;delete_simple($id)) { <span class="hljs-comment"><span class="hljs-comment">/** * Delete cached item if any, and total count of posts */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;{<span class="hljs-string"><span class="hljs-string">"posts/$id"</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;total_count ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Get posts * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $page * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int[] */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posts</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($page = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $from = ($page - <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">10</span></span> ?: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db()-&gt;qfas( <span class="hljs-comment"><span class="hljs-comment">//Readable database, Query, Fetch, Single, Array "SELECT `id` FROM `[prefix]myblog_posts` ORDER BY `id` DESC LIMIT $from, 10" ) ?: []; } /** * Get total count of posts * * @return int */ function total_count () { return $this-&gt;cache-&gt;get('total_count', function () { return $this-&gt;db()-&gt;qfs( //Readable database, Query, Fetch, Single "SELECT COUNT(`id`) FROM `[prefix]myblog_posts`" ) ?: 0; }); } }</span></span></code> </pre><br></div></div><br>  The class is a wrapper over the database with caching of posts and their total number.  This class is a <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25BE%25D1%2587%25D0%25BA%25D0%25B0_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">loner</a> , and has the following public methods: <br><ul><li>  get </li><li>  add </li><li>  set </li><li>  del </li><li>  posts </li><li>  total_count </li></ul><br>  The class itself is not engaged in checking access rights, but only the correctness of the input data. <br><div class="spoiler">  <b class="spoiler_title">The database is used in both read mode and write mode.</b> <div class="spoiler_text">  in this example, this is not important, but the initial separation of operations will allow using the replication to use the main database for writing, and the rest for reading;  this small separation is made with perspective <br></div></div><br>  The code is simply written and well commented, and IDE is also well picked up. <br><br><h4>  User interface </h4><br>  In general, a simple json structure is used for routing, which describes the addresses of pages inside the module.  Create a file <a href="">components / modules / MyBlog / index.json</a> which describes the routing of the user part: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"list"</span></span> : [], <span class="hljs-string"><span class="hljs-string">"post"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"edit"</span></span>, <span class="hljs-string"><span class="hljs-string">"delete"</span></span> ] }</code> </pre><br>  Thus, the paths will look like this: <br><ul><li>  MyBlog / list </li><li>  MyBlog / list / {page} </li><li>  MyBlog / post / add </li><li>  MyBlog / post / view / {id} </li></ul><br>  Accordingly, in the module directory we create the following file structure: <br><ul><li>  list.php </li><li>  post / add.php </li><li>  post / delete.php </li><li>  post / edit.php </li><li>  post / view.php </li></ul><br>  Due to the fact that they are described above - CMS will call them on the relevant pages. <br>  Example file <a href="https://github.com/nazar-pc/MyBlog/blob/master/components/modules/MyBlog/list.php">list.php</a> : <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">MyBlog</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>, <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">Page</span></span>, <span class="hljs-title"><span class="hljs-title">h</span></span>; $rc = Config::instance()-&gt;route; $page = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($rc[<span class="hljs-number"><span class="hljs-number">1</span></span>]) &amp;&amp; $rc[<span class="hljs-number"><span class="hljs-number">1</span></span>]) { $page = (int)$rc[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } $Page = Page::instance(); $Posts = Posts::instance(); $total_count = $Posts-&gt;total_count(); $Page-&gt;content( h::{<span class="hljs-string"><span class="hljs-string">'a.cs-button-compact'</span></span>}( h::icon(<span class="hljs-string"><span class="hljs-string">'plus'</span></span>).<span class="hljs-string"><span class="hljs-string">'  '</span></span>, [ <span class="hljs-string"><span class="hljs-string">'href'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyBlog/post/add'</span></span> ] ) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$total_count) { $Page-&gt;content( h::{<span class="hljs-string"><span class="hljs-string">'p.cs-center.uk-text-info'</span></span>}(<span class="hljs-string"><span class="hljs-string">'  '</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } $Page-&gt;title(<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($page &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { $Page-&gt;title(<span class="hljs-string"><span class="hljs-string">" $page"</span></span>); } $Page-&gt;content( h::{<span class="hljs-string"><span class="hljs-string">'section article.cs-myblog-posts'</span></span>}( h::{<span class="hljs-string"><span class="hljs-string">'h1 a[href=MyBlog/post/$i[id]]'</span></span>}(<span class="hljs-string"><span class="hljs-string">'$i[title]'</span></span>). h::div(<span class="hljs-string"><span class="hljs-string">'$i[text]'</span></span>). h::footer(<span class="hljs-string"><span class="hljs-string">'$i[datetime], $i[username]'</span></span>), [ <span class="hljs-string"><span class="hljs-string">'insert'</span></span> =&gt; $Posts-&gt;get($Posts-&gt;posts($page)) ] ). ( $total_count &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> ? h::{<span class="hljs-string"><span class="hljs-string">'div.cs-center'</span></span>}(pages($page, ceil($total_count / <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($page)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $page &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> ? <span class="hljs-string"><span class="hljs-string">'MyBlog'</span></span> : <span class="hljs-string"><span class="hljs-string">"MyBlog/list/$page"</span></span>; })) : <span class="hljs-string"><span class="hljs-string">''</span></span> ) );</code> </pre><br></div></div><br>  The namespace is the same in almost all module files. <br>  <code>Config::instance()-&gt;route</code> - allows you to get an indexed array of page path elements without taking into account the module name.  In this case, it is used to determine which page the user opens, for example, for <code>MyBlog/list/3</code> we get the array <code>['list', 3]</code> .  In general, the files mentioned above are views + authorization checks. <br><br><h4>  API </h4><br>  Yes, we will not use the external API in the module itself, but we will still do it (it may be useful to someone).  Let's do the simplest thing - managing specific posts (for example, to edit posts without reloading the page).  Create several files in <a href="https://github.com/nazar-pc/MyBlog/tree/master/components/modules/MyBlog/api">components / modules / MyBlog / api</a> : <br><ul><li>  index.delete.php </li><li>  index.get.php </li><li>  index.post.php </li><li>  index.put.php </li></ul><br>  I think the file names tell a lot about themselves.  In the simplest case, we don‚Äôt have any structure and we don‚Äôt need index.json - we simply create a pack of index files for each type of DELETE / GET / POST / PUT request and the CMS will find these files itself.  Suffixes can be used in the API in a similar way and with a nested structure with index.json.  An example API request: <br><blockquote>  POST api / MyBlog <br>  { <br>  "Title": "Blog post title", <br>  "Text": "Blog post content" <br>  } </blockquote><br>  You can send JSON if you remember to specify Content-type: application / json. <br>  In response, either: <br><blockquote>  201 Created <br>  ... <br>  { <br>  "Id": "5" <br>  } </blockquote><br>  Either the code and the error message. <br>  Here is the <a href="https://github.com/nazar-pc/MyBlog/blob/master/components/modules/MyBlog/api/index.post.php">index.post.php</a> file that does this: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">MyBlog</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">cs</span></span>\<span class="hljs-title"><span class="hljs-title">Page</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'title'</span></span>], $_POST[<span class="hljs-string"><span class="hljs-string">'text'</span></span>])) { error_code(<span class="hljs-number"><span class="hljs-number">400</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($post = Posts::instance()-&gt;add($_POST[<span class="hljs-string"><span class="hljs-string">'title'</span></span>], $_POST[<span class="hljs-string"><span class="hljs-string">'text'</span></span>])) { code_header(<span class="hljs-number"><span class="hljs-number">201</span></span>); Page::instance()-&gt;json([ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $post ]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { error_code(<span class="hljs-number"><span class="hljs-number">500</span></span>); }</code> </pre><br>  <code>Page::instance()-&gt;json()</code> allows you to send data as it is (for example, arrays), and the method will make the JSON string itself and add the necessary headers.  The same goes to <code>error_code()</code> , just pass the error code - everything else will be done automatically. <br><br><h4>  At last </h4><br>  In order to build the installation distribution of our module, create a file <a href="">components / modules / MyBlog / meta.json</a> with some service information: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"package"</span></span> : <span class="hljs-string"><span class="hljs-string">"MyBlog"</span></span>, <span class="hljs-string"><span class="hljs-string">"category"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span> : <span class="hljs-string"><span class="hljs-string">"0.0.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Simple demo blog module"</span></span>, <span class="hljs-string"><span class="hljs-string">"author"</span></span> : <span class="hljs-string"><span class="hljs-string">"Nazar Mokrynskyi"</span></span>, <span class="hljs-string"><span class="hljs-string">"website"</span></span> : <span class="hljs-string"><span class="hljs-string">"cleverstyle.org/cms"</span></span>, <span class="hljs-string"><span class="hljs-string">"license"</span></span> : <span class="hljs-string"><span class="hljs-string">"MIT License"</span></span>, <span class="hljs-string"><span class="hljs-string">"db_support"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"MySQLi"</span></span> ], <span class="hljs-string"><span class="hljs-string">"provide"</span></span> : <span class="hljs-string"><span class="hljs-string">"myblog"</span></span>, <span class="hljs-string"><span class="hljs-string">"optional"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"editor"</span></span> ], <span class="hljs-string"><span class="hljs-string">"languages"</span></span> : [ <span class="hljs-string"><span class="hljs-string">""</span></span> ] }</code> </pre><br>  As expected, we add <a href="https://github.com/nazar-pc/MyBlog/blob/master/components/modules/MyBlog/license.txt">components / modules / MyBlog / license.txt</a> , as well as <a href="https://github.com/nazar-pc/MyBlog/blob/master/components/modules/MyBlog/prepare.php">components / modules / MyBlog / prepare.php</a> and <a href="">components / modules / MyBlog / languages ‚Äã‚Äã/ Russian.json</a> in order to make the title of the post page beautiful and localize the name module. <br>  Well, when everything is ready - we take <a href="https://github.com/nazar-pc/CleverStyle-CMS">CleverStyle CMS</a> from the <a href="https://github.com/nazar-pc/CleverStyle-CMS">repository</a> and add it to the root of the site: <br><ul><li>  build </li><li>  install </li><li>  build.php </li><li>  install.php </li></ul><br>  We add several lines to .htaccess (so that the engine does not intercept calls to this file): <br><blockquote>  &lt;Files build.php&gt; <br>  RewriteEngine Off <br>  &lt;/ Files&gt; <br></blockquote><br>  Go to the <code>build.php</code> address, select the Module, select MyBlog from the list, click Build. <br>  At the root of the site we get the file <code>MyBlog_0.0.2.phar.php</code> , which can be used to install on another copy of the system. <br><br><h4>  What else can you do? </h4><br>  If you need styling posts: <br><ul><li>  create components / modules / MyBlog / includes / .htaccess <br><blockquote>  Allow from all <br>  RewriteEngine Off <br></blockquote><br></li><li>  put the required style files in components / modules / MyBlog / includes / css, the system will pick them up (similar to JavaScript in components / modules / MyBlog / includes / js) and <div class="spoiler">  <b class="spoiler_title">will process</b> <div class="spoiler_text">  files in production are merged and compressed using gzip, and css files additionally clear comments and embed inclusions such as imported css styles, fonts, images, so everything is in one file </div></div><br></li></ul><br>  A <a href="https://github.com/nazar-pc/MyBlog">special test repository has been</a> created for this article. <br>  I hope that such an approach, when the minimum of the accompanying code is used and the structure is simply nowhere easier, will appeal not only to me. <br>  Thank you for your attention, I will be glad to questions and constructive criticism. <br><br>  <b>UPD pair of screenshots:</b> <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a8f/28d/089/a8f28d0891ca85afe48e7a0379af19d0.png"></a> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5dd/4a5/398/5dd4a53981392df1692ff535fbd1b8a1.png"></a> <br></div></div><br>  <b>UPD 11.11.2013:</b> In the new version of the engine, the CRUD trait appeared, the Posts class was edited, and it became easier with its use. </div><p>Source: <a href="https://habr.com/ru/post/196712/">https://habr.com/ru/post/196712/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196700/index.html">Geolocation - how to earn us</a></li>
<li><a href="../196702/index.html">Runnable: search engine code with its execution in the VM</a></li>
<li><a href="../196704/index.html">NASA continues to work on a number of projects during the budget crisis, as an exception to the rules</a></li>
<li><a href="../196708/index.html">Unlock the Android screen using NFC</a></li>
<li><a href="../196710/index.html">3CX Phone System Pro Edition has been released.</a></li>
<li><a href="../196714/index.html">3CX Hotel Module - hotel module for 3CX Phone System 12</a></li>
<li><a href="../196716/index.html">Step into the future for Yandex.Market</a></li>
<li><a href="../196718/index.html">Prerender</a></li>
<li><a href="../196720/index.html">Some interesting and useful things for a web developer (release 5)</a></li>
<li><a href="../196726/index.html">Service coordinate axes or how to combine IT and telecommunications management methodologies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>