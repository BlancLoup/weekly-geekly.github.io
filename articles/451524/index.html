<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tale of how the maker Autoplay Media Studio 8.5.3.0 broke</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As it is not difficult to guess, the kettle is me. 

 I wanted one of these days to look at the source of one utility, obviously made by means of AMS ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tale of how the maker Autoplay Media Studio 8.5.3.0 broke</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/_j/hw/x7/_jhwx7ujb4v6_qha53qhum2ay-o.png" alt="image"><br><br>  As it is not difficult to guess, the kettle is me. <br><br>  I wanted one of these days to look at the source of one utility, obviously made by means of AMS (.cdd file next to .exe and a pair of lua * .dll).  A couple of years ago I made out in detail one program made with similar means and the idea of ‚Äã‚Äãpacking .cdd, which is a regular zip archive with a password, is available.  Well, I did not <a href="https://lifeinhex.com/static-unpacker-for-autoplay-media-studio-files/">hesitate</a> in <a href="https://lifeinhex.com/static-unpacker-for-autoplay-media-studio-files/">AMSUnpacker</a> stuffed and got an unpacking error.  Well, from this moment began the most interesting ... <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first thought that came to mind that the file is packed with something other than UPX (which I naturally unpacked).  Well, what I just did not check (DIE, Exeinfo PE, Nauz File Detector) and all convince me that no, not packed.  Well, I think, I‚Äôll compare the trite .exe means of Total Commander of the previously unpacked program and this one, and it turned out that the .exe is very different (previously it compared other programs on AMS and the difference was only in single bytes, in fact, in the password written in clear text just the .exe and resource part).  It became clear that this is either a modified and just a new version of AMS.  In the last I believed with difficulty, knowing (well, I thought so at first that I knew) that the developers had long been beaten up for the program, but didn‚Äôt check it out or not, and it‚Äôs unlikely that it would give anything. <br><br>  I began to delve into more detail, somehow in x64dbg, with which I am on ‚ÄúYou,‚Äù found in the old version of the program a place where the password is ‚Äúread‚Äù.  Having rummaged through the same x64dbg in the ‚Äúnew‚Äù version, it turned out that they are not that different, and there are more functions in it than in the old one.  I found a similar place where instead of the cherished <i>push &lt;the address where the password is stored&gt; there</i> was some kind of <i>mov &lt;something there&gt;</i> and several calls of some other functions, and a few lines below the code is similar to that in the old version. <br><br><img src="https://habrastorage.org/webt/9x/37/z-/9x37z-40dldhrk3pkqufzjrjw24.png" alt="image"><br>  <i>(on the left - the old version, on the right - the new)</i> <br><br>  And here I am depressed, because my knowledge of the debugger is clearly not enough to figure it all out. <br>  One thought appeared - to find some other similar unpackable program and compare them with .exe.  Such a program was found by the same author as the one I was trying to unpack.  And the file comparison gave its result.  In addition to minor differences, there was a whole block of different data: <br><br><img src="https://habrastorage.org/webt/g1/-y/sw/g1-yswf_kppbniurspq2svqqfpq.png" alt="image"><br><br>  And the joy that I found that unique place where apparently the password was contained, and the disappointment that this is clearly not a password, as it was in previous versions. <br><br>  There was nothing left to understand the debugger.  The whole ‚Äútrouble‚Äù is that I know the assembler at the level of several commands, with a very superficial idea of ‚Äã‚Äãwhat they are doing, and the debugger itself is at the level of several watched videos on youtube and a little experience of its use, mainly ‚Äúat random‚Äù. <br><br>  After a bad hour of running the debugger and an incalculable number of restarts, I somehow found a place where the cherished bytes are read and a little later I found a piece of code that does some sort of manipulation with these bytes: <br><br><img src="https://habrastorage.org/webt/zo/al/qe/zoalqevl6bovhetxr4-y8qiri3i.png" alt="image"><br><br>  It took a lot of time to understand what was going on there. <br><br>  Somehow I figured out that this is some kind of cipherblock, where there are two tables, one is an encrypted password, where the corresponding symbol indicates just the position in the second notebook. <br><br><img src="https://habrastorage.org/webt/qi/c-/vz/qic-vztarwtuv3ngughmsez8e1o.png" alt="image"><br><br>  In general, replacing the lower table values ‚Äã‚Äãwith the corresponding values ‚Äã‚Äãfrom the upper table, we obtain an array of bytes: <i>7B 10 DD 5A 4D 26 72 EE B2 2A 04 2B 6E F7 14 E2 F9 14 F8 9E 8A 99 28 AE B8 4B C0 D7 42 DA AD</i> . <br><br>  For what other unique byte arrays, I did not understand before and after the decryption required for the password, but didn‚Äôt really get into it either.  I suspect that there are some checksums ... <br><br>  And then it‚Äôs already a matter of small things; convert it into a string and unpack the coveted .cdd archive with this password.  A minor problem was that the resulting line could not be inserted into the archiver via Ctrl + C -&gt; Ctrl-V, since  characters "break" in the clipboard (especially the essence did not penetrate).  You can unpack only in software.  Fortunately, there is some knowledge of C # (the level of which in general is not much different from the level of knowledge of the debugger) and little experience in learning how the previously mentioned AMSUnpacker works, which is also written in C # and see what it does and how it works. <br><br>  Practically on my knee I used the utility to test the performance of the previously studied algorithm, and voila, it works. <br><br>  You can download it <a href="http://rgho.st/private/7Dm7znrbK/fb0c4b26b8a174484e37a9e276c19483">here</a> . <br><br><img src="https://habrastorage.org/webt/_4/bu/up/_4buupv1t1j33udxn5s5ixagyx8.png" alt="image"><br><br>  The program, similar to the previously mentioned AMSUnpacker, creates an <i>extracted_cdd</i> folder next to the .exe with the contents of the .cdd archive. <br><br>  After successful unpacking of the cherished .cdd file, I learned that this is a ‚Äúnew‚Äù version (from the end of 2018) AMS 8.5.3.0.  And on the site they read about the new version: <i>Feature: Enhanced.</i>  .  Well, as you can see, it did not work out very well ... <br><br>  I have a question for the knowledgeable, such an algorithm for hiding a password, is it part of some standard encryption algorithm (I mean it is now applicable in programs, and not historically), or is it the way that the developers most likely conceived it? <br><br>  PS I know that the easiest way to get the source of the programs on lua (which uses AMS) is through patched lua * .dll, which walk on the Internet and / or external hook of the function lua_load () in the same lua * .dll.  This is all I once did.  In this situation, it was a purely sporting interest to figure out how to get the password for .cdd.  And I also understand perfectly well that it is unlikely that anyone will need it and does not bear any particular practical value. <br><br>  I probably exaggerated regarding the "kettle", because  little programming and reverse experience is available, but this is just a small hobby ‚Äúfor oneself‚Äù and there is not much time or desire to delve deeply into it. <br><br>  PPS This is my first article on Habr√©, as well as, probably, the first of this type. </div><p>Source: <a href="https://habr.com/ru/post/451524/">https://habr.com/ru/post/451524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451512/index.html">How to disassemble the network protocol mobile MMORPG</a></li>
<li><a href="../451516/index.html">Design Patterns Used in the Spring Framework</a></li>
<li><a href="../451518/index.html">Our reduced mobile websites</a></li>
<li><a href="../45152/index.html">Survival Campaign Report (Episode III)</a></li>
<li><a href="../451522/index.html">We develop automation in a couple of hours: TypeScript, Protractor, Jasmine</a></li>
<li><a href="../451528/index.html">‚ÄúAnd so it will come down‚Äù: that cloud providers do not agree on personal data</a></li>
<li><a href="../451532/index.html">News from the world of OpenStreetMap ‚Ññ459 (04.30.2019-06.05.2019)</a></li>
<li><a href="../451536/index.html">The future is here: AI will control melee on American fighters</a></li>
<li><a href="../451538/index.html">Amazon Redshift Parallel Scaling Guide and Test Results</a></li>
<li><a href="../451544/index.html">Gathering of the system operators of the ‚ÄúMedium‚Äù network points in Moscow, on May 18 at 14:00 at the Patriarshie Prudy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>