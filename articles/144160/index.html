<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Once again about currying and partial application in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a recent article, the proposed implementation of currying (currying) and partial application (partial function application) in PHP. Its fundamental...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Once again about currying and partial application in PHP</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/67d/d69/682/67dd69682cc071a8e81e012abe7d901b.jpg" align="left" alt=" " title="The art of currying">  In a recent <a href="http://habrahabr.ru/post/143957/">article, the</a> proposed implementation of <i>currying</i> (currying) and <i>partial application</i> (partial function application) in PHP.  Its fundamental disadvantage is that the result of currying is not a function, but an object.  It can no longer be passed as a callback parameter, and for the argument substitution one has to use a special syntax.  This text proposes a new, transparent implementation of these constructs for PHP 5.3 and above. <br><br>  <i>The term</i> currying <i>comes from the surname of the American mathematician Haskell Curry.</i>  <i>The second meaning of the word</i> currying <i>- tanning leather tanning.</i> <br><br>  The concepts of currying and partial application come from functional programming languages, within the framework of which they find the widest application.  Modern PHP tends to borrow some elements of functional programming (functions as first-class objects, anonymous functions, and closures), so the concepts discussed are no longer completely foreign to it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Emulation of currying and partial application in PHP is one example of what McConnell in ‚ÄúPerfect Code‚Äù (Ch. 4.3) calls programming <b>using</b> language rather than language. <br><a name="habracut"></a><br><h4>  Short educational program </h4><br>  Currying and partial application are used to build factories of functions.  This technique is especially useful if you need to generate a function with a given interface to pass to another function as an argument to perform custom filtering, sorting, transformation, etc. Let us have a certain function with many parameters and we want to massively build functions that coincide with given when fixing certain arguments. <br><br>  For example, suppose we have a ‚Äúblack box‚Äù - the function solve ( <i>f</i> , <i>x</i> <sub>0</sub> , <i>Œµ</i> ), which finds a solution to the equation <i>f</i> ( <i>x</i> ) = 0 in a neighborhood of the initial point <i>x</i> <sub>0</sub> with an accuracy <i>Œµ</i> .  Then, by calling the partial application, we can construct the function solve1 ( <i>x</i> <sub>0</sub> , <i>Œµ</i> ) solve ( <i>x</i> - tan <i>x</i> , <i>x</i> <sub>0</sub> , <i>Œµ</i> ).  Or even the solve2 ( <i>Œµ</i> ) function, which would solve some fixed equation in a neighborhood of a fixed initial point with variable accuracy. <br><br>  Of course, in each particular case we can write a wrapper function of type <br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solve_x_minus_tan_x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($x0, $eps)</span></span></span></span>{ $f = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $x - tan($x); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> solve($f, $x0, $eps); }</code> </pre> <br>  however, it would be more convenient to have a universal mechanism, which is a partial application. <br><br>  Currying is a procedure that converts a function of <i>n</i> variables into a chain of <i>n</i> functions of one variable, performing alternate argument substitution.  For example, let add ( <i>a</i> , <i>b</i> ) = <i>a</i> + <i>b</i> , a curry_add be the result of currying the add function.  Then the call to curry_add ( <i>a</i> ) for each a will generate functions of one argument, adding a to it, that is, curry_add ( <i>a</i> ) ( <i>b</i> ) = add ( <i>a</i> , <i>b</i> ).  More examples will be given below. <br><br>  More details on currying and partial application can be found in E. Kirpicheva's large article ‚Äú <a href="http://fprog.ru/2009/issue3/eugene-kirpichov-elements-of-functional-languages/">Elements of Functional Languages</a> ‚Äù (section 5). <br><br><h4>  Curry function </h4><br>  So, slides.  All we need is the following code, which replaces the original function with its curried version. <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">curry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($callback, $args = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* $callback -   $args -   ,     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> $ret = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($callback, $args)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> $func = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReflectionFunction($callback); $num = $func-&gt;getNumberOfParameters(); <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> $args = array_merge($args, func_get_args()); <span class="hljs-comment"><span class="hljs-comment">/*      , */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(count($args) &gt;= $num){ <span class="hljs-comment"><span class="hljs-comment">/*           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> call_user_func_array($callback, $args); } <span class="hljs-comment"><span class="hljs-comment">/*    ,  , */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*            */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> curry($callback, $args); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ret; }</code> </pre><br><h4>  Classic example </h4><br>  Suppose we have a function add. <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a + $b; }</code> </pre><br>  We can build a curried version of it. <br><pre> <code class="php hljs">$add = curry(<span class="hljs-string"><span class="hljs-string">"add"</span></span>);</code> </pre><br>  We verify that the resulting function behaves in the same way as the original one. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $add(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  7</span></span></code> </pre><br>  Now we substitute only the first argument to generate the increment and decrement functions. <br><pre> <code class="php hljs">$inc = $add(<span class="hljs-number"><span class="hljs-number">1</span></span>); $dec = $add(<span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $inc(<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  7 echo $dec(8); //  7</span></span></code> </pre><br><h4>  More examples </h4><br>  We can completely transparently substitute an arbitrary number of initial arguments and get a full function in which not all arguments can be substituted again.  For example, <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_and_mul</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $b, $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a + $b * $c; } $add_and_mul = curry(<span class="hljs-string"><span class="hljs-string">"add_and_mul"</span></span>); $test1 = $add_and_mul(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    $test2 = $add_and_mul(1, 2); //    $test3 = $add_and_mul(1); //    $test4 = $test3(2); //    //     7 echo $test1; echo $test2(3); echo $test3(2, 3); echo $test4(3);</span></span></code> </pre><br>  The result of currying can be passed without problems as a callback parameter of another function.  For example, suppose we need to calculate the masses of cubes from the density and the array of lengths of the sides.  We can do this as follows. <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* ,         */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($density, $length)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $density * $length * $length * $length; } <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> $mass = curry(<span class="hljs-string"><span class="hljs-string">"mass"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* ,     */</span></span> $steel_mass = $mass(<span class="hljs-number"><span class="hljs-number">7.9</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> $lengths = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> $masses = array_map($steel_mass, $lengths); <span class="hljs-comment"><span class="hljs-comment">/*  Array ( [0] =&gt; 213.3 [1] =&gt; 63.2 [2] =&gt; 987.5 [3] =&gt; 1706.4 [4] =&gt; 7.9 ) */</span></span> print_r($masses);</code> </pre><br><h4>  Notes </h4><br><ol><li>  From the point of view of the PHP interpreter, the result of our currying is not a function, but an object of the <a href="http://ua.php.net/manual/ru/class.closure.php">Closure</a> class, since it is built as an anonymous closure.  However, in terms of syntax, the substitution is completely transparent. </li><li>  For obvious reasons, functions with a variable number of arguments of type printf () cannot be curried.  In our implementation, all the arguments of the function become mandatory, even if they were marked as optional in the original signature.  It should also be noted that when trying to count the number of arguments of the curved function, getNumberOfParameters () returns 0. </li><li>  Strictly speaking, a curried function should take arguments one by one, that is, instead of $ add (2, 5), you must write $ add (2) (5).  However, the current version of the PHP interpreter considers func (arg1) (arg2) entries as a syntax error, even if semantically correct.  Therefore, for convenience, our implementation allows you to specify several arguments at once, separated by commas, which brings it closer to partial application. </li></ol><br><br>  <b>Unveiled</b>  <b>from 08/01/12:</b> See also about PHP currying into the article ‚Äú <a href="http://habrahabr.ru/post/148899/">Object-Oriented Functional</a> <b>Meta-Programming</b> <a href="http://habrahabr.ru/post/148899/">or Currying of a Method</a> ‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/144160/">https://habr.com/ru/post/144160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144153/index.html">Iran sues Google</a></li>
<li><a href="../144155/index.html">The quantum computer still does not come out, but there are a lot of other interesting pieces.</a></li>
<li><a href="../144156/index.html">Petition: OpenMAX IL Update for Qualcomm MSM7227 Based Devices</a></li>
<li><a href="../144158/index.html">Ex-PATRIOT Act vs. Facebook Co-Founder</a></li>
<li><a href="../144159/index.html">The complication of life in LaTeX</a></li>
<li><a href="../144161/index.html">Django and the features of using transactions in MySQL</a></li>
<li><a href="../144162/index.html">Team Foundation Server Express</a></li>
<li><a href="../144163/index.html">Analysts do not see signs of a speedy recovery of Oracle hardware business</a></li>
<li><a href="../144165/index.html">‚ÄúTry to guess‚Äù, or for what usability experts receive money</a></li>
<li><a href="../144166/index.html">Google received the latest approval for the Motorola deal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>