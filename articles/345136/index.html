<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AAA! It's time to rewrite to .NET Core«É</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We all want to climb on .NET Core for a long time, but something is constantly interfering. For example, nothing can be done when there are not enough...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AAA! It's time to rewrite to .NET Core«É</h1><div class="post__text post__text-html js-mediator-article"><p>  We all want to climb on .NET Core for a long time, but something is constantly interfering.  For example, nothing can be done when there are not enough important APIs.  In version 2.0, the process has been simplified thanks to <a href="https://blogs.msdn.microsoft.com/dotnet/2017/08/14/announcing-net-standard-2-0/">.NET Standard 2.0</a> , but that's not all.  Well, Microsoft-gods <a href="https://blogs.msdn.microsoft.com/dotnet/2017/11/16/announcing-the-windows-compatibility-pack-for-net-core/">listened to our prayers</a> and <strong>delivered 20,000 APIs</strong> , available as a single package in NuGet! </p><br><p><img src="https://habrastorage.org/webt/7t/7y/nu/7t7ynubqjfykixuoaebywicsmdo.png"></p><a name="habracut"></a><br><h1 id="komu-eto-voobsche-nuzhno">  Who needs it at all? </h1><br><p>  In short, everyone needs this.  IMHO, the very possibility of dragging your tons of Legacy to the .NET Core is already enough justification for any casualties. </p><br><p>  Skeptics, however, need to be reminded that the .NET Core is being sawn specifically for scalable web applications on all reasonable operating systems (GNU / Linux, macOS and Windows), and a more <a href="https://docs.microsoft.com/dotnet/standard/choosing-core-framework-server">specific document</a> will help you choose between Core and Framework. </p><br><h1 id="kak-eto-ispolzovat">  How to use it? </h1><br><p>  First, it is necessary to understand that the deposits of the Legacy themselves will not be raked.  There is nothing even to think about grabbing a million classes and dragging them with one button. </p><br><p>  Suppose you nakadilu on ASP.NET MVC for Windows-localhost, and you are not fired for this.  It‚Äôs time to drag it to a true Linux running on Azure!  It is better to eat an elephant in pieces, namely: </p><br><ul><li>  Drag and drop everything onto an ASP.NET Core (but continue to hold the .NET Framework as the target platform); </li><li>  Crawl to .NET Core (but continue to use Windows); </li><li>  Jump to GNU / Linux; </li><li>  Run on Azure. </li></ul><br><p>  It is clear that this great plan should not be approached as the construction of communism, but sensibly.  For example, if you want to show the big bosses launch on Azure - this is the place to start.  If you think laziness (for example, I‚Äôm exactly lazy), our leaders wrote a <a href="https://docs.microsoft.com/dotnet/core/porting/">special training manual for gaining faith in the .NET Core</a> . </p><br><p>  In short, you need to uncover NuGet, install the <a href="https://www.nuget.org/packages/Microsoft.Windows.Compatibility">Microsoft.Windows.Compatibility</a> package <a href="https://www.nuget.org/packages/Microsoft.Windows.Compatibility">,</a> and find that a huge pile of different useful and unnecessary APIs have become available. </p><br><p>  It is important to understand that this very <strong>Microsoft.Windows.Compatibility</strong> is still furiously finishing, so that all the amazing stories are just ahead of us. </p><br><p>  Now we have the following set of nishtyaks (the table turned out to be huge; the man reading this post from the mobile: please forgive me!): </p><br><table><thead><tr><th align="left">  Component </th><th align="left">  Status </th><th align="left">  Windows-Only </th></tr></thead><tbody><tr><td align="left">  Microsoft.Win32.Registry </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  Microsoft.Win32.Registry.AccessControl </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.CodeDom </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.ComponentModel.Composition </td><td align="left">  Coming </td><td align="left"></td></tr><tr><td align="left">  System.Configuration.ConfigurationManager </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.Data.DatasetExtensions </td><td align="left">  Coming </td><td align="left"></td></tr><tr><td align="left">  System.Data.Odbc </td><td align="left">  Coming </td><td align="left"></td></tr><tr><td align="left">  System.Data.SqlClient </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.Diagnostics.EventLog </td><td align="left">  Coming </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Diagnostics.PerformanceCounter </td><td align="left">  Coming </td><td align="left">  Yes </td></tr><tr><td align="left">  System.DirectoryServices </td><td align="left">  Coming </td><td align="left">  Yes </td></tr><tr><td align="left">  System.DirectoryServices.AccountManagement </td><td align="left">  Coming </td><td align="left">  Yes </td></tr><tr><td align="left">  System.DirectoryServices.Protocols </td><td align="left">  Coming </td><td align="left"></td></tr><tr><td align="left">  System.Drawing </td><td align="left">  Coming </td><td align="left"></td></tr><tr><td align="left">  System.Drawing.Common </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.IO.FileSystem.AccessControl </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.IO.Packaging </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.IO.Pipes.AccessControl </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.IO.Ports </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Management </td><td align="left">  Coming </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Runtime.Caching </td><td align="left">  Coming </td><td align="left"></td></tr><tr><td align="left">  System.Security.AccessControl </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Security.Cryptography.Cng </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Security.Cryptography.Pkcs </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Security.Cryptography.ProtectedData </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Security.Cryptography.Xml </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Security.Permissions </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.Security.Principal.Windows </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.ServiceModel.Duplex </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.ServiceModel.Http </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.ServiceModel.NetTcp </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.ServiceModel.Primitives </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.ServiceModel.Security </td><td align="left">  Available </td><td align="left"></td></tr><tr><td align="left">  System.ServiceModel.Syndication </td><td align="left">  Coming </td><td align="left"></td></tr><tr><td align="left">  System.ServiceProcess.ServiceBase </td><td align="left">  Coming </td><td align="left">  Yes </td></tr><tr><td align="left">  System.ServiceProcess.ServiceController </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Text.Encoding.CodePages </td><td align="left">  Available </td><td align="left">  Yes </td></tr><tr><td align="left">  System.Threading.AccessControl </td><td align="left">  Available </td><td align="left">  Yes </td></tr></tbody></table><br><h1 id="a-chto-delat-s-windows-only-api">  And what to do with the Windows-only API? </h1><br><blockquote>  Suffer, what. </blockquote><p>  For tankers.  Not all APIs are equally portable.  If you stay on Windows, there are no problems.  If you want to join the holiness of Richard Stallman and Tim Cook on GNU / Linux and macOS, respectively, you will have to suffer. </p><br><p> Looking at the label nishtyakov, we see: there are almost half of the Windows-only components.  Good Microsoft gods, however, allow you to successfully compile such code under any platform.  When trying to use a non-existent feature, we will come across <code>PlatformNotSupportedException</code> in runtime, so all such features will need to be thickly smeared with calls to <code>RuntimeInformation.IsOSPlatform()</code> : </p><br><pre> <code class="hljs pgsql">private static string GetLoggingPath() { // Verify the code <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> running <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Windows. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RuntimeInformation.IsOSPlatform(OSPlatform.Windows)) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var key = Registry.CurrentUser.OpenSubKey(@"Software\Fabrikam\AssetManagement")) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (key?.GetValue("LoggingDirectoryPath") <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> string configuredPath) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> configuredPath; } } // This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> either <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> running <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Windows <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> logging <span class="hljs-type"><span class="hljs-type">path</span></span> was configured, // so just use the <span class="hljs-type"><span class="hljs-type">path</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> non-roaming <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-specific data files. var appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span>.Combine(appDataPath, "Fabrikam", "AssetManagement", "Logging"); }</code> </pre> <br><p>  How to understand which API-scale will work only in Windows?  Nobody reads the documentation, right? </p><br><p>  Dear my lover of programming copy-paste with StackOverflow!  Microsoft - the gods are harsh, but fair, so just a couple of weeks ago, they wrote down the <a href="https://blogs.msdn.microsoft.com/dotnet/2017/10/31/introducing-api-analyzer/">API Analyzer tool</a> .  With Roslyn, this tula marks the Windows-only API, and only when the target is set to .NET Core or .NET Standard. </p><br><p><img src="https://habrastorage.org/webt/o2/ny/5b/o2ny5b9d-zvw7_tp9h6phn5qds4.png"></p><br><p>  What to do with errors?  As mentioned earlier, suffer. </p><br><ul><li>  Delete unported code.  Why do I need a feature if it does not run on macOS?  :-) </li><li>  Diligently refactor code using other, more cross-platform APIs.  The benefit of this update brought such a set. </li><li>  Arrange checks on the type of OSes in those places where GNU / Linux-specific things happen that are simply not needed in Windows. </li></ul><br><p>  In the example from the picture, someone is trying to subtract the settings in the Registry.  You can wrap this line in the test, perform it only on Windows.  In GNU / Linux, the equivalent of this line will be different, much more painful. </p><br><p>  Note that the <em>Windows Compatibility Pack</em> is a meta package.  Microsoft was well aware that ordinary people would not be tormented by searching for individual small sachets and would want to switch to a new platform in one leap (subject to the reservations above).  However, if you are a thoughtful cool developer, then you can drag out features one by one.  Thus, it will be possible to throw out much more dependencies on unnecessary trash. </p><br><h1 id="chto-dalshe">  What's next? </h1><br><p>  Moral preparing for porting.  Install <a href="https://www.nuget.org/packages/Microsoft.Windows.Compatibility">Windows Compatibility Pack</a> .  You study nishtyaki, of which there are more than 20 thousand, including EventLog, WMI, Performance Counters, Windows Services and so on. </p><br><p>  If you want to make a cross-platform app, you run the API Analyzer.  You can pre-cry a little or vapka vodka. </p><br><p>  Unfortunately, now .NET Core does not cover the needs of desktop development.  Maybe someday this will change.  But that's another story. </p><br><p>  If you want to learn more about .NET in general and .NET Core in particular, we are waiting for you on <a href="https://dotnext-piter.ru/">DotNext 2018 Piter</a> , which will take place, suddenly, in St. Petersburg.  I strongly advise to this confer to try to file something or port to Core so that a pool of questions for the speakers has accumulated. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/345136/">https://habr.com/ru/post/345136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345126/index.html">Mobile UX-design in 2018: trends and forecasts</a></li>
<li><a href="../345128/index.html">How have the interfaces of trading scales changed</a></li>
<li><a href="../345130/index.html">Windows server for 24x7 tasks - a myth or my ‚Äúcrooked hands‚Äù?</a></li>
<li><a href="../345132/index.html">Magic points in the clouds and something fundamentally new: why every 100th citizen of the Russian Federation shakes nanoCAD</a></li>
<li><a href="../345134/index.html">Structural Operations</a></li>
<li><a href="../345138/index.html">Bitcoin farhulst</a></li>
<li><a href="../345140/index.html">From 15 and more: how to ensure the scalability of CI</a></li>
<li><a href="../345142/index.html">Why Agile doesn't work and what to do about it.</a></li>
<li><a href="../345144/index.html">ITIL update: what's new in 2018</a></li>
<li><a href="../345146/index.html">CompTIA Network + Certification</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>