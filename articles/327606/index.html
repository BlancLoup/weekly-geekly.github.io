<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL101: Change Recovery Model</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Note from the translator: The number 101 in American colleges usually denotes an introductory course, which gives a basic knowledge of the subject are...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL101: Change Recovery Model</h1><div class="post__text post__text-html js-mediator-article">  <i>Note from the translator: The number 101 in American colleges usually denotes an introductory course, which gives a basic knowledge of the subject area.</i> <br><br>  SQLskills launches new record placement initiative with basic knowledge, we called it SQL101.  We will write about things that, as we often see, are done incorrectly, technologies that are used incorrectly, and many misunderstandings that lead to serious problems.  If you want to find all the records in this series, check out the link <a href="http://sqlskills.com/help/SQL101">SQLskills.com/help/SQL101</a> (English). <br><br>  One of the things that may lie in wait for you during administration is the effect of a temporary switch from the full recovery model to another.  In this article, I will briefly describe the three recovery models and problems that can arise when switching from a full model to a simple one and from a full to a model with incomplete logging (bulk-logged). <br><a name="habracut"></a><br><h2>  Recovery models </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are three recovery models: <br><br><ul><li>  Full recovery model (used by default and most often) <br><br><ul><li>  All changes in the database are fully logged.  This does not mean that each change has a separate log entry, since some operations are written with a smaller number of log entries, but the full effect of the operation is nevertheless logged (for example, the TRUNCATE TABLE operation ‚Äî see <a href="https://sqlperformance.com/2013/05/sql-performance/drop-truncate-log-myth">here the full explanation</a> (English)). <br><br></li><li>  The transaction log will not be cleared (that is, parts of it will not be available for reuse) until the transaction log has been backed up (see <a href="http://www.sqlskills.com/blogs/paul/misconceptions-around-the-log-and-log-backups-how-to-convince-yourself/">here for a full explanation</a> (English)). <br><br></li><li>  All restore options are available when the database is in the full recovery model (and has been in it since the last backup was created). </li></ul><br></li><li>  The incomplete logging recovery model <br><br><ul><li>  Some changes (such as rebuilding the index or batch loading, but NOT standard INSERT / UPDATE / DELETE) can be minimally logged, which reduces the number of entries in the log and the transaction log does not become too large during the execution of these operations.  Note that this does not change the size of subsequent transaction log backups.  For complete instructions on how to make your operations minimally logged, see the <a href="https://technet.microsoft.com/en-us/library/dd425070%2528v%3Dsql.100%2529.aspx">‚ÄúData Loading Performance Guide‚Äù</a> (English) document that describes all the possible conditions that must be met. <br><br></li><li>  The transaction log will not be cleared (that is, parts of it will not be available for reuse) until the transaction log has been backed up (absolutely the same as with the full recovery model). <br><br></li><li>  Using the incompletely logged recovery model, you lose some of the recovery options (point-in-time recovery and backup of the final fragment) in exchange for performance gains associated with minimally logged operations. </li></ul><br></li><li>  Simple recovery model <br><br><ul><li>  Some changes can be minimally logged (absolutely the same as with the recovery model with incomplete logging). <br><br></li><li>  The transaction log will not be cleared until the checkpoint creation operation (CHECKPOINT) is performed - it is usually executed automatically. <br><br></li><li>  Creating a backup of the transaction log is not possible, so you have the most limited number of recovery options. </li></ul></li></ul><br>  Most people use the full recovery model to be able to back up the transaction log and afford all the possible recovery options.  The main thing you should remember when your database uses the full recovery model or the model with incomplete logging - you must periodically back up the transaction log or the transaction log will grow indefinitely. <br><br>  In some conditions, a simple recovery model is preferable: if you do not need the ability to recover at a point in time and minimal losses when recovering using transaction log backups.  An example would be the test database used, which is refilled once a day and any changes may be lost or quickly repeated. <br><br><h2>  Switch to a simple recovery model </h2><br>  I often hear from people that they are switching to a simple recovery model to avoid the growth of the transaction log when performing batch loading or rebuilding indexes, whereas what they really need is a model with incomplete logging.  There are also persistent myths that some regular operations * require * that the recovery model is simple - it's just (ha ha) not true. <br><br>  Switching to a simple recovery model breaks the chain of transaction log backups, requiring the creation of a full or differential backup before further backing up the transaction log. <br><br>  Moreover, such a switch limits your possibilities in case of failure, because now you have only one full backup, from which you can recover - the one you did last.  Think about it - your possible recovery options are as follows: <br><br><ul><li>  Full backup after switching to a simple recovery model, differential backups after this full (if you use differential backups) and any transaction log backups since you switched back from the simple model;  or <br><br></li><li>  The latest full backup before switching to a simple recovery model plus the last differential after switching back from a simple plus any transaction log backups. </li></ul><br>  If this latest full backup (before or after switching to a simple recovery model) is damaged, you cannot recover.  You cannot take the previous full backup, because it allows you to recover only before switching to the simple recovery model, but not after.  Well, I think you can do it, but you lose all the work from the moment you switch to a simple recovery model. <br><br>  Switching to a simple recovery model is not something you do automatically or regularly.  The only time you can temporarily do this is when your transaction log is full and you have no opportunity to clear it (for example, you cannot back it up or add another log file), except to switch to a simple recovery model and force the operation to create a control point.  In this case, you take drastic measures to allow you to work with the base, and are fully aware of the limited recovery opportunities you now have. <br><br>  Until you fall into this emergency, you either decide to use the simple recovery model on an ongoing basis, or you should never switch to it. <br><br><h2>  Switching to a partially logged recovery model </h2><br>  Switching to incomplete logging during the loading or maintenance of indexes is acceptable to avoid the growth of the transaction log.  In fact, switching back and forth between the full recovery model and the incomplete logging model does not in any way affect the chain of backups of the transaction log.  And such switching does not affect log shipping or replication, but you cannot switch from the full recovery model when using database mirroring or AlwaysOn availability groups, since they require the full recovery model. <br><br>  However, using the recovery model with incomplete logging can cause problems for recovery in case of failures, so even if you want to use this recovery model due to its features, you can refuse to use it to avoid the risk of losing some of the recovery opportunities. <br><br>  Issue 1: A transaction log backup that contains a minimally logged operation cannot be used in recovery at a point in time.  This means that the time you specify in the WITH STOPAT clause in the recovery command cannot be the time that belongs to such a backup.  You can use such a backup as part of the recovery chain and stop for any time after it (unless this time refers to another backup that also contains minimally logged operations, of course), but not during the time belonging to this backup. <br><br>  Issue 2: If you need to perform a backup of the final snippet to capture all transaction log entries created since the last scheduled backup of the transaction log, the data files are unavailable or damaged, and the transaction log entries that need to be backed up have a minimum journaling operations, then when creating such a backup, you will receive an error in versions prior to SQL Server 2008 R2, and starting with SQL Server 2008 R2, you will receive a successfully created backup,  oraya will damage the database if it is restored. <br><br>  Therefore, if you intend to use the model with incomplete logging to save space in the transaction log at the time of large transactions, you need to make sure that a) there is no likelihood that you will want to recover from the time between the last and next backup of the transaction log ;  and b) there will be no changes in the database, which you cannot repeat in case a failure occurs and you cannot make a correct backup of the final fragment. <br><br>  Switching a recovery model between a full model and an incomplete-log model may not be as safe as you think. <br><br><h2>  Summary </h2><br>  For each database you are responsible for, make sure that you understand the implications of changing the recovery model, since such a change can lead to recovery problems in case of failures. </div><p>Source: <a href="https://habr.com/ru/post/327606/">https://habr.com/ru/post/327606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327594/index.html">How to use the HTTP API to send emails</a></li>
<li><a href="../327596/index.html">Tale of creating a classic RTS at home from scratch (Part 2: "Resurrection")</a></li>
<li><a href="../327598/index.html">Security Week 17: DoublePulsar broke free, a hundred thousand Linksys found holes, SMSVova expelled from Google Play</a></li>
<li><a href="../327600/index.html">Outstanding portfolio creation guide</a></li>
<li><a href="../327604/index.html">learnopengl. Lesson 1.9 - Camera</a></li>
<li><a href="../327608/index.html">Video recording of the webinar "Julia - A Fresh Approach to Numerical Computing and Data Science"</a></li>
<li><a href="../327610/index.html">Seven Reasons You Can't Drop Clash Royale</a></li>
<li><a href="../327612/index.html">In 5 minutes, make Single Page Application available for Google and Facebook.</a></li>
<li><a href="../327614/index.html">Explanation of Neural Turing Machines</a></li>
<li><a href="../327616/index.html">Extrasensory ability in design, which I have lost</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>