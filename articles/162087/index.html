<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Collectd - Monitor the system with minimal cost. Setting and using notifications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What it is? 
 Collectd is a small daemon that collects every 10 seconds. 
 statistics on the use of system resources. There is the possibility of coll...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Collectd - Monitor the system with minimal cost. Setting and using notifications</h1><div class="post__text post__text-html js-mediator-article"><h3>  What it is? </h3><br><blockquote>  <b>Collectd</b> is a small daemon that collects every 10 seconds. <br>  statistics on the use of system resources.  There is the possibility of collecting <br>  statistics for several hosts and sending it to a server that <br>  engaged in drawing beautiful graphs. </blockquote><br>  The main difference of this collector is that it works on the principle of <b>push</b> , not <b>poll / pull</b> .  Those.  he ‚Äúhangs‚Äù and listens, and the servers send him the statistics themselves. <br><br><h3>  What do we do? </h3><br>  What I want to describe in this post: <br><ul><li>  Installation </li><li>  Setup is shared. </li><li>  Customization of individual plugins. </li><li>  Configuring the slave servers that will send us their work statistics to the main server. </li><li>  Set up email notifications. </li></ul><br><a name="habracut"></a><br><h3>  Installation </h3><br>  We install it as usual through the favorite batch installer <b>emerge / yum / apt-get</b> or <i>cho-there-still-exists</i> . <br>  For <i><b>debian</b></i> .  There is no collectd in standard ports, for this we need to connect <i><b>backports</b></i> . <br>  This is done quite simply: <br>  Add a line <br><pre><code class="bash hljs">deb http://backports.debian.org/debian-backports squeeze-backports main</code> </pre> <br>  in your <b>sources.list</b> ( <i>or create a new file with this line in</i> <b><i>/etc/apt/sources.list.d/</i></b> ) <br>  Then run <i><b>apt-get update</b></i> <br><br>  Next, to install the package from the backports, we write the command <br><pre> <code class="bash hljs">apt-get -t squeeze-backports install <span class="hljs-string"><span class="hljs-string">"package"</span></span></code> </pre><br>  well or through aptitude <br><pre> <code class="bash hljs">aptitude -t squeeze-backports install <span class="hljs-string"><span class="hljs-string">"package"</span></span></code> </pre><br>  In our case, it will look like <br><pre> <code class="bash hljs">apt-get -t squeeze-backports install <span class="hljs-string"><span class="hljs-string">"collectd"</span></span></code> </pre><br>  There is a little nuance in Ghent.  Firstly, it is masked ~ x86, and secondly, only a few plugins are installed.  To specify which plugins to install, you must specify them either in <i><b>package.use</b></i> (of <i>type <b>collectd_plugin_memory</b></i> ) or in <i><b>make.conf</b></i> in the variable <i>COLLECTD_PLUGINS = "";</i> <br>  I have installed these: <br><pre> <code class="bash hljs">COLLECTD_PLUGINS=<span class="hljs-string"><span class="hljs-string">"apache cpu df disk interface load memory network ntpd processes notify_email ping logfile syslog rrdtool swap hddtemp exec filecount java sensors target_notification target_set target_replace"</span></span></code> </pre><br>  <i><b>Be careful, depending on the plug-ins, it can pull a lot of things behind it;), so choose what you need.</b></i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b><i>The established versions</i></b> : on <i><b>gentoo</b></i> - <i>5.1.1</i> , on <i><b>debian</b></i> , after some dances with a tambourine - <i>4.1.1 (but it will have to be manually updated to 5.x, why - read below)</i> , on <i><b>centos6</b></i> - <i>5.1.0</i> . <br><br>  <b>JFYI</b> Why you need to upgrade: <i>because the output of data in rrd is different in these versions, therefore either write a crutch for conversion or write 2 scripts to generate graphs on the front-end face.</i>  <i>Yes, and because of changes in schedules, you will have to take into account the client version on the host and write rules for notifications for it separately.</i> <br><br>  In Debian and Centos, I have all the plugins installed.  Well, because of the finished package is put :) <br><br><h3>  Customization </h3><br>  We go further.  I didn‚Äôt like the config format at all, for a long time where to find something, so for myself I cut it into the parts I needed, since it‚Äôs possible to connect other configs from the config, as they say, inline :) <br>  Again, in the Ghent, the entire config in one file, which is located in <b><i>/etc/collectd.conf</i></b> .  In Debian, it is placed in the beautiful path <b><i>/etc/collectd/collectd.conf</i></b> , as well as some parts of the <b><i>filters</i></b> and <b><i>thresholds</i></b> configurations are rendered into separate files, which is good news.  In general, I made about the same configuration on my Ghent, changing it a little bit.  In particular, the connection of the plugins I needed was brought to a separate directory and each plug-in (or rather its configuration) was also in a separate file.  Here is how it looks like: <br><br><pre> <code class="xml hljs"># Config file for collectd(1). # # Some plugins need additional configuration and are disabled by default. # Please read collectd.conf(5) for details. # # You should also read /usr/share/doc/collectd-core/README.Debian.plugins # before enabling any more plugins. Hostname "gen-collectd-master.local" FQDNLookup true BaseDir "/data/collectd" #PluginDir "/usr/lib/collectd" #TypesDB "/usr/share/collectd/types.db" "/etc/collectd/my_types.db" #Interval 10 #Timeout 2 #ReadThreads 5 LoadPlugin logfile LoadPlugin syslog <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">logfile</span></span></span><span class="hljs-tag">&gt;</span></span> LogLevel "info" File "/data/collectd/collectd.log" Timestamp true PrintSeverity true <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">syslog</span></span></span><span class="hljs-tag">&gt;</span></span> LogLevel info <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span> LoadPlugin network <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">network</span></span></span><span class="hljs-tag">&gt;</span></span> Listen "192.168.56.130" "8085" <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span> Include "/etc/collectd/inst/*.active" Include "/etc/collectd/conf/*.conf" Include "/etc/collectd/filters.conf" Include "/etc/collectd/thresholds.conf"</code> </pre><br>  This is the main configuration file, if you compare it with the default file, you will notice that there are not all plugins in my file, only those that I consider the main configuration.  The remaining files are connected from the <b><i>inst</i></b> and <i><b>conf</b></i> directories. <br>  <b>JFYI</b> Also pay attention to the <b>FQDNLookup</b> parameter <b>true</b> - if you have something in your <b>hostname</b> , it should be resolved!  Otherwise, it will crash with an error, another solution is to set this parameter to <b>false.</b> <br><br>  The <i><b>inst</b></i> directory contains plugin configuration files: <br><pre> <code class="bash hljs">gen-collectd-master collectd <span class="hljs-comment"><span class="hljs-comment"># ls -la /etc/collectd/inst/ total 32 drwxr-xr-x 2 root root 4096 Nov 26 20:57 . drwxr-xr-x 4 root root 4096 Nov 26 21:00 .. -rw-r--r-- 1 root root 15 Nov 26 13:54 cpu.active -rw-r--r-- 1 root root 125 Nov 26 13:54 if.active -rw-r--r-- 1 root root 16 Nov 26 13:54 load.active -rw-r--r-- 1 root root 18 Nov 26 13:54 memory.active -rw-r--r-- 1 root root 122 Nov 26 18:25 mounts.active -rw-r--r-- 1 root root 133 Nov 26 20:57 ping-hosts.active</span></span></code> </pre><br>  As you can see from the config, I only connect files with the "extension" <b>active</b> <br><br>  <b>JFYI</b> All plugin parameters can be found on the <a href="https://collectd.org/documentation/manpages/collectd.conf.5.shtml">collectd.conf</a> documentation page <a href="https://collectd.org/documentation/manpages/collectd.conf.5.shtml">.</a> <b>&nbsp;</b><br><br>  Further, the <b><i>conf</i></b> directory contains 2 files, one to configure the <i><b>notify_email</b></i> plugin, the second to configure <i><b>rrdtool</b></i> <br><pre> <code class="bash hljs">gen-collectd-master collectd <span class="hljs-comment"><span class="hljs-comment"># ls -la /etc/collectd/conf/ total 16 drwxr-xr-x 2 root root 4096 Nov 26 20:30 . drwxr-xr-x 4 root root 4096 Nov 26 21:00 .. -rw-r--r-- 1 root root 425 Nov 26 20:30 mail.conf -rw-r--r-- 1 root root 83 Nov 26 13:54 rrdtool.conf</span></span></code> </pre><br>  In general, they can be returned calmly to <i><b>collectd.conf</b></i> , but for <i><b>some reason</b></i> at that time I wanted to do just that :) <br><br>  The contents of the <i><b>conf / rrdtool.conf file</b></i> <br><pre> <code class="xml hljs">LoadPlugin rrdtool <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rrdtool</span></span></span><span class="hljs-tag">&gt;</span></span> DataDir "/data/collectd/rrd" <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  As you can see, here I am loading the plugin and setting the parameters for it. <br><br>  <i><b>Conf / mail.conf file</b></i> <br><pre> <code class="xml hljs">LoadPlugin notify_email <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">notify_email</span></span></span><span class="hljs-tag">&gt;</span></span> SMTPServer "stmp.mail.ru" SMTPPort 25 SMTPUser "collectd@mail.ru" SMTPPassword "my-super-password-for-mail" From "collectd@mail.ru" # # <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WARNING</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FAILURE</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OK</span></span></span><span class="hljs-tag">&gt;</span></span> on <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hostname</span></span></span><span class="hljs-tag">&gt;</span></span>. # # Beware! Do not use not more than two placeholders (%)! Subject "[collectd] %s on %s!" Recipient "recipient@mail.ru" <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  We need this plugin when we set up notifications. <br><br>  <b>JFYI</b> can write your own notification handler.  To do this, you need to enable the <i><b>exec</b></i> plugin and set up a script that will be launched when generating the notification.  This is done like this: <br><br><pre> <code class="xml hljs">LoadPlugin exec <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">exec</span></span></span><span class="hljs-tag">&gt;</span></span>    NotificationExec    thunder "/home/thunder/ttest.sh" "test1" <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The general specification for this command is: <br><pre> <code class="xml hljs">NotificationExec <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag">&gt;</span></span> "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">--</span></span></span><span class="hljs-tag">&gt;</span></span>" ["1"] ["2"]  ..</code> </pre><br><br>  I have written the following in the script <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cat &gt;&gt; /home/thunder/ttest.log</span></span></code> </pre><br>  In the log when notifications will be created something like <br><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">Severity: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WARNING</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Time</span></span></span><span class="hljs-function">: 1354181979.770 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Host</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jen</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">master</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">local</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Plugin</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpu</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PluginInstance</span></span></span><span class="hljs-function">: 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Type</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpu</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TypeInstance</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">user</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataSource</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CurrentValue</span></span></span><span class="hljs-function">: 9.989738</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">+01 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WarningMin</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nan</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WarningMax</span></span></span><span class="hljs-function">: 8.500000</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">+01 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FailureMin</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nan</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FailureMax</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nan</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Host</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jen</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">master</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">local</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plugin</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpu</span></span></span><span class="hljs-function"> (</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-function"> 0) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpu</span></span></span><span class="hljs-function"> (</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">user</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">source</span></span></span><span class="hljs-function"> "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currently</span></span></span><span class="hljs-function"> 99.897375. </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">That</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">above</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">warning</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">threshold</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> 85.000000.</span></span></code> </pre><br>  As we see all the data we have here, it will not be difficult to parse it and it is also not difficult to write your own notifier. <br><br>  Let's go back to the main <i><b>collectd.conf</b></i> file <i><b>.</b></i> <br>  I will not explain about <i><b>syslog</b></i> / <i><b>logfile</b></i> , so everything is clear here, <i><b>hostname</b></i> too. <br>  <i><b>Network</b></i> plugin - more specifically, you can read about the plugin <a href="http://collectd.org/documentation/manpages/collectd.conf.5.shtml">here</a> , in particular, authorization can be specified there.  At my place I will not consider it for now, how everyone will decide for himself how to do it for himself :) <br>  This plugin is used to communicate between <i><b>collectd</b></i> servers. <br>  To configure the current server as a server for collecting statistics, you must set the <i><b>Listen</b></i> parameter <i><b>‚Äú192.168.56.130‚Äù ‚Äú8085‚Äù,</b></i> where <i><b>192.168.56.130</b></i> is the ip address where the daemon will hang and listen to incoming data from other servers.  <i><b>8085</b></i> - the port on which it will hang. <br>  To configure the client, instead of <i><b>Listen</b></i> you need to specify <i><b>Server "192.168.56.130" "8085"</b></i> , respectively <i><b>192.168.56.130</b></i> - ip address where to send the data.  <i><b>8085</b></i> - the port to which to send data. <br><br>  <b>JFYI</b> Port can be omitted, the default port <b>25826</b> will be used, just remember that it will work via the <b>UDP</b> protocol, so keep in mind if you have a <b>firewall</b> somewhere <b>.</b> <br><br>  Configuring plug-ins here and there is no different. <br><br>  All that you have configured to monitor on the " <i>Client</i> " will be sent to the " <i>Server</i> ". <br><br><h3>  Mail notifications </h3><br>  We turn to the most delicious.  The only examples of setting the notification of some plug-ins are only in the config <i><b>thresholds.conf</b></i> . <br>  The main download of the plugin and example: <br><pre> <code class="xml hljs">LoadPlugin "threshold" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">threshold</span></span></span><span class="hljs-tag">"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">foo</span></span></span><span class="hljs-tag">"&gt;</span></span> WarningMin 0.00 WarningMax 1000.00 FailureMin 0.00 FailureMax 1200.00 Invert false Instance "bar" <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  A brief explanation of how this works.  <i><b>Threshold</b></i> is a regular plugin, so it is loaded as a plugin.  All parameters are set inside the <i><b>&lt;Plugin ‚Äúthreshold‚Äù&gt;</b></i> container.  Inside it can be set containers in the following sequence - " <i><b>Host</b></i> ", " <i><b>Plugin</b></i> ", " <i><b>Type</b></i> ".  Those.  Inside the <i><b>Host</b></i> container there can be a <i><b>Plugin</b></i> container, inside of which there can be a <i><b>Type</b></i> container.  The <i><b>Host</b></i> block is optional, with it you can bind notifications for a specific host.  Also, all values ‚Äã‚Äãshould be set only inside the <b><i>Type</i></b> block, the only value that can be set outside the <i><b>Type</b></i> block is <i><b>Instance.</b></i> <br>  If several blocks are applied to one value, then the most accurate of the blocks will be used.  So  You can specify some kind of standard block for the plugin, and then, for example, for a specific host, override it with other parameters.  So, let's proceed directly to the configuration of notifications. <br><br><h4>  Cpu plugin </h4><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cpu</span></span></span><span class="hljs-tag">"&gt;</span></span>     Instance "user"     WarningMax 85     Hits 1 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Here you can not write in front of the <i><b>Type</b></i> Block <i><b>Plugin</b></i> block.  We indicate that you need to monitor the value of <i><b>user</b> (user processes)</i> and if it reaches the value of <i><b>85</b></i> , then send a warning.  <i><b>Hits</b></i> is the number of hits in this value for one <i><b>Interval</b></i> (see the configuration of the main config), in our case it is equal to <i><b>1</b></i> , i.e.  if within <i><b>10</b></i> seconds the value is <i><b>&gt; = 85</b></i> , then a notification will be generated.  Here you can put the value more, for example, <i><b>6</b></i> , that is, if the value is for one minute, then there is something to worry about. <br><br><h4>  <i><b>Ping</b></i> plugin </h4><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ping</span></span></span><span class="hljs-tag">"&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ping_droprate</span></span></span><span class="hljs-tag">"&gt;</span></span>        FailureMax 0.9    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  As you can see here, we set for the plugin a <i><b>ping</b></i> type equal to <i><b>ping_droprate.</b></i>  This table contains the value of either <i><b>0</b></i> or <i><b>1</b></i> .  Accordingly, we set generation of the type <i><b>Failure</b></i> if the value exceeds <i><b>0.9</b></i> .  If you specify <i><b>1</b></i> , it will not work :) <br><br><h4>  <i><b>Memory</b></i> plugin </h4><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">memory</span></span></span><span class="hljs-tag">"&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">memory</span></span></span><span class="hljs-tag">"&gt;</span></span>        Instance "free"        WarningMin 25000000    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We choose <i><b>instance free</b></i> , because we monitor free memory, the less <i><b>free</b></i> the worse, we set <i><b>WarningMin</b></i> .  If the value reaches or becomes less than the specified value, then a notification will be generated. <br><br>  Now the most interesting thing is that this is not in the documentation and it turned out to be hard to find an example, so I had to experiment. <br>  We make notifications on a place on a disk <br><br><h4>  <i><b>Df</b></i> plugin </h4><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">df</span></span></span><span class="hljs-tag">"&gt;</span></span> Instance "root" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">df_complex-used</span></span></span><span class="hljs-tag">"&gt;</span></span> # DataSource "value" WarningMax 4025360000 FailureMax 6025360000 Percentage false <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  So, in version 5.x, the logic for creating tables for the df plugin has changed, so the reference to the tables has become different. <br>  <i><b>Instance</b></i> - specify the graph for which section to apply <br>  <i><b>Type</b></i> - <i><b>df_complex-used</b></i> - <i><b>df_complex is</b></i> always and necessarily, after the dash in our case the search for data on the used place is set. <br>  Now the <i><b>DataSource</b></i> can be omitted, since the table has only one <i><b>value</b></i> field. <br>  <i><b>WarningMax</b></i> / <i><b>FailureMax</b></i> - unfortunately for some unknown reason it is impossible to use percentage data for this plugin, so for each host you will have to fill this plugin with specific values.  Also below, we clearly state that we don‚Äôt use percentages.  <a href="http://mailman.verplant.org/pipermail/collectd/2011-December/004857.html">The question about this</a> appeared in 2011 and in version 4.9.1, but there is still no answer to it. <br><br>  That's all, the main plugins are configured, notifications for them too. <br><br>  <i><b>Suggestions, suggestions, questions are welcome.</b></i>  <i><b>I will answer if possible.</b></i> <br><br></div><p>Source: <a href="https://habr.com/ru/post/162087/">https://habr.com/ru/post/162087/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162075/index.html">SMS ransomware in the form of a set of plug-ins for browsers</a></li>
<li><a href="../162077/index.html">Copyright history. Part 3: Monopoly is dying ... and reborn</a></li>
<li><a href="../162079/index.html">Working with ContactListener from Box2d to Libgdx</a></li>
<li><a href="../162081/index.html">Pseudo 3D effect</a></li>
<li><a href="../162085/index.html">RAW collective processing service</a></li>
<li><a href="../162091/index.html">SMS notifications from nagios by means of clickatell.com and site monitor on bash</a></li>
<li><a href="../162093/index.html">EPAM IT Share # 3: Search for related images. Define Cloud Computing</a></li>
<li><a href="../162095/index.html">Answers Minister of Communications to the questions of users: part 1</a></li>
<li><a href="../162097/index.html">Far Cry 3 video review</a></li>
<li><a href="../162101/index.html">This country can not be defeated. Post of Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>