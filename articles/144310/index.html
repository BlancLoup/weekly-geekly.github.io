<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with SSL / TLS in Cach√© DBMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will discuss only some examples of setting up a secure connection to the Cach√© DBMS based on SSL, namely: 


- setting and enabling SSL o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with SSL / TLS in Cach√© DBMS</h1><div class="post__text post__text-html js-mediator-article">  This article will discuss only some examples of setting up a secure connection to the Cach√© DBMS based on SSL, namely: <br><ul><li>  setting and enabling <a href="">SSL on the Cach√© DBMS side</a> ; </li><li>  configuring SSL in Apache, built into Cach√©; </li><li>  reading data from a client certificate in CSP / ZEN web applications; </li><li>  <a href="">connect from .NET using SSL</a> ; </li><li>  <a href="">Connecting from .Java using SSL</a> </li><li>  <a href="">Configuring SSL in the CSP Gateway</a> to establish a secure connection between the web server and the Cach√© DBMS; </li><li>  <a href="">configure SSL in ODBC</a> . </li></ul><br><a name="habracut"></a><br><blockquote>  Note: Other examples of using SSL with Cach√© DBMS are mirroring, Telnet, TCP / IP (sockets), web services, Cach√© Studio, etc.  - You can find in the <a href="">documentation</a> or <a href="">technical support</a> . </blockquote>  First, let's generate the certificates themselves: the root (CA: Certificate Authority), server and client. <br><habracut>  The process of generating / receiving certificates is quite complicated and is beyond the scope of this article, therefore, it will not be described in detail here. <br>  On the Internet you can find a lot of materials on this topic, for example: <a href="http://www.sql.ru/forum/actualthread.aspx%3Ftid%3D669766">Electronic signature</a> . <br><blockquote>  Note: Having an eToken is desirable but not necessary. </blockquote><br><h4>  Generation of a set of test digital certificates </h4><br>  A set of bat scripts has been prepared that simplify the process of generating, signing, checking and revoking your test certificates.  You can change them at your discretion.  See the relevant files for details. <br><br>  So, let's create our certificates: <br><ol><li>  generate private keys without a password.  If desired, they can be password-protected by adding, for example, the <i>-aes256</i> parameter: <pre><code class="hljs objectivec">openssl genrsa -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> cakey.pem -rand randfile <span class="hljs-number"><span class="hljs-number">4096</span></span> openssl genrsa -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> serverkey.pem -rand randfile <span class="hljs-number"><span class="hljs-number">2048</span></span> openssl genrsa -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> clientkey.pem -rand randfile <span class="hljs-number"><span class="hljs-number">2048</span></span></code> </pre> <br></li><li>  create certification requests.  We take the data for requests from the corresponding files: <pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">req</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-key</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cakey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cfgCA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cacsr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">req</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-key</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">serverkey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cfgServer</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">servercsr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">req</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-key</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clientkey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cfgClient</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clientcsr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span></code> </pre> <br></li><li>  create and sign certificates: <pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x509</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-req</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-signkey</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cakey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cacsr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-extfile</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cfgCA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-extensions</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v3_req</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cacrt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-days</span></span> 365 <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ca</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ca</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-extensions</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v3_server</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">servercsr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">servercrt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-batch</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ca</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ca</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-extensions</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v3_client</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clientcsr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clientcrt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-batch</span></span></code> </pre> <br></li><li>  Recode certificates in DER format suitable for .NET, eToken, certificate stores in Windows.  The password for export can be left blank: <pre> <code class="hljs pgsql">openssl x509 -inform PEM -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cacrt.pem -outform DER -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> ca.cer openssl x509 -inform PEM -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> servercrt.pem -outform DER -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.cer openssl x509 -inform PEM -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> clientcrt.pem -outform DER -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> client.cer openssl pkcs12 -export -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cacrt.pem -inkey cakey.pem -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> ca.pfx -<span class="hljs-type"><span class="hljs-type">name</span></span> "CA certificate CACHE" openssl pkcs12 -export -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> servercrt.pem -inkey serverkey.pem -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.pfx -<span class="hljs-type"><span class="hljs-type">name</span></span> "Server certificate CACHE" openssl pkcs12 -export -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> clientcrt.pem -inkey clientkey.pem -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> client.pfx -<span class="hljs-type"><span class="hljs-type">name</span></span> "Client certificate CACHE"</code> </pre> <br></li><li>  revoke one of our client certificates (optional).  Re-create the list of revoked certificates: <pre> <code class="hljs dos"><span class="hljs-comment"><span class="hljs-comment">rem openssl ca -config ca.config -revoke clientcrt.pem openssl ca -config ca.config -gencrl -out crl.pem openssl crl -outform DER -in crl.pem -out crl.crl -CAfile cacrt.pem copy crl.crl C:\Inetpub\wwwroot\crl.crl</span></span></code> </pre> <br></li><li>  print the contents of the certificates to a file for easy reading: <pre> <code class="hljs pgsql">openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cacrt.pem -noout -<span class="hljs-type"><span class="hljs-type">text</span></span> &gt;ca.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> servercrt.pem -noout -<span class="hljs-type"><span class="hljs-type">text</span></span> &gt;<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> clientcrt.pem -noout -<span class="hljs-type"><span class="hljs-type">text</span></span> &gt;client.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> openssl crl -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> crl.pem -<span class="hljs-type"><span class="hljs-type">text</span></span> -noout</code> </pre> <br></li><li>  check the validity of our certificates: <pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">verify</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-CAfile</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cacrt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">servercrt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clientcrt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span></code> </pre> </li></ol><br>  Content of <b>ca.config</b> file: <br><pre> <code class="hljs swift">[ca] default_ca=<span class="hljs-type"><span class="hljs-type">CA_CLIENT</span></span> [<span class="hljs-type"><span class="hljs-type">CA_CLIENT</span></span>] dir=./db certs = $dir/certs new_certs_dir = $dir/newcerts database = $dir/index.txt serial = $dir/serial certificate = ./cacrt.pem private_key = ./cakey.pem default_days = <span class="hljs-number"><span class="hljs-number">365</span></span> default_crl_hours = <span class="hljs-number"><span class="hljs-number">4</span></span> default_md = sha1 policy = policy_anything #     [policy_anything] countryName = <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> stateOrProvinceName = <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> localityName = <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> organizationName = <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> organizationalUnitName = <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> commonName = supplied emailAddress = <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> serialNumber = <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> [v3_server] basicConstraints = critical,<span class="hljs-type"><span class="hljs-type">CA</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span> nsComment = <span class="hljs-string"><span class="hljs-string">"Server certificate CACHE"</span></span> nsCertType = server keyUsage = critical,digitalSignature, nonRepudiation, keyEncipherment, keyAgreement crlDistributionPoints = <span class="hljs-type"><span class="hljs-type">URI</span></span>:http:<span class="hljs-comment"><span class="hljs-comment">//localhost/crl.crl [v3_client] subjectAltName = email:copy basicConstraints = critical,CA:false nsComment = "Client certificate CACHE" nsCertType = client, email, objsign keyUsage = critical,digitalSignature, nonRepudiation, keyEncipherment, keyAgreement crlDistributionPoints = URI:http://localhost/crl.crl</span></span></code> </pre> <br>  Contents of the <b>cfgCA.txt</b> file: <br><pre> <code class="hljs pgsql">#    [req] distinguished_name = req_distinguished_name prompt = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> extensions = v3_req [req_distinguished_name] #  C=MD #  ST=Moldova #  L=Chisinau #   O=abc #   OU=zxc #   (,  ) CN=<span class="hljs-keyword"><span class="hljs-keyword">CACHE</span></span> #   emailAddress=support@abc.md [v3_req] subjectAltName = email:copy keyUsage = critical, keyCertSign, cRLSign basicConstraints = critical, CA:TRUE, pathlen:<span class="hljs-number"><span class="hljs-number">0</span></span> nsComment = "CA certificate CACHE" nsCertType = sslCA, emailCA crlDistributionPoints = URI:http://localhost/crl.crl</code> </pre> <br>  Contents of the <b>cfgServer.txt</b> file: <br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta">#    [req] distinguished_name = distinguished_name prompt = no [distinguished_name] C=MD ST=Moldova L=Chisinau O=abc OU=zxc CN=localhost</span></span></code> </pre> <br>  Contents of the <b>cfgClient.txt</b> file: <br><pre> <code class="hljs pgsql">#    [req] distinguished_name = distinguished_name prompt = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> [distinguished_name] serialNumber=<span class="hljs-number"><span class="hljs-number">987654321</span></span> CN=<span class="hljs-keyword"><span class="hljs-keyword">superuser</span></span> emailAddress=my@abc.md</code> </pre> <br>  Now you have test certificates.  Then they should be registered in Cach√©, Apache, certificate store and, if necessary, installed on eToken, who have it. <br><br><h4>  Installing certificates in the Windows certificate store </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/54d/0cc/86f/54d0cc86fd22fea88251fdeb18697c00.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To do this, you can use the appropriate equipment through the management console (mmc.exe): <br><ul><li>  <b>ca.cer</b> should be installed in the trusted root certification authorities of the local computer; </li><li>  <b>server.pfx</b> should be installed in the personal certificates of the local computer (required to configure IIS); </li><li>  <b>client.pfx</b> should be installed in the current user's personal certificates.  Owners of eToken can skip this item. </li></ul><br><h4>  Installing certificates on eToken </h4><br>  To do this, use the software supplied with the device. <br><br><h4>  SSL configuration in Cach√© </h4><br><ol><li>  in the Portal, we create and configure an SSL configuration with the name <b>% SuperServer</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dee/2be/4b7/dee2be4b7f589e27df744f8e1d1d4ef6.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> <br><br></li><li>  Enable SSL / TLS Cach√© Super Server: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a3c/fae/8c0/a3cfae8c0bbca13ac825e05306b12a6c.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> <br><br></li><li>  To make sure that we have configured everything correctly and SSL support is working, we will create and configure a test client configuration: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eec/2d8/7d2/eec2d87d2e336ada6966da41b10ebcf7.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> <br><br>  Next we test the SSL connection.  If you did everything correctly, you will see a message about the successful establishment of a secure connection, as in the screenshot. <br><blockquote>  Note: If you wish, you can create an SSL configuration with the name <b>% TELNET / SSL</b> to support SSL in telnet connections. </blockquote></li></ol><br><h4>  Configuring SSL in Apache built into Cach√© </h4><br><blockquote>  Note: A full and detailed description of this section can be found in the <b>mod_ssl</b> documentation.  Download Apache with SSL support for Windows <a href="http://www.anindya.com/">from here.</a> </blockquote><br><ol><li>  install the <b>mod_ssl.so</b> file in the <i>% acheHome% \ httpd \ modules</i> folder; <br></li><li>  In the <i>% acheHome% \ httpd \ conf \ httpd.conf file we</i> add the following lines: <pre> <code class="hljs javascript">... UseCanonicalName Off SSLEngine on SSLCertificateFile C:<span class="hljs-regexp"><span class="hljs-regexp">/SSLKeys/</span></span>servercrt.pem SSLCertificateKeyFile C:<span class="hljs-regexp"><span class="hljs-regexp">/SSLKeys/</span></span>serverkey.pem SSLCACertificateFile C:<span class="hljs-regexp"><span class="hljs-regexp">/SSLKeys/</span></span>cacrt.pem SSLVerifyClient <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> SSLVerifyDepth <span class="hljs-number"><span class="hljs-number">10</span></span> SSLCipherSuite TLSv1:SSLv3:!ADH:!LOW:!EXP:@STRENGTH SSLOptions +StdEnvVars ... LoadModule ssl_module modules/mod_ssl.so ...</code> </pre> <br></li><li>  Restart the <a href="">embedded Apache</a> from the command line: <br><pre> <code class="hljs objectivec">httpd.exe -k restart -n <span class="hljs-built_in"><span class="hljs-built_in">CACHEhttpd</span></span> -c <span class="hljs-string"><span class="hljs-string">"Listen 8972"</span></span></code> </pre> <br></li><li>  we start the System Management Portal or documentation from Cuba and make sure that to establish a secure connection, you must have a valid client certificate signed by the same certification authority as the server certificate. <br></li></ol><br><h4>  Reading client certificate data from CSP / ZEN applications </h4><br>  In the CSP-Gateway, it is necessary to enable the transfer to Cach√© of all additional CGI environment variables: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcb/78b/65d/dcb78b65dce5d86af545ef6c5dec7342.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> <br><br>  Now in the web application, you can get the certificate settings depending on the type of web server as follows: <br><blockquote> <code><a href="http://www.intersystems.com/zen%2522"></a> <a href="http://www.intersystems.com/zen%2522"></a> <font color="#000080">Class sqlru.testpage Extends %ZEN.Component.page <br></font> <font color="#000000">{ <br> <br></font> <font color="#000080">/// This XML block defines the contents of this page. <br> XData</font> <font color="#000000">Contents [</font> <font color="#000080">XMLNamespace</font> <font color="#000000">=</font> <font color="#800080">"www.intersystems.com/zen"</font> <font color="#000000">] <br> { <br> &lt;</font> <font color="#000080">page</font> <font color="#800000">xmlns</font> <font color="#000000">=</font> <font color="#008000">"www.intersystems.com/zen"</font> <font color="#800000">title</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">&gt; <br> &lt;</font> <font color="#000080">textarea</font> <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"ta"</font> <font color="#800000">value</font> <font color="#000000">=</font> <font color="#008000">"test"</font> <font color="#800000">rows</font> <font color="#000000">=</font> <font color="#008000">"10"</font> <font color="#800000">cols</font> <font color="#000000">=</font> <font color="#008000">"50"</font> <font color="#000000">/&gt; <br> &lt;/</font> <font color="#000080">page</font> <font color="#000000">&gt; <br> } <br> <br></font> <font color="#000080">Method</font> <font color="#000000">%OnAfterCreatePage()</font> <font color="#000080">As %Status <br></font> <font color="#000000">{ <br></font> <font color="#0000ff">if</font> <font color="#000000">%request.</font> <font color="#0000ff">CgiEnvs</font> <font color="#000000">(</font> <font color="#008000">"SERVER_SOFTWARE"</font> <font color="#000000">)[</font> <font color="#008000">"Apache"</font> <font color="#800080">{ <br></font> <font color="#0000ff">set</font> <font color="#000000">a = %request.</font> <font color="#0000ff">CgiEnvs</font> <font color="#000000">(</font> <font color="#008000">"SSL_CLIENT_S_DN"</font> <font color="#000000">) <br></font> <font color="#800080">}</font> <font color="#0000ff">else</font> <font color="#800080">{ <br></font> <font color="#0000ff">set</font> <font color="#000000">a = %request.</font> <font color="#0000ff">CgiEnvs</font> <font color="#000000">(</font> <font color="#008000">"CERT_SUBJECT"</font> <font color="#000000">) <br></font> <font color="#800080">} <br> <br></font> <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">%SetValueById</font> <font color="#000000">(</font> <font color="#008000">"ta"</font> <font color="#000000">,a) <br></font> <font color="#0000ff">Quit $$$OK <br></font> <font color="#000000">} <br> }</font></code> </blockquote> <br>  Other certificate attributes can be read in the same way: <br><ul><li>  <b>SSL_CLIENT_I_DN</b> ; </li><li>  <b>SSL_SERVER_I_DN</b> ; </li><li>  <b>SSL_SERVER_S_DN</b> ; </li><li>  ... </li></ul><br><h4>  Connect from .NET to Cach√© using SSL </h4><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CacheConnection(<span class="hljs-string"><span class="hljs-string">"Server = localhost; Port = 1972; Namespace = SAMPLES; Password = SYS; User ID = _SYSTEM; SSL=true;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (db.State == ConnectionState.Closed) { db.Open(); textBox1.Text = db.ServerZV; } db.Close();</code> </pre> <br>  The first valid certificate from the personal certificate store will be used.  If the certificate is on the eToken, the PIN code will be requested. <br>  If the store is empty, for example, the eToken is not inserted, or all certificates are invalid, then the connection will be terminated with an error. <br><br><h4>  Connect from Java to Cach√© using SSL </h4><br>  First we need to add our certificates to the appropriate repositories: the trusted certificate in the <b>truststore</b> , the client certificate in the <b>keystore</b> . <br>  In our case, the <b>client_pwd.pfx</b> file protected by the password ‚Äúmysecret‚Äù will be suitable as a <b>keystore</b> . <br>  The root certificate can be inserted either in a separate <b>truststore</b> or in the standard <b>cacerts</b> : <br><br><pre> <code class="hljs pgsql">keytool -importcert -<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CACHE</span></span> -file c:\SSLKeys\ca.cer -keystore truststore -storepass mysecret</code> </pre>  or <pre> <code class="hljs pgsql">keytool -importcert -<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CACHE</span></span> -file c:\SSLKeys\ca.cer -keystore cacerts -storepass changeit</code> </pre> <br>  Next you need to create a client configuration file <b>SSLConfig.Properties</b> : <br><pre> <code class="hljs 1c">protocol=SSLv3 keyStore=C:/SSLKeys/client_pwd.pfx keyStoreType=PKCS12 keyStorePassword=mysecret keyRecoveryPassword=mysecret <span class="hljs-meta"><span class="hljs-meta"># </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> ca     cacerts,     trustStore=C:/SSLKeys/truststore trustStoreType=JKS trustStorePassword=mysecret</span></span></code> </pre> <br><blockquote>  Note: More detailed information can be found in the <a href="http://java.sun.com/j2se/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSE</a> documentation. </blockquote><br>  Now you can connect from java-applications using SSL, as follows: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> test; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.Connection; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intersys.jdbc.CacheDataSource; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Throwable </span></span>{ String url = <span class="hljs-string"><span class="hljs-string">"jdbc:Cache://localhost:1972/USER"</span></span>; String username = <span class="hljs-string"><span class="hljs-string">"_SYSTEM"</span></span>; String password = <span class="hljs-string"><span class="hljs-string">"SYS"</span></span>; System.setProperty(<span class="hljs-string"><span class="hljs-string">"com.intersys.SSLConfigFile"</span></span>, <span class="hljs-string"><span class="hljs-string">"C:/SSLKeys/SSLConfig.Properties"</span></span>); CacheDataSource cs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CacheDataSource(); cs.setURL(url); cs.setUser(username); cs.setPassword(password); cs.setConnectionSecurityLevel(<span class="hljs-number"><span class="hljs-number">10</span></span>); Connection cn = cs.getConnection(); System.out.println(<span class="hljs-string"><span class="hljs-string">"  !"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//Database db = CacheDatabase.getDatabase(cn); } }</span></span></code> </pre> <br><h4>  Configuring SSL in CSP-Gateway </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/723/f12/0f3/723f120f3a6615c0fc678c37254530f6.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> <br><br>  Check the connection to the server, whether we have configured everything correctly: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9a7/c7d/012/9a7c7d01249834ad133f968eb8d3a91c.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> <br><br><h4>  Configuring SSL in ODBC </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/174/bab/b71/174babb712e7f1cd567f600a23e04af8.png" alt="image"><br><br>  SSL configuration settings are stored in the registry: <b>HKEY_CURRENT_USER \ Software \ InterSystems \ Cache \ SSLConfigurations \ SSL configuration name</b> <br>  Parameter descriptions can be found in the <a href="">Security.SSLConfigs</a> class. <br>  Test settings can be found in the file <b>CacheOdbcSSL.reg</b> (see below). <br><br>  Check the connection to the server, whether we have configured everything correctly: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95a/be1/a55/95abe1a55c7a1a0725ebba82b2332c85.png" alt="image"><br><br>  <a href="http://db.tt/s866Phr6">Source scripts</a> </habracut></div><p>Source: <a href="https://habr.com/ru/post/144310/">https://habr.com/ru/post/144310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144305/index.html">Optimize OSX for SSD</a></li>
<li><a href="../144306/index.html">Work with Cach√© DBMS Objects on the Example of Delphi</a></li>
<li><a href="../144307/index.html">So.cl: Microsoft's social search based social network.</a></li>
<li><a href="../144308/index.html">From idea to release. Manifest</a></li>
<li><a href="../144309/index.html">SASS vs. LESS</a></li>
<li><a href="../144311/index.html">Work with sockets in Cach√© DBMS. An example of the implementation of the server side of the protocol WebSocket</a></li>
<li><a href="../144312/index.html">Localization in Cach√© DBMS</a></li>
<li><a href="../144313/index.html">Mdday # MoCO - conference for mobile developers</a></li>
<li><a href="../144314/index.html">DARPA peaceful competitions for military use</a></li>
<li><a href="../144317/index.html">Epigraph to perl 5.16.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>