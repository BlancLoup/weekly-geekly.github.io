<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Limbo game defense research. Keygen</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Many people know about this great game - LIMBO ! You probably even bought it in Steam , or downloaded it from torrents ... 
 I also bought it o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Limbo game defense research. Keygen</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/8e6/bd8/ffe/8e6bd8ffe0a44a71a6b952abe9cc6e58.png"></div><br><br>  Hello.  Many people know about this great game - <b>LIMBO</b> !  You probably even bought it in <b>Steam</b> , or downloaded it from torrents ... <br>  I also bought it once ( <u>which I advise you!</u> ), And passed).  But, as always, it was not enough for me, and I, out of sports interest, decided to study its protection.  So there was a <b><i>keygen</i></b> for the game <b>LIMBO</b> . <br><a name="habracut"></a><br>  In this article I will tell and show you how I did it. <br><br><h5>  <b><u>Before you begin, remember: you perform all actions at your own peril and risk.</u></b>  <b><u>Respect the work of gamedevelopers.</u></b> </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  <b>Stage One: Patient's Surface Examination</b> </h5><br>  The full game installer can be downloaded <a href="http://playdead.com/limbo/download/">here</a> .  Having established the game, first of all, as usual, we find out what the main executable file is written on.  I will use <a href="http://exeinfo.atwebpages.com/">ExeInfo PE</a> for this. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/10a/d39/91c/10ad3991ce01477c9d5123eed137b333.png"></div><br><br>  See: <b>Visual Studio 2008</b> .  <b>IDA Pro</b> perfectly copes with it, so we will send it there.  I will use the <i><b>IDA Pro + HexRays bundle</b></i> , i.e.  with decompiler - to speed up the work. <br><br><h5>  <b>Stage two: what are we looking for?</b> </h5><br>  First of all, let's give <b>Ide to</b> analyze <b>limbo.exe</b> - the main executable file of the game. <br><br>  Next, you need to determine what exactly we actually want to find here.  Run the game: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a4f/dc0/035/a4fdc0035a1247459e6ca09a5d7e6068.png"></div><br><br>  We see the magic inscription " <b>UNLOCK FULL GAME</b> ".  On it and click.  Next, we are waiting for the unexpected (at least when I first chose this menu item, I expected to see the input field on the graphic engine of the game, or something like that, but it turned out to be much easier ...): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/deb/303/daa/deb303daaff44069af42e2caa8480118.png"></div><br><br>  Yes Yes!  It is the usual window!  It's easier for us.  Let's try to enter something, and click <b>Unlock</b> .  Something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2cd/fe5/c35/2cdfe5c358364c839858a6ebe63ef43d.png"></div><br><br>  Well, let's look for the text in <b>IDA</b> , then to make a start from it, and find the place of the check.  And then I expected a bummer ... <br>  In the text of the message in the error box, <b>Ida</b> found nothing for me!  The same thing said to me and search for content through <b>Total Commander</b> .  The message may be encrypted.  You can try to find a window call from the call to <b>MessageBoxA / W.</b>  But, I went another way, which, for some reason, few places in articles describe. <br><br><h5>  <b>Stage Three: Click Me</b> </h5><br>  We will proceed as follows.  Open any resource editor that is convenient for you, dragging an ehe-shnik into it, find the dialog box for entering the key, and in it - the <b>Unlock</b> button.  No sooner said than done: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8bb/27c/3b1/8bb27c3b11124aaba4ddc3f06457c528.png"></div><br><br>  On the screen I highlighted the <b>ID of</b> our button.  According to it, we will look for exactly where the click is processed.  Let's open <b>Go</b> , press <b>Alt + I</b> ( <i>Search -&gt; immediate value</i> ...), enter the number <i><b>203</b></i> (no <b>0x</b> , because decimal), and see what exists.  And there was this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7db/7cc/34c/7db7cc34c53b41f0a65d500a96ac6ec9.png"></div><br><br>  You see those lines that <b>Ida</b> marked as <b>;</b>  <b>nIDDlgItem</b> ?  Let's start with them.  Double click on the first of these results: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bbc/e25/c7b/bbce25c7b9384da890dba9c431fa25b1.png"></div><br><br>  With a green arrow, I marked the place indicated by <b>Ida</b> , and just below ( <i>habit: scroll above / below the desired place</i> ), the arrow indicates the place where one interesting API function was <b>called</b> : <b>GetDlgItemTextA</b> .  Judging <s>by the name</s> on <b>MSDN</b> , this function receives the text of the specified window element into the buffer. <br><br><blockquote>  <i>Why did I not immediately search for the input field <b>ID</b> ?</i>  <i>You can, of course, and so it was done.</i>  <i>But, you never know what actions take place after pressing the button, even before the text is read from the field.</i> </blockquote><br>  So, let's see where the resulting serial goes.  Scroll the listing to see the entire place to call the API function: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8f1/8de/ed7/8f18deed7061405d929b20237b9a7903.png"></div><br><br>  My ‚Äú <i>soaped up</i> ‚Äù look tells me that the received buffer ( <b>Ida</b> designated it as <b>var_134</b> ) is passed straight to the function following the <b>GetDlgItemTextA</b> call, which returns a zero or non-zero value to <b>al</b> (similar to the result of a key check).  Let's check a guess ... <br><br><h5>  <b>Stage Four: Decompilation</b> </h5><br>  Go to the function.  We see there jump to another address - go through it.  We see the normal code, so feel free to click there <b>F5</b> (call <b>HexRays Decompiler</b> ). <br><br><div class="spoiler">  <b class="spoiler_title">Decompilation result</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> __<span class="hljs-function"><span class="hljs-function">cdecl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sub_48D410</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a1)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v1; <span class="hljs-comment"><span class="hljs-comment">// esi@7 char *v2; // ebp@7 unsigned int v3; // edi@7 int v4; // ST28_4@9 int v5; // edx@9 int v6; // eax@12 bool result; // al@12 char v8; // [sp+4h] [bp-44h]@8 char v9; // [sp+Ch] [bp-3Ch]@12 char v10; // [sp+1Ch] [bp-2Ch]@7 char v11; // [sp+3Ch] [bp-Ch]@12 if ( strlen((const char *)a1) != 37 || *(_BYTE *)(a1 + 5) != 45 || *(_BYTE *)(a1 + 11) != 45 || *(_BYTE *)(a1 + 17) != 45 || *(_BYTE *)(a1 + 23) != 45 || *(_BYTE *)(a1 + 30) != 45 ) { result = 0; } else { v1 = 0; v2 = &amp;v10; v3 = 0; do { v8 = *(_BYTE *)(v3 + a1); if ( v8 != 45 ) { v4 = (char)sub_412EBD(v8); v1 += v4 &lt;&lt; 5 * (3 - v5); if ( v5 == 3 ) { v2 += sprintf(v2, "%05lx", v1); v1 = 0; } } ++v3; } while ( v3 &lt; 0x25 ); v6 = sub_40C48C(&amp;v10, 32); sprintf(&amp;v9, "%08x", v6); result = strcmp(&amp;v9, &amp;v11) == 0; } return result; }</span></span></code> </pre> <br></div></div><br>  Now you can try to bring this code to a more adequate. <br><br>  First of all, we note that the input parameter is of type <b>int</b> , which is not entirely true.  Denote it as " <b>char *</b> ".  To do this, we become the name of the function and click there <b>Y</b> ( <i>Set item type</i> ).  We fix the type and name of the input parameter (I called it as <b>key</b> ). <br><br>  Next ... See the line: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(key) != <span class="hljs-number"><span class="hljs-number">37</span></span> || key[<span class="hljs-number"><span class="hljs-number">5</span></span>] != <span class="hljs-number"><span class="hljs-number">45</span></span> || key[<span class="hljs-number"><span class="hljs-number">11</span></span>] != <span class="hljs-number"><span class="hljs-number">45</span></span> || key[<span class="hljs-number"><span class="hljs-number">17</span></span>] != <span class="hljs-number"><span class="hljs-number">45</span></span> || key[<span class="hljs-number"><span class="hljs-number">23</span></span>] != <span class="hljs-number"><span class="hljs-number">45</span></span> || key[<span class="hljs-number"><span class="hljs-number">30</span></span>] != <span class="hljs-number"><span class="hljs-number">45</span></span> )</code> </pre><br>  Since  our input parameter is a string, let's in those places where the key symbols are compared with the numbers, correct for comparison with the symbols.  To do this, on each of these numbers, press <b>R</b> ( <i>Char</i> ).  Already better: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(key) != <span class="hljs-number"><span class="hljs-number">37</span></span> || key[<span class="hljs-number"><span class="hljs-number">5</span></span>] != <span class="hljs-string"><span class="hljs-string">'-'</span></span> || key[<span class="hljs-number"><span class="hljs-number">11</span></span>] != <span class="hljs-string"><span class="hljs-string">'-'</span></span> || key[<span class="hljs-number"><span class="hljs-number">17</span></span>] != <span class="hljs-string"><span class="hljs-string">'-'</span></span> || key[<span class="hljs-number"><span class="hljs-number">23</span></span>] != <span class="hljs-string"><span class="hljs-string">'-'</span></span> || key[<span class="hljs-number"><span class="hljs-number">30</span></span>] != <span class="hljs-string"><span class="hljs-string">'-'</span></span> )</code> </pre><br>  Now the cycle: <br><br><div class="spoiler">  <b class="spoiler_title">Cycle number 1</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> v1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; v2 = &amp;v10; v3 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { v8 = key[v3]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( v8 != <span class="hljs-number"><span class="hljs-number">45</span></span> ) { v4 = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)sub_412EBD(v8); v1 += v4 &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span> * (<span class="hljs-number"><span class="hljs-number">3</span></span> - v5); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( v5 == <span class="hljs-number"><span class="hljs-number">3</span></span> ) { v2 += <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(v2, <span class="hljs-string"><span class="hljs-string">"%05lx"</span></span>, v1); v1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } ++v3; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( v3 &lt; <span class="hljs-number"><span class="hljs-number">0x25</span></span> );</code> </pre><br></div></div><br>  For clarity, we give <b>v3 the</b> name <b>i</b> , since  It seems that it is used as an iterator.  Rename it by clicking on the name of the <b>N</b> ( <i>Name</i> ) key. <br><br>  We notice that in the cycle, each character is taken from the key, and transferred to an unknown function.  I propose to find out what this function is.  Double click to go into it.  We see there a call to another function, go there.  And here it is - processing a single character!  ( <i>There is a lot of work here for the <b>R</b> key, but I will just show the result of the processing immediately</i> ). <br><br><div class="spoiler">  <b class="spoiler_title">Convert_char function</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> __<span class="hljs-function"><span class="hljs-function">cdecl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert_char</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> C)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> _C; <span class="hljs-comment"><span class="hljs-comment">// al@1 _C = C; if ( C &lt; '0' ) return -1; if ( C &lt;= '9' ) return C - '0'; if ( C &lt; 'A' ) return -1; if ( C &lt;= 'Z' ) { if ( C != 'I' &amp;&amp; C != 'L' &amp;&amp; C != 'O' &amp;&amp; C != 'U' ) { if ( C &gt;= 'U' ) _C = C - 1; if ( _C &gt;= 'O' ) --_C; if ( _C &gt;= 'L' ) --_C; if ( _C &gt;= 'I' ) --_C; return _C - '7'; } return -1; } if ( C &lt; 'a' || C &gt; 'z' || C == 'i' || C == 'l' || C == 'o' || C == 'u' ) return -1; if ( C &gt;= 'u' ) _C = C - 1; if ( _C &gt;= 'o' ) --_C; if ( _C &gt;= 'l' ) --_C; if ( _C &gt;= 'i' ) --_C; return _C - 'W'; }</span></span></code> </pre><br></div></div><br>  Perfectly!  Now go back to the main function with the <b>Esc key</b> .  We note that <b>IDA</b> itself redefined the result type returned by the function for processing the character for us.  Name further, denote types, and get the following loop code: <br><br><div class="spoiler">  <b class="spoiler_title">Cycle number 2</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; x5buf = v10; i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { C = key[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( C != <span class="hljs-string"><span class="hljs-string">'-'</span></span> ) { new_c = j_convert_char(C); sum += new_c &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span> * (<span class="hljs-number"><span class="hljs-number">3</span></span> - itr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( itr == <span class="hljs-number"><span class="hljs-number">3</span></span> ) { x5buf += <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(x5buf, <span class="hljs-string"><span class="hljs-string">"%05lx"</span></span>, sum); sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } ++i; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( i &lt; <span class="hljs-number"><span class="hljs-number">0x25</span></span> );</code> </pre><br></div></div><br>  If you noticed, then there is one interesting bug decompiler.  We see that the variable designated by it as <b>itr</b> is not incremented at all.  To find out what is actually happening, click <b>PKM -&gt; Copy to assembly</b> , and look where our <b>itr</b> is <b>used</b> .  We find out: it is incremented directly in this cycle (which was to be expected), and before the cycle it is zeroed.  We take this into account when writing keygens. <br><br>  Now the second part of the key verification function ... We still have one unexplored function, which, by the way, is very similar to the <b>CRC32</b> counting function.  The result of processing (albeit in a hurry, but readable): <br><br><div class="spoiler">  <b class="spoiler_title">crc32</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">cdecl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc_crc32</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *my_key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-comment"><span class="hljs-comment">// ebp@1 unsigned int _xor; // ecx@1 char *_my_key; // edi@2 char C; // al@3 signed int mask; // edx@3 int B; // esi@3 bool bit; // al@4 int crc32; // eax@10 signed int _len; // edx@10 i = len; _xor = 0xFFFFFFFF; if ( len ) { _my_key = my_key; do { C = *_my_key; --i; ++_my_key; mask = 1; B = (unsigned __int8)C; do { bit = (_xor &amp; 0x80000000) == 0x80000000; _xor *= 2; if ( B &amp; mask ) bit = bit == 0; if ( bit ) _xor ^= 0x4C11DB7u; mask *= 2; } while ( (_BYTE)mask ); } while ( i ); } crc32 = _xor &amp; 1; _len = 0x1F; do { _xor &gt;&gt;= 1; crc32 = _xor &amp; 1 | 2 * crc32; --_len; } while ( _len ); return ~crc32; }</span></span></code> </pre><br></div></div><br>  Remaining piece (converted): <br><pre> <code class="cpp hljs"> crc32 = j_calc_crc32(my_key, <span class="hljs-number"><span class="hljs-number">32</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(crc32_, <span class="hljs-string"><span class="hljs-string">"%08x"</span></span>, crc32); result = <span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(crc32_, &amp;my_key[<span class="hljs-number"><span class="hljs-number">32</span></span>]) == <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br><br><h5>  <b>Stage Five: Keygen Writing</b> </h5><br>  Task: determine what exactly happened with the key to write the inverse function.  I will write, contrary to common sense and the issuance of <b>HexRays</b> , in <b>Delphi</b> , and you can write in the language that is easier for you. <br><br>  By debugging we find out what happened: <br><ol><li>  The game needs a key of <i><b>32</b> characters</i> without hyphens ( <i><b>37</b> - with hyphens</i> ). </li><li>  <b><i>Four characters are</i></b> taken from the key (hyphens are not counted).  Each of them is passed through the function <b>convert_char</b> and summed by the formula: <b>sum + = new_c &lt;&lt; 5 * (3 - itr)</b> ; </li><li>  Each such sum is converted to a <i>lower-case</i> hex string ( <i><b>5</b> characters</i> ) and glued to the existing one (total <i><b>40</b> characters</i> ); </li><li>  The <b>CRC32 is</b> taken from the first <i><b>32</b></i> characters of the resulting string and compared with the remaining <i><b>eight</b> characters</i> of the string obtained in the previous paragraph; </li><li>  If the lines do not match - our key is incorrect. </li></ol><br><br>  Reverse thinking: <br><ol><li>  Write a function that converts a <i><b>40-</b> character</i> hash back to the key; </li><li>  Generate a <i><b>32-</b> character</i> hash; </li><li>  Calculate from it <i><b>8</b> - <i>character</i></i> CRC32; </li><li>  Glue the lines obtained in steps ( <b>2</b> ) and ( <b>3</b> ); </li><li>  Pass to function ( <b>1</b> ) - we get the desired key. </li></ol><br><br>  Thoughts on the transformative function: <br><ol><li>  Since  the input hash was obtained from <b>eight</b> <i><b>5-</b> character</i> hash pieces, we will process it in the same way, using the " <i><b>five</b></i> "; </li><li>  Each " <b><i>five</i></b> " was derived from <i><b>four</b></i> key <i><b>symbols</b></i> ; </li><li>  Since  at each calculation of the " <b><i>five</i></b> ", it shifted <b><i>5 bits to the left</i></b> , it turns out that for <i><b>each</b></i> key <i><b>symbol</b></i> there are <i><b>5</b> bits</i> ; </li><li>  Careful consideration of the <b>convert_char</b> function <b>code</b> leads us to believe that the key character set is limited to the characters of the character set ‚Äú <i><b>0123456789ABCDEFGHJKMNPQRSTVWXYZ</b></i> ‚Äù; </li><li>  Total: <i><b>32</b></i> hash <i>symbols are</i> generated from " <b><i>fives</i></b> ".  <i><b>32% 5 = 24 whole characters</b> and <b>2 in the remainder</b></i> - i.e.  two characters we have to simply generate. </li></ol><br><div class="spoiler">  <b class="spoiler_title">The final version of the function that generates a hash (Delphi)</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenHash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(len: byte)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i, k: byte; sum: integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Randomize; Result := <span class="hljs-string"><span class="hljs-string">''</span></span>; sum := <span class="hljs-number"><span class="hljs-number">0</span></span>; k := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> len <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> sum := sum + (Random(Length(alphabet)) <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> ((<span class="hljs-number"><span class="hljs-number">3</span></span> - k) * <span class="hljs-number"><span class="hljs-number">5</span></span>)); Inc(k); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> k = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := Result + AnsiLowerCase(Int2Hex(sum, <span class="hljs-number"><span class="hljs-number">5</span></span>)); sum := <span class="hljs-number"><span class="hljs-number">0</span></span>; k := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Result := Result + <span class="hljs-string"><span class="hljs-string">'a0'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   ,       end;</span></span></code> </pre><br></div></div><br>  Next, consider the <b>CRC32</b> from the hash: <br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key, hash, crc32: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> hash := GenHash(<span class="hljs-number"><span class="hljs-number">24</span></span>); crc32 := Crc32b(hash); <span class="hljs-comment"><span class="hljs-comment">//    ,   -</span></span></code> </pre><br>  The code of the converter function: <br><div class="spoiler">  <b class="spoiler_title">Hash to code function</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hash2Code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hash: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; five: integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := <span class="hljs-string"><span class="hljs-string">''</span></span>; s := Hash; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> Length(s) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> five := Hex2Int(Copy(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)); Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); Result := Result + alphabet[(five <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $F8000 <span class="hljs-keyword"><span class="hljs-keyword">shr</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>] + alphabet[(five <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $<span class="hljs-number"><span class="hljs-number">07</span></span>C00 <span class="hljs-keyword"><span class="hljs-keyword">shr</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>] + alphabet[(five <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $<span class="hljs-number"><span class="hljs-number">003</span></span>E0 <span class="hljs-keyword"><span class="hljs-keyword">shr</span></span> <span class="hljs-number"><span class="hljs-number">05</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>] + alphabet[(five <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $<span class="hljs-number"><span class="hljs-number">0001</span></span>F <span class="hljs-keyword"><span class="hljs-keyword">shr</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br></div></div><br><br>  And finally, the resulting license key acquisition: <br><br><pre> <code class="delphi hljs"> key := Hash2Code(hash + crc32); lic_code := Format(<span class="hljs-string"><span class="hljs-string">'%s-%s-%s-%s-%s-%s'</span></span>, [Copy(key, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), Copy(key, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), Copy(key, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), Copy(key, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), Copy(key, <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>), Copy(key, <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>) ]);</code> </pre><br>  We check, and ... <b>Entering the generated key activated the game, the activation point disappeared!</b> <br><br><h5>  <b>Results</b> </h5><br>  <i>The main thing when writing keygen is to be able to think back.</i>  <i>Those.</i>  <i>be able to write such an algorithm that will be the opposite of what you have.</i>  <i>This is not an easy task, but, and it can be solved in most cases.</i> <br><br><h5>  <b>PS</b> </h5><br>  Perhaps the article was too messy, I do not know.  The main idea I wanted to convey: keygen is not such a complicated thing, if there are brains, and desire along with assiduity. <br><br><h5>  <b>Pps</b> </h5><br>  In the next article I will describe how I wrote keygen to another game - <b>Unepic</b> . </div><p>Source: <a href="https://habr.com/ru/post/255935/">https://habr.com/ru/post/255935/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255925/index.html">Data carriers. What we have year 2015 and what should we expect beyond its horizon?</a></li>
<li><a href="../255927/index.html">Intel Edison officially in Russia: pre-order and project competition</a></li>
<li><a href="../255929/index.html">Schneider Electric thanked the winner of the PHDays hacker contest</a></li>
<li><a href="../255931/index.html">IPP functions with border support for multi-stream image processing</a></li>
<li><a href="../255933/index.html">What should we build an open data center? Some details about the structure of Facebook DC in Altoona</a></li>
<li><a href="../255939/index.html">Unity Web Player and Java support disabled in Google Chrome 42</a></li>
<li><a href="../255941/index.html">Organization and use of segmentation in large mobile applications</a></li>
<li><a href="../255945/index.html">Neural Interfaces: From Photo Paper to Neural Dust</a></li>
<li><a href="../255949/index.html">Retro style in photographic equipment: where does fashion end and need begin?</a></li>
<li><a href="../255951/index.html">New superblits on java hardcore</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>