<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A guide to deploying machine learning models in a production environment as an API using Flask</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Friends, at the end of March we are launching a new stream in the course "Data Scientist" . And right now we are starting to share with you useful mat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A guide to deploying machine learning models in a production environment as an API using Flask</h1><div class="post__text post__text-html js-mediator-article">  Friends, at the end of March we are launching a new stream in the course <a href="https://otus.pw/pozn/">"Data Scientist"</a> .  And right now we are starting to share with you useful material on the course. <br><br>  <b>Introduction</b> <br><br>  Recalling the early experience of my hobby for machine learning (ML), I can say that a lot of effort was spent on building a really good model.  I consulted with experts in this field to understand how to improve my model, thought about the necessary functions, tried to make sure that all the advice they offered was taken into account.  But still I ran into a problem. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How to implement a model in a real project?  I had no ideas about this.  All the literature I have studied up to this point has focused only on improving the models.  I have not seen the next step in their development. <br><br><img src="https://habrastorage.org/webt/dp/dc/yl/dpdcylcyxdnyzfasmeoxefjf-e8.png"><br><br>  That is why I am writing this guide.  I want you to face the problem that I faced at one time, but were able to solve it quickly enough.  By the end of this article, I will show you how to implement a machine learning model using the Flask Python framework. <a name="habracut"></a><br><br>  <b>Content</b> <br><br><ol><li>  Options for the implementation of machine learning models. </li><li>  What is an API? </li><li>  Install the Python environment and basic Flask information. </li><li>  Creating a machine learning model. </li><li>  Conservation machine learning models: Serialization and Deserialization. </li><li>  Creating an API using Flask. </li></ol><br>  <b>Options for the implementation of machine learning models.</b> <b><br></b> <br>  In most cases, the actual use of machine learning models is a central part of development, even if it is just a small component of an email automation system or chatbot.  Sometimes there are moments when implementation barriers seem insurmountable. <br><br>  For example, most ML specialists use R or Python for their scientific research.  However, consumers of these models will be software engineers who use a completely different technology stack.  There are two options that can solve this problem: <br><br>  <b>Option 1: Rewrite all code in the language that development engineers work with.</b>  It sounds logical to some extent, however, a large amount of time and effort is needed to replicate the developed models.  As a result, it turns out just a waste of time.  Most languages, such as JavaScript, do not have convenient libraries for working with ML.  Therefore, it will be quite a rational decision not to use this option. <br><br>  <b>Option 2: Use API.</b>  Network APIs have solved the problem of working with applications in different languages.  If the front-end developer needs to use your machine learning model to build a web application based on it, they just need to get the URL of the destination server that discusses the API. <br><br>  <b>What is an API?</b> <br><br>  In simple words, the API (Application Programming Interface) is a kind of contract between two programs, saying that if a user program provides input data in a specific format, then a developer program (API) passes it through itself and provides the output data necessary for the user. <br><br>  You will be able to independently read a couple of articles that describe well why API is a fairly popular choice among developers. <br><br><ul><li>  <a href="http://apievangelist.com/2012/12/20/history-of-apis/">API history</a> </li><li>  <a href="https://www.analyticsvidhya.com/blog/2016/11/an-introduction-to-apis-application-programming-interfaces-5-apis-a-data-scientist-must-know/">API Introduction</a> </li></ul><br>  Most providers of large cloud services and smaller companies that focus on machine learning provide ready-to-use APIs.  They satisfy the needs of developers who do not understand machine learning, but want to incorporate this technology into their solutions. <br><br>  For example, one of these API providers is Google with its own <a href="https://cloud.google.com/vision/">Google Vision API</a> . <br><br>  All the developer needs to do is simply invoke the REST (Representational State Transfer) API using the SDK provided by Google.  See what you can do using the <a href="https://github.com/GoogleCloudPlatform/cloud-vision/tree/master/python">Google Vision API</a> . <br><br>  Sounds great, right?  In this article, we will figure out how to create your own API using Flask, a Python framework. <br><br>  <i><b>Note</b></i> : Flask is not the only network framework for this purpose.  There are Django, Falcon, Hug and many others that are not mentioned in this article.  For example, for R there is a package called <i><a href="https://github.com/trestletech/plumber">plumber</a></i> <br><br>  <b>Install the Python environment and basic Flask information.</b> <br><br>  <b>1) Create a virtual environment using Anaconda.</b>  If you need to create your own virtual environment for Python and save the necessary state of dependencies, then Anaconda offers good solutions for this.  Next will be working with the command line. <br><br><ul><li>  <a href="https://conda.io/miniconda.html">Here</a> you will find the <i>miniconda</i> installer for Python; </li><li><code>wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh</code> </li> <li> <code>bash Miniconda3-latest-Linux-x86_64.sh</code> </li> <li>  Follow the sequence of questions. </li><li> <code>source .bashrc</code> </li> <li>  If you type: <code>conda</code> , you can see the list of available commands and help. </li><li>  To create a new environment, enter: <code>conda create --name &lt;environment-name&gt; python=3.6</code> </li><li>  Follow the steps you will be prompted to do and at the end enter: <code>source activate &lt;environment-name&gt;</code> </li><li>  Install the necessary Python packages.  The most important are <i>flask</i> and <i>gunicorn.</i> </li></ul><br>  <b>2) We will try to create our simple ‚ÄúHello world‚Äù application on Flask using <i>gunicorn</i> .</b> <br><br><ul><li>  Open your favorite text editor and create a <code>hello-world.py</code> file in the folder <code>hello-world.py</code> </li><li>  Write the following code: </li></ul><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Filename: hello-world.py """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask app = Flask(__name__) @app.route(<span class="hljs-string"><span class="hljs-string">'/users/&lt;string:username&gt;'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello_world</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(username=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello {}!"</span></span>.format(username))</code> </pre> <br><ul><li>  Save the file and return to the terminal. </li><li>  To start the API, run in the terminal: <code>gunicorn --bind 0.0.0.0:8000 hello-world:app</code> </li><li>  If you get the following, then you are on the right track: </li></ul><br><img src="https://habrastorage.org/webt/fl/69/hj/fl69hjmljbp5ezgivwxa6o-b73k.jpeg"><br><br><ul><li>  In the browser, enter the following: <code>https://localhost:8000/users/any-name</code> <br></li></ul><br><img src="https://habrastorage.org/webt/8i/gj/v-/8igjv-h34rhxj6rie9rbffgdda8.jpeg"><br><br>  Hooray!  You wrote your first program on Flask!  Since you already have some experience with these simple steps, we can create network endpoints that can be accessed locally. <br><br>  Using Flask, we can wrap our models and use them as a Web API.  If we want to create more complex network applications (for example, in JavaScript), then we need to add some changes. <br><br>  <b>Creating a machine learning model.</b> <br><br><ul><li>  To begin with, let's take on the machine learning competition <a href="https://datahack.analyticsvidhya.com/contest/practice-problem-loan-prediction-iii">Loan Prediction Competition</a> .  The main goal is to customize the pre-processing pipeline and create ML models to facilitate the prediction task during deployment. </li></ul><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.externals <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> joblib <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split, GridSearchCV <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.base <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseEstimator, TransformerMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestClassifier <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.pipeline <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> make_pipeline <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> warnings warnings.filterwarnings(<span class="hljs-string"><span class="hljs-string">"ignore"</span></span>)</code> </pre> <br><ul><li>  We save in a folder: </li></ul><br><pre> <code class="python hljs">!ls /home/pratos/Side-Project/av_articles/flask_api/data/</code> </pre> <br><pre> <code class="python hljs">test.csv training.csv</code> </pre> <br><pre> <code class="python hljs">data = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'../data/training.csv'</span></span>)</code> </pre> <br><pre> <code class="python hljs">list(data.columns)</code> </pre> <br><pre> <code class="python hljs">[<span class="hljs-string"><span class="hljs-string">'Loan_ID'</span></span>, <span class="hljs-string"><span class="hljs-string">'Gender'</span></span>, <span class="hljs-string"><span class="hljs-string">'Married'</span></span>, <span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>, <span class="hljs-string"><span class="hljs-string">'Education'</span></span>, <span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>, <span class="hljs-string"><span class="hljs-string">'ApplicantIncome'</span></span>, <span class="hljs-string"><span class="hljs-string">'CoapplicantIncome'</span></span>, <span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>, <span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>, <span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>, <span class="hljs-string"><span class="hljs-string">'Property_Area'</span></span>, <span class="hljs-string"><span class="hljs-string">'Loan_Status'</span></span>]</code> </pre> <br><pre> <code class="python hljs">data.shape</code> </pre> <br><br><pre> <code class="python hljs">(<span class="hljs-number"><span class="hljs-number">614</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>)</code> </pre>  ul&gt; <br>  Find null / Nan values ‚Äã‚Äãin columns: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data.columns: print(<span class="hljs-string"><span class="hljs-string">"The number of null values in:{} == {}"</span></span>.format(_, data[_].isnull().sum()))</code> </pre> <br><br><pre> <code class="python hljs">The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Loan_ID == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Gender == <span class="hljs-number"><span class="hljs-number">13</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Married == <span class="hljs-number"><span class="hljs-number">3</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Dependents == <span class="hljs-number"><span class="hljs-number">15</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Education == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Self_Employed == <span class="hljs-number"><span class="hljs-number">32</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:ApplicantIncome == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:CoapplicantIncome == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:LoanAmount == <span class="hljs-number"><span class="hljs-number">22</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Loan_Amount_Term == <span class="hljs-number"><span class="hljs-number">14</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Credit_History == <span class="hljs-number"><span class="hljs-number">50</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Property_Area == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Loan_Status == <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><ul><li>  The next step is to create datasets for training and testing: </li></ul><br><pre> <code class="python hljs">red_var = [<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>,<span class="hljs-string"><span class="hljs-string">'Married'</span></span>,<span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>,<span class="hljs-string"><span class="hljs-string">'Education'</span></span>,<span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>,<span class="hljs-string"><span class="hljs-string">'ApplicantIncome'</span></span>,<span class="hljs-string"><span class="hljs-string">'CoapplicantIncome'</span></span>,\ <span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>,<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>,<span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>,<span class="hljs-string"><span class="hljs-string">'Property_Area'</span></span>] X_train, X_test, y_train, y_test = train_test_split(data[pred_var], data[<span class="hljs-string"><span class="hljs-string">'Loan_Status'</span></span>], \ test_size=<span class="hljs-number"><span class="hljs-number">0.25</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">42</span></span>)</code> </pre> <br><ul><li>  To ensure that all the pre-processing steps are executed correctly even after we conducted the experiments and we did not miss anything during the forecasting process, we will create our own evaluator on Scikit-learn estimator . </li></ul><br>  To understand how we created it, read the <a href="">following</a> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.base <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseEstimator, TransformerMixin <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PreProcessing</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseEstimator, TransformerMixin)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Custom Pre-Processing estimator for our use-case """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, df)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Regular transform() that is a help for training, validation &amp; testing datasets (NOTE: The operations performed here are the ones that we did prior to this cell) """</span></span> pred_var = [<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>,<span class="hljs-string"><span class="hljs-string">'Married'</span></span>,<span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>,<span class="hljs-string"><span class="hljs-string">'Education'</span></span>,<span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>,<span class="hljs-string"><span class="hljs-string">'ApplicantIncome'</span></span>,\ <span class="hljs-string"><span class="hljs-string">'CoapplicantIncome'</span></span>,<span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>,<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>,<span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>,<span class="hljs-string"><span class="hljs-string">'Property_Area'</span></span>] df = df[pred_var] df[<span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>].fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>) df[<span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>].fillna(<span class="hljs-string"><span class="hljs-string">'No'</span></span>) df[<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>].fillna(self.term_mean_) df[<span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>].fillna(<span class="hljs-number"><span class="hljs-number">1</span></span>) df[<span class="hljs-string"><span class="hljs-string">'Married'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Married'</span></span>].fillna(<span class="hljs-string"><span class="hljs-string">'No'</span></span>) df[<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>].fillna(<span class="hljs-string"><span class="hljs-string">'Male'</span></span>) df[<span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>].fillna(self.amt_mean_) gender_values = {<span class="hljs-string"><span class="hljs-string">'Female'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Male'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>} married_values = {<span class="hljs-string"><span class="hljs-string">'No'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Yes'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>} education_values = {<span class="hljs-string"><span class="hljs-string">'Graduate'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Not Graduate'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>} employed_values = {<span class="hljs-string"><span class="hljs-string">'No'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Yes'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>} property_values = {<span class="hljs-string"><span class="hljs-string">'Rural'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Urban'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'Semiurban'</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>} dependent_values = {<span class="hljs-string"><span class="hljs-string">'3+'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} df.replace({<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>: gender_values, <span class="hljs-string"><span class="hljs-string">'Married'</span></span>: married_values, <span class="hljs-string"><span class="hljs-string">'Education'</span></span>: education_values, \ <span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>: employed_values, <span class="hljs-string"><span class="hljs-string">'Property_Area'</span></span>: property_values, \ <span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>: dependent_values}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> df.as_matrix() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, df, y=None, **fit_params)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Fitting the Training dataset &amp; calculating the required values from train eg: We will need the mean of X_train['Loan_Amount_Term'] that will be used in transformation of X_test """</span></span> self.term_mean_ = df[<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>].mean() self.amt_mean_ = df[<span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>].mean() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self</code> </pre> <br><ul><li>  Convert <code>y_train</code> and <code>y_test</code> to <code>np.array</code> : </li></ul><br><pre> <code class="python hljs">y_train = y_train.replace({<span class="hljs-string"><span class="hljs-string">'Y'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'N'</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}).as_matrix() y_test = y_test.replace({<span class="hljs-string"><span class="hljs-string">'Y'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'N'</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}).as_matrix()</code> </pre> <br>  We will create a pipeline to make sure that all the preprocessing steps that we do are the work of the scikit-learn appraiser. <br><br><pre> <code class="python hljs">pipe = make_pipeline(PreProcessing(), RandomForestClassifier())</code> </pre> <br><pre> <code class="python hljs">pipe</code> </pre> <br><pre> <code class="python hljs">Pipeline(memory=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, steps=[(<span class="hljs-string"><span class="hljs-string">'preprocessing'</span></span>, PreProcessing()), (<span class="hljs-string"><span class="hljs-string">'randomforestclassifier'</span></span>, RandomForestClassifier(bootstrap=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, class_weight=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, criterion=<span class="hljs-string"><span class="hljs-string">'gini'</span></span>, max_depth=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, max_features=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, max_leaf_nodes=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, min_impurity_decrease=<span class="hljs-number"><span class="hljs-number">0.0</span></span>, min_impurity_split=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, min_samples_leaf=<span class="hljs-number"><span class="hljs-number">1</span></span>, min_samples_split=<span class="hljs-number"><span class="hljs-number">2</span></span>, min_weight_fraction_leaf=<span class="hljs-number"><span class="hljs-number">0.0</span></span>, n_estimators=<span class="hljs-number"><span class="hljs-number">10</span></span>, n_jobs=<span class="hljs-number"><span class="hljs-number">1</span></span>, oob_score=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, random_state=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">0</span></span>, warm_start=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>))])</code> </pre> <br>  To search for suitable hyper-parameters (degree for polynomial objects and alpha for an edge), do a grid search (Grid Search): <br><br><ul><li>  Define param_grid: </li></ul><br><pre> <code class="python hljs">param_grid = {<span class="hljs-string"><span class="hljs-string">"randomforestclassifier__n_estimators"</span></span> : [<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>], <span class="hljs-string"><span class="hljs-string">"randomforestclassifier__max_depth"</span></span> : [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>], <span class="hljs-string"><span class="hljs-string">"randomforestclassifier__max_leaf_nodes"</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>], <span class="hljs-string"><span class="hljs-string">"randomforestclassifier__min_impurity_split"</span></span>: [<span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>]}</code> </pre> <br><ul><li>  Run a search on the grid: </li></ul><br><pre> <code class="python hljs">grid = GridSearchCV(pipe, param_grid=param_grid, cv=<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br><ul><li>  Customize training data for the estimator (pipeline estimator): </li></ul><br><pre> <code class="python hljs">grid.fit(X_train, y_train)</code> </pre> <br><pre> <code class="python hljs">GridSearchCV(cv=<span class="hljs-number"><span class="hljs-number">3</span></span>, error_score=<span class="hljs-string"><span class="hljs-string">'raise'</span></span>, estimator=Pipeline(memory=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, steps=[(<span class="hljs-string"><span class="hljs-string">'preprocessing'</span></span>, PreProcessing()), (<span class="hljs-string"><span class="hljs-string">'randomforestclassifier'</span></span>, RandomForestClassifier(bootstrap=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, class_weight=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, criterion=<span class="hljs-string"><span class="hljs-string">'gini'</span></span>, max_depth=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, max_features=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, max_leaf_nodes=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, min_impurity_decrease=<span class="hljs-number"><span class="hljs-number">0.0</span></span>, min_impu..._jobs=<span class="hljs-number"><span class="hljs-number">1</span></span>, oob_score=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, random_state=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">0</span></span>, warm_start=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>))]), fit_params=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, iid=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, n_jobs=<span class="hljs-number"><span class="hljs-number">1</span></span>, param_grid={<span class="hljs-string"><span class="hljs-string">'randomforestclassifier__n_estimators'</span></span>: [<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>], <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__max_leaf_nodes'</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>], <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__min_impurity_split'</span></span>: [<span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>], <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__max_depth'</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]}, pre_dispatch=<span class="hljs-string"><span class="hljs-string">'2*n_jobs'</span></span>, refit=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, return_train_score=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, scoring=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><ul><li>  Let's see which parameter selected the grid search: </li></ul><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"Best parameters: {}"</span></span>.format(grid.best_params_))</code> </pre> <br><pre> <code class="python hljs">Best parameters: {<span class="hljs-string"><span class="hljs-string">'randomforestclassifier__n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__max_leaf_nodes'</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__min_impurity_split'</span></span>: <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span>}</code> </pre> <br><ul><li>  Calculate: </li></ul><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"Validation set score: {:.2f}"</span></span>.format(grid.score(X_test, y_test)))</code> </pre><br><pre> <code class="python hljs">Validation set score: <span class="hljs-number"><span class="hljs-number">0.79</span></span></code> </pre><br><ul><li>  Download the test suite: </li></ul><br><pre> <code class="python hljs">test_df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'../data/test.csv'</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">"utf-8-sig"</span></span>) test_df = test_df.head()</code> </pre> <br><pre> <code class="python hljs">grid.predict(test_df)</code> </pre> <br><pre> <code class="python hljs">array([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>])</code> </pre> <br>  Our pipeline looks good enough to go to the next important step: Serializing the machine learning model. <br><br>  <b>Saving machine learning models: Serialization and Deserialization.</b> <br><br><blockquote>  ‚ÄúIn computer science, in the context of data storage, serialization is the process of translating data structures or object states into a stored format (for example, a file or memory buffer) and recreating it later in the same or a different computer environment.‚Äù </blockquote><br><br>  In Python, pickling is the standard way to store objects and later retrieve them in their original state.  To make it sound clearer, I will give a simple example: <br><br><pre> <code class="python hljs">list_to_pickle = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'here'</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-string"><span class="hljs-string">'walker'</span></span>] <span class="hljs-comment"><span class="hljs-comment">#Pickling the list import pickle list_pickle = pickle.dumps(list_to_pickle)</span></span></code> </pre> <br><pre> <code class="python hljs">list_pickle</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">b'\x80\x03]q\x00(K\x01X\x04\x00\x00\x00hereq\x01K{X\x06\x00\x00\x00walkerq\x02e.'</span></span></code> </pre> <br>  Then we will unload the canned object again: <br><br><pre> <code class="python hljs">loaded_pickle = pickle.loads(list_pickle)</code> </pre> <br><pre> <code class="python hljs">loaded_pickle</code> </pre> <br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'here'</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-string"><span class="hljs-string">'walker'</span></span>]</code> </pre> <br>  We can save canned objects to a file and use them.  This method is similar to creating <code>.rda</code> files, as in R programming, for example. <br><br>  <i><b>Note:</b></i> Some may not like this method of conservation for serialization.  An alternative could be <code>h5py</code> . <br><br>  We have a custom class (Class), which we need to import while we are training (training), so we will use the <code>dill</code> module to pack a class evaluator (Class) with a grid object. <br><br>  It is advisable to create a separate <code>training.py</code> file containing all the code for training the model.  (An example can be found <a href="https://github.com/pratos/flask_api/blob/master/flask_api/utils.py">here</a> ). <br><br><ul><li>  Set the <code>dill</code> </li></ul><br><pre> <code class="python hljs">!pip install dill</code> </pre> <br><pre> <code class="python hljs">Requirement already satisfied: dill <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /home/pratos/miniconda3/envs/ordermanagement/lib/python3<span class="hljs-number"><span class="hljs-number">.5</span></span>/site-packages</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dill <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pickle filename = <span class="hljs-string"><span class="hljs-string">'model_v1.pk'</span></span></code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'../flask_api/models/'</span></span>+filename, <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> file: pickle.dump(grid, file)</code> </pre> <br>  The model will be saved in the directory selected above.  Once the model is conserved, it can be wrapped in a Flask wrapper.  However, before that you need to make sure that the canned file is working.  Let's load it back and make a forecast: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'../flask_api/models/'</span></span>+filename ,<span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: loaded_model = pickle.load(f)</code> </pre> <br><pre> <code class="python hljs">loaded_model.predict(test_df)</code> </pre> <br><pre> <code class="python hljs">array([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>])</code> </pre> <br>  Since we have completed the preprocessing steps so that the newly received data is part of the pipeline, we just need to run predict ().  Using the scikit-learn library is quite simple to work with pipelines.  Appraisers and pipelines protect your time and nerves, even if the initial implementation seems wild. <br><br>  <b>Creating an API using Flask</b> <br><br>  Let's keep the folder structure as simple as possible: <br><br><img src="https://habrastorage.org/webt/y4/hm/2p/y4hm2pao2sje1zdmwe4t8cnjvhg.png"><br><br>  There are three important parts to creating the <code>apicall()</code> wrapper function: <br><br><ul><li>  Receive <code>request</code> data (for which the forecast will be made); </li><li>  Loading a canned appraiser; </li><li>  Translation of our forecasts into JSON format and receiving a response <code>status code: 200</code> ; </li></ul><br>  HTTP messages are created from the header and body.  In general, the main body content is transmitted in JSON format.  We will send ( <code>POST url-endpoint/</code> ) incoming data as a packet for receiving forecasts. <br><br>  <i><b>Note:</b></i> You can send plain text, XML, cvs or image directly for interchangeability of the format, however, it is preferable to use JSON in our case. <br><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Filename: server.py """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.externals <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> joblib <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask, jsonify, request app = Flask(__name__) @app.route(<span class="hljs-string"><span class="hljs-string">'/predict'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apicall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""API Call Pandas dataframe (sent as a payload) from API Call """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: test_json = request.get_json() test = pd.read_json(test_json, orient=<span class="hljs-string"><span class="hljs-string">'records'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#To resolve the issue of TypeError: Cannot compare types 'ndarray(dtype=int64)' and 'str' test['Dependents'] = [str(x) for x in list(test['Dependents'])] #Getting the Loan_IDs separated out loan_ids = test['Loan_ID'] except Exception as e: raise e clf = 'model_v1.pk' if test.empty: return(bad_request()) else: #Load the saved model print("Loading the model...") loaded_model = None with open('./models/'+clf,'rb') as f: loaded_model = pickle.load(f) print("The model has been loaded...doing predictions now...") predictions = loaded_model.predict(test) """Add the predictions as Series to a new pandas dataframe OR Depending on the use-case, the entire test data appended with the new files """ prediction_series = list(pd.Series(predictions)) final_predictions = pd.DataFrame(list(zip(loan_ids, prediction_series))) """We can be as creative in sending the responses. But we need to send the response codes as well. """ responses = jsonify(predictions=final_predictions.to_json(orient="records")) responses.status_code = 200 return (responses)</span></span></code> </pre> <br>  After running, enter: <code>gunicorn --bind 0.0.0.0:8000 server:app</code> <br>  Let's generate data for forecasting and a queue for running the API locally at <code>https:0.0.0.0:8000/predict</code> <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Setting the headers to send and accept json responses """</span></span> header = {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, \ <span class="hljs-string"><span class="hljs-string">'Accept'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>} <span class="hljs-string"><span class="hljs-string">"""Reading test batch """</span></span> df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'../data/test.csv'</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">"utf-8-sig"</span></span>) df = df.head() <span class="hljs-string"><span class="hljs-string">"""Converting Pandas Dataframe to json """</span></span> data = df.to_json(orient=<span class="hljs-string"><span class="hljs-string">'records'</span></span>)</code> </pre> <br><pre> <code class="python hljs">data</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">'[{"Loan_ID":"LP001015","Gender":"Male","Married":"Yes","Dependents":"0","Education":"Graduate","Self_Employed":"No","ApplicantIncome":5720,"CoapplicantIncome":0,"LoanAmount":110.0,"Loan_Amount_Term":360.0,"Credit_History":1.0,"Property_Area":"Urban"},{"Loan_ID":"LP001022","Gender":"Male","Married":"Yes","Dependents":"1","Education":"Graduate","Self_Employed":"No","ApplicantIncome":3076,"CoapplicantIncome":1500,"LoanAmount":126.0,"Loan_Amount_Term":360.0,"Credit_History":1.0,"Property_Area":"Urban"},{"Loan_ID":"LP001031","Gender":"Male","Married":"Yes","Dependents":"2","Education":"Graduate","Self_Employed":"No","ApplicantIncome":5000,"CoapplicantIncome":1800,"LoanAmount":208.0,"Loan_Amount_Term":360.0,"Credit_History":1.0,"Property_Area":"Urban"},{"Loan_ID":"LP001035","Gender":"Male","Married":"Yes","Dependents":"2","Education":"Graduate","Self_Employed":"No","ApplicantIncome":2340,"CoapplicantIncome":2546,"LoanAmount":100.0,"Loan_Amount_Term":360.0,"Credit_History":null,"Property_Area":"Urban"},{"Loan_ID":"LP001051","Gender":"Male","Married":"No","Dependents":"0","Education":"Not Graduate","Self_Employed":"No","ApplicantIncome":3276,"CoapplicantIncome":0,"LoanAmount":78.0,"Loan_Amount_Term":360.0,"Credit_History":1.0,"Property_Area":"Urban"}]'</span></span></code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""POST &lt;url&gt;/predict """</span></span> resp = requests.post(<span class="hljs-string"><span class="hljs-string">"http://0.0.0.0:8000/predict"</span></span>, \ data = json.dumps(data),\ headers= header)</code> </pre> <br><pre> <code class="python hljs">resp.status_code</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">200</span></span></code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""The final response we get is as follows: """</span></span> resp.json()</code> </pre> <br><pre> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">'predictions'</span></span>: <span class="hljs-string"><span class="hljs-string">'[{"0":"LP001015","1":1},{...</span></span></code> </pre><br>  <b>Conclusion</b> <br><br>  In this article, we walked only half the way, creating a working API that provides predictions, and took a step closer to integrating ML solutions directly into the developed applications.  We have created a fairly simple API that will help in prototyping the product and make it truly functional, but in order to send it to production, you need to make a few corrections that are no longer in the scope of learning machine learning. <br><br>  There are a few things that should not be forgotten in the process of creating an API: <br><br><ul><li>  Creating a high-quality API from spaghetti code is almost impossible, so use your knowledge of machine learning to create a useful and convenient API. </li><li>  Try using version control for models and API code.  Remember that Flask does not provide support for version control.  Saving and tracking ML models is a difficult task, find a convenient way for yourself.  <a href="https://medium.com/towards-data-science/how-to-version-control-your-machine-learning-task-cad74dce44c4">There</a> is an article about how to do it. </li><li>  In connection with the specifics of the scikit-learn models, it is necessary to make sure that the appraiser and the code for training lie side by side (in the case of using a user appraiser for preprocessing or another similar task).  Thus, a conserved model will have a class evaluator next to it. </li></ul><br>  The next logical step is to create mechanics for deploying such an API on a small virtual machine.  There are different ways to do this, but we will look at them in the next article. <br><br>  <a href="https://github.com/pratos/flask_api">Code and explanation for this article</a> <br><br>  <b>Useful sources:</b> <br><br>  [1] <a href="http://www.benfrederickson.com/dont-pickle-your-data/">Don't Pickle your data.</a> <br>  [2] <a href="http://www.dreisbach.us/articles/building-scikit-learn-compatible-transformers/">Building Scikit Learn compatible transformers</a> . <br>  [3] <a href="https://habr.com/ru/company/otus/blog/442918/">Using jsonify in Flask</a> . <br>  [4] <a href="http://blog.luisrei.com/articles/flaskrest.html">Flask-QuickStart.</a> <br><br>  Here is such a material.  Subscribe to us if you like the publication, and also sign up for a free <a href="https://otus.pw/fhj6/">open webinar</a> on the topic: ‚ÄúMetric classification algorithms‚Äù, which the developer and data scientist with 5 years of experience, <a href="https://otus.pw/Z25S/">Alexander Nikitin</a> , will conduct on March 12th. </div><p>Source: <a href="https://habr.com/ru/post/442918/">https://habr.com/ru/post/442918/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442902/index.html">Five tips on how to learn to calmly accept feedback at work</a></li>
<li><a href="../442904/index.html">About the functionality of security devices</a></li>
<li><a href="../442910/index.html">Why do we need advanced analytics in SIBUR</a></li>
<li><a href="../442912/index.html">Rally against runet isolation</a></li>
<li><a href="../442916/index.html">Are pirate FM radio stations relevant today?</a></li>
<li><a href="../442922/index.html">Moon mission "Bereshit" - the characteristics of the device, a series of maneuvers and the longest journey to the moon</a></li>
<li><a href="../442926/index.html">"Mouse fuss" in infrared light: the introduction of nanoparticles in the subretinal region of the eye of a mouse</a></li>
<li><a href="../442928/index.html">We write flexible code using SOLID</a></li>
<li><a href="../442932/index.html">Yandex has launched a search engine based on Russian patents over the past 95 years</a></li>
<li><a href="../442934/index.html">How to hire people in a huge company with an unpopular stack. Conversation with wrike</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>