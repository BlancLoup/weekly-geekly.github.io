<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Measurement Protocol - just about simple</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, Universal Analytics is out of beta status and is now becoming the main version of Google Analytics. This event allows you to use it wit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Measurement Protocol - just about simple</h1><div class="post__text post__text-html js-mediator-article">  The other day, Universal Analytics is out of beta status and is now becoming the main version of Google Analytics.  This event allows you to use it without a number of restrictions that existed previously.  The new version also carries a number of new features for tracking site visitors and provides an opportunity to compare user actions on the site and the subsequent execution of targeted actions offline. <a name="habracut"></a><br><br>  For these purposes, use the <b>Measurement Protocol</b> or <b>Data Transfer Protocol</b> .  When can you use this feature?  I will give a couple of examples. <br><br>  <u><b>The first option</b></u> is that a visitor purchases a product or service from your site, and at the same time selects the payment option ‚Äúnon-cash payment‚Äù.  We can assume that the purchase process may not be completed for a number of reasons, so the transfer of information to Google Analytics about the transaction after completing the checkout / purchase process is incorrect.  Data must be transferred after the actual payment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <u><b>The second option</b></u> is cash payment to the courier upon delivery of goods.  The purchase is considered completed after receipt of payment by courier. <br><br>  In both situations, if we transmit data about the purchase (transaction) after the completion of the order process, we will distort the statistics, because  we have no actual payment.  To correct the situation with the excess recorded payments, you will have to use negative transactions, which is not always convenient and not entirely correct. <br><br>  To solve this problem, we will be helped by a new feature that appeared in Google Analytics with the release of Universal Analytics, called <b>Mesurement Protocol.</b> <br><br>  What is the principle of the protocol?  It's quite simple: you need to send a specially crafted request to a specific URL. <br><br>  <u><i>Request example:</i></u> <br>  <b><a href="http://www.google-analytics.com/collect%3Fv%3D1%26tid%3DUA-47xxxx-1%26cid%3D12xx916x95.13x6127xx4%26t%3Dpageview">www.google-analytics.com/collect?v=1&amp;tid=UA-47xxxx-1&amp;cid=12xx916x95.13x6127xx4&amp;t=pageview</a></b> <br><br>  <b>Let us consider in more detail the parameters to be transmitted.</b> <br><br>  <b>The first</b> is the URL to which the request should be sent.  It should be <b><a href="http://www.google-analytics.com/collect">www.google-analytics.com/collect</a></b> for an unsecured connection and <b><a href="https://ssl.google-analytics.com/collect">ssl.google-analytics.com/collect</a></b> for SSL. <br><br>  <b>The second</b> is a mandatory set of <u>4 parameters:</u> <br><ul><li>  1. v - protocol version, currently the value of 1 is used; </li><li>  2. tid - Google Analytics tracking code (resource) identifier in the form UA-XXXX-Y; </li><li>  3. cid - anonymous Client-ID; </li><li>  4. t - hit type. </li></ul><br><br>  If the first and second parameters should not cause difficulties, then the third and fourth require clarification. <br>  The cid parameter is an anonymous client-id or client identifier.  If a visitor views your site using a browser, Universal Analytics will store the client-id value in a cookie, and if you don‚Äôt know the value, use any of your own. <br><br>  Please note that if you use a client-id, which is obtained from a cookie file, the transferred data will be matched with other actions of the visitor, and if you transfer your value, then a certain hit of the new visitor will be recorded (operations under one client-id are assigned to one visitor) .  For an illustration of this, look at the image: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97b/02c/1ac/97b02c1aca4f24702634785c2e443716.jpg" alt="image"><br><br>  Viewing the page at number 1 is the first visit to the site, viewing 2 is generated using the Mesurement Protocol by clicking on the button (using the clid from the cookie set in visiting number 1).  We have a report on the site will be 1 visitor. <br><br>  View 3, as well as view 2, was generated by clicking on a button, with the value 12345 being transmitted as clid, which results in the appearance of a second visitor on the site.  According to the report, we already have 2 visitors.  View 4 is completely similar to view 2 (this is the action of visitor number 1, which previously made views 1 and 2). <br><br>  Let's return to the parameters.  The next <u>parameter is t</u> (this is the hit type).  It can take a limited range of values ‚Äã‚Äã- 'pageview', 'appview', 'event', 'transaction', 'item', 'social', 'exception', 'timing'. <br><br>  <b>The most commonly used values ‚Äã‚Äãare:</b> <br>  pageview - page view; <br>  event - event; <br>  transaction - transaction; <br>  item is a transaction item. <br><br>  Already, you have the ability to transfer data to Universal Analytics using the Measurement Protocol.  But in order for us to receive reliable and complete information in the reports, <u>two more steps are</u> needed <u>:</u> <br><br>  <b>1.</b> Get the client-id of the site visitor and save it to CRM along with the order data (compare the user's activity on the site and its offline actions). <br><br>  <b>2.</b> Supplement the request with additional parameters that allow us to work with the transmitted data in the reports. <br>  You can get clien-id from Universal Analytics cookie: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ed/1c6/f71/6ed1c6f7126d806fed8aba11d46c5e91.jpg" alt="image"><br><br>  You can independently or with the help of developers get the desired value.  I use the following PHP code in my work (by Matt Clarke): <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * Name: Universal Analytics Cookie Parser Class * Description: Parses the new format Universal Analytics cookie. * Developer: Matt Clarke * Date: January 10, 2013 */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalAnalyticsCookieParser</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Parse the _ga cookie if found function __construct() { if( isset($_COOKIE["_ga"]) ){ echo $this-&gt;getCid(); } } // Handle the parsing of the _ga cookie public function parseCookie() { list($version,$domainDepth, $cid1, $cid2) = split('[\.]', $_COOKIE["_ga"],4); return array('version' =&gt; $version, 'domainDepth' =&gt; $domainDepth, 'cid' =&gt; $cid1.'.'.$cid2); } // Get cid public function getCid() { $contents = $this-&gt;parseCookie(); return $contents['cid']; } }</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><br>  As for the additional parameters, there are a lot of them, some of them with a description in Russian can be found <a href="http://prometriki.ru/measurement-protocol-28-parametrov-dly-peredachi-dannih-v-universal-analytics/">here</a> , and the full list is available in the official Google Analytics documentation. <br><br>  Consider some of the parameters that relate to previously designated <b>types of hits.</b> <br><ul><li>  dh - the domain name of the site; </li><li>  dp - the address of the page relative to the domain name of the site; </li><li>  dt - page title; </li><li>  ec - event category; </li><li>  ea - event action; </li><li>  el - event label; </li><li>  ti is a transaction identifier; </li><li>  ta is the name of the branch or store; </li><li>  tr is the total amount of the transaction; </li><li>  in - the name of the product; </li><li>  ip - the cost of the goods; </li><li>  iv - product category. </li></ul><br><br>  Now that we have everything we need to use the <i>Measurement Protocol</i> , we can try the acquired knowledge in practice.  We will use all the types of hits that were previously named.  I will demonstrate data transfer by sending queries using jQuery. <br><br>  <u>Sending page view data:</u> <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#buttonId'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ $.post( <span class="hljs-string"><span class="hljs-string">"http://www.google-analytics.com/collect"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">v</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tid</span></span>: <span class="hljs-string"><span class="hljs-string">'UA-xxxxx-1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cid</span></span>: <span class="hljs-string"><span class="hljs-string">'12xx916x95.13x6127xx4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>: <span class="hljs-string"><span class="hljs-string">'pageview'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dh</span></span>: <span class="hljs-string"><span class="hljs-string">'test.prometriki.ru'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dp</span></span>: <span class="hljs-string"><span class="hljs-string">'/my-test-page'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dt</span></span>: <span class="hljs-string"><span class="hljs-string">'  !'</span></span> }, onAjaxSuccess ) });</code> </pre> <br><br>  <u>Sending event data:</u> <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#buttonId'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ $.post( <span class="hljs-string"><span class="hljs-string">"http://www.google-analytics.com/collect"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">v</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tid</span></span>: <span class="hljs-string"><span class="hljs-string">'UA-xxxxx-1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cid</span></span>: <span class="hljs-string"><span class="hljs-string">'12xx916x95.13x6127xx4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>: <span class="hljs-string"><span class="hljs-string">'event'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ec</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-attr"><span class="hljs-attr">ea</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">el</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }, onAjaxSuccess ) });</code> </pre> <br><br>  <u>Sending purchase data:</u> <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#buttonId'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ $.post( <span class="hljs-string"><span class="hljs-string">"http://www.google-analytics.com/collect"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">v</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tid</span></span>: <span class="hljs-string"><span class="hljs-string">'UA-xxxxx-1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cid</span></span>: <span class="hljs-string"><span class="hljs-string">'12xx916x95.13x6127xx4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>: <span class="hljs-string"><span class="hljs-string">'transaction'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ti</span></span>: <span class="hljs-string"><span class="hljs-string">'44473'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ta</span></span>: <span class="hljs-string"><span class="hljs-string">'SITE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tr</span></span>: <span class="hljs-string"><span class="hljs-string">'19990.00'</span></span> }, onAjaxSuccess ) $.post( <span class="hljs-string"><span class="hljs-string">"http://www.google-analytics.com/collect"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">v</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tid</span></span>: <span class="hljs-string"><span class="hljs-string">'UA-xxxxx-1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cid</span></span>: <span class="hljs-string"><span class="hljs-string">'12xx916x95.13x6127xx4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>: <span class="hljs-string"><span class="hljs-string">'item'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ti</span></span>: <span class="hljs-string"><span class="hljs-string">'44473'</span></span>, <span class="hljs-string"><span class="hljs-string">'in'</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-attr"><span class="hljs-attr">ip</span></span>: <span class="hljs-string"><span class="hljs-string">'19990.00'</span></span>, <span class="hljs-attr"><span class="hljs-attr">iv</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span> }, onAjaxSuccess ) });</code> </pre> <br><br>  Please note that in order to send purchase data, you must first transfer data about the transaction, and then about each item. <br><br>  At what point do you need to transfer data using the Mesurement Protocol?  For the examples that I gave at the very beginning of the publication, the transfer of the application to CRM from the status ‚Äúorder is delivered‚Äù to ‚Äúorder paid‚Äù can be the moment of data transfer.  Developers, if they have the necessary data, it will not be difficult to send a generated request for a specific action or event on the site. <br><br>  As you can see, there is no difficulty in using this functionality of Universal Analytics.  Use it to collect reliable data and optimize your business. <br><br>  For complete and official information, refer to the documentation. <br><br>  <u>In conclusion, I will give an example of a video clip</u> that demonstrates the recording of events and the transfer of information to Universal Analytics for a motion sensor: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/K3O9flJbtnw%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700191,15700253,15700255&amp;usg=ALkJrhj7599s4hv8qx3fj1PQoGMOYFwyjw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/222169/">https://habr.com/ru/post/222169/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222157/index.html">New Nimbus Note - even faster and more convenient.</a></li>
<li><a href="../222159/index.html">Ëû¢ÁÅ´Ëü≤ (Firefly): You can't take the sky from me</a></li>
<li><a href="../222161/index.html">Remote work: how we do it</a></li>
<li><a href="../222165/index.html">The standoff of Apple and Google in the gaming application sector</a></li>
<li><a href="../222167/index.html">Firefox Developer Tools Update</a></li>
<li><a href="../222173/index.html">The task of changing the voice. Part 3. Applied speech signal models: LPC</a></li>
<li><a href="../222183/index.html">Bacteria from Earth are able to colonize Mars</a></li>
<li><a href="../222187/index.html">PocketBook Reader - we read on phones comfortably</a></li>
<li><a href="../222189/index.html">We start the Weekend contest ‚ÄúI want to DevConf 2014!‚Äù With the draw of free passes on the main day of DevConf 2014</a></li>
<li><a href="../222191/index.html">Testing Web UI with Vika in pleasure or Virtual Intellect in testing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>