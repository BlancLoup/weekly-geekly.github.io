<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of a parser, code generator and SQL editor using EMFText</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the 6th article of the model-driven development cycle. In the last article, you got a general idea about developing domain-specific languages ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of a parser, code generator and SQL editor using EMFText</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/45a/9f3/216/45a9f3216ed64ca197f3cb2958fdddfb.jpg"><br><br>  This is the 6th article of the model-driven development cycle.  In the <a href="http://habrahabr.ru/post/270483/">last article,</a> you got a general idea about developing domain-specific languages ‚Äã‚Äãusing EMFText.  It is time to move from a toy language to a more serious one.  There will be a lot of pictures, code and text.  If you are planning to use EMFText or a similar tool, then this article should save you a lot of time.  You may learn something new about EMF (delegates to change). <br><br>  Like a brave hobbit, we will begin our journey with SQL BNF grammar, get to the creepy dragon (metamodel) and go back to grammar, but another one ... <br><a name="habracut"></a><br><h4>  <font color="#902213"><b>Introduction</b></font> </h4><br>  Today we will develop a parser, code generator and SQL editor.  Kodogenerator will be required in the following article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Generally, SQL is a very complex language.  Much more complicated than, for example, Java.  To verify this, compare <a href="http://docs.oracle.com/javase/specs/jls/se8/html/jls-19.html">Java</a> and <a href="http://savage.net.au/SQL/sql-2003-2.bnf.html">SQL</a> grammars.  It's just hard.  Therefore, in the article we will implement a small fragment of SQL - expression to create tables (CREATE TABLE), and, moreover, not completely. <br><br><h4>  <font color="#902213"><b>1 setting</b></font> </h4><br>  As usual, you will need <a href="https://www.eclipse.org/downloads/">Eclipse Modeling Tools</a> .  Install the latest version of <a href="http://www.emftext.org/index.php/EMFText_Download">EMFText</a> from here <a href="http://emftext.org/update_trunk">http://emftext.org/update_trunk</a> . <br><br><h4>  <font color="#902213"><b>2 Creating a project</b></font> </h4><br>  You can either take the <a href="https://github.com/AresEkb/sql">finished project</a> or create a new one (File -&gt; New -&gt; Other ... -&gt; EMFText Project). <br><br><img src="https://habrastorage.org/files/f1e/dda/0f8/f1edda0f8de64dbc89652e962948c270.png"><br><br>  In the new project, in the model folder, blanks have already been created for the metamodel (sql.ecore) and grammar (sql.cs) of the developed language, which you met in the <a href="http://habrahabr.ru/post/270483/">last article</a> .  These two files completely describe the language.  Almost everything else is generated from them. <br><br>  Remove all classes and types from the metamodel, we will not need them.  You can edit the metamodel either in the tree editor or in the diagram editor.  To create a diagram for a metamodel, select File -&gt; New -&gt; Other ... -&gt; Sirius -&gt; Representations File.  Select chart initialization from existing model (sql.ecore).  Select the ‚ÄúDesign‚Äù point of view.  Switch to the Sirius perspective (Window -&gt; Perspective -&gt; Open Perspective -&gt; Other ...).  Open the created aird file.  Create a class diagram for the sql package. <br><br><img src="https://habrastorage.org/files/675/328/888/67532888834f439081518acf5d48ca15.png"><br><br><blockquote>  <b>Note</b> <br><br>  We discussed the <a href="http://habrahabr.ru/company/cit/blog/266433/">tree editor</a> and <a href="http://habrahabr.ru/company/cit/blog/267335/">chart editor</a> in detail in previous articles.  If you do not like to create a model with the mouse, but prefer a textual representation, you can try using <a href="http://habrahabr.ru/company/cit/blog/269291/">Xcore</a> .  I have never used it in conjunction with EMFText, but in principle, there should be no problems. <br><br>  You can also open the Ecore model using the OCLinEcore editor.  It is a text, like Xcore, only <a href="http://habrahabr.ru/company/cit/blog/264963/">OCL is</a> used instead of Java.  By the way, in a <a href="https://github.com/AresEkb/sql/blob/master/org.emftext.language.sql/model/sql.ecore">metamodel,</a> one computed property and one control rule are written using OCLinEcore, but this is a topic for a separate article. <br><br>  In a word, you have 4 editors to choose from to work with the metamodel :) Tree, diagram, text-based Java-oriented, text-based OCL-oriented. </blockquote><br><h4>  <font color="#902213"><b>3 Approaches to the development of language metamodel</b></font> </h4><br>  There are two ways to create a metamodel of a domain-specific language: 1) from the domain or 2) from syntax. <br><br>  In the first case, you are trying to imagine <b>what</b> should describe the language.  For example, the language from the <a href="http://habrahabr.ru/post/270483/">previous article</a> describes entities, data types, properties.  And the language from <a href="http://habrahabr.ru/company/cit/blog/266433/">this article</a> describes anchors, connections, nodes, attributes.  For each type of object, you create a corresponding class in the metamodel.  And then describe textual notation for these classes.  In other words, this is the path from semantics to syntax. <br><br>  In the second case, you analyze the grammar of the language, see <b>how</b> the subject area is described in this language.  For each non-terminal character, create a class in the metamodel.  Metamodel turns out very big, redundant and complex.  You drop everything superfluous from it, optimize it and as a result get a more or less adequate metamodel.  In other words, this is the path from syntax to semantics. <br><br>  The first way looks more correct, but it is dangerous in that the metamodel may turn out too detached from the language.  For example, what does SQL describe?  Personally, I was convinced that this is a language about tables, columns, views, constraints, keys, ... - about objects, which are described at the end of the SQL specification in the sections Information Schema and Definition Schema.  It would be logical to create corresponding classes in the language meta-model: table, column, etc.  But this is wrong, because in the end we will get the metadata structure of the relational DBMS, and not the structure of the operators of the SQL language. <br><br>  There are no tables, columns, restrictions as such in SQL.  Instead, there are operators to create, delete, modify these objects.  Accordingly, in the metamodel instead of the ‚ÄúTable‚Äù class, there should be the classes ‚ÄúTable creation operator‚Äù, ‚ÄúTable deletion operator‚Äù, ‚ÄúTable modification operator‚Äù, ... <br><br>  This SQL is fundamentally different from the simple declarative language from the <a href="http://habrahabr.ru/post/270483/">previous article</a> .  It is customary to consider SQL as a declarative language, unlike, for example, Java.  But damn, in Java I can write: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> String name; }</code> </pre> <br>  And in SQL I cannot describe the table declaratively, but I can only call the table creation operator: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"user"</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> user_pk PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> );</code> </pre><br>  Or several operators: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"user"</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> user_pk PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"user"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;</code> </pre><br>  Because of this, validation of SQL scripts is complicated.  We can first create a table, then delete it, then create another table with the same name.  Imagine if in Java you could unzip variables, change their data type or add / remove class properties!  How generally to validate such code? <br><br><blockquote>  <b>Note</b> <br><br>  Probably, this does not make SQL a language with dynamic typing.  I already feel like tomatoes are flying into me for ‚Äúimperative and dynamically typed‚Äù SQL :) But try implementing a parser or editor of SQL scripts and you will come to the conclusion that this is equivalent to the implementation of an imperative and dynamically typed language.  To determine the valid table or column names, the parser has to actually interpret the code, but without changing the real database.  In this article, this interpretation is implemented as simply as possible (in the classes responsible for resolving the links described below), in reality, everything is more complicated.  Some ideas on the mechanism for resolving links can be drawn from <a href="http://www.jamopp.org/">JaMoPP</a> . </blockquote><br><h4>  <font color="#902213"><b>4 Development of SQL metamodel</b></font> </h4><br>  So, the first path to the metamodel is good for declarative languages ‚Äã‚Äãlike <a href="http://habrahabr.ru/company/cit/blog/270483/">EntityModel</a> or <a href="http://habrahabr.ru/company/cit/blog/266433/">Anchor</a> .  And to come to the SQL metamodel is easier for us the second way.  We will analyze a small fragment of the <a href="http://savage.net.au/SQL/sql-2003-2.bnf.html">SQL grammar</a> and create the necessary classes for it. <br><br>  The BNF grammar of a language consists of rules, in the left part of which there is one non-terminal character, and in the right part there are several terminal or non-terminal characters.  Without thinking, we could create a class for each non-terminal symbol from the left side, and an attribute or a link to the corresponding class for each non-terminal symbol from the right side.  But, believe me, the metamodel will turn out very complicated, it will not be convenient to work with it.  Therefore, I have formulated for myself a few recommendations that allow you to immediately build a more or less simplified metamodel. <br><br><ol><li>  If on the right side of the rule there is a ‚Äúcomplex‚Äù sequence of characters, then for a non-terminal symbol from the left side of the rule we create a <b>class</b> . </li><li>  If on the right side of the rule there is a choice of several ‚Äúcomplex‚Äù sequences of symbols, then for a non-terminal symbol from the left side of the rule we create an <b>abstract class</b> , and for each alternative we create a <b>concrete subclass</b> that we inherit from the abstract one. </li><li>  If in the right part of the rule there is a choice of several ‚Äúsimple‚Äù sequences of characters, then for a non-terminal character from the left part of the rule we create an <b>enumeration</b> . </li><li>  If the right part of the rule is relatively ‚Äúsimple‚Äù, but it is impossible to list all possible options, then either use one of the <b>primitive data types Ecore</b> for a non-terminal character from the left part or (if there is no suitable one) create a <b>new data type</b> . </li><li>  For each ‚Äúsimple‚Äù non-terminal symbol from the right side, which is not a link by name to some object of the domain, we create <b>an attribute</b> in the class from the left side of the rule. </li><li>  For each ‚Äúsimple‚Äù non-terminal character from the right side, which is not a link by name to some object of the domain, create a <b>non-containment link</b> in the class from the left side of the rule to the class of the named object. </li><li>  For each ‚Äúcomplex‚Äù non-terminal character from the right side, create a <b>containment reference</b> in the class from the left side of the rule to the class corresponding to the given non-terminal character from the right side. </li></ol><br>  All these recommendations sound like some kind of kindergarten :) What do ‚Äúsimple‚Äù and ‚Äúcomplex‚Äù mean?  There are also some exceptions to these rules.  For example, if characters are reused in different rules. <br><br>  I began to describe all this formally, with clear definitions.  But on the second page I realized that this is a topic for a separate scientific work that simply does not fit in this already gigantic article.  Therefore, I propose to do so by such intuitive recommendations. <br><br><h5>  <font color="#902213">4.1 Rule analysis for &lt;table definition&gt;</font> </h5><br>  So, the first rule that interests us, describes the expression definitions of tables. <br><br><pre> <code class="hljs pgsql">&lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> definition&gt; ::= <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> [ &lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> scope&gt; ] <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> contents source&gt; [ <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> action&gt; <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> ]</code> </pre><br>  It looks quite ‚Äúcomplex‚Äù: in the right part there is the scope of the table being created, the name of the table, the source of the content and the action at the commit.  The rule falls under recommendation 1, which means we create the class TableDefinition. <br><br><img src="https://habrastorage.org/files/f60/394/5ef/f603945efd174ec98a859aeb1afee3c6.png"><br><br>  Now we will analyze non-terminal symbols from the right side.  For each of them, in accordance with recommendations 5-7, we must create an attribute or reference in the TableDefinition class. <br><br><h5>  <font color="#902213">4.2 Rule analysis for &lt;table scope&gt;</font> </h5><br><pre> <code class="hljs pgsql">&lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> scope&gt; ::= &lt;<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">TEMPORARY</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>&gt; ::= <span class="hljs-keyword"><span class="hljs-keyword">GLOBAL</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span></code> </pre><br>  It can be seen that the right parts of the rules are quite ‚Äúsimple‚Äù.  For greater simplicity, they can be combined into one rule and, in accordance with recommendation 3, create a TableScope enumeration with three values ‚Äã‚Äãin the metamodel: <br><br><ul><li>  PERSISTENT </li><li>  GLOBAL_TEMPORARY </li><li>  LOCAL_TEMPORARY </li></ul><br>  The first enumeration option is not explicitly stated in the grammar.  But from the rule for &lt;table definition&gt; it can be seen that the table scope is optional, and by default, permanent tables are created. <br><br><blockquote>  <b>Note</b> <br><br>  You may get the impression that all my arguments are completely non-trivial - it all looks crazy and complicated.  But everything is simpler than it seems, just try it yourself to implement some language. </blockquote><br>  The nonterminal symbol &lt;table scope&gt; is used in the rule for &lt;table definition&gt;.  Therefore, in accordance with recommendation 5, in the class TableDefinition, we create the attribute tableScope with the type TableScope. <br><br><img src="https://habrastorage.org/files/453/278/a8c/453278a8c2d147f08e23d304b2d9b520.png"><br><br><h5>  <font color="#902213">4.3 Rule analysis for &lt;table name&gt;</font> </h5><br>  Now we try to analyze the rule for the name of the table and suddenly we come across a hefty chain of rules, some of which are not even described in the grammar, but described in words in the SQL specification! <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">local</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">or</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">qualified</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">local</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">or</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">qualified</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> ::= [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">local</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">or</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">qualifier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">period</span></span></span><span class="hljs-tag">&gt;</span></span> ] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qualified</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">local</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">or</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">qualifier</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> | MODULE <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qualified</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> ::= [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">catalog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">period</span></span></span><span class="hljs-tag">&gt;</span></span> ] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">unqualified</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">unqualified</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">catalog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actual</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actual</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regular</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">delimited</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regular</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">body</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">start</span></span></span><span class="hljs-tag">&gt;</span></span> [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">part</span></span></span><span class="hljs-tag">&gt;</span></span> ... ] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">part</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">start</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">extend</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">start</span></span></span><span class="hljs-tag">&gt;</span></span> ::= !! See the Syntax Rules. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">extend</span></span></span><span class="hljs-tag">&gt;</span></span> ::= !! See the Syntax Rules. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">delimited</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">quote</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">delimited</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">quote</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">delimited</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">body</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">delimited</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">part</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">delimited</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">identifier</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">part</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nondoublequote</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">character</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">doublequote</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">symbol</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nondoublequote</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">character</span></span></span><span class="hljs-tag">&gt;</span></span> ::= !! See the Syntax Rules. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">doublequote</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">symbol</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">quote</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">quote</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">quote</span></span></span><span class="hljs-tag">&gt;</span></span> ::= "</code> </pre><br>  Most of the rules describe the format of identifiers and names and should be implemented at the data type level, and not in the metamodel.  The only question is where exactly to draw the line between the details of the implementation of data types and the math model.  There are such options for the representation of table names: <br><br><ol><li>  Use the existing EString data type in the metamodel, which in Java corresponds to java.lang.String. </li><li>  Create a new data type with three attributes (directory name, schema name and object name) that will not be visible at the metamodel level. <br><ol><li>  Use existing java.lang.String data type for attributes </li><li>  Use for attributes a new data type "Identifier" </li></ol></li><li>  Create a class with the same three attributes that are already described at the metamodel level. <br><ol><li>  Use existing EString data type for attributes </li><li>  Use for attributes a new data type "Identifier" </li></ol></li></ol><br>  After several sleepless nights and smoking <a href="http://www.jamopp.org/">JaMoPP</a> sources <a href="http://www.jamopp.org/">,</a> I came to the <a href="http://www.jamopp.org/">conclusion</a> that version 3.1 is best.  In options 1 and 2, you will have to create two <b>overlapping</b> types of tokens: an identifier and a qualified name.  It is easier to define one type of token for identifiers.  Anything more complex than identifiers (including qualified names) is implemented at the metamodel level, and everything that is simpler at the data type level. <br><br><img src="https://habrastorage.org/files/da2/c88/2c8/da2c882c8dd5429a99f884d508632f45.png"><br><br><h5>  <font color="#902213">4.4 Rule Analysis for &lt;table contents source&gt;</font> </h5><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contents</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">source</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">element</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">list</span></span></span><span class="hljs-tag">&gt;</span></span> | OF <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path-resolved</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user-defined</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subtable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">clause</span></span></span><span class="hljs-tag">&gt;</span></span> ] [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">element</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">list</span></span></span><span class="hljs-tag">&gt;</span></span> ] | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">as</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">subquery</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">clause</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">element</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">list</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">left</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">paren</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">element</span></span></span><span class="hljs-tag">&gt;</span></span> [ { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">comma</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">element</span></span></span><span class="hljs-tag">&gt;</span></span> }... ] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">right</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">paren</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">left</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">paren</span></span></span><span class="hljs-tag">&gt;</span></span> ::= ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">right</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">paren</span></span></span><span class="hljs-tag">&gt;</span></span> ::= ) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">comma</span></span></span><span class="hljs-tag">&gt;</span></span> ::= ,</code> </pre><br>  The rule for the source of the table content falls under recommendation 2, therefore we create the abstract class TableContentsSource, from which we derive the concrete class TableElementList.  And we will not implement the other two options yet. <br><br>  In accordance with recommendation 7, we create a link from the TableDefinition class to the TableContentsSource class.  For the link, you must set the containment property to true. <br><br><img src="https://habrastorage.org/files/61e/84d/b5e/61e84db5ed5f48fb8908e08463ac1772.png"><br><br>  For parentheses and commas, classes are obviously not needed, they are implemented at the lexer level. <br><br><h5>  <font color="#902213">4.5 Rule Analysis for &lt;table element&gt;</font> </h5><br><pre> <code class="hljs pgsql">&lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> element&gt; ::= &lt;<span class="hljs-keyword"><span class="hljs-keyword">column</span></span> definition&gt; | &lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> definition&gt; | &lt;<span class="hljs-keyword"><span class="hljs-keyword">like</span></span> clause&gt; | &lt;self-referencing <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> specification&gt; | &lt;<span class="hljs-keyword"><span class="hljs-keyword">column</span></span> <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>&gt;</code> </pre><br>  In accordance with recommendation 2, we create the abstract class TableElement and the class ColumnDefinition inherited from it.  We will not implement other options yet. <br><br>  In accordance with recommendation 7, we create a link from the TableElementList class to the TableElement class.  For the link, you must set the containment property to true. <br><br><img src="https://habrastorage.org/files/33a/c4f/7fa/33ac4f7fadc44dc4a96f73f5ea485969.png"><br><br><h5>  <font color="#902213">4.6 Rule Analysis for &lt;column definition&gt;</font> </h5><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">definition</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> ] [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">check</span></span></span><span class="hljs-tag">&gt;</span></span> ] [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">default</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">clause</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">column</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">specification</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">generation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">clause</span></span></span><span class="hljs-tag">&gt;</span></span> ] [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">constraint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">definition</span></span></span><span class="hljs-tag">&gt;</span></span> ... ] [ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">collate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">clause</span></span></span><span class="hljs-tag">&gt;</span></span> ] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">&gt;</span></span> ::= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">identifier</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In accordance with Recommendation 5, we create the columnName attribute with the EString data type in the ColumnDefinition class.  The remaining column properties will not be implemented yet. <br><br><img src="https://habrastorage.org/files/9ab/6c5/407/9ab6c54070f747c6ba7436ca7d115db9.png"><br><br><h4>  <font color="#902213"><b>5 More complete SQL metamodel</b></font> </h4><br>  If you finish a few more rules from the SQL grammar, then get this <a href="https://github.com/AresEkb/sql/tree/master/org.emftext.language.sql/model">metamodel</a> . <br><br>  The root object of the model is SQLScript, which can contain several expressions (Statement) of two types: meaningful expressions and separators.  Separators can also be of two types: whitespace and comments.  We do not need the first in the meta model.  Comments can also be of two types: single-line and multi-line. <br><br>  In general, comments are often not included in the metamodel of the language, because they have no effect on the semantics of the code.  But then we will do not only the parser, but also the code generator.  I wish the latter could generate comments. <br><br><img src="https://habrastorage.org/files/a03/253/0f4/a032530f4f384871aeb295e0e9191a3f.png"><br><br>  Notice the data types on the right.  UnsignedInteger maps to a Java class, which we will implement later.  And the types for representing the date and time are mapped onto existing Java classes. <br><br>  The following figure shows the main part of the metamodel.  Notice that the restrictions (bottom right) indicate not just the names of the columns and tables involved in the restriction, but references to them.  The parser will form a graph from the source code, not a tree. <br><br><img src="https://habrastorage.org/files/0a8/26c/997/0a826c997ba64b858d07ac8bb952e3e9.png"><br><br>  When defining columns, you need to specify their data type: <br><br><img src="https://habrastorage.org/files/270/3ff/450/2703ff4503f149cc9a8802bab2976f71.png"><br><br>  You may need to specify a default value for the column, this requires literals: <br><br><img src="https://habrastorage.org/files/f0d/718/22b/f0d71822bc8a4497b6b8a5b15ab5b09d.png"><br><br>  Also, the default value can be the current date or time: <br><br><img src="https://habrastorage.org/files/5fe/31e/3b9/5fe31e3b904f49a79fa0be0485b1fb18.png"><br><br>  Or NULL: <br><br><img src="https://habrastorage.org/files/fee/774/9dc/fee7749dc4ae4a388847ee1e1c17dfc7.png"><br><br><h4>  <font color="#902213"><b>6 SQL syntax description</b></font> </h4><br>  So, we finally reached Erebor, saw the terrible dragon Smaug (metamodel).  It is time to come back. <br><br><img src="https://habrastorage.org/files/33f/69f/82c/33f69f82cfaf4b4cb356c2baec5740a3.jpg"><br><br>  Now we will again describe the SQL syntax, but no longer in BNF, but in a BNF-like language in the sql.cs file. <br><br>  Specify a) file extension, b) metamodel namespace, and c) root object class of the syntax tree (the initial grammar symbol): <br><br><pre> <code class="hljs pgsql">SYNTAXDEF <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> &lt;http://www.emftext.org/<span class="hljs-keyword"><span class="hljs-keyword">language</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">START</span></span> Common.SQLScript</code> </pre><br>  Few settings are described in the <a href="http://www.emftext.org/EMFTextGuide.php">EMFText manual</a> : <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">OPTIONS</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">reloadGeneratorModel</span></span> = <span class="hljs-string"><span class="hljs-string">"true"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">usePredefinedTokens</span></span> = <span class="hljs-string"><span class="hljs-string">"false"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">caseInsensitiveKeywords</span></span> = <span class="hljs-string"><span class="hljs-string">"true"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">disableBuilder</span></span> = <span class="hljs-string"><span class="hljs-string">"true"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">disableDebugSupport</span></span> = <span class="hljs-string"><span class="hljs-string">"true"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">disableLaunchSupport</span></span> = <span class="hljs-string"><span class="hljs-string">"true"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">disableTokenSorting</span></span> = <span class="hljs-string"><span class="hljs-string">"true"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">overrideProposalPostProcessor</span></span> = <span class="hljs-string"><span class="hljs-string">"false"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">overrideManifest</span></span> = <span class="hljs-string"><span class="hljs-string">"false"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">overrideUIManifest</span></span> = <span class="hljs-string"><span class="hljs-string">"false"</span></span>; }</code> </pre><br>  The last two options disable the regeneration of the MANIFEST.MF files in the org.emftext.language.sql.resource.sql and org.emftext.language.sql.resource.sql.ui plugins, respectively.  In these files, you need to install the minimum required version of Java in JavaSE-1.8, because  we will use the stream API.  And the version of the plugin will be changed from ‚Äú1.0.0‚Äù to ‚Äú1.0.0.qualifier‚Äù otherwise there will be inexplicable problems. <br><br>  Note that the regular expressions for the UNSIGNED_INTEGER and EXACT_NUMERIC_LITERAL tokens overlap.  Because of this, we will have to further complicate the grammar. <br><br><pre> <code class="hljs smalltalk"><span class="hljs-type"><span class="hljs-type">TOKENS</span></span> { // <span class="hljs-type"><span class="hljs-type">Default</span></span> <span class="hljs-type"><span class="hljs-type">DEFINE</span></span> <span class="hljs-type"><span class="hljs-type">WHITESPACE</span></span> <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'\u0009'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u000A'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u000B'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u000C'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u000D'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u0020'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u00A0'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2000'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2001'</span></span><span class="hljs-string"><span class="hljs-string">$ </span></span>+ <span class="hljs-string"><span class="hljs-string">$|</span></span><span class="hljs-string"><span class="hljs-string">'\u2002'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2003'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2004'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2005'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2006'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2007'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2008'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2009'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u200A'</span></span><span class="hljs-string"><span class="hljs-string">$ </span></span>+ <span class="hljs-string"><span class="hljs-string">$|</span></span><span class="hljs-string"><span class="hljs-string">'\u200B'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u200C'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u200D'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u200E'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u200F'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2028'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u2029'</span></span>|<span class="hljs-string"><span class="hljs-string">'\u3000'</span></span>|<span class="hljs-string"><span class="hljs-string">'\uFEFF'</span></span>)<span class="hljs-string"><span class="hljs-string">$;</span></span> // <span class="hljs-type"><span class="hljs-type">Single</span></span> characters <span class="hljs-type"><span class="hljs-type">DEFINE</span></span> <span class="hljs-type"><span class="hljs-type">FRAGMENT</span></span> <span class="hljs-type"><span class="hljs-type">SIMPLE_LATIN_LETTER</span></span> <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">$ </span></span>+ <span class="hljs-type"><span class="hljs-type">SIMPLE_LATIN_UPPER_CASE_LETTER</span></span> + <span class="hljs-string"><span class="hljs-string">$|</span></span><span class="hljs-string"><span class="hljs-string">$ </span></span>+ <span class="hljs-type"><span class="hljs-type">SIMPLE_LATIN_LOWER_CASE_LETTER</span></span> + <span class="hljs-string"><span class="hljs-string">$)</span></span><span class="hljs-string"><span class="hljs-string">$;</span></span> <span class="hljs-type"><span class="hljs-type">DEFINE</span></span> <span class="hljs-type"><span class="hljs-type">FRAGMENT</span></span> <span class="hljs-type"><span class="hljs-type">SIMPLE_LATIN_UPPER_CASE_LETTER</span></span> <span class="hljs-string"><span class="hljs-string">$'</span></span><span class="hljs-type"><span class="hljs-type">A</span></span><span class="hljs-string"><span class="hljs-string">'..'</span></span><span class="hljs-type"><span class="hljs-type">Z</span></span><span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT SIMPLE_LATIN_LOWER_CASE_LETTER $'</span></span>a<span class="hljs-string"><span class="hljs-string">'..'</span></span>z<span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT DIGIT $('</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-string"><span class="hljs-string">'..'</span></span><span class="hljs-number"><span class="hljs-number">9</span></span><span class="hljs-string"><span class="hljs-string">')$; DEFINE FRAGMENT PLUS_SIGN $'</span></span>+<span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT MINUS_SIGN $'</span></span>-<span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT SIGN $($ + PLUS_SIGN + $|$ + MINUS_SIGN + $)$; DEFINE FRAGMENT COLON $'</span></span>:<span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT PERIOD $'</span></span>.<span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT SPACE $'</span></span> <span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT UNDERSCORE $'</span></span>_<span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT SLASH $'</span></span>/<span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT ASTERISK $'</span></span>*<span class="hljs-string"><span class="hljs-string">'$; DEFINE FRAGMENT QUOTE $'</span></span>\<span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">$;</span></span> <span class="hljs-type"><span class="hljs-type">DEFINE</span></span> <span class="hljs-type"><span class="hljs-type">FRAGMENT</span></span> <span class="hljs-type"><span class="hljs-type">QUOTE_SYMBOL</span></span> <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">$ </span></span>+ <span class="hljs-type"><span class="hljs-type">QUOTE</span></span> + <span class="hljs-type"><span class="hljs-type">QUOTE</span></span> + <span class="hljs-string"><span class="hljs-string">$)</span></span><span class="hljs-string"><span class="hljs-string">$;</span></span> <span class="hljs-type"><span class="hljs-type">DEFINE</span></span> <span class="hljs-type"><span class="hljs-type">FRAGMENT</span></span> <span class="hljs-type"><span class="hljs-type">NONQUOTE_CHARACTER</span></span> <span class="hljs-string"><span class="hljs-string">$~</span></span>(<span class="hljs-string"><span class="hljs-string">$ </span></span>+ <span class="hljs-type"><span class="hljs-type">QUOTE</span></span> + <span class="hljs-string"><span class="hljs-string">$|</span></span><span class="hljs-string"><span class="hljs-string">$ </span></span>+ <span class="hljs-type"><span class="hljs-type">NEWLINE</span></span> + <span class="hljs-string"><span class="hljs-string">$)</span></span><span class="hljs-string"><span class="hljs-string">$;</span></span> <span class="hljs-type"><span class="hljs-type">DEFINE</span></span> <span class="hljs-type"><span class="hljs-type">FRAGMENT</span></span> <span class="hljs-type"><span class="hljs-type">DOUBLE_QUOTE</span></span> <span class="hljs-string"><span class="hljs-string">$'</span></span><span class="hljs-comment"><span class="hljs-comment">"'$; DEFINE FRAGMENT DOUBLEQUOTE_SYMBOL $($ + DOUBLE_QUOTE + DOUBLE_QUOTE + $)$; DEFINE FRAGMENT NONDOUBLEQUOTE_CHARACTER $~($ + DOUBLE_QUOTE + $|$ + NEWLINE + $)$; DEFINE FRAGMENT NEWLINE $('\r\n'|'\r'|'\n')$; // Comments DEFINE SIMPLE_COMMENT SIMPLE_COMMENT_INTRODUCER + $($ + COMMENT_CHARACTER + $)*$; DEFINE FRAGMENT SIMPLE_COMMENT_INTRODUCER MINUS_SIGN + MINUS_SIGN; DEFINE FRAGMENT COMMENT_CHARACTER $~('\n'|'\r'|'\uffff')$; DEFINE BRACKETED_COMMENT BRACKETED_COMMENT_INTRODUCER + BRACKETED_COMMENT_CONTENTS + BRACKETED_COMMENT_TERMINATOR; DEFINE FRAGMENT BRACKETED_COMMENT_INTRODUCER SLASH + ASTERISK; DEFINE FRAGMENT BRACKETED_COMMENT_TERMINATOR ASTERISK + SLASH; DEFINE FRAGMENT BRACKETED_COMMENT_CONTENTS $.*$; // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Nested comments // Literals DEFINE UNSIGNED_INTEGER $($ + DIGIT + $)+$; DEFINE EXACT_NUMERIC_LITERAL $($ + UNSIGNED_INTEGER + $($ + PERIOD + $($ + UNSIGNED_INTEGER + $)?)?|$ + PERIOD + UNSIGNED_INTEGER + $)$; DEFINE APPROXIMATE_NUMERIC_LITERAL MANTISSA + $'E'$ + EXPONENT; DEFINE FRAGMENT MANTISSA EXACT_NUMERIC_LITERAL; DEFINE FRAGMENT EXPONENT SIGNED_INTEGER; DEFINE FRAGMENT SIGNED_INTEGER SIGN + $?$ + UNSIGNED_INTEGER; DEFINE QUOTED_STRING QUOTE + CHARACTER_REPRESENTATION + $*$ + QUOTE; DEFINE FRAGMENT CHARACTER_REPRESENTATION $($ + NONQUOTE_CHARACTER + $|$ + QUOTE_SYMBOL + $)$; // Names and identifiers DEFINE IDENTIFIER ACTUAL_IDENTIFIER; DEFINE FRAGMENT ACTUAL_IDENTIFIER $($ + REGULAR_IDENTIFIER + $|$ + DELIMITED_IDENTIFIER + $)$; DEFINE FRAGMENT REGULAR_IDENTIFIER IDENTIFIER_BODY; DEFINE FRAGMENT IDENTIFIER_BODY IDENTIFIER_START + IDENTIFIER_PART + $*$; DEFINE FRAGMENT IDENTIFIER_PART $($ + IDENTIFIER_START + $|$ + IDENTIFIER_EXTEND + $)$; DEFINE FRAGMENT IDENTIFIER_START $('A'..'Z'|'a'..'z')$; // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> \p{L} - \p{M} DEFINE FRAGMENT IDENTIFIER_EXTEND $($ + DIGIT + $|$ + UNDERSCORE + $)$; // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Support more characters DEFINE FRAGMENT DELIMITED_IDENTIFIER DOUBLE_QUOTE + DELIMITED_IDENTIFIER_BODY + DOUBLE_QUOTE; DEFINE FRAGMENT DELIMITED_IDENTIFIER_BODY DELIMITED_IDENTIFIER_PART + $+$; DEFINE FRAGMENT DELIMITED_IDENTIFIER_PART $($ + NONDOUBLEQUOTE_CHARACTER + $|$ + DOUBLEQUOTE_SYMBOL + $)$; }</span></span></code> </pre><br>  Let's color tokens: <br><br><pre> <code class="hljs objectivec">TOKENSTYLES { <span class="hljs-string"><span class="hljs-string">"SIMPLE_COMMENT"</span></span>, <span class="hljs-string"><span class="hljs-string">"BRACKETED_COMMENT"</span></span> COLOR <span class="hljs-meta"><span class="hljs-meta">#999999, ITALIC; </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"QUOTED_STRING"</span></span></span><span class="hljs-meta"> COLOR #000099, ITALIC; </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"EXACT_NUMERIC_LITERAL"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"APPROXIMATE_NUMERIC_LITERAL"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UNSIGNED_INTEGER"</span></span></span><span class="hljs-meta"> COLOR #009900; }</span></span></code> </pre><br>  And, finally, in the section RULES {} we will describe the syntax for the classes from the metamodel. <br><br><h5>  <font color="#902213">6.1 Syntax description for the script as a whole, comments and names</font> </h5><br>  If you read the <a href="http://habrahabr.ru/company/cit/blog/270483/">previous article</a> , then the meaning of these rules should be obvious to you: <br><br><pre> <code class="hljs go"> Common.SQLScript ::= (statements !<span class="hljs-number"><span class="hljs-number">0</span></span>)*; Common.SimpleComment ::= value[SIMPLE_COMMENT]; Common.BracketedComment ::= value[BRACKETED_COMMENT]; Common.SchemaQualifiedName ::= ((catalogName[IDENTIFIER] <span class="hljs-string"><span class="hljs-string">"."</span></span>)? schemaName[IDENTIFIER] <span class="hljs-string"><span class="hljs-string">"."</span></span>)? name[IDENTIFIER];</code> </pre><br><h5>  <font color="#902213">6.2 Syntax Description for Literals</font> </h5><br><pre> <code class="hljs pgsql"> @SuppressWarnings(explicitSyntaxChoice) Literal.ExactNumericLiteral ::= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>[EXACT_NUMERIC_LITERAL] | <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>[UNSIGNED_INTEGER]; Literal.ApproximateNumericLiteral ::= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>[APPROXIMATE_NUMERIC_LITERAL]; Literal.CharacterStringLiteral ::= ("_" characterSetName)? <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>[QUOTED_STRING] (separators <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>[QUOTED_STRING])*; Literal.NationalCharacterStringLiteral ::= "N" <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>[QUOTED_STRING] (separators <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>[QUOTED_STRING])*; Literal.DateLiteral ::= "DATE" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>[QUOTED_STRING]; Literal.TimeLiteral ::= "TIME" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>[QUOTED_STRING]; Literal.TimestampLiteral ::= "TIMESTAMP" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>[QUOTED_STRING]; Literal.BooleanLiteral ::= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>[ "TRUE" : "FALSE" ]?;</code> </pre><br>  It is necessary to elaborate on the first rule.  The regular expressions for the EXACT_NUMERIC_LITERAL and UNSIGNED_INTEGER tokens intersect.  For example, if you write a number in the SQL script in decimal notation without the ‚Äú.‚Äù Character, it will be interpreted by the lexer as UNSIGNED_INTEGER.  Then the parser, seeing in the sequence of tokens UNSIGNED_INTEGER instead of EXACT_NUMERIC_LITERAL, will generate an error that another token was expected at this place.  Therefore, when crossing tokens it is necessary to complicate the grammar in a similar way. <br><br>  And here, APPROXIMATE_NUMERIC_LITERAL cannot be confused with other tokens, because it always contains the symbol "E". <br><br>  If you carefully looked at the <a href="http://savage.net.au/SQL/sql-2003-2.bnf.html">BNF grammar of SQL</a> , you probably noticed that it describes the date and time format in sufficient detail, and we limited ourselves to simple QUOTED_STRING.  This is due to the fact that if we described the tokens for the date and time, they would intersect with the QUOTED_STRING token and we would have to complicate the grammar very much (wherever the QUOTED_STRING token is also specified to be valid).  Or it would be necessary to describe the component parts of literals (up to individual characters) in a metamodel, which would make it incredibly complicated. <br><br>  It is easier to implement parsing of the date and time in the code, and not at the lexer level.  Next, I will describe how to do this. <br><br><h5> <font color="#902213">6.3     </font> </h5><br>    .      ,   SQL   . , ¬´DATE¬ª      ,     .   , ,  ,    ,  ,   ,   ,   EMFText     ,           ¬´DATE¬ª. <br><br>      ¬´¬ª   ¬´DOUBLE¬ª ¬´PRECISION¬ª.        "_"     ?..     ,        ¬´¬ª ,        ,   ,   ..       EMFText,    ,      .     ,    .       ,   ,      . <br><br>   ¬´¬ª     6.5.   ,  ,  ,     SQL- ¬´GLOBAL¬ª ¬´TEMPORARY¬ª  ¬´LOCAL¬ª ¬´TEMPORARY¬ª. <br><br><pre> <code class="hljs pgsql"> Datatype.ExactNumericType ::= kind[ <span class="hljs-type"><span class="hljs-type">NUMERIC</span></span> : "NUMERIC", <span class="hljs-type"><span class="hljs-type">DECIMAL</span></span> : "DECIMAL", <span class="hljs-type"><span class="hljs-type">DEC</span></span> : "DEC", <span class="hljs-type"><span class="hljs-type">SMALLINT</span></span> : "SMALLINT", <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> : "INTEGER", <span class="hljs-type"><span class="hljs-type">INT</span></span> : "INT", <span class="hljs-type"><span class="hljs-type">BIGINT</span></span> : "BIGINT" ] ("(" <span class="hljs-type"><span class="hljs-type">precision</span></span>[UNSIGNED_INTEGER] ("," scale[UNSIGNED_INTEGER])? ")")?; Datatype.ApproximateNumericType ::= kind[ <span class="hljs-type"><span class="hljs-type">FLOAT</span></span> : "FLOAT", <span class="hljs-type"><span class="hljs-type">REAL</span></span> : "REAL", DOUBLE_PRECISION : "DOUBLE PRECISION" ] ("(" <span class="hljs-type"><span class="hljs-type">precision</span></span>[UNSIGNED_INTEGER] ")")?; Datatype.CharacterStringType ::= kind[ <span class="hljs-type"><span class="hljs-type">CHARACTER</span></span> : "CHARACTER", <span class="hljs-type"><span class="hljs-type">CHAR</span></span> : "CHAR", <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span> : "VARCHAR", CHARACTER_VARYING : "CHARACTER VARYING", CHAR_VARYING : "CHAR VARYING" ] ("(" length[UNSIGNED_INTEGER] ")")? ("CHARACTER" "SET" characterSetName)? ("COLLATE" collationName)?; Datatype.NationalCharacterStringType ::= kind[ NATIONAL_CHARACTER : "NATIONAL CHARACTER", NATIONAL_CHAR : "NATIONAL CHAR", NATIONAL_CHARACTER_VARYING : "NATIONAL CHARACTER VARYING", NATIONAL_CHAR_VARYING : "NATIONAL CHAR VARYING", <span class="hljs-type"><span class="hljs-type">NCHAR</span></span> : "NCHAR", NCHAR_VARYING : "NCHAR VARYING" ] ("(" length[UNSIGNED_INTEGER] ")")? ("COLLATE" collationName)?; Datatype.BinaryLargeObjectStringType ::= kind[ BINARY_LARGE_OBJECT : "BINARY LARGE OBJECT", BLOB : "BLOB" ] ("(" length ")")?; Datatype.LargeObjectLength ::= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>[UNSIGNED_INTEGER] multiplier[ K : "K", M : "M", G : "G" ]? units[ CHARACTERS : "CHARACTERS", CODE_UNITS : "CODE_UNITS", OCTETS : "OCTETS" ]?; Datatype.DateType ::= "DATE"; Datatype.TimeType ::= "TIME" ("(" <span class="hljs-type"><span class="hljs-type">precision</span></span>[UNSIGNED_INTEGER] ")")? (withTimeZone["WITH" : "WITHOUT"] "TIME" "ZONE")?; Datatype.TimestampType ::= "TIMESTAMP" ("(" <span class="hljs-type"><span class="hljs-type">precision</span></span>[UNSIGNED_INTEGER] ")")? (withTimeZone["WITH" : "WITHOUT"] "TIME" "ZONE")?; Datatype.BooleanType ::= "BOOLEAN";</code> </pre><br><h5> <font color="#902213">6.4      </font> </h5><br>   : <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>.DatetimeValueFunction ::= kind[ <span class="hljs-built_in"><span class="hljs-built_in">CURRENT_DATE</span></span> : "CURRENT_DATE", <span class="hljs-built_in"><span class="hljs-built_in">CURRENT_TIME</span></span> : "CURRENT_TIME", <span class="hljs-built_in"><span class="hljs-built_in">LOCALTIME</span></span> : "LOCALTIME", <span class="hljs-built_in"><span class="hljs-built_in">CURRENT_TIMESTAMP</span></span> : "CURRENT_TIMESTAMP", <span class="hljs-built_in"><span class="hljs-built_in">LOCALTIMESTAMP</span></span> : "LOCALTIMESTAMP" ] ("(" <span class="hljs-type"><span class="hljs-type">precision</span></span>[UNSIGNED_INTEGER] ")")?; Expression.NullSpecification ::= "NULL";</code> </pre><br><h5> <font color="#902213">6.5     </font> </h5><br>     ,       .     ,     .           ,     ,      ,   . <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.TableReference ::= ((catalogName[IDENTIFIER] ".")? schemaName[IDENTIFIER] ".")? target[IDENTIFIER]; @SuppressWarnings(explicitSyntaxChoice) <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.TableDefinition ::= "CREATE" ( scope[ PERSISTENT : "" ] | scope[ GLOBAL_TEMPORARY : "GLOBAL", LOCAL_TEMPORARY : "LOCAL" ] "TEMPORARY" ) "TABLE" schemaQualifiedName !<span class="hljs-number"><span class="hljs-number">0</span></span> contentsSource ";" !<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.TableElementList ::= "(" !<span class="hljs-number"><span class="hljs-number">1</span></span> elements ("," !<span class="hljs-number"><span class="hljs-number">1</span></span> elements)* !<span class="hljs-number"><span class="hljs-number">0</span></span> ")"; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Column</span></span> ::= <span class="hljs-type"><span class="hljs-type">name</span></span>[IDENTIFIER] dataType ("DEFAULT" defaultOption)? constraintDefinition? ("COLLATE" collationName)?; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.LiteralDefaultOption ::= literal; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.DatetimeValueFunctionDefaultOption ::= <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.ImplicitlyTypedValueSpecificationDefaultOption ::= specification; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.NotNullColumnConstraint ::= ("CONSTRAINT" schemaQualifiedName)? "NOT" "NULL"; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.UniqueColumnConstraint ::= ("CONSTRAINT" schemaQualifiedName)? kind[ <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> : "UNIQUE" , PRIMARY_KEY : "PRIMARY KEY" ]; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.ReferentialColumnConstraint ::= ("CONSTRAINT" schemaQualifiedName)? "REFERENCES" referencedTable ("(" referencedColumns[IDENTIFIER] ("," referencedColumns[IDENTIFIER])* ")")?; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.UniqueTableConstraint ::= ("CONSTRAINT" schemaQualifiedName)? kind[ <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> : "UNIQUE" , PRIMARY_KEY : "PRIMARY KEY" ] "(" <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>[IDENTIFIER] ("," <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>[IDENTIFIER])* ")"; <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.ReferentialTableConstraint ::= ("CONSTRAINT" schemaQualifiedName)? "FOREIGN" "KEY" "(" <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>[IDENTIFIER] ("," <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>[IDENTIFIER])* ")" "REFERENCES" referencedTable ("(" referencedColumns[IDENTIFIER] ("," referencedColumns[IDENTIFIER])* ")")?;</code> </pre><br><h4> <font color="#902213"><b>7  </b></font> </h4><br>       .            (, , ),     ,     (,         ). <br><br>    EMFText   .  SQL    ,     . <br><br><h5> <font color="#902213">7.1  </font> </h5><br>      ‚Äì  . <br><br>          "-".    ‚Äì   : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql.resource.sql.analysis; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EObject; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EStructuralFeature; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlTokenResolveResult; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlTokenResolver; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SqlSIMPLE_COMMENTTokenResolver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISqlTokenResolver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deResolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object value, EStructuralFeature feature, EObject container)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"--"</span></span> + ((String) value); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lexem, EStructuralFeature feature, ISqlTokenResolveResult result)</span></span></span><span class="hljs-function"> </span></span>{ result.setResolvedToken(lexem.substring(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;?, ?&gt; options)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br><h5> <font color="#902213">7.2  </font> </h5><br>     .          ,      .       . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql.resource.sql.analysis; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EObject; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EStructuralFeature; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlTokenResolveResult; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlTokenResolver; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SqlIDENTIFIERTokenResolver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISqlTokenResolver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deResolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object value, EStructuralFeature feature, EObject container)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Helper.formatIdentifier((String) value); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lexem, EStructuralFeature feature, ISqlTokenResolveResult result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result.setResolvedToken(Helper.parseIdentifier(lexem)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { result.setErrorMessage(e.getMessage()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;?, ?&gt; options)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br>      SQL,        (  ): <br><br><div class="spoiler"> <b class="spoiler_title">public class Helper</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql.resource.sql.analysis; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashSet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Set; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Helper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DOUBLE_QUOTE = <span class="hljs-string"><span class="hljs-string">"\""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DOUBLE_QUOTE_SYMBOL = <span class="hljs-string"><span class="hljs-string">"\"\""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Set&lt;String&gt; RESERVED_WORDS = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;String&gt;(Arrays.asList(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[] { <span class="hljs-string"><span class="hljs-string">"ADD"</span></span>, <span class="hljs-string"><span class="hljs-string">"ALL"</span></span>, <span class="hljs-string"><span class="hljs-string">"ALLOCATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"ALTER"</span></span>, <span class="hljs-string"><span class="hljs-string">"AND"</span></span>, <span class="hljs-string"><span class="hljs-string">"ANY"</span></span>, <span class="hljs-string"><span class="hljs-string">"ARE"</span></span>, <span class="hljs-string"><span class="hljs-string">"ARRAY"</span></span>, <span class="hljs-string"><span class="hljs-string">"AS"</span></span>, <span class="hljs-string"><span class="hljs-string">"ASENSITIVE"</span></span>, <span class="hljs-string"><span class="hljs-string">"ASYMMETRIC"</span></span>, <span class="hljs-string"><span class="hljs-string">"AT"</span></span>, <span class="hljs-string"><span class="hljs-string">"ATOMIC"</span></span>, <span class="hljs-string"><span class="hljs-string">"AUTHORIZATION"</span></span>, <span class="hljs-string"><span class="hljs-string">"BEGIN"</span></span>, <span class="hljs-string"><span class="hljs-string">"BETWEEN"</span></span>, <span class="hljs-string"><span class="hljs-string">"BIGINT"</span></span>, <span class="hljs-string"><span class="hljs-string">"BINARY"</span></span>, <span class="hljs-string"><span class="hljs-string">"BLOB"</span></span>, <span class="hljs-string"><span class="hljs-string">"BOOLEAN"</span></span>, <span class="hljs-string"><span class="hljs-string">"BOTH"</span></span>, <span class="hljs-string"><span class="hljs-string">"BY"</span></span>, <span class="hljs-string"><span class="hljs-string">"CALL"</span></span>, <span class="hljs-string"><span class="hljs-string">"CALLED"</span></span>, <span class="hljs-string"><span class="hljs-string">"CASCADED"</span></span>, <span class="hljs-string"><span class="hljs-string">"CASE"</span></span>, <span class="hljs-string"><span class="hljs-string">"CAST"</span></span>, <span class="hljs-string"><span class="hljs-string">"CHAR"</span></span>, <span class="hljs-string"><span class="hljs-string">"CHARACTER"</span></span>, <span class="hljs-string"><span class="hljs-string">"CHECK"</span></span>, <span class="hljs-string"><span class="hljs-string">"CLOB"</span></span>, <span class="hljs-string"><span class="hljs-string">"CLOSE"</span></span>, <span class="hljs-string"><span class="hljs-string">"COLLATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"COLUMN"</span></span>, <span class="hljs-string"><span class="hljs-string">"COMMIT"</span></span>, <span class="hljs-string"><span class="hljs-string">"CONNECT"</span></span>, <span class="hljs-string"><span class="hljs-string">"CONSTRAINT"</span></span>, <span class="hljs-string"><span class="hljs-string">"CONTINUE"</span></span>, <span class="hljs-string"><span class="hljs-string">"CORRESPONDING"</span></span>, <span class="hljs-string"><span class="hljs-string">"CREATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"CROSS"</span></span>, <span class="hljs-string"><span class="hljs-string">"CUBE"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT_DATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT_DEFAULT_TRANSFORM_GROUP"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT_PATH"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT_ROLE"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT_TIME"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT_TIMESTAMP"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT_TRANSFORM_GROUP_FOR_TYPE"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURRENT_USER"</span></span>, <span class="hljs-string"><span class="hljs-string">"CURSOR"</span></span>, <span class="hljs-string"><span class="hljs-string">"CYCLE"</span></span>, <span class="hljs-string"><span class="hljs-string">"DATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"DAY"</span></span>, <span class="hljs-string"><span class="hljs-string">"DEALLOCATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"DEC"</span></span>, <span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"DECLARE"</span></span>, <span class="hljs-string"><span class="hljs-string">"DEFAULT"</span></span>, <span class="hljs-string"><span class="hljs-string">"DELETE"</span></span>, <span class="hljs-string"><span class="hljs-string">"DEREF"</span></span>, <span class="hljs-string"><span class="hljs-string">"DESCRIBE"</span></span>, <span class="hljs-string"><span class="hljs-string">"DETERMINISTIC"</span></span>, <span class="hljs-string"><span class="hljs-string">"DISCONNECT"</span></span>, <span class="hljs-string"><span class="hljs-string">"DISTINCT"</span></span>, <span class="hljs-string"><span class="hljs-string">"DOUBLE"</span></span>, <span class="hljs-string"><span class="hljs-string">"DROP"</span></span>, <span class="hljs-string"><span class="hljs-string">"DYNAMIC"</span></span>, <span class="hljs-string"><span class="hljs-string">"EACH"</span></span>, <span class="hljs-string"><span class="hljs-string">"ELEMENT"</span></span>, <span class="hljs-string"><span class="hljs-string">"ELSE"</span></span>, <span class="hljs-string"><span class="hljs-string">"END"</span></span>, <span class="hljs-string"><span class="hljs-string">"END-EXEC"</span></span>, <span class="hljs-string"><span class="hljs-string">"ESCAPE"</span></span>, <span class="hljs-string"><span class="hljs-string">"EXCEPT"</span></span>, <span class="hljs-string"><span class="hljs-string">"EXEC"</span></span>, <span class="hljs-string"><span class="hljs-string">"EXECUTE"</span></span>, <span class="hljs-string"><span class="hljs-string">"EXISTS"</span></span>, <span class="hljs-string"><span class="hljs-string">"EXTERNAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"FALSE"</span></span>, <span class="hljs-string"><span class="hljs-string">"FETCH"</span></span>, <span class="hljs-string"><span class="hljs-string">"FILTER"</span></span>, <span class="hljs-string"><span class="hljs-string">"FLOAT"</span></span>, <span class="hljs-string"><span class="hljs-string">"FOR"</span></span>, <span class="hljs-string"><span class="hljs-string">"FOREIGN"</span></span>, <span class="hljs-string"><span class="hljs-string">"FREE"</span></span>, <span class="hljs-string"><span class="hljs-string">"FROM"</span></span>, <span class="hljs-string"><span class="hljs-string">"FULL"</span></span>, <span class="hljs-string"><span class="hljs-string">"FUNCTION"</span></span>, <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"GLOBAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"GRANT"</span></span>, <span class="hljs-string"><span class="hljs-string">"GROUP"</span></span>, <span class="hljs-string"><span class="hljs-string">"GROUPING"</span></span>, <span class="hljs-string"><span class="hljs-string">"HAVING"</span></span>, <span class="hljs-string"><span class="hljs-string">"HOLD"</span></span>, <span class="hljs-string"><span class="hljs-string">"HOUR"</span></span>, <span class="hljs-string"><span class="hljs-string">"IDENTITY"</span></span>, <span class="hljs-string"><span class="hljs-string">"IMMEDIATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"IN"</span></span>, <span class="hljs-string"><span class="hljs-string">"INDICATOR"</span></span>, <span class="hljs-string"><span class="hljs-string">"INNER"</span></span>, <span class="hljs-string"><span class="hljs-string">"INOUT"</span></span>, <span class="hljs-string"><span class="hljs-string">"INPUT"</span></span>, <span class="hljs-string"><span class="hljs-string">"INSENSITIVE"</span></span>, <span class="hljs-string"><span class="hljs-string">"INSERT"</span></span>, <span class="hljs-string"><span class="hljs-string">"INT"</span></span>, <span class="hljs-string"><span class="hljs-string">"INTEGER"</span></span>, <span class="hljs-string"><span class="hljs-string">"INTERSECT"</span></span>, <span class="hljs-string"><span class="hljs-string">"INTERVAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"INTO"</span></span>, <span class="hljs-string"><span class="hljs-string">"IS"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISOLATION"</span></span>, <span class="hljs-string"><span class="hljs-string">"JOIN"</span></span>, <span class="hljs-string"><span class="hljs-string">"LANGUAGE"</span></span>, <span class="hljs-string"><span class="hljs-string">"LARGE"</span></span>, <span class="hljs-string"><span class="hljs-string">"LATERAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"LEADING"</span></span>, <span class="hljs-string"><span class="hljs-string">"LEFT"</span></span>, <span class="hljs-string"><span class="hljs-string">"LIKE"</span></span>, <span class="hljs-string"><span class="hljs-string">"LOCAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"LOCALTIME"</span></span>, <span class="hljs-string"><span class="hljs-string">"LOCALTIMESTAMP"</span></span>, <span class="hljs-string"><span class="hljs-string">"MATCH"</span></span>, <span class="hljs-string"><span class="hljs-string">"MEMBER"</span></span>, <span class="hljs-string"><span class="hljs-string">"MERGE"</span></span>, <span class="hljs-string"><span class="hljs-string">"METHOD"</span></span>, <span class="hljs-string"><span class="hljs-string">"MINUTE"</span></span>, <span class="hljs-string"><span class="hljs-string">"MODIFIES"</span></span>, <span class="hljs-string"><span class="hljs-string">"MODULE"</span></span>, <span class="hljs-string"><span class="hljs-string">"MONTH"</span></span>, <span class="hljs-string"><span class="hljs-string">"MULTISET"</span></span>, <span class="hljs-string"><span class="hljs-string">"NATIONAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"NATURAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"NCHAR"</span></span>, <span class="hljs-string"><span class="hljs-string">"NCLOB"</span></span>, <span class="hljs-string"><span class="hljs-string">"NEW"</span></span>, <span class="hljs-string"><span class="hljs-string">"NO"</span></span>, <span class="hljs-string"><span class="hljs-string">"NONE"</span></span>, <span class="hljs-string"><span class="hljs-string">"NOT"</span></span>, <span class="hljs-string"><span class="hljs-string">"NULL"</span></span>, <span class="hljs-string"><span class="hljs-string">"NUMERIC"</span></span>, <span class="hljs-string"><span class="hljs-string">"OF"</span></span>, <span class="hljs-string"><span class="hljs-string">"OLD"</span></span>, <span class="hljs-string"><span class="hljs-string">"ON"</span></span>, <span class="hljs-string"><span class="hljs-string">"ONLY"</span></span>, <span class="hljs-string"><span class="hljs-string">"OPEN"</span></span>, <span class="hljs-string"><span class="hljs-string">"OR"</span></span>, <span class="hljs-string"><span class="hljs-string">"ORDER"</span></span>, <span class="hljs-string"><span class="hljs-string">"OUT"</span></span>, <span class="hljs-string"><span class="hljs-string">"OUTER"</span></span>, <span class="hljs-string"><span class="hljs-string">"OUTPUT"</span></span>, <span class="hljs-string"><span class="hljs-string">"OVER"</span></span>, <span class="hljs-string"><span class="hljs-string">"OVERLAPS"</span></span>, <span class="hljs-string"><span class="hljs-string">"PARAMETER"</span></span>, <span class="hljs-string"><span class="hljs-string">"PARTITION"</span></span>, <span class="hljs-string"><span class="hljs-string">"PRECISION"</span></span>, <span class="hljs-string"><span class="hljs-string">"PREPARE"</span></span>, <span class="hljs-string"><span class="hljs-string">"PRIMARY"</span></span>, <span class="hljs-string"><span class="hljs-string">"PROCEDURE"</span></span>, <span class="hljs-string"><span class="hljs-string">"RANGE"</span></span>, <span class="hljs-string"><span class="hljs-string">"READS"</span></span>, <span class="hljs-string"><span class="hljs-string">"REAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"RECURSIVE"</span></span>, <span class="hljs-string"><span class="hljs-string">"REF"</span></span>, <span class="hljs-string"><span class="hljs-string">"REFERENCES"</span></span>, <span class="hljs-string"><span class="hljs-string">"REFERENCING"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_AVGX"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_AVGY"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_COUNT"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_INTERCEPT"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_R2"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_SLOPE"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_SXX"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_SXY"</span></span>, <span class="hljs-string"><span class="hljs-string">"REGR_SYY"</span></span>, <span class="hljs-string"><span class="hljs-string">"RELEASE"</span></span>, <span class="hljs-string"><span class="hljs-string">"RESULT"</span></span>, <span class="hljs-string"><span class="hljs-string">"RETURN"</span></span>, <span class="hljs-string"><span class="hljs-string">"RETURNS"</span></span>, <span class="hljs-string"><span class="hljs-string">"REVOKE"</span></span>, <span class="hljs-string"><span class="hljs-string">"RIGHT"</span></span>, <span class="hljs-string"><span class="hljs-string">"ROLLBACK"</span></span>, <span class="hljs-string"><span class="hljs-string">"ROLLUP"</span></span>, <span class="hljs-string"><span class="hljs-string">"ROW"</span></span>, <span class="hljs-string"><span class="hljs-string">"ROWS"</span></span>, <span class="hljs-string"><span class="hljs-string">"SAVEPOINT"</span></span>, <span class="hljs-string"><span class="hljs-string">"SCROLL"</span></span>, <span class="hljs-string"><span class="hljs-string">"SEARCH"</span></span>, <span class="hljs-string"><span class="hljs-string">"SECOND"</span></span>, <span class="hljs-string"><span class="hljs-string">"SELECT"</span></span>, <span class="hljs-string"><span class="hljs-string">"SENSITIVE"</span></span>, <span class="hljs-string"><span class="hljs-string">"SESSION_USER"</span></span>, <span class="hljs-string"><span class="hljs-string">"SET"</span></span>, <span class="hljs-string"><span class="hljs-string">"SIMILAR"</span></span>, <span class="hljs-string"><span class="hljs-string">"SMALLINT"</span></span>, <span class="hljs-string"><span class="hljs-string">"SOME"</span></span>, <span class="hljs-string"><span class="hljs-string">"SPECIFIC"</span></span>, <span class="hljs-string"><span class="hljs-string">"SPECIFICTYPE"</span></span>, <span class="hljs-string"><span class="hljs-string">"SQL"</span></span>, <span class="hljs-string"><span class="hljs-string">"SQLEXCEPTION"</span></span>, <span class="hljs-string"><span class="hljs-string">"SQLSTATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"SQLWARNING"</span></span>, <span class="hljs-string"><span class="hljs-string">"START"</span></span>, <span class="hljs-string"><span class="hljs-string">"STATIC"</span></span>, <span class="hljs-string"><span class="hljs-string">"SUBMULTISET"</span></span>, <span class="hljs-string"><span class="hljs-string">"SYMMETRIC"</span></span>, <span class="hljs-string"><span class="hljs-string">"SYSTEM"</span></span>, <span class="hljs-string"><span class="hljs-string">"SYSTEM_USER"</span></span>, <span class="hljs-string"><span class="hljs-string">"TABLE"</span></span>, <span class="hljs-string"><span class="hljs-string">"THEN"</span></span>, <span class="hljs-string"><span class="hljs-string">"TIME"</span></span>, <span class="hljs-string"><span class="hljs-string">"TIMESTAMP"</span></span>, <span class="hljs-string"><span class="hljs-string">"TIMEZONE_HOUR"</span></span>, <span class="hljs-string"><span class="hljs-string">"TIMEZONE_MINUTE"</span></span>, <span class="hljs-string"><span class="hljs-string">"TO"</span></span>, <span class="hljs-string"><span class="hljs-string">"TRAILING"</span></span>, <span class="hljs-string"><span class="hljs-string">"TRANSLATION"</span></span>, <span class="hljs-string"><span class="hljs-string">"TREAT"</span></span>, <span class="hljs-string"><span class="hljs-string">"TRIGGER"</span></span>, <span class="hljs-string"><span class="hljs-string">"TRUE"</span></span>, <span class="hljs-string"><span class="hljs-string">"UESCAPE"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNION"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNIQUE"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNKNOWN"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNNEST"</span></span>, <span class="hljs-string"><span class="hljs-string">"UPDATE"</span></span>, <span class="hljs-string"><span class="hljs-string">"UPPER"</span></span>, <span class="hljs-string"><span class="hljs-string">"USER"</span></span>, <span class="hljs-string"><span class="hljs-string">"USING"</span></span>, <span class="hljs-string"><span class="hljs-string">"VALUE"</span></span>, <span class="hljs-string"><span class="hljs-string">"VALUES"</span></span>, <span class="hljs-string"><span class="hljs-string">"VAR_POP"</span></span>, <span class="hljs-string"><span class="hljs-string">"VAR_SAMP"</span></span>, <span class="hljs-string"><span class="hljs-string">"VARCHAR"</span></span>, <span class="hljs-string"><span class="hljs-string">"VARYING"</span></span>, <span class="hljs-string"><span class="hljs-string">"WHEN"</span></span>, <span class="hljs-string"><span class="hljs-string">"WHENEVER"</span></span>, <span class="hljs-string"><span class="hljs-string">"WHERE"</span></span>, <span class="hljs-string"><span class="hljs-string">"WIDTH_BUCKET"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOW"</span></span>, <span class="hljs-string"><span class="hljs-string">"WITH"</span></span>, <span class="hljs-string"><span class="hljs-string">"WITHIN"</span></span>, <span class="hljs-string"><span class="hljs-string">"WITHOUT"</span></span>, <span class="hljs-string"><span class="hljs-string">"YEAR"</span></span> })); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isReservedWord</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RESERVED_WORDS.contains(str.toUpperCase()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isEmpty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || str.length() == <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatIdentifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!str.matches(<span class="hljs-string"><span class="hljs-string">"[AZ][A-Z0-9_]*"</span></span>) || isReservedWord(str)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DOUBLE_QUOTE + str.replace(DOUBLE_QUOTE, DOUBLE_QUOTE_SYMBOL) + DOUBLE_QUOTE; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseIdentifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.startsWith(DOUBLE_QUOTE) &amp;&amp; str.endsWith(DOUBLE_QUOTE) &amp;&amp; str.length() &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>, str.length() - <span class="hljs-number"><span class="hljs-number">1</span></span>) .replace(DOUBLE_QUOTE_SYMBOL, DOUBLE_QUOTE); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isReservedWord(str)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException( String.format(<span class="hljs-string"><span class="hljs-string">"Reserved word %s must be quoted when used as identifier"</span></span>, str.toUpperCase())); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str.toUpperCase(); } } }</code> </pre><br></div></div><br><h5> <font color="#902213">7.3   </font> </h5><br>    (UNSIGNED_INTEGER)         EInt,     Java-  int.      ,    : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnsignedInteger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnsignedInteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> UnsignedInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">valueOf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnsignedInteger(Integer.parseUnsignedInt(str)); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.format(<span class="hljs-string"><span class="hljs-string">"%d"</span></span>, value); } }</code> </pre><br>     ,   ,     valueOf  toString. ,     EMFText,  EMF . ,  ()  XMI-      SQL-      . <br><br> ,    .        ,        ?     ,        ()     ,  , ,  XMI. <br><br>    .   ()  -        ,      .     / SQL-    . <br><br><h5> <font color="#902213">7.4    </font> </h5><br> ,      ‚Äì     .    ,   Ecore          ‚Äì EDate,    java.util.Date.   SQL    ,     .   SQL      ,   EDate    . <br><br>  Java     : java.time.LocalDate, java.time.LocalTime  java.time.ZonedDateTime. 2-,  ,   ,    . <br><br>   ,      valueOf,  toString      .          ,            ()  XMI-  .       EMF ‚Äì   (conversion delegates). <br><br>     plugin.xml    ¬´¬ª (Extensions)   org.eclipse.emf.ecore.conversion_delegate.       : <br><br><ul><li> URI ‚Äì org.emftext.language.sql.conversionDelegateFactory </li><li> Class ‚Äì org.emftext.language.sql.ConversionDelegateFactory </li></ul><br><img src="https://habrastorage.org/files/f89/5ae/87d/f895ae87da854550a90011c4daafd3dc.png"><br><br><blockquote>  <b>Note</b> <br><br>           Eclipse,       .     plugin.xml  ,     : <br><pre> <code class="java hljs">EDataType.Internal.ConversionDelegate.Factory.Registry.INSTANCE.put( <span class="hljs-string"><span class="hljs-string">"org.emftext.language.sql.conversionDelegateFactory"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConversionDelegateFactory());</code> </pre></blockquote><br>       (   common)   (EAnnotation)   (Source) <a href="http://www.eclipse.org/emf/2002/Ecore">http://www.eclipse.org/emf/2002/Ecore</a> .       conversionDelegates   org.emftext.language.sql.conversionDelegateFactory. <br><br><blockquote>  <b>Note</b> <br><br>       OCLinEcore  <a href="https://bugs.eclipse.org/bugs/show_bug.cgi%3Fid%3D482890"></a> , -    .        .       ,   . </blockquote><br>    ,      (),   (EAnnotation)   (Source) org.emftext.language.sql.conversionDelegateFactory: <br><br><img src="https://habrastorage.org/files/ed4/ff7/ad0/ed4ff7ad054e4a2aa3cd1b9a9a3d7356.png"><br><br>    : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EDataType; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EDataType.Internal.ConversionDelegate; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EDataType.Internal.ConversionDelegate.Factory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.common.CommonPackage; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConversionDelegateFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConversionDelegateFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ConversionDelegate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConversionDelegate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EDataType eDataType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eDataType.equals(CommonPackage.eINSTANCE.getDateType())) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateConversionDelegate(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eDataType.equals(CommonPackage.eINSTANCE.getTimeType())) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeConversionDelegate(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eDataType.equals(CommonPackage.eINSTANCE.getTimestampType())) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimestampConversionDelegate(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br>      : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.time.ZonedDateTime; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.time.format.DateTimeFormatter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.time.format.DateTimeFormatterBuilder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EDataType.Internal.ConversionDelegate; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimestampConversionDelegate</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConversionDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DateTimeFormatter FORMATTER = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTimeFormatterBuilder() .append(DateTimeFormatter.ISO_LOCAL_DATE) .appendLiteral(<span class="hljs-string"><span class="hljs-string">" "</span></span>) .append(DateTimeFormatter.ISO_TIME) .toFormatter(); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object value)</span></span></span><span class="hljs-function"> </span></span>{ ZonedDateTime timestamp = (ZonedDateTime) value; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> timestamp.format(FORMATTER); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFromString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String literal)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ZonedDateTime.parse(literal, FORMATTER); } }</code> </pre><br> ,   : <br><br><ol><li>      TimestampType </li><li> ,   Java      java.time.ZonedDateTime </li><li>    ()      </li><li>        </li></ol><br><blockquote>  <b>Note</b> <br><br>  EMF     : invocationDelegates, settingDelegates, validationDelegates. </blockquote><br>      QUOTED_STRING,        ,   : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql.resource.sql.analysis; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EDataType; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EObject; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EStructuralFeature; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.util.EcoreUtil; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlTokenResolveResult; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlTokenResolver; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SqlQUOTED_STRINGTokenResolver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISqlTokenResolver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String QUOTE = <span class="hljs-string"><span class="hljs-string">"'"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String QUOTE_SYMBOL = <span class="hljs-string"><span class="hljs-string">"''"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deResolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object value, EStructuralFeature feature, EObject container)</span></span></span><span class="hljs-function"> </span></span>{ String result = EcoreUtil.convertToString((EDataType) feature.getEType(), value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QUOTE + result.replace(QUOTE, QUOTE_SYMBOL) + QUOTE; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lexem, EStructuralFeature feature, ISqlTokenResolveResult result)</span></span></span><span class="hljs-function"> </span></span>{ lexem = lexem.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>, lexem.length() - <span class="hljs-number"><span class="hljs-number">1</span></span>); lexem = lexem.replace(QUOTE_SYMBOL, QUOTE); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result.setResolvedToken(EcoreUtil.createFromString((EDataType) feature.getEType(), lexem)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { result.setErrorMessage(e.getMessage()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;?, ?&gt; options)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br><h4> <font color="#902213"><b>8  </b></font> </h4><br>    SQL        .              ,        .            ,    non-containment  (columns, referencedColumns, referencedTable). <br><br> EMFText      ,        ,  . <br><br><h5> <font color="#902213">8.1       </font> </h5><br>   <a href="http://habrahabr.ru/company/cit/blog/270483/"></a>         EMFText. <br><br>   resolve      resolveFuzzy (,       ),       ,      ,    ,     . <br><br>   resolve      resolveFuzzy,           . <br><br><div class="spoiler"> <b class="spoiler_title">public class TableColumnsConstraintColumnsReferenceResolver</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql.resource.sql.analysis; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Consumer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EReference; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlReferenceResolveResult; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlReferenceResolver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.Column; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.TableColumnsConstraint; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableColumnsConstraintColumnsReferenceResolver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISqlReferenceResolver</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableColumnsConstraint</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Column</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String identifier, TableColumnsConstraint container, EReference reference, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resolveFuzzy, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ISqlReferenceResolveResult&lt;Column&gt; result)</span></span></span><span class="hljs-function"> </span></span>{ Stream&lt;Column&gt; columns = container.getOwner().getElements().stream() .filter(element -&gt; element <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Column) .map(col -&gt; (Column) col); Consumer&lt;Column&gt; addMapping = col -&gt; result.addMapping(col.getName(), col); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resolveFuzzy) { columns .filter(col -&gt; !container.getColumns().contains(col)) .filter(col -&gt; col.getName().startsWith(identifier)) .forEach(addMapping); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { columns .filter(col -&gt; col.getName().equals(identifier)) .findFirst() .ifPresent(addMapping); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deResolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Column element, TableColumnsConstraint container, EReference reference)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> element.getName(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;?, ?&gt; options)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br></div></div><br><h5> <font color="#902213">8.2     </font> </h5><br>   ,   ( )    SQL-.    ,   ,         . <br><br><div class="spoiler"> <b class="spoiler_title">public class TableReferenceTargetReferenceResolver</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql.resource.sql.analysis; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Consumer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Predicate; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EReference; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.util.EcoreUtil; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.common.SQLScript; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlReferenceResolveResult; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlReferenceResolver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.TableDefinition; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.TableReference; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableReferenceTargetReferenceResolver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISqlReferenceResolver</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableReference</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableDefinition</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String identifier, TableReference container, EReference reference, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resolveFuzzy, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ISqlReferenceResolveResult&lt;TableDefinition&gt; result)</span></span></span><span class="hljs-function"> </span></span>{ SQLScript sqlScript = (SQLScript) EcoreUtil.getRootContainer(container); String catalogName = container.getCatalogName(); Predicate&lt;TableDefinition&gt; filter = !Helper.isEmpty(catalogName) ? table -&gt; catalogName.equals(table.getSchemaQualifiedName().getCatalogName()) : table -&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; String schemaName = container.getSchemaName(); Predicate&lt;TableDefinition&gt; filter2 = !Helper.isEmpty(schemaName) ? table -&gt; schemaName.equals(table.getSchemaQualifiedName().getSchemaName()) : table -&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; Stream&lt;TableDefinition&gt; tables = sqlScript.getStatements().stream() .filter(stmt -&gt; stmt <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> TableDefinition) .map(table -&gt; (TableDefinition) table) .filter(filter.and(filter2)); Consumer&lt;TableDefinition&gt; addMapping = table -&gt; result.addMapping(table.getSchemaQualifiedName().getName(), table); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resolveFuzzy) { tables.filter(table -&gt; table.getSchemaQualifiedName() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; table.getSchemaQualifiedName().getName() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; table.getSchemaQualifiedName().getName().toUpperCase().startsWith(identifier.toUpperCase())) .forEach(addMapping); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { tables.filter(table -&gt; table.getSchemaQualifiedName() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; table.getSchemaQualifiedName().getName() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; table.getSchemaQualifiedName().getName().equals(identifier)) .findFirst() .ifPresent(addMapping); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deResolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TableDefinition element, TableReference container, EReference reference)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> element.getSchemaQualifiedName().getName(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;?, ?&gt; options)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br></div></div><br><h5> <font color="#902213">8.3       </font> </h5><br>   , ,    .                . <br><br><div class="spoiler"> <b class="spoiler_title">public class ReferentialConstraintReferencedColumnsReferenceResolver</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql.resource.sql.analysis; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Consumer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EReference; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlReferenceResolveResult; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.ISqlReferenceResolver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.Column; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.ReferentialConstraint; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.TableElementList; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReferentialConstraintReferencedColumnsReferenceResolver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISqlReferenceResolver</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReferentialConstraint</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Column</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String identifier, ReferentialConstraint container, EReference reference, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resolveFuzzy, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ISqlReferenceResolveResult&lt;Column&gt; result)</span></span></span><span class="hljs-function"> </span></span>{ Stream&lt;Column&gt; columns = Stream.of(container.getReferencedTable().getTarget()) .filter(table -&gt; table != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) .map(table -&gt; table.getContentsSource()) .filter(src -&gt; src <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> TableElementList) .flatMap(list -&gt; ((TableElementList) list).getElements().stream()) .filter(element -&gt; element <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Column) .map(col -&gt; (Column) col); Consumer&lt;Column&gt; addMapping = col -&gt; result.addMapping(col.getName(), col); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resolveFuzzy) { columns .filter(col -&gt; !container.getReferencedColumns().contains(col)) .filter(col -&gt; col.getName().startsWith(identifier)) .forEach(addMapping); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { columns .filter(col -&gt; col.getName().equals(identifier)) .findFirst() .ifPresent(addMapping); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deResolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Column element, ReferentialConstraint container, EReference reference)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> element.getName(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;?, ?&gt; options)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br></div></div><br><h4> <font color="#902213"><b>9    </b></font> </h4><br>    ,         ,     . ,       ,     .  EMFText    ,       .    ,       SQL-    : <br><br><div class="spoiler"> <b class="spoiler_title">public class SqlProposalPostProcessor</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.emftext.language.sql.resource.sql.ui; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Function; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.emf.ecore.EAttribute; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.common.SQLScript; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.resource.sql.analysis.Helper; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.SchemaPackage; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.emftext.language.sql.schema.TableDefinition; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SqlProposalPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;SqlCompletionProposal&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;SqlCompletionProposal&gt; proposals)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;SqlCompletionProposal&gt; newProposals = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;SqlCompletionProposal&gt;(); EAttribute catalogNameFeature = SchemaPackage.eINSTANCE.getTableReference_CatalogName(); EAttribute schemaNameFeature = SchemaPackage.eINSTANCE.getTableReference_SchemaName(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (SqlCompletionProposal proposal : proposals) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (catalogNameFeature.equals(proposal.getStructuralFeature())) { addTableReferenceProposal(newProposals, proposal, table -&gt; table.getSchemaQualifiedName().getCatalogName()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (schemaNameFeature.equals(proposal.getStructuralFeature())) { addTableReferenceProposal(newProposals, proposal, table -&gt; table.getSchemaQualifiedName().getSchemaName()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newProposals.add(proposal); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newProposals; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTableReferenceProposal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;SqlCompletionProposal&gt; proposals, SqlCompletionProposal oldProposal, Function&lt;TableDefinition, String&gt; nameGetter)</span></span></span><span class="hljs-function"> </span></span>{ SQLScript sqlScript = (SQLScript) oldProposal.getRoot(); String prefix = oldProposal.getPrefix().toUpperCase(); sqlScript.getStatements().stream() .filter(stmt -&gt; stmt <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> TableDefinition) .map(table -&gt; (TableDefinition) table) .map(nameGetter) .filter(name -&gt; name != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; name.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .filter(name -&gt; name.toUpperCase().startsWith(prefix)) .forEach(name -&gt; proposals.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlCompletionProposal( oldProposal.getExpectedTerminal(), Helper.formatIdentifier(name), oldProposal.getPrefix(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, oldProposal.getStructuralFeature(), oldProposal.getContainer()))); } }</code> </pre><br></div></div><br> , ,   ,     .   catalogName  schemaName     (TableReference) ,  EMFText   ,      ,     . <br><br>   EMFText   overrideCompletionProposal, ,   ,     ,    ,      . <br><br><h4> <font color="#902213"><b>10     SQL</b></font> </h4><br>   ,    Eclipse    SQL-. <br><br>  ,   :     ,    . <br><br><img src="https://habrastorage.org/files/88e/44b/662/88e44b662d1e4f28b3c692ed1b7c1433.png"><br><br>   ,   ,     : <br><br><img src="https://habrastorage.org/files/e2b/1dd/4e7/e2b1dd4e734f4010bc95782f13269eda.png"><br><br><h4> <font color="#902213"><b>11   SQL</b></font> </h4><br>  SQL-  XMI-.      ,   : <br><br><img src="https://habrastorage.org/files/c88/a90/d36/c88a90d3634b45fa83270094435dba79.png"><br><br>    ¬´user¬ª  ¬´person¬ª   ¬´NAME¬ª  ¬´FullName¬ª. <br><br>      SQL-  ,   : <br><br><img src="https://habrastorage.org/files/b35/556/f95/b35556f9583045a39805bf8e97e4aa91.png"><br><br> -  , -  .      , , ,      ,       . <br><br><h4>  <font color="#902213"><b>Conclusion</b></font> </h4><br>        ,        EMFText. <br><br>  ,    SQL   Eclipse,           Eclipse.    Eclipse   IDE,    EMFText,  ,      Eclipse.    . <br><br>  , ,   , <a href="https://github.com/AresEkb/sql">  GitHub</a> . <br><br>          :) </div><p>Source: <a href="https://habr.com/ru/post/271945/">https://habr.com/ru/post/271945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271935/index.html">What is under the hood of travel startups or why does a programmer need to go to Hack`n`Roll</a></li>
<li><a href="../271937/index.html">5 major risks in custom software development</a></li>
<li><a href="../271939/index.html">Asterisk + LUA: quick start</a></li>
<li><a href="../271941/index.html">Getting Started with Java 9 and the Jigsaw Project - Part One</a></li>
<li><a href="../271943/index.html">Change desktop background and lock screen from CW / XAML UWP application</a></li>
<li><a href="../271947/index.html">Opera Link closes in December</a></li>
<li><a href="../271951/index.html">Application implementation - device owner for Android</a></li>
<li><a href="../271953/index.html">Dispelling myths about secure passwords</a></li>
<li><a href="../271955/index.html">We invite you to the December meetings of the IT community in Samara, Novosibirsk and Krasnoyarsk</a></li>
<li><a href="../271957/index.html">Systemd and Containers: Introduction to systemd-nspawn</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>