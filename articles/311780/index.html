<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RDP Disable system, function keys. Windows 2008R2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What was required 
 One fine evening, there was an urgent need for additional protection from "curves" or "intentional hands." Since the basis of our ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RDP Disable system, function keys. Windows 2008R2</h1><div class="post__text post__text-html js-mediator-article"><h3>  What was required </h3><br>  One fine evening, there was an urgent need for additional protection from "curves" or "intentional hands."  Since the basis of our database is MS ACCESS, there are several unpleasant moments in it, such as the use of hot keys (delete, print, etc.) and our developer did not bother to turn them off.  Actually, there was no time to deal with Access macros and the rights of users to use them, and the very idea of ‚Äã‚Äãdisabling all the function keys on the keyboard also solved the associated tasks of the built-in ‚ÄúWeb Browser‚Äù control ‚Äî prohibiting deletion of files created by the user, prohibition of calling help and hotkeys in image viewer and PDF.  <b><i>Hole had to be patched quickly</i></b> and wait for our developer from the holidays. <br><a name="habracut"></a><br><h3>  Preliminary analysis and action plan </h3><br>  The solution that immediately came to mind is to create a parameter in the Scancode Map registry under the address HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Keyboard Layout and register in it all the necessary key remapping, but rather quickly it became clear that this does not work via RDP, and yes the same was applied fully to the system, affecting privileged users who are allowed to use hotkeys. <br><br>  Then I remembered the Microsoft Keyboard Layout Creator, which I once used to edit the keyboard layout of my home computer, but alas, they didn‚Äôt add work with system keys to the new version. <br><br>  Having studied the Internet, no viable solution was found.  There was only one thing left - creating your own layout and adding it to the system.  For a start, the files KBDRU.dll and KBDUS.dll were studied, after which it became clear that it would be extremely difficult to figure it out on my own over the evening.  An overview of the programs that can solve this problem did not take much time and everyone had their flaws, the most important of which was installing them on the server, which is a very undesirable measure.  Worthy of the programs judging by the reviews were: KbdEdit and Keyboard Layout Manager 2000. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And then there was a hint that you can create a layout on a virtual machine using the above programs, and use the Microsoft Keyboard Layout Creator as a compiler for the installation files for the new layout on the server. <br><br><h3>  Do </h3><br>  But not everything was so simple.  Having studied KbdEdit, it became immediately suspicious that the dll layout file created by it weighs more than 50KB and the original 7KB, as well as that the layout will not work in the absence of this program.  The files created by the Keyboard Layout Manager weighed 9KB, which was perfectly acceptable. <br><br>  Go to the KLM2000 setup, nothing complicated, create a new layout based on the existing one and choose to edit, disable all unnecessary system and function keys (in my case, everything that is highlighted in red).  The only thing with which I had to tinker with NUMPAD was that the data (highlighted in blue) did not carry the system functions. Some reassignments need to be done: ‚Äú0‚Äù do not touch, select ‚ÄúVirtual Key‚Äù - ‚ÄúVK_OEM_PERIOD‚Äù, ‚Äú1‚Äù - unassigned 0x89, ‚Äú2‚Äù - 0x8A, ‚Äú3‚Äù - 0x8B, ‚Äú4‚Äù - 0x8C, ‚Äú5‚Äù - 0x8D, ‚Äú6‚Äù - 0x8E, ‚Äú7‚Äù - 0x8F, ‚Äú8‚Äù - 0x92, ‚Äú9‚Äù - 0x93. <br>  Save the Export, and use it in the OK system. <br><br><img src="https://habrastorage.org/files/0e8/095/9ec/0e80959ece604ae88f8143db877565a4.png" alt="image"><br><br><img src="https://habrastorage.org/files/75b/2e9/bf6/75b2e9bf6ced44c28020bf4d12c02766.png" alt="image"><br><br>  Next, open the Microsoft Keyboard Layout Creator, select this layout, try to save and see the error.  Unfortunately, MKLC does not miss the layout with disabled system keys.  Then we copy from the Windows \ System32 and Windows \ SysWOW64 dll folders created by KLM2000, and on another machine using MKLC we create installation files based on the standard layout, and in the properties we specify the layout name, which we specified when we created the layout using KLM2000. <br><br>  Next, on the server, install the keyboard layout created with the MKLC, and copy the dll files created by the KLM2000 to the corresponding Windows \ System32 and Windows \ SysWOW64 folders on the server. <br><br><h3>  Important </h3><br>  To work correctly, and this is mandatory, there should be only one keyboard layout for one language.  Do not forget about the parameter in the registry IgnoreRemoteKeyboardLayout, so as not to cling to the layout of the client.  Reboot. <br><br><h3>  Addition </h3><br>  If you add to this all the following changes for a specific user in the registry: <br><br><ul><li>  disable ‚ÄúDrag and Drop‚Äù (‚ÄúDragHeight‚Äù and ‚ÄúDragWidth‚Äù) </li><li>  disable context menu in explorer (‚ÄúNoViewContextMenu‚Äù and ‚ÄúNoTrayContextMenu‚Äù) </li><li>  set the opening of files on one click </li></ul><br>  - then we get that the user from under the Inline control of the type ‚ÄúWeb browser‚Äù in MS Access cannot rename, copy, delete, or move files even those created by MS ACCESS from under his account.  (creates ACCESS files according to the following procedure; first, a temporary file is created in the destination folder, and then it is renamed to the final one; therefore, the prohibition on changing in group policies is not appropriate here). <br><br><h3>  Conclusion </h3><br>  I had to experiment a bit and spend the whole evening on it, I hope this article will be useful to someone from the point of view of saving time, because every extra hour is invaluable for us. <br><br>  In general, the problem of a very fast patch was solved, without installing any third-party programs on the server, which is good. </div><p>Source: <a href="https://habr.com/ru/post/311780/">https://habr.com/ru/post/311780/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311768/index.html">A selection of useful materials on the development of Xamarin</a></li>
<li><a href="../311770/index.html">JSOC availability: metrics and measurement</a></li>
<li><a href="../311772/index.html">Patent hysteria: how to stop being afraid of journalistic prejudices</a></li>
<li><a href="../311774/index.html">Unofficial supplement to the article about MegaFon's bank card</a></li>
<li><a href="../311778/index.html">The best vacancies on My Circle for the week, September 19-25</a></li>
<li><a href="../311782/index.html">Numbers grow: attack at 620 Gbps registered</a></li>
<li><a href="../311784/index.html">Understanding Veeam SureBackup</a></li>
<li><a href="../311788/index.html">Convert Method Reference to Method in Java</a></li>
<li><a href="../311790/index.html">Speech analytics as a tool for managing KPI contact center. Case "Rostelecom"</a></li>
<li><a href="../311792/index.html">JUG.ru Group's internal kitchen: how is the conference for 1000 programmers done</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>