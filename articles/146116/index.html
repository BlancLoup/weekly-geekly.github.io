<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Firewall for Linux with a simple interface</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A firewall is a bash script that integrates the following functions using the appropriate packages: 


1. Firewall external and internal ( iptables pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Firewall for Linux with a simple interface</h1><div class="post__text post__text-html js-mediator-article">  A firewall is a bash script that integrates the following functions using the appropriate packages: <br><ol><li>  Firewall external and internal ( <b>iptables</b> package). </li><li>  Accounting for external and internal traffic ( <b>iptables</b> package). </li><li>  Proxy server for local networks ( <b>Squid</b> package). </li><li>  Content filter for local networks ( <b>DansGuardian</b> package). </li><li>  DNS server for local area networks ( <b>BIND</b> package). </li></ol><br><a name="habracut"></a><br>  The script is the result of many years of work and claims to be universal - it allows you to use a Linux machine as an Internet gateway for both a small office and a large enterprise (currently it is used in five enterprises and in one remote office - <b>CentOS</b> stands everywhere) . <br>  The script requires for its work the presence of at least two network interfaces - one of which is <i>external</i> , and the others are considered <i>internal</i> .  The external interface is set to the <b>EXTIF</b> variable and is determined automatically if this variable is not set. <br>  Another requirement is that all interfaces must have static addresses, i.e.  interfaces can receive them dynamically, but the addresses must always be the same.  This requirement arises from the fact that the <b>iptables</b> rules use the IP addresses of the interfaces.  Rules are generated and applied on the basis of the <b>fwtraf.conf</b> configuration <b>file</b> with the command " <b>fwtraf fwnormal</b> " and saved with the command " <b>fwtraf fwsave</b> ".  Those.  if the IP addresses of the interfaces have changed, you will need to apply the rules again (and save them if you want them to act after the reboot). <br><br>  The source NAT and web proxy modes of operation can be combined: <br><ul><li>  source NAT: off  (SNAT = "") <br></li><li>  source NAT: on  (SNAT = "YES"). </li></ul><br><ul><li>  web proxy: off  (WEBPROXY = "") <br></li><li>  Web proxy: Squid (WEBPROXY = "SQUID"). </li><li>  web proxy: DansGuardian-&gt; Squid (WEBPROXY = "DGSQUID"). </li></ul><br>  The script supports several <i>local networks</i> ( <b>LANS</b> variable) - they are <b>separated by</b> a space: <br>  LANS = "192.168.0.0/24 10.0.0.0/8" <br>  It also supports <i>remote local networks</i> - for example, local area networks of offices connected via <b>VPN</b> technologies (variable <b>REMOTE_LANS</b> ): <br>  REMOTE_LANS = "192.168.1.0/24 192.168.3.0/24 192.168.5.0/24" <br><br>  The script has a simple configuration file: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href=""><img height="400" src="https://sites.google.com/site/smkuzmin/home/fwtraf/fwtraf_conf.png?height=400&amp;amp;width=358" width="358"></a> <br><br><br><br>  <font>It lists</font> <font>static IP addresses and</font> <font>computer</font> <font>names of</font> <font>users who:</font> <font><br></font> <br><ul><li>  allowed (command <b>a</b> - short for " <b>a</b> llow") </li><li>  prohibited (command <b>d</b> - short for " <b>d</b> eny") </li></ul><br>  Ports ( <b>PORTS</b> column): <br><ul><li>  one or more TCP ports separated by commas: <b>web, ftp</b> . <br></li><li>  all TCP ports except, for example, smtp <b>:! smtp</b> . </li><li>  all TCP and UDP ports: <b>all</b> . </li></ul><br>  <font>If</font> <font>a content filter is used (WEBPROXY = "DGSQUID")</font> and the <font>user is allowed web ports</font> <font>, then the web access group is applied to it (the <b>WA</b> column is short for " <b>W</b> eb <b>A</b> ccess").</font> <font><br><br></font>  So-called forwarding of external interface ports to internal IP addresses of local networks (destination NAT) is very simple.  This is convenient when the SNAT mode is enabled on the gateway and local networks from the Internet are not available.  For example, let's allow the administrator to access the Internet from the computer (web and ftp traffic) and still allow it to connect from the Internet via RDP to the external IP address of the gateway, and the gateway will redirect the rdp traffic to his computer: <br>  a 192.168.1.240 pc30 0 web, ftp, rdp-rdp # Admin <br>  <font>I also note that the forwarded ports do not have to match - for example, you can listen to port 2525 on an external IP, and forward it to the</font> <font>25th port of the</font> <font>mail server located inside the local network:</font> <font><br></font>  a 192.168.1.2 mail 0 2525-25 # Mail Server <br>  <font>The script also creates daily html traffic reports and</font> <font>updates them hourly</font> <font><font>:</font></font> <font><br><br> <a href=""><img height="310" src="https://sites.google.com/site/smkuzmin/home/fwtraf/fwtraf_month_stat.jpg?height=310&amp;amp;width=400" width="400"></a> <br><br><br></font>  <font><font>And another small bonus - after installing the firewall,</font> <font><font><b>Logwatch‚Äôs</b></font></font> <font>daily reports</font> <font><font>will show entries about IP addresses exceeding the <b>CONN_LIMIT</b> connection <b>limits</b> .</font></font></font>  <font><font><font>Thus, you will always know who has increased interest in your server:</font></font></font> <br><br>  <font>- iptables firewall Begin ------------------------</font> <br>  <font><font>Logged 24 packets on interface eth0</font></font> <font><font><br></font></font>  <font><font>From 10.7.57.22 - 21 packets to tcp (110)</font></font> <font><font><br></font></font>  <font><font>From 10.16.63.206 - 3 packets to tcp (110)</font></font> <font><font><br><br></font></font>  <font><font>Logged 5367 packets on interface eth1</font></font> <font><font><br></font></font>  <font><font>From 72.53.179.125 to 5297 packets to tcp (110)</font></font> <font><font><br></font></font>  <font><font>From 193.255.130.19 - 2 packets to tcp (25)</font></font> <font><font><br></font></font>  <font><font>From 217.175.23.3 - 68 packets to tcp (25)</font></font> <font><font><br><br></font></font>  <font><font>- iptables firewall End -------------------------</font></font> <font><font><br></font> <br><br><br></font>  <font><b><font>Installation</font></b></font> <font><br><br></font>  <font><font>1. Download the firewall script and put it in</font> <b>/ bin /</b> <font>:</font></font> <font><br></font>  <font><font>wget --no-check-certificate <a href="https://sites.google.com/site/smkuzmin/home/fwtraf/fwtraf">sites.google.com/site/smkuzmin/home/fwtraf/fwtraf</a> -O fwtraf</font></font> <font><font><br></font></font>  <font><font>mv fwtraf / bin /</font></font> <font><font><br></font></font>  <font><font>chmod 755 / bin / fwtraf</font></font> <font><br></font>  <font><font>2. Download the firewall configuration file and put it in</font> <b>/ etc / fwtraf /</b> <font>:</font></font> <font><br></font>  <font><font>wget --no-check-certificate <a href="">sites.google.com/site/smkuzmin/home/fwtraf/fwtraf.conf</a> -O fwtraf.conf</font></font> <font><font><br></font></font>  <font><font>mkdir / etc / fwtraf</font></font> <font><font><br></font></font>  <font><font>mv fwtraf.conf / etc / fwtraf /</font></font> <font><br></font>  <font><font>3. Download the file for the</font> <b>Cron</b> <font>Task Scheduler</font> <font>and put it in</font> <b>/etc/cron.d/</b> <font>:</font></font> <font><br></font>  <font><font>wget --no-check-certificate <a href="">sites.google.com/site/smkuzmin/home/fwtraf/fwtraf.cron</a> -O fwtraf.cron</font></font> <font><font><br></font></font>  <font><font>mv fwtraf.cron /etc/cron.d/</font></font> <font><br></font>  <font><font>4. Turn off the <b>iptables</b> service and add firewall initialization on every boot:</font></font> <font><br></font>  <font><font><font><font>chkconfig iptables off</font></font></font></font> <font><font><font><font><br></font></font></font></font>  <font><font><font><font>chkconfig ip6tables off</font></font></font></font> <font><font><font><font><br></font></font></font></font>  <font><font><font><font>echo &gt;&gt; / etc / rc.d / rc.local</font></font></font> <font>/ bin / fwtraf fwinit</font></font> <font><br></font>  <font><font>5. Read the file</font> <b>/etc/fwtraf/fwtraf.conf</b> <font>and edit it in accordance with</font></font> <font><font><br></font></font>  <font><font>their needs.</font></font> <font><br></font>  <font><font>6.</font> <font>After editing</font> <b>fwtraf.conf</b> <font>, we apply the firewall rules:</font></font> <font><br> <font><font color="#000000">&nbsp; &nbsp;&nbsp;</font></font></font>  <font><font>fwtraf fwnormal</font></font> <font>- normal (working) mode.</font> <br>  <font>7. Check the work of the firewall, and if everything suits, save the rules:</font> <br><font>&nbsp; &nbsp; </font>  <font>fwtraf fwsave</font> <font>-</font> <font>all rules are saved and valid after a reboot.</font> <br><br>  <font>There is a mode with a minimum set of rules:</font> <br> <font><font color="#000000">&nbsp; &nbsp;&nbsp;</font></font>  <font>fwtraf fwsimple</font> <font color="#000000">- simple mode, personal rules do not apply, everything is allowed.</font> <br><br>  The remaining commands can be found out like this: <br>  <font>fwtraf</font> <font>- help on commands.</font> <br><br>  <font>To enable support for working with</font> <b>BIND</b> <font>(</font> note: DNS zones will be pre-recorded! <font>), Uncomment the line c "</font> DNSROOTDIR = ..." in <b>/ bin / fwtraf</b> . <br><br></div><p>Source: <a href="https://habr.com/ru/post/146116/">https://habr.com/ru/post/146116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146110/index.html">RTFM in search - twice as many languages</a></li>
<li><a href="../146111/index.html">Reflections on the evolution of marketing in IT</a></li>
<li><a href="../146112/index.html">Using symfony2 to create an e-commerce portal from scratch</a></li>
<li><a href="../146114/index.html">How to overclock the Android emulator</a></li>
<li><a href="../146115/index.html">Cassandra through the eyes of Operations</a></li>
<li><a href="../146117/index.html">BlackBerry 10 Jam for the first time in Russia</a></li>
<li><a href="../146118/index.html">Web of Trust connected Safe Search Yandex (SafeBrowsing API)</a></li>
<li><a href="../146121/index.html">Month with Nokia Lumia 710 and Windows Phone 7</a></li>
<li><a href="../146122/index.html">Gfranq.com gathered 100,000 users in 3 months and expands staff</a></li>
<li><a href="../146123/index.html">ASUS 1025CE review: the living of all living</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>