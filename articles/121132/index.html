<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Code-first in Entity Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Into 
 Under .NET, there are two native ORMs developed and supported by Microsoft, the Entity Framework and Linq2Sql. However, the Entity Framework co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Code-first in Entity Framework</h1><div class="post__text post__text-html js-mediator-article"><h5>  Into </h5><br>  Under .NET, there are two native ORMs developed and supported by Microsoft, the Entity Framework and Linq2Sql.  However, the Entity Framework continues to develop at an impressive pace, and nothing really is known about the future of Linq2Sql. <br><br>  Entity Framework offers a convenient designer, a huge number of mapping options, autogeneration of model classes, but there is a fat minus for all of this - giant and bloated generated classes, which also cannot be changed manually - because every time the model changes in the designer, everything will be recreated again .  Compare this to the pure classes, and the attributes added to them, as in Linq2Sql, and you will understand why so many people claim that Linq2Sql is lightweight and EF is monstrous. <br><br>  Of course, every problem has a solution, and this is no exception.  Partial classes will allow you to add the necessary functionality, and specially created classes with validation rules, marked with the [MetadataType] attribute, will allow you to use validation attributes for model classes.  But together it turns out not very nice - the classes spread over the project, the increase in their number, and all the same difficulty in support. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Don't forget about the working conditions of the model classes: they must either inherit from EntityObject or implement the interfaces of EntityWithKey, IEntityWithChangeTracker and IEntityWithRelationships <br><br>  So what do those who want to get the most simple classes to work within ORM? <br><a name="habracut"></a><br><h5>  ROSO and Code-First </h5><br>  For the first time, support for ROSO (Plain Old CLR Objects), that is, work with simple classes, as with models appeared in EF 4. <br><br><h6>  Note </h6><br>  Despite the stated support in Visual Studio SP1, I still had to install <a href="http://go.microsoft.com/fwlink/%3FLinkId%3D212219">Visual Studio Tools for SQL Server Compact 4</a> and the <a href="http://www.nuget.org/List/Packages/EntityFramework">EF Code First Package</a> to work correctly. <br><br>  For example, here is a class <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Author</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> AuthorID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br>  Describes the full-featured ‚Äúauthor‚Äù entity, and it does not need a base class, no interfaces, no attributes or metadata. <br><br>  The simplest entry point would look like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Library</span></span> : <span class="hljs-title"><span class="hljs-title">DbContext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Author&gt; Authors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br>  And that's it!  Immediately after creating the Library object, you can work with it using all the advantages of EF. <br><br>  <b>Code-First</b> is a new feature that is on a par with Model-First and Database-First.  Now you can first write code that describes the model classes, and then the framework will automatically create a database using such a code. <br>  The most pleasant thing is that the types of relationships will be recognized - it is enough to define just the object references for 1: 1, the ICollection for the 1: n relationship, and the mutual ICollection for m: n.  In this case, an intermediate table will also be created automatically.  To ensure a ‚Äúlazy‚Äù load, the virtual keyword in the property definition will suffice. <br><br>  Attributes from the <code>System.ComponentModel.DataAnnotations</code> namespace are also fully supported. <br><br>  The main ones are: <br>  ‚Ä¢ [Key] - indicates that this property will be key. <br>  ‚Ä¢ [NotMapped] - do not display the property on columns in the database. <br>  ‚Ä¢ [Column (‚ÄúcolumnName‚Äù, TypeName = ‚ÄùtypeName‚Äù] - indicates the column in the database, which displays the field and its type. Useful when the class has a byte [] type property that stores, for example, a drawing, and in the database it is displayed on special type image. <br>  <b>UPD</b> However, you cannot specify a subset of the type in this way: for example, for strings, the base type nvarchar (MAX) is selected and, using this attribute, you cannot explicitly specify the length of the nvarchar field (30) <br>  ‚Ä¢ [MinLength], [MaxLength], [Required] and others to provide data verification <br><br>  Code-First is designed to work with the new version of SQL Server CE 4.0.  Support for this database is included in MVC3, and some people are already <a href="http://outcoldman.ru/ru/blog/show/273">transferring</a> sites to work with such a database, and not standard SQL Express. <br><br>  By default, the database generator tries to create a SQL Express database, if it does not work, then SQL Server CE.  This behavior is easily overridden in app.config <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connectionStrings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Library"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connectionString</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Data Source=Library.sdf"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">providerName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Data.SqlServerCe.4.0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connectionStrings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Note that the name of the connection string must match the name of the access point class (DbContext). <br><br>  You can also define a database creation strategy (primary generation or update).  Every strategy is a class that implements the IDatabaseInitializer interface, i.e.  You can define your strategy, which enters any data in the database during the active development of the program. <br>  Predefined strategies - CreateDatabaseIfNotExists (create a database if it does not exist), DropCreateDatabaseAlways (the database will always be deleted and re-created), DropCreateDatabaseIfModelChanges (re-created with changes in the model) <br><br>  Changing the strategy of working with the database call <br>  Database.SetInitializer (new DropCreateDatabaseAlways ()); <br><br>  When creating a database, the framework creates another EdmMetadata service table, which stores the model hash imprint at the time of creation.  This is inconvenient when actively developing the database and classes, but there is a solution - overloading the OnModelCreating method of the DbContext class. <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnModelCreating</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DbModelBuilder modelBuilder</span></span></span><span class="hljs-function">)</span></span> { modelBuilder.Conventions.Remove&lt;IncludeMetadataConvention&gt;(); }</code> </pre><br><br>  In general, Conventions is a pretty powerful thing.  They allow you to configure the display of properties on the database based on a variety of signs, enable / disable namespaces, and more.  Read more about them <a href="http://blogs.msdn.com/b/adonet/archive/2011/01/10/ef-feature-ctp5-pluggable-conventions.aspx">here.</a> <br><br>  Code-First really provides many opportunities for managing the code of models in the most convenient way for you.  I believe that especially for small projects, as well as for mobile devices (yes, SQL Server CE 4.0 will be supported in Windows Phone Mango), this approach will be maximally justified. </div><p>Source: <a href="https://habr.com/ru/post/121132/">https://habr.com/ru/post/121132/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121126/index.html">Using TileMill</a></li>
<li><a href="../121128/index.html">Google charges its employees for free</a></li>
<li><a href="../121129/index.html">ALTER very large tables in MySQL</a></li>
<li><a href="../121130/index.html">First impressions of Sony Ericsson Xperia mini 2011</a></li>
<li><a href="../121131/index.html">Panasonic has updated its "not killed" Toughbook CF-19</a></li>
<li><a href="../121134/index.html">New Trojan for Android is distributed with the Angry Birds Rio Unlock app.</a></li>
<li><a href="../121136/index.html">Functions in bashrc. One more simple thing</a></li>
<li><a href="../121137/index.html">Set the virtual machine IP over MAC without using DHCP</a></li>
<li><a href="../121138/index.html">rtorrent + rutorrent + nginx + php-fpm. Underwater rocks</a></li>
<li><a href="../121140/index.html">Configure the Cisco 79XX Series Phone to Work with Asterisk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>