<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The monitoring system in the car for him on the Raspberry Pi. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Good day. 
 Once I purchased Raspberry Pi without any kind of purpose - as soon as the mention of it started in Habr√©. I started aimles...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The monitoring system in the car for him on the Raspberry Pi. Part 1</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Good day. <br>  Once I purchased Raspberry Pi without any kind of purpose - as soon as the mention of it started in Habr√©.  I started aimlessly launching a ftp server, trying Node.js and other small server business until I purchased a new car.  Of course, I didn‚Äôt do anything that could be found on the Internet like a remote garage opening - due to the normal lack of knowledge of the Linux system and server programming languages.  The car became dear to me and an idea arose - <b>to put the raspberry in a car with USB devices screwed to it: GPS, Web-camera, 3G-modem</b> - for which the 2nd Raspberry was purchased. <br>  In this article I will describe the preparation: installing Node.JS, setting up OpenVPN and 3G. <br><a name="habracut"></a><br><h5>  Plans </h5><br>  It is necessary that Malina was installed in the car with GPS and a webcam connected to it and that at any moment I could even watch from my mobile phone what was happening with my car. <br><habracut><br><h4>  So let's get started </h4><br><h5>  Installing Node.JS </h5><br>  Install Node.JS from the site, as version 0.6.18 is in the repository. <br><pre><code class="bash hljs">sudo mkdir /opt/node wget nodejs.org/dist/latest/node-v0.10.20-linux-arm-pi.tar.gz tar xvzf node-v0.10.20-linux-arm-pi.tar.gz sudo cp -r node-v0.10.20-linux-arm-pi/* /opt/node</code> </pre> <br>  Now we add the path to Node.JS to the environment variables so that we do not have to prescribe a long path.  To do this, edit the file: <br><pre> <code class="bash hljs">sudo nano/etc/profile  : NODE_JS_HOME=<span class="hljs-string"><span class="hljs-string">"/opt/node"</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$NODE_JS_HOME</span></span></span><span class="hljs-string">/bin"</span></span></code> </pre><br>  As a result, the head of this file will look like this: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/profile: system-wide .profile file for the Bourne shell (sh(1)) # and Bourne compatible shells (bash(1), ksh(1), ash(1), ...). if [ "`id -u`" -eq 0 ]; then PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" else PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games" fi NODE_JS_HOME="/opt/node" PATH="$PATH:$NODE_JS_HOME/bin" export PATH</span></span></code> </pre><br>  We will need to install some modules globally (eg npm install -g express), so we will make our user the node directory: <br><pre> <code class="bash hljs">sudo chown -R pi /opt/node</code> </pre><br>  Checking: <br><img src="https://habrastorage.org/getpro/habr/post_images/449/066/68d/44906668d8b89985bc12a681567a614e.png"><br><br>  To write the code in the future, create a folder: <br><img src="https://habrastorage.org/getpro/habr/post_images/a26/6c3/367/a266c3367da724cda4c10253e94e09b3.png"><br><br>  According to the rules for finding modules, we will make a symlink of the global directory of modules in the home directory, more information about this can be found here: <a href="http://nodejs.ru/doc/v0.4.x/modules.html">nodejs.ru/doc/v0.4.x/modules.html#_u0417_u0430_u0433_u0440_u0443_u0437_u043A_u0430_ukh147</a> <br><pre> <code class="bash hljs">ln -s /opt/node/lib/node_modules ~/node_modules</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/ad5/213/e73/ad5213e73bf5e7ff9aab33e825768288.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  OpenVPN setup </h5><br>  Since there is no possibility to connect via SSH or somehow get in touch with Malinka via OpCoS except for paying for external IP services, let's configure OpenVPN. <br><br><h6>  Training </h6><br><br><ul><li>  there is a router with a static external IP address </li><li>  one Malinka is connected to the router via Ethernet </li><li>  There are 2 Raspberries, which will be far away and only available via 3G </li></ul><br><br>  To do this, we will issue a physical IP address for Raspberry connected to the router: <br><img src="https://habrastorage.org/getpro/habr/post_images/e09/f0f/f0e/e09f0ff0e37d93617f7bbd724e375564.png"><br><br>  Forward OpenVPN requests to the router from the outside to our "home" Malin, and for one SSH and HTTP: <br><img src="https://habrastorage.org/getpro/habr/post_images/170/9a5/dd7/1709a5dd7a0e3ab5edabbe8703f59a48.png">  We will install Node.JS on home Raspberry just as it was done before. <br><br><h6>  Installation </h6><br><pre> <code class="bash hljs">sudo apt-get install openvpn -y</code> </pre><br>  About the generation and configuration has been written a lot both in Habr√©, and beyond.  I used the following articles: <a href="http://habrahabr.ru/post/188474/">habrahabr.ru/post/188474</a> , <a href="http://adw0rd.com/2013/01/10/openvpn/">adw0rd.com/2013/01/10/openvpn/#.UmTuCBCpFZQ</a> , <a href="http://www.volmed.org.ru/wiki/index.php/%25D0%259D%25D0%25B0%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D0%25B9%25D0%25BA%25D0%25B0_OpenVPN_%25D1%2581%25D0%25B5%25D1%2580%25D0%25B2%25D0%25B5%25D1%2580%25D0%25B0">www.volmed.org.ru/wiki/index.php/%D0%9D%D0% B0% D1% 81% D1% 82% D1% 80% D0% BE% D0% B9% D0% BA% D0% B0_OpenVPN_% D1% 81% D0% B5% D1% 80% D0% B2% D0% B5% D1% 80% D0% B0</a> . <br><br>  I will give katy their settings. <br><img src="https://habrastorage.org/getpro/habr/post_images/6cf/892/6f3/6cf8926f36312f9e7a808c497e937fe6.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/d40/316/b5b/d40316b5b1c4da70078b4c50638e6ce2.png"><br>  For the client, in the remote field is my external static address on the router. <br><br><h5>  3G setup </h5><br><h6>  Training </h6><br>  To access 3G, I bought a Huawei E1550 3G modem from Megafon, with its SIM card. <br><br>  When connecting a modem is defined as a disk, it is necessary to switch it to modem mode. <br><img src="https://habrastorage.org/getpro/habr/post_images/b05/9ec/ec7/b059ecec7b054bde8c2d032a976ba6c0.png"><br><br>  To switch to modem mode, you must install the program and reboot. <br><pre> <code class="bash hljs">sudo apt-get update &amp;&amp; sudo apt-get install usb-modeswitch -y sudo reboot</code> </pre><br><br>  Let's see our devices: <br><img src="https://habrastorage.org/getpro/habr/post_images/440/9c8/49d/4409c849d53d61da5dae98ffa883d793.png"><br><br><h6>  Actually setting up the connection </h6><br>  Create a directory: <br><pre> <code class="bash hljs">$ mkdir ~/3g &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/3g</code> </pre><br>  Download the 3G connection setup program: <br><pre> <code class="bash hljs">wget http://sourceforge.net/projects/vim-n4n0/files/sakis3g.tar.gz/download tar -xzvf sakis3g.tar.gz</code> </pre><br>  Download the add-in program on UMTSKeeper (this is an add-on over sakis3g and it was written by the same author =)) <br>  <i>UMTSKeeper should be in the same directory as sakis3G</i> <br><pre> <code class="bash hljs">$ wget http://zool33.uni-graz.at/petz/umtskeeper/src/umtskeeper.tar.gz $ tar -xzvf umtskeeper.tar.gz</code> </pre><br>  Install PPP support <br><pre> <code class="bash hljs">sudo apt-get install ppp -y</code> </pre><br>  Now we will try to establish a 3G connection: <br><pre> <code class="bash hljs">sudo /.sakis3g --interactive</code> </pre><br>  In the first option, select <blockquote>  Connect with 3G </blockquote>  , and in the second 11th day - <blockquote>  Custom APN </blockquote>  . <br>  For megaphone settings are as follows: <br><ul><li>  APN: internet </li><li>  APN_USER: megafon </li><li>  APN_PASS: megafon </li></ul><br>  If everything is correct, the program will display a message about successful connection. <br><br>  In order for the connection to be restored when the connection is broken, we already have the UMTSKeeper. <br><pre> <code class="bash hljs">sudo /home/pi/3g/umtskeeper --sakisoperators <span class="hljs-string"><span class="hljs-string">"USBINTERFACE='0' OTHER='USBMODEM' USBMODEM='12d1:1001' APN='CUSTOM_APN' CUSTOM_APN='internet' APN_USER='megafon' APN_PASS='megafon'"</span></span> --sakisswitches <span class="hljs-string"><span class="hljs-string">"--sudo --console"</span></span> --devicename <span class="hljs-string"><span class="hljs-string">'Huawei'</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> --silent --nat <span class="hljs-string"><span class="hljs-string">'no'</span></span> &amp;</code> </pre><br>  Instead of the value <u>12d1: 1001 ',</u> you must specify your device number from <u>lsusb</u> . <br><br>  Now let's see the magazine: <br><img src="https://habrastorage.org/getpro/habr/post_images/cd2/0ab/a33/cd20aba33edb2d2fe5d8f17fa5a0777d.png"><br><br>  Everything works perfectly! <br>  Now let's write this command to autoload: <br><pre> <code class="bash hljs">crontab -e</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/5c3/5c6/d2c/5c35c6d2c56f3219809cf24d21a328f9.png"><br><br><h4>  Conclusion </h4><br>  As a result, we have this situation: <br>  There is a router with an external static IP address, to which the ‚Äúhome‚Äù Raspberry Pi is connected and acting as the OpenVPN server (and http in the future) and the ‚Äúcar‚Äù Raspberry Pi, which is connected to the ‚Äúhome‚Äù OpenVPN using a 3G modem. <br><br><h5>  Some pictures for a change: </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/77f/04c/891/77f04c8913651c1d9bbe66b3ac25ba53.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/159/5c7/e47/1595c7e47bb58a004ed4234ec60514da.jpg"><br><br><h5>  PS </h5><br>  I spend most of my time on the front-end, so the server part might not be perfect somewhere. <br>  With positive feedback, in the next article I‚Äôll write about connecting and setting up a GPS receiver and a webcam via a USB hub. </habracut></div><p>Source: <a href="https://habr.com/ru/post/202012/">https://habr.com/ru/post/202012/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201996/index.html">The art of generics</a></li>
<li><a href="../202000/index.html">Toaster. Userstyle. Update</a></li>
<li><a href="../202002/index.html">Sort Android application icons installed on a smartphone (tablet) by color (idea)</a></li>
<li><a href="../202004/index.html">A brief and instructive history of video games</a></li>
<li><a href="../202010/index.html">Realization of a dream, or Radio 86RK - 25 years later</a></li>
<li><a href="../202014/index.html">Snake on Canvas</a></li>
<li><a href="../202016/index.html">Java web start issues when upgrading to j7u45</a></li>
<li><a href="../202018/index.html">OWIN and Katana: First Look</a></li>
<li><a href="../202020/index.html">Our tanks. The history of load testing in Yandex</a></li>
<li><a href="../202022/index.html">Building your own JS SDK - why and how?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>