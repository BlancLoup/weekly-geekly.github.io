<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart alarm clock based on motion sensor or IP camera</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think that many of you know about different phases of sleep and the existence of smart alarm clocks, there have already been many articles about it....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart alarm clock based on motion sensor or IP camera</h1><div class="post__text post__text-html js-mediator-article">  I think that many of you know about different phases of sleep and the existence of smart alarm clocks, there have already been many articles about it.  The bottom line is that during the night there is a change of phases of fast and slow sleep.  Depending on which phase you wake up in, the morning can be both kind and very gray.  During a slow sleep, the person gradually falls asleep stronger and stronger, it is not worth waking him up at this moment, it will be hard to wake up.  During the fast phase, the person does not sleep so well, can turn and roll over from side to side.  It is at this moment the easiest to wake up. <br><br>  On this principle, many smart alarm clocks are built.  They come in the form of desktop gadgets or wristwatches, as well as applications for smartphones.  The principle of their work is very simple.  They wake up not at a strictly specified moment, but at a time when it is desirable to wake up, while waiting for some kind of movement.  If the person began to move, then the REM sleep phase began, and it was time to wake him up. <br><br>  In my room, one of the motion sensors is hanging right above the bed.  I talked a little about this in my <a href="http://habrahabr.ru/post/228151/">article about my smart home</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/3ec/34d/87d/3ec34d87d1669038dbd0d703d778e7d1.jpg" alt="image"><br><br>  Recently, I looked through the logs and noticed that the phases of my sleep are clearly visible on the movement history from this sensor when I sleep alone.  This is not surprising, it is very well captures any of my movement, even if I lie under a blanket.  Immediately the thought arose - why not make my alarm clock ‚Äúsmart‚Äù? <br><a name="habracut"></a><br><br><h4>  Motion Sensor </h4><br>  Many asked me how my sensors were arranged, they asked me to give a diagram.  In fact, everything is easier nowhere.  I went to the nearest electrical installation store and bought an ordinary household motion sensor to turn on the light, it cost me about 200 rubles.  He had three conclusions: general, power 220V and output.  However, for my purposes, switching such a voltage was completely useless.  I disassembled the sensor and found two circuit boards inside: brains and power.  The first was powered from a voltage of about 9V and gave the output a logical unit in the presence of motion.  The second provided these same 9 volts at the expense of capacitor power and switched the load with an electromagnetic relay.  As a result, the board with capacitor power was replaced with my board with a microcontroller: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ede/de7/94d/edede794d1ee279704d459ac2f33c627.jpg"><br><br>  The task of the microcontroller is extremely simple: wait for a logical unit from the motion sensor and send information about it to the smart home network, but do it no more than once a minute.  All this is now powered by 12 volts, which I have extended to all devices. <br><br><h4>  Alarm scripts </h4><br>  Since all the devices in my house are connected to my Linux-based router, and it is he who is engaged in awakening, all the remaining machinations are reduced to writing shell scripts. <br><br>  <b>Alarm.sh</b> answers me for the alarm clock, which is started at the right time through <b>cron</b> , while the parameters are transmitted - exactly how to wake up.  Now this script should be launched when that interval begins, during which I must wake up.  Let it last 30 minutes.  It turns out that if I need to wake up no later than 9:30, then the alarm should be set to 9:00. <br>  The script turned out like this: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh #       MAX_TIME=1800 #    FLAG_FILE=/tmp/motion.flag #     crontab -l | grep -v alarm.sh | crontab - #  -,      ,    if [ -f $FLAG_FILE ]; then rm $FLAG_FILE fi #      for i in `seq 1 $MAX_TIME`; do #   ,   ,     if [ -f $FLAG_FILE ]; then break fi sleep 1 done #  ,   if [ "$1" -eq 1 ] then radio.sh &amp; fi #  ,       if [ "$2" -ge 1 ] then sleep 1 light.sh $2 &amp; fi #  ,   if [ "$3" -eq 1 ] then /usr/local/sbin/wakemypc fi # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">   </span></span></code> </pre> <br><br>  In a script that responds to packets from smart home devices, I made a flag creation: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># $3 -  , 21 -     if [ "$3" -eq 21 ] then touch /tmp/motion.flag fi</span></span></code> </pre><br><br>  If interested, this is how radio is turned on via <b>radio.sh</b> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh #       - echo "04040C017A850976"&gt;/tmp/clunet.fifo sleep 10 for i in `seq 1 80`; do #    0.5 dB,      echo "04040C017A851AE5"&gt;/tmp/clunet.fifo sleep 6 done</span></span></code> </pre><br><br>  An <b>alarm.sh is added</b> to crontab by a PHP script, so the alarm clock can be set via the web interface: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68d/22d/4af/68d22d4af6bc69e656f9d52fc29425d8.png" alt="image"><br><br>  Or through the application for Android: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c6d/d34/2e8/c6dd342e87d75adca48904aa0417ea23.png"><br><br>  In fact, such an alarm clock could be done without a router with Linux, because the motion sensor and remote control transmitter are connected directly, but for this you would have to somehow teach them to count the time, which they were not originally designed for. <br><br><h4>  Using an IP Camera </h4><br>  Theoretically, for an intelligent alarm clock, you can use an IP camera with infrared illumination, if you direct it to the bed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/61e/d52/85a/61ed5285ac04179b685b882fce4cae64.jpg"><br><br>  Virtually any such camera has the ability to track movement.  The admin of my camera looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/47f/8f0/29b/47f8f029b6d9feff1f01ddc54180788b.png"><br><br>  Yes, clumsy English from the Chinese :) As you can see, you can specify the URL that is requested when motion is detected.  Things are easy - to write a PHP script, which, when called, will create a flag. <br><br>  Plus the camera is that theoretically it can see the movement under the blanket, because it isolates heat, to the movement of which the usual sensor reacts.  However, practice shows that the overall sensitivity and reliability is much lower. <br><br><h4>  Total </h4><br>  These alarm clocks really help make the morning good.  Feelings are very peculiar.  For example, I can roll over in my sleep from side to side, and during this the alarm clock will turn on, as a result of which I wake rather above the bed and not on it :) <br>  Alas, this approach to creating a smart alarm clock is only suitable for people who sleep in proud loneliness. <br><br>  I must say that a separate alarm clock in the form of a radio, which gradually increases the volume, is also very pleasant.  During a sound sleep, he does not wake up instantly, quiet music begins to break through the sleep and gradually increase.  However, more often I still wake up from the sound of switching on the receiver. <br><br>  While writing an article, went to the seventh hour of the morning.  Good morning, Habr :) </div><p>Source: <a href="https://habr.com/ru/post/229713/">https://habr.com/ru/post/229713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229689/index.html">Will servers on ARM be able to make Intel nervous?</a></li>
<li><a href="../229691/index.html">Angular light 0.6</a></li>
<li><a href="../229695/index.html">Sensibo can make any air conditioner "smart"</a></li>
<li><a href="../229697/index.html">Trends in interface design: from love to hate</a></li>
<li><a href="../229699/index.html">Quantum money</a></li>
<li><a href="../229715/index.html">[survey] What negotiating situations should be dealt with in the "Negotiator Handbook"</a></li>
<li><a href="../229717/index.html">Some mathematical problems of information security</a></li>
<li><a href="../229719/index.html">Encryption of cloud services in companies and organizations</a></li>
<li><a href="../229721/index.html">Do not read books</a></li>
<li><a href="../229723/index.html">Microsoft Workflow - antimarketing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>