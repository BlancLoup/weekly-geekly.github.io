<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google Analytics statistics on your site</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I remember how I skipped a couple of records ( here and here ) about importing data from Google Analytics to display summary diagrams on the site, in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google Analytics statistics on your site</h1><div class="post__text post__text-html js-mediator-article"> I remember how I skipped a couple of records ( <a href="http://dab512.habrahabr.ru/blog/26862/">here</a> and <a href="http://habrahabr.ru/blogs/webdev/19564/">here</a> ) about importing data from Google Analytics to display summary diagrams on the site, in general, as in a <a href="http://habrahabr.ru/stats/">habr</a> .  After reading the aforementioned topics and not paying particular attention then, I successfully ‚Äúforgot‚Äù about them and went further on.  And now, there is a need to implement something similar on one of their projects. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/219/b76/349/219b7634963c935563fe45bee593acd2.gif" alt="image"><br><br>  Having reviewed Habr again, I was surprised to find that then no one had found any solution for the implementation of this task.  Therefore, I decided to scribble to export data from GA and display it on the site.  Actually, I want to share it with the public. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPDATE</b> : <br>  Added another version, details and link under the cut. <br><br><a name="habracut"></a><br>  You can download <a href=""><b>from here</b></a> . <br><br>  New version to take <a href=""><b>here</b></a> . <br>  In the config.php added the variable $ id, which corresponds to the id in Google Analytics.  This id is used in the URL of each report. <br>  That is, you can either specify your id in the config in this version, or correct the $ url variables in the previous one by specifying the required id in the query string. <br>  Thank you <a href="https://habrahabr.ru/users/orenlab/" class="user_link">Orenlab</a> for the comment. <br><br>  <b>UPDATE 2:</b> <br><br>  The next version is <a href=""><b>here</b></a> . <br>  In ga.php from request removed <a href="http://www.askapache.com/">www.askapache.com</a> <br>  Without this variable, everything works just fine.  Why it was necessary - it remains to be guessed.  I looked through the Google headers - I did not see anything like that. <br>  Thanks to <a href="https://habrahabr.ru/users/alexspaiznet/" class="user_link">AlexSpaizNet</a> for the comment. <br><br>  <b>UPDATE 3:</b> <br>  Version 1.0 added <br>  Take <a href="">away from here</a> <br>  This is the first and last release of the script in the form and with the functions that are currently available.  With it, you can easily adjust everything to fit your needs and use. <br><br>  The changes are: <br>  - Parser slightly rebuilt.  Unfortunately, there were certain difficulties when working with the English established in GA, therefore: <br>  <b>ATTENTION!</b>  <b>To work correctly, the Russian language must be installed in the Analytics settings.</b> <br><br>  - Added <u>visiting</u> schedules <br>  - The stripos function has been replaced by strpos, since stripos does not work in recent versions of PHP <br>  - Fixed problem with caching settings and data for graphs.  Now, with each refresh, you should see the updated data <br>  - index.html replaced by index.php <br>  - the $ path variable appeared in the config.php - you must specify the full value for its value to the directory in which the files will be written <br>  - also added reversing $ debug - if it is set to true, a log.txt file will be created, into which the stream will be dropped, all reports received from Google Analytics (i.e., the data that Google gave, even before we fired them) <br><br>  <b>List of all versions is</b> <a href="http://code.google.com/p/statga/downloads/list"><b>here.</b></a> <br><br>  <b>UPDATE 4:</b> <br>  In connection with the latest changes in GA version 2.0b was released <br>  Take as usual <a href="">from here</a> <br><br>  To make it clear what was happening and what has changed, I will briefly sign for the changes. <br><br>  So, firstly Google changed the format of dates in reports, now instead of October 25, 2008 it looks like October 25, 2008 <br>  In addition, something has changed in the definition of the language used in the reports.  Now through the script I always get the English language, through the browser, normally taking the report, I get the one that should be.  What is the reason I have not figured it out yet. <br>  So, actually to change. <br><br>  1) It was decided to switch to another type of reports - <i>TSV</i> , as it turned out, under this mysterious name hides a text file with tab delimiters.  This allowed us to not depend on the language at all. <br><br>  so, in all variables $ url in stat.php fmt = 2 changed to fmt = 3 <br><br>  2) since now we have another split in text files - in the processings we change "," to "\ t" <br>  these lines look something like <br>  $ line = explode ("\ t", $ lines [$ i]); <br><br>  3) since the date we get is already in a different form, it will not be possible to format it earlier, therefore, the comment lines after <br>  // format the date <br><br>  4) well, in fact, in the anl language, a thousandth part is taken to be separated by a comma, which we delete in order that amcharts normally draw a chart <br><br>  // remove the thousands delimiter character <br>  $ line [1] = str_replace (chr (194). chr (160), "", $ line [1]); <br>  $ line [1] = str_replace (",", "", $ line [1]); <br>  $ line [2] = str_replace (chr (194). chr (160), "", $ line [2]); <br>  $ line [2] = str_replace (",", "", $ line [2]); <br><br>  It seems everything ... with the problems with the Russian understand in the near future. <br><br>  <b>UPDATE 5:</b> <br>  Version 2.0.1 is available <br>  <a href="">Pick up</a> <br>  Now the Russian language works fine. <br>  Changes are made to the ga.php file, one cookie has been added - $ aFoundCookies [1] [] = "AnalyticsUserLocale = en"; <br><br>  Well, on formatting dates, small changes are made in stat.php (but this is not necessary ...) <br><br>  Briefly I will describe the main nuances, setting and principle of operation. <br>  (installation guide below) <br><br>  So, probably everyone knows that there is an opportunity to get a report from GA in one of the formats (PDF, XML, CSV and something else).  Thus, this is the easiest way to export data.  However, downloading a report is possible only after authorization, and no external links are available to download a report without authorization.  True, it is possible to send a report to the soap (I read that some exported the data in this way, that is, the report was sent to the soap, then a script was run on the crown that took the mail, and the report was received, but, IMHO, this is nonsense).  In general, in order to receive, we need to simulate a login to the system and obtain data after that.  To do this, we use the ga.php script (which, by the way, was not written by me, but was found a few months ago in the wilds of the <a href="http://forum.searchengines.ru/">forum</a> , since thanks to the developer, because it saved time to parse Google authentication). <br>  For the implementation of the task we would be suitable formats either XML or CSV.  I don‚Äôt know that at that moment I was torn, but I stopped at the last one, i.e.  This is a plain text file, which we need to parse in a certain way for data import and plotting. <br><br>  Parsing the data we have is a stat.php script (it is the main executable script that loads ga.php and, in short, generates results files on a disk for creating diagrams) <br>  I tried to comment on the code as much as possible so that it was clear what was going where and why, and it was possible to add the necessary report without any particular difficulties.  I took, at my discretion, the 6 reports I needed: Attendance since the beginning of the resource‚Äôs existence (the date is specified in the settings), Attendance for the last three months, Sources of transitions, Geography of visitors, browsers and OS used for the last 30 days. <br><br>  All settings are specified in config.php <br><br>  By the way, on the site for which I needed to make a display of statistics, google analytics code was installed only a few months ago, but I wanted to show an increase in attendance from the very beginning of existence, i.e  more than two years in this case.  Therefore, the possibility was added to ‚Äústick‚Äù to the data obtained from GA, information on attendance during the time prior to the installation of the Google counter.  the default is the static default.csv file that was formed as necessary (there is an example of all csv files in the archive, including this one).  Where to get the data for it is up to you, in my case as many as 4 counters like rambler, mail, etc. were installed on the site.  (whose testimonies, by the way, vary sooo significantly).  If there is no need to use such a scheme, simply specify the name of the variable indicating the name of this file as false. <br><br>  AmCharts are <a href="http://www.amcharts.com/">closed</a> for displaying diagrams.  This is a paid product, worth 85 euros for a one-site license.  However, a free version is also available, which differs only in that the diagrams display an unobtrusive link to the developer‚Äôs website. <br>  The settings for each of the diagrams are indicated in the corresponding xml-files, which are well commented, and I think it‚Äôs hard to figure out what is in there.  I took the color scheme for presentation, similar to the graphs on Habr√©. <br>  The data for building charts is loaded from the above-generated csv files specially prepared for use in amCharts. <br><br>  In the end, we get something like the <a href="http://statga.ho.ua/">following</a> . <br><br>  Now you can drive the script into crowns, and update the statistics several times a day, for example: <br><br>  0 * / 8 * * * / usr / local / bin / php /home/username/public_html/stats/stat.php <br><br>  I am pleased to hear comments and suggestions! <br><br>  Ps.  <b>Installation</b> <br>  The file config.default.php is renamed to config.php <br>  We edit it, specifying, as imaginary, the following settings: <br><br>  1. Your Google Analytics account <br>  id we take after login through the browser and go to the main page with reports: <br>  <a href="https://www.google.com/analytics/reporting/%3Freset%3D1%26id%3D">www.google.com/analytics/reporting/?reset=1&amp;id=</a> <b>xxxxxxx</b> &amp; scid = xxxxxxx <br><br> <code>//  GA <br> $u="user"; <br> $p="password"; <br> $id="1234567"; <br></code> <br><br>  2. Set the time zone if the server time does not match what you need <br> <code>//  ,   ,        <br> putenv('TZ=Europe/Kiev'); <br></code> <br>  If it is the same, just comment or delete these lines. <br><br>  3. Specify the starting date in the format YYYYMMDD <br> <code>$datestart="20080101";</code> <br> <br>  This is the date from which you will draw the first graph, i.e.  beginning of all statistics <br><br>  Everything else can not touch, if you still want - the rest of the settings are commented <br><br>  Next, fill it all into the directory on the server <br>  <b>ATTENTION!</b>  You must have permissions to write to this directory from PHP <br><br>  We request the stat.php file - it generates a handful of .csv files - this is the data for the graphs <br>  To display the graphs, request index.php <br><br>  In turn, stat.php can be thrown into cron or any other task scheduler and run once a day to automatically update schedules. <br><br>  Good luck!  Thank you all for your interest! <br><br>  <b>Attention!</b>  <b>New version is available <a href="http://habrahabr.ru/blogs/webdev/72335/">here.</a></b> <br></div><p>Source: <a href="https://habr.com/ru/post/42080/">https://habr.com/ru/post/42080/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420791/index.html">Home robots: what to buy. Overview of available commercial robots for home</a></li>
<li><a href="../420793/index.html">Debug as a process</a></li>
<li><a href="../420795/index.html">Analyst Misconceptions</a></li>
<li><a href="../420797/index.html">Learning can not be postponed or not only by machine learning is a person alive</a></li>
<li><a href="../420799/index.html">MPS 2018.2: Generator Tests, GitHub Plugin, VCS Aspect, Migration Notifications, and More</a></li>
<li><a href="../420803/index.html">3D printing lessons. Plastic savings when printing non-functional models from 3Dtool</a></li>
<li><a href="../420805/index.html">[Translation] When to use parallel streams</a></li>
<li><a href="../420809/index.html">Security Week 31: Fifty shades of insecurity in Android</a></li>
<li><a href="../420811/index.html">Decentralized messenger and new generation telephone network</a></li>
<li><a href="../420813/index.html">Behind the scenes of the network in Kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>