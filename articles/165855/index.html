<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>File system load profiling with iostat and gnuplot - amateur notes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often the work "in the field" requires the collection and analysis of information on the customer's site in the presence of a very meager list of util...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>File system load profiling with iostat and gnuplot - amateur notes</h1><div class="post__text post__text-html js-mediator-article">  Often the work "in the field" requires the collection and analysis of information on the customer's site in the presence of a very meager list of utilities.  In particular, to collect information on the use of input-output system during the day. <br><br>  In the article I will try to show how, with only iostat and gnuplot, you can try to analyze the system and what conclusions you can make. <br><br>  I do not pretend to thorough possession of the subject and the exact use of terms.  Moreover, I will try to speak in ‚Äúordinary‚Äù language and not to rush in terms. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Everything described below is the fruit of experience, mistakes, googling, mana and other things. <br><a name="habracut"></a><br><br><h4>  Small educational program </h4><br><br>  In terms of evaluating the performance of an I / O system in terms of storage, there are several characteristics: <br><ul><li>  Bandwidth (bytes per second) - the maximum linear speed with which the device writes or reads one, but a very large file. </li><li>  IOPS (operations per second) is the number of requests sent to the device.  This is the speed of work with a large number of small files. </li><li>  Processing time (milliseconds) - the time during which an average I / O request is processed, including waiting in a queue, and waiting is the most characteristic, because it depends on the load and not on the size of the request itself.  The higher this time, the ‚Äúslower‚Äù the response of the system to an application request, but other applications are not affected in principle. </li><li>  Load (percent) is an estimate of the I / O load of the system.  At values ‚Äã‚Äãclose to 100%, the system ‚Äúrises‚Äù, including all applications.  Processors go to iowait, and processes that want I / O to go to [Disk] Sleep </li></ul><br><br>  At the same time, it is necessary to understand that none of these parameters can give a complete profile of file system usage.  It is difficult to see and evaluate the ‚Äúclean‚Äù operation of the file subsystem, if only because there are various caches on the stack of its work: disk buffer, RAID controller cache, system cache.  Accordingly, more or less extrapolated figures can be obtained only near the peak load.  And the topic of proper testing of storage systems, comparison and evaluation of results is generally not a plowed field and you can write a dissertation. <br><br><h4>  Basic characteristics </h4><br>  Since measuring absolute numbers in general is not very grateful, I prefer to evaluate their value based on some basis, and after that, to use some kind of relative yardstick.  And the experience of working with the DBMS hints that it is not the values ‚Äã‚Äãthat are worth comparing, but their orders. <br>  For such a basis, I took the following figures for myself: <br>  The average server hard disk is 10 thousand revolutions per second, connected via a SAS to a convenient RAID controller (with a cache on a battery): <br><ul><li>  has a bandwidth of about 300 megabytes per second with sequential access </li><li>  produces about 150 iops (in parrots) </li><li>  with a request processing time of about 10 ms </li></ul><br>  If all this lives in a RAID then, depending on the type of raid, the numbers multiply or are divided by the number of disks.  For example: 4 disks in RAID 1 + 0 should show half the total iops of all four disks. <br><br>  If the tests show that the system works, giving out about these numbers, it means that no one ‚Äútested‚Äù during testing, there are no miracles and you can continue to work.  Otherwise, you should first figure out what's wrong with the hardware (maybe the RAID is restored or the screw is scattered). <br><br>  Basically, I use the results of testing to assess the efficiency of working with the storage system and the impact of DBMS settings and our software on how they use it, as well as quick diagnosis of problems with DBMS. <br><br><h4>  Measurements </h4><br><h5>  Training </h5><br>  To begin with, it is reasonable to save df -hl in order to understand which sections we are talking about. <br><br><pre><code class="hljs pgsql"># df -hl Filesystem Size Used Avail Use% Mounted <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> /dev/sda1 <span class="hljs-number"><span class="hljs-number">4.0</span></span>G <span class="hljs-number"><span class="hljs-number">3.9</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>% / /dev/sda7 <span class="hljs-number"><span class="hljs-number">102</span></span>G <span class="hljs-number"><span class="hljs-number">94</span></span>G <span class="hljs-number"><span class="hljs-number">2.7</span></span>G <span class="hljs-number"><span class="hljs-number">98</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> /dev/sda6 <span class="hljs-number"><span class="hljs-number">1012</span></span>M <span class="hljs-number"><span class="hljs-number">307</span></span>M <span class="hljs-number"><span class="hljs-number">654</span></span>M <span class="hljs-number"><span class="hljs-number">32</span></span>% /var /dev/sda2 <span class="hljs-number"><span class="hljs-number">3.0</span></span>G <span class="hljs-number"><span class="hljs-number">69</span></span>M <span class="hljs-number"><span class="hljs-number">2.8</span></span>G <span class="hljs-number"><span class="hljs-number">3</span></span>% /tmp /dev/sda5 <span class="hljs-number"><span class="hljs-number">34</span></span>G <span class="hljs-number"><span class="hljs-number">24</span></span>G <span class="hljs-number"><span class="hljs-number">8.8</span></span>G <span class="hljs-number"><span class="hljs-number">73</span></span>% /ARCHIVE tmpfs <span class="hljs-number"><span class="hljs-number">4.0</span></span>G <span class="hljs-number"><span class="hljs-number">26</span></span>M <span class="hljs-number"><span class="hljs-number">3.9</span></span>G <span class="hljs-number"><span class="hljs-number">1</span></span>% /dev/shm</code> </pre> <br><br>  By the way, it is useful to remember which of the sections is swap. <br><br>  It will be good if the physical device is divided into different logical partitions for each component.  This way we will be able to evaluate the I / O system usage profile for each separated component. <br><br><h5>  Observation </h5><br>  Unlike other utilities, iostat is not very suitable for logging based on time.  Well, nothing, awk to help. <br><br>  Line to get the log file: <br><br><pre> <code class="hljs dos">iostat -xk -t <span class="hljs-number"><span class="hljs-number">10</span></span> | awk '// {<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> strftime("<span class="hljs-variable"><span class="hljs-variable">%Y-%</span></span>m-%d <span class="hljs-variable"><span class="hljs-variable">%H:%</span></span>M:%S"),$<span class="hljs-number"><span class="hljs-number">0</span></span>}' &gt;&gt; iostat.log &amp;</code> </pre><br><br>  Naturally, it should be run in the screenshot. <br><br>  Attention should be paid to the -t 10 parameter. This is the interval over which values ‚Äã‚Äãare averaged and ‚Äúaverages‚Äù are calculated in seconds. <br><br>  If the value is too small, there will be extra peaks and outliers on the chart.  If it is too large, there will be no significant peaks.  In my opinion, the interval of 3-10 seconds is optimal. <br><br>  Entering our log will be something like this: <br><pre> <code class="hljs perl">iostat -xk -t <span class="hljs-number"><span class="hljs-number">10</span></span> | awk <span class="hljs-string"><span class="hljs-string">'// {print strftime("%Y-%m-%d %H:%M:%S"),$0}'</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> Linux <span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">32.32</span></span>-m4.x86_64 (localhost.localdomain) <span class="hljs-number"><span class="hljs-number">01</span></span>/<span class="hljs-number"><span class="hljs-number">14</span></span>/<span class="hljs-number"><span class="hljs-number">2013</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> Time: <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> AM <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> avg-cpu: %user %nice %system %iowait %steal %idle <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">67</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">1.02</span></span> <span class="hljs-number"><span class="hljs-number">1.11</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">97.20</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> Device: rrqm/<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> wrqm/sr/sw/<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> rkB/<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> wkB/<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> avgrq-sz avgqu-sz await svctm %util <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> sda <span class="hljs-number"><span class="hljs-number">20.70</span></span> <span class="hljs-number"><span class="hljs-number">47.44</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">91</span></span> <span class="hljs-number"><span class="hljs-number">12.01</span></span> <span class="hljs-number"><span class="hljs-number">26.18</span></span> <span class="hljs-number"><span class="hljs-number">237.91</span></span> <span class="hljs-number"><span class="hljs-number">40.89</span></span> <span class="hljs-number"><span class="hljs-number">2.35</span></span> <span class="hljs-number"><span class="hljs-number">181.49</span></span> <span class="hljs-number"><span class="hljs-number">7.76</span></span> <span class="hljs-number"><span class="hljs-number">10.03</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> sda1 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">83</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.08 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">67</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">94</span></span> <span class="hljs-number"><span class="hljs-number">6.00</span></span> <span class="hljs-number"><span class="hljs-number">18.47</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">61.99</span></span> <span class="hljs-number"><span class="hljs-number">15.81</span></span> <span class="hljs-number"><span class="hljs-number">1.19</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> sda2 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">1.00</span></span> <span class="hljs-number"><span class="hljs-number">173.76</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">533.13</span></span> <span class="hljs-number"><span class="hljs-number">45.98</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> sda3 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">120.95</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">33.78</span></span> <span class="hljs-number"><span class="hljs-number">25.52</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> sda4 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">72.00</span></span> <span class="hljs-number"><span class="hljs-number">72.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> sda5 <span class="hljs-number"><span class="hljs-number">7.45</span></span> <span class="hljs-number"><span class="hljs-number">2.07</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">1.17</span></span> <span class="hljs-number"><span class="hljs-number">3.82</span></span> <span class="hljs-number"><span class="hljs-number">12.99</span></span> <span class="hljs-number"><span class="hljs-number">24.88</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">41.68</span></span> <span class="hljs-number"><span class="hljs-number">13.86</span></span> <span class="hljs-number"><span class="hljs-number">1.87</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> sda6 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">1.72</span></span> <span class="hljs-number"><span class="hljs-number">12.85</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">40.63</span></span> <span class="hljs-number"><span class="hljs-number">18.86</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> sda7 <span class="hljs-number"><span class="hljs-number">13.24</span></span> <span class="hljs-number"><span class="hljs-number">44.15</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">9.87</span></span> <span class="hljs-number"><span class="hljs-number">21.29</span></span> <span class="hljs-number"><span class="hljs-number">216.18</span></span> <span class="hljs-number"><span class="hljs-number">45.16</span></span> <span class="hljs-number"><span class="hljs-number">2.23</span></span> <span class="hljs-number"><span class="hljs-number">211.42</span></span> <span class="hljs-number"><span class="hljs-number">7.91</span></span> <span class="hljs-number"><span class="hljs-number">8.32</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> Time: <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> AM <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> avg-cpu: %user %nice %system %iowait %steal %idle <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">1.06</span></span> <span class="hljs-number"><span class="hljs-number">1.20</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">97.12</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> Device: rrqm/<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> wrqm/sr/sw/<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> rkB/<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> wkB/<span class="hljs-keyword"><span class="hljs-keyword">s</span></span> avgrq-sz avgqu-sz await svctm %util <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> sda <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">45.40</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">10.50</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">219.20</span></span> <span class="hljs-number"><span class="hljs-number">41.75</span></span> <span class="hljs-number"><span class="hljs-number">1.69</span></span> <span class="hljs-number"><span class="hljs-number">156.43</span></span> <span class="hljs-number"><span class="hljs-number">8.30</span></span> <span class="hljs-number"><span class="hljs-number">8.72</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> sda1 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">4.40</span></span> <span class="hljs-number"><span class="hljs-number">29.33</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">25.33</span></span> <span class="hljs-number"><span class="hljs-number">25.33</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> sda2 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> sda3 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> sda4 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> sda5 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">1.30</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">1.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">9.20</span></span> <span class="hljs-number"><span class="hljs-number">18.40</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">27.80</span></span> <span class="hljs-number"><span class="hljs-number">8.10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">81</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> sda6 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">70</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">1.10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">7.20</span></span> <span class="hljs-number"><span class="hljs-number">13.09</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">18.55</span></span> <span class="hljs-number"><span class="hljs-number">10.64</span></span> <span class="hljs-number"><span class="hljs-number">1.17</span></span> <span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> sda7 <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">42.60</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">8.10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">198.40</span></span> <span class="hljs-number"><span class="hljs-number">48.99</span></span> <span class="hljs-number"><span class="hljs-number">1.63</span></span> <span class="hljs-number"><span class="hljs-number">195.89</span></span> <span class="hljs-number"><span class="hljs-number">8.15</span></span> <span class="hljs-number"><span class="hljs-number">6.60</span></span></code> </pre><br>  The first block is the measurement for the period of work since the start.  The rest of the time specified interval. <br><br>  We run this logging on a certain interval (for example, a couple of days, and then we ask to send a log. <br><br><h4>  Analysis </h4><br>  Well, according to these figures can be said? <br><br>  First of all, pay attention to the last column% util.  If only because the large value of this parameter (90% -100%) for the user looks like a ‚Äúserver hangs‚Äù.  We have sda ‚Äã‚Äãloaded less than 9%.  Fine.  And basically the section sda7 (SQL). <br><br>  Further write / read options: <br><br><ol><li>  column capacity rkB / s, wkB / s.  We write 219 KB / s </li><li>  iops r / s columns, w / s - 10.5 requests per second </li><li>  request processing time: await - 156 ms, of which the actual execution of svctm is 8 ms </li></ol><br><br>  What it says: <br>  The disk is not loaded, the numbers are not large.  But requests stand in a queue for 200ms, the time is acceptable, but at ‚Äúthe first shukher will crack,‚Äù the subsystem itself is lousy.  Although it is impossible to say unequivocally?  for again, the disk is not heavily loaded, and in no hurry to send data from the queue. <br><br>  What else is useful: rrqm / s, wrqm / s is the actual number of requests that applications were asked to perform, but the system was able to combine them into blocks, on average, avgrq-sz bytes. <br><br>  These figures will help to optimize the application: <br><ul><li>  If you open 100,500 files, start randomly jumping through open files and doing other extras, eat out the system cache - r / s, w / s will start to rrqm / s and wrqm / s, and avgrq-sz to fall.  This is a situation of pure Random Access - the slowest disk usage scenario. </li><li>  And if everything is consistent, then they will strive for edinichke (and preferably to zero), and avgrq-sz grow.  The only request per interval is pure water. Sequential Access is the fastest disk usage scenario. <br></li></ul><br><br>  It is clear that it is always difficult, and often impossible, to achieve consistent work, but by comparing these figures, it is possible to evaluate whether the change in the logic of working with a disk has improved or worsened the load on it. <br><br><h5>  Charts </h5><br>  Actually watching the log eyes with his eyes - ungrateful.  Therefore, I wrote several ‚Äúscripts‚Äù of bash and gnuplot, a little bit of logging and plotting. <br><br>  Plotting one device for the 1st parameter plus smooth bezier: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #echo "usage: $0 &lt;iostat.log&gt; &lt;disk name&gt; &lt;out.png&gt; &lt;title&gt; &lt;yaxis-title&gt; &lt;column1&gt; &lt;title1&gt; echo "procesing $1 for device $2, plotting $3 ($4 - $7)" cat $1 | grep "$2 " &gt; dat.dat gnuplot &lt;&lt;_EOF_ set terminal png set output "$3" set title "$4" set xdata time set timefmt "%Y-%m-%d %H:%M:%S" set format x "%H:%M\n%d/%m" set xtics nomirror scale 3,2 set ylabel "$5" set samples 60 plot "dat.dat" using 1:$6 title "$7" with impulses, \ "dat.dat" using 1:$6 title "$7 avg" smooth bezier lw 2 _EOF_ rm dat.dat</span></span></code> </pre><br><br>  And the same schedule for one device by 2 parameters: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo "procesing $1 for device $2, plotting $3 ($4 - $7, $9)" cat $1 | grep "$2 " &gt; dat.dat gnuplot &lt;&lt;_EOF_ set terminal png set output "$3" set title "$4" set xdata time set timefmt "%Y-%m-%d %H:%M:%S" set format x "%H:%M\n%d/%m" set xtics nomirror scale 3,2 set ylabel "$5" set samples 10 plot "dat.dat" using 1:$6 title "$7" with lines, \ "dat.dat" using 1:$8 title "$9" with lines _EOF_ rm dat.dat</span></span></code> </pre><br><br>  Well, since there are a lot of devices, and there are several servers, and laziness to start with pens, I wrote a couple more primitive scripts: plot_info.sh <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo "usage: $0 &lt;n&gt; &lt;flitle&gt; &lt;title&gt; &lt;y-axis&gt; &lt;column1&gt; &lt;column-title&gt; &lt;column2&gt; &lt;column-title&gt;" echo "$0 2 rw 'Read/write iops per second' 'iops' 4 'read request/s' 5 'write request/s'" #/dev/cciss/c0d0p1 20G 12G 7.2G 61% / #/dev/cciss/c0d0p6 476G 213G 239G 48% /ARCHIVE #/dev/cciss/c0d0p5 9.7G 264M 8.9G 3% /var #/dev/cciss/c0d0p3 9.7G 167M 9.0G 2% /TMP #/dev/cciss/c0d1p1 559G 39G 521G 7% /SQL #/dev/cciss/c0d2p2 1020G 320G 701G 32% /SQL/file #/dev/cciss/c0d2p1 98G 1.9G 96G 2% /SQL/pgsql/data/pg_xlog ./graph$1.sh ./log201.txt c0d0p2 201/c0d0p2.swap.$2.png "swap $3" "$4" "$5" "$6" "$7" "$8" ./graph$1.sh ./log201.txt c0d0p3 201/c0d0p3.tmp.$2.png "/TMP $3" "$4" "$5" "$6" "$7" "$8" ./graph$1.sh ./log201.txt c0d1p1 201/c0d1p1.sql.$2.png "/SQL $3" "$4" "$5" "$6" "$7" "$8" ./graph$1.sh ./log201.txt c0d2p1 201/c0d2p1.pg_xlog.$2.png "pg_xlog $3" "$4" "$5" "$6" "$7" "$8" ./graph$1.sh ./log201.txt c0d1 201/dev.c0d1-sql.$2.png "dev:/SQL $3" "$4" "$5" "$6" "$7" "$8" ./graph$1.sh ./log201.txt c0d2 201/dev.c0d2-xlog_file.$2.png "dev:pg_xlog+file $3" "$4" "$5" "$6" "$7" "$8"</span></span></code> </pre><br>  and task.sh <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash ./plot_info.sh 3 iops_load 'Estimated IOPS' 'iops_limit' '(100*($7+$6)/$14)' 'iops' ./plot_info.sh 0 wrratio 'Write percent' 'wratio' '($9*100/($10+$9))' '%' ./plot_info.sh 0 qwaitratio 'Queue wait ratio' 'qwaitratio' '($13*100/$12)' '%' ./plot_info.sh 2 rwqm 'Request merged and queued to device' 'rqm/s' 4 'read rqm/s' 5 'write rqm/s' ./plot_info.sh 2 request 'Request issued to device' 'requests' 6 'r/s' 7 'w/s' ./plot_info.sh 2 rwspeed 'Read/write speed (kB per sec)' 'speed' 8 'read kB/s' 9 'write kB/s' ./plot_info.sh 1 rsize 'Average request size' 'avgrq-sz' '($10*4)' 'kB' ./plot_info.sh 1 qsize 'Average query size' 'avgqu-sz' 11 'queries' ./plot_info.sh 2 await 'Average request servicing time' 'await' "'12'" 'waiting msec' 13 'servicing msec' ./plot_info.sh 1 util 'Bandwidth utilization' '%util' 14 '%' ./plot_info.sh 1 iops 'Average IOPS' 'iops' "'7+6'" 'iops'</span></span></code> </pre><br><br>  For the code, please do not kick it was written to work quickly and on the knee (for which the actual scripts were invented by smart people). <br><br>  As a result, we get nice graphics. <br><img src="http://habrastorage.org/storage2/fce/6e2/00f/fce6e200f037fb62faa693480d0b0f19.png"><br><img src="http://habrastorage.org/storage2/6d8/0fc/f30/6d80fcf301ed38e7cb52fed03ccc1004.png"><br><img src="http://habrastorage.org/storage2/845/6ab/aa6/8456abaa66bbd1fcb1d278b313b1ccf3.png"><br><br><h5>  Summarizing </h5><br>  As a summary, a couple of ‚Äúsuccessful stories‚Äù <br><br>  Usually the user has only one symptom: everything slows down.  Below I will give examples of how the analysis of logs iostat helped to identify the problem, or indicate that the problem is not in the disk. <br><br><h6>  First story </h6><br>  In iostat, we saw abnormally high rKB / s values ‚Äã‚Äãwhen executing the simplest queries, including queries with LIMIT 1 (tens and hundreds of megabytes) - we clearly read more than necessary. <br>  From this, we could eventually show that we did not work out the auto-vacuum (although it was launched).  A further vacuum log showed that max_fsm_page is two orders of magnitude lower than necessary. <br><br><h6>  Second story </h6><br>  A long commit transaction of the order of 60 seconds containing a total of a dozen DDL queries.  All sinned at a high "background" load, and this type of brakes.  But iostat showed in every way that at that time there was no additional anomalous load on the disk.  As a result, the PostgreSQL 8.3 DBMS is connected with a large number (pool) of unused connections ... <br><br><h5>  A little about what it is all about </h5><br>  It so happened that the product we are developing includes some kind of storage based on PostgreSQL DBMS.  And this database lives without any supervision from the DBA, and our support does not give access to it either.  There are a few dozens of clients reading this database.  But the record clients, though not many (up to a hundred), they only write 24/7 when hundreds of records per second, and when a thousand or another.  Well, as the great Murphy bequeathed - everything always works on a synthetic lab in the test lab, but in the field on real data "everything is terribly slow." <br><br>  As a result, the problem arises of collecting the information about the operation of the complex from the fields by phone and finding out what it is missing.  And these hands are usually unqualified, the maximum run PuTTY and WinSCP, some sort of skriptik, send logs.  On more you can not count on. <br><br>  Another question - the complex is complex, there is no excess iron.  Of course, you can add additional software, but we all understand that even free software is not free, and the customer does not want to pay for additional installation, configuration and support.  And again, an extra component in the system does not contribute to an increase in reliability. <br><br>  As a result, we have: <br>  Server level HP DL380G7 with PostgreSQL DBMS living on it and tying from every client written in C ++. <br>  An operating system based on truncated Fedora or CentOS distributions. <br>  Storage on the basis of a normal RAID controller with a dozen SAS screws. <br>  Of the utilities, only the very minimum is available, including iostat and gnuplot. </div><p>Source: <a href="https://habr.com/ru/post/165855/">https://habr.com/ru/post/165855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165843/index.html">I'll give you a phone</a></li>
<li><a href="../165845/index.html">Click-n-fire interface - sniper rifle with Linux on board</a></li>
<li><a href="../165847/index.html">What is stopping innovation in Silicon Valley?</a></li>
<li><a href="../165849/index.html">Music sales make up only 6% of the musician's income.</a></li>
<li><a href="../165853/index.html">LogicDiscovery - simple logic analyzer</a></li>
<li><a href="../165857/index.html">Poster of the structure of Windows Azure services in Russian</a></li>
<li><a href="../165861/index.html">Control decorative lighting on Arduino from your phone</a></li>
<li><a href="../165863/index.html">Swedish school introduces compulsory Minecraft lessons</a></li>
<li><a href="../165865/index.html">Seminar-meeting "e-Estonia - the way to Europe!" # 2</a></li>
<li><a href="../165869/index.html">Whois: practical user guide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>