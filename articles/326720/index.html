<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Record a WebRTC video stream from a webcam browser towed to Amazon S3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Amazon S3 is a file cloud storage used by such well-known services as Dropbox, Trello and millions of other projects. Despite the failure of February ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Record a WebRTC video stream from a webcam browser towed to Amazon S3</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/19e/c2b/f27/19ec2bf27fa34ec5af0fa9b98b1124bc.png"></div><br>  <b>Amazon S3</b> is a file cloud storage used by such well-known services as Dropbox, Trello and millions of other projects.  Despite the failure of February 28, 2017, as a result of which even refrigerators stopped working in some places, S3 is probably the most popular distributed storage in which users and businesses store photos, videos, backups and other useful content. <br><br>  <b>Web Call Server</b> is a media server supporting WebRTC technology and recording video streams from browsers and mobile devices.  An HTML page in a browser or mobile application can capture a video stream from a webcam and send it to the server for further retransmission and recording. <br><br>  In this article we will explain how to record a video stream from the page of Google Chrome browser and then send the mp4 file to the Amazon S3 storage. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  S3 storage preparation </h2><br>  With the S3 storage, everything worked out pretty quickly, because  There was a ready AWS account.  In order to start working with the storage, we create a <b>Bucket</b> - this is a virtual folder-path into which the files will be added. <br><br>  Go to S3 and click <b>Create Bucket</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/60c/754/f1f/60c754f1f63849a68e05f20badedca01.png"></div><br>  We select the EU (Frankfurt) region and one user (myself) with read and write rights. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b07/723/fd9/b07723fd9e1e4d70898442b61226abce.jpg"></div><br>  Further proposed to include various options.  But we needed a simple recording.  Therefore, all options are left in <b>Disabled</b> state. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/268/f33/c4e/268f33c4e3b14eceba465768a150fc7c.jpg"></div><br>  Next you need to decide on access rights.  They are also left by default. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d7f/729/52a/d7f72952a5d24a7b8096623701c2f70e.jpg"></div><br>  Is done.  It remains to check everything and click <b>Next</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/280/fb3/dae/280fb3daebae497b955afdf25f26e378.jpg"></div><br>  Thus, in 4 steps we made S3 cloud storage, which you can pour photos, backups, and much more. <br><br><h2>  Record video stream from browser </h2><br>  The video stream is transmitted to the server from the <b>HTML / JavaScript</b> page and recorded on the server in <b>mp4</b> format. <br><br>  In the screenshot, a connection is made to the server using the wss (Websockets SSL) protocol and then the WebRTC video stream is sent to the server and shows the status PUBLISHING. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ce7/92a/786/ce792a786af340b298cb891d6f9f5950.png"></div><br>  If you click the <b>Stop</b> button, the stream will stop streaming, and an mp4 file will be recorded on the server, which you can immediately download by clicking the link. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1dc/d86/f47/1dcd86f4795d44b2a290216a2d4f7d8f.png"></div><br>  The downloaded file can be played in a regular player.  For example <b>VLC</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1c1/d1e/771/1c1d1e771edc4468b787116f0c3a6a30.png"></div><br>  It can also be found on the server in the <b>/ usr / local / FlashphonerWebCallServer / records</b> folder <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/eb0/123/6c0/eb01236c0c1a445da44e5fb7a360b701.png"></div><br><h2>  We test unloading on S3 </h2><br>  To begin, let's learn how to upload files in S3 with a regular <b>bash script</b> .  In the future, you can choose a more convenient way and use special utilities from AWS. <br><br>  Googling, we found two scripts to upload files to Amazon S3: the <a href="https://gist.github.com/chrismdp/6c6b6c825b07f680e710">first</a> and <a href="">second</a> . <br><br>  C first had problems, namely: <br>  <b>You are not supported.</b>  <b>Please use AWS4-HMAC-SHA256.</b> <br><br>  The second script solves the authentication problem, so we stopped at it.  The script had to be modified quite a bit and its modified version is <a href="">here</a> . <br><br>  The modified script works like this: <br><br><pre><code class="bash hljs">./S3-AWS4-Upload.sh /tmp/11/hellos3.txt</code> </pre> <br>  Those.  just sends the specified file to the repository. <br><br>  <b>Minor edits made:</b> <br><br>  1. Accept the file path as an argument <br><br><pre> <code class="bash hljs">FILE_TO_UPLOAD=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> STARTS_WITH=$(basename <span class="hljs-variable"><span class="hljs-variable">$FILE_TO_UPLOAD</span></span>)</code> </pre> <br>  2. Denote the working folder and take the ACCESS KEY and SECRET KEY from this folder <br><br><pre> <code class="bash hljs">WORK_DIR=/tmp/11 AWS_SECRET_KEY=$(cat <span class="hljs-variable"><span class="hljs-variable">$WORK_DIR</span></span>/AWS_SECRET_KEY) AWS_ACCESS_KEY=$(cat <span class="hljs-variable"><span class="hljs-variable">$WORK_DIR</span></span>/AWS_ACCESS_KEY)</code> </pre> <br>  3. Move the date away to the future <br><br><pre> <code class="bash hljs">EXPIRE=<span class="hljs-string"><span class="hljs-string">"2018-01-01T00:00:00.000Z"</span></span></code> </pre> <br>  4. Add a region to the path. $ REQUEST_REGION <br><br><pre> <code class="bash hljs">-F <span class="hljs-string"><span class="hljs-string">"file=@"</span></span><span class="hljs-variable"><span class="hljs-variable">$FILE_TO_UPLOAD</span></span> http://<span class="hljs-variable"><span class="hljs-variable">$BUCKET</span></span>.s3.<span class="hljs-variable"><span class="hljs-variable">$REQUEST_REGION</span></span>.amazonaws.com/</code> </pre> <br>  Thus, in our working folder 4 files are now stored, two of which are keys, and the file <b>hellos3.txt</b> for test <b>submission</b> . <br><br>  / tmp / 11 <br>  AW‚îÄ‚îÄ AWS_ACCESS_KEY <br>  AW‚îÄ‚îÄ AWS_SECRET_KEY <br>  Hel‚îÄ‚îÄ hellos3.txt <br>  S‚îÄ‚îÄ S3-AWS4-Upload.sh <br><br>  Keys can be generated in the Account menu - <b>My Security Credentials</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/11f/e2a/df1/11fe2adf12804cf0a6269ee4353b2bce.png"></div><br>  The keys themselves look like this: <br><br>  <b>Access Key ID:</b> <br>  BPIAI3TGFDI3ZPTABBIA <br><br>  <b>Secret Access Key:</b> <br>  RPnmmrUf5FOPs2as4XghOMfsbkatqSdUO16Um91r <br><br>  As a result of the successful work of the script, we get the file hellos3.txt loaded on S3.  From here you can already download, distribute, etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/141/ef7/de8/141ef7de82d643a098c9e10b77f36bfd.png"></div><br>  As a result, we have successfully tested uploading a file to S3 with a regular bash script and can send any file to S3 if we have its full path. <br><br><h2>  We pull the hook and send the recorded video stream to Amazon S3 </h2><br>  After clicking the Stop button, the stream sending to the server is stopped and the mp4 file is created on the server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4cc/118/d73/4cc118d73ec945a5bafb406b66a396ac.png"></div><br><br>  Next, the server calls the <b>on_record_hook.sh</b> bash script and passes the file path to this script with the <b>second parameter</b> . <br><br><pre> <code class="bash hljs">/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/FlashphonerWebCallServer/bin/on_record_hook.sh</code> </pre> <br>  Let's change the script so that it <b>sends the recorded file to Amazon S3</b> and wrote a message to the log for debugging: <br><br><pre> <code class="bash hljs">STREAM_NAME=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> FILE_PATH=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp/11 ./S3-AWS4-Upload.sh <span class="hljs-variable"><span class="hljs-variable">$FILE_PATH</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Record complete. Sent to S3. </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$FILE_PATH</span></span></span><span class="hljs-string">"</span></span> &gt;&gt; /tmp/log.txt</code> </pre> <br>  As a result, an <b>mp4</b> file is added to the file list, which can be downloaded, now from S3 and see. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d59/843/170/d59843170c77437092cad02e76e91349.png"></div><br><h2>  Minimum HTML / JS code for recording video stream </h2><br>  On the HTML page, the main element is the <b>localVideo</b> video capture window.  This is a simple div block that displays video captured from a webcam. <br><br>  Page <b>stream-recording.html</b> <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stream-recording.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onLoad</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init()"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>The streamer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px;border: 1px solid"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start()"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stop"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stop()"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"status"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The <b>stream-recording.js</b> script consists of 48 lines. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> localVideo; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Flashphoner.init(); localVideo = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"localVideo"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ stream.stop(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>: <span class="hljs-string"><span class="hljs-string">"wss://wcs5-eu.flashphoner.com:8443"</span></span>}).on(Flashphoner.constants.SESSION_STATUS.ESTABLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">session</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//session connected, start streaming startStreaming(session); }).on(Flashphoner.constants.SESSION_STATUS.DISCONNECTED, function () { setStatus("DISCONNECTED"); }).on(Flashphoner.constants.SESSION_STATUS.FAILED, function () { setStatus("FAILED"); }); } function startStreaming(session) { stream = session.createStream({ name: "stream222", display: localVideo, cacheLocalResources: true, receiveVideo: false, receiveAudio: false, record: true }); stream.on(Flashphoner.constants.STREAM_STATUS.PUBLISHING, function (publishStream) { setStatus(Flashphoner.constants.STREAM_STATUS.PUBLISHING); }).on(Flashphoner.constants.STREAM_STATUS.UNPUBLISHED, function (stream) { setStatus(Flashphoner.constants.STREAM_STATUS.UNPUBLISHED + " " + stream.getRecordInfo()); }).on(Flashphoner.constants.STREAM_STATUS.FAILED, function () { setStatus(Flashphoner.constants.STREAM_STATUS.FAILED); }); stream.publish(); } function setStatus(status) { document.getElementById("status").innerHTML = status; }</span></span></code> </pre> <br>  The script establishes a connection to the server and begins capturing from a webcam and publishing the stream to the server using the <b>Start</b> button.  Using the <b>Stop</b> button, the stream finishes publishing and displays the name of the recorded file. <br><br>  1) Establish a connection to the server using <b>Flashphoner.createSession ()</b> <br><br><pre> <code class="javascript hljs">Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>: <span class="hljs-string"><span class="hljs-string">"wss://wcs5-eu.flashphoner.com:8443"</span></span>});</code> </pre> <br>  2. Create a video stream with the recording function: <b>record: true</b> and send the video stream to the server using the <b>stream.publish ()</b> method <br><br><pre> <code class="javascript hljs">session.createStream({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"stream222"</span></span>, <span class="hljs-attr"><span class="hljs-attr">display</span></span>: localVideo, <span class="hljs-attr"><span class="hljs-attr">cacheLocalResources</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">receiveVideo</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">receiveAudio</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">record</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }).publish();</code> </pre> <br>  3. Display the name of the mp4 file at the end of the broadcast and the status of UNPUBLISHED <br><br><pre> <code class="javascript hljs">stream.on(Flashphoner.constants.STREAM_STATUS.UNPUBLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">) </span></span>{ setStatus(Flashphoner.constants.STREAM_STATUS.UNPUBLISHED + <span class="hljs-string"><span class="hljs-string">" "</span></span> + stream.getRecordInfo()); });</code> </pre> <br>  Total for successful streaming and video stream recording, three files are needed: <br><br><ul><li>  stream-recording.html </li><li>  stream-recording.js </li><li>  flashphoner.js </li></ul><br>  Scripts can be downloaded <a href="">here</a> . <br><br>  The flashphoner.js file can be found in the WCS <a href="https://flashphoner.com/wcs-web-sdk">Web SDK</a> . <br><br><h2>  We are testing the video recording code </h2><br>  The recording process in the Google Chrome browser from the <b>stream-recording.html</b> page looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/614/825/f61/614825f6162a45278c9180488332f010.png"></div><br>  After stopping the video stream, we get the name of the recorded file in mp4 format. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8ed/c04/107/8edc04107136449586a97814d6eec394.png"></div><br>  This file is available on the server in the <b>/ usr / local / FlashphonerWebCallServer / records</b> folder <br><br>  In addition, if we properly designed the <b>on_record_hook.sh</b> script, then the same file will be uploaded to <b>Amazon S3</b> . <br><br>  Thus, we created a repository in Amazon S3, tested a simple bash script to upload files to the repository, and wrote HTML + JS code that captures the video stream from a webcam and writes it to the server and then sends it to S3. <br><br><h2>  Links </h2><br>  <a href="https://aws.amazon.com/ru/s3/">Amazon S3</a> - Cloud File Storage <br>  <a href="">S3-AWS4-Upload.sh</a> - source bash-script for uploading a file to the storage <br>  <a href="">S3 full</a> - a full set of modified files for uploading to Amazon S3. <br>  <a href="">Stream recording</a> - html and js scripts for broadcasting to the server and recording from the browser. <br>  <a href="https://flashphoner.com/wcs-web-sdk">Web SDK</a> - a set of js scripts for working with video streams.  Contains flashphoner.js, which is used in the example. <br>  <a href="https://flashphoner.com/">Web Call Server</a> - WebRTC media server with support for recording video streams from the browser. </div><p>Source: <a href="https://habr.com/ru/post/326720/">https://habr.com/ru/post/326720/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326706/index.html">From Rails 4 to Rails 5: how it was</a></li>
<li><a href="../326712/index.html">The composition of protocols for injection dependencies</a></li>
<li><a href="../326714/index.html">Source Code Analysis and Prince of Persia Copy Protection</a></li>
<li><a href="../326716/index.html">Native ECMAScript Modules - First Review</a></li>
<li><a href="../326718/index.html">Go to your personal account on zakupki.gov.ru without Internet Explorer and other useful tips when working with CryptoPro</a></li>
<li><a href="../326722/index.html">Methods for circumventing web application security tools when operating XSS vectors</a></li>
<li><a href="../326724/index.html">Corporate portal. What is it? What for? Who and when?</a></li>
<li><a href="../326726/index.html">Conjuring technical interview</a></li>
<li><a href="../326728/index.html">Visualizing Interface Animation Requirements</a></li>
<li><a href="../326732/index.html">Lync SDK 2013. Rethinking the experience of developing your own Lync-based instant messenger (Skype for Business)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>