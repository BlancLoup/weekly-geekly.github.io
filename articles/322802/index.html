<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I got into the PayPal server through a bug in downloading files and got access to remote code execution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pentester (penetration tester) tells how he managed to find a bug in downloading files and penetrate the PayPal payment system server. 



 Hello to a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I got into the PayPal server through a bug in downloading files and got access to remote code execution</h1><div class="post__text post__text-html js-mediator-article"> <i>Pentester (penetration tester) tells how he managed to find a bug in downloading files and penetrate the PayPal payment system server.</i> <br><br><img src="https://habrastorage.org/web/858/01c/1bd/85801c1bd0034e21bb89de69375d2bfa.png" alt="image"><br><br>  Hello to all! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Hope you are doing well.  I am sure that the title surprised you a lot, and you rushed here to see if I really could get remote access not just anywhere, but to the PayPal server. <br><br>  In fact, it was quite a simple hack aimed at checking vulnerability (the so-called POC).  The only moment I was lucky with was finding and successfully defining a vulnerable domain. <br><a name="habracut"></a><br><img src="https://habrastorage.org/web/514/f05/391/514f05391aa74e53b82283dc1530335e.gif" alt="image"><br><br>  Let's start with a little background.  As you could see earlier in my previous post, I recently passed the <a href="https://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/">OSCP certification exam</a> .  It really took me a lot of days and nights of hard work - almost 4 months of focused training and no search for bugs, that is, in fact, no earning of pocket money. <br><br>  Normal people: a weekend full of booze, parties, fun, hangovers and other things.  Questions like: ‚ÄúDid you watch the new Spider-Man?‚Äù  Game of Thrones? ‚Äù <br><br>  People like me: <br><br><img src="https://habrastorage.org/web/118/90d/0a5/11890d0a55d94d758ae6a86dc5b58673.gif" alt="image"><br><br>  So, one weekend, looking at some blogs and videos on YouTube, I came across the material on PayPal, thought to go to their page to promote the bug search promotion using Burp and found the following: <br><br><img src="https://habrastorage.org/web/1fb/e97/03f/1fbe9703fb004c60b5b6c9a8e919fda1.png" alt="image"><br><br>  The screenshot shows the usual response from <a href="http://paypal.com/bugbounty/">http://paypal.com/bugbounty/</a> .  Looking closely, you can see a curious list of PayPal domains in the Content Security Policy response header.  I was interested in <a href="">https: //*.paypalcorp.com</a> .  This is a typical approach that I use to catch bugs.  I am looking for as many working subdomains as possible for the final goal, since they are usually left without proper attention, and, like me, as a result, they find something there. <br><br>  You can use <a href="https://github.com/TheRook/subbrute">Subbrute</a> , <a href="https://github.com/guelfoweb/knock">Knockpy</a> , <a href="https://github.com/jhaddix/domain">enumall</a> or other similar utilities.  I usually do this, but on this weekend laziness got the better of it and I scanned them in VirusTotal.  The final list can be found <a href="https://www.virustotal.com/en/domain/paypalcorp.com/information/">here</a> . <br><br>  I copied the list of subdomains to the local machine, launched dig -f paypal + noall + answer to get a convenient picture of where all the subdomains actually point to. <br><br><img src="https://habrastorage.org/web/e28/4e6/e40/e284e6e407e3488293d0c2fa802cccc9.png" alt="image"><br><br>  One of them, brandpermission.paypalcorp.com, pointed to <a href="https://www.paypal-brandcentral.com/">https://www.paypal-brandcentral.com/</a> - a site for registering requests to PayPal‚Äôs online support service for vendors, suppliers and partners, through which they request permission to use the brand.  The system is available to download the draft versions of logos and graphics at the time of the request. <br><br>  The reaction of any bug hunter who saw the file upload form: <br><br><img src="https://habrastorage.org/web/5eb/0d5/301/5eb0d5301e8e4c4bb143dc85c47c9892.jpg" alt="image"><br><br>  <font color="#808080"><i>Smells catch</i></font> <br><br>  Therefore, for starters, I created a ‚Äúticket‚Äù by uploading a simple image called finished.jpg.  It got to the server under the name finished_thumb.jpg along the path / content / helpdesk / 368/867 /.  I quickly checked whether the file that we sent through the form named finished.jpg was loaded and yes, fortunately (this fact will play its role later) he was there. <br><br>  Next, I learned a little about how the application works: how it loads files, where they go to, what name patterns for files and folders are accepted in it.  It became clear that the catalog 368 was named so by the number of the ticket I created, and 867 - the identifier of the folder in which all the files associated with it are stored, that is, various graphic materials attached to the ticket. <br><br>  I quickly repeated the same actions, created another appeal, from which it became clear that the ticket identifiers and folders are serially generated.  Created another ticket, but this time uploaded a file with the .php extension, containing a simple single-line script for the command line: <br><br><img src="https://habrastorage.org/web/35c/2c4/e6c/35c2c4e6c4fd4772b315aaa2cfe4783f.png" alt="image"><br><br>  The script returned 302 code (that is, in fact, 200 OK).  This meant that the application did not do any checks on file types, content, and other things.  There is!  My face at this moment: <br><br><img src="https://habrastorage.org/web/6e5/0a6/9d8/6e50a69d8f754fc1a70b062762c8c8ae.jpg" alt="image"><br><br>  <font color="#808080"><i>Come on...</i></font> <br><br>  After seeing the 302 code, I rushed to open a new ticket to copy the link as it was in the case of loading an image file.  But when sending .php see the path of the downloaded file was impossible.  The only thing you could know was the ticket number.  What to do next? <br><br><img src="https://habrastorage.org/web/6d5/905/89c/6d590589c3ac41f5a5d8a0cb17211585.gif" alt="image"><br><br>  <font color="#808080"><i>And now ...</i></font> <br><br>  Having received the ticket number (366 in this case), we will know the name of the directory where our ‚Äúgraphic examples‚Äù were loaded.  All that is missing is the folder identifier where the file falls into (since we cannot see the php file when viewing the source code of the page as it is possible with images). <br><br>  But we know the name of the file - success.php (since we checked before that example.jpg was in the same folder as example_thumb.jpg). <br><br>  So, despite the fact that when loading and processing success.php in success_thumb.php, the code of the first one was ‚Äúeaten‚Äù, success.php, however, it still exists on the server and can be accessed.  We also know the folder ID (867), obtained when loading a previously simple image.  The ticket number for downloading the verification php is 366. <br><br>  Why not just mess up the folder IDs where the downloaded file is stored? <br><br><img src="https://habrastorage.org/web/b51/716/ef8/b51716ef85c648f0b48637bae0515d9c.jpg" alt="image"><br><br>  <font color="#808080"><i>You can not just take and zabrutass</i></font> <br><br>  Therefore, I quickly launched the following search with identifiers 500-1000 in Intruder: <br>  <a href="https://www.paypal-brandcentral.com/content/_helpdesk/366/%2524(bruteforced">https://www.paypal-brandcentral.com/content/_helpdesk/366/$(brutecent</a> 500-1000) $ / success.php.  As a result, 200 code was received on the identifier 865. <br><br><img src="https://habrastorage.org/web/18e/ee8/4f7/18eee84f7fb54defa2ef4dacb6357ca1.png" alt="image"><br>  My reaction: <br><br><img src="https://habrastorage.org/web/fb5/88f/aa9/fb588faa9c9c41fd8b0e6b38fb63844b.gif" alt="image"><br><br>  Cool!  Now, when we found out the catalog directory with the file, let's try to execute the code: <a href="https://www.paypal-brandcentral.com/content/_helpdesk/366/865/success.php%3Fcmd%3Duname-a%3Bwhoami">https://www.paypal-brandcentral.com/content/_helpdesk/366/865/success.php?cmd=uname-a;whoami</a> <br><br><img src="https://habrastorage.org/web/36b/518/16b/36b51816bac24393bba617d8fc89edba.png" alt="image"><br><br>  A little magic cat / etc / passwd to make sure that the possibility of remote code execution really is: <br><br><img src="https://habrastorage.org/web/1a2/a7c/459/1a2a7c459ec540e1973db3a2d5e28465.png" alt="image"><br><br>  The server also had an authorization page for PayPal employees. <br><br>  Hope you enjoyed this stuff!  I would really appreciate feedback in the comments;) <br><br>  Chronology of processing treatment: <br>  ~ July 8, 2017 18:03 - Report a bug to PayPal <br>  ~ July 11, 2017 18:03 - Bug fixed <br>  ~ July 25, 2017 3:30 - Received an award <br><br>  But wait!  The story does not end there.  Here is some more seed material.  I will tell about it in my blog on the following weekend: <br><br><img src="https://habrastorage.org/web/ed2/fa5/0b3/ed2fa50b359b4617b7d3289fb53a458e.png" alt="image"><br><br>  I reported the same vulnerability at different points in the application.  One of the messages was quite obvious, so they were combined into one message, and the second was marked as duplicate. <br><br> <a href="https://fondy.ru/"><img src="https://habrastorage.org/files/a73/9a7/874/a739a7874a5c433786b0fe99e6f56c0b.PNG" alt="image"></a> <br><br>  <b>From the translator:</b> <br>  At the time of publication of the translation, the site <a href="https://www.paypal-brandcentral.com/">www.paypal-brandcentral.com</a> became unavailable, giving an HTTP 500 error. Probably the publication of the original article served as a source for detecting more serious vulnerabilities by other researchers. <br><br><img src="https://habrastorage.org/web/111/bef/d71/111befd71b3c41e79b483f9a465385e4.png"></div><p>Source: <a href="https://habr.com/ru/post/322802/">https://habr.com/ru/post/322802/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322792/index.html">How Amazon affects payments</a></li>
<li><a href="../322794/index.html">The unpleasant truth about Apple Pay</a></li>
<li><a href="../322796/index.html">How Virtual Reality Transforms Customer Experience</a></li>
<li><a href="../322798/index.html">31 facts about the early history of the US dollar</a></li>
<li><a href="../322800/index.html">Starbucks should open public access to its API.</a></li>
<li><a href="../322804/index.html">Choosing the right error handling strategy (parts 3 and 4)</a></li>
<li><a href="../322806/index.html">A bit about functors and higher order functions in Swift</a></li>
<li><a href="../322812/index.html">The real hero in the programming world: who is he?</a></li>
<li><a href="../322814/index.html">Updating the application code on a running server</a></li>
<li><a href="../322816/index.html">Automated testing of bots for Telegram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>