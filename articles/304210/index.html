<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>On the relative brightness, or how tenacious is Legacy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am sure that many programmers are familiar with the formula: 


 And the one who worked closely with graphics, knows these numbers literally by hear...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>On the relative brightness, or how tenacious is Legacy</h1><div class="post__text post__text-html js-mediator-article">  I am sure that many programmers are familiar with the formula: <br><br><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/Y%20%3D%200.299%20R%20%2B%200.587%20G%20%2B%200.114%20B" alt="Y = 0.299 R + 0.587 G + 0.114 B"></div><br>  And the one who worked closely with graphics, knows these numbers literally by heart - as in the olden days enikeyschiki remembered the serials of Windows.  Sometimes the coefficients are rounded to the second digit, sometimes they are refined to the fourth, but the canonical form is exactly that. <br><br>  It calculates the relative brightness of the color (relative luminance or in some contexts luma; not to be confused with lightness and brightness) and is widely used to convert a color RGB image into a Grayscale and related tasks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The formula is replicated and cited in thousands of articles, forum discussions and responses to StackOverflow ... But the fact is that its only correct place is in the history dump.  <b>It can not be used.</b>  However, use. <br><br>  But why not?  And where did these coefficients come from? <br><a name="habracut"></a><br><h2>  Mini-excursion into history </h2><br>  There is an international organization that develops recommendations (de facto standards) for the field of television and radio communications - <a href="https://en.wikipedia.org/wiki/International_Telecommunication_Union">ITU</a> . <br><br>  The parameters we are interested in are spelled out in the recommendations of <a href="https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.601-7-201103-I!!PDF-E.pdf">ITU-R BT.601</a> , adopted in 1982 (following the updated edition link).  Already at this moment you can be a bit surprised - where are we and where is the 82nd year?  But this is only the beginning. <br><br>  The tsiferki moved there from the recommendations of <a href="https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.470-6-199811-S!!PDF-E.pdf">ITU-R BT.470</a> from 1970 (the updated version is also available by reference). <br><br>  And they, in turn, are the legacy of the <a href="https://en.wikipedia.org/wiki/YIQ">YIQ</a> color model, which was developed for the North American television <a href="https://en.wikipedia.org/wiki/NTSC">system NTSC</a> in 1953!  For today's computers and gadgets, it has a little more than no relation. <br><br>  Doesn't anyone remind a bike about the connection of space ships with the width of an ancient Roman horse ass? <br><br>  Modern colorimetric parameters began to crystallize in 1970 with the modernization of PAL / SECAM systems.  Around the same time, the Americans came up with their <a href="https://en.wikipedia.org/wiki/NTSC">SMPTE-C</a> specification for similar phosphors, but NTSC switched to them only in 1987.  I do not know for sure, but I suspect that the very fact of the birth of the notorious Rec.601 is explained precisely by this delay - after all, by and large, they are already morally outdated by the time of their appearance. <br><br>  Then in 1990, new recommendations <a href="http://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.709-6-201506-I!!PDF-E.pdf">ITU-R BT.709</a> happened, and in 1996, based on them, the standard sRGB was invented, which captured the world and reigns (in the consumer sector) to this day.  Alternatives to it exist, but they are all in demand in narrowly specific areas.  And 20 years have passed, and no less, is it not time to finally get rid of atavisms? <br><br><h2>  So what exactly is the problem? </h2><br>  Someone might think that those coefficients reflect certain fundamental properties of human vision and therefore do not have a statute of limitations.  This is not entirely true - among other things, the coefficients are tied to the <i>technology of color reproduction</i> . <br><br>  Any RGB-space (and YIQ is the conversion over the RGB model) is determined by three basic parameters: <br><br>  1. The chromatic coordinates of the three primary colors (they are called primaries); <br>  2. Chromatic coordinates of the white point (white point or reference white); <br>  3. Gamma Correction. <br><br>  Chromatic coordinates are usually set in the <a href="https://en.wikipedia.org/wiki/CIE_1931_color_space">CIE xyY</a> system.  The case of letters is important in this case: the string <b>xy</b> correspond to the coordinates on the chromatic diagram (the well-known ‚Äúhorseshoe‚Äù), and the capital <b>Y</b> is the brightness from the CIE XYZ vector. <br><br>  Now let's look at the <b>Y</b> component of all primary NTSC colors (I marked them pink): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ab/69d/084/2ab69d084f9a597e032624bcd74d57a7.png"><br>  * Original spreadsheet with many other spaces on <a href="http://www.brucelindbloom.com/index.html%3FWorkingSpaceInfo.html">the Bruce Lindblum website</a> . <br><br>  Familiar tsifir, right?  Here is the answer to the question "where did it come from?" <br><br>  And the problem is that the sRGB space used today is significantly different from the system 60 years ago.  And it's not even that of them is better or worse - <b>they are just different</b> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ece/82d/de9/ece82dde9aefff243777d61281a721da.jpg"></div><br><br>  The triangle is wider and shifted to the side.  Another white point.  By the way, the illuminator C has long been recognized as deprecated in favor of the illuminators of the D series in general and the most popular D65 in particular.  The body of the color gamut is different - accordingly, the results of brightness calculations will be inadequate to reality. <br><br>  You may ask: why the ancient NTSC coverage (almost the same as Adobe RGB 1998 coverage!) Is so much more than the modern sRGB?  I dont know.  Obviously, the kinescopes of the time could not cover it.  Perhaps they wanted to make a foundation for the future? <br><br><h2>  How correct? </h2><br>  The relative brightness of the primary colors in the sRGB space is given in the table above (marked in green) - and they should be used.  In practice, they usually round up to 4 characters: <br><br><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/Y%20%3D%200.2126%20R%20%2B%200.7152%20G%20%2B%200.0722%20B" alt="Y = 0.2126 R + 0.7152 G + 0.0722 B"></div><br>  The attentive reader will notice that the coefficient for R is rounded not by the rules (down), but this is not an error.  The fact is that the sum of all three numbers must be equal to one, and the ‚Äúcorrect‚Äù rounding would introduce an error.  Pedants can take all six decimal places and not worry. <br><br>  This formula is enough for 99% of typical cases.  It is used in all its W3C specifications (for example, <a href="https://www.w3.org/TR/SVG/single-page.html">matrix filters in SVG</a> ). <br>  If you need more precision, you have to calculate <a href="https://en.wikipedia.org/wiki/Lab_color_space">L *</a> , but this is a separate big topic.  <a href="http://stackoverflow.com/a/689547">A good answer to StackOverflow</a> , which provides starting points for further reading. <br>  If the image is in a different color space (Adobe RGB, ProPhoto RGB, etc.) - the coefficients will be yours;  These can be found in the aforementioned Bruce Lindblum table. <br><br><h2>  Why do I care? </h2><br>  As mentioned above, for many years the formula is replicated on a myriad of sites, and they sit in the top of all search engines ( <a href="http://www.gamedev.ru/code/forum/%3Fid%3D79884">for example</a> ).  More serious sources often cite both formulas, but do not make the proper distinction between them, presenting them as equal alternatives.  A typical example on StackOverflow: <a href="http://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color">Formula to determine the brightness of RGB color</a> - the answers are quite detailed, but it is difficult for a person not in the subject to make an informed choice. <br><br>  To be fair, serious projects almost never suffer from such mistakes - the authors do not disdain to check the standards, and the feedback from the audience works (although it does not do without exceptions).  But an ordinary programmer who needs to solve the problem as quickly as possible, drives something like ‚Äúrgb to grayscale‚Äù into the search engine, and he slips it to him, you know what.  The formula continues to find and copy-paste until now!  Phenomenal vitality. <br><br>  I spent about 20 minutes searching for these examples: <br><br><ul><li>  <a href="https://msdn.microsoft.com/en-us/library/bb332387.aspx">Microsoft documentation</a> </li><li>  <a href="http://www.mathworks.com/help/matlab/ref/rgb2gray.html">Matlab documentation</a> </li><li>  <a href="">standard go library</a> </li><li>  <a href="">fashionable color pickers for React</a> (&gt; 2k stars) </li><li>  <a href="">Chart.js</a> (&gt; 23k stars!) </li><li>  <a href="">CImg image processing library</a> </li><li>  <a href="">some</a> <a href="">modules</a> in opencv (it looks like minor) </li><li>  <a href="">demo collection on webgl</a> </li><li> <a href="">something</a> <a href="">inside</a> Gimp and <a href="https://github.com/inkscape/inkscape/blob/master/inkscape-launchpad/share/extensions/color_grayscale.py">utility</a> to Inkscape </li><li>  someone's small projects on <a href="https://github.com/T-Rex/lab-swift-programming-ios-image-processor/blob/master/Filterer/GrayscaleFilter.swift">Swift</a> , <a href="">Go</a> , <a href="">Three.js</a> , <a href="">JS</a> </li></ul><br>  Please note that along with old projects there are a lot of references to the latest and most modern technologies in the list, that is, the code was written / copied quite recently. <br><br>  And the reason for writing this note was a <a href="http://vasilika.ru/webgl-texture/%3Ffull">slide from</a> Vasilika <a href="http://vasilika.ru/webgl-texture/%3Ffull">Klimova's report</a> from HolyJS-2016 - with the same prehistoric formula.  It is clear that the formula did not affect the main meaning of the speech, but it clearly demonstrated your chances of accidentally naguglit it in 2016. <br><br>  Summing up: if you see the sequence 299/587/114 in someone's current code, throw the link to this article to the author. <br><br>  <b>update 1</b> <br>  The comments urge examples.  But this is not as simple as it seems. <br>  If you take an arbitrary picture and translate it into b / w in two ways - it will not give anything at all.  Pictures will be just a little different.  The viewer will only be able to assess which option is subjectively nicer to him.  And that's not the point!  The fact is, which option <b>is more correct, more accurate</b> . <br><br>  A little thought, I sketched just such a thing: <a href="http://codepen.io/dom1n1k/pen/LZWjbj">codepen.io/dom1n1k/pen/LZWjbj</a> <br><br>  The script generates 2 times 100 random colors, selecting the components so that the brightness of all the cubes is <i>theoretically the</i> same (Y = 0.5).  That is, the entire field should be entirely subjectively perceived as uniformly as possible (uniformly precisely from the point of view of brightness, not taking into account different tones). <br>  On the left, the old "wrong" formula, on the right the new "correct".  On the right, homogeneity is indeed noticeably higher.  Although not perfect, of course - for greater accuracy, it is necessary to calculate the perceptual lightness L *. <br><br>  <b>update 2.1</b> <br>  Another question arose about the scale.  He has already been raised by at least 3 people, so I‚Äôm also putting him to the update.  The question is in fact difficult and, in part, even philosophical (completely pulling on a separate article). <br><br>  Strictly speaking, yes, to translate a picture into a b / w view, the gamma needs to be decoded.  But in practice (in tasks not related to accurate colorimetry) this step is often omitted for the sake of simplicity and performance.  For example, Photoshop, when converting to grayscale, takes into account the gamma, but the CSS filter of the same name ( <a href="https://developer.mozilla.org/en/docs/Web/CSS/filter">MDN</a> ) does not. <br><br>  From the point of view of the correctness of the result, the choice of weights and recalculation of the gamma are complementary things.  It affects both.  The only difference is that gamma requires additional calculations, but the correct coefficients are free. <br><br>  The second version of the demo with the gamma (the first did not go away): <a href="http://codepen.io/dom1n1k/pen/PzpEQX">codepen.io/dom1n1k/pen/PzpEQX</a> <br>  It turned out, of course, more precisely. </div><p>Source: <a href="https://habr.com/ru/post/304210/">https://habr.com/ru/post/304210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304200/index.html">How to increase conversion to ecommerce using exit polls</a></li>
<li><a href="../304202/index.html">Update MS16-072 breaks Group Policy. What to do with it?</a></li>
<li><a href="../304204/index.html">Yandex "Mail for Domain" as a mail gateway for your servers</a></li>
<li><a href="../304206/index.html">Checking the source code of WPF Samples from Microsoft</a></li>
<li><a href="../304208/index.html">AndroidAudit. Your Android application as a crime scene</a></li>
<li><a href="../304212/index.html">The book "Head First. Learning Ruby</a></li>
<li><a href="../304214/index.html">How the principal component method (PCA) works with a simple example</a></li>
<li><a href="../304218/index.html">Harvard CS50 course in Russian: second lecture appeared</a></li>
<li><a href="../304220/index.html">Building a chain of trust in PKI, is it all so simple</a></li>
<li><a href="../304222/index.html">Organization of access to the Moscow metro WI-FI network from a security point of view</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>