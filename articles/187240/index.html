<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SaveFrom.net + crutch, or download PLS playlists</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi habrovtsy. 
 I think not only I have a big playlist on vk.com. Most recently, I was puzzled by how to deflate music in order to listen to it offlin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SaveFrom.net + crutch, or download PLS playlists</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/841/01b/69d/84101b69db24e850bf250e336e9c0f83.png" align="left">  Hi habrovtsy. <br>  I think not only I have a big playlist on vk.com.  Most recently, I was puzzled by how to deflate music in order to listen to it offline.  Soon I found a convenient service <a href="http://ru.savefrom.net/user.php">SaveFrom.net</a> .  And all would be nothing, but only to pump out all the music at once, he does not know how.  He offers us options: <br>  1. Give us a bunch of url, so we put the whole thing in the download manager, such as DownloadManager <br>  2. Save the playlist in m3u / pls, which play on url <br><br>  In the first case, our file names will be 3ee56ab0933e.mp3.  ID3 tag will be in place ( <b>UPD</b> is not for all songs there is a correct ID3Tag), but agree, it is inconvenient to open each song to see what it is <br>  In the second case, we have pure urls in playlists, but the title is right away. <br><br>  Since I didn‚Äôt want to watch files like 3ee56ab0933e.mp3, I also didn‚Äôt want to manually call it all ‚Äî I sketched a tulza on my knee, which can read pls playlists, and download music in 10 connections. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Binary + source </h5>  The compiled executable + source code (in Delphi) is <a href="">here</a> <br><br><a name="habracut"></a><br><br><h5>  How to use </h5>  1. We scroll our playlist vkontakte to the bottom, so that SaveFrom.net can get a full pls <br>  2. Choose download playlist: <br><img src="https://habrastorage.org/storage2/b0d/102/859/b0d10285986d709cffc9512c8e843e52.png"><br>  3. In the window that appears, copy the playlist pls to the clipboard: <br><img src="https://habrastorage.org/storage2/cf7/9a9/cbe/cf79a9cbe0c3a7dd5875dbd80bae1b2e.png"><br>  4. We insert this playlist into my utility in the field with the text Insert PLS text here: <br><img src="https://habrastorage.org/storage2/637/eeb/c9c/637eebc9c0d02c0c7d0ac13d3ec47ac1.png"><br>  5. Click the Download button, and see how the music starts to download. <br>  6. If necessary, the VKMusic folder will be created in the program working directory.  Folder name can be changed: <br><img src="https://habrastorage.org/storage2/b41/906/841/b419068410b60fddaa133f2e6cd3ff74.png"><br>  the path may be absolute. <br><br>  If there is a daw in Allow skip files, then the program will check before downloading, if there is a file with the same name on the disk, then it will not download it. <br><br><h5>  A very brief digression to the source code. </h5>  I am writing first of all for those who want to change the code for themselves. <br>  The program uses <a href="http://www.soft-gems.net/index.php/controls/virtual-treeview">Virtual Treeview</a> and Indy. <br>  untPLSparser.pas - parser PLS files.  In the interface of the module one single function: <br><pre><code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> TPLSItems;</code> </pre>  At the entrance - PLS playlist, returns an array of structures describing audio recordings (title + url + often track duration) <br><br>  All this business is converted to another TMusicList array described in untDownloadList.pas. <br>  TMusicList consists of TMusicItem and is needed to store information about the download status, as well as any errors that have occurred. <br><br>  Next, the download process begins.  10 pre-created TDLThread threads, the implementation of which is located in untDownloadThread.pas, are starting to download compositions. <br>  Downloading is launched via TfrmMain.RunFreeDownload in untMain.pas. <br>  First, we get the index of the record to be downloaded using the TfrmMain.GetFreeItem method.  Then we check if we have a daw to skip files, then see if there is such a file, and if there is, skip it. <br><br>  In the process of downloading to callbacks <br><pre> <code class="delphi hljs">DLProgress, DLError, DLComplete, DLTerminate</code> </pre>  Events arrive where we actually update the information in TMusicItem, start a new download or report an error. <br><br>  Downloading streams work as follows. <br>  After creation, the thread waits for download tasks in a loop: <br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Url = <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Terminated <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; FInWork := False; Sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre>  as soon as there is an url to download - it starts downloading.  Since Indy is a library on blocking sockets, there must be a mechanism to stop loading.  I use the special EStopTask exception in TidHTTP.OnWorkBegin, TidHTTP.OnWork, TidHTTP.OnWorkEnd callbacks, which allows me to actually interrupt the download at any time. <br><br>  If something went wrong, but we can correctly process it, and continue to work, we process, we file the under-downloaded file.  If an exception has arisen in the stream that we cannot handle (for example, AV), then according to the standard mechanism, the stream will be nailed, and the exception object will lie in the FatalException.  Therefore, in untMain.pas, I process OnTerminate, check the thread's exception object, and if it does, throw an exception already in the main thread. <br><br><h5>  Finally </h5><br>  That's all, thanks for reading.  I am glad if my ‚Äúcrutch‚Äù suddenly turned out to be convenient for you. </div><p>Source: <a href="https://habr.com/ru/post/187240/">https://habr.com/ru/post/187240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187226/index.html">Work with PEB and TEB</a></li>
<li><a href="../187230/index.html">Samsung introduced terabyte SSD "for all"</a></li>
<li><a href="../187232/index.html">Kinect taught to recognize and translate sign language</a></li>
<li><a href="../187234/index.html">Trove Library. Java primitive type collections</a></li>
<li><a href="../187236/index.html">Replacing Dropbox with BitTorrent Sync + Raspberry Pi</a></li>
<li><a href="../187242/index.html">OS / 2 a quarter of a century later: why IBM lost, and Microsoft won</a></li>
<li><a href="../187250/index.html">Adobe has released PhoneGap 3.0 with a new modular architecture and new APIs.</a></li>
<li><a href="../187256/index.html">Why is QA still not stackoverflow?</a></li>
<li><a href="../187258/index.html">My version of the reader for Habra</a></li>
<li><a href="../187260/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ66 (July 14 - 20, 2013)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>