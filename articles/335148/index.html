<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Defending the MODX Revolution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello friends! 
 A lot of articles have been written and rewritten on how to protect MODX, but in this article I will describe not only the standard r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Defending the MODX Revolution</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/54a/51d/67f/54a51d67f0934d2f7e42e8938c734e1b.svg" alt="MODX Logo"><br><br><h4>  Hello friends! </h4><br>  A lot of articles have been written and rewritten on how to protect MODX, but in this article I will describe not only the standard recommendations for the protection of the MODX Revolution instance (I‚Äôm going to write just MODX, because the MODX Evolution branch is a dead end of "evolution" worthy of attention of modern developers), but also some new methods of "tracing". <br><a name="habracut"></a><br>  So let's start the most important. <br><br>  There are two varieties of the MODX installer - Traditional and Advanced. <br>  What is the difference between them? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Traditional</b> is a simple installation option for any hosting that complies with the <a href="https://docs.modx.com/revolution/2.x/getting-started/server-requirements">recommendations for installing MODX</a> , where the kernel is installed directly into the root of the site‚Äôs public folder.  The uncomplicated ‚Äúcytoklops‚Äù put the version of Tradtiional, do not close the directories from viewing and as a result, <a href="https://www.google.ru/search%3Fnewwindow%3D1%26biw%3D1879%26bih%3D941%26q%3Dinurl%253Acore%252Fmodel%252Fmodx%252F%26oq%3Dinurl%253Acore%252Fmodel%252Fmodx%252F%26gs_l%3Dpsy-ab.3...18212.18212.0.19168.1.1.0.0.0.0.82.82.1.1.0....0...1.1.64.psy-ab..0.0.0.u5hsYsMUQMo">all the contents of the site, incl.</a>  <a href="https://www.google.ru/search%3Fnewwindow%3D1%26biw%3D1879%26bih%3D941%26q%3Dinurl%253Acore%252Fmodel%252Fmodx%252F%26oq%3Dinurl%253Acore%252Fmodel%252Fmodx%252F%26gs_l%3Dpsy-ab.3...18212.18212.0.19168.1.1.0.0.0.0.82.82.1.1.0....0...1.1.64.psy-ab..0.0.0.u5hsYsMUQMo">service directories, falls into the index of search engines</a> .  We are not going to fantasize about what this might lead to.  Everything is clear here. <br><br>  <b>Advanced</b> - version for guys who, at least, "watched a movie about nidzay."  This type of installer allows you to place the MODX kernel outside a public folder, hiding it from the intruders ‚Äôattacks.  For serious projects this is the recommended option, but personally I always use it. <br><br><h4>  Core security </h4><br>  There are two ways to protect the core: <br><br>  1. On a normal hosting - remove the kernel from the public folder and you can not rename it and do not configure the .htaccess file in this directory (on the VDS, you should not forget about setting the permissions of the user who runs Apache). <br><br>  2. On a stupid hosting - rename the kernel directory using, for example, a password generator (without special characters, of course - only letters and numbers) And during the installation, specify the physical path to the kernel directory.  That is why it is better to use the Advanced installer. <br><br><h4>  Protection of service directories </h4><br>  It‚Äôs no secret that in addition to the kernel directory, other service directories should remain in the public folder of the server. <br><br>  What should we do to protect against hacking attempts through connectors and attempts to penetrate the admin panel?  The standard name of the connectors directory is / connectors, and for the admin it is / manager, and this is pale. <br><br>  During installation, you will be prompted to change these names.  This will help us, correctly, - the password generator and, oddly enough, in the case of the admin own head.  The name of the admin directory is better made human-readable, but not / admin, of course :) <br><br>  You might want to ask: Why don't we hide / assets? <br>  And, perhaps, I will answer: Why?  All pictures and scripts are in / assets, and in the page code there are all links to pictures and scripts :) <br><br><h4>  Database table protection </h4><br>  During installation, in the database settings, the default is the modx_ table prefix.  <a href="https://modx.pro/security/10266-critical-vulnerability-in-modx-revolution/">So it will not work</a> .  And again, the password generator will help us (Remember, comrade? Only from letters and numbers!).  Change the standard prefix to cracks, at the end of which we put the underscore.  For example, ‚ÄúIU1xbp4_‚Äù. <br><br><h4>  Protection against CMS detection </h4><br>  Services of automatic detection of CMS sites, of course, do not know that MODX is CMF, but this does not prevent them from determining that it is MODX that manages the content on the site.  It would seem that we have already hidden everything we need.  And no. <br><br>  First of all, when installing MODX Revolution, you must disable the checkbox "X-Powered-By", which is enabled by default <i>(in the picture below)</i> .  This is necessary to ensure that MODX does not ‚Äúburn‚Äù by sending in the headers information that the site is made on MODX. <br><br><img src="https://habrastorage.org/webt/59/d2/6d/59d26d4118e92520058739.png" alt="image"><br><br>  If the site is already installed, you can check this parameter in the system settings at the address: <a href="http://xn--_-8sbffbgd5ckhi1j.xn--80aa0a4ah/manager/%3Fa%3Dsystem/settings">domain_of yoursite / manager /? A = system / settings</a> <br>  And in the ‚ÄúSearch by key‚Äù field enter ‚Äúsend_poweredby_header‚Äù or simply ‚Äúheader‚Äù and press Enter on the keyboard.  The value "send_poweredby_header" should be set to "No". <br><br><img src="https://habrastorage.org/webt/jh/wn/xt/jhwnxt5dhtpmwzs0vjsmw8thoak.png"><br><br>  It is also useful to hide configuration files. <br>  For example, <a href="http://www.vvhotel.ru/config.core.php">let's take the first link from the Google search list above</a> , and try to open the settings file config.core.php, or, despite the fact that the directory listing is already closed on this site, follow the link ‚Äú <a href="http://www.vvhotel.ru/core/config/config.inc.php">www.vvhotel.ru/core /config/config.inc.php</a> ‚Äù, the site gives the result of the execution of the .php file, which means that each of these files exists and even the first of them suggests that the site is on MODX. <br><br>  You can hide this file with .htaccess by adding: <br><br><pre><code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_rewrite.c&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span></span></span> <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span> ^(.*)config.core.php$ RewriteRule ^(.*)$<span class="hljs-meta"><span class="hljs-meta"> [R=404] &lt;/IfModule&gt;</span></span></code> </pre> <br><h4>  Something else </h4><br>  In addition to the techniques described above, you can use a little trick to divert potential intruders on the wrong track.  Some ‚Äúpop‚Äù CMS added metatags with the name CMS: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"generator"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WordPress xxx"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  You can safely add such a tag to your code, and create a fake standard login page to the admin panel of the specified version of the simulated CMS. <br><br>  Autodeterminers will interpret our MODX as Wordpress, and if the hooligans want to get into the admin panel, they will be long and tedious to try to pick the master keys from a simple lock to the scanner of the retina (this is a metaphor :)). <br><br><h4>  And what if the site is already installed? </h4><br>  In the hour of the smallest load, rename all the specified directories (/ core, if hosting allows, it is better to take out of the public). <br><br>  Change the prefix of existing ones using <i>phpMyAdmin</i> : <br><br><ul><li>  in the left part of phpMyAdmin click on the name of the desired database; </li><li>  a list of all tables will appear in the main area, at the bottom of which the ‚ÄúMark all‚Äù checkbox should be checked; </li><li>  To the right of the checkbox the combo box ‚ÄúWith marked:‚Äù in which you must select ‚ÄúReplace table prefix‚Äù; </li><li>  In the new window, specify the old prefix and the new prefix, to which the old one should be replaced. </li></ul><br>  Then, if you have Traditional, but you want to replace it with Advanced, then on top of the contents of / core (or, as you call it new name), you must write the contents of the / core directory from the Advanced installer‚Äôs archive, and place / setup in the root of the site. <br><br>  Check permissions and access (on directories 755, on files 644). <br><br>  Start the installation process. <br><br>  During installation, you will need to specify the physical path to the kernel directory. <br><br>  <b>It is IMPORTANT</b> to choose the ‚ÄúAdvanced update (with database settings)‚Äù installation option, because after entering the database data, the directory rename dialog will appear. <br><br>  You could, of course, get into config.inc.php and edit everything there.  But why do something if you can not do it?  :) <br><br>  That's all.  If the information from this article is useful to you - great.  If you want to ask something, add or simply pamper yourself - welcome to the blog! </div><p>Source: <a href="https://habr.com/ru/post/335148/">https://habr.com/ru/post/335148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335138/index.html">RequestQueueLimitPerSession and its distribution to older versions of .net</a></li>
<li><a href="../335140/index.html">Optimization and automation of web application testing</a></li>
<li><a href="../335142/index.html">About PKI "on the fingers" in 10 minutes</a></li>
<li><a href="../335144/index.html">Malicious code in npm-packages and the fight against it</a></li>
<li><a href="../335146/index.html">The book "Android. Programming for professionals. 3rd edition "</a></li>
<li><a href="../335152/index.html">So who's back, bro?</a></li>
<li><a href="../335154/index.html">Mobile applications: how to avoid a ban from the advertising network?</a></li>
<li><a href="../335156/index.html">The digital economy should be digital</a></li>
<li><a href="../335158/index.html">Comparing REST and GraphQL</a></li>
<li><a href="../335160/index.html">Programming ‚â† computer science</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>