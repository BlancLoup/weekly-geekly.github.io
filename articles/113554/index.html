<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Git + TrackStudio - development automation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is an article on how to use TrackStudio and Git to organize a convenient software development process. In the article considered a variant for OS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Git + TrackStudio - development automation</h1><div class="post__text post__text-html js-mediator-article">  This is an article on how to use TrackStudio and Git to organize a convenient software development process.  <i>In the article considered a variant for OS Windows.</i>  <i>But if you wish, it is not difficult to do everything for other OC.</i> <br>  For this we need: <ol><li>  <a title="Download TrackStudio" href="http://www.trackstudio.ru/products-edownload.html">TrackStudio</a> is a universal task management system. </li><li>  <a title="Download Git" href="http://git-scm.com/download">Git</a> - VCS. </li><li>  <a title="Download Blat" href="http://sourceforge.net/projects/blat/files/">Blat</a> - Small (70kB) open source console program for Windows, which allows you to send e-Mail via SMTP protocol from the command line, with attached files. </li><li>  <a title="Download STunnel" href="http://www.stunnel.org/download/">STunnel</a> - A program that allows you to encrypt arbitrary TCP connections inside SSL.  The tool is available for Unix and Windows. <br>  <strong>It is necessary if you use gmail.com as a mail service.</strong>  <strong>Since blat cannot work directly with gmail.</strong> </li></ol>  <strong>Task:</strong> <blockquote>  Organize the workflow in such a way that when you commit to git, comments were automatically added to the TrackStudio task with different types of messages and the text of this comment was the text of the commit message. </blockquote><a name="habracut"></a><br><h1>  Installation </h1><h4>  TrackStudio </h4>  We do everything as it <a title="Installation Guide" href="http://www.trackstudio.ru/installation-guide.html">is</a> written <a title="Installation Guide" href="http://www.trackstudio.ru/installation-guide.html">here.</a> <br>  Installation of all other applications is very simple, I note only one thing: blat should be put in the folder with git.exe (I have C: / Program files / Git / bin), or the folder in which blat is added to PATH. <br><br><br><h1>  Customization </h1><h2>  TrackStudio </h2>  TrackStudio is able to pick up emails from emails and import them as tasks. <br>  To configure this process, you need to set the mail collection parameters in the <b>TS_HOME \ etc \ trackstudio.mail.properties file</b> (if you do not have one): <blockquote><pre><code class="java hljs">mail.pop3.apop.enable=\ mail.store.forward=     email mail.store.fwdaddress=email      mail.store.host=pop  mail.store.password=  mail.store.port= mail.store.protocol= mail.store.user= , email,    trackstudio.emailSubmission=yes trackstudio.mailimport.interval=  </code> </pre> </blockquote>  Here is an example for gmail.com: <blockquote><pre> <code class="bash hljs">mail.pop3.apop.enable=\ mail.store.forward=yes mail.store.fwdaddress=mymail@gmail.com mail.store.host=pop.gmail.com mail.store.password=password mail.store.port=995 mail.store.protocol=pop3s mail.store.user=srvmail@gmail.com</code> </pre></blockquote>  More details are described in the <a title="How to import emails from users to tasks" href="http://www.trackstudio.ru/howto-import-email.html">documentation</a> . <br><br><br><h4>  Script to create an import rule </h4>  Now in TS, for an ancestor of each task with the category category ‚ÄúChange‚Äù or ‚ÄúError‚Äù, it is necessary to create an import rule and it is desirable that they are created as administrator.  But to do it every time, it is expensive with pens - we solve this problem by writing a plug-in.  In the <strong>TS_HOME \ plugins \ scripts \ after_create_task folder</strong> (it contains scripts that are executed after creating tasks) create the file <strong>createRuleImport.bsh</strong> with the following code: <blockquote><ol><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">* The script creates an import rule for the ancestor task when creating a child task.</font> </li><li>  <font color="#008000">* /</font> </li><li>  import com.trackstudio.app.adapter.AdapterManager; </li><li>  import com.trackstudio.exception.GranException; </li><li>  import com.trackstudio.secured. *; </li><li>  import com.trackstudio.securedkernel.SecuredMailImportAdapterManager; </li><li>  import com.trackstudio.securedkernel.SecuredStepAdapterManager; </li><li>  import java.util. *; </li><li>  import com.trackstudio.secured.SecuredUserBean; </li><li>  import com.trackstudio.app.session. *; </li><li>  import com.trackstudio.app.csv.CSVImport; </li><li></li><li>  <font color="#0000ff">try</font> { </li><li>  <font color="#008000">// object for working with mail import rules</font> </li><li>  SecuredMailImportAdapterManager mam = AdapterManager.getInstance () </li><li>  .getSecuredMailImportAdapterManager (); </li><li></li><li>  <font color="#008000">// contains methods for working with message types</font> </li><li>  SecuredStepAdapterManager sam = AdapterManager.getInstance () </li><li>  .getSecuredStepAdapterManager (); </li><li></li><li>  <font color="#008000">// list of available message types for task and current user</font> </li><li>  ArrayList arrMS = sam.getAvailableMstatusList (task.getSecure (), task.getId ()); </li><li></li><li>  <font color="#008000">// type of message</font> </li><li>  SecuredMstatusBean curMS = <font color="#0000ff">null</font> ; </li><li></li><li>  String pefixStr = <font color="#A31515">"new"</font> ; </li><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">* Check the type of category of the created task.</font> </li><li>  <font color="#008000">* If the task category is ‚ÄúError‚Äù = category name in TS</font> </li><li>  <font color="#008000">* /</font> </li><li>  <font color="#0000ff">if</font> (task.getCategory (). getName (). equals ( <font color="#A31515">"Error"</font> )) </li><li>  pefixStr = <font color="#A31515">"bug"</font> ; </li><li></li><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">* Generate a key for importing messages from the current task:</font> </li><li>  <font color="#008000">* prefix + parent task number + # + task number</font> </li><li>  <font color="#008000">* this key should be in the subject line</font> </li><li>  <font color="#008000">* eg:</font> </li><li>  <font color="#008000">* new759 # 2845 any text, anyway it will be ignored when adding a message.</font> </li><li>  <font color="#008000">* /</font> </li><li>  String mailimKey = pefixStr + task.getParent (). GetNumber () + <font color="#A31515">"#"</font> + task.getNumber (); </li><li></li><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">* Do I need to create a rule.</font> </li><li>  <font color="#008000">* Since an ancestor task can have several subtasks,</font> </li><li>  <font color="#008000">* it is necessary to check the existence of the import rule,</font> </li><li>  <font color="#008000">* so as not to produce them.</font> </li><li>  <font color="#008000">* /</font> </li><li>  boolean found = <font color="#0000ff">false</font> ; </li><li></li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt;arrMS.size (); i ++) { </li><li>  curMS = (SecuredMstatusBean) arrMS.get (i); </li><li></li><li>  msn = curMS.getName (); </li><li></li><li>  <font color="#008000">// "Commentary" or "Comment" is the name of the message type</font> </li><li>  <font color="#0000ff">if</font> (msn.compareToIgnoreCase ( <font color="#A31515">"Comment"</font> ) == 0 || msn.compareToIgnoreCase ( <font color="#A31515">"Comment"</font> ) == 0) { </li><li>  <font color="#008000">// Get data by root user</font> </li><li>  SecuredUserBean adminUser = <font color="#0000ff">new</font> SecuredUserBean (CSVImport.findUserIdByLogin ( <font color="#A31515">"root"</font> ), sc); </li><li>  <font color="#008000">// Current user context</font> </li><li>  SessionContext needSc = task.getSecure (); </li><li>  <font color="#008000">// check whether root has logged in</font> </li><li>  <font color="#0000ff">if</font> (SessionManager.getInstance (). existUserSession (adminUser.getUser ())) { </li><li>  <font color="#0000ff">for</font> (SessionContext curSc: SessionManager.getInstance (). getSessions ()) { </li><li>  <font color="#0000ff">if</font> (curSc.getUser (). getLogin (). equals ( <font color="#A31515">"root"</font> )) { </li><li>  <font color="#008000">// if yes then we get its context</font> </li><li>  needSc = curSc; </li><li>  <font color="#0000ff">break</font> ; </li><li>  } </li><li>  } </li><li>  } </li><li>  <font color="#0000ff">else</font> { </li><li>  <font color="#008000">// if not, create its context</font> </li><li>  needSc = SessionManager.getInstance (). getSessionContext ( </li><li>  SessionManager.getInstance (). Create (adminUser.getUser ())); </li><li>  } </li><li></li><li>  <font color="#0000ff">if</font> (! found) </li><li>  <font color="#0000ff">for</font> (SecuredMailImportBean curMailS: mam.getAllAvailableMailImportList (needSc, task.getParentId ())) { </li><li>  <font color="#008000">// We are looking for the rule of importing new tasks from the ancestor.</font> </li><li>  found = curMailS.getKeywords (). equals (pefixStr + task.getParent (). getNumber ()); </li><li>  <font color="#0000ff">if</font> (found) </li><li>  <font color="#0000ff">break</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">if</font> (! found) { </li><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">* if not found, then create a new import rule for the ancestor</font> </li><li>  <font color="#008000">* as root, as TS supports the ability to create</font> </li><li>  <font color="#008000">* users of individual rules for importing mail, you must</font> </li><li>  <font color="#008000">* so that this rule could be seen by everyone.</font> </li><li>  <font color="#008000">* /</font> </li><li>  mam.createMailImport (needSc, pefixStr + task.getParent (). getNumber (), </li><li>  task.getParentId (), pefixStr + task.getParent (). getNumber (), 1, i, </li><li>  task.getCategoryId (), curMS.getId (), <font color="#A31515">""</font> , <font color="#0000ff">true</font> , <font color="#0000ff">false</font> ); </li><li>  found = <font color="#0000ff">true</font> ; </li><li>  } </li><li>  } </li><li>  } </li><li>  <font color="#008000">// Add a value for the UDF field with the name "Branch name in git".</font> </li><li>  AdapterManager.getInstance (). GetSecuredUDFAdapterManager (). SetTaskUDFValueSimple ( </li><li>  task.getSecure (), task.getId (), <font color="#A31515">‚ÄúBranch Name in git‚Äù</font> , mailimKey); </li><li>  } </li><li>  <font color="#0000ff">catch</font> (GranException e) { </li><li>  <font color="#0000ff">throw</font> <font color="#0000ff">new</font> com.trackstudio.exception.UserMessageException (e.getMessage ()); </li><li>  } </li><li>  <font color="#0000ff">return</font> task; </li></ol></blockquote><br clear="all">  The script has been created, now in TS we select in the menu ‚ÄúTask management -&gt; Categories‚Äù, <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/9d/b9/9db9325ff088f2e7b7b9221e39a1a22c.jpg"></a> <br clear="all">  first click on the category with the name "Change", <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/ee/2b/ee2b3cafe9d836f63a7df14052644e24.jpg"></a> <br clear="all">  open the "Triggers" tab and in the "AFTER Trigger" list, mark the trigger, which is called <strong>createRuleImport.bsh</strong> . <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/fc/cd/fccda44619ecca217d7d3d0c2403e12c.jpg"></a> <br clear="all">  Do the same for the category "Error". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If everything is done correctly, then when you create a new task, the Preda will have an import rule newNUMBER_PREACH or bugNUMP_REAL.  When sending a letter to the email from which mail is imported, with the theme ‚ÄúnewNUMBER_PREACH new task‚Äù, TS will create a task in the ANCIENT with a name that is equal to the subject of the letter.  And if you send a letter in the subject, which is the key newNUMBER_BOOK # NUMBER_TASK (the task exists), TS imports the letter as comments to the task and the comment message will be the body of the letter.  Moreover, if you attach a file to a letter, TS will attach it to the task. <br><br><br><h4>  How to add a UDF field </h4>  To do this, in TS top menu select ‚ÄúTask management -&gt; Processes‚Äù, open the process of interest to you and in the ‚ÄúAdditional fields‚Äù tab click on the ‚ÄúLine‚Äù button. <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/2b/97/2b97b9b558f53bb507243e80b0280ce3.jpg"></a> <br clear="all">  In the title, specify the name you need, in our case ‚ÄúBranch Name in git‚Äù, and click the Save button.  But this is all just to copy and quickly paste into sh when creating a new branch in git, such as convenient. <br><br><br><h4>  Script for processing messages received via mail </h4>  TS already knows how to create messages from the ‚Äúcomments‚Äù type to the tasks from the letters. <br>  Now we need to make TS change the message type to ‚ÄúComplete‚Äù or ‚ÄúCorrect‚Äù for the category ‚ÄúChange‚Äù or ‚ÄúError‚Äù, respectively (‚ÄúComments‚Äù, ‚ÄúFinish‚Äù, ‚ÄúChange‚Äù and ‚ÄúError‚Äù - the names of the message type and categories , they depend on how you set up your workflow in TS; if you use the demo Russian database, they will be exactly like that).  We need to create a script that will search in the message body, some sort of key, which will inform TS that it is necessary to change the type of message.  I propose to use the [new_state = done] construct, but this is up to you.  Create in the <strong>TS_HOME \ plugins \ scripts \ before_add_message folder</strong> , in which the scripts to be executed before adding the message are placed, <strong>changeType.bsh</strong> file with the code: <blockquote><ol><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">* The script changes the type of the message being imported if it finds it in the message body.</font> </li><li>  <font color="#008000">* construct [new_state = type], where type can be done or start</font> </li><li>  <font color="#008000">* /</font> </li><li>  import java.util. *; </li><li>  import java.util.regex. *; </li><li>  import java.io. *; </li><li></li><li>  <font color="#0000ff">try</font> { </li><li>  <font color="#0000ff">if</font> (message.description! = <font color="#0000ff">null</font> ) </li><li>  { </li><li>  String [] tempArr = <font color="#0000ff">null</font> ; </li><li>  <font color="#008000">// Looking for the construction we need in the message</font> </li><li>  String pattern = <font color="#A31515">". * \\ [(\\ w *) = (\\ w *) \\]. *"</font> ; </li><li>  Pattern p = Pattern.compile (pattern, Pattern.MULTILINE); </li><li>  Matcher m = p.matcher (message.description); </li><li>  <font color="#0000ff">if</font> (m.find ()) </li><li>  tempArr = <font color="#0000ff">new</font> String [] {m.group (1), m.group (2)}; </li><li>  <font color="#008000">// whether the first parameter is scanned by the directive to change the type of message</font> </li><li>  <font color="#0000ff">if</font> (tempArr! = <font color="#0000ff">null</font> &amp;&amp; tempArr [0] .toLowerCase (). equals ( <font color="#A31515">"new_state"</font> )) { </li><li>  <font color="#008000">// determine what type to change the current message type</font> </li><li>  <font color="#0000ff">if</font> (tempArr [1] .toLowerCase (). equals ( <font color="#A31515">"done"</font> )) { </li><li>  <font color="#008000">// Remove the directive from the message</font> </li><li>  message.description = message.description.replaceFirst ( <font color="#A31515">"\\ [new_state = done \\]"</font> , <font color="#A31515">""</font> ); </li><li>  <font color="#008000">// check which task belongs to</font> </li><li>  <font color="#0000ff">if</font> (message.getTask (). getCategory (). getName (). equals ( <font color="#A31515">"Change"</font> )) </li><li>  <font color="#008000">// set the new message type by its name</font> </li><li>  message.setMstatus ( <font color="#A31515">‚ÄúFinish‚Äù</font> ); </li><li>  <font color="#0000ff">if</font> (message.getTask (). getCategory (). getName (). equals ( <font color="#A31515">"Error"</font> )) </li><li>  message.setMstatus ( <font color="#A31515">‚ÄúFix‚Äù</font> ); </li><li>  } </li><li>  <font color="#0000ff">if</font> (tempArr [1] .toLowerCase (). equals ( <font color="#A31515">"start"</font> )) { </li><li>  message.description = message.description.replaceFirst ( <font color="#A31515">"\\ [new_state = start \\]"</font> , <font color="#A31515">""</font> ); </li><li>  <font color="#0000ff">if</font> (message.getTask (). getCategory (). getName (). equals ( <font color="#A31515">"Change"</font> ) || </li><li>  message.getTask (). getCategory (). getName (). equals ( <font color="#A31515">‚ÄúError‚Äù</font> )) </li><li>  message.setMstatus ( <font color="#A31515">‚ÄúGet started‚Äù</font> ); </li><li>  } </li><li>  } </li><li>  } </li><li>  } </li><li>  <font color="#0000ff">catch</font> (Exception e) { </li><li>  <font color="#0000ff">throw</font> <font color="#0000ff">new</font> com.trackstudio.exception.UserMessageException (e.printStackTrace ()); </li><li>  } </li><li>  <font color="#0000ff">return</font> message; </li></ol></blockquote>  The script has been created, now in TS we select in the menu ‚ÄúTask management -&gt; Processes‚Äù, first click on the process with the name ‚ÄúChange‚Äù, then select the operation types tab and click on the operation with the name ‚ÄúComment‚Äù <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/df/77/df771477adb67ea393a67d1024a8a7ad.jpg"></a> <br clear="all">  open the ‚ÄúTriggers‚Äù tab and in the ‚ÄúBEFORE Trigger‚Äù list, mark the trigger, which is called <strong>changeType.bsh</strong> . <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/a6/a2/a6a295cf62ae44530b97c5a890792364.jpg"></a> <br clear="all">  We do the same for the ‚ÄúError‚Äù process. <br><br>  Like everything you can try. <br>  Create a task -&gt; copy from the field "Branch name in git" value -&gt; <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/f8/5c/f85c56349cedee4d470ae785e994c06f.jpg"></a> <br clear="all">  we create a letter with a topic into which we paste the copied value -&gt; then in the body of the letter we write any text and add the directive [new_state = done]. <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/e3/44/e3447b5fa41bc8279f9f5744328e382e.jpg"></a> <br clear="all">  In theory, after importing a letter for a task to change state, it should go to the state completed and the message body will be the message to this state. <br><br><br><h4>  Total </h4>  We have expanded TS abilities, now she can: <ul><li>  Automatically create import rules for creating new messages and tasks. </li><li>  Change the status of the message depending on the directive found in the message body. </li><li>  Attach files to the task, if they are attached to the letter. <br>  This ability of TS was given to developers, but we will need it in the future. </li></ul><br><h2>  Stunnel </h2>  <strong>If you are not using gmail.com as your mail server, then skip this step!</strong> <br>  In the folder where you installed stunnel find the file <strong>stunnle.conf</strong> (C: \ Program Files \ stunnel \ stunnel.conf).  We change its contents to the following: <blockquote><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">socket</span></span> = l:TCP_NODELAY=1 socket = r:TCP_NODELAY=1 debug = 7 output = stunnel.log client = yes<span class="hljs-meta"><span class="hljs-meta"> [ssmtp] accept = 127.0.0.1:465 connect = smtp.gmail.com:465</span></span></code> </pre></blockquote>  And in order for stunnel to start as a service, we automatically execute on the command line: <br><blockquote>  <font color="black">"C: \ Program Files \ stunnel \ stunnel.exe" ‚Äìinstall</font> </blockquote>  source: <a href="http://nemcd.com/2009/05/otpravka-pisem-windows/">Sending letters from the Windows command line using a GMail account</a> <br><br><br><h2>  Git </h2>  Everything related to TS was performed on the server side.  And now all the settings will be at a specific workplace. <br>  In order to configure the git behavior when committing a commit, we need to change 2 hooks first <strong>post-commit</strong> and <strong>prepare-commit-msg</strong> , the first is executed at the time of the commit, the second when the commit message is generated.  The hook files are in the <strong>DIR_YOUR_REPO / .git / hooks</strong> directory. <ul><li>  In the <strong>prepare-commit-msg</strong> file, generate a message header. <br><blockquote>  <font color="black"><font color="#008000">#! / bin / sh</font></font> <font color="black"><br></font>  <font color="black"><strong><font color="#0000FF">case</font></strong> <font color="#808080">"$ 2, $ 3"</font> <strong><font color="#0000FF">in</font></strong></font> <font color="black"><br></font>  <font color="black"><font>merge</font> <strong><font color="#804000">,)</font></strong></font> <font color="black"><br></font>  <font color="black"><strong><font color="#0000FF">perl</font></strong> <strong><font color="#804000">-</font></strong> <font>i.bak</font> <strong><font color="#804000">-</font></strong> <font>ne</font> <font color="#808080">'s / ^ / # /, s / ^ # # / # / if / ^ Conflicts / ... / # /;</font></font>  <font color="black"><font color="#808080">print '</font> <font color="#808080">"$ 1"</font> <strong><font color="#804000">;;</font></strong></font> <font color="black"><br></font>  <font color="black"><strong><font color="#804000">*)</font></strong> <strong><font color="#804000">;;</font></strong></font> <font color="black"><br></font>  <font color="black"><strong><font color="#0000FF">esac</font></strong></font> <font color="black"><br><br></font>  <font color="black"><strong><font color="#0000FF">if</font></strong> <strong><font color="#804000">[</font></strong> <font color="#808080">"` git branch | grep -e "^ \ *. \ (new \ | bug \) [0-9] \ + # [0-9] \ +" | cut -f2 -d '' `"! = "" <strong><font color="#804000">];</font></strong></font></font>  <font color="black"><font color="#808080"><strong><font color="#0000FF">then</font></strong></font></font> <font color="black"><font color="#808080"><br></font></font>  <font color="black"><font color="#808080"><font color="#008000"># Put the keys to send the letter to the beginning of the file with the message.</font></font></font> <font color="black"><font color="#808080"><br></font></font>  <font color="black"><font color="#808080"><strong><font color="#0000FF">echo</font></strong> <font color="#808080">sendmail</font> <strong><font color="#804000">&gt;</font></strong> <font>temp_msg</font></font></font> <font color="black"><font color="#808080"><br></font></font>  <font color="black"><font color="#808080"><strong><font color="#0000FF">echo</font></strong> <font color="#808080">"to = srvemail@gmail.com"</font> <strong><font color="#804000">&gt;&gt;</font></strong> <font>temp_msg</font></font></font> <font color="black"><font color="#808080"><br></font></font>  <font color="black"><font color="#808080"><strong><font color="#0000FF">echo</font></strong> <font color="#808080">"[new_state = done]"</font> <strong><font color="#804000">&gt;&gt;</font></strong> <font>temp_msg</font></font></font> <font color="black"><font color="#808080"><br></font></font>  <font color="black"><font color="#808080"><strong><font color="#0000FF">cat</font></strong> <strong><font color="#FF8040">$ 1</font></strong> <strong><font color="#804000">&gt;&gt;</font></strong> <font>temp_msg</font></font></font> <font color="black"><font color="#808080"><br></font></font>  <font color="black"><font color="#808080"><strong><font color="#0000FF">cat</font></strong> <font>temp_msg</font> <strong><font color="#804000">&gt;</font></strong> <strong><font color="#FF8040">$ 1</font></strong></font></font> <font color="black"><font color="#808080"><br></font></font>  <font color="black"><font color="#808080"><strong><font color="#0000FF">rm</font></strong> <font>temp_msg</font></font></font> <font color="black"><font color="#808080"><br></font></font>  <font color="black"><font color="#808080"><strong><font color="#0000FF">fi</font></strong></font></font> </blockquote></li><li>  In the <strong>post-commit</strong> file, we configure the collection of information about changes and sending mail. <br><blockquote>  <font color="black"><font color="#008000">#! / bin / sh</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000"># we get from the variable GIT_AUTHOR_IDENT email of the current committer</font></font> <font color="black"><br></font>  <font color="black"><font>sender</font> <strong><font color="#804000">=</font> <font color="#804040">`git var GIT_COMMITTER_IDENT |</font></strong></font>  <font color="black"><strong><font color="#804040">cut -f1 -d '&gt;' |</font></strong></font>  <font color="black"><strong><font color="#804040">cut -f 2 -d '&lt;' `</font></strong></font> <font color="black"><br><br></font>  <font color="black"><font color="#008000"># check the presence of the sendmail text in the first line of the message</font></font> <font color="black"><br></font>  <font color="black"><strong><font color="#0000FF">if</font></strong> <strong><font color="#804000">[</font></strong> <strong><font color="#804040">`git log -1 |</font></strong></font>  <font color="black"><strong><font color="#804040">sed "s / [] * // g" |</font></strong></font>  <font color="black"><strong><font color="#804040">grep -e "^ sendmail $" `</font></strong> <strong><font color="#804000">==</font> <font color="#808080">" sendmail "</font></strong> <strong><font color="#804000">];</font></strong></font>  <font color="black"><strong><font color="#0000FF">then</font></strong></font> <font color="black"><br><br></font>  <font color="black"><font color="#008000"># form the subject of the message, which is taken from the name of the branch</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000"># but this is a wish, you can make the topic be taken from the first line of the main text of the message</font></font> <font color="black"><br></font>  <font color="black"><font>subject</font> <strong><font color="#804000">=</font> <font color="#804040">`git branch |</font></strong></font>  <font color="black"><strong><font color="#804040">grep -e "^ \ *. \ (new \ | bug \) [0-9] \ + # [0-9] \ +" |</font></strong></font>  <font color="black"><strong><font color="#804040">cut -f2 -d '' `</font></strong></font> <font color="black"><br></font>  <font color="black"><strong><font color="#0000FF">if</font></strong> <strong><font color="#804000">[</font></strong> <font color="#808080">"` git log -1 | sed "</font> <font>s</font> <strong><font color="#804000">/ [</font></strong> <strong><font color="#804000">] * //</font></strong> <font>g</font> <font color="#808080">" | gre grep -e "</font> <strong><font color="#804000">^</font></strong> <font>newroot \ =</font> <font color="#808080">" | cut -f2 -d '= "` "</font> <strong><font color="#804000">! =</font></strong> <font color="#808080">" "</font> <strong><font color="#804000">];</font></strong></font>  <font color="black"><strong><font color="#0000FF">then</font></strong></font> <font color="black"><br></font>  <font color="black"><font>subject</font> <strong><font color="#804000">=</font> <font color="#804040">`git log -1 |</font></strong></font>  <font color="black"><strong><font color="#804040">sed "s / [] * // g" |</font></strong></font>  <font color="black"><strong><font color="#804040">grep -e "^ newroot \ =" |</font></strong></font>  <font color="black"><strong><font color="#804040">cut -f2 -d '=' |</font></strong></font>  <font color="black"><strong><font color="#804040">cut -f1 -d '#' `</font></strong></font> <font color="black"><br></font>  <font color="black"><font>subject</font> <strong><font color="#804000">=</font></strong> <font color="#808080">"$ subject #` git branch | grep -e "^ \ *. \ (new \ | bug \) [0-9] \ + # [0-9] \ +" | cut -f2 -d '# '`"</font></font> <br>  <strong><font color="#0000FF">fi</font></strong> <br><br>  <font color="#008000"># determined from the third line of the message of the commit mail,</font> <br>  <font color="#008000"># to which you need to send a letter</font> <br>  <font color="#008000"># by default put the current commitr's email.</font> <br>  <font>to</font> <strong><font color="#804000">=</font> <font color="#FF8040">$ sender</font></strong> <br>  <strong><font color="#0000FF">if</font></strong> <strong><font color="#804000">[</font></strong> <font color="#808080">"` git log -1 | sed "s / [] * // g" | grep -e "^ [Tt] [Oo] \ =" | cut -f2 -d '= "` "</font> <strong><font color="#804000">! =</font></strong> <font color="#808080">" "</font> <strong><font color="#804000">];</font></strong>  <strong><font color="#0000FF">then</font></strong> <br>  <font>to</font> <strong><font color="#804000">=</font> <font color="#804040">`git log -1 |</font></strong>  <strong><font color="#804040">sed "s / [] * // g" |</font></strong>  <strong><font color="#804040">grep -e "^ [Tt] [Oo] \ =" |</font></strong>  <strong><font color="#804040">cut -f2 -d '=' "`</font></strong> <br>  <strong><font color="#0000FF">fi</font></strong> <br><br>  <font color="#008000"># create patch file name</font> <br>  <font>patchname</font> <strong><font color="#804000">=</font></strong> <font color="#808080">"$ (date +% j% H% M% s) .patch"</font> <br><br>  <font color="#008000"># save the diff commitcomit,</font> <br>  <strong><font color="#804000">(</font></strong> <font>git</font> <font>diff-index</font> <font>-p</font> <font>-M</font> <font>HEAD</font> <strong><font color="#804000">^)</font></strong> <font color="#804000">&gt;</font> <strong><font color="#FF8040">$ patchname</font></strong> <br><br>  <font color="#008000"># take the last message from the git log with the exception of the control text</font> <br>  <font>git</font> <font>log</font> <font color="#804000">-</font> <font color="#FF0000">1</font> <font color="#804000">|</font>  <strong><font color="#0000FF">grep</font></strong> <font color="#804000">-</font> <font>v</font> <font color="#808080">"^ Date:"</font> <font color="#804000">|</font>  <strong><font color="#0000FF">grep</font></strong> <font color="#804000">-</font> <font>v</font> <font color="#808080">"^ commit"</font> <font color="#804000">|</font>  <strong><font color="#0000FF">grep</font></strong> <font color="#804000">-</font> <font>v</font> <font color="#808080">"^ Author:"</font> <font color="#804000">|</font>  <strong><font color="#0000FF">grep</font></strong> <font color="#804000">-</font> <font>v</font> <font color="#808080">"* Signed-off-by:"</font> <font color="#804000">|</font>  <strong><font color="#0000FF">grep</font></strong> <font color="#804000">-</font> <font>v</font> <font color="#808080">"^ [] * sendmail [] * $"</font> <font color="#804000">|</font>  <strong><font color="#0000FF">grep</font></strong> <font color="#804000">-</font> <font>v</font> <font color="#808080">"^ [] * newroot \ ="</font> <font color="#804000">|</font>  <strong><font color="#0000FF">grep</font></strong> <font color="#804000">-</font> <font>v</font> <font color="#808080">"^ [] * [Tt] [Oo] \ ="</font> <font color="#804000">|</font>  <strong><font color="#0000FF">grep</font></strong> <font color="#804000">-</font> <font>v</font> <font color="#808080">". * $ subject. *"</font> <font color="#804000">|</font>  <strong><font color="#0000FF">sed</font></strong> <font>-e</font> <font color="#808080">"/ ^ [] * $ / d"</font> <font>-e</font> <font color="#808080">"/ ^ $ / d"</font> <font color="#804000">&gt;&gt;</font> <font>temp.tmp</font> <br>  <strong><font color="#0000FF">echo</font></strong> <font color="#808080">"shortstat"</font> <font color="#804000">&gt;&gt;</font> <font>temp.tmp</font> <br>  <font>git</font> <font>diff-index</font> <font color="#804000">-</font> <font>stat</font> <font>HEAD</font> <font color="#804000">^</font> <font color="#804000">&gt;&gt;</font> <font>temp.tmp</font> <br><br>  <font color="#008000"># send by means of blat</font> <br>  <font>blat</font> <font color="#804000">-</font> <font>charset</font> <font color="#808080">"utf-8"</font> <font>-f</font> <strong><font color="#FF8040">$ sender</font></strong> <font color="#804000">-</font> <font>server</font> <font>localhost</font> <font color="#804000">-</font> <font>port</font> <font color="#FF0000">465 -</font> <font>u</font> <font>useremail@gmail.com</font> <font color="#804000">-</font> <font>pw</font> <font>password</font> <font color="#804000">-</font> <font>to</font> <strong><font color="#FF8040">$</font></strong> <font>body</font> <font color="#804000">-</font> <font>temp.tmp</font> <font color="#804000">-</font> <font>subject</font> <strong><font color="#FF8040">$ subject</font></strong> <font color="#804000">-</font> <font>base64</font> <font color="#804000">-</font> <font>attach</font> <strong><font color="#FF8040">$ patchname</font></strong> <font color="#804000">&gt;</font> <font>logSendMail. log</font> <br><br>  <strong><font color="#0000FF">rm</font></strong> <strong><font color="#FF8040">$ patchname</font></strong> <br>  <strong><font color="#0000FF">rm</font></strong> <font>temp.tmp</font> <br>  <font>edit</font> <font>logSendMail.log</font> <br>  <strong><font color="#0000FF">sleep</font></strong> <font color="#FF0000">2</font> <font>s</font> <br>  <strong><font color="#0000FF">rm</font></strong> <font>logSendMail.log</font> <br>  <strong><font color="#0000FF">fi</font></strong> </blockquote></li></ul>  These files should lie with all programmers working on the project. <br><br><br><h4>  How it works </h4>  Most importantly, when starting work on a new task, it is necessary in the operational repository of the current programmer to create a branch with the name that TS created when creating the task. <br>  The <strong>prepare-commit-msg</strong> hook inserts in the beginning of the commit message the parameters for sending a letter, such as: <ul><li>  <strong>sendmail</strong> - whether to send a letter.  If the message does not contain a line containing only this word, the letter will not be sent. </li><li>  <strong>to</strong> - what email to send to.  If it is not, then the letter will be sent to the sender. </li><li>  <strong>[new_state = done]</strong> - a directive for TS, which should be assigned to the type ‚ÄúCompleted‚Äù or ‚ÄúFixed‚Äù for a new message. <br>  This parameter can be omitted, then TS will add new messages with the type ‚ÄúComment‚Äù. </li><li>  <strong>newroot</strong> - this parameter denotes the need to remake the subject of the letter.  In TS, it is possible to move subtasks from one task to another, so as not to create a new branch, you can simply specify the new parent of the current task. <br>  For example, you created a subtask (number 2084, ancestor number 754, key new754 # 2084) and started working on it, and then you realized that the subtask should belong to another parent task (number 458, new key new458 # 2084) and moved it to her.  In order for git not to start a new branch, you can add the following code in the commit message <blockquote> <code>newroot=new458</code> </blockquote>  <strong>Important:</strong> each parameter must be on a separate line, the number of spaces or tabs do not affect its detection. </li></ul>  The <strong>post-commit</strong> hook checks the <strong>commit</strong> message for sending options.  creates a patch file with the changes made and a letter, then sends a letter on behalf of the committer to the email specified in the ‚Äúto‚Äù parameter. Here's an example of applying the changes: <br>  Enter in the command line <blockquote> <code>$ git add --all &amp; git gui</code> </blockquote> <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/51/a3/51a378ad09132f072be637d86ac28081.jpg"></a> <br clear="all">  Then press Ctrl + Enter and at the interval that you set the mail collector in TS, check the status of the task. <br clear="all"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/80/75/807563ee352d147009627193c3099336.jpg"></a> <br clear="all">  Here the comment is decorated with html, but this is a topic for a separate post. <br><br><h1>  Conclusion </h1>  A standard workflow consists of 4 main steps: <ol><li>  Setting a task in TS and copying the branch name for git. </li><li>  Creating a branch in git and going to it. <br>  You can execute one command: <blockquote> <code>$ git checkout -b _</code> </blockquote> </li><li>  Doing the task. </li><li>  Completion of work on a task in TS, committing a commit in git. </li></ol>  Step 3 can be extended by intermediate commits in the message, which will not be a directive [new_state = done] - TS will add comments to the task. <br><br><br><h4>  Why use just such a mechanism </h4>  The reason is that TS does not yet have integration with SCM GIT. <br>  And when to appear, it is not clear how the work with distributed repositories will be implemented. <br>  And this solution allows you to work on a task for several programmers who have their own zoo repositories.  And then combine them into one central, in which order and cleanliness. <br>  In addition, it is very convenient to work without having direct access to TS. <br>  A project manager can create tasks and assign specific people to them as responsible.  They will receive emails stating that a task has been created or that he has been appointed responsible.  He sees in the message of the letter what task is set and the name of the branch for git, begins work on the task.  At the end of the work, it quietly makes a commit in the repository and may no longer worry that the task should be completed.  Moreover, he can also remotely create subtasks knowing the key of the ancestor's task by sending emails from which mail is imported into TS with the subject in which the required key is present.  In response, they will also receive letters that he has created a task. <br><br><h2>  Sources </h2><ul><li>  <a href="http://progit.org/book/ru/">ProGit is an online git book</a> . </li><li>  <a href="http://www.trackstudio.ru/documentation.html">TrackStudio documentation</a> . </li><li>  TS_HOME \ docs \ javadoc \ index.html - TrackStudio API manual, comes with TS. </li><li>  <a href="http://nemcd.com/2009/05/otpravka-pisem-windows/">Sending letters from the Windows command line using a GMail account</a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/113554/">https://habr.com/ru/post/113554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113547/index.html">html5 device - audio capture in browsers</a></li>
<li><a href="../113549/index.html">New version of Twitter client for Android. Greater than 140 characters</a></li>
<li><a href="../113550/index.html">Meizu m9</a></li>
<li><a href="../113552/index.html">DIY coffee</a></li>
<li><a href="../113553/index.html">TikTok strap video review</a></li>
<li><a href="../113555/index.html">Flash bitmap printing bug</a></li>
<li><a href="../113557/index.html">Notion Ink Adam can be ordered again</a></li>
<li><a href="../113560/index.html">Microsoft and Nokia announce strategic collaboration</a></li>
<li><a href="../113561/index.html">Let's help Sberbank</a></li>
<li><a href="../113563/index.html">The owner of the Hotfile resource is accused of promoting piracy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>