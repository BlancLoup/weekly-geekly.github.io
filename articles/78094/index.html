<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to build a binary deb package: detailed HowTo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I will tell on an abstract example how to properly create a * .deb package for Ubuntu / Debian. We will make the binary package. Packages that c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to build a binary deb package: detailed HowTo</h1><div class="post__text post__text-html js-mediator-article">  Today I will tell on an abstract example how to <u>properly</u> create a * .deb package for Ubuntu / Debian.  We will make the binary package.  Packages that compile binaries from source codes are not considered here: after you have mastered the knowledge outlined below, you can understand the essence and use similar examples in the future using ready-made examples :) <br><br>  The article will not have any unnecessary fuss "manually": the package format has evolved into a fairly simple, and most importantly, a logical structure, and everything is done literally on the knee, using a couple of specialized utilities. <br><br>  As a bonus, at the end of the article there will be an example of quickly creating your own local repository: installing packages from the repository allows you to automatically track dependencies, and of course!  - install everything with one console command on several machines :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For those who do not want to go into the powerful software installation system in Linux, I recommend visiting <a href="http://www.asic-linux.com.mx/~izto/checkinstall/">the CheckInstall program site</a> : it automatically creates a deb-package from the ‚Äúmake install‚Äù command;) And we, along with the curious, - <a name="habracut"></a><br><br><h4>  Sources </h4><br>  Information is trusted from many places, but here are two main ones: <br><ul><li>  Opennet: L <a href="http://www.opennet.ru/docs/RUS/debian_pkg/deb.html">Introduction to creating packages for the GNU Debian / Linux distribution</a> </li><li>  Debian.org: <a href="http://www.debian.org/doc/debian-policy/">Debian Policy Manual</a> - Official </li><li>  Ubuntu Wiki: <a href="https://wiki.ubuntu.com/PackagingGuide/Basic%3Faction%3Dshow%26redirect%3DHowToBuildDebianPackagesFromScratch/">PackagingGuide / Basic</a> </li></ul><br>  The article details the basics of creating packages that are sufficient to obtain sufficiently powerful application installation management.  More advanced features are omitted, but direct links to documentation for those interested are suggested. <br>  The article is not a copy or a translation of any documentation: it is a collection of knowledge, lying in the form of notes, and now decorated in the form of an article.  For clarity, there are examples everywhere, explanations on the fingers, convenient features I found and some typical mistakes that can be made out of ignorance. <br><br><h4>  Training </h4><br><br><h5>  Why is this all about? </h5><br>  Yes, CheckInstall can create a work package, but it does not support all the goodies that deb packages are capable of :) Namely: <br><ul><li>  Scripts running before, after <s>and instead of</s> installing the package :) </li><li>  Automatic configuration files management: the package will not allow to wipe the old configs without new ones </li><li>  Working with templates: the ability to ask the user questions during installation (!!!) </li><li>  Modify files of other packages </li></ul><br><br><h5>  What is required </h5><br>  Of course, tar, gz, ar archivers will be enough to create a full-fledged package, but you can eliminate the extra fuss, and use the tools created to make life easier :) <br>  We put: <br> <code>$ sudo apt-get install dpkg debconf debhelper lintian</code> <br> <br><h5>  What do we do </h5><br>  For example, a certain script /usr/bin/super.sh will be considered.  It doesn't matter what's inside, the main thing is how it will appear on the right place :) <br><br><h5>  Folder preparation </h5><br>  In the home directory (or where convenient) create a folder in which all files of the future package will be located: <code>mkdir ~/supersh</code> .  Further we will call its <b>package root</b> . <br>  At the root of the package create a folder "DEBIAN" (in capital letters, this is important!).  This folder contains package generation control information, and is not copied to disk when the package is installed. <br>  Also, the root folder of the package contains the future ‚Äúroot of the disk‚Äù: when installing the package, all files (except the ‚Äúdebian‚Äù folder) are unpacked into the root /.  Therefore, our script should follow this path relative to the package root: ‚Äúusr / bin / super.sh‚Äù <br>  White on black: <br> <code>mkdir -p ~/supersh/DEBIAN #   <br> mkdir -p ~/supersh/usr/bin #    <br> cp super.sh ~/supersh/usr/bin/ #      </code> <br>  As a result, we have: <br> <code>supersh/DEBIAN/ <br> supersh/usr/ <br> supersh/usr/bin/ <br> supersh/usr/bin/super.sh <br></code> <br><br><h4>  Build Package: DEBIAN / * </h4><br>  As I said, the DEBIAN folder contains files used during installation.  Here I will describe (with examples) each file. <br>  To create a full-fledged package, the control file ‚Äúcontrol‚Äù is sufficient; all the others are used either to attach textual information (changelog, license), or to manage advanced application installation features. <br>  From the files described below in the folder DEBIAN / * we select the necessary ones and fill in according to the instructions :) <br>  In our example, only <b>mandatory DEBIAN / control is</b> really used. <br><br><h5>  DEBIAN / control: Basic Information </h5><br>  control is the central package file that describes all the basic properties.  The file is a text file consisting of ‚ÄúAttribute: Value‚Äù pairs.  You can use comments: the "#" symbol at the beginning of the line (the feature was added in the dpkg version&gt; = 1.10.11, you should not hope for comments :). <br>  The table shows all the fields defined for the control file.  Required fields are <b>in bold</b> : without them, the package will not be considered as composed correctly. <br><table><tbody><tr><th>  Attribute </th><th>  Description </th><th>  Examples </th></tr><tr><th colspan="3">  - basic - </th></tr><tr><td>  <b>Package:</b> </td><td>  Package Name: [a-zA-Z0-9-] - only Latin, numbers, and hyphen.  The name is used during installation: apt-get install &lt;package&gt; </td><td> <code>Package: supersh</code> </td> </tr><tr><td>  <b>Version:</b> </td><td>  Version of the package (and the program inside).  Used to determine whether to update. <br>  The format is as follows: <code>&lt;_&gt;-&lt;_&gt;</code> . <br>  I recommend to <b>always</b> indicate the version of the package: when changing the structure of the package, the figure is increased by one. <br>  Valid characters are quite voluntary: you can use the date and letters.  See examples in your repository today :) </td><td> <code>Version: 1.0-1&lt;br&gt;Version: 2009.12.12-1</code> </td> </tr><tr><td>  Provides </td><td>  The application name (possibly virtual) registered in the system as a result of the installation of this package. <br>  Rarely used: mainly if you need to change the name of the package, or if more than one package offers the same functionality.  For example, the Apache and nginx packages provide the httpd: <code>Provides: httpd</code> daemon feature <br>  You probably encountered an error when trying to install: "is a virtual package".  This is it :) </td><td> <code>Provides: supersh</code> </td> </tr><tr><td>  <b>Maintainer</b> </td><td>  The name and mail of the package maintainer: the person who ‚Äúdebianized‚Äù the application. <br>  The format is arbitrary, but the <code> &lt;e-mail&gt;</code> accepted <code> &lt;e-mail&gt;</code> </td><td> <code>Maintainer: o_O Tync &lt;oo-tync.habrahabr.ru&gt;</code> </td> </tr><tr><td>  <b>Architecture</b> </td><td>  The processor architecture for which the package is intended. <br>  Valid values: <code>i386, amd64, all, source</code> <br>  <code>all</code> used for scripts: they are portable, right?  :) <br>  <code>source</code> used for compiled source packages. </td><td> <code>Architecture: all</code> </td> </tr><tr><td>  <b>Section</b> </td><td>  Specifies the task for which the application is typically used (group of applications). <br>  Possible values: admin, base, comm, contrib, devel, doc, editors, electronics, embedded, games, gnome, graphics, hamradio, interpreters, kde, libs, libdevel, mail, math, misc, net, news, non-free , oldlibs, otherosfs, perl, python, science, shells, sound, tex, text, utils, web, x11 </td><td> <code>Section: misc</code> </td> </tr><tr><td>  <b>Description</b> </td><td>  Description of the package. <br>  The description consists of two parts: a short description (70 characters) on the same line, and a long description on subsequent lines, <b>starting with a space</b> . <br>  In the extended description, all line breaks are ignored.  A single point is used to insert \ n. </td><td> <code>Description: Short.&lt;br&gt;‚ê£Long &lt;br&gt;‚ê£goes here.&lt;br&gt;‚ê£.&lt;br&gt;‚ê£New line.</code> </td> </tr><tr><th colspan="3">  - connections and dependencies - </th></tr><tr><td>  Depends </td><td>  A comma-separated list of packages that are required to install this package. <br>  After the package name, you can indicate the limit on the version in parentheses using the operators: &lt;&lt;, =, &gt;&gt;, &lt;=,&gt; =.  If the operator is not specified, it is used&gt; = </td><td> <code>Depends: dpkg, libz (&gt;= 1.2.3), jpeg (= 6b), png (&lt; 2.0)</code> </td> </tr><tr><td>  Pre-depends </td><td>  List of packages that are required during the installation of this package. <br>  These dependencies may be required for package installation scripts: for example, the flash-installer package requires wget <br>  Version restrictions can be used (see Depends). </td><td> <code>Pre-Depends: wget (&gt;= 1.0)</code> </td> </tr><tr><td>  Conflicts </td><td>  List of packages that cannot be installed at the same time. <br>  Installation will fail if at least one of the listed packages is already installed. </td><td> <code>Conflicts: crapscript</code> </td> </tr><tr><td>  Replaces </td><td>  The list of packages whose files are modified by this package. <br>  Required if you create a ‚Äúpatch package‚Äù that changes something: otherwise, when replacing files of someone else's package, an error will occur during installation.  For example, I have such a package of patch UT2004 and removes the sound of the proposed rocket launcher :) </td><td> <code>Replaces: ut2004</code> </td> </tr><tr><td>  Recommends </td><td>  List of recommended packages for installation <br>  These packages are optional, but are usually used with current </td><td> <code>Recommends: superplatform</code> </td> </tr><tr><td>  Suggests </td><td>  List of packages offered for installation. <br>  These packages are not required, but with them the program works even better :) In theory, the package manager should offer to install them. </td><td> <code>Suggests: supersh-modules</code> </td> </tr><tr><td>  Build-depends </td><td>  (For Architecture: source only) <br>  List of packages required to compile the source. <br>  Same as Depends, but logically separated. </td><td> <code>Build-Depends: cmake</code> </td> </tr><tr><th colspan="3">  - extra - </th></tr><tr><td>  Installed-Size </td><td>  The size of the package files in kilobytes. <br>  Just a figure, rounded to the nearest integer.  Used by the package manager to determine the total required disk space. </td><td> <code>Installed-Size: 3</code> </td> </tr><tr><td>  Priority </td><td>  Package priority: how important is it in the system? <br>  Possible values: extra, optional, standard, important, required (such packages are not removed at all!). </td><td> <code>Priority: optional</code> </td> </tr><tr><td>  Esssential </td><td>  If you set this attribute to ‚Äúyes‚Äù, the package cannot be deleted. </td><td> <code>Esssential: yes</code> </td> </tr><tr><td>  Origin </td><td>  Line: from where the programs are received in the package.  Usually the author‚Äôs site URL, mail or name is used. </td><td> <code>Origin: brain</code> </td> </tr><tr><td>  X-source </td><td>  Full link to * .tar.gz archive with sources </td><td> <code><a href="http:/"></a> X-Source: ...*.tgz</code> </td> </tr></tbody></table><br>  Yes, these are the solid features of the control file :) <br>  And in our example, it looks like this: <br> <code>Package: supersh <br> Version: 1.0-1 <br> Section: misc <br> Architecture: all <br> Depends: bash, sed (&gt;= 3.02-8) <br> Maintainer: o_O Tync &lt;oo-tync.habrahabr.ru&gt; <br> Description: Super Shell Script <br> ‚ê£A super example script. <br> ‚ê£. <br> ‚ê£It does nothing :) <br></code> <br><br><h5>  DEBIAN / copyright: ¬© / license </h5><br>  The text of the license.  The file is not required, but it is better to underline your authorship;) <br><br><h5>  DEBIAN / changelog: change history </h5><br>  Changelog in a special format: use dpkg to get the version number, revision, distribution and importance of the package.  It is better to look in the <a href="http://www.debian.org/doc/debian-policy/ch-source.html">official documentation</a> ;) and I will only give an example: <br> <code>supersh (1.0-1) stable; urgency=medium <br> <br> * Testing. <br> <br> -- o_O Tync &lt;oo-tync.habrahabr.ru&gt; Sun, 13 Dec 2009 00:11:46 +0300 <br></code> <br><br><h5>  DEBIAN / rules: compilation rules </h5><br>  Used to manage package compilation: this is when <code>Architeture: source</code> :) <br>  See the <a href="http://www.debian.org/doc/debian-policy/ch-source.html">official documentation.</a> <br><br><h5>  DEBIAN / conffiles: list of configuration files </h5><br>  Usually packages contain clumps of configuration files, for example, placed in / etc.  Obviously, if the config in the package is updated, the user will lose his edited config.  This problem is easily solved by using folders of the ‚Äúconfig.d‚Äù type, the contents of which are included in the main config, replacing the recurring options. <br>  The file "DEBIAN / conffiles" allows you to solve the problem differently: it contains a list of configuration files (one per line).  If in the current version of the package one of these files is updated, the user receives a warning about the conflict of versions of configs, and can choose: delete, replace, or make a merge. <br>  Every linuxid who has been digging into configs probably came across this situation :) And his legs are growing from here. <br>  On each line there should be a full absolute path to each config.  For example: <br> <code>/etc/supersh/init.conf <br> /etc/supersh/actions.conf <br></code> <br><br><h5>  DEBIAN / dirs: a list of folders to create </h5><br>  ‚ÄúThe list of absolute paths to folders that are required by the program, but for some reason are not created.‚Äù Says the official documentation.  In practice, all the folders used by the program are listed here: where the binaries lie and which are used by the program. <br>  One per line.  For example: <br> <code>/var/log/supersh <br> /var/lib/supersh</code> <br>  Convenient to use to create multiple empty folders. <br><br><h5>  DEBIAN / menu: creating menu items </h5><br>  Tricky file to create menu items.  It did not work for me :) It seems that its contents are used either in unusual window managers, or in some kind of console menu ... or it was used before and was forgotten :) <br>  Example: <br> <s><code>?package(supersh):needs="text" section="Applications/Programming" title="Super Shell Script" command="/usr/bin/super.sh"</code></s> <br>  TODO: find out why.  This is written in the <code>man5 menufile</code> , to be honest, I did not penetrate :) <br><br><h6>  UPD: The correct way to add a menu item </h6><br>  The file / DEBIAN / menu creates an unknown and it‚Äôs not clear where: the graphic menu items are still not created.  Therefore, we will do right :) <br>  In <code>/usr/share/applications</code> we see a bunch of <code>*.desktop</code> files: these are menu items.  They are text files with syntax like an ini file.  We open, learn, do the same and put the resulting <code>*.desktop</code> file into <code>usr/share/applications/</code> .  The icon for it should be in <code>usr/share/pixmaps</code> . <br>  After that, in the postinst script you need to add the execution of the update menu command: <br> <code>if [ "$1" = "configure" ] &amp;&amp; [ -x "`which update-menus 2&gt;/dev/null`" ] ; then <br> update-menus <br> fi <br></code> <br>  The work with package installation scripts will be discussed below. <br>  Thanks to <a href="https://habrahabr.ru/users/condorious/" class="user_link">Condorious</a> for the tip :) <br><br><h5>  DEBIAN / md5sums: file checksums </h5><br>  Used to verify the integrity of the package.  Important file. <br>  It is filled like this (cwd = package root): <br> <code>$ md5deep -r usr &gt; DEBIAN/md5sums</code> <br> <br><h5>  DEBIAN / watch: monitoring the site where the program was downloaded from </h5><br>  The function is useful if you are a maintenite from several dozen packages, and it is difficult to keep track of all the updates. <br>  The file contains instructions for uscan and uupdate.  Using this feature, you can monitor the site from which the source package was obtained, and ensure quality control of the distribution in general. <br>  Example: <br> <code># Site Directory Pattern Version Script <br> ftp.obsession.se /gentoo gentoo-(.*)\.tar\.gz debian uupdate <br></code> <br>  And another example for uscan (1): <br> <code><a href="http://madwimax.googlecode.com/files/madwimax-"></a> version=3 <br> madwimax.googlecode.com/files/madwimax-(.*)\.tar\.gz <br></code> <br>  Better read the <a href="http://dehs.alioth.debian.org/">official documentation</a> , such powerful things are infrequently required by mere mortals :) <br><br><h5>  DEBIAN / cron.d: install cron jobs </h5><br>  The file contains a piece of crontab for installation.  An example explains everything: <br> <code># <br> # Launches super.sh periodically <br> # <br> 0 4 * * * root [ -x /usr/bin/super.sh ] &amp;&amp; usr/bin/super.sh <br></code> <br><br><h5>  DEBIAN / inid.d: init-script </h5><br>  The contents of the init-script are written to this file.  About writing init scripts in the internet can be found <br><br><h4>  Scripting </h4><br>  We come to the most interesting part: embedding scripts in deb packages.  Scripts allow you to manage the installation, reinstallation and removal of a package by performing actions that cannot be done by simply copying files to the right places.  This may be downloading additional files (as flash-installer does), modifying existing ones, and also displaying interactive (GUI or ncurses) dialogs that allow the user to configure the package for himself: for example, mysql asks which password to set to root. <br>  All scripts are executed from the root user (and how else :).  They also receive arguments (which are optional to process), specifying at what stage the installation is located.  Read more about it <a href="http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html">here</a> . <br><br><h5>  DEBIAN / (preinst | postinst | prerm | postrm): installation scripts </h5><br>  In total, you can create up to four scripts in one package: <br><table><tbody><tr><th>  Script </th><th>  Purpose </th></tr><tr><th>  DEBIAN / preinst </th><td>  Runs before installing the package: it can prepare something for a successful installation. </td></tr><tr><th>  DEBIAN / postinst </th><td>  It is executed immediately after installing the package: it configures the installed package so that it is ready for operation.  It also runs the interactive configuration of the package: this is done using dh_input and the DEBIAN / templates file </td></tr><tr><th>  DEBIAN / prerm </th><td>  It is executed immediately before removing the package: usually this script cleans up the installation paths of the package so that nothing extra is left over :) </td></tr><tr><th>  DEBIAN / postrm </th><td>  Runs immediately after removing a package: cleans up leftovers </td></tr></tbody></table><br>  Please note that errors that occur in these scripts <b>are not logged in any way</b> : nothing more interesting than the script's return code is not saved anywhere, and logging must be done manually!  Users of one of my packages failed to install on Linux Mint, and it was not even possible to ask them for a log of errors (which is not present) in order to find out the reason :) <br>  I recommend using the following disc at the beginning of each script: it will save any errors that occur in the syslog. <br> <code>#!/bin/bash <br> set -e # fail on any error <br> set -u # treat unset variables as errors <br> <br> # ======[ Trap Errors ]======# <br> set -E # let shell functions inherit ERR trap <br> <br> # Trap non-normal exit signals: <br> # 1/HUP, 2/INT, 3/QUIT, 15/TERM, ERR <br> trap err_handler 1 2 3 15 ERR <br> function err_handler { <br> local exit_status=${1:-$?} <br> logger -s -p "syslog.err" -t "ootync.deb" "supersh.deb script '$0' error code $exit_status (line $BASH_LINENO: '$BASH_COMMAND')" <br> exit $exit_status <br> } <br> <br> ...     ... <br> <br> exit 0 <br></code> <br>  WARNING: the disc has not been tested extensively yet, check it out once more!  I came across the impossibility of debugging recently :) <br><br><h5>  DEBIAN / templates: templates for dialogs </h5><br>  As already mentioned, in the DEBIAN / config script, you can ask the user questions: enter a line, select one of the options, tick, ... This is the ‚Äúlibrary‚Äù bash of the debhelper functions of the debconf package, which also knows a lot of useful things.  I don‚Äôt consider them here :) <br>  The DEBIAN / templates file contains the data used when displaying dialog boxes (GUI or ncurses).  The file contains blocks separated by an empty line.  Each block defines the resources used in one particular dialog box. <br>  The cap for all types of dialog is standard: <br> <code>Template: supersh/template-name <br> Type: string <br> Default: Default-value <br> Description: Dialog-title <br> ‚ê£Dialog-text <br></code> <br>  Template - unique (within one package) template identifier.  If a script needs to call a specific dialog, this is the name that is used. <br>  Type - the type of template.  The following types are defined: string, password, boolean, select, multiselect, text, note, error. <br>  Default-value is the default value: the user can simply accept it. <br>  Description - as in the control file, consists of two fields: a short description, and a long text.  The first is the ‚Äúwindow‚Äù title, the second is a more detailed description of what is required of the user.  It is recommended not to use words like ‚Äúenter‚Äù, but immediately the essence: ‚ÄúGreeting the script‚Äù, ‚ÄúMount point‚Äù, ... <br><br><table><tbody><tr><th>  Type of </th><th>  Template Description </th></tr><tr><th>  string </th><td>  Invitation to enter a text string </td></tr><tr><th>  password </th><td>  Password prompt <br>  There is no Default value for this template type for obvious reasons :) </td></tr><tr><th>  boolean </th><td>  Tick ‚Äã‚Äã:) Has a string value of "true" or "false" </td></tr><tr><th>  select </th><td>  Ability to select one of several options. <br>  Options are offered in an additional attribute of the template: <br> <code>Choices: yes, no, maybe</code> </td> </tr><tr><th>  multiselect </th><td>  Ability to select multiple options tick. <br>  Options are offered in an additional attribute of the template: <br> <code>Choices: sex, drugs, rock-n-roll</code> </td> </tr><tr><th>  text </th><td>  Displays text: some not-so-important information. </td></tr><tr><th>  note </th><td>  Displays text: important information </td></tr><tr><th>  error </th><td>  Displays the text: very important information, critical. </td></tr></tbody></table><br>  For text, note, error templates there is also no Default value, since they only display information :) <br>  Let's play with the following template: <br> <code>Template: supersh/greeting <br> Type: string <br> Description: Welcome message <br> ‚ê£The message you wish the script to welcome you with. <br> Default: Greetings, my master! <br></code> <br><br><h5>  Basics of using debconf and debhelper </h5><br>  These are only workable sketches.  In the original, read about templates and working with them here: <code>man 7 debconf-devel</code> :) <br>  To use templates in your DEBIAN / config configuration script, you must first enable the debhelper functions: <br> <code>. /usr/share/debconf/confmodule</code>  <code>. /usr/share/debconf/confmodule</code> .  Also, this file must be included in the postinst script: otherwise the DEBIAN / config script will not run at all! <br>  These features are available in the debconf package; don't forget to enable it depending! <br>  Primitive use case.  DEBIAN / config file <br> <code>#!/bin/bash -e <br> <br> #   debconf <br> . /usr/share/debconf/confmodule <br> <br> case "$1" in <br> configure|reconfigure) <br> #  <br> db_input medium "supersh/greeting" || true #  <br> db_go || true #     <br> #   <br> db_get "supersh/greeting" #     $RET <br> greeting="$RET" <br> echo "$greeting" &gt; /etc/supersh/greeting.txt <br> ;; <br> *) <br> echo "config called with unknown argument \`$1'" &gt;&amp;2 <br> exit 1 <br> ;; <br> esac <br> #  <br> db_input medium "supersh/greeting" || true #  <br> db_go || true #     <br> <br> #   <br> db_get "supersh/greeting" #     $RET <br> greeting="$RET" <br> echo "$greeting" &gt; /etc/supersh/greeting.txt <br></code> <br>  There is already an unpleasant ambush: note that the dialogue priority of the medium is transferred to the db_input function.  For debconf, you can set a minimum priority: dialogs with a priority below which are not displayed, but the default value (template default) is taken!  To prevent this EXACTLY from happening - we use the priority of critical :) In addition, when installing from the GUI, the threshold for displaying questions is higher, and many of them are not displayed at all. <br>  Possible priorities: low - always use default, medium - default is usually quite suitable, high - default is undesirable, critical - user's attention is vital. <br> <code>|| true</code>  <code>|| true</code> used to prevent the script from dying due to the "-e" key sent by bash. <br>  In this script, it is also recommended to use that disc for catching errors, otherwise debugging problems may occur with the distributed package :) <br>  All the subtleties of using debconf (functions, methods, parameters, error codes) are described in a rather verbose manner: <code>man debconf-devel</code> . <br><br>  One last thing: when removing a package with the purge command, debconf should also clear the package information from its database.  For example, it saves user selection when db_input requests. <br>  To clear this data, add the following to the postinst script: <br> <code>if [ "$1" == "purge" ] &amp;&amp; [ -e /usr/share/debconf/confmodule ] ; then <br> . /usr/share/debconf/confmodule <br> db_purge <br> fi <br></code> <br><br><h4>  Putting the package!  :) </h4><br>  Hooray!  All the necessary files are created, are on the right daddy.  Now it's time to pack :) <br>  The first thing to do is to recursively set all the files in the root of the user's package and the root group: root (or others if necessary).  It is necessary then that the package files are packed into a tar.gz archive which preserves both the rights of access to the files and the owner.  Because you need to perform: <br> <s><code>$ sudo chown -R root:root .</code></s> <br>  However, this is not necessary.  There is a great fakeroot command that, when creating an archive, will replace the owner of files with root. <br>  In our example, the script should have a doable bit. <br>  Then we go back to the folder so that the root folder of the package can be seen, and the package is created with a <s>light kick by</s> itself: <br> <code>$ fakeroot dpkg-deb --build supersh</code> <br>  The created package must be renamed to correspond to the naming order of * .deb packages: &lt;package name&gt; _ &lt;version&gt; _ &lt;architecture&gt; .deb <br> <code>$ mv supersh.deb supersh_1.0-1_all.deb</code> <br>  Everything, the package is ready! <br><br><h5>  Automatic package check </h5><br>  There is a lintian utility that allows you to check a package and identify common errors in its structure.  This is done like this: <br> <code>$ lintian supersh_1.0-1_all.deb</code> <br> <br><h5>  Package installation </h5><br> <code>$ sudo dpkg -i supersh_1.0-1_all.deb</code> <br> <br><h4>  Create your own package repository </h4><br>  Now we have our own package.  When there are several, and even more so with dependencies, it turns out that it is much more convenient to quickly raise your own local micro-repository, and include it in the list of package manager sources :) Here I will describe the quick HowTo ‚Äúhow to create your repository‚Äù.  The idea will be easy to develop by reading the relevant documentation :) <br>  First install the assistant: <br> <code>$ sudo apt-get install reprepro</code> <br> <br><h5>  Description of the future repository </h5><br>  Center repository - its description.  The main thing in it is the list of repository components.  We will create soft and games components. <br>  Select a folder for the future repository.  All actions are made from its root. <br>  Create a conf / distributions file with the following content: <br> <code>Description: my local repository <br> Origin: Ubuntu <br> Suite: testing <br> AlsoAcceptFor: unstable experimental <br> Codename: karmic <br> Version: 5.0 <br> Architectures: i386 amd64 source <br> Components: soft games <br> UDebComponents: soft games <br></code> <br>  In our business of creating a simple repository, all fields do not play a fundamental role, and are used only for the visual definition of "what is what" :) <br><br><h5>  Creating a repository </h5><br>  The repository is described!  Now we will generate a blank based on the description.  Commands are executed in the repository root: <br> <code>$ reprepro export <br> $ reprepro createsymlinks</code> <br>  And add the ready repository to /etc/apt/sources.list: <br> <code>deb file:///path/to/repo/ karmic soft games</code> <br>  This repository can also be shared using a web server. <br><br><h5>  Package Management in the repository </h5><br>  Put in the root of the repository * .deb files to add, and add them to the soft component of the karmic distribution: <br> <code>reprepro -C soft includedeb karmic *.deb</code> <br>  Now packages are available from the package manager :) <br>  Removing packages: <br> <code>reprepro -C soft remove karmic supersh</code> <br> <br><h4>  The finish </h4><br>  The article describes the materials for creating deb packages.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emphasis is placed on moments for which the network does not have a sufficiently clear description. </font><font style="vertical-align: inherit;">I hope that my attempt to explain simply and clearly did not fail :) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Homework :)) - quite well documented things that are easy to find in man's and articles:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating source packages that compile source files: using the example of Zabbix, the mabrao </font></font><a href="https://habrahabr.ru/users/mahoro/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habrauzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> told about it perfectly </font><font style="vertical-align: inherit;">in </font></font><a href="http://mahoro.habrahabr.ru/blog/78086/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">his article</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debconf, debhelper in configuration scripts: read mana by debconf-devel and debhelper. </font><font style="vertical-align: inherit;">They also allow you to create a skeleton package with the dh_make command.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Advanced ways to create documentation in packages: DEBIAN / docs, DEBIAN / manpage. * Files </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creating init scripts </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cron job management </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Signing the repository with gpg key </font></font></li></ul><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> @ ICD2 </font></font><a href="https://habr.com/ru/post/78094/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tells you</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that there is a GUI program for creating packages: </font></font><a href="http://giftwrap.tuxfamily.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GiftWrap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cheers!</font></font> :) <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS The article probably contains inaccuracies and errors. </font><font style="vertical-align: inherit;">Let's comb it together!</font></font> :) </div><p>Source: <a href="https://habr.com/ru/post/78094/">https://habr.com/ru/post/78094/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../78082/index.html">Mobile Firefox will be released before the end of the month</a></li>
<li><a href="../78084/index.html">Conversations with BlogMoneyTvitoPipply</a></li>
<li><a href="../78086/index.html">Debian-packages with a human face on the example of Zabbix 1.8</a></li>
<li><a href="../78088/index.html">Dropbox 0.7 - new version with support for LAN sync, as well as DropboxPortable for flash drives</a></li>
<li><a href="../78092/index.html">Big brother is watching you!</a></li>
<li><a href="../78095/index.html">Review of Android communicator for $ 210, DualSIM, 5Mp, WiFi</a></li>
<li><a href="../78101/index.html">The recipe is simple cooking OpenVPN. Step-by-step instruction</a></li>
<li><a href="../78102/index.html">Esoteric programming language called "... your mother"</a></li>
<li><a href="../78103/index.html">How do I conduct myself on a freelance website</a></li>
<li><a href="../78104/index.html">Christmas Quiz by allsoft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>