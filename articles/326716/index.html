<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Native ECMAScript Modules - First Review</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to share a translation of an article about native ECMAScript modules , which are more and more discussed among front-tenders. J...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Native ECMAScript Modules - First Review</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/tuturu/blog/326716/"><img src="https://habrastorage.org/getpro/habr/post_images/be1/220/2ad/be12202ad80598308949f8bfe6b8b728.png" alt="Bundlers and compilers against native modules"></a> <br><br>  <i>In this article I want to share a translation of an article about native <a href="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript modules</a> , which are more and more discussed among front-tenders.</i>  <i>Javascript has never previously supported natively working with modules, and we, the front-tenders, always had to use additional tools for working with modules.</i>  <i>But you just imagine that soon you will not need to use Webpack to create bundles of modules.</i>  <i>Imagine a world in which the browser will collect everything for you.</i>  <i>I want to tell you more about these prospects.</i> <br><a name="habracut"></a><br>  In 2016, many interesting features and utilities from new standards were added to browsers and Nodejs, in particular, the <a href="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript 2015</a> specification.  Now we are faced with a situation where support among browsers is close to 100%: <br><br><img src="https://habrastorage.org/files/cfe/bcf/4f0/cfebcf4f0aa44d4d81469fb60fdf0625.png" alt="EcmaScript 6 Compatibility Chart">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Also, <a href="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript modules</a> (often called ES / ES6 modules) are actually introduced into the standard.  This is the only part of the specification that required and requires the most time to implement, and no browser has yet released them in a stable version. <br><br>  Recently, Safari 19 Technical Preview and Edge 15 have added the implementation of modules without using flags.  The time is already approaching when we can abandon the use of the usual bundles and transfiguration of modules. <br><br>  To better understand how the world of frontend came to this, let's start with the history of JS modules, and then take a look at the current benefits and implementations of ES6 modules. <br><br><h2>  A bit of history </h2><br>  There were many ways to connect modules.  I will cite as an example the most typical of them: <br><br>  1. Just a long code inside the script tag.  For example: <br><br><pre><code class="javascript hljs">&lt;!--html--&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"application/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="actionscript"><span class="xml"><span class="actionscript"> </span></span><span class="hljs-comment"><span class="xml"><span class="actionscript"><span class="hljs-comment">// module1 code // module2 code </span></span></span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  2. Sharing logic between files and connecting them with script tags: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* js */</span></span> <span class="hljs-comment"><span class="hljs-comment">// module1.js // module1 code // module2.js // module2 code</span></span></code> </pre><br><pre> <code class="javascript hljs">&lt;!--html--&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"application/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"PATH/module1.js"</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script type=<span class="hljs-string"><span class="hljs-string">"application/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"PATH/module2.js"</span></span> &gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  3. A module as a function (for example: a module function that returns something; a self-invoking function or a constructor function) + Application file / model that will be the entry point for the application: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// polyfill-vendor.js (function(){ // polyfills-vendor code }()); // module1.js function module1(params){ // module1 code return module1; } // module3.js function module3(params){ this.a = params.a; } module3.prototype.getA = function(){ return this.a; }; // app.js var APP = {}; if(isModule1Needed){ APP.module1 = module1({param1:1}); } APP.module3 = new module3({a: 42});</span></span></code> </pre><br><pre> <code class="javascript hljs">&lt;!--html--&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"application/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"PATH/polyfill-vendor.js"</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script type=<span class="hljs-string"><span class="hljs-string">"application/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"PATH/module1.js"</span></span> &gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script type=<span class="hljs-string"><span class="hljs-string">"application/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"PATH/module2.js"</span></span> &gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script type=<span class="hljs-string"><span class="hljs-string">"application/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"PATH/app.js"</span></span> &gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  To all this, the Frontend community has invented many varieties and new ways that added variety to this holiday of anarchy. <br><br>  The basic idea is to provide a system that allows you to simply connect a single JS file link, like this: <br><br><pre> <code class="javascript hljs">&lt;!--html--&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"application/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"PATH/app.js"</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  But it all came down to the fact that the developers chose the side of the bandlers - code assembly systems.  Further it is proposed to consider the main implementations of modules in JavaScript <br><br><h2>  Asynchronous Module Definition ( <a href="https://en.wikipedia.org/wiki/Asynchronous_module_definition">AMD</a> ) </h2><br>  This approach is widely implemented in the <a href="http://requirejs.org/">RequireJS</a> library and in tools such as <a href="">r.js</a> for creating the resulting bundle.  General syntax: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// polyfill-vendor.js define(function () { // polyfills-vendor code }); // module1.js define(function () { // module1 code return module1; }); // module2.js define(function (params) { var a = params.a; function getA(){ return a; } return { getA: getA } }); // app.js define(['PATH/polyfill-vendor'] , function () { define(['PATH/module1', 'PATH/module2'] , function (module1, module2) { var APP = {}; if(isModule1Needed){ APP.module1 = module1({param1:1}); } APP.module2 = new module2({a: 42}); }); });</span></span></code> </pre><br><h2>  <a href="https://en.wikipedia.org/wiki/CommonJS">Commonjs</a> </h2><br>  This is the main format of modules in the Node.js ecosystem.  One of the main tools for creating bundles for client devices is <a href="http://browserify.org/">Browserify</a> .  The peculiarity of this standard is the provision of a separate scope for each module.  This avoids unintended leakage of global variables and global scope. <br><br>  Example: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// polyfill-vendor.js // polyfills-vendor code // module1.js // module1 code module.exports= module1; // module2.js module.exports= function(params){ const a = params.a; return { getA: function(){ return a; } }; }; // app.js require('PATH/polyfill-vendor'); const module1 = require('PATH/module1'); const module2 = require('PATH/module2'); const APP = {}; if(isModule1Needed){ APP.module1 = module1({param1:1}); } APP.module2 = new module2({a: 42});</span></span></code> </pre><br><h2>  ECMAScript modules (aka ES6 / ES2015 / native JavaScript modules) </h2><br>  Another way to work with modules came to us from ES2015.  The new standard has a new syntax and features that meet the needs of the frontend, such as: <br><br><ul><li>  individual module scopes </li><li>  strict default mode </li><li>  cyclic dependencies </li><li>  the ability to easily break the code, following the specification </li></ul><br>  There are many implementations of bootloaders, compilers, and approaches that support one or more of these systems.  For example: <br><br><ul><li>  <a href="https://webpack.github.io/">Webpack</a> </li><li>  <a href="https://github.com/systemjs/systemjs">Systemjs</a> </li><li>  <a href="http://jspm.io/">Jspm</a> </li><li>  <a href="https://babeljs.io/">Babel</a> </li><li>  <a href="https://github.com/umdjs/umd">UMD</a> </li></ul><br><h2>  Instruments </h2><br>  Today in JavaScript, we are used to using various tools for combining modules.  If we are talking about ECMAScript modules, you can use one of the following: <br><br><ul><li>  <a href="https://github.com/rollup/rollup">Rollup</a> </li><li>  <a href="https://github.com/google/traceur-compiler">Traceur compiler</a> </li><li>  <a href="https://babeljs.io/">Babel</a> , in particular, a plugin for <a href="https://babeljs.io/docs/plugins/transform-es2015-modules-commonjs/">converting ES2015 modules to CommonJS</a> </li><li>  <a href="https://webpack.github.io/docs/roadmap.html">Webpack 2</a> with its Tree Shaking (remove unused code) </li><li>  <a href="https://www.typescriptlang.org/">TypeScript</a> - as a transpiler </li></ul><br>  As a rule, the tool provides a CLI interface and the ability to customize the configuration for creating bundles from your JS files.  It gets entry points and a set of files.  Usually such tools automatically add ‚Äúuse strict‚Äù.  Some of these tools also know how to translate code to make it work in all environments that are needed (old browsers, Node.js, etc.). <br><br>  Let's take a look at the simplified WebPack config that sets the entry point and uses Babel for the transporting of JS files: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// webpack.config.js const path = require('path'); module.exports = { entry: path.resolve('src', 'webpack.entry.js'), output: { path: path.resolve('build'), filename: 'main.js', publicPath: '/' }, module: { loaders: { "test": /\.js?$/, "exclude": /node_modules/, "loader": "babel" } } };</span></span></code> </pre><br>  The config consists of the main parts: <br><br><ol><li>  start with webpack.entry.js </li><li>  use Babel louder for all JS files (i.e., the code will be transported depending on the presets / plugins + a bundle will be generated) </li><li>  The result is placed in the main.js file. </li></ol><br>  In this case, as a rule, the index.html file contains the following: <br><br><pre> <code class="javascript hljs">&lt;script src=<span class="hljs-string"><span class="hljs-string">"build/main.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  And your application uses JS bundles / transpiled code.  This is a general approach to working with bundlers, let's see how to make it work in a browser without any bundles. <br><br><h2>  How to make JavaScript modules work in the browser </h2><br><h3>  Browser Support </h3><br>  Today, every modern browser has support for ES6 modules: <br><br><ul><li>  Firefox - <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D568953">implemented, available under the flag in Firefox 54+</a> </li><li>  Chrome - <a href="https://www.chromestatus.com/features/5365692190687232">under development</a> </li><li>  EDGE - <a href="https://developer.microsoft.com/en-us/microsoft-edge/platform/status/moduleses6/%3Fq%3Dmodule">implemented, available under the flag in EDGE 15 Preview Build 14342+</a> </li><li>  Webkit - <a href="https://webkit.org/status/">implemented, available by default Safari Technology Preview 21+</a> </li><li>  Node.js - <a href="">pending, require additional discussion</a> </li></ul><br><img src="https://habrastorage.org/files/029/a20/b21/029a20b21aa643f1bff736b17a13779d.png"><br><h3>  Where can I check </h3><br>  As you have seen, currently you can check out the native JS modules in Safari Technology Preview 19+ and EDGE 15 Preview Build 14342+.  Let's download and try the modules in action. <br><br><h3>  ES modules are available in Firefox </h3><br>  You can download <a href="https://www.mozilla.org/en-US/firefox/channel/desktop/">Firefox Nightly</a> , which means that modules will soon appear in <a href="https://www.mozilla.org/en-US/firefox/developer/">FF Developer Edition</a> , and then in a stable version of the browser. <br><br>  To enable ES modules: <br><br><ul><li>  open the `about: config` page </li><li>  Click ‚ÄúI accept the risk!‚Äù </li><li>  find the `dom.moduleScripts.enabled` flag </li><li>  double click to change the flag to true </li></ul><br>  And that's it, now you have ES modules available in Firefox. <br><br><h3>  Safari Technology Preview with available ES modules </h3><br>  If you are using MacOS, simply download the latest version of Safari Technology Preview (TP) from <a href="https://developer.apple.com/safari/download/">developer.apple.com</a> .  Install and open it.  Starting with <a href="https://webkit.org/blog/7265/release-notes-for-safari-technology-preview-21/%26usg%3DALkJrhhr4bTdQdc6nyahpX_BoyjStLUXbg">Safari Technology Preview version 21+</a> , ES modules are enabled by default. <br><br>  If it is Safari TP 19 or 20, make sure that the ES6 modules are enabled: go to ‚ÄúDevelop‚Äù ‚Üí ‚ÄúExperimental Features‚Äù ‚Üí ‚ÄúES6 Modules‚Äù. <br><br><img src="https://habrastorage.org/files/6cc/7b5/9b6/6cc7b59b6c3449acbbf4f3f78f4304e2.gif" alt="image"><br><br>  Another option is to <a href="https://webkit.org/downloads/">download the latest Webkit Nightly</a> and play with it. <br><br><h3>  EDGE 15 - enable ES modules </h3><br>  You can <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/%26usg%3DALkJrhjbzpNayQs6n4C61o2ygvZNJFqAIA">download a free virtual machine from Microsoft</a> . <br><br>  Simply select the ‚ÄúMicrosoft EDGE on Win 10 Preview (15.XXXXX)‚Äù virtual machine (VM) and, for example, ‚ÄúVirtual Box‚Äù (also free) as a platform. <br><br>  Install and start the virtual machine, then open the EDGE browser. <br><br>  Go to the about: flags page and enable the Enable experimental JavaScript features flag. <br><br><img src="https://habrastorage.org/files/157/daf/5ab/157daf5ab9b64a70a97ecb085f4f2055.png"><br><br>  That's all, now you have several environments where you can play with the native implementation of ECMAScript modules. <br><br><h2>  Differences between native and assembled modules </h2><br>  Let's start with the native features of the modules: <br><br><ol><li>  Each module has its own scope, which is not global. </li><li>  They are always in strict mode, even when the use strict directive is not specified. </li><li>  A module can import other modules using <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/import%26usg%3DALkJrhhu317ObZLoOW9_S-p5MUHXxtJwGw">import directives</a> . </li><li>  The module can be exported using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export">export</a> . </li></ol><br>  Until now, we have not seen any particularly serious differences from what we are used to with the bandlers.  The big difference is that the entry point must be provided in the browser.  You must provide the script tag with a specific type = "module" attribute, for example: <br><br><pre> <code class="javascript hljs"> &lt;script type= <span class="hljs-string"><span class="hljs-string">"module"</span></span> scr= <span class="hljs-string"><span class="hljs-string">"PATH/file.js"</span></span> &gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  This tells the browser that your script may contain imports of other scripts, and they must be processed accordingly.  The main question that appears here is: <br><blockquote>  Why can't the JavaScript interpreter define modules if the file is essentially a module? </blockquote><br>  <a href="https://www.nczonline.net/blog/2016/04/es6-module-loading-more-complicated-than-you-think/">One of the reasons</a> is that native modules are in strict mode by default, and there are no classic script: <br><br><ol><li>  say, the interpreter analyzes the file, assuming that this is a classic script in a non-strict mode; </li><li>  then he finds the "import / export" directive; </li><li>  in this case, it must start from the very beginning in order to parse the entire code again in strict mode. </li></ol><br>  Another reason - the same file can be valid without strict mode and invalid with it.  Then validity depends on how it is interpreted, which leads to unexpected problems. <br><br>  Determining the type of expected file download opens up many ways to optimize (for example, loading imported files in parallel / before parsing the rest of the html file).  You can find <a href="https://blogs.windows.com/msedgedev/2016/05/17/es6-modules-and-beyond/%26usg%3DALkJrhitcYsRsiGcwOcpyLBMED3zX1VA9Q">some examples</a> <a href="https://blogs.windows.com/msedgedev/2016/05/17/es6-modules-and-beyond/%26usg%3DALkJrhitcYsRsiGcwOcpyLBMED3zX1VA9Q">used by the Microsoft Chakra JavaScript engines for ES modules</a> . <br><br><h2>  Node.js way to specify a file as a module </h2><br>  Node.js environment is different from browsers and using the script tag type = "module" is not particularly suitable.  The <a href="https://github.com/nodejs/node/wiki/ES6-Module-Detection-in-Node">debate</a> is still ongoing about <a href="https://github.com/nodejs/node/wiki/ES6-Module-Detection-in-Node">how to do this in an appropriate way</a> . <br><br>  Some decisions were rejected by the community: <br><br><ol><li>  add ‚Äúuse module‚Äù to each file; </li><li>  metadata in package.json. </li></ol><br>  Other options are still pending (thanks to <a href="https://github.com/bmeck">@bmeck</a> for the hint): <br><br><ol><li>  determining if the file is an ES module; </li><li>  The new file extension for ES6 Modules .mjs, which will be used as a fallback if the previous version does not work. </li></ol><br>  Each method has its pros and cons, and at present there is still no clear answer as to which <a href="">way Node.js will go</a> . <br><br><h2>  A simple example of a native module. </h2><br>  First, let's create a <a href="https://plnkr.co/edit/be0bb3%253Fp%253Dpreview%26usg%3DALkJrhiCFb4UZhxlLPIzPLeJji1aY2S3uw">simple demo</a> (you can run it in browsers that you installed earlier to check the modules).  So this will be a simple module that imports another and calls a method from it.  The first step is to include the file using: <br><br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"module"</span></span>/&gt;</code> </pre> <br><pre> <code class="javascript hljs">&lt;!--index.html--&gt; <span class="xml"><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"main.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Here is the module file: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// main.js import utils from "./utils.js"; utils.alert(` JavaScript modules work in this browser: https://blog.whatwg.org/js-modules `);</span></span></code> </pre><br>  And finally, the imported utilities: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// utils.js export default { alert: (msg)=&gt;{ alert(msg); } };</span></span></code> </pre><br>  As you can see, we left the .js file extension when the import directive is used.  This is another difference from the behavior of the bandler - native modules do not add .js extensions by default. <br><br>  Secondly, let's check the scope of the module ( <a href="https://plnkr.co/edit/i4rZ8U%3Fp%3Dpreview">demo</a> ): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span>; alert(x === <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.x);<span class="hljs-comment"><span class="hljs-comment">//false alert(this === undefined);// true</span></span></code> </pre> <br>  Third, we verify that the native modules are in strict mode by default.  For example, strict mode prohibits deleting simple variables.  <a href="https://plnkr.co/edit/sulRpONj6EZM1Sph7FSd%3Fp%3Dpreview">The following demo</a> shows that an error message appears in the module: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// module.js var x; delete x; // !!! syntax error alert(` THIS ALERT SHOULDN'T be executed, the error is expected as the module's scripts are in the strict mode by default `); // classic.js var x; delete x; // !!! syntax error alert(` THIS ALERT SHOULD be executed, as you can delete variables outside of the strict mode `);</span></span></code> </pre> <br>  Strict mode cannot be bypassed in native modules. <br><br>  <b>Total:</b> <br><br><ul><li>  <b>The .js extension cannot be omitted;</b> </li><li>  <b>the scope is not global, this does not refer to anyone;</b> </li><li>  <b>native modules in strict mode by default (you no longer need to write ‚Äúuse strict‚Äù).</b> </li></ul><br><h2>  Built-in module in script tag </h2><br>  Like regular scripts, you can embed code instead of separating them into separate files.  In the previous demo, you can simply insert main.js directly into the script type = "module" tag, which <a href="https://plnkr.co/edit/ghsd9Z%3Fp%3Dpreview">will lead to the same behavior</a> : <br><br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"module"</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> utils <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils.js"</span></span>; utils.alert(<span class="hljs-string"><span class="hljs-string">` JavaScript modules work in this browser: https://blog.whatwg.org/js-modules `</span></span>); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  <b>Total:</b> <br><br><ul><li>  <b>script type = "module" can be used both for loading and executing an external file, as well as for executing embedded code in the script tag.</b> </li></ul><br><br><h2>  How the browser loads and executes modules </h2><br>  Native modules (asynchronous) by default have deffered script behavior.  To understand this, we can present each script type = "module" with and without the defer attribute.  Here is an image from the specification that <a href="https://html.spec.whatwg.org/multipage/scripting.html">explains the behavior</a> : <br><br><img src="https://habrastorage.org/files/1b7/a3b/cb7/1b7a3bcb7dfd4b06b413104eb717eb93.png"><br><br>  This means that by default the scripts in the modules do not block, are loaded in parallel and are executed when the page completes the html parsing.  You can change this behavior by adding the async attribute, then the script will be executed as soon as it is loaded. <br><br>  The main difference between native modules and ordinary scripts is that regular scripts are loaded and executed immediately, blocking html parsing.  To present this, look at the <a href="https://plnkr.co/edit/EuzEJ6%3Fp%3Dpreview">demo with different options of attributes in the script tag</a> , where the usual script without the defer \ async attributes will be executed first: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"./script1.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"./script2.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"./script3.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"./script4.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"./script5.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  The order of loading depends on the browser implementation, the size of the scripts, the number of imported scripts, etc. <br><br>  <b>Total:</b> <br><br><ul><li>  <b>modules are asynchronous by default and behave like deffered scripts</b> </li></ul><br>  We are entering the era of native module support in javascript.  JS has come a long way of becoming, and finally he got to this point.  Probably, this is one of the most awaited and sought-after features.  No syntactic sugar and new language constructs are compared to this new standard. <br><br>  All of the above is given for the first acquaintance with native ECMAScript modules.  In the next article, the ways of interaction between modules, the definition of support in browsers, specific moments and differences with ordinary bundles, etc. will be discussed. <br><br>  If you want to know more now, I suggest to follow the links: <br><br><ul><li>  <a href="http://exploringjs.com/es6/ch_modules.html">Modules part JavaScript books by Dr.</a>  <a href="http://exploringjs.com/es6/ch_modules.html">Axel rauschmayer</a> <br></li><li>  <a href="https://github.com/whatwg/html/pull/443">Script type = ‚Äùmodule‚Äù `by Domenic Denicola</a> </li><li>  <a href="https://html.spec.whatwg.org/multipage/scripting.html">HTML live standard, ‚ÄúScripting‚Äù section</a> </li></ul><br>  Honestly, when I tried native modules for the first time, and they started working in the browser, I felt something that I didn‚Äôt feel with the advent of such language features as const / let / arrow functions and other newfangled chips when they started working directly in browsers .  I hope that you will, like me, welcome the addition of a native mechanism for working with modules in browsers. <br><br><h2>  Other author articles on this topic </h2><br><ul><li>  <a href="https://blog.hospodarets.com/native-ecmascript-modules-dynamic-import">Native ECMAScript modules: dynamic import ()</a> </li><li>  <a href="https://blog.hospodarets.com/native-ecmascript-modules-nomodule">Native ECMAScript modules: nomodule attribute for the migration</a> </li><li>  <a href="https://blog.hospodarets.com/native-ecmascript-modules-new-features">Native ECMAScript modules: Webpack modules</a> </li></ul><br><h2>  From translator </h2><br>  I am a frontend developer in the Avia team at <a href="https://avia.tutu.ru/">Tutu.ru.</a>  Now we have Webpack in projects as a bandler.  There are legacy code and old projects with RequireJS.  Native modules are very interesting and we look forward to them, especially since we have already transferred all our projects to HTTP / 2.  Of course, we are not going to do without bandlers, since we have a large number of modules in all projects.  But the arrival of native modules could change the workflow assembly and deployment. </div><p>Source: <a href="https://habr.com/ru/post/326716/">https://habr.com/ru/post/326716/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326700/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ258 (April 10 - 16, 2017)</a></li>
<li><a href="../326702/index.html">IT internships: waiting vs reality</a></li>
<li><a href="../326706/index.html">From Rails 4 to Rails 5: how it was</a></li>
<li><a href="../326712/index.html">The composition of protocols for injection dependencies</a></li>
<li><a href="../326714/index.html">Source Code Analysis and Prince of Persia Copy Protection</a></li>
<li><a href="../326718/index.html">Go to your personal account on zakupki.gov.ru without Internet Explorer and other useful tips when working with CryptoPro</a></li>
<li><a href="../326720/index.html">Record a WebRTC video stream from a webcam browser towed to Amazon S3</a></li>
<li><a href="../326722/index.html">Methods for circumventing web application security tools when operating XSS vectors</a></li>
<li><a href="../326724/index.html">Corporate portal. What is it? What for? Who and when?</a></li>
<li><a href="../326726/index.html">Conjuring technical interview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>