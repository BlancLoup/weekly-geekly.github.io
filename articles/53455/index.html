<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Attributes: a look inside</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a continuation of the article " Introduction to Attributes ." If you are not familiar with the idea of ‚Äã‚Äãattributes and their syntax - I advis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Attributes: a look inside</h1><div class="post__text post__text-html js-mediator-article">  This is a continuation of the article " <a href="https://habr.com/blogs/perl/53451/">Introduction to Attributes</a> ."  If you are not familiar with the idea of ‚Äã‚Äãattributes and their syntax - I advise you to start with it.  Well, this article discusses how the attributes are arranged from the inside, how to handle them, and what problems may arise. <br><a name="habracut"></a><br><h4>  Guts </h4><br>  When Perl encounters an attribute during compilation, it tries to call one of the handlers of the form <code>MODIFY_SCALAR_ATTRIBUTES</code> , <code>MODIFY_CODE_ATTRIBUTES</code> , etc., for the current class.  - depending on the type of data marked with the attribute, like this: <br><br> <code>__PACKAGE__-&gt;MODIFY_CODE_ATTRIBUTES(\&amp;mySub, 'myAttribute1', 'myAttribute2');</code> <br> <br>  I repeat: these calls are made right at compile time (at the BEGIN stage), or rather, right after perl completes the closing function of the curly brace ( <b>fair UPD from <a href="https://habrahabr.ru/users/xames/" class="user_link">xames</a> :</b> <em>not all handles of the <code>MODIFY_*_ATTRIBUTES</code> are executed at the BEGIN stage. B In particular, <code>MODIFY_SCALAR_ATTRIBUTES</code> executed at the stage of variable initialization ( <code>my $tmp: attr = 0;</code> )</em> ).  Since there can be several attributes, and no one has canceled inheritance, it is considered a good form to go through the list inside the handler, select the attributes that can be processed, and give the superclass to the mercy of what is left. <br><br>  Similarly, if you want to get a list of function / variable attributes and call the get function from the attributes module for this, the FETCH_SCALAR_ATTRIBUTES <code>FETCH_SCALAR_ATTRIBUTES</code> (or <code>FETCH_CODE_ATTRIBUTES</code> - I think you already understood). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, all the features of working with attributes at a low level can be found in <a href="http://perldoc.perl.org/attributes.html">perldoc attributes</a> .  By the way, for those to whom such an implementation seemed crooked, there is an important remark: " <i>The mechanisms described here are still experimental. Do not rely on the current implementation</i> ".  Well, there is nothing more permanent than experimental mechanisms :-) <br><br><h4>  Recipe for happiness </h4><br>  Obviously, picking attributes with the aforementioned handlers is not a pleasant job.  Thank God, the <code>Attribute::Handlers</code> module has appeared in the delivery of the same Perl 5.6, which greatly simplifies writing handlers for attributes and introduces additional interesting features - attributes can have parameters and be processed not only during the BEGIN stage, but also during CHECK, INIT , END.  By the way, this module works again with the help of attributes. <br><br>  So, in order to be able to use the <code>myAttribute</code> attribute to mark functions, it‚Äôs enough to write the following code: <br><br> <code>use Attribute::Handlers; <br> sub myAttribute : ATTR(CODE) { <br> my ($package, $symbol, $referent, $attr, $data, $phase, $filename, $linenum) = @_; <br> .... <br> }</code> <br> <br>  The handler ‚Äî the <code>myAttribute</code> method ‚Äî will be called for the marked function in much the same way as the handlers from the previous examples.  There are much more parameters passed to it: in addition to the function reference and the attribute name, there may also be a reference to the symbol table element (GLOB), the phase name BEGIN / CHECK / INIT / END, additional attribute parameters, an indication of the file name and line number.  By default, the handler is started during the compilation stage CHECK, when all that can be already loaded and digested. <br><br>  If we want to pass additional information to the handler, we can do it like this: <br><br> <code>sub mySub : myAttribute(p1,p2) {:}</code> <br> <br>  In this case, the handler will receive in the $ data variable an array with <code>p1</code> and <code>p2</code> values. <br><br>  Of the other fun features of <code>Attribute::Handlers</code> , an alternative interface to the <code>tie</code> function is worth noting, which in itself is a rather interesting example of the use of attributes.  It makes no sense to dwell on it here, everything is very clear from the documentation. <br><br>  It should be noted that most of the CPAN modules that use attributes rely on the <code>Attribute::Handlers</code> module.  However, it will not always help.  Moreover, do not expect that everything is as smooth and beautiful as it seems :) <br><br><h4>  Rake </h4><br>  Not for nothing is the phase CHECK selected in <code>Attribute::Handlers</code> as default.  In this phase, the interpreter has already finished processing the code and placed the functions and everything else in the symbol table, so now there is a technical possibility to get a link to the corresponding GLOB and poshamanit over it - for example, to replace the function.  It will not be possible to do this in the BEGIN phase - GLOB is not yet full, and the attribute handler will not be transferred.  And here begins the most interesting.  If you are developing under mod_perl, all this does not apply to you - you do not have the CHECK phase.  According to <a href="http://perldoc.perl.org/perlmod.html">perldoc perlmod</a> , inside the <code>eval</code> calls and under mod_perl the compilation stages CHECK and INIT do not work, there is only BEGIN and also UNITCHECK.  With UNITCHECK, too, not everything is smooth - globally this phase is not intercepted, only at the level of the corresponding module.  I did not manage to find a module that would solve this problem and made it possible to get to GLOB using mod_perl as trivially as it can be done in a regular script.  At the <code>Attribute::Handlers</code> level, it would be possible to add your own triggers to start handlers and pull them manually ‚Äî but the module is written so that you can immediately forget about such patches.  I was able to solve this problem by actually introducing an additional restriction when writing code - I had to abandon <code>require</code> when loading classes in favor of <code>use</code> .  As a result, the work is done in two steps - first, at the BEGIN stage, the list of functions marked with the attribute I need is compiled, and after calling the <code>import</code> method, the main work is done.  If someone offers a more human way, I will be glad. <br><br><h4>  Conclusion </h4><br>  In fact, attributes allow you to bind additional features to familiar program components.  The interest of these features is that in fact they are not visible in the code.  This is a bit like a <code>tie</code> - you perform elementary actions on the simplest data structures, behind which non-trivial processors are actually hidden.  If you need some kind of universal mechanism, but you do not want the features of its implementation to be visible in the code - look in the direction of the attributes. </div><p>Source: <a href="https://habr.com/ru/post/53455/">https://habr.com/ru/post/53455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../53446/index.html">Notepad for everything else</a></li>
<li><a href="../53447/index.html">Comic: "Why computer scientists always look like idlers"</a></li>
<li><a href="../53449/index.html">Another stupid script for sorting photos by EXIF ‚Äã‚Äãunder * nix</a></li>
<li><a href="../53451/index.html">Attributes: Introduction</a></li>
<li><a href="../53452/index.html">Winstar M4 USB Server</a></li>
<li><a href="../53456/index.html">Ideal women's laptops from HP and Intel - as a gift for March 8</a></li>
<li><a href="../53457/index.html">Payment by bank cards rating VKontakte</a></li>
<li><a href="../53459/index.html">Party ‚ÄúMedium well!‚Äù</a></li>
<li><a href="../53460/index.html">torrents + OpenID</a></li>
<li><a href="../53463/index.html">Everything will be fine, I found out</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>