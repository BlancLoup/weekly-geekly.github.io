<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C ++ 17 and C ++ 2a: news from the ISO meeting in Issaqua</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the beginning of November, a meeting of the WG21 international working group on C ++ standardization, in which Yandex employees participated, ended...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C ++ 17 and C ++ 2a: news from the ISO meeting in Issaqua</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/files/a7e/d86/307/a7ed863076f243f7ab1c8a4598999a74.png">  At the beginning of November, a meeting of the <a href="http://www.open-std.org/jtc1/sc22/wg21/">WG21</a> international working group on C ++ standardization, in which <a href="https://habrahabr.ru/company/yandex/blog/301514/">Yandex employees participated,</a> ended in the American city of Issaca.  At the meeting, they ‚Äúpolished‚Äù C ++ 17, discussed Ranges, Coroutines, Reflections, contracts, and much more. <br><br>  The meetings, as usual, took a whole day + it was decided to reduce the lunch break by half an hour in order to have more time to work on C ++ 17. <br><br>  Despite the fact that most of the time was devoted to the analysis of the shortcomings of the C ++ 17 draft draft, we managed to discuss several interesting and fresh ideas, and even bring to the standard what we were asked for at <a href="">cpp-proposals@yandex-team.ru</a> . <br><a name="habracut"></a><br><h1>  Debriefing </h1><br>  The main task of the last (and the next meeting) is the analysis and correction of comments on C ++ 17 (if you are not aware of the major innovations of C ++ 17, then <a href="https://habrahabr.ru/company/yandex/blog/304510/">you are here</a> ).  The comments were of two types - comments from WG21 member countries and comments from users / developers of the standard library.  Comments from countries, according to tradition, are dealt with first of all (each comment is assigned an identifier consisting of a country code and a sequentially increasing comment number).  This time more than 300 comments came.  Here are <b>some of the</b> most interesting and memorable ones: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  RU 1: initialization of constant objects </h2><br>  Since 2000, C ++ has a problem with the initialization of constant structures.  So, the behavior of the compiler suddenly depends on a number of completely unobvious factors: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A0</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> A0 a0; <span class="hljs-comment"><span class="hljs-comment">//   struct A1 { A1(){} }; const A1 a1; // OK struct A2 { int i; A2(): i(1) {} }; const A2 a2; // OK struct A3 { int i = 1; }; const A3 a3; //  </span></span></code> </pre> <br>  The request to correct this behavior came to us at <a href="">cpp-proposals@yandex-team.ru</a> from Ivan Lezhankin, we with the help of people from GOST issued it as a comment from the country and ... the behavior was corrected in C ++ 14 and C ++ 17.  Now the above code should compile. <br><br>  <b>Where it can be useful:</b> <br>  Extremely useful when refactoring.  Previously, removing an empty constructor could break the project compilation: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   : struct A1 { A1(){} //  ,    }; //      const A1 a1;</span></span></code> </pre><br>  With the corrected RU 1, it will be possible to change classes, removing empty constructors, and the code will continue to work.  In this case, you can get a small performance gain: libraries that use metaprogramming sometimes have additional optimizations for classes that are std :: is_trivially_constructible;  compilers are often better optimized by the constructors that they themselves generated, etc. <br><br><h2>  RU 2: invalid use of type traits </h2><br>  A wonderful way to shoot yourself in the leg, not to notice and die from blood loss: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;type_traits&gt; struct foo; // forward declaration void damage_type_trait() { //  is_constructible   ,  . //        //   ,       . std::is_constructible&lt;foo, foo&gt;::value; } struct foo{}; int main() { static_assert( //   ,   damage_type_trait() //  std::is_constructible std::is_constructible&lt;foo, foo&gt;::value, "foo must be constructible from foo" ); }</span></span></span></span></code> </pre><br>  Personally, I spent a week looking for a similar error in boost :: variant.  Now the WG21 has noticed the problem and is working on fixing it.  All chances that the C ++ 17 will be fixed and the compiler, upon seeing the code with invalid use, type_traits will produce a compilation error with a message detailing the cause of the problem. <br><br>  <b>Where it can be useful:</b> <br>  It will help you not to make difficult detectable errors.  Get rid of developers from many unpleasant surprises when using optional and variant, whose designers use type_traits. <br><br><h2>  RU 4 &amp; US 81: constexpr char_traits </h2><br>  We and the United States found the same flaw.  The problem is that the std :: string_view has a constexpr constructor, but the initialization of the object will still occur dynamically: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;string_view&gt; //  : // &gt; error: constexpr variable 'service' must be initialized by a constant expression // &gt; constexpr string_view service = "HELLO WORD SERVICE"; // &gt; ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ // &gt; string_view:110:39: note: non-constexpr function 'length' cannot be used // constexpr string_view service = "HELLO WORD SERVICE";</span></span></span></span></code> </pre><br>  <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0426r0.html">Our fix</a> was adopted as a <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0426r0.html">fix</a> (version p0426-1 was adopted, it is not yet available for general use). <br><br>  <b>Where it can be useful:</b> <br>  The compiler will be able to better optimize the construction of std :: string_view, you can use string_view in constexpr expressions. <br><br><h2>  shared_ptr <s>:: unique ()</s> </h2><br>  One of the requests was that shared_ptr :: unique () should guarantee the memory synchronization of std :: memory_order_acquire. <br><br>  And here we realized that many people do not know how to properly use this function in a multithreaded environment.  So, proper use - do not use. <br><br>  If shared_ptr :: unique () returns true and your implementation guarantees std :: memory_order_seq_cst, then ... that means nothing!  The situation may change immediately after calling the function unique (): <br><br><ul><li>  in another thread there may be a link to this shared_ptr and it is being copied right now </li><li>  in another thread may be weak_ptr which causes lock () </li></ul><br>  As a result, it was decided to mark the unique () method as deprecated and describe in more detail all the problems in the description of shared_ptr :: use_count (). <br><br><h2>  Legendre function <s>polynomials</s> </h2><br>  One request that came to us at <a href="">cpp-proposals@yandex-team.ru</a> from Moscow State University from Matthew Kornilov, we especially remember.  It described a lot of interesting things related to mathematics.  Some ideas are now in development by the author himself, and some managed to be sent as ‚Äúeditorial edits‚Äù to the standard and corrected directly at the meeting in Issaqua, after talking with one of the editors of the standard. <br><br>  So, one edit that was especially remembered was that you had to rename the section ‚ÄúAssociated Legendre polynomials‚Äù.  Because the formula in the well section is not representable as a polynomial :-) <br><br><div class="spoiler">  <b class="spoiler_title">...</b> <div class="spoiler_text">  The C ++ standard is a serious international document developed by specialists from all over the world, in which every word should be chosen in the most correct way and even minor logical contradictions should be excluded. <br><br>  What makes this ‚Äúschool‚Äù mistake smile me even more :-) <br></div></div><br><h2>  Other </h2><br><ul><li>  Std :: variant will not be able to store references, void and C arrays (but you can still use std :: reference_wrapper &lt;T&gt;, std :: monostate and std :: array to achieve similar behavior). </li><li>  Work continues on adding deduction guildes to the standard library.  There is every chance that <code>std::array a = "Hello word";</code>  will work out of the box. </li><li>  ZOS specialists came to the meeting with some comments on the std :: filesystem.  The plans are to manage to make modifications to the standard at the next meeting in order to make std :: filesystem an even more versatile tool. </li><li>  The special "tag" <code>std::in_place&lt;---&gt;</code> may be removed in favor of several tags <code>std::in_place, std::in_place_index&lt;&gt;, std::in_place_type&lt;&gt;</code> .  Personally, I prefer the last version.  But the majority, including the author of the universal tag idea himself, disliked it. </li></ul><br><h1>  Discussions and ideas </h1><br>  As always, discussions and analysis of errors took place in several subgroups simultaneously.  Being in 5 places at once is a difficult task, so it‚Äôs impossible to recount all ideas first-hand.  Here are the most interesting discussions that we visited: <br><br><h2>  ???  operator. () ??? </h2><br>  We discussed alternative syntax and approach to operator. (). <br><table><tbody><tr><th>  <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0416r1.pdf">The old syntax is P0416R1</a> </th><th>  <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0352r0.pdf">New syntax P0352R0</a> </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">X</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ref</span></span></span><span class="hljs-class"> {</span></span> X* p; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:‚Äã <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ref</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-function"><span class="hljs-params"> X{a})</span></span></span><span class="hljs-function"> </span></span>{} ~Ref() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> p; } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>. X&amp;() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *p; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Y</span></span></span><span class="hljs-class"> {</span></span> Y(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }; Ref&lt;Y&gt; r {<span class="hljs-number"><span class="hljs-number">99</span></span>}; rf(); <span class="hljs-comment"><span class="hljs-comment">// (r.operator.()).f() Y &amp;yr = r; // ??? // O_O static_assert(sizeof(Ref&lt;Y&gt;) == sizeof(X));</span></span></code> </pre></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">X</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ref</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span>‚Äã X { X* p; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> X&amp;() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>* } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:‚Äã <span class="hljs-keyword"><span class="hljs-keyword">explicit</span></span> Ref(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a): p(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> X{a}) {} ~Ref() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> p; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Y</span></span></span><span class="hljs-class"> {</span></span> Y(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }; Ref&lt;Y&gt; r {<span class="hljs-number"><span class="hljs-number">99</span></span>}; rf(); <span class="hljs-comment"><span class="hljs-comment">// (r.operator Y&amp;()).f() // Error: conversion function is private Y &amp;yr = r; // Ref&lt;Y&gt; constains only Y* static_assert(sizeof(Ref&lt;Y&gt;) == sizeof(Y*));</span></span></code> </pre></td></tr></tbody></table><br>  In other words, instead of operator. (), It is proposed to use a slightly more understandable ‚Äúinheritance, where the author of the class takes care of storing the object itself‚Äù.  WG21 asked the author to work further in this direction. <br><br><h2>  operator &lt;=&gt; () </h2><br>  operator &lt;=&gt; () or ‚Äúoperator spaceships‚Äù is an idea that emerged from the discussion of automatic generation of comparison operators.  The committee was against starting generating default comparison operators and against generating comparison operators using constructions of the form bool operator &lt;(const foo &amp;, const foo &amp;) = default ;.  Then the idea was born on the sidelines: <br><br><ul><li>  Make a comparison operator that returns immediately the values ‚Äã‚Äãless, equal, greater; </li><li>  With this operator, generate all comparison operators; </li></ul><br>  So far, the discussion did not go further, but it looks promising. <br><br><h2>  Reflections </h2><br>  The group was developing a compile-time reflection for C ++.  They have the basic functionality, which they are almost ready to transfer to further discussion in other subgroups and to issue TS (technical specification) - improvements to the standard, with which users can start experimenting without waiting for the new version of the main standard. <br><br><h1>  Results </h1><br>  People at the meeting processed a huge amount of comments to the standard.  More than 100 shortcomings were corrected, for which he thanks a lot! <br><br>  On December 5, in Moscow, we are waiting for the <a href="https://events.yandex.ru/events/meetings/5-dec-2016/">Russian WG21</a> to <a href="https://events.yandex.ru/events/meetings/5-dec-2016/">meet</a> Marshall Clow, chairperson of the Library Working Group at WG21 C ++, the developer of the standard library libc ++, by Boost.Algorithm.  At the meeting, we will talk about our future plans and developments, you can ask questions about C ++ that interest you and offer your ideas for C ++ 2a;  Marshall will tell about Undefined Behavior. <br><br>  We are also pleased to present the official website of the working group <a href="https://stdcpp.ru/">stdcpp.ru</a> to discuss ideas for standardization, help in writing proposals.  Now you can share your idea for inclusion in the C ++ standard, find out what others think about it and discuss the proposed ideas with other developers.  Welcome! </div><p>Source: <a href="https://habr.com/ru/post/315606/">https://habr.com/ru/post/315606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315596/index.html">Webinar: Asterisk and Databases</a></li>
<li><a href="../315598/index.html">Deep Learning Program</a></li>
<li><a href="../315600/index.html">Virtual events in C #: something went wrong</a></li>
<li><a href="../315602/index.html">Founder's advice. As an online service of Egor Egereva transforms the event-market of Russia</a></li>
<li><a href="../315604/index.html">How we did the interactive quest for RailsClub</a></li>
<li><a href="../315608/index.html">CSP bypass using Google Chrome extensions</a></li>
<li><a href="../315610/index.html">Security Week 46: OAuth 2.0 bypass, low-voltage ICMP DDoS, iOS privacy and loxcreen bypass</a></li>
<li><a href="../315614/index.html">SQL: a couple of tricks in SELECT queries</a></li>
<li><a href="../315616/index.html">Briefly and simply about the difficult - tariffing in "8-800"</a></li>
<li><a href="../315618/index.html">Connect Akuvox IP phones to Avaya PBX without a SIP license</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>