<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We issue a warning about the need to use a proxy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes in the local network there is a need to release users to the Internet through a proxy server. For example, to account for traffic or limit a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We issue a warning about the need to use a proxy</h1><div class="post__text post__text-html js-mediator-article">  Sometimes in the local network there is a need to release users to the Internet through a proxy server.  For example, to account for traffic or limit access to certain resources.  At the same time using a transparent proxy is impossible or undesirable. <br><br><h4>  We inform users </h4><br>  You can, of course, just make a newsletter at all with the indication of the parameters.  But, as practice shows, this does not completely eliminate the unnecessary questions. <br><a name="habracut"></a><br><h4>  Make life easier </h4><br>  Slightly more difficult to implement, but removing a significant part of the questions for setting up a method is that when you try to open a page, the user is given a message that lists all the necessary parameters.  To do this, we need to install a web server on the gateway and configure it to issue a page with this message. <br><br><h4>  Choosing a server </h4><br>  Particularly advanced may ask: why choose something when there is Apache?  I answer in advance: Apache in this case is very redundant and will only waste resources, which, most likely, are few on the gateway.  Therefore, we will use the easier option.  The server will need the ability to listen to port 80 (because we do not need inetd) and support for custom error messages (we will need to respond to 404).  A good option is thttpd. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Installation and Setup </h4><br>  In the following, it is assumed that Debian Etch is installed on the gateway.  We put thttpd in the usual way: <br><br><blockquote><code># aptitude install thttpd</code> </blockquote> <br><br>  We create the file /var/www/index.html and describe everything necessary for it so that the user can easily configure his browser: the proxy server address, port, wishes to have a good time and the like. <br><br>  In order that the user, when trying to get out, saw not the error message, but our beautiful instruction, we add the rule to iptables: <br><br><blockquote> <code># iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT</code> </blockquote> <br><br>  Now, any attempt to get out through port 80 will go to thttpd.  Open <a href="http://habrahabr.ru/">habrahabr.ru</a> and see instead what we want to see. <br><br><h4>  Catch 404 </h4><br>  As you can see, when you try to access any page that is not a domain root, we get 404. In thttpd, your own error handler is installed very simply.  We do not even need to change something in the config. <br><br><blockquote> <code># mkdir /var/www/errors <br> # cd /var/www/errors <br> # ln -s ../index.html err404.html</code> </blockquote> <br><br>  Unfortunately, thttpd tries to show its importance and draws its banner at the bottom of the page, spoiling our beautiful valid XHTML Strict.  Fortunately, it is treated. <br><br><h4>  Practical surgery </h4><br>  We take the car with the same version of debian, as on the gateway.  Go to <a href="http://packages.debian.org/">packages.debian.org</a> and download the source package from there in the form of three files: <br><br><blockquote> <code><a href="http://ftp.de.debian.org/debian/pool/main/t/thttpd/t"></a> <a href="http://ftp.de.debian.org/debian/pool/main/t/thttpd/t"></a> <a href="http://ftp.de.debian.org/debian/pool/main/t/thttpd/t"></a> $ wget -c http://ftp.de.debian.org/debian/pool/main/t/thttpd/thttpd_2.23beta1-5.dsc http://ftp.de.debian.org/debian/pool/main/t/thttpd/thttpd_2.23beta1.orig.tar.gz http://ftp.de.debian.org/debian/pool/main/t/thttpd/thttpd_2.23beta1-5.diff.gz</code> </blockquote> <br><br>  We put utilities for the developer: <br><br><blockquote> <code>$ sudo aptitude install dpkg-dev build-essential fakeroot debhelper</code> </blockquote> <br><br>  Unpack the package: <br><br><blockquote> <code>$ dpkg-source -x thttpd_2.23beta1-5.dsc <br> $ cd thttpd-2.23beta1</code> </blockquote> <br><br>  Edit the file config.h.  We find there the following line: <br><br><blockquote> <code><font color="#0000ff">#define</font> ERR_APPEND_SERVER_INFO</code> </blockquote> <br><br>  And comment on it: <br><br><blockquote> <code><font color="#008000">/*#define ERR_APPEND_SERVER_INFO*/</font></code> </blockquote> <br><br>  We use exactly this type of comment, since this is C, not C ++. <br><br>  You can also make some more settings.  For example, disable CGI support and set the default encoding to UTF-8.  Read the comments in the config. <br><br>  Next, in the same way, open the file debian / changelog.  You need to increase the version number of the package so that the next update will not overwrite it from the repository version.  This can happen even if the package is not actually updated. <br><br>  At the beginning of the file we see the following entry: <br><br><blockquote> <code>thttpd (2.23beta1-5) unstable; urgency=high <br> <br> * Applied patch from Steve Kemp &lt;skx@debian.org&gt; on thttpd.logrotate to fix <br> the insecure use of temporary files when invoked by logrotate <br> [CVE-2006-4248] (Closes: #396277). <br> <br> -- Daniel Baumann &lt;daniel@debian.org&gt; Tue, 31 Oct 2006 20:13:00 +0200</code> </blockquote> <br><br>  Add before her own.  Pay attention to the formatting and leave one empty line before what was already in the file. <br><br><blockquote> <code>thttpd (2.23beta1-5pupkin1) unstable; urgency=low <br> <br> * Minor configuration changes required for Company X <br> <br> -- Vasily Pupkin &lt;pupkin@example.com&gt; Mon, 17 Nov 2008 13:18:00 +0200</code> </blockquote> <br><br>  Putting the package: <br><br><blockquote> <code>$ dpkg-buildpackage -rfakeroot</code> </blockquote> <br><br>  In the directory level above, the file thttpd_2.23beta1-5pupkin1_i386.deb was formed.  Fill it with the gateway, install and enjoy the result. <br><br>  <b>upd .:</b> <a href="https://habrahabr.ru/users/freefd/" class="user_link">freefd</a> wrote <a href="http://habrahabr.ru/blogs/nix/45183/">an article about autoconfiguration</a> and provided <a href="http://404.freefd.info/trash/">an example of a</a> page with settings. </div><p>Source: <a href="https://habr.com/ru/post/44791/">https://habr.com/ru/post/44791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447900/index.html">Close contacts of ADL degree</a></li>
<li><a href="../447902/index.html">GitHub has completely ‚Äúdeleted‚Äù the utility repository for circumventing locks and the entire creator account.</a></li>
<li><a href="../447904/index.html">Positive Technologies Experts Revealed Attempts to Mass Exploit Critical Threats to Confluence</a></li>
<li><a href="../447906/index.html">Actual innovation: what to expect from the data center market in 2019?</a></li>
<li><a href="../447908/index.html">Two ways to collect awards for advertising in mobile games, or robots should work</a></li>
<li><a href="../447910/index.html">The "oil" of the modern economy and the war for personnel</a></li>
<li><a href="../447912/index.html">How and why I wrote a parser for the site Tradingview. Automate DIY trade</a></li>
<li><a href="../447914/index.html">5 ways to leave work stress at work</a></li>
<li><a href="../447916/index.html">The history of electronic computers, part 4: the electronic revolution</a></li>
<li><a href="../447918/index.html">By the day of astronautics. Continuation of the history of the Soviet Ballistic Center</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>