<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>7 rules of good tone when writing Unit tests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúGood manners have one 
 who is the least number of people 
 embarrassing. ‚Äù 
 J. Swift 


 Hello colleagues! Today I would like to talk about unit te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>7 rules of good tone when writing Unit tests</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/c76/446/e5b/c76446e5bc5247b0bd09ea65db03360b.jpg"><br><p>  <i>‚ÄúGood manners have one</i> <i><br></i>  <i>who is the least number of people</i> <i><br></i>  <i>embarrassing. ‚Äù</i> <i><br></i>  <i>J. Swift</i> </p><br><p>  Hello colleagues!  Today I would like to talk about unit testing and some ‚Äúrules‚Äù when writing them.  Of course, they are informal and not obligatory for execution, but if they are followed, everyone will be pleased and easy to read and maintain the tests that you wrote.  We at Wrike have seen enough Unit tests to understand the main problems that arise when writing and maintaining them, and formulate several rules to prevent them. <br><a name="habracut"></a><br>  1. <b>Unit tests need to be written</b> .  Yes, however banal it may sound, but they need to be written.  Each piece of application logic must be tested to avoid problems in the future.  And they can occur when changing the logic, refactoring, or even when updating the version of the dependent libraries.  And the more code coverage tests, the faster the problem will be detected and fixed. <br><br>  2. This rule is very important for those who are forced to cover the code with tests, and it sounds like this: <b>Tests are also code, and should be treated as working code</b> .  This also applies to the naming of variables, and the formatting of the code inside the test, and, especially, the names of test methods.  Of course, writing an adequate variable name takes a little more time and strikes the keyboard than ‚Äúint i = 0;‚Äù, but this increases the readability of the tests and the ease of their support. <br>  Guess what the fallen test method checks?) <br><img src="https://habrastorage.org/getpro/habr/post_images/ca7/20a/147/ca720a147bc193034789ef1b8df9bad5.png" alt="image"><br><br>  3. The third rule </p>  this gentleman - <b>watch the paths</b> .  Of course, it is always unpleasant to see when running tests, such an error: <br><img src="https://habrastorage.org/web/062/ea5/114/062ea51149154b13bb381fd6e32a32d8.png"><br>  And not even because your name is not Andrey, but because you have a poppy.  And how to be in this situation, you ask?  The answer is simple - relative paths.  Here is an example - <br><img src="https://habrastorage.org/web/0b8/d69/14b/0b8d6914bfbe4474ae43d89ba02f1ddf.png"><br>  It is best to use the Unix separator (/).  This is much more concise, and less likely to get an unexpected error. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      4. <b>Use caps (moki) more often than real objects.</b>  Moki is great!  They can be managed as needed in a specific test.  But, of course, do not forget to reset the state of the plugs before each test method.  The use of plugs increases the autonomy of the test and its flexibility.  You do not need to adjust the state of the system for a particular case, but simply set up a stub to return the desired value when calling a certain method and that's it.  I want to check another situation - I fixed the return value to another.  Simply and easily.  And the most important thing is that the state of the whole system does not change at the same time - it does not write anything to disk, does not transmit over the network, does not recalculate data arrays, does not climb into other services.  Just a stub and return value. <br>  To use stubs in tests, I use the <a href="http://site.mockito.org/">Mockito</a> framework.  Using it is very easy to create stubs.  For example: <br><img src="https://habrastorage.org/web/b74/a5d/a84/b74a5da8402c4aeea23d62421bcbfdc5.png"><br>  This is where the mock of the <i>calendar</i> object is created and passed to the <i>calendarService</i> object.  Next, mocks are initialized in the <i>setUp</i> method.  Then, directly inside the test, the card is configured and the test checks <i>isModern</i> , if the calendar type is different or not specified at all.  It did not have to recreate <i>CalendarService</i> , and the creation of mocks and the generation of returned values ‚Äã‚Äãtook only a few lines. <br><br>  5. <b>Write meaningful messages in case the test fails</b> .  The most common message I saw when analyzing dropped tests on TeamCity is <br><img src="https://habrastorage.org/web/29d/f39/6e4/29df396e4fe04caf9833c04f2ce4369a.png"><br>  Well, immediately everything is clear!  But it happens that the error message is still there, but the benefits of it ... <br><img src="https://habrastorage.org/web/311/258/69c/31125869ceb64ba3b91df6ba8a4d4e62.png"><br>  And here is a good, but not yet perfect, message, which immediately describes what was checked <br><img src="https://habrastorage.org/web/30a/7c2/8a7/30a7c28a70a14e94abd25bf21afce8af.png"><br>  The message can be considered ideal, which not only shows what we are checking, but why we expect it. <br><img src="https://habrastorage.org/web/29b/f69/af7/29bf69af750e4eb0815cfc07f6d53221.png"><br>  But here a fairly simple check is shown, and if you need to compare a pair of arrays with data in different order?  What message should I write here?  For this, I advise you to use the framework AssertJ.  The link contains many simple and clear examples of use, after which you will want to use this framework!  <a href="http://joel-costigliola.github.io/assertj/index.html">AssertJ</a> allows <a href="http://joel-costigliola.github.io/assertj/index.html">you</a> to think less about writing a message in the event of an error, and also to check a bunch in just one line, saving space.  For example check: <br><img src="https://habrastorage.org/web/f56/461/ec3/f56461ec365f42c6bbe5e90da81b5dde.png"><br>  Will give us a wonderful error message: <br><img src="https://habrastorage.org/web/d1e/093/088/d1e093088914411e993ccd5983fb3805.png"><br>  And everything is clear - what happened and for what reason!  You can go and correct mistakes. <br>  And once again - Adequate messages in error tests save time and nerves of those who will disassemble these tests.  Perhaps it will be you yourself in a year. <br><br>  6. <b>Clean up trash</b> (no, this is not about launching a GarbageCollector).  Created a file, made an entry in the database or pulled the user creation pen?  Do not be lazy and clean up after a test.  Files are accumulating, the base is cluttered with a bunch of garbage and crowds of fake users appear in the system.  Try to keep clean not only your workplace, but also your working environment.  <b>UPD</b> As correctly indicated in the comments, this item applies only to integration testing. <br><br>  7. <b>Verify that the test runs somewhere else besides your local machine</b> .  If you have a CI server or some other place where you run the tests, check that the test has started there.  For example, tests on a CI server are run from a specific package, and you put yours in another package.  Or tests are run by a specific name, for example <i>* UTest</i> , and you called your class <i>TestUid</i> .  Or tests are run in groups, and you forgot to put a certain group for your test.  Or ... You can come up with many cases where the newly written test never starts up somewhere other than your local machine.  And then the benefits of it are not so much! <br><br><p>  The result was a small list of good tone rules when writing Unit Tests.  I hope this article will help a little more to raise the culture of tests and testing in your team.  If you have something to add to my list, welcome to the comments. </p></div><p>Source: <a href="https://habr.com/ru/post/337188/">https://habr.com/ru/post/337188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337178/index.html">How to stop worrying and start talking</a></li>
<li><a href="../337180/index.html">Differences Postgres Pro Enterprise and PostgreSQL</a></li>
<li><a href="../337182/index.html">Greetings to Yandex developers</a></li>
<li><a href="../337184/index.html">Current data on the telephone codes of Russian cities</a></li>
<li><a href="../337186/index.html">Epidemic of the Petya blackmailer virus: what you need to know</a></li>
<li><a href="../337190/index.html">CaptureManager SDK</a></li>
<li><a href="../337192/index.html">Experience of raising IP telephony in the hotel</a></li>
<li><a href="../337194/index.html">Climbing an Unbowed Mountain: The Difficulties of Creating a Game Alone</a></li>
<li><a href="../337196/index.html">Another git tutorial</a></li>
<li><a href="../337200/index.html">Step by Step Plan for Upwork # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>