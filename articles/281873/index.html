<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Develop HTML5 games in Intel XDK. Part 6. Snake treat and collision handling</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1 ¬ª Part 2 ¬ª Part 3 ¬ª Part 4 ¬ª Part 5 ¬ª Part 6 ¬ª Part 7 // End) 


 Today we will add something tasty for the snake to the game and implement a c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Develop HTML5 games in Intel XDK. Part 6. Snake treat and collision handling</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/21b/4e4/f80/21b4e4f80e884771bc6508cb0f5b6dbe.png"><br>  <a href="https://habrahabr.ru/company/intel/blog/281380/">Part 1</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281453/">Part 2</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281523/">Part 3</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281607/">Part 4</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281639/">Part 5</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281873/">Part 6</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281981/">Part 7</a> // End) <br><img src="https://habrastorage.org/files/21b/4e4/f80/21b4e4f80e884771bc6508cb0f5b6dbe.png"><br><br>  Today we will add something tasty for the snake to the game and implement a collision handling system. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a85/cb5/56b/a85cb556b562471281db4b1e22dc8db2.jpg"></div><a name="habracut"></a><br><h2>  <font color="#0071c5">Biscuit</font> </h2><br>  Cookies (biscuit) is the main goal of the game.  The player's task is to, by directing the snake, to allow her to eat as many of these treats as possible.  In our implementation, a cookie is always the same sprite, the purpose of which is to appear on the screen, be eaten and appear again in another place. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How exactly the appearance of cookies is realized in the new position is one of the factors determining the complexity of the game.  In our case, this is a completely random process.  Create a cookie. <br><br><ol><li>  Optional step.  Create a new file - ‚Äúbiscuit.js‚Äù in the src folder.  If you have done this, add it to the list in the ‚Äúproject.json‚Äù file.  The list should look like the one below. <br><br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"jsList"</span></span> : [    <span class="hljs-string"><span class="hljs-string">"src/resource.js"</span></span>,    <span class="hljs-string"><span class="hljs-string">"src/biscuit.js"</span></span>,    <span class="hljs-string"><span class="hljs-string">"src/game.js"</span></span> ]</code> </pre> <br><br></li><li>  Add the following code to biscuit.js to create a Biscuit sprite.  If you missed the first step, place it in game.js <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Biscuit = cc.Sprite.extend({   winSize: <span class="hljs-number"><span class="hljs-number">0</span></span>,   ctor: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(snakeParts)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span>              <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._super(asset.SnakeBiscuit_png);                <span class="hljs-comment"><span class="hljs-comment">/*  winSize */</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.winSize = cc.view.getDesignResolutionSize();       <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.randPosition(snakeParts);   },   });</code> </pre> <br>  Notice that at the end of the constructor, the randPosition () method is called.  When creating a sprite is placed on the screen at random. <br><br></li><li>  Add an implementation of the randPosition method. <br><br><pre> <code class="hljs javascript">randPosition: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">snakeParts</span></span></span><span class="hljs-function">) </span></span>{                  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> step = <span class="hljs-number"><span class="hljs-number">20</span></span>;       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> randNum = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">range</span></span></span><span class="hljs-function">) </span></span>{           <span class="hljs-comment"><span class="hljs-comment">/*       range */</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * range);              };       <span class="hljs-comment"><span class="hljs-comment">/*   ,     */</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = {           <span class="hljs-attr"><span class="hljs-attr">x</span></span>: (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.winSize.width / step) - <span class="hljs-number"><span class="hljs-number">1</span></span>,           <span class="hljs-attr"><span class="hljs-attr">y</span></span>: (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.winSize.height / step) - <span class="hljs-number"><span class="hljs-number">1</span></span>                   }                                <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> possible = {            <span class="hljs-attr"><span class="hljs-attr">x</span></span>: randNum(range.x) * step,            <span class="hljs-attr"><span class="hljs-attr">y</span></span>: randNum(range.y) * step       }                              <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hit = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;             <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (flag) {                      <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> part = <span class="hljs-number"><span class="hljs-number">0</span></span>; part &lt; snakeParts.length; part++) {    <span class="hljs-comment"><span class="hljs-comment">/*          */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (snakeParts[part].x == possible.x &amp;&amp;   snakeParts[part].y == possible.y)   {                   <span class="hljs-comment"><span class="hljs-comment">/*   ,   hit */</span></span>                   hit = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;               }           }           <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hit == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {                              <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span>               possible.x = randNum(range.x) * step;               possible.y = randNum(range.y) * step;                              hit = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;           } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span>               <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span>               flag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;               <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = possible.x;               <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y = possible.y;           }                  }          },</code> </pre> </li></ol><br>  The first part of the method is quite simple.  Using a step that completely divides the width and height (20), we have created something like an invisible grid along which the snake moves, and in accordance with which the placement is made on the playing field of cookies.  The game screen is divided into cells of 20x20 pixels. <br><br>  The range object accepts the number of these cells, so we have information about the maximum number of cells along the x and y axes.  Moreover, in order for the cookie not to pass over the edge of the screen, which does not look very good, the number of available cells is reduced in width and height by one. <br><br>  After the maximum is known, a random number is generated in the available range and multiplied by the step size in order to determine the x and y coordinates of the cell to which we want to move the cookie. <br><br>  Then, the obtained coordinates are checked for their coincidence with one of the fragments of the body of the snake.  This is done so that the cookie does not appear directly on the snake.  If it turns out that in the proposed position the cookie will intersect with the snake, new coordinates are generated and the check is performed again.  This is done until a suitable position is obtained, to which the sprite symbolizing the treat will be moved. <br><br><h2>  <font color="#0071c5">Add cookies to the game screen</font> </h2><br>  The code implementing the cookie is ready.  It remains only to add it to the game screen. <br><br><ol><li>  Add a new class member to the SnakeLayer layer.  It will store a reference to the Biscuit object. <br><br><pre> <code class="hljs cs">biscuit: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   </span></span></code> </pre> <br></li><li>  Add a new method, updateBisquit, which is designed to update the state of the cookie. <br><br><pre> <code class="hljs kotlin">updateBiscuit: function() { <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.biscuit) { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.biscuit.randPosition(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.snakeParts);       <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.biscuit = new Biscuit(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.snakeParts); <span class="hljs-comment"><span class="hljs-comment">/*       - */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addChild(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.biscuit); } },</code> </pre> <br></li><li>  Add an updateBiscuit call to the ctor method of the SnakeLayer layer. <br><br><pre> <code class="hljs actionscript">ctor: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ...               <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateBiscuit(); ... },</code> </pre> <br></li><li>  Run the project in the emulator and take a look at the cookie, which a snake controlled by a player can soon try! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/16e/603/ba2/16e603ba2c4a4b3ebc2d2306b4211af3.png"></div><br>  <i><font color="#999999">Cookies and Snake</font></i> <br></li></ol><br>  Now, even if a snake is sent to a cookie, it cannot yet eat it.  Fix it. <br><br><h2>  <font color="#0071c5">Collision detection</font> </h2><br>  We need to deal with a few questions.  First, with what should happen when the snake finds a cookie.  Secondly - with the behavior of the game character when it reaches the borders of the screen.  Third, what happens when a snake bumps into its own tail. <br><br>  Taking into account the peculiarities of the game's architecture, it is possible to perform a simple equality test for each coordinate for the coordinates of the snake's head, fragments of its body and cookies.  This is possible because the ShakeParts and Biscuit objects can be located only in coordinates, which are divided completely by the move step (20 pixels).  As a result, you have to compare the integers.  If you had to work with fractional values, you would need a much more complex system. <br><br>  Let's deal with the implementation of a collision detection system. <br><br><ol><li>  Add the following method to SnakeLayer. <br><br><pre> <code class="hljs kotlin">checkCollision: function() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> winSize = cc.view.getDesignResolutionSize(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> head = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.snakeParts[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.snakeParts; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (head.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { head.x = winSize.width; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (head.x &gt; winSize.width) { head.x = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (head.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { head.y = winSize.height; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (head.y &gt; winSize.height) { head.y = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> part = <span class="hljs-number"><span class="hljs-number">1</span></span>; part &lt; body.length; part++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (head.x == body[part].x &amp;&amp; head.y == body[part].y) { <span class="hljs-comment"><span class="hljs-comment">/*   GameOver */</span></span> } }   <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (head.x == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.biscuit.x &amp;&amp; head.y == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.biscuit.y) { <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateBiscuit(); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addPart(); } },</code> </pre> <br></li><li>  Add a new method call to the update method of the SnakeLayer object. <br><br><pre> <code class="hljs kotlin">update: function(dt) { <span class="hljs-comment"><span class="hljs-comment">/*  ,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> up = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.interval) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter += dt;  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.moveSnake(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.curDir);                       <span class="hljs-comment"><span class="hljs-comment">/* ,       ,      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkCollision();           } },</code> </pre> </li></ol><br>  The checkCollision method performs three checks.  He checks if the ShakeHead object has crossed one of the edges of the screen, and if this happens, moves the snake so that it continues moving from the other side of the screen.  He checks to see if the snake's head has collided with one of the fragments of its body.  Now we do nothing if this happens, but in the next part we will deal with it.  And, finally, a test is conducted on the collision of a snake with a cookie.  If this happens, the cookie is transferred to a new location, and the snake grows. <br><br>  Since now the snake, while eating cookies, is growing, you can remove the code that sets its initial length from the ctor method.  Here is a loop that is no longer needed. <br><br><pre> <code class="hljs matlab">ctor: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(var parts = 0; parts &lt; 10; parts++)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; } },</span></span></code> </pre> <br><h2>  <font color="#0071c5">Correction of control deficiencies</font> </h2><br>  In the management of the snake there is a fundamental flaw.  She can crawl on herself.  And, if only it is not the very beginning, and the snake does not consist of only one head, it should not, even when the corresponding button is pressed, move in the direction opposite to that in which it is currently moving.  This will prevent an unexpected loss when the snake begins to move in the direction of its own body and, of course, its head faces one of its fragments. <br><br>  In order to fix this, you need to track the current state of the snake, namely the direction in which it moves. <br><br><ol><li>  Add a new member of the class nextDir to SnakeLayer. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-type"><span class="hljs-type">SnakeLayer</span></span> = cc.<span class="hljs-type"><span class="hljs-type">Layer</span></span>.extend({   ...   curDir: <span class="hljs-number"><span class="hljs-number">0</span></span>,   nextDir: <span class="hljs-number"><span class="hljs-number">0</span></span>,   ... });</code> </pre> <br></li><li>  Remove the dir parameter from moveSnake. <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SnakeLayer = cc.Layer.extend({   ...   moveSnake: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{       ...                      },   update: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span><span class="hljs-function"> </span></span>{       ...       this.moveSnake(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nextDir);       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.moveSnake();                             ...   }  });</code> </pre> <br></li><li>  Replace all curDir references with nextDir. <br><br><pre> <code class="hljs markdown">var SnakeLayer = cc.Layer.extend({   ...   ctor: function () {                  /<span class="hljs-bullet"><span class="hljs-bullet">*     *</span></span>/       cc.eventManager.addListener({ ...               /<span class="hljs-bullet"><span class="hljs-bullet">*     *</span></span>/               if (keyMap[<span class="hljs-string"><span class="hljs-string">keyCode</span></span>] !== undefined) {                   //targ.curDir = keyMap[<span class="hljs-string"><span class="hljs-string">keyCode</span></span>]; //   targ.nextDir = keyMap[<span class="hljs-string"><span class="hljs-string">keyCode</span></span>];  //                 }                                     }                  }, this);             /<span class="hljs-bullet"><span class="hljs-bullet">*     *</span></span>/       cc.eventManager.addListener({           onTouchMoved: function(touch, event) { ... /<span class="hljs-bullet"><span class="hljs-bullet">*    *</span></span>/ if (delta.x !== 0 &amp;&amp; delta.y !== 0) { if (Math.abs(delta.x) &gt; Math.abs(delta.y)) {                   /<span class="hljs-bullet"><span class="hljs-bullet">*     *</span></span>/ //targ.curDir = Math.sign(delta.x) <span class="hljs-bullet"><span class="hljs-bullet">* right;  //   targ.nextDir = Math.sign(delta.x) *</span></span> right;   //   } else if (Math.abs(delta.x) <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Math.abs</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">delta.y</span></span></span></span><span class="xml"><span class="hljs-tag">)) { /*     */ //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">targ.curDir</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">Math.sign(delta.y)</span></span></span></span><span class="xml"><span class="hljs-tag"> * </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">up</span></span></span></span><span class="xml"><span class="hljs-tag">; //                         </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">targ.nextDir</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">Math.sign(delta.y)</span></span></span></span><span class="xml"><span class="hljs-tag"> * </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">up</span></span></span></span><span class="xml"><span class="hljs-tag">;  //                       }                           }           }                        }, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this</span></span></span></span><span class="xml"><span class="hljs-tag">);   },      </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">moveSnake:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span></span><span class="xml"><span class="hljs-tag">() {       </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span></span><span class="xml"><span class="hljs-tag">                           /*    */ /*       */          //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dirMap</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span></span><span class="xml"><span class="hljs-tag">] !== </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">undefined)</span></span></span></span><span class="xml"><span class="hljs-tag"> {       //   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dirMap</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span></span><span class="xml"><span class="hljs-tag">]();          //} /*    */       /*       */          </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dirMap</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this.curDir</span></span></span></span><span class="xml"><span class="hljs-tag">] !== </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">undefined)</span></span></span></span><span class="xml"><span class="hljs-tag"> {           </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dirMap</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this.curDir</span></span></span></span><span class="xml"><span class="hljs-tag">]();          } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span></span><span class="xml"><span class="hljs-tag">   },   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span></span><span class="xml"><span class="hljs-tag"> });</span></span></span></span></code> </pre> <br></li><li>  Add a block of code to moveSnake that prevents the snake from ‚Äúcrawling‚Äù on itself.  This code block will check two conditions: <br><br>  a.  Is the new direction of movement (nextDir) not opposite to the current direction (curDir)? <br>  b.  Does the snake consist of only one head (the length is 1)? <br><br>  If any of the statements is true, curDir is replaced with nextDir. <br><br><pre> <code class="hljs markdown">var SnakeLayer = cc.Layer.extend({   ...   moveSnake: function() {             /<span class="hljs-bullet"><span class="hljs-bullet">*   ,              *</span></span>/       if ((this.nextDir <span class="hljs-bullet"><span class="hljs-bullet">* -1) != this.curDir || this.snakeParts.length == 1)  {                      this.curDir = this.nextDir;       }             /*</span></span>      */          if (dirMap[<span class="hljs-string"><span class="hljs-string">this.curDir</span></span>] !== undefined) {           dirMap[<span class="hljs-string"><span class="hljs-string">this.curDir</span></span>](<span class="hljs-link"></span><span class="hljs-link"></span>);          }        ...   },   ... });</code> </pre> </li></ol><br><h2>  <font color="#0071c5">findings</font> </h2><br>  Let's summarize today's lesson.  You have learned the following. <br><ul><li>  As a Biscuit object, it positions itself on the screen. </li><li>  How the collision detection system works </li><li>  How to correct the control in order to prevent the snake from unexpectedly "creeping" on itself. </li></ul><br>  Here's what you could do, having mastered the material. <br><br><ul><li>  Create a new sprite, symbolizing the treat. </li><li>  Implement a simple collision detection system. </li><li>  Limit the movement of the snake in three directions. </li></ul><br>  The changes made it possible to make our version of the classic Snake an almost finished game.  The snake can be controlled without the risk of unexpectedly losing, it regularly eats cookies, grows.  But the project still lacks something.  Namely, this is the main menu, scoring system, setting the complexity of the game.  About it - next time. <br><br><img src="https://habrastorage.org/files/21b/4e4/f80/21b4e4f80e884771bc6508cb0f5b6dbe.png"><br>  <a href="https://habrahabr.ru/company/intel/blog/281380/">Part 1</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281453/">Part 2</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281523/">Part 3</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281607/">Part 4</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281639/">Part 5</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281873/">Part 6</a> ¬ª <a href="https://habrahabr.ru/company/intel/blog/281981/">Part 7</a> // End) <br><img src="https://habrastorage.org/files/21b/4e4/f80/21b4e4f80e884771bc6508cb0f5b6dbe.png"></div><p>Source: <a href="https://habr.com/ru/post/281873/">https://habr.com/ru/post/281873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281861/index.html">Kite: contextual clues and auto-completion when writing code</a></li>
<li><a href="../281863/index.html">Filtering data in symfony</a></li>
<li><a href="../281865/index.html">Firebird 3.0 released</a></li>
<li><a href="../281867/index.html">PyNSK # 7 - April meeting of the Novosibirsk Python community</a></li>
<li><a href="../281871/index.html">New conference for anyone interested in JavaScript</a></li>
<li><a href="../281875/index.html">Symfony: processing requests in the API</a></li>
<li><a href="../281877/index.html">Solving long-standing security problems of BLE beacons. Eddystone-eid. Eddystone GATT service and Beacon Tools</a></li>
<li><a href="../281879/index.html">Why is JavaScript faster than C ++?</a></li>
<li><a href="../281881/index.html">Tab closing options and other improvements in Vivaldi 1.1.453.6 assembly</a></li>
<li><a href="../281885/index.html">April 23 - Russian final of Imagine Cup and Student Day in Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>