<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Xamarin and Xamarin.Forms - cactus in chocolate. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most recently, we published an article about the features and problems of the popular Xamarin mobile framework. Today we will continue the story and f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Xamarin and Xamarin.Forms - cactus in chocolate. Part 2</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/skbkontur/blog/273161/"><img align="right" width="500" src="https://habrastorage.org/files/9bb/ae5/b40/9bbae5b40afa4f6f91f905102f1011f8.png"></a>  Most recently, we published an article about the <a href="http://habrahabr.ru/company/skbkontur/blog/273075/">features and problems of the</a> popular Xamarin mobile framework.  Today we will continue the story and focus on the nuances of the Xamarin.Forms library.  Under the cut, you will find a story about what rake awaits the person who decided to make a cross-platform UI. <br><a name="habracut"></a><br><h2>  Basic problems </h2><br>  For a start, the layout can be prepared both in code and in <a href="https://developer.xamarin.com/guides/cross-platform/xamarin-forms/user-interface/xaml-basics/">XAML</a> format.  Unfortunately, you can‚Äôt see the real-time preview of the interface, although this feature is available for native development tools.  Therefore, we have chosen to develop an interface from code.  It will look a bit cumbersome, but in general it is convenient: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LoginViewController</span></span>: <span class="hljs-title"><span class="hljs-title">ContentPage</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoginViewController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Content = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StackLayout { Orientation = StackOrientation.Vertical, Children = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Entry { Placeholder = <span class="hljs-string"><span class="hljs-string">". "</span></span>, Keyboard = Keyboard.Email, }, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Entry { Placeholder = <span class="hljs-string"><span class="hljs-string">""</span></span>, IsPassword = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Button { Text = <span class="hljs-string"><span class="hljs-string">""</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActivityIndicator { IsRunning = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, IsVisible = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } } }; } }</code> </pre> <br>  Further, the <a href="https://developer.xamarin.com/guides/cross-platform/xamarin-forms/controls/views/">set of components</a> in Xamarin.Forms is not very large.  There are not enough such seemingly banal things, such as ‚Äúcarousels‚Äù for custom content.  There is a full-screen carousel controller, but we needed a similar component that occupies only part of the screen.  I had to bend a bit of a <a href="https://github.com/chrisriesgo/xamarin-forms-carouselview">third-party bike</a> . <br><br>  The components that are available often lack the properties or events available on iOS or Android.  It may not be possible to change the placeholder font or the color of the cursor, set the maximum length for the text field, and so on, such things have to be added independently.  In the <b>Xamarin.Forms 2.0</b> version released in mid-November 2015, some of these properties have been added, but up to 100% coverage of all the capabilities of native platforms is still far away. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Not happy with the inability to set all components indentation (padding and margin) - they are only in containers.  Want a button or input field to indent?  Wrap it in a container: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContentView { Padding = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thickness { Top = Sizes.StandartTopPadding Left = Sizes.StandartLeftPadding }, Content = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Label { Text =<span class="hljs-string"><span class="hljs-string">"  "</span></span> } }</code> </pre><br>  But too deep a hierarchy slows down the rendering process, which Forms is in principle somewhat slower than the native components.  Especially slowdown is noticeable on the lists, but simply quite complex forms for some applications can become a <a href="https://forums.xamarin.com/discussion/20092/critical-performance-issue-in-xamarin-forms-layouts/p1">serious problem</a> . <br><br>  Not less happy that some of the features are implemented incorrectly and this is a feature.  For example, when using standard navigation in Android, controllers will not be called up <a href="http://developer.xamarin.com/api/type/Xamarin.Forms.NavigationPage/">part of the life cycle events</a> when switching to a new screen, since  Navigation does not occur across real screens or fragments, but as a banal change of view within a single physical screen. <br><br><h2>  Bugs </h2><br>  Components often have bugs.  For example, <b>ScrollView</b> had a problem - when the keyboard appeared, it was possible to scroll further than necessary to the area without content. <br><br><img src="https://habrastorage.org/files/c54/94d/26e/c5494d26ed8e42d0aa5e14a5c85baa62.png"><br><br>  The source of the problem is the contents of the ScrollView are smaller in height than the container.  The size of the area for scrolling content is determined by the following code: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LayoutChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//[...] ContentSize=new Size(width, Math.Max(height, Content.Bounds.Bottom + Padding.Bottom)); }</span></span></code> </pre><br>  As a result, an idea emerged of how quickly (and dirty) you can solve the problem - create a ScrollView descendant with overlapping the desired method: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LayoutChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//[...] // Max,       ContentSize = new Size(width, Content.Bounds.Bottom + Padding.Bottom); }</span></span></code> </pre><br>  Simply?  In any case, the ContentSize property has a private setter and in its successor it doesn‚Äôt change its value.  But since we went along the curved path - you can always call for help reflection and change the value of the property. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ScrollViewCopycat</span></span> : <span class="hljs-title"><span class="hljs-title">ScrollView</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Action&lt;Size&gt; setContentSize; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ScrollViewCopycat</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methodInfo = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ScrollViewCopycat) .GetProperty(<span class="hljs-string"><span class="hljs-string">"ContentSize"</span></span>, BindingFlags.Instance | BindingFlags.Public) .GetSetMethod(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); setContentSize = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> =&gt; methodInfo.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LayoutChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//[...] setContentSize(new Size(width, Content.Bounds.Bottom + Padding.Bottom)); } }</span></span></code> </pre><br>  At some point, we were finally finished off by the following bug: if the visibility property value changes for a bundle of controls (the <b>IsVisible</b> property was set for several fields on the screen, one in <b>False</b> and the other in <b>True</b> ), the element could not appear on the screen!  At the same time, he took his place in the hierarchy (a hole appeared on the screen), but in reality he was hidden.  The problem arose not only with us, you can find several discussions on the Xamarin forum - here are examples <a href="https://forums.xamarin.com/discussion/35461/isvisible-inside-control-inside-stacklayout-inside-scrollview-not-work">once</a> or <a href="http://forums.xamarin.com/discussion/37917/bug-switching-isvisible-on-a-button-does-not-redraw-the-button">twice</a> . <br><br>  The bug turned out to be floating, and it appeared in Xamarin.Forms <b>1.3.3.6323</b> and later, the problem arose because of the race condition inside the Forms themselves.  Therefore, we for some time remained at an older, but not available version of this bug - <b>1.3.1.6296</b> .  Unfortunately, this version also had its own bugs fixed in later ones. <br><br>  So in the end we came to this decision: <br><br><ul><li>  all UI controllers whose properties we want to change call the <b>BatchBegin ()</b> method; </li><li>  change the necessary properties; </li><li>  again on all controllers we call <b>BatchCommit ()</b> . </li></ul><br><div class="spoiler">  <b class="spoiler_title">Detailed code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Batch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ILayoutController visualElement; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Batch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ILayoutController visualElement</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.visualElement = visualElement; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Begin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> animatables = GatherAnimatables(visualElement).ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> animatable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> animatables) animatable.BatchBegin(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionDisposable(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> animatable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> animatables) animatable.BatchCommit(); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;IAnimatable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GatherAnimatables</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ILayoutController root</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> root.Children.OfType&lt;IAnimatable&gt;() .Concat(root.Children.OfType&lt;ILayoutController&gt;().SelectMany(GatherAnimatables)); } }</code> </pre></div></div><br>  This code not only solves the mentioned problem, but is recommended when changing several component properties at once.  Let's say if the code is written like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (alert) { errorlabel.IsVibislbe = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; errorlabel.TextColor = Colors.Red; errorlabel.Text = AlertText; }</code> </pre><br>  That component will be redrawn three times, after each property change.  But if you wrap it in BatchBegin / BatchCommit, the redrawing (and recalculation of the size) will occur only once, which will have a positive effect on speed. <br><br>  There are other bugs, for example, <b>TextView</b> can affect the size of its container, although in addition the option ‚Äústretch to full width‚Äù is set: <br><br><img src="https://habrastorage.org/files/bca/0cd/ca6/bca0cdca6a2041608ed5f11439e09ac6.png"><br><br>  This occurs if the vertical container lies in another container with a horizontal orientation. <br><br><div class="spoiler">  <b class="spoiler_title">The code leading to the problem.</b> <div class="spoiler_text"><pre> <code class="cs hljs">Content=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StackLayout { Orientation = Orientation.Horizontal, BackgroundColor = Color.Green, Children = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StackLayout { Orientation = StackOrientation.Vertical, VerticalOptions = LayoutOptions.FillAndExpand, HorizontalOptions = LayoutOptions.FillAndExpand, Children = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Label { BackgroundColor = Color.Red, HorizontalOptions = LayoutOptions.FillAndExpand, } } } } }</code> </pre></div></div><br><br><h2>  Communication models and UI-components (binding) </h2><br>  The built-in support for two-way binding between the model and the view also did not please us.  Here is the first way to specify the connection: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Model1</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Text { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Model1</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { Text = text; } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> label1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Label { BindingContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Model1(<span class="hljs-string"><span class="hljs-string">"Hello, problems!"</span></span>) } label1.SetBinding(Label.TextProperty, <span class="hljs-string"><span class="hljs-string">"Text"</span></span>);</code> </pre><br>  If you make a mistake, and instead of ‚ÄúText‚Äù you write another name - then nothing will explode either at the compilation stage or in runtime.  Just Label appears without text. <br><br>  Of course there is a little better way to establish a connection: <br><br><pre> <code class="cs hljs">label1.SetBinding&lt;Model1&gt;(Label.TextProperty, source =&gt; source.Text);</code> </pre><br>  But he does not save us from the situation when another object is placed in the Label: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> label1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Label { BindingContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Model2(), };</code> </pre><br>  In this case, again, nothing in the performance will not fall. <br><br>  But that's not all.  If you need interrelated fields in the model (when another changes and the other changes) - for the UI to work you will have to add some rather boring code - to implement the <b>INotifyPropertyChanged</b> interface and independently report the list of changed fields: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Model</span></span> : <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanged</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> PropertyChangedEventHandler PropertyChanged; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[CallerMemberName]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PropertyChanged != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) PropertyChanged(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedEventArgs(propertyName)); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value1; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value1 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value1; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { value1 = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"Value2"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Value1*<span class="hljs-number"><span class="hljs-number">2</span></span>; } } }</code> </pre><br>  For these reasons, the binding between the model and the controllers we wrote our own - checking the compliance of field types, automatically updating the associated fields, etc. <br><br><h2>  Lists </h2><br>  Well, a separate headache - lists.  Let's start with the little things: the list has a header and a footer ( <b>footer</b> and <b>header</b> ), sort of unique cells that scroll along with the usual lines.  It's good.  But when replacing the content of the title that does not recalculate its height, if the new title is more or less than its predecessor, and the height of the rows of the table is fixed.  You have to do it manually. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IHeader</span></span> { <span class="hljs-function"><span class="hljs-function">Layout </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHeight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetHeaderForm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IHeader </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.GetView().Layout(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.GetView().X, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.GetView().Y, Width, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.GetHeight())); list.Header = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; }</code> </pre><br>  If you write on native iOS components - this problem does not arise, the size is recalculated by itself. <br><br>  Another unpleasant moment is ‚Äú <a href="https://developer.xamarin.com/guides/cross-platform/xamarin-forms/user-interface/listview/interactivity/">contextual actions</a> ‚Äù.  This menu is usually called on Android with a long tap, and on iOS, with a cell swipe.  The trouble is that for these contextual actions in Xamarin.Forms, a <b>MenuItem</b> object is used, which has, among other things, an <b>Icon</b> property.  But in these menus, no icons are displayed.  And <a href="http://stackoverflow.com/questions/29790551/contextaction-menuitem-icon-not-showing-in-ios-platform-in-xamarin-forms-pcl-bas">this is a feature</a> . <br><br>  So to display the icons, we used the Object-C library <a href="https://github.com/MortimerGoro/MGSwipeTableCell">MGSwipeTableCell</a> , around which we wrote our own wrapper.  However, as a result, we lost the ability to automatically resize the cells in the list - they all now have to be strictly the same height, because writing the correct complex custom cell render is not as easy as it seems. <br><br>  And finally, although the list as a data source is <b>IEnumerable</b> , there is no ‚Äúload as it scrolls‚Äù by default - at the moment of determining the source, the component reads the data to the end.  Not that we strongly expected such a behavior, because ‚Äúout of the box‚Äù of infinite lists is neither in iOS nor in Android, but there was a light hope.  Alas, the Xamarin.Forms components implement only the subsistence minimum of possibilities - everything else will have to be added by ourselves. <br><br><h2>  findings </h2><br>  Whether or not to use Xamarin.Forms - the next stage will show us, the transfer of the Java project already written for Android to Forms.  But now we can say that Xamarin.Forms should be used only for the most simple UI.  If there are plans to use every single chip of a specific platform or tricky design solutions, Xamarin.Forms will be more of a hindrance than help.  In this option, it is better to use Xamarin exclusively for business logic, and make layout for each of the platforms native. <br><br>  If you have any questions or comments, we will be happy to answer them in the comments. </div><p>Source: <a href="https://habr.com/ru/post/273161/">https://habr.com/ru/post/273161/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273149/index.html">String Security Emulation in PostgreSQL 9.4</a></li>
<li><a href="../273151/index.html">Transfer tabs to another window in the new assembly Vivaldi 1.0.344.34</a></li>
<li><a href="../273155/index.html">Interesting bagofich 1C when working with a managed form context</a></li>
<li><a href="../273157/index.html">Creative Commons licenses have published over 1 billion papers.</a></li>
<li><a href="../273159/index.html">Non-local image smoothing algorithm</a></li>
<li><a href="../273163/index.html">Conference for developers Top & Featured in Moscow on December 17</a></li>
<li><a href="../273165/index.html">Winter internship for developers at Redmadrobot</a></li>
<li><a href="../273167/index.html">How do postgreSQL security_barrier views work</a></li>
<li><a href="../273169/index.html">Pebble: Timeline - Inside View</a></li>
<li><a href="../273171/index.html">Results of 2015: web development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>