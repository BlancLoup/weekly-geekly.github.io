<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Screw Umbraco CMS as a source of content</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Target audience : systems that need a simple CMS that does not affect the architectural solution. (CMS, as content repository, without generating form...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Screw Umbraco CMS as a source of content</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/069/2dd/293/0692dd2930beae51cc14a516519f4b29.jpg"><br><br>  <u>Target audience</u> : systems that need a simple CMS that does not affect the architectural solution.  (CMS, as content repository, without generating forms, etc.) <br><br>  <u>The purpose of this article</u> is to show in ‚Äú2 words‚Äù how Umbraco CMS can be used as a data source on which the main application globally does not depend (after all, the source can be replaced with any other), in other words, how <u>to put the CMS into a separate project</u> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Some time ago I found out about Umbraco CMS, which immediately caught my attention.  One of its main advantages for me was its free openSource, with all that it implies.  Rather simple and effective design, simple background, large community and a wide range of free extensions.  A complete list of advantages and disadvantages can be found online.  I was upset only two points: <br><br><ol><li>  CMS makes certain claims to the structure and platform of the main application, routing, etc.  Programming in C # comes down to writing User Controls. </li><li>  Based on the first point, at the moment the latest version (4.10) cannot be used with ASP.NET MVC, which I love so much.  (I saw a version with a ‚Äúmixed type‚Äù project - ASP.NET + ASP.NET MVC, but I didn‚Äôt like it either) </li></ol><br>  I also wanted to use CMS exclusively as a content administration module, the data of which I could get by simply connecting a couple of libraries to any other project.  And, as far as I understand, Umbraco does not provide such an opportunity to silence.  In addition, I would like to write the page layout myself, the logic of data binding in C #, determine the layout, do not mess with xslt, on which the ui-engine umbraco is built.  After spending some time in search and not finding anything suitable, I had to solve this problem myself. <br><br>  It is worth noting for the sake of fairness that as a result, some CMS functions will be unavailable due to the fact that the main application is not integrated into it.  For example: creating and editing pages, administering themes, scripts, macros.  Anyway, the default.  So, if you need a full-featured CMS, in which the client should be able to perform all these actions, then this option is not very suitable. <br><br><a name="habracut"></a><br><br>  Schematically it looks like this: <br><img src="https://habrastorage.org/storage2/8b0/a29/72e/8b0a2972ee42101fc8d85f99bf04741e.png"><br><br>  So, first you need to do the following: <br><br><ul><li>  Create a project with a CMS, configure and expand its functionality. </li><li>  Add the necessary assemblies to the Web project, configure and write a couple of lines of code. </li></ul><br><ol><li>  Creating a CMS project <br><ul><li>  Since umbraco is written in ASP.NET, in VisualStudio we create an empty project of the appropriate type (we delete all files and folders from it) </li><li>  We install in this project ‚ÄúUmbraco Cms‚Äù from NuGet. </li><li>  Start the project - the Umbraco configuration start page will open, where we link it to the database. </li></ul><br></li><li>  Umbraco extension <br>  <i>Background:</i> <br>  When using cms in a separate project, there is one significant nuance that requires some additional gestures, namely: since it is already impossible to do something like umbraco.GetCurrentItem () in a web application, because  its context is not tied to cms, you need to somehow get the nodes we need. <br>  Umbraco.API makes it possible to do this on several parameters of the node, none of which up to the end guarantees that we will receive exactly that node, or we will receive something in general. <br><br>  It would seem that getting the node by its ID is the ideal solution - you can hard-code the necessary IDs and do uQuery.GetNode (int nodeId) quietly, but umbraco implements the through-numbered nodes, and, as far as I understand, they are not implemented if you install the package with the same nodes.  Therefore, in order to minimize the work related to finding the right nodes in the future, the following mechanism is implemented: <br><br><img src="https://habrastorage.org/storage2/229/a0d/e64/229a0de640d1f491624609920c0c038a.png"><br><br>  The figure shows the implementation of custom controls for Umbraco.  The control is responsible for setting associations between the cms nodes and custom enum from the web application (DropDown is mapped to enum, the node is selected via the ContentPicker).  This is the simplest implementation of the concept, i.e.  instead of enum, the list of node names can have any structure and is stored not only in enum.  For example, if in the application you need to know about 100 nodes, and not about 10 - you can think of something more complicated.  By the way, this way it is possible to implement the localization of a web site by adding sets of associations for different cultures (arrow Ru-Ru).  Before saving the data from ContentPicker, we get the real node ID. <br><br>  Also, with a strong desire, you can check here whether the nodes from umbraco that were expected in the web application have disappeared, display warnings, write mails, etc., anticipating the appearance of NotFound errors. <br><br>  These associations are stored in the Umbraco database (for example).  In the simplest case, the table has the following structure: <br><br><img src="https://habrastorage.org/storage2/dd8/bc8/7dd/dd8bc87dda121c1ffe04d33b4a4073e6.png"><br><br></li><li>  Setting up a web project <br>  Now for the main consumer project.  In order to get the data saved via cms via Umbraco api, you need to do the following: <br><ul><li>  Copy <i>config \ umbracoSettings.config</i> from the root cms to the root of the web project </li><li>  Set the value of the ‚Äú <i>XmlContentCheckForDiskChanges</i> ‚Äù <i>property</i> in this config to true (this item is optional, but will give an opportunity to instantly pick up changes in cms) </li><li>  Copy the keys from the <i>web.config</i> cms to the project web.config: <br><ul><li>  " <i>UmbracoDbDSN</i> " - the path to the cms database </li><li>  ‚Äú <i>UmbracoContentXML</i> ‚Äù is the path to the xml file where cms caches data.  More precisely: the default file is located in " <i>\ App_Data \ umbraco.config".</i>  <i>There is a nuance.</i>  <i>If the cms is physically located on another server, then the solution of the problem requires additional actions.</i>  <i>I did not delve too deeply into the umbraco caching mechanism, but I think that if necessary, caching to the file can be completely abandoned.</i> <br></li><li>  Add references to the following assemblies: <br><ul><li>  businesslogic.dll </li><li>  cms.dll </li><li>  controls.dll </li><li>  interfaces.dll </li><li>  umbraco.dll </li><li>  umbraco.DataLayer.dll </li></ul><br></li></ul><br></li></ul><br>  4. Access to data <br>  If I didn‚Äôt miss anything, it‚Äôs enough for api umbraco to work as it should.  To get the desired node, you need to know its Id.  All you need to do is get the desired Id from the <i>ItemsIdMap</i> table of associations by the name of the enum element and culture, if any.  For example: <br><br><pre><code class="cs hljs">ItemsIdMap itemAssociation = context.ItemsIdMaps.SingleOrDefault(p =&gt; p.ItemCID == CmsItemCID.News.ToString() &amp;&amp; p.Lang == <span class="hljs-string"><span class="hljs-string">"Ru"</span></span>); Node node = uQuery.GetNode(itemAssociation.ItemId); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> content = node.GetProperty(propertyName).Value;</code> </pre> <br><br></li><br>  That's basically it.  An example of this conceptual, in the process there are various nuances, but that's another story - everything is solved as they become available.  I also note that I myself have not tested this solution myself either for all possibilities or for performance.  By the way, in this case, it is convenient to download the source code of Umbraco, temporarily connect instead of builds and debug if there are any obscure problems because  The use of cms is not typical.  In any case, while I like this solution much more than writing the admin panel with my own hands. <br>  Thanks for attention! </ol></div><p>Source: <a href="https://habr.com/ru/post/158587/">https://habr.com/ru/post/158587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158575/index.html">Comprehensive automation of Firebird / InterBase database backup on Windows servers</a></li>
<li><a href="../158577/index.html">jQuery snippets and plugins for iPad</a></li>
<li><a href="../158579/index.html">Less and less and less ... Micro servers - a solution for macro tasks</a></li>
<li><a href="../158583/index.html">Vuzix Smart Glasses M100, a competitor to Google Glass, will go on sale in early 2013</a></li>
<li><a href="../158585/index.html">7 bub iOS game developer</a></li>
<li><a href="../158589/index.html">Sketch Image Recognition</a></li>
<li><a href="../158591/index.html">When every day like DDOS. Top Chinese Sites</a></li>
<li><a href="../158595/index.html">Google Fiber fiber earned in Kansas City, 700 Mbps real speed</a></li>
<li><a href="../158599/index.html">Bridging the technical gap</a></li>
<li><a href="../158601/index.html">AWS: S3 Backup to Amazon Glacier</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>