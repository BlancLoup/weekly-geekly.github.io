<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Altera + OpenCL: we program under FPGA without knowledge of VHDL / Verilog</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 The Altera SDK for OpenCL is a set of libraries and applications that allows you to compile code written in OpenCL into the FPGA firmware fr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Altera + OpenCL: we program under FPGA without knowledge of VHDL / Verilog</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/4cb/21d/43d/4cb21d43df4b00dac92ec93d29c15488.gif" alt="image"><br><br>  Hello! <br><br>  <b>The Altera SDK for OpenCL</b> is a set of libraries and applications that allows you to compile code written in <b>OpenCL</b> into the FPGA firmware from <b>Altera</b> .  This allows the programmer to use FPGA as a high-performance computing accelerator without knowledge of HDL languages, and write on what he is used to when it does under the GPU. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I played with this tool with a simple example and I want to tell you about it. <br><br>  Plan: <br><ul><li>  <a href="http://habrahabr.ru/company/metrotek/blog/269009/">A few words about FPGA</a> </li><li>  <a href="http://habrahabr.ru/company/metrotek/blog/269009/">What to run?</a> </li><li>  <a href="http://habrahabr.ru/company/metrotek/blog/269009/">Development process (workflow)</a> </li><li>  <a href="http://habrahabr.ru/company/metrotek/blog/269009/">OpenCL BSP</a> </li><li>  <a href="http://habrahabr.ru/company/metrotek/blog/269009/">Compile Kernel</a> </li><li>  <a href="http://habrahabr.ru/company/metrotek/blog/269009/">... and run</a> </li><li>  <a href="http://habrahabr.ru/company/metrotek/blog/269009/">Conclusion</a> </li></ul><br>  Welcome under the cut!  <b>Carefully</b> , there will be pictures! <br><a name="habracut"></a><br><a name="fpga"></a><br><h2>  A few words about FPGA (FPGA) </h2><br>  FPGA (Field-Programmable Gate Array) is a user-programmable gate array, a type of <abbr title="programmable logic integrated circuit">FPGA</abbr> . <br><br>  Such chips are based on small blocks of logic elements.  On such primitives, you can build the logic of any chip - from an 8-bit microcontroller to a miner of bitcoins. <br><br><div class="spoiler">  <b class="spoiler_title">More on FPGA</b> <div class="spoiler_text">  I recommend to watch a very high-quality video: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/gUsHwi4M4xE%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh-6CqC_bco265-uv4fVu95tmyWLg" frameborder="0" allowfullscreen=""></iframe><br><br>  There is also a good <a href="https://www.altera.com/en_US/pdfs/literature/misc/FPGAs_For_Dummies_eBook.pdf"><b>FPGAs for Dummies</b></a> book, which explains in a very simple language what FPGA is and how these chips are used. <br></div></div><br><br>  "Classic" development for FPGA looks like this: <br>  <s>the program</s> is described in <abbr title="Hardware Description Language">HDL</abbr> languages ‚Äã‚Äãsuch as VHDL / Verilog and fed to the compiler, which translates the description into the primitive level, and also finds the optimal location of these blocks in the chip, taking into account the specified time constraints (constraints).  The clock frequency of the circuit is an example of such a circuit. <br><br>  Sometimes FPGA is perceived as a more expensive kind of microcontroller: there and there you can blink an LED, unify UART, SPI, I2C.  In the past, this was partly true due to the fact that the FPGAs were small (in terms of resources and frequencies), and it was impossible to speak about any serious data processing and competition with processors.  Now FPGA chips are getting fatter, and their performance is compared to the GPU. <br><br>  FPGA makes it possible to control processing at the lowest level: create caches of the right size in the right place, organize pipelining, describe explicit parallelism.  You can connect various peripherals (for example, video cameras or Ethernet ports) and perform calculations without a general-purpose processor. <br><br>  All the charms of FPGA are leveled by the fact that if there is a low level control, then this low level must be programmed!  A low level of abstraction always leads to the complexity of development and debugging, <abbr title="compared to the development under the CPU">an increase in time</abbr> . <br><br>  FPGA manufacturers have thought very reasonably about shortening the time-to-market: letting programmers write to FPGA very easily and quickly.  One of the standard options for describing a parallel computing program is <b>OpenCL</b> .  <b>Altera</b> decided to support <b>OpenCL</b> : it was developed by <a href="https://www.altera.com/products/design-software/embedded-software-developers/opencl/overview.html">Altera SDK for OpenCL</a> . <br><br>  I deliberately omit the <b>OpenCL</b> description: there is a lot of literature in the Russian-speaking Internet on this topic, for example, <a href="http://habrahabr.ru/post/124925/"><b>Introduction to OpenCL</b></a> . <br><br><a name="where_to_run"></a><br><h2>  What to run? </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/7dc/de5/487/7dcde548722fbe2169ea97b3b1972702.png" alt="image" width="150"><br><br>  <abbr title="from the box">You</abbr> cannot <abbr title="from the box">start</abbr> OpenCL with every FPGA board: Altera has created a special affiliate program, within which the devkits receive the above-mentioned tag, if the board is ready to run OpenCL, it runs regular regression tests, etc. <br><br><h3>  PCIe </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/d21/6f7/0b0/d216f70b013a8ac1818d40ead6341e86.png" alt="image"><br><br>  A chip with FPGA can be placed on a <a href="http://habrahabr.ru/company/metrotek/blog/267183/">PCIe card</a> , which is plugged into the motherboard in the appropriate slot (at least instead of the GPU).  Through DMA and PCIe FPGA can communicate with DDR memory that is connected to the processor (to collect data for calculations).  Also on the board can be placed external memory, which is only available for FPGA (the OS on the CPU will not have access to this memory). <br><br>  External memory may be needed to store intermediate calculations: access to it will be cheaper than access via DMA to host memory.  It does not have to be DDR: for some calculations, low-latency SRAM may work better. <br><br>  Data for processing can be sent to the kernel not only from global memory, but also from I / O channels, for example, from Ethernet ports.  In this case, the host only configures the kernels, and the data is processed with minimal delay.  (If you see the words Ethernet, FPGA and low-latency next to them, then in most cases high-frequency trading is implied). <br><br><h3>  SoC </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/c9e/970/b21/c9e970b21d238cf8042786a10dec6336.png" alt="image"><br>  The second option is possible on <abbr title="System on chip">SoC</abbr> 'ax, where programmable logic and an ARM processor are located in one crystal. <br><br>  DDR-memory, shaded green, is a shared resource: on the one hand it uses the CPU (there you can <a href="http://habrahabr.ru/company/metrotek/blog/235707/">run linux</a> ), and on the other, the FPGA can read / write directly to this memory via an SDRAM controller with minimal overhead.  As with a PCIe card, external memory can be connected to the FPGA, but the need for this is less, because  always on hand DDR. <br><br>  Read more about the platforms <a href="https://www.altera.com/products/design-software/embedded-software-developers/opencl/developer-zone.html">here</a> . <br><br>  It is <abbr title="completely legal without some patching or cracking">possible to</abbr> run OpenCL on those boards that do not have the <b>Altera Preferred Board for OpenCL</b> sign.  I will not talk about this, as a starting point I propose to look at the official <a href="https://www.altera.com/content/dam/altera-www/global/en_US/pdfs/literature/hb/opencl-sdk/ug_aocl_custom_platform_toolkit.pdf">Altera SDK for OpenCL</a> manual <a href="https://www.altera.com/content/dam/altera-www/global/en_US/pdfs/literature/hb/opencl-sdk/ug_aocl_custom_platform_toolkit.pdf">: Custom Platform Toolkit User Guide</a> . <br><a name="workflow"></a><br><h2>  Development process (workflow) </h2><br>  What steps need to be performed to start the kernel? <br><br><img src="https://habrastorage.org/files/947/8ee/8c0/9478ee8c05f646dd9bf38e50ccc1b15f.png" width="600"><br><ul><li>  Kernel code is described in the <b>* .cl</b> file. </li><li>  A C / C ++ host application is being prepared that will allocate the required memory and ‚Äúload‚Äù values ‚Äã‚Äãinto the kernel. </li><li>  Using the <b>aoc</b> utility, which is included in the <b>Altera OpenCL SDK</b> , the kernel is ‚Äúcompiled‚Äù into the <abbr title="Altera Offline Compiler Executable file"><b>aocx</b></abbr> file.  Using <b>gcc</b> , the host application is built. </li><li>  When <b>host_app is</b> launched, the FPGA <abbr title="it contains the configuration and connection of all primitives in the chip">firmware</abbr> will be loaded, the prepared data will be loaded into the kernel and its processing will begin. </li><li>  Profiling counters collect data that will fit into the <b>profile.mon</b> file. </li><li>  Using the <b>aocl</b> utility, <b>you</b> can view this report and make a conclusion: does this implementation satisfy the execution / performance time requirements? </li><li>  If satisfied, then you can recompile the kernel without <b>--profile</b> , since  profiling counters take away resources in FPGA.  On the other hand, if additional cores are not planned to be added, then it is possible and not to recompile. </li><li>  If not satisfied, then you need to optimize / write pens / take another chip or accept. </li></ul><br>  I note that compilation into <b>aocx</b> file can take <b>several hours</b> ! <br>  What happens when <b>aoc kernel.cl is called</b> ? <br><br><h3>  Build aocx </h3><br><img src="https://habrastorage.org/files/156/2c2/9d8/1562c29d82fd44fe86ca7efaee2c3614.png" width="600"><br><ul><li>  <b>kernel.cl is</b> fed by <b>clang</b> , which translates the description into <abbr title="Intermediate Representation - intermediate code representation">IR</abbr> , and also performs various optimizations. </li><li>  <abbr title="Register Transfer Level">RTL is</abbr> generated by <b>Verilog <abbr title="Intellectual Property is a common name for individual units / modules. Analog Library in ASIC / FPGA World">IP</abbr></b> core.  Generated files are readable (unencrypted) and can be simulated in a regular simulator (for example, ModelSim).  However, there is not all the code is autogenous: there are modules that are clearly written by people. </li><li>  The resulting IP ‚Äújoins‚Äù to the default project for the board and it turns out the usual project for <abbr title="Compiler for Altera chips">Quartus</abbr> . </li><li>  The project builds (Analysis &amp; Synthesis, Fitter, Assembler).  It is this item that takes the most time (from ten minutes to several hours): the search for optimal locations of primitives requires a lot of calculations. </li><li>  The result of the assembly, information about the board and so on is placed in <b>aocx</b> , which is simply an ELF file. </li></ul><br>  This <b>aocx</b> file is then used to ‚Äúboot‚Äù the kernel. <br><a name="opencl_bsp"></a><br><h2>  DE1-SoC OpenCL BSP </h2><br>  In words and pictures, everything looks very smoothly: Verilog's knowledge is not needed. <br>  What really? <br><br>  The <a href="http://de1-soc.terasic.com/">DE1-SoC</a> board from Terasic <a href="http://habrahabr.ru/post/247535/">again</a> appeared in my hands.  It is based on the stone <a href="https://www.altera.com/products/soc/portfolio/cyclone-v-soc/overview.html"><b>Cyclone V SoC</b></a> ( <b>5CSEMA5F31C6</b> ). <br><br><img src="https://habrastorage.org/files/8a1/c1d/b17/8a1c1db1747c447597ac310fcb0bea72.jpg" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/a42/3d3/706/a423d37066024ff8b14642f1a68f2478.jpg" alt="image"><br></div></div><br><br>  This card has the <b>Altera Preferred Board for OpenCL</b> sign, so the launch of OpenCL should be out of the box: we need an <b>OpenCL BSP</b> for this particular board.  You can take it <a href="http://www.terasic.com.tw/cgi-bin/page/archive.pl%3FLanguage%3DEnglish%26CategoryNo%3D205%26No%3D836%26PartNo%3D4">here</a> . <br><br>  The OpenCL BSP archive includes: <br><ul><li>  The image of a flash drive (linux will boot from it). </li><li>  The default project, where all the pins are configured, as well as interfaces (fpga2sdram, lwhps2fpga, etc.). </li><li>  Simple examples. </li></ul><br>  The image is recorded on the microSD simply through <b>dd</b> . <br>  <b>Note</b> : it is advisable to use a <a href="https://en.wikipedia.org/wiki/Secure_Digital">10 class flash drive</a> . <br><br>  There is already <b>linux</b> : <br><pre><code class="hljs ruby">root@socfpga<span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># uname -a Linux socfpga 3.13.0-00298-g3c7cbb9-dirty #3 SMP Fri Jul 4 15:42:32 CST 2014 armv7l GNU/Linux root</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@socfpga</span></span></span><span class="hljs-comment">:~# cat /etc/issue Poky 8.0 (Yocto Project 1.3 Reference Distro) 1.3 \n \l root</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@socfpga</span></span></span><span class="hljs-comment">:~# cat /proc/cpuinfo processor : 0 model name : ARMv7 Processor rev 0 (v7l) Features : swp half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpd32 CPU implementer : 0x41 CPU architecture: 7 CPU variant : 0x3 CPU part : 0xc09 CPU revision : 0 processor : 1 model name : ARMv7 Processor rev 0 (v7l) Features : swp half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpd32 CPU implementer : 0x41 CPU architecture: 7 CPU variant : 0x3 CPU part : 0xc09 CPU revision : 0 Hardware : Altera SOCFPGA Revision : 0000 Serial : 0000000000000000</span></span></code> </pre> <br>  You can also find compiled examples and <b>OpenCL Run-Time Environment</b> . <br><br>  The thoughtful <b>README</b> offers: <br><pre> <code class="hljs pgsql">Run "source ./init_opencl.sh" <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> setup OpenCL Run-<span class="hljs-type"><span class="hljs-type">Time</span></span> Environment, including loading driver, <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> this board. <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> it once right <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> booting the board. OpenCL Run-<span class="hljs-type"><span class="hljs-type">Time</span></span> Environment <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> pre-installed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> opencl_arm32_rte folder.</code> </pre><br><br>  The <b>init_opencl.sh</b> itself looks very trivial: <br><pre> <code class="hljs mel">root@socfpga:~# cat init_opencl.sh export ALTERAOCLSDKROOT=/home/root/opencl_arm32_rte export AOCL_BOARD_PACKAGE_ROOT=$ALTERAOCLSDKROOT/board/c5soc export PATH=$ALTERAOCLSDKROOT/bin:$PATH export LD_LIBRARY_PATH=$ALTERAOCLSDKROOT/host/arm32/lib:$LD_LIBRARY_PATH insmod $AOCL_BOARD_PACKAGE_ROOT/driver/aclsoc_drv.ko</code> </pre><br><br>  Run this script, go to the directory <b>helloworld</b> and run the application of the same name: <br><pre> <code class="hljs vhdl">root@socfpga:~/helloworld# ./helloworld Querying platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> info: ========================== CL_PLATFORM_NAME = Altera SDK <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> OpenCL CL_PLATFORM_VENDOR = Altera Corporation CL_PLATFORM_VERSION = OpenCL <span class="hljs-number"><span class="hljs-number">1.0</span></span> Altera SDK <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> OpenCL, Version <span class="hljs-number"><span class="hljs-number">14.0</span></span> Querying device <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> info: ======================== CL_DEVICE_NAME = de1soc_sharedonly : Cyclone V SoC Development Kit CL_DEVICE_VENDOR = Altera Corporation CL_DEVICE_VENDOR_ID = <span class="hljs-number"><span class="hljs-number">4466</span></span> CL_DEVICE_VERSION = OpenCL <span class="hljs-number"><span class="hljs-number">1.0</span></span> Altera SDK <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> OpenCL, Version <span class="hljs-number"><span class="hljs-number">14.0</span></span> CL_DRIVER_VERSION = <span class="hljs-number"><span class="hljs-number">14.0</span></span> CL_DEVICE_ADDRESS_BITS = <span class="hljs-number"><span class="hljs-number">64</span></span> CL_DEVICE_AVAILABLE = <span class="hljs-literal"><span class="hljs-literal">true</span></span> CL_DEVICE_ENDIAN_LITTLE = <span class="hljs-literal"><span class="hljs-literal">true</span></span> CL_DEVICE_GLOBAL_MEM_CACHE_SIZE = <span class="hljs-number"><span class="hljs-number">32768</span></span> CL_DEVICE_GLOBAL_MEM_CACHELINE_SIZE = <span class="hljs-number"><span class="hljs-number">0</span></span> CL_DEVICE_GLOBAL_MEM_SIZE = <span class="hljs-number"><span class="hljs-number">536870912</span></span> CL_DEVICE_IMAGE_SUPPORT = <span class="hljs-literal"><span class="hljs-literal">false</span></span> CL_DEVICE_LOCAL_MEM_SIZE = <span class="hljs-number"><span class="hljs-number">16384</span></span> CL_DEVICE_MAX_CLOCK_FREQUENCY = <span class="hljs-number"><span class="hljs-number">1000</span></span> CL_DEVICE_MAX_COMPUTE_UNITS = <span class="hljs-number"><span class="hljs-number">1</span></span> CL_DEVICE_MAX_CONSTANT_ARGS = <span class="hljs-number"><span class="hljs-number">8</span></span> CL_DEVICE_MAX_CONSTANT_BUFFER_SIZE = <span class="hljs-number"><span class="hljs-number">134217728</span></span> CL_DEVICE_MAX_WORK_ITEM_DIMENSIONS = <span class="hljs-number"><span class="hljs-number">3</span></span> CL_DEVICE_MAX_WORK_ITEM_DIMENSIONS = <span class="hljs-number"><span class="hljs-number">8192</span></span> CL_DEVICE_MIN_DATA_TYPE_ALIGN_SIZE = <span class="hljs-number"><span class="hljs-number">1024</span></span> CL_DEVICE_PREFERRED_VECTOR_WIDTH_CHAR = <span class="hljs-number"><span class="hljs-number">4</span></span> CL_DEVICE_PREFERRED_VECTOR_WIDTH_SHORT = <span class="hljs-number"><span class="hljs-number">2</span></span> CL_DEVICE_PREFERRED_VECTOR_WIDTH_INT = <span class="hljs-number"><span class="hljs-number">1</span></span> CL_DEVICE_PREFERRED_VECTOR_WIDTH_LONG = <span class="hljs-number"><span class="hljs-number">1</span></span> CL_DEVICE_PREFERRED_VECTOR_WIDTH_FLOAT = <span class="hljs-number"><span class="hljs-number">1</span></span> CL_DEVICE_PREFERRED_VECTOR_WIDTH_DOUBLE = <span class="hljs-number"><span class="hljs-number">0</span></span> Command queue <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> order? = <span class="hljs-literal"><span class="hljs-literal">false</span></span> Command queue profiling enabled? = <span class="hljs-literal"><span class="hljs-literal">true</span></span> Using AOCX: hello_world.aocx Kernel initialization <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> complete. Launching the kernel... Thread #<span class="hljs-number"><span class="hljs-number">2</span></span>: Hello from Altera<span class="hljs-symbol"><span class="hljs-symbol">'s</span></span> OpenCL Compiler! Kernel execution <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> complete.</code> </pre><br>  Okay, some specially prepared examples and files on the flash drive work and print something. <br>  What should I do to build and run a simple example? <br><a name="installing_sdk"></a><br><h2>  Install SDK </h2><br>  We need: <br><ul><li>  <a href="https://dl.altera.com/%3Fedition%3Dsubscription">Quartus</a> </li><li>  <a href="https://dl.altera.com/opencl/%3Fedition%3Dsubscription">Altera SDK for OpenCL</a> </li><li>  <a href="https://dl.altera.com/soceds/%3Fedition%3Dsubscription">SoC Embedded Design Suite</a> : a set of tools for building and debugging applications on SoC'e. </li></ul><br>  Installing all of these tools is trivial, but there are subtle points: <br><ul><li>  Root rights may be required, and you will be told about this only at the end of the installation. </li><li>  After installation, you need to register something in PATH, ALTERAOCLSDKROOT, QUARTUS_ROOTDIR.  What is there to prescribe can podcherpnut from the respective guides. </li></ul><br>  Maybe I did something wrong, but in the end my script for setting environment variables began to look like this: <br><pre> <code class="hljs ruby">export PATH=<span class="hljs-regexp"><span class="hljs-regexp">/home/ish</span></span><span class="hljs-regexp"><span class="hljs-regexp">/altera/</span></span><span class="hljs-number"><span class="hljs-number">14.1</span></span>/quartus/<span class="hljs-symbol"><span class="hljs-symbol">bin:</span></span>$PATH export PATH=<span class="hljs-regexp"><span class="hljs-regexp">/home/ish</span></span><span class="hljs-regexp"><span class="hljs-regexp">/altera/</span></span><span class="hljs-number"><span class="hljs-number">14.1</span></span>/hld/<span class="hljs-symbol"><span class="hljs-symbol">bin:</span></span>$PATH export PATH=<span class="hljs-regexp"><span class="hljs-regexp">/usr/local</span></span><span class="hljs-regexp"><span class="hljs-regexp">/DS-5/bin</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>$PATH export PATH=<span class="hljs-regexp"><span class="hljs-regexp">/usr/local</span></span><span class="hljs-regexp"><span class="hljs-regexp">/DS-5/sw</span></span><span class="hljs-regexp"><span class="hljs-regexp">/gcc/bin</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>$PATH export PATH=<span class="hljs-regexp"><span class="hljs-regexp">/home/ish</span></span><span class="hljs-regexp"><span class="hljs-regexp">/altera/</span></span><span class="hljs-number"><span class="hljs-number">14.1</span></span>/hld/linux64/bin/<span class="hljs-symbol"><span class="hljs-symbol">:</span></span>$PATH export ALTERAOCLSDKROOT=<span class="hljs-regexp"><span class="hljs-regexp">/home/ish</span></span><span class="hljs-regexp"><span class="hljs-regexp">/altera/</span></span><span class="hljs-number"><span class="hljs-number">14.1</span></span>/hld/ export QUARTUS_ROOTDIR=<span class="hljs-regexp"><span class="hljs-regexp">/home/ish</span></span><span class="hljs-regexp"><span class="hljs-regexp">/altera/</span></span><span class="hljs-number"><span class="hljs-number">14.1</span></span>/quartus/ export LD_LIBRARY_PATH=<span class="hljs-regexp"><span class="hljs-regexp">/home/ish</span></span><span class="hljs-regexp"><span class="hljs-regexp">/altera/</span></span><span class="hljs-number"><span class="hljs-number">14.1</span></span>/hld/linux64/lib/<span class="hljs-symbol"><span class="hljs-symbol">:</span></span>$LD_LIBRARY_PATH <span class="hljs-comment"><span class="hljs-comment">#       ,         export AOCL_BOARD_PACKAGE_ROOT=/home/ish/altera/14.1/hld/board/de1soc</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Yes, I do not have the latest Quartus'a, and therefore, perhaps, what I will show below was improved in the fifteenth version. <br>  If there is something fundamentally changed in terms of OpenCL, I would be grateful if you knock me in PM. <br></div></div><br><br>  After all this is set up and preoccupied with licenses, it is necessary to install our board. <br>  How to do this tells <b>README.txt</b> , which lies in the archive c BSP: <br><pre> <code class="hljs pgsql">note:<span class="hljs-keyword"><span class="hljs-keyword">before</span></span> the below operations,make sure you have install the opencl SDK <span class="hljs-number"><span class="hljs-number">14.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> SoCEDS <span class="hljs-number"><span class="hljs-number">14.0</span></span>. <span class="hljs-number"><span class="hljs-number">1.</span></span> directly unzip the de1soc_openCL_bsp.zip <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> %ALTERAOCLSDKROOT%/board directory. <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> the "User variables" AOCL_BOARD_PACKAGE_ROOT <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> %ALTERAOCLSDKROOT%/board/de1soc <span class="hljs-number"><span class="hljs-number">3.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> the windows command <span class="hljs-keyword"><span class="hljs-keyword">window</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> "aoc --list-boards", it should output "de1soc_sharedonly"</code> </pre><br><br>  We execute and check: <br><pre> <code class="hljs ruby">ish@xmr<span class="hljs-symbol"><span class="hljs-symbol">:~</span></span>$ aoc --list-boards Board <span class="hljs-symbol"><span class="hljs-symbol">list:</span></span> de1soc_sharedonly</code> </pre><br><br>  The fee appeared in the list - it means everything was done right. <br><a name="compile"></a><br><h2>  We collect an example </h2><br>  To start, I chose a very simple example: <br>  <b>Z</b> = <b>X</b> + <b>Y</b> , <br>  where <b>X</b> and <b>Y</b> are arrays of <b>N</b> uint (32-bit) numbers. <br><br>  Kernel <b>vector_add</b> looks <a href="">very simple</a> : <br><pre> <code class="hljs pgsql">// ACL kernel <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> adding two <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> vectors __kernel <span class="hljs-type"><span class="hljs-type">void</span></span> vector_add( __global const uint *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> x, __global const uint *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> y, __global uint *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> z ) { // <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">work</span></span> item <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = get_global_id(<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> the vector elements z[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>] = x[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>] + y[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>]; }</code> </pre><br><br>  I will not give the whole code for the host: you can look at it <a href="">here</a> . <br><br>  What he does: <br><ul><li>  trying to recognize what OpenCL devices are </li><li>  reprograms FPGA using aocx file </li><li>  initializes buffers for arrays X, Y, Z </li><li>  generates data in arrays X and Y, and also calculates (on the processor) the reference response </li><li>  passes pointers to arrays to the kernel </li><li>  starts processing </li><li>  waiting for her to finish </li><li>  compares the reference response with what the kernel considers </li></ul><br><br>  Building it is trivial: we run a very simple <a href="https://github.com/johan92/altera_opencl_sandbox/blob/master/vector_add/Makefile">Makefile</a> that uses the ARM cross compiler.  (In our case, the host will be ARM, which is located in SoC'e). <br><br>  We <b>get aocx</b> : <br><pre> <code class="hljs ruby">ish@xmr<span class="hljs-symbol"><span class="hljs-symbol">:~/tmp/cl/vector_add</span></span>$ aoc device/vector_add.cl -o bin/vector_add.aocx --board de1soc_sharedonly --profile -v <span class="hljs-symbol"><span class="hljs-symbol">aoc:</span></span> Environment checks are completed successfully. You are now compiling the full flow!! <span class="hljs-symbol"><span class="hljs-symbol">aoc:</span></span> Selected target board de1soc_sharedonly <span class="hljs-symbol"><span class="hljs-symbol">aoc:</span></span> Running OpenCL parser.... <span class="hljs-symbol"><span class="hljs-symbol">aoc:</span></span> OpenCL parser completed successfully. <span class="hljs-symbol"><span class="hljs-symbol">aoc:</span></span> Compiling.... <span class="hljs-symbol"><span class="hljs-symbol">aoc:</span></span> Linking with IP library ... <span class="hljs-symbol"><span class="hljs-symbol">aoc:</span></span> First stage compilation completed successfully. <span class="hljs-symbol"><span class="hljs-symbol">aoc:</span></span> Hardware generation completed successfully.</code> </pre><br><br>  I remind you that the <b>--profile</b> flag adds counters to the firmware for profiling, and <b>-v is</b> just for verbose. <br><br>  It takes ten to fifteen minutes. <br><br>  The <b>vector_add.aocx</b> appeared in the <b>bin</b> directory, and in the <b>bin_vector_add there was a</b> Quartus project, which was going all this time. <br><br>  Build report: <br><pre> <code class="hljs delphi">+-------------------------------------------------------------------------------+ ; Fitter Summary ; +---------------------------------+---------------------------------------------+ ; Fitter Status ; Successful - Sat Oct <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> ; ; Quartus II <span class="hljs-number"><span class="hljs-number">64</span></span>-Bit Version ; <span class="hljs-number"><span class="hljs-number">14.1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> Build <span class="hljs-number"><span class="hljs-number">186</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>/<span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> SJ Full Version ; ; Revision <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> ; top ; ; Top-level Entity <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> ; top ; ; Family ; Cyclone V ; ; Device ; <span class="hljs-number"><span class="hljs-number">5</span></span>CSEMA5F31C6 ; ; Timing Models ; Final ; ; Logic utilization (<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ALMs) ; <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">570</span></span> / <span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">070</span></span> ( <span class="hljs-number"><span class="hljs-number">17</span></span> % ) ; ; Total registers ; <span class="hljs-number"><span class="hljs-number">9685</span></span> ; ; Total pins ; <span class="hljs-number"><span class="hljs-number">103</span></span> / <span class="hljs-number"><span class="hljs-number">457</span></span> ( <span class="hljs-number"><span class="hljs-number">23</span></span> % ) ; ; Total <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> pins ; <span class="hljs-number"><span class="hljs-number">0</span></span> ; ; Total block memory bits ; <span class="hljs-number"><span class="hljs-number">127</span></span>,<span class="hljs-number"><span class="hljs-number">344</span></span> / <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">065</span></span>,<span class="hljs-number"><span class="hljs-number">280</span></span> ( <span class="hljs-number"><span class="hljs-number">3</span></span> % ) ; ; Total DSP Blocks ; <span class="hljs-number"><span class="hljs-number">0</span></span> / <span class="hljs-number"><span class="hljs-number">87</span></span> ( <span class="hljs-number"><span class="hljs-number">0</span></span> % ) ; ; Total HSSI RX PCSs ; <span class="hljs-number"><span class="hljs-number">0</span></span> ; ; Total HSSI PMA RX Deserializers ; <span class="hljs-number"><span class="hljs-number">0</span></span> ; ; Total HSSI TX PCSs ; <span class="hljs-number"><span class="hljs-number">0</span></span> ; ; Total HSSI PMA TX Serializers ; <span class="hljs-number"><span class="hljs-number">0</span></span> ; ; Total PLLs ; <span class="hljs-number"><span class="hljs-number">2</span></span> / <span class="hljs-number"><span class="hljs-number">6</span></span> ( <span class="hljs-number"><span class="hljs-number">33</span></span> % ) ; ; Total DLLs ; <span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">4</span></span> ( <span class="hljs-number"><span class="hljs-number">25</span></span> % ) ; +---------------------------------+---------------------------------------------+</code> </pre><br>  Most of all here are two lines of interest: <b>Logic utilization</b> and <b>Total block memory bits</b> . <br><br>  This simple example ranked 5570 ALM.  In fact, the addition operation takes less than 1% of this number: the rest is taken by the ‚Äúinfrastructure‚Äù, which reads and writes data from the DDR (as well as the profiling counters).  It is also important to note that the project in Quartus was going with default settings that did not include any resource / frequency optimization. <br><br>  It is also interesting that automatically ‚Äúsomewhere‚Äù appeared a memory with a total volume of ~ 128 Kbps. <br><br>  By the way, you can see which sections appeared in <b>vector_add.aocx</b> : <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs sql">ish@xmr:~/tmp/cl/vector_add$ readelf -a bin/vector_add.aocx ELF Header: Magic: 7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 Class: ELF32 Data: 2's complement, little endian Version: 1 (current) OS/ABI: UNIX - System V ABI Version: 0 Type: NONE (None) Machine: Advanced Micro Devices X86-64 Version: 0x1 Entry point address: 0x0 <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> program headers: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">bytes</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> headers: <span class="hljs-number"><span class="hljs-number">2370388</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">bytes</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>) Flags: <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Size</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> this header: <span class="hljs-number"><span class="hljs-number">52</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">bytes</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Size</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> program headers: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">bytes</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> program headers: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Size</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> headers: <span class="hljs-number"><span class="hljs-number">40</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">bytes</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> headers: <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Section</span></span> header <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Section</span></span> Headers: [Nr] <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> Addr <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Size</span></span> ES Flg Lk Inf Al [ <span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> [ <span class="hljs-number"><span class="hljs-number">1</span></span>] .shstrtab STRTAB <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">000080</span></span> <span class="hljs-number"><span class="hljs-number">00011</span></span>c <span class="hljs-number"><span class="hljs-number">00</span></span> S <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [ <span class="hljs-number"><span class="hljs-number">2</span></span>] PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">000200</span></span> <span class="hljs-number"><span class="hljs-number">001000</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [ <span class="hljs-number"><span class="hljs-number">3</span></span>] .acl.board PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">001200</span></span> <span class="hljs-number"><span class="hljs-number">000011</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [ <span class="hljs-number"><span class="hljs-number">4</span></span>] .acl.compileoptio PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">001280</span></span> <span class="hljs-number"><span class="hljs-number">000002</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [ <span class="hljs-number"><span class="hljs-number">5</span></span>] .acl.version PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">001300</span></span> <span class="hljs-number"><span class="hljs-number">00000</span></span>a <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [ <span class="hljs-number"><span class="hljs-number">6</span></span>] .acl.file<span class="hljs-number"><span class="hljs-number">.0</span></span> PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">001380</span></span> <span class="hljs-number"><span class="hljs-number">000030</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [ <span class="hljs-number"><span class="hljs-number">7</span></span>] .acl.source<span class="hljs-number"><span class="hljs-number">.0</span></span> PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">001400</span></span> <span class="hljs-number"><span class="hljs-number">0006</span></span>c2 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [ <span class="hljs-number"><span class="hljs-number">8</span></span>] .acl.nfiles PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">001</span></span>b00 <span class="hljs-number"><span class="hljs-number">000001</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [ <span class="hljs-number"><span class="hljs-number">9</span></span>] .acl.source PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">001</span></span>b80 <span class="hljs-number"><span class="hljs-number">0006</span></span>c2 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">10</span></span>] .acl.opt.rpt.xml PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">002280</span></span> <span class="hljs-number"><span class="hljs-number">000019</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">11</span></span>] .acl.mav.json PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">002300</span></span> <span class="hljs-number"><span class="hljs-number">00107</span></span>f <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">12</span></span>] .acl.area.json PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">003380</span></span> <span class="hljs-number"><span class="hljs-number">0009</span></span>da <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">13</span></span>] .acl.profiler.xml PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">003</span></span>d80 <span class="hljs-number"><span class="hljs-number">002</span></span>f08 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">14</span></span>] .acl.profile_base PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">006</span></span>d00 <span class="hljs-number"><span class="hljs-number">0009</span></span>c8 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>] .acl.autodiscover PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">007700</span></span> <span class="hljs-number"><span class="hljs-number">000071</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>] .acl.autodiscover PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">007780</span></span> <span class="hljs-number"><span class="hljs-number">00021</span></span>e <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">17</span></span>] .acl.board_spec.x PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">007</span></span>a00 <span class="hljs-number"><span class="hljs-number">0003</span></span>eb <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">18</span></span>] .acl.fpga.bin PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">007e00</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>ab98 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> [<span class="hljs-number"><span class="hljs-number">19</span></span>] .acl.quartus_repo PROGBITS <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">242</span></span>a00 <span class="hljs-number"><span class="hljs-number">000151</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Key</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Flags: W (write), A (alloc), X (<span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>), M (<span class="hljs-keyword"><span class="hljs-keyword">merge</span></span>), S (strings), l (<span class="hljs-keyword"><span class="hljs-keyword">large</span></span>) I (info), L (<span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span>), G (<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>), T (TLS), E (<span class="hljs-keyword"><span class="hljs-keyword">exclude</span></span>), x (<span class="hljs-literal"><span class="hljs-literal">unknown</span></span>) O (extra OS processing <span class="hljs-keyword"><span class="hljs-keyword">required</span></span>) o (OS specific), p (processor specific) There <span class="hljs-keyword"><span class="hljs-keyword">are</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> <span class="hljs-keyword"><span class="hljs-keyword">groups</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> this file. There <span class="hljs-keyword"><span class="hljs-keyword">are</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> program headers <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> this file. There <span class="hljs-keyword"><span class="hljs-keyword">are</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> relocations <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> this file. There <span class="hljs-keyword"><span class="hljs-keyword">are</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> unwind sections <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> this file. <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> information <span class="hljs-keyword"><span class="hljs-keyword">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> this file.</code> </pre><br></div></div><br><br><a name="execute_on_fpga"></a><br><h2>  Run the kernel </h2><br>  Copy via <b>vector_add</b> and <b>vector_add.aox</b> to the board and run: <br><pre> <code class="hljs ruby">root@socfpga<span class="hljs-symbol"><span class="hljs-symbol">:~/myvectoradduint</span></span><span class="hljs-comment"><span class="hljs-comment"># ls -l -rwxr-xr-x 1 root root 42525 Apr 16 06:57 vector_add -rw-r--r-- 1 root root 2371188 Apr 16 06:58 vector_add.aocx root</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@socfpga</span></span></span><span class="hljs-comment">:~/myvectoradduint# ./vector_add Initializing OpenCL Platform: Altera SDK for OpenCL Using 1 device(s) de1soc_sharedonly : Cyclone V SoC Development Kit Using AOCX: vector_add.aocx Launching for device 0 (1000000 elements) Time: 112.475 ms Kernel time (device 0): 7.270 ms Verification: PASS</span></span></code> </pre><br>  We managed to add 1 million pairs of 32-bit numbers in 7.270 ms or one pair in 7.27 ns.  In fact, this indicator is not so interesting right now: the example has not been optimized for performance.  (Spoiler: only one adder was used: there was no parallelization of calculations). <br><br>  After running <b>profile.mon</b> appeared in the directory: <br><pre> <code class="hljs ruby">root@socfpga<span class="hljs-symbol"><span class="hljs-symbol">:~/myvectoradduint</span></span><span class="hljs-comment"><span class="hljs-comment"># ls -l -rw-r--r-- 1 root root 170 Apr 16 06:58 profile.mon -rwxr-xr-x 1 root root 42525 Apr 16 06:57 vector_add -rw-r--r-- 1 root root 2371188 Apr 16 06:58 vector_add.aocx</span></span></code> </pre><br><br>  Copy it back to your computer and see the result of profiling: <br><pre> <code class="hljs ruby">ish@xmr<span class="hljs-symbol"><span class="hljs-symbol">:~/tmp/cl/vector_add</span></span>$ aocl report bin/vector_add.aocx profile.mon</code> </pre><br> <a href=""><img src="https://habrastorage.org/files/c8f/b62/907/c8fb629071844e2eb796e8b5e1aa4db0.png"></a> <br><br> <a href=""><img src="https://habrastorage.org/files/f41/091/f78/f41091f782794e438a8d5080a63fbff0.png"></a> <br><br> <a href=""><img src="https://habrastorage.org/files/d4f/62e/12f/d4f62e12f84c485e8420bbc3d19da9e3.png"></a> <br><br>  The profiler showed that we used only a third of the bandwidth to global memory. <br><br>  It is possible to start the visualizer: <br><pre> <code class="hljs ruby">ish@xmr<span class="hljs-symbol"><span class="hljs-symbol">:~/tmp/cl/vector_add</span></span>$ aocl vis bin/vector_add.aocx</code> </pre><br> <a href=""><img src="https://habrastorage.org/files/500/4f5/9a3/5004f59a35144fd785d963e434dea1a9.png"></a> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/005/65f/c08/00565fc08e6d7e10466f6a4c3c18286c.png" alt="image"></a> <br><br>  The visualizer showed that there are three blocks that communicate with the global memory: two for reading, one for writing.  Access to global memory in this case may be a narrow link.  In the <b>Area report</b> for each line you can see the amount of resources spent in the FPGA for implementation.  Of course, the example from one line is not indicative. <br><br>  On the altera's youtube channel there is a video where all the steps I mentioned above are shown in detail: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/4PUKzI14mLY%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhvR7tecDTqjcoyegJCiCaSwBDkZw" frameborder="0" allowfullscreen=""></iframe><br><br>  The rest of the video from this cycle can be found under the spoiler: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/WpcIYvQuvvo%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPv0CXNNIBwX1eQ3zUVsfqiv0-JA" frameborder="0" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/npEUaj-MfVY%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhja7ImSzep_dS5yS8GjsrIUtc1NmA" frameborder="0" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/SKJR6PPeDFg%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjRydi4ZPbXhEOyEYDTu2IlCVX4og" frameborder="0" allowfullscreen=""></iframe><br></div></div><br><br><a name="the_end"></a><br><h2>  Conclusion </h2><br>  In this article I tried a tool that allows writing under FPGA at a high level without knowledge of HDL languages.  As we see, it works (on a simple example), and we really didn‚Äôt have to do anything extra. <br><br>  OpenCL under FPGA will not be a gold hammer: <br><ul><li>  It does not allow to describe the processes up to the tact (but this is exactly what we wanted to leave!) </li><li>  Not applicable on small chips: the infrastructure eats away a huge amount of resources. </li></ul><br><br>  However, using it FPGA can make a very real competition for the GPU in such areas as video processing (machine vision), encryption, DSP, simulation (simulation) of various processes.  If we talk about the areas where I work (generation, filtering, switching of Ethernet packets), where squeezing the maximum performance just happens due to the lowest level control, I don‚Äôt understand how to use OpenCL (and get a similar result). <br><br>  If there is a need for maximum performance, then you need to understand very well what is the result of this or that construction of the language.  Therefore, it seems to me that those who want to write something more or less serious on OpenCL under FPGA will have to learn Quartus, Qsys and Verilog (at the reading level) at a basic level.  Perhaps, the visualizer and profiler will suffice, but as long as they look like student fakes, I hope this will be fixed in new releases of the quarter. <br><br>  If we talk about real-time video processing, I recommend looking at this demo: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ythPvAPB4iI%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhj2kDN8bzEJPc2cFWEurOUP30KSw" frameborder="0" allowfullscreen=""></iframe><br>  The guys from iABRA initially did machine vision on OpenCL under an AMD GPU, but then moved to Altera.  The programmer emphasizes that the use of OpenCL allowed ‚Äúnot to understand the VHDL, because  they have no experience in this, but write on what they can. ‚Äù <br><br>  In some reports comparing implementations of algorithms (encryption, video processing) on ‚Äã‚Äãthe GPU and OpenCL FPGA, it is argued that the number of operations performed per second is about the same, but the FPGA consumes 10 times less power.  I am always skeptical about such benchmarks, because I have not tried them myself) <br><br>  With the release of the new <b>Arria 10</b> and <b>Stratix 10</b> families, I admit that more and more parallel computing will switch to the use of FPGA: we will see these chips in supercomputers and in data centers. <br><br>  And one more video about the real use of Altera SDK for OpenCL: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ObqtwoVy5RQ%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgqmF-eNaK6GURU2eywZ495s-G9dQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Thanks for attention!  I will be glad to questions and comments in the comments or in a personal) <br><br>  <b>Useful links</b> : <br><ul><li>  <a href="https://github.com/johan92/altera_opencl_sandbox/tree/master/vector_add">Sample sources and auto-twisted verilog code</a> </li><li>  <a href="https://www.altera.com/products/design-software/embedded-software-developers/opencl/overview.html">Altera SDK for OpenCL: Overview</a> </li><li>  <a href="http://www.altera.com/literature/hb/opencl-sdk/aocl_getting_started.pdf">Altera SDK for OpenCL: Getting Started Guide</a> </li><li>  <a href="http://tcfpga.org/fpga2013/openCL_tutorial.pdf"><b>Harnessing the Power of FPGAs using Altera's OpenCL Compiler</b></a> : a very large presentation (&gt; 100 slides) for those who love to watch pictures :) </li><li>  <a href="http://www.altera.com/literature/hb/opencl-sdk/aocl_programming_guide.pdf">Altera SDK for OpenCL: Programming Guide</a> </li><li>  <a href="http://www.altera.com/literature/hb/opencl-sdk/aocl_optimization_guide.pdf">Altera SDK for OpenCL: Optimization Guide</a> </li><li>  <a href="https://www.altera.com/en_US/pdfs/literature/hb/opencl-sdk/aocl-best-practices-guide.pdf">Altera SDK for OpenCL: Best Practices Guide</a> </li></ul><br><br>  <b>Update</b> : <br>  Released the second part of the article: <a href="http://habrahabr.ru/company/metrotek/blog/269925/">Altera + OpenCL: open the kernel</a> . </div><p>Source: <a href="https://habr.com/ru/post/269009/">https://habr.com/ru/post/269009/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268997/index.html">Frida-node or a little bit strange code</a></li>
<li><a href="../268999/index.html">How did Cisco Security Ninja teach 20,000 employees to secure programming?</a></li>
<li><a href="../269001/index.html">The digest of interesting materials for the mobile # 125 developer (October 12-18)</a></li>
<li><a href="../269003/index.html">Script shipping management online store</a></li>
<li><a href="../269007/index.html">Virtual quadrocopter on Unity + OpenCV (Part 2)</a></li>
<li><a href="../269015/index.html">Office as Platform, edition 8 - contextual Office application with Visual Studio Code on OS X, Linux and Windows</a></li>
<li><a href="../269017/index.html">What is ReactOS?</a></li>
<li><a href="../269019/index.html">Remote execution of system commands on request via sockets in Python 3. Part 2. Data transfer protocol</a></li>
<li><a href="../269021/index.html">JCoro ‚Äã‚Äã- asynchronous on coroutines in Java</a></li>
<li><a href="../269023/index.html">HikariCP - the fastest pool of connections in java</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>