<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Processing and classification of requests. Part Two: Navigation Queries</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What do we most want when we open an Internet search engine? We want to leave it as quickly as possible, paradoxically. We formulate our desire, press...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Processing and classification of requests. Part Two: Navigation Queries</h1><div class="post__text post__text-html js-mediator-article">  What do we most want when we open an Internet search engine?  We want to leave it as quickly as possible, paradoxically.  We formulate our desire, press the button and rather go to where it should be fulfilled (we hope). <br><br><img src="https://habrastorage.org/storage2/e91/16a/e1f/e9116ae1f7355ea1e877af3ec119f418.jpg"><br><br>  There are only two main ways to express desires: either describe <i>what</i> you need to get (or do), or indicate <i>where</i> you need to "teleport".  In the first case, the system tries to <i>understand the</i> request by correctly selecting the best of the network's responses, weighing hundreds of their properties on the decision trees.  In the second, the correct answer is usually only one, and we expect that the search engine <i>knows it.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Requests of the second type, answering questions <i>where</i> or <i>where</i> - navigation queries.  I offer you a short story about how we work with them. <a name="habracut"></a><br><br>  Generally speaking, the border between <i>what</i> and <i>where is</i> quite vague.  Consider two search queries: "cyclists forum" and "cycle forum ru".  Currently, the most relevant response to both of these requests is the same <a href="http://velo-forum.ru/">velo-forum.ru</a> website.  The difference is that in the first case the answer is not the only one and there is a competition between him and his analogues, in the second one the site is obliged not only to be present in the list of results, but also to head it, no matter how bad or good it is. compared with other cycle forums.  The second query is navigational, and the first is not. <br><br>  There are also requests of a mixed type, for example, ‚Äúwiki onomatopei‚Äù.  We will put them aside for the time being, but we will return to them. <br><br>  So, we must know in advance the answers to navigation requests.  Technically, this task is formulated as follows: compare each navigation request with its corresponding Internet address (hereinafter <i>referred to as the target</i> ): the site, the site section, the site page.  And before that, determine whether the query is navigational. <br><br>  <b>Why do you need it?</b> <br><br>  First of all, various studies show that navigation is subjectively perceived as the simplest type of search (which is not surprising: it‚Äôs easier <i>to know</i> about something than to <i>understand it</i> ).  Because of this, users are particularly picky in assessing the quality of the search engine's navigation responses, and it is they who have the strongest influence on users when making decisions about the search engine's responsibility as a whole. <br><br>  At the same time there are a lot of navigation queries.  So much that just leaving them unattended is extremely frivolous.  After all, the most important thing in the processing of any data is accounting and control.  That is, statistics and monitoring.  In this case, statistics on query properties and monitoring the quality of responses. <br><br>  If you sort all the search queries in descending order of their number, and then look at the resulting list ‚Äúin perspective‚Äù, you will see something like the following: <br><br><img src="https://habrastorage.org/storage2/623/4cb/c96/6234cbc9607e31dbb6fe619043d0fe4b.png"><br><br>  It can be seen that the entire top was captured by navigation queries, weakly diluted by the most important information needs of mankind (they are marked in red).  Therefore, no longer postponing <br><br>  <b>Go!</b> <br><br>  We started by simply going along the list, throwing out red blotches, and manually assigning each of its remaining requests to its target.  It turned out that only "VKontakte" with "classmates" cover 5% of the total flow of requests, while the coverage of the list of 120 top navigation queries was almost 15%.  Not bad for such meager intellectual costs. <br><br>  Further, however, the ‚Äúdensity‚Äù of navigation is rapidly decreasing, and therefore we had to look for ways to automatically filter the requests we needed.  That is, roughly speaking, find out how ‚ÄúVKontakte‚Äù is different from ‚Äúporn‚Äù. <br><br>  <b>Hall assistance</b> <br><br>  Users are not inclined to click on irrelevant answers.  Accordingly, for navigation queries, it makes sense to expect that they all select the only correct answer.  The working hypothesis was that the reverse is also true - if the majority of users who submitted a request click the same result, then this request is navigational, and the result is its target. <br><br>  The test showed that the hypothesis as a whole is correct - only rare non-competitive requests that have a very relevant response (such as ‚Äúnokia themes‚Äù or ‚Äúdownload icq‚Äù) generate a similar behavioral pattern.  However, almost all the false positives of their pseudo argents turned out to be pages within sites, so we just threw (temporarily) such requests from consideration. <br><br>  We went through several ways to measure the unanimity of users (including classic clickrank), and stopped at the following simple and convenient metric. <br><br>  Let <b><i>C <sub>i</sub></i></b> be the number of clicks in the result <b><i>R <sub>i</sub></i></b> , and <b><i>‚àëC <sub>i</sub></i></b> be the total number of clicks on request. <br>  Then <i><b>N</b> = log <b>C <sub>i</sub></b> / log <b>‚àëC <sub>i</sub></b></i> is the degree of query navigation. <br><br>  Manual evaluation showed that requests with a metric value above 0.95 are navigation with high accuracy.  Moreover, this accuracy is equally high for both frequency queries and rare ones.  With this method, the base of navigation requests-responses was able to grow to about 80,000 storage units. <br><br>  However, the classification based on user behavior has serious drawbacks: <br>  it works only if the request is known to us, that is, it is present in the logs, and the correct result is found and clicked.  As a result, small sites and rare requests, in fact, play the lottery: no one was looking for someone, they were looking for others, but they could not find them, and only with randomly chosen people did everything go well. <br><br>  <b>New factors</b> <br><br>  At first, we decided to help those unlucky who at least looked for (but could not find). <br><br>  We manually selected several thousand different navigation queries and began to study their properties.  Compiled lists of words and phrases that are most characteristic for them, and lists of words for them, on the contrary, are uncharacteristic.  They compared requests with the headings of the pages to which they lead, and with the text of links to these pages.  We disassembled the navigation blocks of these pages.  Domains and intradomain paths have been transliterated ... <br><br>  All of this, ultimately, became elements of Bayesian classifiers and factors in the nodes of decision trees.  After several iterations of balancing the training samples and evaluating the results of training, assessors managed to increase the base by another 10 times.  It now included queries aimed at almost 800,000 different pages, including: <br><ul><li>  leading inside sites ("LJ Top") </li><li>  having several suitable sites (‚Äútsk antares‚Äù: trade and construction company and dance and sports club) </li><li>  requests with a target, depending on the region of the user ("Sberbank", "mvideo") </li></ul><br>  However, along with useful information, the machine model introduced a significant amount of low-frequency garbage, misprints and retraining artifacts into the database. <br><br>  The second problem that has arisen is the clearly visible fragmentation of the base, that is, the unpredictable absence of queries in it that are semantically equivalent to those present.  For example, the ‚Äúheadhunter job‚Äù got into the base, and the ‚Äúwork headhunter‚Äù seemed to the model unworthy. <br><br><img src="https://habrastorage.org/storage2/08d/be0/404/08dbe04040983d0896ad9e92c3bd6f73.png"><br><br>  In our circumstances, unpredictability is not good: requests with the same meaning should be treated the same.  However, the inclusion in the database of all variants of all requests would inflate it to cosmic dimensions.  And, as often happens, the solution to the second problem was found in the process of studying the first - ways to clean the base of the above-mentioned noise and redundancy.  To do this, we had to look more closely at the ‚Äúdevice‚Äù of navigation queries. <br><br>  <b>"Device" requests</b> <br><br>  It turned out that navigation queries, like sentences in natural languages, are not monolithic, they can also be disassembled by composition: different words play different roles.  In total, there were five such roles (due to the lack of generally accepted terminology, I had to compose my own).  Below is a complex query in which all the ‚Äúmembers of the navigation offer‚Äù are present: <br><br><img src="https://habrastorage.org/storage2/edb/ccd/2c3/edbccd2c3e153031e8680a8badad2540.png"><br><br>  This is a real navigation query, he, as expected, the only correct <a href="http://www.avito.ru/samara/sobaki">answer</a> . <br><br>  We describe what are the navigation roles: <br><br>  <b>The kernel</b> is a fragment that uniquely identifies the site to which the request leads.  This is the most important part of the request.  Usually the site has no more than ten different cores.  For example, for the site <a href="http://lib.ru/">lib.ru</a> it is ‚Äúlib ru‚Äù, ‚Äúlibru‚Äù, ‚Äúlibru‚Äù and ‚Äúmoshkov library‚Äù. <br><br>  <b>Background</b> - fragments <i>valid</i> for the site.  By itself, their presence in the request does not indicate its navigational nature, but at the same time they do not change the target in the presence of a suitable core.  For <a href="http://youtube.com/">youtube.com</a> these are words like ‚Äúvideo‚Äù, ‚Äúvideos‚Äù, for <a href="http://headhunter.ru/">headhunter.ru</a> - ‚Äúvacancies‚Äù, ‚Äúwork‚Äù, etc. <br><br>  <b>Path</b> - words that shift the target from the root page inside the site.  For example, the word "maps", being attached to any Yandex kernel, redirects the request to <a href="http://maps.yandex.ru/">maps.yandex.ru</a> <br><br>  <b>Region</b> - a type of <b>path</b> denoting the geography of the request.  Its peculiarity is that for geo-dependent navigation, an explicit indication of the region in the query text is equivalent to a real change in the user's location.  For example, a ‚ÄúIKEA‚Äù request received from a user from Kazan should lead to the same place where the IKEA Kazan request sent from any other region. <br><br>  <b>Noise</b> - words that mean nothing in terms of navigation.  These are official parts of speech and words such as ‚Äúwww‚Äù, ‚Äúhttp‚Äù, ‚Äúwebsite‚Äù, etc. <br><br>  For each site, all these fragments of requests, often repeated, in a different order and combinations are present in the database.  In an effort to eliminate duplication, we began to look for ways to automatically partition "composite" requests into elementary parts in order to leave only unique fragments in it, and implement the logic of their interaction programmatically. <br><br>  The solution was surprisingly simple - it was the data redundancy of our database that played into our hands. <br><br>  If you sort the queries that have the same target, and then cut the shorter ones from the longer ones, then the whole set of queries is divided into two types of fragments: those that are present in the form of independent requests, and those that are present only as part of the request.  For example, if the initial list consists of the requests ‚ÄúYouTube‚Äù and ‚ÄúYouTube Video‚Äù, then the word ‚ÄúYouTube‚Äù will be included in the first list, and the second ‚Äúvideo‚Äù will be included in the first list.  These will be the <b>core</b> and the <b>background</b> respectively. <br><br>  If you take queries leading inside the site (for example, "Raiffeisen ATMs"), and similarly "subtract" requests from them leading to its root page ("Raiffeisen"), we get the <b>path</b> . <br><br>  Along the way, counting the number of different fragments in the original list, we left only the most frequent in the database - thus, for large sites with many requests leading to them, we managed to throw out all the garbage without losing anything for small ones. <br><br>  <b>From chaos to order</b> <br><br>  As a result, we again complicated the classification: first, instead of one list, five appeared, and second, we had to implement a non-trivial logic of matching them in the query. <br><br>  But in this way we managed to kill three birds with one stone at once: the fullness of the classification increased, while the base was reduced in size and cleared of low-frequency noise.  It turned out about the following (dust - a very free translation of the word <b>background</b> ): <br><br><img src="https://habrastorage.org/storage2/f72/903/2b8/f729032b8aa912a6d850226f7846fd7f.png"><br><br>  The complexity of the query splitting procedure is quadratic, but we haven‚Äôt yet had to optimize it: a simple pearl-barley script can cope with database decomposition in less than an hour. <br><br>  <b>Online logic</b> <br><br>  So, the base is structured, all five lists have become <a href="http://habrahabr.ru/company/mailru/blog/174321/">markers in dictionaries</a> .  Now, at the moment when the request is received, it is necessary to make a final decision on its navigation.  To do this, we define in the parser special agent whether the following conditions are fulfilled for the request: <br><ul><li>  navigation markers cover the entire query from the first to the last word </li><li>  navigation core present </li><li>  there is a combination of markers with at least one common target </li></ul><br><br>  Separately processed <b>paths</b> are explicitly spelled URLs, <b>regions</b> in the request and the real region of the user.  As a result, a verdict is made: is the request navigational, and <b>where</b> does the user want to go. <br><br>  Below is a schematic illustration of the process of determining the navigability of the query ‚Äúthere are no rabbits‚Äù: <br><img src="https://habrastorage.org/storage2/951/271/af1/951271af1c2704ff5ae48f23a964a20d.png"><br><br>  But the mysterious request ‚Äúto kill three birds with one stone‚Äù is not our client: a part of the request is defined as navigation, but there are also some unfamiliar (or navigation incompatible) words. <br><br>  <b>Local searches</b> <br><br>  In some (in fact, very many) of such requests, the naming part can be presented as an independent request: ‚Äúno sound of the three hares heart soundtrack‚Äù, ‚Äúpelevin on librusek‚Äù, ‚ÄúYouTube vivaldi heimetal‚Äù, ‚ÄúShakira in contact‚Äù.  These are requests of the mixed type, already mentioned at the very beginning. <br><br>  Strictly speaking, they are not navigational, but, as soon as we caught them in passing, they are a sin not to mention. <br><br>  Unlike in-site navigation, which has static sections and pages of sites (‚Äúbook file‚Äù, ‚Äúbeeline tariffs‚Äù), such requests require an answer obtained from the dynamic content of the specified site: personal pages in social networks, articles on news resources and encyclopedias, forum topics, etc. <br><br>  In such queries, we detect the navigation part, and consider everything else that the user wants to find there. <br><br>  For such queries, the following modifications of search parameters are possible: <br><ul><li>  search only on the specified site </li><li>  use your own site search (that is, show a link like <a href="">this</a> in the results) </li><li>  don't do anything special </li></ul><br><br>  <b>What is the result?</b> <br><br>  As a result, we received an answer to the main questions: how many navigation queries we receive and how well we answer them.  A brief summary is shown in the following diagrams: <br><br><img src="https://habrastorage.org/storage2/6fa/b11/020/6fab11020f600c2175126dec1ccd3c49.png"><br><br>  So, from a quarter to a third of the entire flow of requests (depending on whether local searches are taken into account) are navigational.  Among the navigation queries themselves, one third lead to the internal pages of the sites, almost one in ten depends on the region of the user, and a full quarter is occupied by the two most popular Russian social networks.  Reason to think. <br><br>  In addition, the classification results are used when ranking the results of a ‚Äúlarge‚Äù search as a factor, which is currently quite powerful. <br><br>  And finally, visual consequences: for the results of the navigation search, we create an extended snippet, sometimes we give several results from the desired site, we show favicons, site links and other special effects: <br><br><img src="https://habrastorage.org/storage2/d60/034/a76/d60034a76b5d53d0a79880ebe8ebc741.jpg"><br><br>  <b>What's next?</b> <br><br>  In conclusion, we recall the sector that is still not covered by us: about those whom our users have <i>not yet looked for</i> .  These are small regional organizations, highly specialized sites, local communities in social networks, personal pages and, of course, newly emerged sites and their sections.  Let them be small, but there are a lot of them, and we want to be prepared for the fact that one day someone will want to find them. <br><br>  There are no requests yet, and, accordingly, there is nothing to classify.  However, having studied the text of the page, you can <i>construct</i> queries that should lead the user to this page.  For this, it is necessary to find such fragments of the page text that uniquely identify it, and select those that can be used as a navigation query. <br><br>  Perhaps this foggy task harbors abysses with dragons.  Most likely, it will require other approaches to the solution and collisions with other pitfalls.  But so it is interesting. <br><br>  I‚Äôm getting round to this, thank you for your attention and, I hope, it was interesting for you!  In the next part - the story of the spellchecker. <br><br>  <i>Mikhail Dolinin,</i> <i><br></i>  <i>search request manager</i> </div><p>Source: <a href="https://habr.com/ru/post/176363/">https://habr.com/ru/post/176363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176343/index.html">To the events in Cyprus. April theses</a></li>
<li><a href="../176345/index.html">Globals MUMPS: Extreme Database Programming. Part 3</a></li>
<li><a href="../176347/index.html">Google Babel messenger is becoming more real</a></li>
<li><a href="../176355/index.html">Balance in the games of the genre of Tower Defense (part 2)</a></li>
<li><a href="../176357/index.html">Wiren Board - embedded computer with Wi-Fi, GPRS, GPS, NFC and Ethernet out of the box</a></li>
<li><a href="../176365/index.html">CamTouch project will take part in the final of Microsoft Imagine Cup 2013 from Ukraine</a></li>
<li><a href="../176367/index.html">4G on smartphones: in Russia from 04/10/2013</a></li>
<li><a href="../176369/index.html">Configuring RAID1 + LVM (for file system snapshots) in Hetzner and ServerLoft</a></li>
<li><a href="../176371/index.html">Development of business applications 1C + Android</a></li>
<li><a href="../176373/index.html">Overview of digital terrestrial television in Ukraine (T2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>