<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Channel Status Protocols and Single-Zone OSPF (Part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Coming up with the best way to explain something, I almost always find the best way to understand it for myself. 
 Susskind L., Grabowski J. 
 The the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Channel Status Protocols and Single-Zone OSPF (Part 1)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6f1/e70/0e0/6f1e700e01ad4e099731a7957e6d9727.jpg" alt="Photo from amazon.com" width="200" align="left">  <i>Coming up with the best way to explain something, I almost always find the best way to understand it for myself.</i> <br>  <i>Susskind L., Grabowski J.</i> <br>  <i>The theoretical minimum.</i> <i><br></i>  <i>Everything you need to know about modern physics. *</i> <br><br>  Translation of a chapter from the book by Chris Bryant "CCNP Route Study Guide".  His site is <a href="http://www.thebryantadvantage.com/">thebryantadvantage.com</a> .  The book is available on <a href="http://www.amazon.com/Bryant-Advantage-ROUTE-Study-Guide-ebook/dp/B008QWEXXO">amazon</a> . <br><br>  Of all the videos viewed, read books to prepare for CCNP ROUTE, the material from this seemed the easiest to learn.  Allows you to sort everything out.  In addition to theory, I also liked practical examples.  At the end of each chapter there are links to <a href="http://www.youtube.com/user/ccie12933">youtube</a> lessons. <br><a name="habracut"></a><br><h3>  Basics of channel status protocols </h3><br>  You are familiar with the behavior of the channel status protocols from the CCNA course, but now we are going to review the important points. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Avoid the temptation to miss a review.</i> <br><br>  In the meantime, quite a bit of you will be familiar - there are many additional details that you should master like CCNP.  For those who are going to take CCIE, you need to really learn how OSPF works. <br><br>  When RIP sends route updates, they contain the complete routing table.  Including debugging with the <i>debug ip rip</i> command, you can see the routes contained in the update along with the metric. <br><br>  Channel state protocols work differently.  Channel state routers that have created a neighborhood exchange LSU packets that contain LSA announcements.  These LSA announcements carry subnet mask information and allow OSPF to support variable length masks (VLSM). <br><br>  LSA announcements are placed in the channel status database.  Dijkstra's algorithm (also known as the first shortest path search algorithm, SPF) works with the contents of this database to create an OSPF routing table. <br><br>  Routers must synchronize their link state databases. <br><br>  To view the contents of the link state database, enter the <i>show ip ospf database</i> command.  This command shows the channels and connection types, sequence numbers and how long a certain LSA announcement was received.  This value in seconds can be viewed in the "age" column. <br><br>  Dijkstra's algorithm works with the contents of the database ... <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">R1</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#show</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">database</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">router</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ID</span></span> (1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>) (<span class="hljs-selector-tag"><span class="hljs-selector-tag">Process</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ID</span></span> 1) <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ID</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ADV</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Router</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Age</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Seq</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">Checksum</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> 1286 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x80000006</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x0057A7</span></span> 8<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span> 8<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span> 795 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x8000000C</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x00085E</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Net</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">States</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">Area</span></span> 0) <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ID</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ADV</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Router</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Age</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Seq</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">Checksum</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> 8<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span> 795 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x80000006</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x001CC3</span></span></code> </pre> <br>  ... computes routes, and these routes are placed in the OSPF routing table <br><br><pre> <code class="hljs pgsql">R1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip route ospf <span class="hljs-number"><span class="hljs-number">6.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> subnetted, <span class="hljs-number"><span class="hljs-number">1</span></span> subnets O <span class="hljs-number"><span class="hljs-number">6.6</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>[<span class="hljs-number"><span class="hljs-number">110</span></span>/<span class="hljs-number"><span class="hljs-number">11</span></span>] via <span class="hljs-number"><span class="hljs-number">10.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>, <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>, Ethernet0 <span class="hljs-number"><span class="hljs-number">7.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> subnetted, <span class="hljs-number"><span class="hljs-number">1</span></span> subnets O <span class="hljs-number"><span class="hljs-number">7.7</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span>[<span class="hljs-number"><span class="hljs-number">110</span></span>/<span class="hljs-number"><span class="hljs-number">11</span></span>] via <span class="hljs-number"><span class="hljs-number">10.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>, <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>, Ethernet0</code> </pre><br>  The SPF algorithm actually calculates the shortest path along the tree, and this tree is used to create the routing table.  We should not think more about this algorithm, since it does everything perfectly well without our intervention, but we have a lot of details that are worth paying attention to! <br><br><h3>  LSA sequence numbers </h3><br>  In order to ensure that OSPF routers receive the latest information, LSAs are assigned sequence numbers.  When a router with OSPF receives LSA, it checks against its database whether there is an entry for this channel or not. <br><br>  If there is no record, the router creates it and sends this LSA announcement to all OSPF interfaces, except for the one on which this message was received. <br><br>  If there is an entry, then several options are possible.  Depending on the value of the LSA sequence number, it is greater, less or equal to the one contained in the database. <br><br>  - If the number matches, the LSA announcement is ignored and no further action is taken. <br><br>  - If the number is smaller, the router will ignore the update and send the LSU packet containing the LSA announcement back to the sender.  In this situation, a router with more recent information informs the sender: ‚ÄúThe information you send is outdated.  This is the one that should be sent. ‚Äù <br><br>  - If the sequence number is higher, the router will add this LSA announcement to its database and send a LSA acknowledgment.  Then the router will send this LSA announcement and run the SPF algorithm to update its own routing table. <br><br><h3>  When is the LSA announcement exchange? </h3><br>  Remote-vector protocols send updates regularly at a certain time interval, regardless of whether there were changes in the network topology or not.  For a stable network, it is a waste of resources.  After the initial exchange of LSA announcements between two OSPF neighbors, another exchange of announcements does not occur until the network topology changes. <br><br>  The OSPF router also sends out summary LSA announcements every 30 minutes. <br><br>  Before exchanging LSA announcements, routers must become neighbors, forming a neighborhood.  To do this, routers must have the same zone number, hello and dead timers, and you need to check whether the zone is a ‚Äústub‚Äù zone.  If there is authentication, then it must be configured on both sides of the channel. <br><br>  The OSPF process number itself is locally significant and does not affect the establishment of the neighborhood. <br><br>  To check the neighborhood, enter the <i>show ip ospf neighbor</i> or less commonly used <i>show ip ospf interface</i> command.  This last command is often forgotten, but it gives a lot of useful information. <br><br>  Note that both commands will show you which neighborhood relationships exist, and only <i>show ip ospf neighbor</i> will show the status of the database load (FULL, 2WAY, etc.) <br><br><pre> <code class="hljs pgsql">R3#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip ospf neighbor Neighbor ID Pri State Dead <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/DR <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">172.12</span></span><span class="hljs-number"><span class="hljs-number">.123</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> Serial0 <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">172.12</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> Serial1 <span class="hljs-number"><span class="hljs-number">4.4</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/DR <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">172.23</span></span><span class="hljs-number"><span class="hljs-number">.23</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> Ethernat0 R3#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip ospf interface serial0 Serial0 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> up, <span class="hljs-type"><span class="hljs-type">line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> up Internet address <span class="hljs-number"><span class="hljs-number">172.12</span></span><span class="hljs-number"><span class="hljs-number">.123</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>, Area0 Process ID <span class="hljs-number"><span class="hljs-number">1</span></span>, Router ID <span class="hljs-number"><span class="hljs-number">3.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>, Network <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> NON_BROADCAST, <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> Transmit Delay <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> sec, State DROTHER, Priority <span class="hljs-number"><span class="hljs-number">0</span></span> Designated Router (ID) <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>, Interface Address <span class="hljs-number"><span class="hljs-number">172.12</span></span><span class="hljs-number"><span class="hljs-number">.123</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> backup designated router <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> this network Timer intervals configured, Hello <span class="hljs-number"><span class="hljs-number">30</span></span>, Dead <span class="hljs-number"><span class="hljs-number">120</span></span>, Wait <span class="hljs-number"><span class="hljs-number">120</span></span>, Retransmit <span class="hljs-number"><span class="hljs-number">5</span></span> Hello due <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>, flood queue length <span class="hljs-number"><span class="hljs-number">0</span></span> Next <span class="hljs-number"><span class="hljs-number">0x0</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>)/<span class="hljs-number"><span class="hljs-number">0x0</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) Last flood scan length <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, maximum <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> Last flood scan <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> msec, maximum <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> msec Neighbor count <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, Adjacent neighbor count <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Adjacent <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Neighbor <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> (Designated Router) Supress Hello <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> neighbor(s)</code> </pre><br>  <i>show ip ospf interface</i> will give you the local OSPF router identifier (RID), its role in this segment (DR, BDR, DROther), the identifier (RID) of the DR or BDR for this segment, and more.  This is a great starting point for troubleshooting. <br><br><h3>  The role of DR and BDR </h3><br>  The main disadvantage of distance vector protocols is slow convergence. <br><br>  <i>Convergence</i> means the state of the network when each router has a similar look to other routers and an accurate view of the network, especially after a topology change, such as when the route is disabled.  Remote-vector protocols do not converge quickly enough, which can lead to non-optimal routing and routing loops. <br><br>  Channel state protocols converge almost immediately after a topology change.  OSPF uses dedicated routes and spare dedicated routes for fast and correct network convergence. <br><br><h3>  How DR sends network change messages </h3><br>  When a router in an OSPF segment with DR and BDR notices changes in the network, it does not notify all its neighbors.  Instead, it sends a multicast to 224.0.0.6, the address that both routers are listening to - DR and BDR, to be aware of such changes. <br><br>  Then DR sends multicast to 224.0.0.5 - notify all non-DR and non-BDR routers in the network.  (Routers that are not DR or BDR are called DROthers, as shown in the <i>show ip ospf neighbor</i> command output).  DROthers send a confirmation (LSA acknowledgment, LSAck) back to the DR to receive the update. <br><br>  Two notes: <br><br>  - Only DR and BDR are listening 224.0.0.6. <br><br>  - Only DR sends multicast to 224.0.0.5 to notify DROthers about changes in the network.  BDRs receive them, but do not notify other routers.  Listening to 224.0.0.6 gives BDR the ability to have the latest changes to the database - and this is important in case it becomes DR. <br><br><h3>  DR / BDR selection process </h3><br>  <i>Almost</i> every OSPF network segment contains DR and BDR.  As always there are exceptions, and we will discuss these situations further.  And now, let's take a closer look at the rules for choosing DR and BDR. <br><br>  According to the following network diagram (I could put a switch in the center instead of naming an ‚ÄúEthernet‚Äù segment; be prepared to see this in the network documentation). <br><br clear="all"><img src="https://habrastorage.org/files/d79/ee0/8bc/d79ee08bc1da4f1dae09ce7bf4657fb5.png" width="250"><br><br>  The interfaces of the four routers are in the Ethernet segment.  One will become DR, the other BDR, the rest - DROthers.  Before we see how Cisco routers assign these roles, let's take a look at the process of choosing a DR / BDR. <br><br>  1. All routers with interface priority 1 or higher can be selected as DR / BDR.  Setting the priority to 0 deprives the router of this possibility. <br><br>  2. The router with the highest priority becomes DR. <br><br>  3. If they match, the values ‚Äã‚Äãof the RID are compared.  The router with the greatest wins. <br><br>  4. This process is repeated to select a new BDR.  The same router cannot be both DR and BDR. <br><br>  Later we will discuss the interesting behavior of DROthers in the Ethernet segment.  And now let's focus on the DR / BDR selection process using OSPF RID. <br><br><h3>  OSPF RID selection process </h3><br>  Obviously, OSPF RID plays a big role in choosing DR and BDR - but how is the RID value determined?  According to the following rules: <br>  The OSPF router RID will be the largest IP address assigned to the loopback interface, regardless of whether this interface was included in the OSPF process.  It is not automatically advertised by OSPF. <br><br>  If there are no loopback interfaces, the router's OSPF RID will be the highest IP address assigned to the physical interface, whether it is included in OSPF or not. <br><br>  These rules can be rewritten by manually installing the OSPF RID using the <i>router-id</i> command, but the OSPF process (cleared) must be restarted on the router. <br><br>  It seems a little strange that loopback interfaces that are not participating in OSPF determine the RID, does it? <br>  Let's look at everything in action.  R1 and R5 have formed a neighborhood in the 10.1.1.0/24 subnet.  R5 has several loopback interfaces, but only two are advertised via OSPF: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">hostname</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">R5</span></span> ! <span class="hljs-selector-tag"><span class="hljs-selector-tag">interface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Loopback6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 6<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span> ! <span class="hljs-selector-tag"><span class="hljs-selector-tag">interface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Loopback7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 7<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span> ! <span class="hljs-selector-tag"><span class="hljs-selector-tag">interface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Loopback8</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 8<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span> ! <span class="hljs-selector-tag"><span class="hljs-selector-tag">interface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Ethernet0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> ! <span class="hljs-selector-tag"><span class="hljs-selector-tag">router</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospf</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">network</span></span> 6<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">area</span></span> 0 <span class="hljs-selector-tag"><span class="hljs-selector-tag">network</span></span> 7<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">area</span></span> 0 <span class="hljs-selector-tag"><span class="hljs-selector-tag">network</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">area</span></span> 0</code> </pre><br>  Knowing the rules for determining OSPF RID, which OSPF RID will show R1 for R5?  Look at the configuration and find out. <br><br>  If you said 8.8.8.8, then you are right.  To see the OSPF neighbor RID, enter <i>show ip ospf neighbor</i> : <br><br><pre> <code class="hljs pgsql">R1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip ospf neighbor Neighbor ID Pri State Dead <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/DR <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">10.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> Ethernet0</code> </pre><br>  The value specified under <i>Neighbor ID</i> is the neighbor RID. <br><br>  To illustrate another important thing regarding DR and BDR, let's go back to our four-router example.  Routers have the following addresses: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">RouterA</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Loopback</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">ethernet0</span></span> 172<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RouterB</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Loopback</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">ethernet0</span></span> 172<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RouterC</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">No</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loopback</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">ethernet0</span></span> 172<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RouterD</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">No</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loopback</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">ethernet0</span></span> 172<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span></code> </pre><br>  RIDs will be: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">RouterA</span></span>: 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RouterB</span></span>: 2<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RouterC</span></span>: 172<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RouterD</span></span>: 172<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span></code> </pre><br>  The RID selection process always prefers IP addresses of loopback interfaces over physical ones. <br><br>  In summary, we have three ways to influence the RID value: <br><br>  - Changing OSPF priority using the <i>ip ospf priority</i> command <br><br>  - Install RID manually using <i>router-id</i> <br><br>  --Install RID by configuring loopback interface <br><br>  None of these methods is ‚Äúerroneous‚Äù or ‚Äúcorrect‚Äù - so know all three, and know that you need to restart the OSPF processes to apply the changes. <br><br><h3>  What happens if the DR is turned off and then on? </h3><br>  If all four routers are on at the same time, we expect that router D will be DR and router C - BDR.  But what if router D turns off and then turns on? <br><br>  If there is no router D, router C becomes DR.  Router B will be BDR.  And then router D is turned on, but <i>routers C and B retain their roles.</i> <br><br>  This is not like the spanning tree protocol, where the new switch, with a lower BID, becomes the root switch.  In OSPF, the choice of DR / BDR does not change when you turn on the new router or turn on the one that was previously DR or BDR. <br><br>  Let's look at an example with three routers in an Ethernet segment.  The priority of router A is 100, B is 50, C is 10. Router A is selected by DR, B is BDR. <br><br clear="all"><img src="https://habrastorage.org/files/6b8/59f/ff5/6b859fff55154b3a85f7088facc4f4a3.png" width="350"><br><br>  Everything is fine until Router A turns off. Routers B and C become DR and BDR respectively. <br><br clear="all"><img src="https://habrastorage.org/files/44a/d43/e64/44ad43e6471042bbadaae4d94fb57ccf.png" width="350"><br><br>  Turning on Router A is not a reason to re-select DR / BDR, even if Router A has a higher priority than DR and BDR.  When enabled, Router A becomes DROther. <br><br clear="all"><img src="https://habrastorage.org/files/f7f/c55/19b/f7fc5519b43c4bb7b2fb533e862bd96f.png" width="350"><br><br>  In order for Router A to become DR again, both the current DR and BDR must shut down!  What happens when router B turns off? <br><br clear="all"><img src="https://habrastorage.org/files/aec/b02/09d/aecb0209df704189b967612bc496a0c9.png" width="300"><br><br>  Router C becomes DR, Router A becomes BDR.  When you turn on router B, it will be DROther. <br><br clear="all"><img src="https://habrastorage.org/files/461/391/9ed/4613919edfa54cb4926ae22d9fec5b09.png" width="350"><br><br>  For final installation as the DR of router A, turn off router C. Now router A from BDR will become DR, and router B will become BDR. <br><br clear="all"><img src="https://habrastorage.org/files/5d0/7fc/599/5d07fc599d174a9598551ed4ba1b5e22.png" width="350"><br><br>  When you turn on router C, it will become DROther, and we will get the same network layout! <br><br clear="all"><img src="https://habrastorage.org/files/6b8/59f/ff5/6b859fff55154b3a85f7088facc4f4a3.png" width="350"><br><hr>  * I did not dare to make a headline, but still let it be PS: <br>  Since the quote is taken from a book published by the Dynasty Foundation, then, recalling the <a href="http://geektimes.ru/post/253176/">call to</a> <a href="http://habrahabr.ru/users/progchip666/" class="user_link">progchip666</a> , I am writing here - ‚Äú <a href="http://habrahabr.ru/users/progchip666/" class="user_link">Dedicating the</a> Dynasty Foundation‚Äù to the liquidation. <hr><br>  UPD: poll updated, thanks for the tip. <br>  UPD2: <a href="https://github.com/urticazoku/translation-Chris-Bryant-CCNP-Route">github</a> . <br></div><p>Source: <a href="https://habr.com/ru/post/263943/">https://habr.com/ru/post/263943/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263929/index.html">Digest: VR and AR</a></li>
<li><a href="../263931/index.html">Sampling schemes</a></li>
<li><a href="../263933/index.html">The mini-detective is NOT a system administrator</a></li>
<li><a href="../263935/index.html">Familiarity with the internal structure of the .NET Framework. Let's see how the CLR creates objects.</a></li>
<li><a href="../263939/index.html">How we spent a couple of days working on Perl acceleration</a></li>
<li><a href="../263945/index.html">The story of one clone</a></li>
<li><a href="../263947/index.html">Visualization of static and dynamic networks on R, part 2</a></li>
<li><a href="../263951/index.html">Accelerated course on notations in the theory of programming languages</a></li>
<li><a href="../263953/index.html">Visualization of static and dynamic networks on R, part 3</a></li>
<li><a href="../263957/index.html">The first Lean Poker tournament in Russia was held in Omsk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>