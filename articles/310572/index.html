<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We add numbers on Rust</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Implementing the arithmetic of natural numbers with Peano numbers is a popular programming learning problem. I was wondering whether it is possible to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We add numbers on Rust</h1><div class="post__text post__text-html js-mediator-article"><p>  Implementing the arithmetic of natural numbers with Peano numbers is a popular programming learning problem.  I was wondering whether it is possible to implement them on Rust.  Thus, my task is to write down and add the natural numbers with type-type checking. </p><br><a name="habracut"></a><br><p>  If you believe Wikipedia "Axioms Peano - one of the systems of axioms for natural numbers, introduced in the XIX century by the Italian mathematician Giuseppe Peano." </p><br><p>  We are interested in two of them - with which you can enter and use natural numbers: </p><br><ul><li>  1 is a natural number </li><li>  The number following the natural is also natural. </li></ul><br><p>  Literally we will write on raste with the help: </p><br><pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nat</span></span></span></span> { Zero, Succ(Nat) }</code> </pre> <br><p>  Nat is either a zero or the next positive integer.  But such a record has a problem - we have received infinitely many natural numbers: </p><br><p> <code>error: recursive type `Nat` has infinite size</code> </p> <br><p>  An obvious solution would be to store any pointer to the next positive number instead of <code>Succ(Nat)</code> . <br>  But then at the level of types there will be only two values ‚Äã‚Äã- <code>Zero</code> and <code>Box&lt;Succ&gt;</code> .  It does not work: there is no information about the numbers at the level of types - 5 and 7 have one type. </p><br><p>  <a href="https://is.gd/n7Bjiw">Run the code on play.rust-lang.org</a> </p><br><p>  We write the same numbers a little differently: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::marker::PhantomData; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zero</span></span></span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Succ</span></span></span></span>&lt;T&gt; { _marker : PhantomData&lt;T&gt; }</code> </pre> <br><p>  Zero is a data type with one possible value - Zero.  Succ is a data type also with a single value - Succ, but with a payload in the form of a data type.  May be <code>Succ&lt;i32&gt;</code> , <code>Succ&lt;String&gt;</code> , <code>Succ&lt;Succ&lt;_&gt;&gt;</code> , etc. </p><br><p>  Now we have separately zero and the following number separately.  Now the type <code>Succ&lt;Succ&lt;Succ&lt;Succ&lt;Zero&gt;&gt;&gt;&gt;</code> is valid.  But there is a problem - Zero is not connected with Succ.  Solution - we introduce the type Nat: </p><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nat</span></span></span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span></span>() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>; }</code> </pre> <br><p>  <code>Nat</code> is a type that should implement any type that is part of natural numbers, that is, Zero and Succ. <br>  The new function allows you to drop a value from the type level to the data level by creating a concrete instance. <br>  We implement it for Zero and Succ: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Nat <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Zero { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span></span>() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span> { Zero } } <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T : Nat&gt; Nat <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Succ&lt;T&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span></span>() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span> { Succ { _marker : PhantomData } } }</code> </pre> <br><p>  Now we can create a natural number! </p><br><p>  <a href="https://is.gd/eNYw2D">Run the code on play.rust-lang.org</a> </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> two : Succ&lt;Succ&lt;Zero&gt;&gt; = Nat::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> three : Succ&lt;Succ&lt;Succ&lt;Zero&gt;&gt;&gt; = Nat::new();</code> </pre> <br><p>  Our next goal is to get the number 4 from number 3!  We introduce the type Incr: </p><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Incr</span></span></span></span> : Nat { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Result</span></span></span></span>; }</code> </pre> <br><p>  It differs from our past image of Nat in that it contains not only functions, but also type.  The increment type T on 1 according to our rules of natural numbers is Succ.  What we write: <br></p><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T : Nat&gt; Incr <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> T { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Result</span></span></span></span> = Succ&lt;T&gt;; }</code> </pre> <br><p>  Thus, we implemented the Incr type for all types T with realized Nat. </p><br><p>  Now you can write a function that accepts something with the Incr type (which is implemented for all natural numbers) and returns what is written in the Incr type implementation.  This is literally and write: </p><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">incr</span></span></span></span>&lt;T : Incr, Res : Nat&gt;(_ : T) -&gt; Res <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Incr&lt;<span class="hljs-built_in"><span class="hljs-built_in">Result</span></span> = Res&gt; { Res::new() }</code> </pre> <br><p>  Now we can get 4! </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> three : Succ&lt;Succ&lt;Succ&lt;Zero&gt;&gt;&gt; = Nat::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> four = incr(three);</code> </pre> <br><p>  And we can, for example, write a function for working with numbers and be sure that it will not do anything except an increment: </p><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span></span>&lt;In : Nat, Out : Nat&gt;(x : In) -&gt; Out <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> In : Incr&lt;<span class="hljs-built_in"><span class="hljs-built_in">Result</span></span> = Out&gt; { incr(x) }</code> </pre> <br><p>  Useful!  Now let's try to add the numbers: according to Peano's axiomatics, addition can be written like this: </p><br><pre> <code class="rust hljs">x + <span class="hljs-number"><span class="hljs-number">0</span></span> = x x + Succ(y) = Succ(x + y)</code> </pre> <br><p>  Let's try to write it in terms of rasta: </p><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sum</span></span></span></span>&lt;B&gt; : Nat { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Result</span></span></span></span>; }</code> </pre> <br><p>  We introduce the type of Sum.  Another type of syntax appeared - a type parameterized by type.  In this case, <code>Sum&lt;B&gt;</code> is all that can be added with B. </p><br><p>  We realize addition of zero: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;A : Nat&gt; Sum&lt;A&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Zero { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Result</span></span></span></span> = A; }</code> </pre> <br><p>  and the addition is not zero: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;A : Nat, B : Nat, Res&gt; Sum&lt;A&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Succ&lt;B&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> B : Sum&lt;A, <span class="hljs-built_in"><span class="hljs-built_in">Result</span></span> = Res&gt; { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Result</span></span></span></span> = Succ&lt;Res&gt;; }</code> </pre> <br><p>  If you look closely, you can see that this is <code>x + Succ(y) = Succ(x + y)</code> . </p><br><p>  By analogy with incr, we will write a convenient function: </p><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span></span>&lt;A : Sum&lt;B&gt;, B : Nat, Res : Nat&gt;(_ : A, _ : B) -&gt; Res <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> A : Sum&lt;B, <span class="hljs-built_in"><span class="hljs-built_in">Result</span></span> = Res&gt; { Res::new() }</code> </pre> <br><p>  Now we can add numbers! </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> two : Succ&lt;Succ&lt;Zero&gt;&gt; = Nat::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> three : Succ&lt;Succ&lt;Succ&lt;Zero&gt;&gt;&gt; = Nat::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> four = incr(three); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> six = sum(two, four);</code> </pre> <br><p>  But this is clearly not enough.  It would be desirable, for example, to display the result on the screen.  The easiest option is to write this: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> six : () = sum(two, four)</code> </pre> <br><p>  The compiler will report an error and beautifully show the type we need in the "expected" field: </p><br><pre> <code class="hljs go">note: expected <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-string"><span class="hljs-string">`Succ&lt;Succ&lt;Succ&lt;Succ&lt;Succ&lt;Succ&lt;Zero&gt;&gt;&gt;&gt;&gt;&gt;`</span></span> note: found <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-string"><span class="hljs-string">`()`</span></span></code> </pre> <br><p>  But I want to withdraw our number in a more honest way.  We use the type <a href="https://doc.rust-lang.org/std/fmt/trait.Display.html">Display</a> . </p><br><p>  Let's start with Zero: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::fmt::{Display, <span class="hljs-built_in"><span class="hljs-built_in">Result</span></span>, Formatter}; <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Display <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Zero { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fmt</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, f: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Formatter) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Result</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write!</span></span>(f, <span class="hljs-string"><span class="hljs-string">"Zero"</span></span>) } }</code> </pre> <br><p>  Zero just withdraw. </p><br><p>  Now a little recursion: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T : Nat + Display&gt; Display <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Succ&lt;T&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fmt</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, f: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Formatter) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Result</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write!</span></span>(f, <span class="hljs-string"><span class="hljs-string">"(Succ {})"</span></span>, T::new()) } }</code> </pre> <br><p>  <a href="https://is.gd/KXeeUq">Run the code on play.rust-lang.org</a> </p><br><p>  Now you can print our 6: </p><br><pre> <code class="rust hljs">(Succ (Succ (Succ (Succ (Succ (Succ Zero))))))</code> </pre> <br><p>  We have succeeded!  I leave the reader to enter the multiplication: </p><br><pre> <code class="hljs lisp">x * Zero = Zero x * Succ(<span class="hljs-name"><span class="hljs-name">y</span></span>) = x * y + x</code> </pre> <br><p>  So with the help of monomorphizing plant types, you can add numbers at compile time.  I am not sure that the presented solution is correct or idiomatic, but it seemed to me curious. </p><p></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310572/">https://habr.com/ru/post/310572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310562/index.html">[SC] We work with the scanner</a></li>
<li><a href="../310564/index.html">About HPE Synergy. Part III - D3940 Disk Storage and SAS Switches</a></li>
<li><a href="../310566/index.html">Entertaining math command line</a></li>
<li><a href="../310568/index.html">Selection and planning of the web studio team at the start</a></li>
<li><a href="../310570/index.html">Correct polyhedra. Part 1.1 The Schl√§fli Symbol</a></li>
<li><a href="../310574/index.html">Programming with the eyes (and hands) of the humanities. Personal experience. A little philosophy</a></li>
<li><a href="../310576/index.html">FSB plans to decrypt all Internet traffic of Russians in real time</a></li>
<li><a href="../310578/index.html">ISPsystem company: we carry out hakaton</a></li>
<li><a href="../310580/index.html">September 24, we invite you to the conference MIXAR 2016 - non-classical conference on the latest technologies</a></li>
<li><a href="../310582/index.html">Automation of measurement of generator harmonic ratio using a digital oscilloscope and MATLAB</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>