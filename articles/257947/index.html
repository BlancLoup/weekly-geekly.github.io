<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing an IR remote control for a camera</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading the article on Habr√© ‚ÄúMaking the IR remote control for a camera‚Äù , I wanted to share the experience of developing an IR remote control f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing an IR remote control for a camera</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a8e/2d7/83d/a8e2d783db644055915c47e0b88c162c.png"><br><br>  After reading the article on Habr√© <a href="http://habrahabr.ru/post/255667/">‚ÄúMaking the IR remote control for a camera‚Äù</a> , I wanted to share the experience of developing an IR remote control for cameras as an Android application (from idea to publication). <br><a name="habracut"></a><br><h1>  Idea </h1><br>  Having bought a mirror camera, after a while you realize the need for manual tuning, a tripod and a contactless release of the shutter, which is carried out with the help of additional equipment offered by the manufacturer.  But, realizing that in your Android-phone there is an IR, which you can remotely release the shutter, you go to Google Play.  There, a search for "camera remote" immediately gives a lot of applications, among which there are suitable ones. <br><br>  You download, you try - yes, they work, but ... the usability and the interface leave much to be desired.  In addition to the above, in my model of the camera there is a lack of the function of counting the ex-pairs for shooting at night.  Therefore, I decided to implement my own application in order to understand what Android is and what it eats with. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Testing IR on the phone </h1><br>  The implementation of an application that performs a contactless shutter release, took no more than one hour.  During this time, the Activity was created with one button and a way was found to send signals to the camera, which looks like this: <br><br><pre><code class="java hljs">ConsumerIrManager consumerIrManager = (ConsumerIrManager) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getSystemService(Context.CONSUMER_IR_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frequency = <span class="hljs-number"><span class="hljs-number">38400</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] pattern = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]{ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">1095</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2500</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> }; consumerIrManager.transmit(frequency, pattern);</code> </pre> <br>  What just happened?  A ‚Äúprogram‚Äù was created that performs the function of a device that Nikon wanted to sell me for $ 30. <br><br><h1>  TK </h1><br>  I thought, ‚Äú <i>What could be simpler than the implementation of a single button?</i> ‚Äù, But that was not the case. <br><br>  Analysis of competitors has led to a long list of their opportunities and shortcomings.  I will give only the main ones. <br><br>  <i>Opportunities:</i> <br><ul><li>  you can set the delay before the first shot, the camera shutter speed in blub mode, the delay between subsequent shots, the number of shots </li><li>  HDR mode (Bracketing) - shooting multiple frames with different shutter speeds </li><li>  sound triggering </li><li>  support a large number of cameras and devices </li></ul><br><br>  <i>Disadvantages:</i> <br><ul><li>  poor design and ease of use, or good design, but few features </li><li>  work in the main thread </li></ul><br><br>  <b>Application Requirements:</b> <br><ul><li>  make free and ad-free application that is not ashamed to show others </li><li>  enable all competitors features </li><li>  realize calculators and pairs of depth of field </li><li>  add time display dusk and dawn (the golden hour) </li><li>  provide work in the background process </li><li>  connect sound notifications </li><li>  develop the most rapid and intuitive design for key features </li><li>  do not forget about the "wow effect" </li></ul><br><br>  Some tasks are beyond the scope of the remote control, but I wanted to try as many Android features as possible. <br><br><h1>  Realization or "Walking on underwater mines" </h1><br><h3>  Work with graphics </h3><br>  When developing, I adhere to the philosophy: "More vector, less raster graphics."  Therefore, the whole project required ‚Äútwo‚Äù rasterized images - an application icon and a notification icon (not counting images for Google Play).  Everything else is free stock fonts and icon fonts.  Because of this, the interface looks the same quality on most devices, regardless of the screen resolution. <br><br>  In order to achieve maximum application performance, I usually refuse animation.  But its absence made the application work unobvious for the end user.  Therefore, to achieve the "wow effect" animation is present.  Due to the fact that the interaction with the application takes place around one button, it was as stylized as possible, and the shooting process is displayed around it. <br><br>  After working with WPF and Silverlight, it seemed to me that Android contains a very poor set of graphic primitives for building independent vector objects (objects that themselves know how to redraw themselves - without having to draw them manually on the canvas).  Therefore it was necessary to make several iterations of the implementation of the ProgressBar ring. <br><br><img src="https://habrastorage.org/files/ee7/343/03b/ee734303b4784cf0ad07e853012444f1.png"><br><br>  <i>Strangeness:</i> If on some devices call the ClipDrawable object setRotation () with angles other than 0, 90, 180, ..., in which there are other graphic objects, they become fully visible regardless of ClipDrawable.setLevel (). <br><br><h3>  Work with notification </h3><br>  I wanted to create a notification, and change the state of progress of the shooting in it.  But instead you have to constantly re-create it, due to the limitations of Android.  The speed with which the time remaining until the next triggering changes causes one to do this often, which made it impossible to use the icon with a higher resolution. <br><br><h3>  Work with hardware </h3><br>  Developing this type of application in a standard emulator is difficult and time consuming, in more nimble counterparts it is simply difficult.  The presence of a Samsung S4 <s>shovel</s> , made it easier to work with the hardware of the device.  The emulators failed to achieve IR support, and there were very large brakes with the microphone, after which the sound level behaved no less unpredictably. <br><br>  After the release, I wanted to refine other, more mysterious ways of "pressing a button" for ordinary <s>mortal</s> users.  The idea was to release the shutter of the camera without touching the phone, and in the best case with the display off. <br><br><img src="https://habrastorage.org/files/1ea/348/8c8/1ea3488c8dd042849a2c1a18cbabe359.jpg"><br><br>  Demonstration scenario: fix the camera in the distance and put the ‚Äúoff‚Äù phone in front of you, after which the camera is triggered from the ‚Äúmagic‚Äù gesture.  For greater effect, you can turn on the flash.  It is checked, it looks with surprise and exclamation ‚ÄúWow!‚Äù (The latter depends on the emotionality of a particular person). <br><br>  The first thing that came to mind was to use the Air Gestures first demonstrated by the Samsung S4.  The SDK search has led to disappointment: <a href="http://developer.samsung.com/galaxy">Devices with Android 4.3 Jelly Bean (API level 18) or higher support Gesture except Galaxy S4 due to a hardware issue.</a>  But, I remembered the accelerometer and, later, about the illumination. <br><br>  Initially implemented triggering when the device transitions from a vertical to a horizontal position.  Everything worked fine until the phone was disconnected from the computer.  When the screen is turned off, the accelerometer ‚Äúfalls asleep‚Äù, i.e.  Signals about a change in the position of a device in space cease to be generated.  It was not possible to eliminate this effect either by working in the background service or by the power saving settings. <br><br>  Implemented triggering on a sharp change in light.  This sensor does not ‚Äúfall asleep‚Äù when the display is off, but the number of generated signals decreases markedly.  It is due to the presence of this sensor in the device, the previously written script works. <br><br>  There was an idea to connect cameras for recognition, for example, winks.  But, I could not find the sane free library for this. <br><br><h3>  Process in general </h3><br>  In most cases, the Android platform behaves as expected.  There were no problems in determining the location, receiving data from the weather forecast server, implementing the application life cycle, using the background service and working with the database. <br><br><h3>  IDE </h3><br>  In connection with the work, I had to change Visual Studio to Eclipse, which periodically enrages to this day.  But, for developing the application, I installed Android Studio with the hope that ‚ÄúStudio‚Äù in the title means something.  From the first created methods and variables, I realized that this is what I was waiting for: code spelling, smart autocomplete, a huge number of hints and much more.  Thanks to the developers for a quality product! <br><br><h3>  Publication </h3><br>  He created an account, paid a fee, read the recommendations, set up a release version, created a signed application, prepared a description in several languages ‚Äã‚Äã(EN, RU, UA, NO), took photos of the application and laid out it as a beta version. <br><br>  Surprise was the mandatory image for Google Play size of 1024x500, although in the articles they wrote that it "does not hurt". <br><br>  When compiling the release version, ProGuard was used, which disrupted the operation of a certain part of the code based on the names of the classes that it successfully obfuscated.  The problem was not immediately detected, since when launching the release version, the ‚Äúdebuggable‚Äù parameter is ‚Äúfalse‚Äù.  Errors popped up, processed and everything worked on. <br><br>  Due to the fact that the application for the micromarket, I did not plan to write an article on Habr, if it were not for the problem with IC.  At first he wrote on the forums for photographers, but the result was just a ban.  Mostly helped youtube.  Then came the first real users, and with them the problems. <br><br><h1>  Details about the <s>torture of</s> working with the infrared port </h1><br>  Returning to the code to send pulses: <br><br><pre> <code class="java hljs">ConsumerIrManager consumerIrManager = (ConsumerIrManager) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getSystemService(Context.CONSUMER_IR_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frequency = <span class="hljs-number"><span class="hljs-number">38400</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] pattern = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]{ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">1095</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2500</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> }; consumerIrManager.transmit(frequency, pattern);</code> </pre><br>  Everything was good until it turned out that IR support appeared in Android only from API version 19. What happened before that?  Quite a lot of devices with IR were released. To manage them, manufacturers either created their own libraries (HTC OpenSense IR API and LG QRemote IR SDK) or published sample code to work with their IR (Samsung).  What happened after?  New versions have been released, and the signaling method standardized in API 19 has changed. <br><br>  I managed to get the application to work with IR ports on Samsung with versions of Android KitKat and Lollipop.  After many attempts at remote testing with the HTC One M8, I realized that it would be very difficult to implement support for other devices myself.  Therefore, I created a project on GitHub that anyone can download: <a href="https://github.com/OneButtonDeveloper/AndroidInfraRed">AndroidInfraRed</a> . <br><br><h3>  A bit of a <s>boring</s> theory. </h3><br>  For remote control of the device using IR, you need: a transmitter and a sequence of signals that must be sent.  In my case, the device is the Nikon D7100, the transmitter is the Samsung S4. <br><br>  The sequence is defined by two parameters: the frequency (Hertz) and the pattern, which represents a certain time sequence of the presence / absence of a signal of a given frequency. <br><br>  Example (for Samsung devices with Android version&gt; = 4.4.3) <br><ul><li>  Frequency: 40000 </li><li>  Pattern: 125, 100, 150, 75, ... </li></ul><br>  Example (for Samsung devices with Android version &lt;= 4.4.2) <br><ul><li>  Frequency: 40000 </li><li>  Pattern: 5, 4, 6, 3, ... </li></ul><br><br><img src="https://habrastorage.org/files/a3d/4eb/ce4/a3d4ebce471b4e20b082e1b032be9d31.jpg"><br><br><h1>  Details about the project </h1><br>  The <a href="https://github.com/OneButtonDeveloper/AndroidInfraRed">AndroidInfraRed</a> project created in Android Studio includes: <br><ul><li>  Library for working with IR </li><li>  MainActivity with one button for testing </li></ul><br><br>  The library consists of: <br><ul><li>  The logging module, for the simple possibility of displaying messages either on the console or in EditText, or disable the log altogether </li><li>  A pattern module that allows you to adapt signal sequences for a specific type of device </li><li>  The transmitter definition module, which by analyzing the device, returns the way in which signals can be transmitted </li><li>  Transmitter module, in which methods of sending signals are implemented </li><li>  Class InfraRed, combining the work of modules </li></ul><br><br><h2>  How it works </h2><br>  Description of lines of code from <a href="">MainActivity.java</a> <br><br><h4>  1. Choose one of the three logging methods </h4><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Log messages print to EditText EditText console = (EditText) this.findViewById(R.id.console); log = new LogToEditText(console, TAG); log.log("Hello, world!"); // Log messages print with Log.d(), Log.w(), Log.e() // LogToConsole log = new LogToConsole(TAG); // Turn off log // LogToAir log = new LogToAir(TAG);</span></span></code> </pre><br>  By default, the selected text display device <br><br><h4>  2. Create an object of the class InfraRed </h4><br><pre> <code class="java hljs">infraRed = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InfraRed(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, log);</code> </pre><br>  For this you need to transfer Context and Logger <br><br><h4>  3. Initialize the transmitter </h4><br><pre> <code class="java hljs">TransmitterType transmitterType = infraRed.detect(); infraRed.createTransmitter(transmitterType);</code> </pre><br>  The "detect ()" function returns one of the values ‚Äã‚Äãof the TransmitterType enumeration.  The options are Actual, HTC, LG, and Undefined.  In the case of Actual, the ConsumerIrManager class provided by Android will be used to transmit signals.  If HTC or LG - the corresponding SDKs will be used, if Undefined, then it is an ‚Äúempty‚Äù implementation. <br><br><h4>  4. Initialize the signal sequences </h4><br><pre> <code class="java hljs">PatternConverter patternConverter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PatternConverter(log); List&lt;TransmitInfo&gt; patterns = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-comment"><span class="hljs-comment">// Nikon D7100 v.1 patterns.add(patternConverter.createTransmitInfo(38400, 1, 105, 5, 1, 75, 1095, 20, 60, 20, 140, 15, 2500, 80, 1)); // Nikon D7100 v.2 patterns.add(patternConverter.createTransmitInfo(38400, 77, 1069, 16, 61, 16, 137, 16, 2427, 77, 1069, 16, 61, 16, 137, 16));</span></span></code> </pre><br>  Using the PatternConverter class, we initialize the signals for the devices we want to control. <br><br>  <b>Important!</b>  The function ‚ÄúcreateTransmitInfo (int frequency, int ... pulseCountPattern)‚Äù receives the signal as a sequence of cycles (as in Android &lt;= 4.4.2), and not microseconds (as in Android&gt; = 4.4.3).  To go from microseconds to cycles, each element of the pattern must be multiplied by the frequency and divided by one million (the number of microseconds per second).  This is the inverse operation, to the one that converts given sequences under Android&gt; = 4.4.3. <br><br><h4>  5. We transfer the sequence of signals to the device </h4><br><pre> <code class="java hljs">TransmitInfo transmitInfo = patterns[random.nextInt(patterns.length)]; infraRed.transmit(transmitInfo);</code> </pre><br>  In a specific example, we send specified signals in a random order. <br><br><h3>  Comments </h3><br>  The <a href="https://github.com/OneButtonDeveloper/AndroidInfraRed">AndroidInfraRed</a> project is an almost complete solution for remote control of devices using IR.  The only thing missing is to test and adjust work with HTC, LG, Sony ... I really hope that there will be people on Habr√© with smartphones with IR that will help this project and those who will want to add IR work to their application in the future. <br><br><h1>  Result </h1><br><img src="https://habrastorage.org/files/fb7/781/8eb/fb77818eb1444b6eabe8b765481ac8ab.png"><br><br>  The result was to create an application that covers all my needs for remote control of the camera and the process of photographing in general.  It is a pity that the benefits of this application can be appreciated only by the owners of Samsung. </div><p>Source: <a href="https://habr.com/ru/post/257947/">https://habr.com/ru/post/257947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257937/index.html">New competition at PHDays: hacking mobile communications, electrical substations and routing protocols</a></li>
<li><a href="../257939/index.html">How Youtube banned our channel and how we restored it</a></li>
<li><a href="../257941/index.html">LFS: The dark side of power. Part 2</a></li>
<li><a href="../257943/index.html">Budget device based on Arduino for the blind (open hardware)</a></li>
<li><a href="../257945/index.html">LoveQA mitap on RHS ++</a></li>
<li><a href="../257949/index.html">Distributed transactions between RabbitMQ and MS SQL</a></li>
<li><a href="../257951/index.html">Vulnerability "VKontakte" allows you to get direct links to private photos</a></li>
<li><a href="../257953/index.html">About household misconceptions</a></li>
<li><a href="../257955/index.html">Personal data: dura lex, sed lex</a></li>
<li><a href="../257957/index.html">About alternative education in general and about C # in particular</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>