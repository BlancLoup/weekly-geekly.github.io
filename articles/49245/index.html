<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dock the components in JavaScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the note ‚Äú We are joining asynchronous scripts and the proposed solution from Steve Souders, I thought about modular loading of some complex Jav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dock the components in JavaScript</h1><div class="post__text post__text-html js-mediator-article"> After the note ‚Äú <a href="http://webo.in/articles/habrahabr/77-coupling-async-scripts/">We are joining asynchronous scripts</a> and the proposed solution from Steve Souders, I thought about modular loading of some complex JavaScript application.  And I realized that the proposed approach in this case would be rather cumbersome: we will need to insert the loader of the following modules at the end of each module.  And if we need different sets of modules and different logic of their loading on different pages?  Dead end? <br><br>  But no.  No wonder Steve mentions at the very beginning of his note on the <code>onload</code> / <code>onreadystatechange</code> for scripts.  Using them, we can uniquely bind some code to the end of loading of a specific module.  Things are simple: we need to define this very code in some way. <br><br><h3>  Solution one: boot tree </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As the easiest way to determine the order of loading modules on a specific page, you can offer a global array containing a dependency tree.  For example, such: <br><a name="habracut"></a><br><blockquote><pre>  var modules = [
	 [0, 'item1', function () {
		 alert ('item1 is loaded');
	 }],
	 [1, 'item2', function () {
		 alert ('item2 is loaded');
	 }],
	 [1, 'item3', function () {
		 alert ('item3 is loaded');
	 }]
 ]; </pre></blockquote><br><br>  As an element of this array, we have another array.  The first element is the indication of the parent ( <code>0</code> if the element is a root and should be loaded immediately), then the file name or its alias.  The last is an arbitrary function that can be performed by loading. <br><br>  Let's look at how this structure can be used: <br><br><blockquote><pre>  / * brute force and module loading * /
 function load_by_parent (i) {
	 i = i ||  0;
	 var len = modules.length,
		 module;
 / * iterate the module tree * /
	 while (len--) {
		 module = modules [len];
 / * and load the required elements * /
		 if (! module [0]) {
			 loader (len);
		 }
	 }
 }<font></font>
<font></font>
 / * declare function loader * /
 function loader (i) {
	 var module = modules [i];
 / * create a new script element * /
	 var script = document.createElement ('script');
	 script.type = 'text / javascript';
 / * set the file name * /
	 script.src = module [1] + '.js';
 / * set the text inside the tag to run on the download * /
	 script.text = module [2];
 / * remember the current index of the module * /
	 script.title = i + 1;
 / * set up the download handler for IE * /
	 script.onreadystatechange = function () {
		 if (this.readyState === 'loaded') {
 / * iterate through the modules and look for the ones you need to load * /
			 load_by_parent (this.title);
		 }
	 };
 / * set the load handler for the others * /
	 script.onload = function (e) {
 / * execute the text inside the tag (you need only for Opera) * /
		 if (/opera/i.test(navigator.userAgent)) {
			 eval (e.target.innerHTML);
		 }
 / * iterate through the modules and look for the ones you need to load * /
			 load_by_parent (this.title);
	 };
 / * attach the tag to the document * /
	 document.getElementsByTagName ('head') [0] .appendChild (script);
 }<font></font>
<font></font>
 / * load the root elements * /
 load_by_parent (); </pre></blockquote><br><br>  We can take out the loading of root elements in the page loading event, and the functions themselves - in any library, or declare directly on the page.  By setting our own tree on each page, we get full flexibility in asynchronous loading of any number of JavaScript modules.  It is worth noting that dependencies in this case are resolved ‚Äúfrom the root to the vertices‚Äù: we ourselves should know which basic components to load, and then download the more advanced ones. <br><br><h3>  Solution two: loading via DOM tree </h3><br><br>  In addition, I remembered that <a href="http://jsx.ru/" rel="nofollow">Andrey Sumin</a> had already dealt with this problem and even offered his solution in the form of the <a href="http://jsx.ru/" rel="nofollow">JSX</a> library, which allows you to assign a list of dependencies through a DOM tree.  For this, elements that require loading any modules for user interaction are assigned a class with the prefix <code>jsx-component</code> , and then comes the list of components.  The library itself bypasses the DOM tree, finds all the modules that need to be loaded, and loads them in sequence.  Just great. <br><br>  But what if we need to change the handler for loading this module?  How to ask it?  JSX itself uses the attributes of the required nodes of the DOM tree strictly to determine the parameters of these modules.  This is quite convenient: in this way, you can also assign a module initializer. <br><br>  The library also allows you to track the reloading of modules, to load additional modules in the event of a bad connection, and even to merge different modules into one source file through the alias system.  Thus, the problem of asynchronous loading of an arbitrary tree of modules is solved.  In the case of JSX, the task is resolved in the reverse order: we specify the main file (the top of the dependency tree), and it already loads all the modules it needs or checks that the modules are loaded. <br><br>  It's all? <br><br><h3>  Solution three: JSX + YASS </h3><br><br>  Nearly.  After some deliberation, JSX was taken as the basis for building a modular system that could become the basis for flexible and dynamic client applications.  It was possible to combine both approaches described above, which ensured all the visible functional requirements for such a system. <br><br>  For example, consider the following section of HTML code: <br><br><blockquote><pre>  &lt;div id = "item1" class = "yass-module-utils-base-dom"&gt;
	 &lt;span id = "item2" class = "yass-module-dom" title = "_ ('# item2') [0] .innerHTML = 'component is loading ...';"&gt; &lt;/ span&gt;
 &lt;/ div&gt; </pre></blockquote><br><br>  Let's see what kind of boot logic it provides: <br><br><ol><li>  During initialization, YASS bypasses the DOM tree of the document and selects all nodes with the <code>yass-module-*</code> class. </li><li>  After that, 2 module load streams are generated: for <code>utils-base-dom</code> and for <code>dom</code> .  And in the latter case of loading, in fact, it will not be: the loader waits until the state of the <code>dom</code> component is set to <code>loaded</code> , and only then runs (via <code>eval</code> ) the code recorded in the <code>title</code> this element (in this case, it is a <code>span</code> ). </li><li>  The first download stream will asynchronously call 3 files from the server: <code>yass.dom.js</code> , <code>yass.base.js</code> and <code>yass.utils.js</code> .  By loading <strong>all of</strong> these modules (because they are called in the dependency chain, in this case the <code>dom</code> depends on the <code>base</code> , which depends on the <code>utils</code> ) the corresponding initialization functions will be called (if defined).  Thus, two types of handlers are possible: directly on the component load (to be called for all components in the chain) and after loading the entire specified chain of components (in our case, it is <code>utils-base-dom</code> ). </li><li>  If we want to somehow expand our chain, then at the end of each of the specified files, we can prescribe the loading of some other chain (for example, <code>base-callbacks</code> ), which will ‚Äúfreeze‚Äù the loading of the <code>base</code> module before receiving <code>callbacks</code> .  This can be done (bearing in mind that we expand the dependencies of the <code>base</code> module) as follows: <br><blockquote><pre>  _.load ('callbacks-base'); </pre></blockquote></li><li>  The previous step can also be performed using the DOM-Tree itself: we will need to prescribe the <code>yass-module-callbacks-base</code> class for an arbitrary element.  This will add the desired chain to the dependency tree. </li></ol><br><br>  For greater clarity, the final tree of loadable modules described above can be represented as follows: <br><br><blockquote><pre>  dom
   -&gt; base
	   -&gt; utils
	   -&gt; callbacks </pre></blockquote><br><br>  Moreover, the next page presents the <a href="http://webo.in/tests/yass-tree-load/">process of loading a more complex version of the tree</a> .  Caution: there are no delays, so it can work very quickly :) <br><br>  Naturally, all the specified functionality has already been added to the latest version of <a href="http://yass.webo.in/">YASS</a> .  You can start using and writing reviews. <br><br>  PS JSX site is still (scared habraeffekt?), You can try to get information from the <a href="http://www.google.com/search%3Fhl%3Den%26client%3Dfirefox-a%26rls%3Dorg.mozilla%253Aru%253Aofficial%26hs%3DWPB%26q%3Dsite%253Ajsx.ru%26btnG%3DSearch">Google cache</a> </div><p>Source: <a href="https://habr.com/ru/post/49245/">https://habr.com/ru/post/49245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../49237/index.html">The Internet is growing by Moore's law</a></li>
<li><a href="../49238/index.html">First design steps</a></li>
<li><a href="../49239/index.html">[Steve Jobs] Information Wars</a></li>
<li><a href="../49242/index.html">What is our life ... Game</a></li>
<li><a href="../49244/index.html">[Steve Jobs] Macworld-2009</a></li>
<li><a href="../49246/index.html">The new Android phone HTC will be better than the iPhone and Palm Pre</a></li>
<li><a href="../49247/index.html">Favicon for any site in PNG</a></li>
<li><a href="../49249/index.html">Macbuntu :)</a></li>
<li><a href="../49250/index.html">Which is better: 32 or 64 bits?</a></li>
<li><a href="../49251/index.html">SPAM on GMail? For the first time I see.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>