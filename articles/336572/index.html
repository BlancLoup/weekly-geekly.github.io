<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Go, go, go ... First impressions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Weekday evening, how not to do writing articles, notes. In which I want to share my impressions of meeting Go . All that is written below is the subje...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Go, go, go ... First impressions</h1><div class="post__text post__text-html js-mediator-article"><p>  Weekday evening, how not to do writing articles, notes.  In which I want to share my impressions of meeting <em>Go</em> .  All that is written below is the subjective opinion of the author.  This article will be useful to those who want to sit down to study <em>Go</em> and will be of little use to developers on it. </p><a name="habracut"></a><br><h2 id="predystoriya">  Prehistory </h2><br><p>  My main activity is solving business problems in the environment of a harsh enterprise in <strong>java</strong> , and I want to learn new and interesting things by my nature, to support my skills, learn new things and not stand still (sort of a <a href="https://habrahabr.ru/post/336248/">linear-&gt; businessman</a> ).  And for this reason the look at <strong>docker</strong> fell long ago. </p><br><p> And on the current project, in some places, I began to introduce <strong>docker</strong> practices in the environment of developers and testers.  And where <strong>docker</strong> appears, containers appear and I want to know everything from these <em>CPUs</em> to <em>Network I / O</em> about these containers.  For all this, I first used the standard bundle of <code>docker ps</code> and <code>docker stats</code> .  There were some inconveniences due to the fact that these are two separate utilities, but on the whole it was sleepy until I came across a <a href="http://ctop.sh/">ctop</a> .  I think many people who use <strong>docker</strong> know it. </p><br><h2 id="proekt">  Project </h2><br><img src="https://habrastorage.org/web/657/1cb/0c8/6571cb0c81c04c2c80e696fdb05a736e.gif"><br><p><br>  Running <strong>ctop</strong> on the machine I saw beautiful like-htop containers with statistics and the ability to view detailed information on the container, with search or sorting.  In general, I was extremely pleased. </p><br><p>  Until a certain point, the first thing I would like to see in <strong>ctop</strong> is the <em>healthcheck</em> container, but it was not there.  Then <em>docker swarm mode</em> came up and for which I would also like to see statistics on services from <strong>ctop</strong> . <br>  And here the corrosive reader may wonder, and where is <strong>Go</strong> , if everything is about <em>docker</em> <del>  and personal opinion of the author </del>  . </p><br><p>  Having the experience of writing / finishing the Linux utilities for myself, I thought, well, since this is in the terminal and this is for the console, then there should be <strong>python</strong> and now we will quickly add everything that I want. </p><br><p>  Going into the <a href="https://github.com/bcicen/ctop">repository</a> , I was surprised to see <strong>Go</strong> there (although it is logical that the <strong>docker is</strong> written on it).  Remembering someone's words from the report about <strong>Go</strong> that he can learn it in the evening, he continued his efforts in finalizing the program.  After reading the documentation and launching examples from this <a href="https://gobyexample.com/">site I</a> sat down at the project. </p><br><h2 id="primery-koda">  Code examples </h2><br><p>  When I got acquainted with <strong>Go</strong> , the phrase had slipped somewhere that he was "laconic and easy to support" and I agree with these statements. </p><br><p>  The first thing that looked unusual, but comfortable - it is <strong>GOPATH</strong> .  About the setting and the concepts themselves are very well described <a href="https://habrahabr.ru/post/249545/">here</a> . </p><br><p>  Also, an interesting approach to the organization and structuring of packages and access level.  In particular, the declaration of <em>public</em> and <em>private</em> methods through upper and lower case letters and the implementation of interfaces.  And I was incredibly pleased with the signs, as a person from the world of <strong>java</strong> . </p><br><p>  Dependency management, at least on this project, did not cause any particular difficulties (even though <strong>Go was</strong> blamed for the lack of a package manager).  All that is specified in the <code>import</code> construct is collected in the <strong>GOPATH</strong> folder in the <em>scr</em> directory and dependencies can already be used.  Separately, it should be noted that the dependency can be directly on a project with <strong>GitHub</strong> and it is not much different from the dependency on some own module (the import logic is minimized): </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"strings"</span></span> <span class="hljs-string"><span class="hljs-string">"sync"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/bcicen/ctop/connector/collector"</span></span> api <span class="hljs-string"><span class="hljs-string">"github.com/fsouza/go-dockerclient"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/bcicen/ctop/config"</span></span> <span class="hljs-string"><span class="hljs-string">"context"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/bcicen/ctop/entity"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/docker/docker/api/types/swarm"</span></span> )</code> </pre> <br><p>  As for <strong>ctop</strong> , it turned out to be rather simple in its structure, for which a special thanks to its chief engineer. </p><br><p>  The structure of the project is divided into three major parts: </p><br><ul><li>  connector </li><li>  cwidgets </li><li>  grid / cursor </li></ul><br><p>  <strong>connector</strong> - an interface for connecting to various services provided information about containers.  For example, docker, opencontainer, kubernates and others. </p><br><p>  In the connector directory, the <code>main.go</code> class has been <code>main.go</code> , which describes the interface of our connector: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> connector <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Connector <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { All() container.Containers Get(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) (*container.Container, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>) }</code> </pre> <br><p>  And in order to import it, we need to create another file, for example, <code>docker.go</code> and, for the <code>NewDocker()</code> method, specify the return type of the interface and return the address for it. <br>  And then implement all the methods listed.  I liked that in the framework of one class it is possible to describe several implementations of the interface and this is a normal practice. </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Docker <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { client *api.Client containers <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*container.Container needsRefresh <span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> lock sync.RWMutex } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewDocker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Connector</span></span></span></span> { client, err := api.NewClientFromEnv() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(err) } cm := &amp;Docker{ client: client, containers: <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*container.Container), needsRefresh: <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>), lock: sync.RWMutex{}, } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cm } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cm *Docker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">All</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(containers container.Containers)</span></span></span></span> { cm.lock.Lock() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, c := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> cm.containers { containers = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>(containers, c) } containers.Sort() containers.Filter() cm.lock.Unlock() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> containers } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cm *Docker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*container.Container, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { cm.lock.Lock() c, ok := cm.containers[id] cm.lock.Unlock() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c, ok }</code> </pre> <br><p>  In parentheses after <code>func</code> indicated for which structure the method is implemented, it looks very convenient. </p><br><p>  <strong>cwidgets</strong> - individual graphic elements from which the ready interface is assembled. <br>  <strong>grid / cursor</strong> - a package that in itself gathers everything together for display on the screen and provides access and control methods. </p><br><p>  Implementing the <strong>healthcheck</strong> mapping was pretty simple.  In <code>docker.go</code> , <code>docker.go</code> added the <code>health</code> attribute to the meta information, which we read through <em>api,</em> similar to the <code>docker inspect &lt;CONTAINER&gt;</code> functional <code>docker inspect &lt;CONTAINER&gt;</code> .  And depending on the value, we change the text color in the <code>NAME</code> column. </p><br><p>  But the addition of <strong>swarm mode</strong> was more interesting. </p><br><p>  In the <strong>swarm</strong> mode, the concepts of <code>node</code> , <code>service</code> and <code>task</code> appear.  And between them it is necessary to display the relationship of who is where.  And this was <strong>not</strong> provided in <strong>ctop</strong> .  And here really felt a good maintainability of the code.  The container structure contained methods for accessing meta information and a graphical interface, which are easily put into a separate interface, which is necessary for new concepts introduced.  The interface looks like this: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> entity <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/bcicen/ctop/logging"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/bcicen/ctop/connector/collector"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/bcicen/ctop/models"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ( log = logging.Init() ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Entity <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { SetState(s <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) Logs() collector.LogCollector GetMetaEntity() Meta GetId() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> GetMetrics() models.Metrics }</code> </pre> <br><p>  Here we declare the <code>log</code> variable common to all classes implementing this interface and describe the interface contract: the method of changing the state of an element, access to the log of a specific element through the variable <code>log</code> , access to the meta information of the element and access to its metrics. </p><br><p>  After describing the interface, implementing it for all structs and replacing the old <code>container</code> with a new <code>entity</code> in the <code>grid</code> methods, one interesting question surfaced.  <strong>Docker</strong> currently does not provide the ability to get information about the use of resources from a remote node using <strong>api</strong> tools.  Therefore, I stopped at the implementation of the output of the structure of the <strong>swarm</strong> cluster and the <strong>healthcheck of the</strong> running tasks. </p><br><h2 id="vpechatlenie-i-zaklyuchenie">  Impression and Conclusion </h2><br><p>  In general, I was very pleased with the use of <strong>Go</strong> in the project, the language was really made practical and concise.  He recalled with something a mixture of <strong>Python</strong> and <strong>C ++</strong> , from which they tried to take the best.  You can really learn it in the evening.  But in order to start writing on it in the evening, one must have an adequate background, and I would not advise him to be the first language to learn.  To understand his convenience, you must probably come.  I also selected a niche for myself for the language in the form of writing services (it was probably designed for this purpose). </p><br><p>  As for <strong>ctop</strong> , the <em>mine</em> request received a pull request with the <em>healthcheck</em> map, now I plan to finish the mapping of the <strong>swarm</strong> structure.  I will be glad to suggestions how to implement the reading of container metrics from remote nodes. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/336572/">https://habr.com/ru/post/336572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336556/index.html">Blockchain as a revolution for familiar business processes: scenarios from SAP</a></li>
<li><a href="../336560/index.html">Network September and server October: waiting for you on HPE webinars</a></li>
<li><a href="../336564/index.html">Analysis of the on-line conferences of the RKN on the topic: ‚Äúproblematic issues of restricting access to information ...‚Äù</a></li>
<li><a href="../336566/index.html">‚ÄúCrocodile Skin Case‚Äù or ‚ÄúAlligator Bag‚Äù: Comparison of Online Translators Connected to Lokalise</a></li>
<li><a href="../336570/index.html">Zabbix: LLD monitoring of FlexLM services (UPDATED)</a></li>
<li><a href="../336574/index.html">Generation of documents. Easy and free</a></li>
<li><a href="../336578/index.html">Cryptoalgorithms. Classification in terms of the number of keys</a></li>
<li><a href="../336580/index.html">Metasloy: ideas about applying prediction to optimize programming and resource allocation in the OS</a></li>
<li><a href="../336584/index.html">Using the Chrome profiler frontend in your own projects</a></li>
<li><a href="../336586/index.html">Analysis of MS SQL Server, for those who see it for the first time (part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>