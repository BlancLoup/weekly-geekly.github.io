<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Code Obfuscation Techniques with LLVM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© there are many great articles about the possibilities and methods of using LLVM. I would like to tell more about popular obfuscation techniqu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Code Obfuscation Techniques with LLVM</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2de/4f5/161/2de4f51619cf10fb063263e52af20c8e.png" alt="image" align="left"><br>  On Habr√© there are many great articles about the possibilities and methods of using LLVM.  I would like to tell more about popular obfuscation techniques that can be implemented using LLVM, in order to complicate application analysis. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  The article carries more theory than a practical component and presupposes the presence of certain knowledge among the reader, as well as the desire to solve interesting problems for oneself without getting ready-made solutions.  Most of the instructions in <a href="http://llvm.org/docs/LangRef.html">LLVM IR are</a> based on the three-address code, which means that they take two arguments and return one value and that the number of instructions available to us is limited. <br><br>  Used software: <br>  - <a href="http://sourceforge.net/projects/mingwbuilds/%3Fsource%3Ddlp">GCC 4.8.2</a> (mingw64) <br>  - <a href="">IDA DEMO</a> <br>  - <a href="http://llvm.org/releases/download.html">Clang 3.4</a> <br>  - <a href="http://llvm.org/releases/download.html">LLVM 3.4</a> <br><br>  What is possible to implement with LLVM? <br>  1) Random <a href="http://ru.wikipedia.org/wiki/Control_flow_graph">CFG</a> <br>  This method modifies the program execution graph by supplementing it with basic blocks, the original starting block can be moved, diluted with garbage. <br><div class="spoiler">  <b class="spoiler_title">Examples</b> <div class="spoiler_text">  Original <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; int rand_func() { return 5+rand();; } int main() { int a = rand_func(); goto test; exit(0); test: int b = a+a; }</span></span></span></span></code> </pre> <br>  Original graph <br><img src="https://habrastorage.org/getpro/habr/post_images/1cd/191/8df/1cd1918df35fc3a6415ea062a870bf75.png" alt="image"><br>  Obfuscation 1 start, main function <br><img src="https://habrastorage.org/getpro/habr/post_images/059/514/fbc/059514fbc8ed18c7ed3886bcd7e0f013.png" alt="image"><br>  Obfuscation 2 start, main function <br><img src="https://habrastorage.org/getpro/habr/post_images/002/f9d/8f7/002f9d8f7663fcabff249b136a7741ab.png" alt="image"><br>  Obfuscation 3 start, main function <br><img src="https://habrastorage.org/getpro/habr/post_images/9a4/75d/584/9a475d584ddddfa551002f3488f76f9e.png" alt="image"><br></div></div><br>  2) Insert a huge number of <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BA">basic blocks</a> in CFG, with optional execution. (See screenshots from item 1) <br>  A random base block is taken, its terminator is changed (the instruction of completion of the base block), a lot of base blocks are created and all of them are mixed together, they can be executed or not, according to the author's fantasy. <br>  3) Littering the code. <br>  Suppose that we have a certain code, it is diluted with garbage instructions that try to imitate their usefulness.  They can access / change our data without affecting the execution of the program as a whole.  The goal is to make the analysis of our application as difficult as possible, with minimal loss in performance. <br><div class="spoiler">  <b class="spoiler_title">One of many available obfuscation options.</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;time.h&gt; void test() { int a = 32; int b = time(0); int c = a+a+b; int d = a-b+c*2; printf("%d",d); } int main() { test(); }</span></span></span></span></code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/f16/491/f43/f16491f43ccb57dcf185038ca2313bd3.png" alt="image"><br></div></div><br>  4) Hiding constants, data. <br>  Suppose that we have a constant 15h, we make it so that in the native code a constant will be formed at runtime and not found in an open form. The same constant data can be hidden using any encryption algorithm. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main() { const char *habr = "habrahabr"; printf("%s",habr); }</span></span></span></span></code> </pre><br>  We find constant data, namely habrahabr, and insert our data decryptor.  In the image, there is an example with xor, but you can add any encryption algorithm (AES, RC4, etc.). Data after use (printf) on the stack will be encrypted with a random key. <br><img src="https://habrastorage.org/getpro/habr/post_images/db8/de8/69f/db8de869fbe9a4919ba595f737922595.png" alt="image"><br>  Suppose you want to add data encryption, how is this easiest to do? <br>  LLVM can generate its own code from cpp files, which you can insert into your project. <br>  See the hint in the answers section. <br></div></div><br>  5) Cloning functions and using them in a random order. <br>  The same function is cloned into the set (with possible changes), its handler is inserted at the place of the call code, the functions are called in random order. <br>  6) Combining functions. <br>  All functions and their code are transferred to one.  In some cases, the use of such a method is fraught. <br>  7) Organization from a <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D0%25B5%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D0%25B2%25D1%2582%25D0%25BE%25D0%25BC%25D0%25B0%25D1%2582">state machine</a> code or a switch. <br>  A new base block is created, which becomes the entry point for the main function, branches are created from it (possibly based on a variable) to other base blocks. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text">  Original code. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; int rand_func() { return 5+rand();; } int main() { const char *habr = "habrahabr"; printf("%s",habr); int a = rand_func(); goto test; exit(0); test: int b = a+a; }</span></span></span></span></code> </pre><br>  First time. <br><img src="https://habrastorage.org/getpro/habr/post_images/c34/c79/1a0/c34c791a0b41b4aa92eca8fcd1df6c5f.png" alt="image"><br>  Second time. <br><img src="https://habrastorage.org/getpro/habr/post_images/e6f/4d5/ea4/e6f4d5ea4807b9cbf52088e409671d91.png" alt="image"><br></div></div><br>  8) Creating pseudocycles from code. <br>  It is applicable with respect to functions, the base block of a specific function is taken, several more blocks are added to it to organize a cycle, the loop is executed only once. <br>  9) A random virtual machine is created, all the existing code is transformed under it, for me this item is possible so far only in theory. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  How to start learning? </h4><br><div class="spoiler">  <b class="spoiler_title">View a list of available three-address commands.</b> <div class="spoiler_text">  // === - llvm / Instruction.def - File that Instructions - * - C ++ - * - === // <br>  // <br>  // The LLVM Compiler Infrastructure <br>  // <br>  // This file is distributed to the University of Illinois Open Source <br>  // License.  See LICENSE.TXT for details. <br>  // <br>  // === --------------------------------------------- ------------------------- === // <br>  // <br>  // This file contains descriptions of various LLVM instructions.  This is <br>  // used as a central place for enumerating the instructions <br>  // should eventually be instructions. <br>  // <br>  // === --------------------------------------------- ------------------------- === // <br><br>  FIRST_TERM_INST (1) <br>  HANDLE_TERM_INST (1, Ret, ReturnInst) <br>  HANDLE_TERM_INST (2, Br, BranchInst) <br>  HANDLE_TERM_INST (3, Switch, SwitchInst) <br>  HANDLE_TERM_INST (4, IndirectBr, IndirectBrInst) <br>  HANDLE_TERM_INST (5, Invoke, InvokeInst) <br>  HANDLE_TERM_INST (6, Resume, ResumeInst) <br>  HANDLE_TERM_INST (7, Unreachable, UnreachableInst) <br>  LAST_TERM_INST (7) <br><br>  // Standard binary operators ... <br>  FIRST_BINARY_INST (8) <br>  HANDLE_BINARY_INST (8, Add, BinaryOperator) <br>  HANDLE_BINARY_INST (9, FAdd, BinaryOperator) <br>  HANDLE_BINARY_INST (10, Sub, BinaryOperator) <br>  HANDLE_BINARY_INST (11, FSub, BinaryOperator) <br>  HANDLE_BINARY_INST (12, Mul, BinaryOperator) <br>  HANDLE_BINARY_INST (13, FMul, BinaryOperator) <br>  HANDLE_BINARY_INST (14, UDiv, BinaryOperator) <br>  HANDLE_BINARY_INST (15, SDiv, BinaryOperator) <br>  HANDLE_BINARY_INST (16, FDiv, BinaryOperator) <br>  HANDLE_BINARY_INST (17, URem, BinaryOperator) <br>  HANDLE_BINARY_INST (18, SRem, BinaryOperator) <br>  HANDLE_BINARY_INST (19, FRem, BinaryOperator) <br><br>  // Logical operators (integer operands) <br>  HANDLE_BINARY_INST (20, Shl, BinaryOperator) // Shift left (logical) <br>  HANDLE_BINARY_INST (21, LShr, BinaryOperator) // Shift right (logical) <br>  HANDLE_BINARY_INST (22, AShr, BinaryOperator) // Shift right (arithmetic) <br>  HANDLE_BINARY_INST (23, And, BinaryOperator) <br>  HANDLE_BINARY_INST (24, Or, BinaryOperator) <br>  HANDLE_BINARY_INST (25, Xor, BinaryOperator) <br>  LAST_BINARY_INST (25) <br><br>  // Memory operators ... <br>  FIRST_MEMORY_INST (26) <br>  HANDLE_MEMORY_INST (26, Alloca, AllocaInst) // Stack management <br>  HANDLE_MEMORY_INST (27, Load, LoadInst) // Memory manipulation instrs <br>  HANDLE_MEMORY_INST (28, Store, StoreInst) <br>  HANDLE_MEMORY_INST (29, GetElementPtr, GetElementPtrInst) <br>  HANDLE_MEMORY_INST (30, Fence, FenceInst) <br>  HANDLE_MEMORY_INST (31, AtomicCmpXchg, AtomicCmpXchgInst) <br>  HANDLE_MEMORY_INST (32, AtomicRMW, AtomicRMWInst) <br>  LAST_MEMORY_INST (32) <br><br>  // Cast operators ... <br>  // NOTE: The order matters here CastInst :: isEliminableCastPair <br>  // NOTE: (see Instructions.cpp) encodes a table based on this ordering. <br>  FIRST_CAST_INST (33) <br>  HANDLE_CAST_INST (33, Trunc, TruncInst) // Truncate integers <br>  HANDLE_CAST_INST (34, ZExt, ZExtInst) // Zero extend integers <br>  HANDLE_CAST_INST (35, SExt, SExtInst) // Sign extend integers <br>  HANDLE_CAST_INST (36, FPToUI, FPToUIInst) // floating point -&gt; UInt <br>  HANDLE_CAST_INST (37, FPToSI, FPToSIInst) // floating point -&gt; SInt <br>  HANDLE_CAST_INST (38, UIToFP, UIToFPInst) // UInt -&gt; floating point <br>  HANDLE_CAST_INST (39, SIToFP, SIToFPInst) // SInt -&gt; floating point <br>  HANDLE_CAST_INST (40, FPTrunc, FPTruncInst) // Truncate floating point <br>  HANDLE_CAST_INST (41, FPExt, FPExtInst) // Extend floating point <br>  HANDLE_CAST_INST (42, PtrToInt, PtrToIntInst) // Pointer -&gt; Integer <br>  HANDLE_CAST_INST (43, IntToPtr, IntToPtrInst) // Integer -&gt; Pointer <br>  HANDLE_CAST_INST (44, BitCast, BitCastInst) // Type cast <br>  LAST_CAST_INST (44) <br><br>  // Other operators ... <br>  FIRST_OTHER_INST (45) <br>  HANDLE_OTHER_INST (45, ICmp, ICmpInst) // Integer comparison instruction <br>  HANDLE_OTHER_INST (46, FCmp, FCmpInst) // Floating point comparison instr. <br>  HANDLE_OTHER_INST (47, PHI, PHINode) // PHI node instruction <br>  HANDLE_OTHER_INST (48, Call, CallInst) // Call a function <br>  HANDLE_OTHER_INST (49, Select, SelectInst) // select instruction <br>  HANDLE_OTHER_INST (50, UserOp1, Instruction) // May be used internally in a pass <br>  HANDLE_OTHER_INST (51, UserOp2, Instruction) // Internal to passes only <br>  HANDLE_OTHER_INST (52, VAArg, VAArgInst) // vaarg instruction <br>  HANDLE_OTHER_INST (53, ExtractElement, ExtractElementInst) // extract from vector <br>  HANDLE_OTHER_INST (54, InsertElement, InsertElementInst) // insert into vector <br>  HANDLE_OTHER_INST (55, ShuffleVector, ShuffleVectorInst) // shuffle two vectors. <br>  HANDLE_OTHER_INST (56, ExtractValue, ExtractValueInst) // extract from aggregate <br>  HANDLE_OTHER_INST (57, InsertValue, InsertValueInst) // insert into aggregate <br>  HANDLE_OTHER_INST (58, LandingPad, LandingPadInst) // Landing pad instruction. <br>  LAST_OTHER_INST (58) <br></div></div><br>  You should read the following documentation: <br>  <a href="">LLVM-CheatSheet</a> <br>  <a href="http://llvm.org/docs/ProgrammersManual.html">LLVM Programmers Manual</a> <br>  <a href="http://www.cs.sfu.ca/~anoop/teaching/CMPT-379-Fall-2013/decafLLVM.pdf">LLVM-CheatSheet 2</a> <br>  <a href="http://jonathan2251.github.io/lbd/TutorialLLVMBackendCpu0.pdf">LLVMBackendCPU</a> <br>  <a href="http://ac.inf.elte.hu/Vol_030_2009/003.pdf">Obfuscating c ++ programs via CFF</a> <br><br>  It is worth looking at the public implementation of obfuscation code for review. <br>  1) <a href="https://github.com/obfuscator-llvm/obfuscator/branches">Obfuscator-llvm</a> <br>  Implemented replacement of instructions, compaction of the execution graph. <br>  2) <a href="https://github.com/0vercl0k/stuffz/tree/master/llvm-funz">Kryptonite</a> <br>  Implemented replacement of instructions with analogs / decomposition of instructions. <br><br><h4>  Snipples </h4><br>  In order to insert asm instructions, you can use <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1InlineAsm.html">llvm :: InlineAsm</a> or <a href="http://llvm.org/docs/WritingAnLLVMPass.html">MachinePass</a> , through machine passes you can change, add instructions.  A good example is <a href="">here.</a> <br><br><div class="spoiler">  <b class="spoiler_title">some useful code to get you started</b> <div class="spoiler_text">  How to read bytecode file? <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> file = <span class="hljs-string"><span class="hljs-string">"1.bc"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> ErrorInfo; llvm::LLVMContext context; llvm::MemoryBuffer::getFile(file.c_str(), bytecode); llvm::Module *<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> = llvm::ParseBitcodeFile(bytecode.get(), context, &amp;error);</code> </pre><br>  How to iterate functions in a module? <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>-&gt;getFunctionList().begin(); i != <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>-&gt;getFunctionList().end(); ++i) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Function %s"</span></span>,i-&gt;getName().str()); }</code> </pre><br>  How to check for belonging to some instructions? <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (llvm::isa&lt;llvm::BranchInst&gt;(currentInstruction)) <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"BranchInst!"</span></span>);</code> </pre><br>  How to replace the terminator with another instruction? <br><pre> <code class="cpp hljs">llvm::BasicBlock *block = () block-&gt;replaceAllUsesWith(  );</code> </pre><br>  How to make bringing one instruction to another? <br><pre> <code class="cpp hljs">llvm::Instruction* test = basicBlock-&gt;getTerminator(); llvm::BranchInst* branchInst = llvm::dyn_cast&lt;llvm::BranchInst&gt;(test)</code> </pre><br>  How to get the first non- <a href="http://llvm.org/docs/LangRef.html">phi</a> instruction in the base unit? <br><pre> <code class="cpp hljs">llvm::Instruction *inst = currentInstruction-&gt;getParent()-&gt;getFirstNonPHI()</code> </pre><br>  How to iterate instructions in a function? <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(llvm::inst_iterator i = inst_begin(function); i != inst_end(function); i++) { llvm::Instruction* inst = &amp;*i; }</code> </pre><br>  How to find out if the instruction is used somewhere else? <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsUsedOutsideParentBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(llvm::Instruction* inst)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(llvm::inst::use_iterator i = inst-&gt;use_begin(); i != inst-&gt;use_end(); i++) { llvm::User* user = *i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(llvm::cast&lt;llvm::Instruction&gt;(user)-&gt;getParent() != inst-&gt;getParent()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  How to get / change the base blocks that InvokeInst and others refer to? <br><pre> <code class="cpp hljs">invokeInst-&gt;getSuccessor(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    . invokeInst-&gt;setSuccessor(0,basicBlock); //.</span></span></code> </pre><br></div></div><br><br><h4>  Answers on questions </h4><br>  Q: What about deobfuscation? <br>  A: It all depends on you, there is a <a href="http://opticode.coseinc.com/">project</a> based on LLVM to remove obfuscation. <br>  Q: How to generate byte code file from source? <br>  A: <code>clang -emit-llvm -o 1.bc -c 1.c</code> <br>  Q: How to compile byte code? <br>  A: <code>clang -o 1 1.bc</code> <br>  Q: How to generate an asm file from an LLVM IR view? <br>  A: <code>llc foo.ll</code> <br>  Q: How to generate IR file from source? <br>  A: <code>clang -S -emit-llvm 1.c</code> <br>  Q: How to compile .s file (assembler)? <br>  A: <code>gcc -o exe 1.s</code> <br>  Q: How to get obj file from bytecode? <br>  A: <code>llc -filetype=obj 1.bc</code> <br>  Q: How to get the source from LLVM api for cpp file? <br>  A: clang ++ -c -emit-llvm 1.cpp -o 1.ll then <code>llc -march=cpp -o 1.ll.cpp 1.ll</code> <br>  Q: Compiled clang under windows, but he can not find the header files, how to treat? <br>  A: You need to find InitHeaderSearch.cpp and add the necessary paths, look in the direction of AddMinGWCPlusPlusIncludePaths, AddMinGW64CXXPaths. <br>  Q: Clang compiled under the visual studio works fine? <br>  A: Not at the moment, it can only compile the simplest C code. <br>  Q: Clang with optimization mode cuts the generated instructions / functions, what to do? <br>  A: Your passes must be embedded in the clang, in <a href="http://llvm.org/docs/doxygen/html/PassManagerBuilder_8cpp_source.html">this</a> cpp file.  You can also force the compiler to think that the code we added is necessary, for this it is necessary that this code be used, in the case of functions, they must be called.  For tests, you can use the -O0 mode. </div><p>Source: <a href="https://habr.com/ru/post/213259/">https://habr.com/ru/post/213259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213245/index.html">Facebook buys WhatsApp for $ 16 billion</a></li>
<li><a href="../213247/index.html">FDB switch tables. Adventures in the zoo. Part 1 - SNMP</a></li>
<li><a href="../213251/index.html">First blog post: moving from idea to project layout</a></li>
<li><a href="../213253/index.html">Making the game right before your eyes - part 4: Shader for fade in on the palette (a la NES)</a></li>
<li><a href="../213257/index.html">Therascale OCP Solution</a></li>
<li><a href="../213261/index.html">CodeFest number 5 - again cake</a></li>
<li><a href="../213263/index.html">Prostokvashino on Habr√© or Uncle Fedor‚Äôs letter</a></li>
<li><a href="../213265/index.html">Init.js: Why and how to develop JavaScript with Full-Stack</a></li>
<li><a href="../213269/index.html">Deploy applications on RoR 4 using Capistrano 3</a></li>
<li><a href="../213271/index.html">Intuition as a developer tool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>